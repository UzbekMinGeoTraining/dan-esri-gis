import{a as S,b as be,c as we,d as Fe}from"./chunk-7KDXNWXG.js";import{d as _e,e as Ee}from"./chunk-UHCAZ4FA.js";import{a as me,b as fe,d as ge}from"./chunk-CYHJCRNT.js";import"./chunk-3NGMQGRU.js";import"./chunk-T2AXATG3.js";import"./chunk-CDG4VMUI.js";import"./chunk-X6MZ5ATR.js";import"./chunk-D4P3UBRY.js";import"./chunk-Z5WTQFWN.js";import{a as he}from"./chunk-QN72YLVS.js";import{a as de,c as x}from"./chunk-IVZ2RXL2.js";import"./chunk-NPHNUKYC.js";import{a as pe}from"./chunk-2K35ZAGK.js";import"./chunk-YFTQBYV4.js";import"./chunk-6GII4ES2.js";import"./chunk-TXTTY5DY.js";import"./chunk-PD3MYUGK.js";import"./chunk-M2LOI65L.js";import"./chunk-QMHKSQHG.js";import"./chunk-KX5Z6TZC.js";import{a as le,b as Q,c as ue}from"./chunk-E3DN7XQP.js";import"./chunk-A7QJESER.js";import"./chunk-2BYXPFOZ.js";import"./chunk-XH7FW5RT.js";import{F as Y,G as J}from"./chunk-4RJTDUBN.js";import"./chunk-MTRBRBPC.js";import"./chunk-A7GYEEN6.js";import"./chunk-UHTGNOYM.js";import"./chunk-DJGT5PK5.js";import{i as se,m as oe,o as ae}from"./chunk-HW47RMVO.js";import"./chunk-VHWLEJLO.js";import"./chunk-XMXL44YY.js";import"./chunk-4HD5O3T7.js";import"./chunk-OSH5MRH4.js";import"./chunk-M5EU7OBK.js";import"./chunk-ZIKE37L7.js";import"./chunk-RMOAL4BI.js";import"./chunk-4SXNSTQ4.js";import"./chunk-A74W4U2J.js";import"./chunk-MAZHSYWX.js";import"./chunk-YVFVORWT.js";import"./chunk-6GQ5JB2B.js";import"./chunk-NUHIEXKU.js";import"./chunk-3U6BMQLZ.js";import"./chunk-EPEHXQDG.js";import"./chunk-5POQUC4T.js";import"./chunk-ELOFFQD3.js";import"./chunk-VFQ7QZ34.js";import"./chunk-JGPFCHHF.js";import"./chunk-VQ5WF3XI.js";import"./chunk-J2D4NQQB.js";import"./chunk-TGSQQX44.js";import"./chunk-WPTVLDNN.js";import"./chunk-DRK6GLQ3.js";import"./chunk-BRKYWLZQ.js";import"./chunk-DAAL3W2C.js";import"./chunk-DGD6TNOG.js";import"./chunk-YB6FP3Z6.js";import"./chunk-YNNF4FWO.js";import"./chunk-SUJDRDW4.js";import"./chunk-T7FSW5ND.js";import"./chunk-WUZAEWWX.js";import"./chunk-Z7HQSEFF.js";import"./chunk-NPSROKUX.js";import"./chunk-RI2HJFLU.js";import"./chunk-7YHK56KB.js";import"./chunk-PHK5IJNU.js";import"./chunk-OH475TQV.js";import"./chunk-S2YELA2I.js";import"./chunk-TOCNTYZ2.js";import{e as $}from"./chunk-KAOR3JAH.js";import"./chunk-ACVF7Z7X.js";import"./chunk-LCRAHT7B.js";import"./chunk-QMGVGOIN.js";import"./chunk-M7Q5ICON.js";import"./chunk-DSHXH3B4.js";import"./chunk-4YKQUZA5.js";import"./chunk-LSPZMBFV.js";import"./chunk-UMYW2XL7.js";import"./chunk-U4ERJPQO.js";import"./chunk-ZRDZCHT6.js";import"./chunk-OW4OHJOK.js";import"./chunk-SV4KOVAG.js";import"./chunk-RHS3EARZ.js";import"./chunk-UYKI77KI.js";import"./chunk-TWEIBILM.js";import"./chunk-4FO73WSB.js";import"./chunk-Q5GL3CSI.js";import"./chunk-X7CRJ427.js";import"./chunk-4DR6EKLV.js";import"./chunk-2SZOQMAQ.js";import"./chunk-OT635BJR.js";import"./chunk-WCQK6XOZ.js";import"./chunk-RCCESRES.js";import{b as ce}from"./chunk-PA5IAWXD.js";import{a as ye}from"./chunk-AR3SF3CU.js";import"./chunk-MM6IP4FS.js";import"./chunk-WP7QHDBV.js";import"./chunk-BJF27AOA.js";import"./chunk-MNU4KXU7.js";import"./chunk-AJSXTGZB.js";import"./chunk-2F2E6NNR.js";import"./chunk-RB4JCGG3.js";import"./chunk-GLY75KSJ.js";import"./chunk-3KFX3FFC.js";import"./chunk-Q5HG4NWF.js";import"./chunk-U45ID7OR.js";import"./chunk-IW2AVHBW.js";import"./chunk-SDHCGQUI.js";import"./chunk-VSPQNL6A.js";import"./chunk-7H32J6FD.js";import"./chunk-XNAAMINV.js";import"./chunk-NPF6KTZO.js";import"./chunk-WNU76WNW.js";import"./chunk-H4XRNT5U.js";import"./chunk-WIJFCRLT.js";import"./chunk-6ISQQD7M.js";import"./chunk-VHVYC3RW.js";import"./chunk-ZBOVC36T.js";import"./chunk-BUWHOOA3.js";import"./chunk-RLQK45UV.js";import"./chunk-SDC4SION.js";import"./chunk-6VHG3ZEH.js";import"./chunk-N3AGC3JB.js";import"./chunk-KHTVZWEX.js";import"./chunk-IGNHVSQC.js";import"./chunk-B3W5V2XP.js";import"./chunk-NP35J4DQ.js";import"./chunk-JBGML6IF.js";import"./chunk-S2HMCZNZ.js";import"./chunk-WUAC4CFP.js";import"./chunk-ONDKJR4V.js";import"./chunk-QB4KDO4M.js";import"./chunk-NNNTRPDR.js";import"./chunk-KDLA3TQ2.js";import"./chunk-RPMDOAYZ.js";import"./chunk-J7UK2QPE.js";import"./chunk-6DXGZQQN.js";import"./chunk-3PK63SMD.js";import"./chunk-2DN2BYDF.js";import"./chunk-GQ2SPTYG.js";import"./chunk-RBWI4VLW.js";import"./chunk-MEA3RU4I.js";import"./chunk-3QNHUVFJ.js";import"./chunk-7OTZECLS.js";import"./chunk-XBFBZZXW.js";import"./chunk-LWUJWBPJ.js";import"./chunk-V7QAQAGA.js";import"./chunk-K5V3S3K3.js";import"./chunk-HCCGI45Q.js";import"./chunk-Q6D44QVW.js";import"./chunk-C3EWQ5V5.js";import"./chunk-3UBXEUOT.js";import"./chunk-6WV5YJL7.js";import"./chunk-3AMG6HG6.js";import"./chunk-I6ETUG5Q.js";import"./chunk-4MZSW4Z6.js";import"./chunk-BERIM72F.js";import"./chunk-YOBNM4T6.js";import"./chunk-MEBZWNWT.js";import"./chunk-XZ52TEBV.js";import"./chunk-WAPQB6I3.js";import"./chunk-L3GHXHDP.js";import"./chunk-N6PITG7Q.js";import"./chunk-XC4LDHG5.js";import"./chunk-S3ASAZCA.js";import"./chunk-ZUUCQTSR.js";import"./chunk-GKUBZAEG.js";import"./chunk-UW734WOQ.js";import"./chunk-BIZV3H6H.js";import"./chunk-UCYGH5UZ.js";import"./chunk-ATV5GTE5.js";import"./chunk-X7WNJQZZ.js";import"./chunk-PQPFAB53.js";import"./chunk-QPPQKNYU.js";import"./chunk-MJXFSFCY.js";import"./chunk-6N46AY7Z.js";import"./chunk-TCQTMUK4.js";import"./chunk-AY3YVZUY.js";import"./chunk-7DCEI345.js";import"./chunk-ZG3FCPXY.js";import"./chunk-RIUAG34V.js";import"./chunk-G5SIQY64.js";import"./chunk-WW7S4V24.js";import"./chunk-UGAMS6PU.js";import"./chunk-EHDNZUTT.js";import"./chunk-ECBUS54L.js";import"./chunk-NH7OOX2I.js";import"./chunk-B72PB7U4.js";import"./chunk-644SLL4Y.js";import"./chunk-A54VD7GL.js";import"./chunk-K55ZDM2S.js";import"./chunk-UHYNS4LH.js";import"./chunk-Z3USGHSR.js";import"./chunk-SLEIRDN7.js";import"./chunk-W3OGU5I2.js";import"./chunk-OO4IIGVK.js";import"./chunk-KQHYII76.js";import"./chunk-6I6DPRXI.js";import"./chunk-RNN6GAXL.js";import"./chunk-4IVMQ5PX.js";import"./chunk-CQUOQXLP.js";import"./chunk-VMYCUJRH.js";import"./chunk-PTVRFY4B.js";import"./chunk-3ZOLHUAU.js";import"./chunk-O6YJVL7E.js";import{c as ie}from"./chunk-I6ZCG7XQ.js";import"./chunk-URULUATZ.js";import"./chunk-WOTA3FFP.js";import"./chunk-BNUQT6PD.js";import{d as E}from"./chunk-5DAF2FXI.js";import"./chunk-M2F4B74F.js";import"./chunk-2WNCPIJC.js";import"./chunk-GDB2EJGA.js";import"./chunk-RDGFIF46.js";import"./chunk-C2ONI6UP.js";import"./chunk-H6LJ2DCJ.js";import{a as te}from"./chunk-IMNO5TXZ.js";import"./chunk-LCDA6FHZ.js";import"./chunk-RZPELDHM.js";import"./chunk-S3J33BKD.js";import"./chunk-NPIYHDQ7.js";import"./chunk-BL63T6AU.js";import"./chunk-AOTWUAUY.js";import"./chunk-VI4TDFI5.js";import"./chunk-GXSLPADW.js";import"./chunk-2HN33SWB.js";import"./chunk-523X5JOP.js";import"./chunk-BXR2KKYP.js";import"./chunk-7ISKCG7U.js";import"./chunk-OFGHVREP.js";import"./chunk-U3ETEC6R.js";import"./chunk-A2IYJOJO.js";import"./chunk-EFOMVUIX.js";import"./chunk-42DKYLC7.js";import"./chunk-LB3WSIYI.js";import"./chunk-B7ZDEOLU.js";import"./chunk-22JBWFHY.js";import"./chunk-6YHOGO6F.js";import{a as re}from"./chunk-VY6QN6EN.js";import"./chunk-VZPIZOOE.js";import"./chunk-BWCHJXL6.js";import"./chunk-R7X3CKFH.js";import"./chunk-64FW22PO.js";import"./chunk-3EB3OCOV.js";import"./chunk-7Z3Y27UA.js";import"./chunk-HFXUZM7A.js";import"./chunk-3A66AUSD.js";import"./chunk-UUKQEAQR.js";import"./chunk-6UUMJQNV.js";import"./chunk-Y63DBETK.js";import"./chunk-GNKF5TIB.js";import"./chunk-X4XHTJSF.js";import"./chunk-YIBWVOPM.js";import"./chunk-PY5WUUCV.js";import"./chunk-R3XRMWAK.js";import"./chunk-PL6CVK2A.js";import"./chunk-J2R7NR2E.js";import"./chunk-VPH54J3G.js";import"./chunk-OD6TX477.js";import"./chunk-ISUG5L3D.js";import"./chunk-FKKNYWR6.js";import"./chunk-YJ3RZNO6.js";import"./chunk-M4PATAW3.js";import"./chunk-BNQ5VRNF.js";import"./chunk-NOFXYDQS.js";import"./chunk-4BLMEKFL.js";import"./chunk-RPIA54UY.js";import"./chunk-WRN6YTSB.js";import"./chunk-BQ7BWYEG.js";import"./chunk-NN4OC7FN.js";import"./chunk-6BV3ATJ4.js";import"./chunk-H7Y5XCPW.js";import"./chunk-26R336GJ.js";import"./chunk-OC7V2CEX.js";import"./chunk-VTCODMOL.js";import"./chunk-B7GIKKEW.js";import"./chunk-CA2IXN6Q.js";import"./chunk-AXPRNSO3.js";import"./chunk-FIUHDVVO.js";import"./chunk-3HX6VT75.js";import"./chunk-U4Y7WABQ.js";import"./chunk-WYOOSF42.js";import"./chunk-R7P6RQXJ.js";import"./chunk-4I7LQWUX.js";import"./chunk-JLNQ6WQT.js";import"./chunk-GB5RQL32.js";import"./chunk-R6S6A5GA.js";import"./chunk-25T3ULWN.js";import"./chunk-4OZVVJHM.js";import"./chunk-IZRBPB5G.js";import"./chunk-X7XJWAFC.js";import"./chunk-FOAEOOK3.js";import"./chunk-ILCAH2F6.js";import"./chunk-CYCLIMTY.js";import"./chunk-C3YONAAM.js";import"./chunk-2GSAHDXY.js";import"./chunk-OL24FY3J.js";import"./chunk-QBRYULPI.js";import"./chunk-GPQLPPA5.js";import"./chunk-OXRGERMH.js";import"./chunk-LHH3AZP2.js";import{a as ee}from"./chunk-HVNUIUKO.js";import"./chunk-Y5M2SONX.js";import{a as X}from"./chunk-Q6ZVH4MK.js";import"./chunk-OL43UY3L.js";import"./chunk-H2QMNAXT.js";import"./chunk-GKUDWGVQ.js";import"./chunk-NZ7WSL6F.js";import"./chunk-RRDM7P6F.js";import"./chunk-EYI3QUAE.js";import"./chunk-LCTRO7CL.js";import"./chunk-7X2HMUNN.js";import"./chunk-LW2464MZ.js";import"./chunk-WJDHM47L.js";import"./chunk-LWJTIQQT.js";import"./chunk-IHBD2IWR.js";import"./chunk-NH3JQE75.js";import"./chunk-XXOIKNT6.js";import"./chunk-DBLGLVAQ.js";import"./chunk-55A6ZSIC.js";import"./chunk-63EK7JRZ.js";import"./chunk-HVNRUZWJ.js";import"./chunk-AYOI2Y26.js";import{b as L}from"./chunk-ZGDQY5ZD.js";import"./chunk-QH2MD2O2.js";import"./chunk-6EZNY6L4.js";import"./chunk-3IK5VXZ3.js";import"./chunk-7XLHE26H.js";import"./chunk-MBVOWLUI.js";import"./chunk-EN6CTWVM.js";import"./chunk-KLUVHTFQ.js";import"./chunk-JMSMQ4Z7.js";import"./chunk-IRJNWXGT.js";import"./chunk-LVPMJTA6.js";import"./chunk-WDFAQFJ4.js";import"./chunk-7LUQF6AI.js";import{d as Z}from"./chunk-O4AQRVFI.js";import"./chunk-NDPAZKBG.js";import"./chunk-7AZ5UVCG.js";import"./chunk-6GGK7PRJ.js";import"./chunk-G3PA3VVF.js";import"./chunk-AO7UDTUI.js";import"./chunk-Q7O5PY54.js";import"./chunk-PFIMJ2UL.js";import"./chunk-CY477QBZ.js";import"./chunk-EJO53FLN.js";import"./chunk-XXR5OT24.js";import"./chunk-4XIZVPNF.js";import"./chunk-F7VAE37R.js";import"./chunk-PM4ZR7W6.js";import"./chunk-ENLR2WBX.js";import"./chunk-RI3FIROF.js";import"./chunk-PJX4LNSV.js";import"./chunk-NNETCWLJ.js";import"./chunk-EPTSNNZF.js";import"./chunk-FW33MEBA.js";import"./chunk-RM6CXOHZ.js";import"./chunk-AOA5JMXK.js";import"./chunk-TWW3KW7Z.js";import"./chunk-I6LCIPDY.js";import"./chunk-Y6H3NTW7.js";import"./chunk-4RLJMQW4.js";import"./chunk-J6ZRC6RI.js";import"./chunk-EBGO44EK.js";import"./chunk-THY6AAMN.js";import"./chunk-7W6RATG7.js";import"./chunk-45SNVLPM.js";import"./chunk-BDF7KEUQ.js";import"./chunk-HWN5REN7.js";import"./chunk-B4JAL745.js";import"./chunk-XTES2GPX.js";import"./chunk-2HUIJUS4.js";import"./chunk-VDNXTMSC.js";import{a as C,h as R,i as w}from"./chunk-MBJHSEMD.js";import"./chunk-K72LO6P2.js";import"./chunk-R7Q3STHM.js";import"./chunk-G4PDP3HY.js";import"./chunk-EKU2FJZS.js";import"./chunk-NHN544WL.js";import"./chunk-WZ5A3YGX.js";import"./chunk-NKMODNM6.js";import"./chunk-SEKMXZL5.js";import"./chunk-2R4SNL6O.js";import"./chunk-MXOOOTCV.js";import{J as ne,e as v,h as A}from"./chunk-7D4IYTAJ.js";import"./chunk-TSNWBMBA.js";import"./chunk-GLWPOGYF.js";import"./chunk-YFBPRKIN.js";import"./chunk-P2YRCTWM.js";import"./chunk-OFZ6SV37.js";import"./chunk-LAJXTVEO.js";import"./chunk-5MNDZ6BX.js";import"./chunk-RDHMB7M5.js";import"./chunk-YSOJWUIW.js";import"./chunk-Q5WFUDPQ.js";import"./chunk-DPZGANVI.js";import"./chunk-T7BKG6V3.js";import"./chunk-R6VC74T7.js";import"./chunk-6WKJD7BM.js";import"./chunk-3CR7P5WT.js";import{b as K}from"./chunk-YRTBL7EE.js";import"./chunk-3FPO2LOS.js";import"./chunk-QNZSBADV.js";import"./chunk-PYQRTZNZ.js";import"./chunk-S4PLWG55.js";import"./chunk-DZAY272R.js";import"./chunk-GYH7NDHH.js";import"./chunk-S3UQHW42.js";import{c as z}from"./chunk-VQHENXDQ.js";import{a as W}from"./chunk-VWF5VUO3.js";import"./chunk-HRP5LYWJ.js";import"./chunk-BIVFGNT6.js";import"./chunk-EUZMXXZJ.js";import"./chunk-7PEPFLZH.js";import"./chunk-BRVOQZDM.js";import"./chunk-3M7VXIQH.js";import{a as j}from"./chunk-TBYT66N3.js";import"./chunk-5PTS4JDF.js";import"./chunk-MUI46NAG.js";import"./chunk-N27U3N2T.js";import"./chunk-4R5NBZMW.js";import"./chunk-NDYVXEZ5.js";import"./chunk-CMMPCPP5.js";import"./chunk-4DLSYLKE.js";import"./chunk-VPXBKZQM.js";import"./chunk-ZTKK3KB7.js";import"./chunk-GZXWFBZI.js";import"./chunk-B7IARA3F.js";import"./chunk-IZVEJCCI.js";import"./chunk-TEY6TKJV.js";import"./chunk-4M6XQSBA.js";import"./chunk-2JF6YUJG.js";import{Q as a,S as _}from"./chunk-GGZQ5GCM.js";import{U as g,u as k}from"./chunk-TFUPB3ZG.js";import"./chunk-ANPNMGFG.js";import{a as o}from"./chunk-BMVJCP2M.js";import{E as U,c as H,l as F,o as N,t as D,x as G}from"./chunk-GMC3I5VG.js";import{b as B,e as T}from"./chunk-WGF2T2BG.js";import"./chunk-YZP43POT.js";import"./chunk-VEDIBGHD.js";import{r as c,t as I}from"./chunk-3IBUFXWY.js";import"./chunk-BP73DJTS.js";import{a as P,b as O,g as f}from"./chunk-JEGVIFEP.js";var V=(e,r)=>{let t=class extends j(X(W.EventedMixin(e))){constructor(i){super(i),this.sublayer=null,this.parent=null,this.view=null}initialize(){}get suspended(){return!this.canResume()}get updating(){return!this.suspended&&this.isUpdating()}get visible(){return!!this.sublayer?.visible}set visible(i){this._overrideIfSome("visible",i)}get fullOpacity(){let i=s=>s??1;return i(this.sublayer?.opacity)*i(this.parent?.fullOpacity)}canResume(){return!this.parent?.suspended&&this.view?.ready&&this.visible||!1}isUpdating(){return!1}};return o([a()],t.prototype,"sublayer",void 0),o([a()],t.prototype,"parent",void 0),o([a({readOnly:!0})],t.prototype,"suspended",null),o([a({type:Boolean,readOnly:!0})],t.prototype,"updating",null),o([a()],t.prototype,"view",void 0),o([a()],t.prototype,"visible",null),o([a()],t.prototype,"fullOpacity",null),t=o([g("esri.views.3d.layers.BuildingSublayerView3D")],t),t};var h;(function(e){e[e.Solid=0]="Solid",e[e.WireFrame=1]="WireFrame",e[e.XRay=2]="XRay"})(h||(h={}));var ve=.15,Ve=.5*ve;function xe(e){switch(e.filterMode.type){case"solid":return{mode:h.Solid};case"wire-frame":return{mode:h.WireFrame,edgeMaterial:ie(e.filterMode.edges,{})};case"x-ray":return{mode:h.XRay}}}function q(e,r){if(r==null)return e.color[3]=0,e.edgeMaterial=null,void(e.pickable=!1);switch(r.mode){case h.Solid:return;case h.WireFrame:return e.color[3]=0,e.edgeMaterial=r.edgeMaterial,void(e.pickable=!1);case h.XRay:return e.color[0]=1,e.color[1]=1,e.color[2]=1,e.color[3]*=ve,e.colorMixMode=te.Replace,e.castShadows=!1,e.pickable=!1,void(e.edgeMaterial=Me(e.edgeMaterial))}}function Me(e){return e==null?null:(M.lastMaterial!==e&&(M.cachedMaterial=Ie(e),M.lastMaterial=e),M.cachedMaterial)}function Ie(e){let r=K(e.color);return r[3]*=Ve,O(P({},e),{color:r})}var M={cachedMaterial:null,lastMaterial:null};var m=class extends _{constructor(){super(...arguments),this.sublayer=null}get updating(){return!1}get suspended(){return!1}get availableFields(){return[]}get filter(){return null}set filter(r){throw new Error("Not implemented")}queryFeatures(r,t){throw new Error("Not implemented")}queryObjectIds(r,t){throw new Error("Not implemented")}queryFeatureCount(r,t){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(r,t){throw new Error("Not implemented")}highlight(r){throw new Error("Not implemented")}};o([a()],m.prototype,"sublayer",void 0),o([a()],m.prototype,"availableFields",null),o([a()],m.prototype,"filter",null);var p=class extends Ee(_e(ge(V(m)))){constructor(){super(...arguments),this.type="building-component-sublayer-3d",this.layerView=null,this._elevationContext="scene",this._isIntegratedMesh=!1,this._supportsLabeling=!1,this.requiredFields=[],this.progressiveLoadFactor=1,this._queryEngine=null}get i3slayer(){return this.sublayer}get layerUid(){return this.sublayer.layer.uid}get sublayerUid(){return this.sublayer.uid}get layerId(){return this.sublayer.layer.id}get sublayerId(){return this.sublayer.id}get layerPopupEnabledAndHasTemplate(){return this.sublayer.popupEnabled&&ue(this.sublayer,this.layerView?.view.popup?.defaultPopupTemplateEnabled)}initialize(){this._updatingHandles.add(()=>this.mergedFilter,r=>{r!=null&&S.checkSupport(r)?this._i3sFilter==null?this._i3sFilter=new S({viewFilter:r,layerFieldsIndex:this.sublayer.fieldsIndex,loadAsyncModule:t=>this._loadAsyncModule(t),addSqlFilter:(t,i)=>this.addSqlFilter(t,i,this.logError),addTimeFilter:(t,i)=>this.addTimeFilter(t,i)}):this._i3sFilter.viewFilter=r:this._i3sFilter=B(this._i3sFilter)},w),this._updatingHandles.add(()=>[this.sublayer.renderer,this.definitionExpressionFields,this.filterExpressionFields],()=>this._updateRequiredFields()),this._updatingHandles.add(()=>this.sublayer.renderer,r=>this._rendererChange(r),R);let e=()=>this._filterChange();this._updatingHandles.add(()=>this.parsedDefinitionExpression,e),this._updatingHandles.add(()=>this._i3sFilter?.sortedObjectIds,e),this._updatingHandles.add(()=>this._i3sFilter?.parsedWhereClause,e),this._updatingHandles.add(()=>this.getTimeFilterDependencies(),e),this._updatingHandles.add(()=>this.mergedFilter,e),this._updatingHandles.add(()=>[this._i3sFilter?.parsedGeometry,this.filter?.spatialRelationship],()=>this._geometryFilterChange()),this._updatingHandles.add(()=>this.parsedFilterExpressions,()=>this._updateSymbologyOverride(),R),this.addResolvingPromise(this._updateRequiredFields())}get lodFactor(){return this.view.qualitySettings.sceneService.object.lodFactor}get parsedFilterExpressions(){return this.sublayer.modelName!=="Overview"&&this.layerView?this.layerView.filterExpressions.map(([e,r])=>{let t;try{t=$.create(e,{fieldsIndex:this.sublayer.fieldsIndex})}catch(n){return c.getLogger(this).error("Failed to parse filterExpression: "+n),null}if(!t.isStandardized)return c.getLogger(this).error("filterExpression is using non standard function"),null;let i=[],s=t.fieldNames;return se(s,this.sublayer.fields,{missingFields:i}),i.length>0?(c.getLogger(this).error(`filterExpression references unknown fields: ${i.join(", ")}`),null):[t,r]}).filter(e=>e!=null):[]}get filter(){return this._get("filter")}set filter(e){this._set("filter",S.checkSupport(e)?e:null)}isUpdating(){return super.isUpdating()||(this._i3sFilter?.updating??!1)}_updateSymbologyOverride(){let e=this.parsedFilterExpressions;e.length>0?this._setSymbologyOverride((r,t)=>{for(let[i,s]of e)try{if(i.testFeature(r))return q(t,s)}catch(n){this.logError(n)}return q(t,null)},this.filterExpressionFields):this._setSymbologyOverride(null,null)}get filterExpressionFields(){return v(this.sublayer.fieldsIndex,this.parsedFilterExpressions.reduce((e,[r])=>e.concat(r.fieldNames),new Array))}get availableFields(){let e=this.sublayer,r=e.fieldsIndex,t=this.requiredFields;if(e.outFields||e.layer.outFields){let i=[...e.outFields||[],...e.layer.outFields||[]];t=[...A(r,i),...t]}return v(r,t)}_createLayerGraphic(e){return new ee({attributes:e,layer:this.sublayer.layer,sourceLayer:this.sublayer})}canResume(){return super.canResume()&&E(this.i3slayer.effectiveScaleRange,this.view.scale)&&(!this._controller||this._controller.rootNodeVisible)}fetchPopupFeaturesFromGraphics(e,r){return f(this,null,function*(){let t=this._validateFetchPopupFeatures(r);if(t)throw t;if(e.length===0)return[];let i=[],s=[],n=this.sublayer.associatedLayer!=null?yield this.sublayer.associatedLayer.load(r):this.sublayer,l=A(this.sublayer.fieldsIndex,yield le(n,Q(this.sublayer,r)));F(r);let u=new Set;for(let y of e)ne(l,y,u)?s.push(y):i.push(y);return s.length===0?i:(this.sublayer.associatedLayer!=null&&(yield this.sublayer.associatedLayer.load().catch(()=>c.getLogger(this).warn("Failed to load associated feature layer. Displaying popup attributes from cached attributes."))),this.whenGraphicAttributes(s,Array.from(u)).catch(y=>(N(y),s)).then(y=>i.concat(y)))})}_updateRequiredFields(){return f(this,null,function*(){let e=v(this.sublayer.fieldsIndex,[...this.sublayer.renderer?yield this.sublayer.renderer.getRequiredFields(this.sublayer.fieldsIndex):[],...this.definitionExpressionFields,...this.filterExpressionFields]);this._set("requiredFields",e)})}_validateFetchPopupFeatures(e){let{sublayer:r}=this,{popupEnabled:t}=r;return t?Q(r,e)?void 0:new I("buildingscenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{sublayer:r}):new I("buildingscenelayerview3d:fetchPopupFeatures","Popups are disabled",{sublayer:r})}getFilters(){let e=super.getFilters();return this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),this._i3sFilter?.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}createQuery(){let e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return this.filter!=null?this.filter.createQuery(e):new L(e)}queryExtent(e,r){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),r?.signal)}queryFeatureCount(e,r){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),r?.signal)}queryFeatures(e,r){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),r?.signal).then(t=>{if(!t?.features)return t;let i=this.sublayer,s=i.layer;for(let n of t.features)n.layer=s,n.sourceLayer=i;return t})}queryObjectIds(e,r){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),r?.signal)}_ensureQueryEngine(){return this._queryEngine==null&&(this._queryEngine=this._createQueryEngine()),this._queryEngine}_createQueryEngine(){let e=me(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new be({layerView:this,priority:Z.FEATURE_QUERY_ENGINE,spatialIndex:new Fe({featureAdapter:new we({objectIdField:this.sublayer.objectIdField,attributeStorageInfo:this.sublayer.attributeStorageInfo,getFeatureExtent:e}),forAllFeatures:(r,t)=>this._forAllFeatures((i,s,n)=>r({id:i,index:s,meta:n}),t,fe.QUERYABLE),getFeatureExtent:e,sourceSpatialReference:oe(this.sublayer),viewSpatialReference:this.view.spatialReference})})}_ensureQuery(e){return this._addDefinitionExpressionToQuery(e==null?this.createQuery():L.from(e))}};o([a()],p.prototype,"i3slayer",null),o([a()],p.prototype,"layerView",void 0),o([a()],p.prototype,"lodFactor",null),o([a({readOnly:!0})],p.prototype,"parsedFilterExpressions",null),o([a({type:re})],p.prototype,"filter",null),o([a()],p.prototype,"_i3sFilter",void 0),o([a({type:[String],readOnly:!0})],p.prototype,"filterExpressionFields",null),o([a({type:[String],readOnly:!0})],p.prototype,"requiredFields",void 0),o([a({type:[String],readOnly:!0})],p.prototype,"availableFields",null),p=o([g("esri.views.3d.layers.BuildingComponentSublayerView3D")],p);var Se=p;var b=class extends pe{constructor(r){super(r),this.layer=null,this.sublayerViews=null}highlight(r){throw new Error("Not implemented")}};o([a()],b.prototype,"layer",void 0),o([a()],b.prototype,"sublayerViews",void 0);var Ce=V(_),d=class extends he(b){constructor(e){super(e),this.type="building-scene-3d",this.sublayerViews=new z,this._abortController=new AbortController,this._loadingComponents=0,this._pendingWhenSublayerViews=new Map,this.ignoresMemoryFactor=!1}get filterExpression(){let e=this.layer.activeFilterId,r=e!=null?this.layer.filters.find(i=>i.id===e):null,t=r!=null?r.filterBlocks?.find(i=>i.filterMode.type==="solid"):null;return t?t.filterExpression:null}get filterExpressions(){let e=this.layer.activeFilterId,r=e!=null?this.layer.filters.find(t=>t.id===e):null;return r?.filterBlocks?r.filterBlocks.toArray().map(t=>[t.filterExpression??"",xe(t)]):[]}get updatingProgressValue(){let e=this.sublayerViews,r=this._loadingComponents+(e?e.length:0);return e.reduce((t,i)=>t+i.updatingProgress,0)/r}get visibleAtCurrentScale(){return E(this.layer.effectiveScaleRange,this.view.scale)}isUpdating(){return this._loadingComponents>0||this.sublayerViews&&this.sublayerViews.some(e=>e.updating)}initialize(){ae(this.layer.spatialReference,this.view.spatialReference,this.view.viewingMode),this._initializeSubLayerViews(this.layer.sublayers,this)}destroy(){this.sublayerViews&&(this.sublayerViews.forEach(e=>e.destroy()),this.sublayerViews=null),this._abortController=T(this._abortController)}_initializeSubLayerViews(e,r){let t=this,i=this.view;e.forEach(s=>{if(!s.isEmpty)if(s.type==="building-group"){let n=new Ce({sublayer:s,view:i,parent:r});this._initializeSubLayerViews(s.sublayers,n)}else s.geometryType==="mesh"&&(this._loadingComponents++,s.load({signal:this._abortController.signal}).then(()=>{let n=new Se({sublayer:s,layerView:t,view:i,parent:r});this.sublayerViews.push(n);let l=this._pendingWhenSublayerViews.get(s);if(l){for(let u of l)u.resolve(n);this._pendingWhenSublayerViews.delete(s)}this.addHandles([C(()=>n.updating,()=>this.notifyChange("updating"),w),C(()=>n.updatingProgress,()=>this.notifyChange("updatingProgressValue"),w)])}).catch(n=>{D(n)||c.getLogger(this).error(`Error while creating view for sublayer ${s.id}
Layer: ${this.layer.url}
`,n)}).then(()=>{this._loadingComponents--,this.notifyChange("updating"),this.notifyChange("updatingProgressValue")}))})}getGraphicFromIntersectorTarget(e){for(let r of this.sublayerViews.items)if(r.sublayer.uid===e.sublayerUid)return r.getGraphicFromIntersectorTarget(e);return null}fetchPopupFeaturesFromGraphics(e,r){return f(this,null,function*(){if(e.length===0)return[];let t=Re(e,n=>n.sourceLayer),i=[];for(let[n,l]of t){let u=this._findComponent(n);u!=null&&i.push(u.fetchPopupFeaturesFromGraphics(l,r))}let s=yield G(i);return F(r),s.flat()})}whenGraphicBounds(e){let r=this._findComponent(e.sourceLayer);return r==null?Promise.reject():r.whenGraphicBounds(e)}getAABBFromIntersectorTarget(e){for(let r of this.sublayerViews.items)if(r.sublayer.uid===e.sublayerUid)return r.getAABBFromIntersectorTarget(e);return null}whenSublayerView(e){return f(this,null,function*(){let r=this._findComponent(e);if(r!=null)return r;let t=this._pendingWhenSublayerViews.get(e),i=U();return t?t.push(i):this._pendingWhenSublayerViews.set(e,[i]),i.promise})}_findComponent(e){return this.sublayerViews.find(r=>e===r.sublayer)}highlight(e,r){if(J(e))return x;let t=de(e);if(t.length===0)return x;if(Y(t[0])){let i=t,s=new Map;for(let l of i)k(s,l.sourceLayer,()=>[]).push(l);let n=[];return this.sublayerViews.forEach(l=>{let u=s.get(l.sublayer);u&&n.push(l.highlight(u,r))}),H(n)}return x}get usedMemory(){return this.sublayerViews.reduce((e,r)=>e+r.usedMemory,0)}get unloadedMemory(){return this.sublayerViews.reduce((e,r)=>e+r.unloadedMemory,0)}get performanceInfo(){return new ye(this.usedMemory)}};function Re(e,r){let t=new Map,i=e.length;for(let s=0;s<i;s++){let n=e[s],l=r(n,s,e),u=t.get(l);u?u.push(n):t.set(l,[n])}return t}o([a()],d.prototype,"sublayerViews",void 0),o([a({readOnly:!0})],d.prototype,"filterExpression",null),o([a({readOnly:!0})],d.prototype,"filterExpressions",null),o([a(ce)],d.prototype,"updatingProgress",void 0),o([a({readOnly:!0,dependsOn:[]})],d.prototype,"updatingProgressValue",null),o([a({readOnly:!0})],d.prototype,"visibleAtCurrentScale",null),d=o([g("esri.views.3d.layers.BuildingSceneLayerView3D")],d);var _t=d;export{_t as default};
