import{b as Ct}from"./chunk-ELOFFQD3.js";import{c as Ie,d as At,e as bt}from"./chunk-JGPFCHHF.js";import{a as U}from"./chunk-VQ5WF3XI.js";import{a as V}from"./chunk-TGSQQX44.js";import{a as K}from"./chunk-WPTVLDNN.js";import{a as P,b as x,c as Ce,d as Oe,e as Te,f as je,k as Ee,l as Le,n as ze,o as me,p as St}from"./chunk-YNNF4FWO.js";import{a as Ue,d as Ve,e as Pt,g as Ge}from"./chunk-IZRBPB5G.js";import{a as Mt}from"./chunk-ILCAH2F6.js";import{a as Rt,d as Ft}from"./chunk-CYCLIMTY.js";import{b as Be,g as wt}from"./chunk-LCTRO7CL.js";import{a as b}from"./chunk-7X2HMUNN.js";import{b as j,c as Pe,d as yt,e as H}from"./chunk-LW2464MZ.js";import{a as $,b as pe}from"./chunk-WJDHM47L.js";import{d as Z}from"./chunk-LWJTIQQT.js";import{b as Me}from"./chunk-IHBD2IWR.js";import{a as vt}from"./chunk-NH3JQE75.js";import{a as I}from"./chunk-XXOIKNT6.js";import{a as Fe}from"./chunk-DBLGLVAQ.js";import{b as st}from"./chunk-EN6CTWVM.js";import{P as pt,a as it,d as ct,f as ie,h as lt,i as De}from"./chunk-EPTSNNZF.js";import{r as ft}from"./chunk-FW33MEBA.js";import{p as mt}from"./chunk-AOA5JMXK.js";import{c as ce,d as ut,e as ht,n as dt,t as Re,u as gt,y as xt,z as le}from"./chunk-2HUIJUS4.js";import{a as Qe,c as Xe}from"./chunk-MBJHSEMD.js";import{g as ye,i as we,p as at,t as Se,u as Ae,x as be}from"./chunk-5MNDZ6BX.js";import{o as ot}from"./chunk-T7BKG6V3.js";import{a as v,c as se,i as W,j as nt}from"./chunk-PYQRTZNZ.js";import{c as Je}from"./chunk-VQHENXDQ.js";import{a as et}from"./chunk-BRVOQZDM.js";import{a as Ye}from"./chunk-TBYT66N3.js";import{a as tt,l as S,y as rt}from"./chunk-N27U3N2T.js";import{K as Ke,u as He}from"./chunk-4M6XQSBA.js";import{Q as g,a as ke,d as qe}from"./chunk-GGZQ5GCM.js";import{U as ve}from"./chunk-TFUPB3ZG.js";import{a as h}from"./chunk-BMVJCP2M.js";import{k as We,l as q,n as $e,s as xe,x as Ze}from"./chunk-GMC3I5VG.js";import{r as L,t as z}from"./chunk-3IBUFXWY.js";import{a as ae,b as ge,g as O}from"./chunk-JEGVIFEP.js";var Ot="Mesh must be loaded before applying operations",Tt="Provided component is not part of the list of components",jt="Expected polygon to be a Polygon instance",Y="Expected location to be a Point instance",fe=class extends z{constructor(){super("invalid-input:location",Y)}};function J(e,t,o,r){if(r!==void 0){qe(e(),"option: geographic",{replacement:"Use mesh `vertexSpace` and spatial reference to control how operations are performed instead.",version:"4.30",warnOnce:!0});let n=t.type==="local";if(!j(t)||r===n)return o.isGeographic||o.isWebMercator&&r;e().warnOnce(`Specifying the 'geographic' parameter (${r}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}switch(t.type){case"georeferenced":return o.isGeographic;case"local":return o.isGeographic||o.isWebMercator}}var ue=()=>L.getLogger("esri.geometry.support.meshUtils.centerAt");function Et(e,t,o){if(!e.vertexAttributes?.position)return;let{vertexSpace:r}=e,n=o?.origin??e.origin,a=J(ue,r,n.spatialReference,o?.geographic);j(r)?cr(e,t,n):a?lr(e,t,n):pr(e,t,n)}function cr(e,t,o){let{vertexSpace:r}=e;if(!j(r))return;let n=zt,a=Lt;if(!b(t,a,e.spatialReference))return void x(ue(),t.spatialReference,e.spatialReference,P);if(!b(o,n,e.spatialReference)){let i=e.origin;return n[0]=i.x,n[1]=i.y,n[2]=i.z,void x(ue(),o.spatialReference,e.spatialReference,P)}let s=ht(fr,a,n);r.origin=ut(v(),r.origin,s)}function lr(e,t,o){let r=se(o.x,o.y,o.z??0),n=me(e,new pe({origin:r}));if(!n)return;let a=se(t.x,t.y,t.z??0),s=me({vertexAttributes:n,spatialReference:e.spatialReference,vertexSpace:new pe({origin:a})},$.absolute);if(!s)return;let{position:i,normal:c,tangent:p}=s;e.vertexAttributes.position=i,e.vertexAttributes.normal=c,e.vertexAttributes.tangent=p,e.vertexAttributesChanged()}function pr(e,t,o){let r=zt,n=Lt;if(b(t,n,e.spatialReference)){if(!b(o,r,e.spatialReference)){let a=e.origin;return r[0]=a.x,r[1]=a.y,r[2]=a.z,void x(ue(),o.spatialReference,e.spatialReference,P)}mr(e.vertexAttributes.position,n,r),e.vertexAttributesChanged()}else x(ue(),t.spatialReference,e.spatialReference,P)}function mr(e,t,o){if(e)for(let r=0;r<e.length;r+=3)for(let n=0;n<3;n++)e[r+n]+=t[n]-o[n]}var Lt=v(),zt=v(),fr=v();function Vt(e){let{spatialReference:t,vertexSpace:o,untransformedBounds:r}=e,n=lt(r,ur);if(j(o)&&e.transform&&Be(n,n,e.transform.localMatrix),o.type==="georeferenced"){let i=o.origin;return i&&wt(n,n,i),De(ie(n),t)}let a=Z(t),s=o.origin;if(!ft(a,t)){let[i,c,p]=s;return new rt({xmin:i,ymin:c,zmin:p,xmax:i,ymax:c,zmax:p,spatialReference:t})}return Me(t,s,Ut,a),Be(n,n,Ut),mt(n,a,0,n,t,0),De(ie(n),t)}var Ut=I(),ur=it(24);function Dt(e,t,o){return O(this,null,function*(){let{source:r}=t,{loadGLTFMesh:n}=yield xe(import("./chunk-S3DZJEGU.js"),o),a=yield dr(r,o);q(o);let s=n(new S({x:0,y:0,z:0,spatialReference:e.spatialReference}),a.url,{resolveFile:hr(a),signal:o?.signal,expectedType:a.type,unitConversionDisabled:t.unitConversionDisabled});s.then(()=>a.dispose(),()=>a.dispose());let{vertexAttributes:i,components:c}=yield s;e.vertexAttributes=i,e.components=c})}function hr(e){let t=Ke(e.url);return o=>{let r=He(o,t,t),n=r?r.replace(/^ *\.\//,""):null;return(n?e.files.get(n):null)??o}}function dr(e,t){return O(this,null,function*(){if(Array.isArray(e)){if(!e.length)throw new z("mesh-load-external:missing-assets","There must be at least one file to load");return e[0]instanceof File?xr(e):vr(e,t)}return Bt(e)})}function gr(e,t){return O(this,null,function*(){let{parts:o,assetMimeType:r,assetName:n}=e;if(o.length===1)return new Q(o[0].partUrl);let a=yield e.toBlob(t);return q(t),Q.fromBlob(a,kt(n,r))})}function Bt(e){return Q.fromBlob(e,kt(e.name,e.type))}function xr(e){return Nt(e.map(t=>({name:t.name,mimeType:t.type,source:Bt(t)})))}function vr(e,t){return O(this,null,function*(){let o=yield Ze(e.map(r=>O(this,null,function*(){let n=yield gr(r);return q(t),{name:r.assetName,mimeType:r.assetMimeType,source:n}})));if($e(t))throw o.forEach(r=>r.source.dispose()),We();return Nt(o)})}var It=/^model\/gltf\+json$/,Gt=/^model\/gltf-binary$/,Ne=/\.gltf$/i,yr=/\.glb$/i;function _t({mimeType:e,source:t,name:o}){return It.test(e)||Ne.test(o)?{url:t.url,type:"gltf"}:Gt.test(e)||yr.test(o)?{url:t.url,type:"glb"}:null}function Nt(e){let t=new Map,o=null,r=null;for(let a of e){let{source:s,name:i}=a;o??=_t(a),i==="ESRI3DO_NORM.glb"&&(r=_t(a)),t.set(i,s.url),s.files.forEach((c,p)=>t.set(p,c))}let n=r??o;if(n==null)throw new z("mesh-load-external:missing-files","Missing files to load external mesh source");return new Q(n.url,()=>e.forEach(({source:a})=>a.dispose()),t,n.type)}var Q=class e{constructor(t,o=()=>{},r=new Map,n){this.url=t,this.dispose=o,this.files=r,this.type=n}static fromBlob(t,o){let r=URL.createObjectURL(t);return new e(r,()=>URL.revokeObjectURL(r),void 0,o)}};function kt(e,t){return It.test(t)||Ne.test(e)?"gltf":Gt.test(t)||Ne.test(e)?"glb":void 0}var C=class extends st{constructor(e){super(e),this.externalSources=new Je,this._explicitDisplaySource=null,this.georeferenced=!1,this.addHandles(Xe(()=>this.externalSources,"after-remove",({item:t})=>{t===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(e){if(e!=null&&!Ie(e))throw new Error("Cannot use this source for display: it is not in a supported format.");this._explicitDisplaySource=e,e&&this.externalSources.every(t=>!bt(t,e))&&this.externalSources.add(e)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(e){return this.externalSources.items.filter(t=>At(t,e))}get _implicitDisplaySource(){return this.externalSources.find(Ie)}};h([g()],C.prototype,"externalSources",void 0),h([g()],C.prototype,"displaySource",null),h([g()],C.prototype,"_implicitDisplaySource",null),h([g()],C.prototype,"_explicitDisplaySource",void 0),h([g()],C.prototype,"georeferenced",void 0),C=h([ve("esri.geometry.support.meshUtils.Metadata")],C);function qt(){let{faceDescriptions:e,faceVertexOffsets:t,uvScales:o}=br,r=4*e.length,n=new Float64Array(3*r),a=new Float32Array(3*r),s=new Float32Array(2*r),i=new Uint32Array(2*e.length*3),c=0,p=0,l=0,f=0;for(let u=0;u<e.length;u++){let m=e[u],y=c/3;for(let R of t)i[f++]=y+R;let D=m.corners;for(let R=0;R<4;R++){let B=D[R],A=0;s[l++]=.25*o[R][0]+m.uvOrigin[0],s[l++]=m.uvOrigin[1]-.25*o[R][1];for(let M=0;M<3;M++)m.axis[M]!==0?(n[c++]=.5*m.axis[M],a[p++]=m.axis[M]):(n[c++]=.5*B[A++],a[p++]=0)}}return{position:n,normal:a,uv:s,faces:i}}function Wt(e,t){let o=e.components[0],r=o.faces,n=Rr[t],a=6*n,s=new Array(6),i=new Array(r.length-6),c=0,p=0;for(let l=0;l<r.length;l++)l>=a&&l<a+6?s[c++]=r[l]:i[p++]=r[l];if(e.vertexAttributes.uv!=null){let l=new Float32Array(e.vertexAttributes.uv),f=4*n*2,u=[0,1,1,1,1,0,0,0];for(let m=0;m<u.length;m++)l[f+m]=u[m];e.vertexAttributes.uv=l}return e.components=[new V({faces:s,material:o.material}),new V({faces:i})],e}function $t(e=0){let t=Math.round(8*2**e),o=2*t,r=(t-1)*(o+1)+2*o,n=new Float64Array(3*r),a=new Float32Array(3*r),s=new Float32Array(2*r),i=new Uint32Array(3*((t-1)*o*2)),c=0,p=0,l=0,f=0;for(let u=0;u<=t;u++){let m=u/t*Math.PI+.5*Math.PI,y=Math.cos(m),D=Math.sin(m);d[2]=D;let R=u===0||u===t,B=R?o-1:o;for(let A=0;A<=B;A++){let M=A/B*2*Math.PI;d[0]=-Math.sin(M)*y,d[1]=Math.cos(M)*y;for(let E=0;E<3;E++)n[c]=.5*d[E],a[c]=d[E],++c;s[p++]=(A+(R?.5:0))/o,s[p++]=u/t,u!==0&&A!==o&&(u!==t&&(i[l++]=f,i[l++]=f+1,i[l++]=f-o),u!==1&&(i[l++]=f,i[l++]=f-o,i[l++]=f-o-1)),f++}}return{position:n,normal:a,uv:s,faces:i}}function Zt(e=0){let o=Math.round(16*2**e),r=4*(o+1)+2*o,n=new Float64Array(3*r),a=new Float32Array(3*r),s=new Float32Array(2*r),i=new Uint32Array(3*(4*o)),c=0,p=0,l=0,f=0,u=0;for(let m=0;m<=5;m++){let y=m===0||m===5,D=m<=1||m>=4,R=m===2||m===4,B=y?o-1:o;for(let A=0;A<=B;A++){let M=A/B*2*Math.PI,E=y?0:.5;d[0]=E*Math.sin(M),d[1]=E*-Math.cos(M),d[2]=m<=2?.5:-.5;for(let k=0;k<3;k++)n[c++]=d[k],a[p++]=D?k===2?m<=1?1:-1:0:k===2?0:d[k]/E;s[l++]=(A+(y?.5:0))/o,s[l++]=m<=1?1*m/3:m<=3?1*(m-2)/3+1/3:1*(m-4)/3+2/3,R||m===0||A===o||(m!==5&&(i[f++]=u,i[f++]=u+1,i[f++]=u-o),m!==1&&(i[f++]=u,i[f++]=u-o,i[f++]=u-o-1)),u++}}return{position:n,normal:a,uv:s,faces:i}}function Ht(e,t){let o=typeof t=="number"?t:t!=null?t.width:1,r=typeof t=="number"?t:t!=null?t.height:1;switch(e){case"up":case"down":return{width:o,depth:r};case"north":case"south":return{width:o,height:r};case"east":case"west":return{depth:o,height:r}}}function Kt(e){let t=he.facingAxisOrderSwap[e],o=he.position,r=he.normal,n=new Float64Array(o.length),a=new Float32Array(r.length),s=0;for(let i=0;i<4;i++){let c=s;for(let p=0;p<3;p++){let l=t[p],f=Math.abs(l)-1,u=l>=0?1:-1;n[s]=o[c+f]*u,a[s]=r[c+f]*u,s++}}return{position:n,normal:a,uv:new Float32Array(he.uv),faces:new Uint32Array(he.faces),isPlane:!0}}var X=1,ee=2,te=3,he={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[te,X,ee],west:[-te,-X,ee],north:[-X,te,ee],south:[X,-te,ee],up:[X,ee,te],down:[X,-ee,-te]}};function de(e,t,o){e.isPlane||wr(e),Ar(e,Sr(o?.size,o?.unit,t.spatialReference));let r=H(t,o),n=t.spatialReference.isGeographic?H(t):r,a=me({vertexAttributes:e,vertexSpace:n,spatialReference:t.spatialReference},r,{allowBufferReuse:!0});return{vertexAttributes:new K(ge(ae({},a),{uv:e.uv})),vertexSpace:r,components:[new V({faces:e.faces,material:o?.material||null})],spatialReference:t.spatialReference}}function wr(e){for(let t=0;t<e.position.length;t+=3)e.position[t+2]+=.5}function Sr(e,t,o){let r=St(t,o);if(e==null&&r===1)return null;if(e==null)return[r,r,r];if(typeof e=="number"){let n=e*r;return[n,n,n]}return[e.width!=null?e.width*r:r,e.depth!=null?e.depth*r:r,e.height!=null?e.height*r:r]}function Ar(e,t){if(t!=null){_[0]=t[0],_[4]=t[1],_[8]=t[2];for(let o=0;o<e.position.length;o+=3){for(let r=0;r<3;r++)d[r]=e.position[o+r];le(d,d,_);for(let r=0;r<3;r++)e.position[o+r]=d[r]}if(t[0]!==t[1]||t[1]!==t[2]){_[0]=1/t[0],_[4]=1/t[1],_[8]=1/t[2];for(let o=0;o<e.normal.length;o+=3){for(let r=0;r<3;r++)d[r]=e.normal[o+r];le(d,d,_),gt(d,d);for(let r=0;r<3;r++)e.normal[o+r]=d[r]}}}}var br={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},Rr={south:0,east:1,north:2,west:3,up:4,down:5},d=v(),_=Fe();var G=()=>L.getLogger("esri.geometry.support.meshUtils.rotate");function er(e,t,o){if(!e.vertexAttributes?.position||t[3]===0)return;let{spatialReference:r,vertexSpace:n}=e,a=o?.origin??e.origin,s=o?.geographic,i=J(G,n,r,s);Pe(e)?Fr(e,t,a):i?Mr(e,t,a):Pr(e,t,a)}function Fr(e,t,o){e.transform??=new U;let{vertexSpace:r,transform:n,spatialReference:a}=e,[s,i,c]=r.origin,p=new S({x:s,y:i,z:c,spatialReference:a}),l=re;if(p.equals(o))ce(l,0,0,0);else if(!ze(l,o,e))return void x(G(),o.spatialReference,a,P);Mt(Xt,t,Ge(t));let f=be(Yt,Xt,W,nt,l),{localMatrix:u}=n,m=ye(Yt,f,u);n.scale=Ae(v(),m),we(m,m,Re(re,n.scale));let y=n.rotationAxis;n.rotation=Ve(m),n.rotationAngle===0&&(n.rotationAxis=y),n.translation=Se(v(),m)}function Mr(e,t,o){let r=e.spatialReference,n=Z(r),a=tr;if(!b(o,a,n)&&(x(G(),o.spatialReference,n,"Falling back to mesh origin"),!b(e.origin,a,n)))return void x(G(),e.origin.spatialReference,n);let s=e.vertexAttributes.position,i=e.vertexAttributes.normal,c=e.vertexAttributes.tangent,p=new Float64Array(s.length),l=i!=null?new Float32Array(i.length):null,f=c!=null?new Float32Array(c.length):null;Me(n,a,_e,n),vt(Qt,_e);let u=Jt;le(Jt,t,Qt),u[3]=t[3],Te(s,r,p,n)&&(i==null||l==null||Ce(i,s,r,p,n,l))&&(c==null||f==null||Ee(c,s,r,p,n,f))?(oe(p,u,3,a),je(p,n,s,r)&&(i==null||l==null||(oe(l,u,3),Oe(l,s,r,p,n,i)))&&(c==null||f==null||(oe(f,u,4),Le(f,s,r,p,n,c)))?e.vertexAttributesChanged():x(G(),n,r)):x(G(),r,n)}function Pr(e,t,o){let r=tr;if(!b(o,r,e.spatialReference)){let n=e.origin;return r[0]=n.x,r[1]=n.y,r[2]=n.z,void x(G(),o.spatialReference,e.spatialReference,P)}oe(e.vertexAttributes.position,t,3,r),oe(e.vertexAttributes.normal,t,3),oe(e.vertexAttributes.tangent,t,4),e.vertexAttributesChanged()}function oe(e,t,o,r=W){if(e!=null){at(_e,Ge(t),t);for(let n=0;n<e.length;n+=o){for(let a=0;a<3;a++)re[a]=e[n+a]-r[a];xt(re,re,_e);for(let a=0;a<3;a++)e[n+a]=re[a]+r[a]}}}var re=v(),Yt=I(),Jt=Ue(),_e=I(),Qt=Fe(),tr=v(),Xt=Rt();var N=()=>L.getLogger("esri.geometry.support.meshUtils.scale");function or(e,t,o){if(!e.vertexAttributes?.position)return;let{vertexSpace:r,spatialReference:n}=e,a=o?.origin??e.origin,s=o?.geographic,i=J(N,r,n,s);Pe(e)?Cr(e,t,a):i?Or(e,t,a):Tr(e,t,a)}function Cr(e,t,o){e.transform??=new U;let{vertexSpace:r,transform:n,spatialReference:a}=e,[s,i,c]=r.origin,p=new S({x:s,y:i,z:c,spatialReference:a}),l=ne;if(p.equals(o))ce(l,0,0,0);else if(!ze(l,o,e))return void x(N(),o.spatialReference,a,P);let f=ce(jr,t,t,t),u=be(rr,Ft,W,f,l),{localMatrix:m}=n,y=ye(rr,u,m);n.scale=Ae(v(),y),we(y,y,Re(ne,n.scale));let D=n.rotationAxis;n.rotation=Ve(y),n.rotationAngle===0&&(n.rotationAxis=D),n.translation=Se(v(),y)}function Or(e,t,o){let r=e.spatialReference,n=Z(r),a=ar;if(!b(o,a,n)&&(x(N(),o.spatialReference,n,"Falling back to mesh origin"),!b(e.origin,a,n)))return void x(N(),e.origin.spatialReference,n);let s=e.vertexAttributes.position,i=e.vertexAttributes.normal,c=e.vertexAttributes.tangent,p=new Float64Array(s.length),l=i!=null?new Float32Array(i.length):null,f=c!=null?new Float32Array(c.length):null;Te(s,r,p,n)&&(i==null||l==null||Ce(i,s,r,p,n,l))&&(c==null||f==null||Ee(c,s,r,p,n,f))?(nr(p,t,a),je(p,n,s,r)&&(i==null||l==null||Oe(l,s,r,p,n,i))&&(c==null||f==null||Le(f,s,r,p,n,c))?e.vertexAttributesChanged():x(N(),n,r)):x(N(),r,n)}function Tr(e,t,o){let r=ar;if(!b(o,r,e.spatialReference)){let n=e.origin;return r[0]=n.x,r[1]=n.y,r[2]=n.z,void x(N(),o.spatialReference,e.spatialReference,P)}nr(e.vertexAttributes.position,t,r),e.vertexAttributesChanged()}function nr(e,t,o=W){if(e)for(let r=0;r<e.length;r+=3){for(let n=0;n<3;n++)ne[n]=e[r+n]-o[n];dt(ne,ne,t);for(let n=0;n<3;n++)e[r+n]=ne[n]+o[n]}}var ne=v(),jr=v(),rr=I(),ar=v();var F,ir="esri.geometry.Mesh";function T(){return L.getLogger(ir)}var Er={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:$,local:pe}},w=F=class extends et.LoadableMixin(Ye(tt)){constructor(e){super(e),this.components=null,this.vertexSpace=new $,this.transform=null,this.metadata=new C,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new K,this.type="mesh"}initialize(){(this.metadata.externalSources.length===0||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.addHandles(Qe(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(e=>e.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){return this.loaded?this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0):this.metadata.displaySource?.extent!=null}get _transformedExtent(){let{spatialReference:e,vertexSpace:t}=this,o=this;return Vt({get transform(){return o.transform},vertexSpace:t,spatialReference:e,untransformedBounds:this._untransformedBounds})}get _untransformedBounds(){let{vertexAttributes:{position:e},components:t}=this;return e.length===0||t?.length===0?ct(pt):ie(e)}get origin(){let e=yt(this.vertexSpace,this.spatialReference);if(e!=null)return e;let{center:t,zmin:o}=this._transformedExtent;return new S({x:t.x,y:t.y,z:o,spatialReference:this.spatialReference})}get extent(){return this.loaded||this.metadata?.displaySource?.extent==null?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(e){this._checkIfLoaded("addComponent()")&&(this.components||(this.components=[]),this.components.push(V.from(e)),this.notifyChange("components"))}removeComponent(e){if(this._checkIfLoaded("removeComponent()")){if(this.components){let t=this.components.indexOf(e);if(t!==-1)return this.components.splice(t,1),void this.notifyChange("components")}T().error("removeComponent()",Tt)}}rotate(e,t,o,r){return Pt(e,t,o,sr),er(this,sr,r),this}offset(e,t,o){if(!this._checkIfLoaded("offset()"))return this;let{vertexSpace:r,vertexAttributes:n}=this,a=n?.position;if(!a)return this;if(j(r)){let[s,i,c]=r.origin;r.origin=se(s+e,i+t,c+o)}else{for(let s=0;s<a.length;s+=3)a[s]+=e,a[s+1]+=t,a[s+2]+=o;this.vertexAttributesChanged()}return this}scale(e,t){return this._checkIfLoaded("scale()")?(or(this,e,t),this):this}centerAt(e,t){return this._checkIfLoaded("centerAt()")?(Et(this,e,t),this):this}load(e){let{metadata:{displaySource:t}}=this;return t&&this.addResolvingPromise(Dt(this,t,e)),Promise.resolve(this)}addExternalSources(e){this.metadata.externalSources.addMany(e)}updateDisplaySource(e){this.metadata.displaySource=e}clone(){return this.cloneAndModifyVertexAttributes(this.vertexAttributes.clone(),this.vertexSpace.clone(),{preserveMetadata:!0})}cloneAndModifyVertexAttributes(e,t,o){let r=null;if(this.components){let a=new Map,s=new Map;r=this.components.map(i=>i.cloneWithDeduplication(a,s))}let n={components:r,spatialReference:this.spatialReference,vertexAttributes:e,vertexSpace:t,transform:this.transform?.clone()??null,metadata:o?.preserveMetadata?this.metadata.clone():new C};return new F(n)}cloneShallow(){return new F({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}toBinaryGLTF(e){return O(this,null,function*(){let[{toBinaryGLTF:t}]=yield Promise.all([import("./chunk-ORDYAXVM.js"),this.load(e)]);return q(e),yield t(this,e)})}get memoryUsage(){let e=0;if(e+=this.vertexAttributes.memoryUsage,this.components!=null)for(let t of this.components)e+=t.memoryUsage;return e}_clearSources(){this.metadata.clearSources()}_checkIfLoaded(e){return!!this.loaded||(T().error(e,Ot),!1)}static createBox(e,t){if(!(e instanceof S))return T().error(".createBox()",Y),null;let o=new F(de(qt(),e,t));return t?.imageFace&&t.imageFace!=="all"?Wt(o,t.imageFace):o}static createSphere(e,t){return e instanceof S?new F(de($t(t?.densificationFactor||0),e,t)):(T().error(".createSphere()",Y),null)}static createCylinder(e,t){return e instanceof S?new F(de(Zt(t?.densificationFactor||0),e,t)):(T().error(".createCylinder()",Y),null)}static createPlane(e,t){if(!(e instanceof S))return T().error(".createPlane()",Y),null;let o=t?.facing??"up",r=Ht(o,t?.size);return new F(de(Kt(o),e,ge(ae({},t),{size:r})))}static createFromPolygon(e,t){if(!(e instanceof ot))return T().error(".createFromPolygon()",jt),null;let o=Ct(e);return new F({vertexAttributes:new K({position:o.position}),components:[new V({faces:o.faces,shading:"flat",material:t?.material??null})],spatialReference:e.spatialReference,vertexSpace:new $})}static createFromGLTF(e,t,o){return O(this,null,function*(){if(!(e instanceof S)){let n=new fe;throw T().error(".createfromGLTF()",n.message),n}let{loadGLTFMesh:r}=yield xe(import("./chunk-S3DZJEGU.js"),o);return new F(yield r(e,t,o))})}static createFromFiles(e,t,o){return O(this,null,function*(){ke(T(),"`Mesh.createFromFiles` is deprecated in favor of 'SceneLayer.convertMesh'",{replacement:"SceneLayer.convertMesh",version:"4.29"});let r=n=>T().error(".createFromFiles()",n.message);if(!(e instanceof S)){let n=new fe;throw r(n),n}if(!o?.layer)throw new z("invalid:no-layer","SceneLayer required for file to mesh conversion.");return o.layer.convertMesh(t,ae({location:e},o))})}static createWithExternalSource(e,t,o){let r=o?.extent??null,{spatialReference:n}=e,a=o?.transform?.clone()??new U,s=H(e,o),i=o?.unitConversionDisabled,c={source:t,extent:r,unitConversionDisabled:i},p=new C;return p.externalSources.push(c),new F({metadata:p,transform:a,vertexSpace:s,spatialReference:n})}static createIncomplete(e,t){let{spatialReference:o}=e,r=t?.transform?.clone()??new U,n=H(e,t),a=new F({transform:r,vertexSpace:n,spatialReference:o});return a.addResolvingPromise(Promise.reject(new z("mesh-incomplete","Mesh resources are not complete"))),a}};h([g({type:[V],json:{write:!0}})],w.prototype,"components",void 0),h([g({nonNullable:!0,types:Er,constructOnly:!0,json:{write:!0}})],w.prototype,"vertexSpace",void 0),h([g({type:U,json:{write:!0}})],w.prototype,"transform",void 0),h([g({constructOnly:!0})],w.prototype,"metadata",void 0),h([g()],w.prototype,"hasExtent",null),h([g()],w.prototype,"_transformedExtent",null),h([g()],w.prototype,"_untransformedBounds",null),h([g()],w.prototype,"origin",null),h([g({readOnly:!0,json:{read:!1}})],w.prototype,"extent",null),h([g({readOnly:!0,json:{read:!1,write:!0,default:!0}})],w.prototype,"hasZ",void 0),h([g({readOnly:!0,json:{read:!1,write:!0,default:!1}})],w.prototype,"hasM",void 0),h([g({type:K,nonNullable:!0,json:{write:!0}})],w.prototype,"vertexAttributes",void 0),w=F=h([ve(ir)],w);var sr=Ue(),Jn=w;export{Jn as a};
