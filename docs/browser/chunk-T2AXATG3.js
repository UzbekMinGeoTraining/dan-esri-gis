import{a as T}from"./chunk-CDG4VMUI.js";import{a as U}from"./chunk-RHS3EARZ.js";import{b as q}from"./chunk-6ISQQD7M.js";import{b as W}from"./chunk-N3AGC3JB.js";import{a as y}from"./chunk-O6YJVL7E.js";import{h as I}from"./chunk-7ISKCG7U.js";import{a as G}from"./chunk-XXOIKNT6.js";import{a,e as g,l as z,m as A,o as _}from"./chunk-AOA5JMXK.js";import{a as F,c as L,y as B}from"./chunk-2HUIJUS4.js";import{y as P}from"./chunk-5MNDZ6BX.js";import{A as E,h as H}from"./chunk-6WKJD7BM.js";import{a as v}from"./chunk-PYQRTZNZ.js";import{a as O}from"./chunk-VWF5VUO3.js";import{m as j}from"./chunk-4DLSYLKE.js";import{a as x}from"./chunk-VPXBKZQM.js";import{Q as h,S as N}from"./chunk-GGZQ5GCM.js";import{U as M}from"./chunk-TFUPB3ZG.js";import{a as u}from"./chunk-BMVJCP2M.js";import{r as w}from"./chunk-3IBUFXWY.js";function te(e,r,t,n){if(r==null||n==null)return!1;let i=g(r,z),o=g(n,A);if(i===o&&i!==a.UNKNOWN||j(r,n))return t[0]=1,t[1]=1,t[2]=1,!0;if(i===a.SPHERICAL_ECEF){let c=F(e),m=c/Math.sqrt(e[0]*e[0]+e[1]*e[1]),p=c/x.radius;if(o===a.WEB_MERCATOR)return t[0]=m*p,t[1]=m*p,t[2]=1,!0;if(o===a.WGS84||o===a.CGCS2000){let s=_;return t[0]=s*m*p,t[1]=s*p,t[2]=1,!0}}else if(i===a.PLATE_CARREE){if(o===a.WGS84||o===a.CGCS2000)return t[0]=_,t[1]=_,t[2]=1,!0;if(o===a.WEB_MERCATOR){let c=e[1]/x.radius;return t[0]=1,t[1]=1/Math.cos(c),t[2]=1,!0}}return!1}var f=class extends O.EventedMixin(N){constructor(e){super(e),this._tmpEvent=new U,this._renderCoordsHelper=e.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=e.layerElevationSource}initialize(){this._intersector=q(this.view.state.viewingMode),this._intersector.options.store=W.MIN,this._intersector.options.normalRequired=!1,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){return this.view?.elevationProvider?.spatialReference}getElevation(e,r,t,n){let i=this._renderCoordsHelper,o=L(l,e,r,t);if(!i.toRenderCoords(o,n,o))return w.getLogger(this).error("could not project point to compute elevation"),null;let{layerElevationSource:c,_intersector:m,intersectionHandler:p}=this,s=c.fullExtent,R=s!=null&&Number.isFinite(s.xmin)&&Number.isFinite(s.xmax)&&Number.isFinite(s.ymin)&&Number.isFinite(s.ymax)&&Number.isFinite(s.zmin)&&Number.isFinite(s.zmax)?new y(s.zmin,s.zmax):c.elevationRange;if(R==null)return null;let C=c.elevationOffset,Z=R.elevationRangeMin+C,k=R.elevationRangeMax+C,S=i.setAltitude(J,k,o),b=i.setAltitude(V,Z,o);return m.reset(S,b,null),p.intersect(m,null,S,b,null,!0),m.results.min.getIntersectionPoint(o)?i.getAltitude(o):null}getSphereElevationBounds(e,r){return T(e,r,D,this._renderSR),this._layerElevationSource.getElevationRange(D)}getRootElevationBounds(){let e=this.layerElevationSource.fullExtent;return e?.hasZ?new y(e.zmin,e.zmax):null}objectsChanged(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(e,r){E(r),this._expandExtent(e,r)}_computeLayerExtent(e,r){E(r);for(let t of e)this._expandExtent(t,r)}_expandExtent(e,r){let t=this.spatialReference;if(t==null||e==null)return;P(d,e.quaternion),d[12]=e.center[0],d[13]=e.center[1],d[14]=e.center[2];let n=e.halfSize;for(let i=0;i<8;++i)l[0]=1&i?n[0]:-n[0],l[1]=2&i?n[1]:-n[1],l[2]=4&i?n[2]:-n[2],B(l,l,d),this._renderCoordsHelper.fromRenderCoords(l,l,t),H(r,l,r)}};u([h({constructOnly:!0})],f.prototype,"layerElevationSource",void 0),u([h({constructOnly:!0})],f.prototype,"intersectionHandler",void 0),u([h({constructOnly:!0})],f.prototype,"view",void 0),u([h()],f.prototype,"spatialReference",null),f=u([M("esri.views.3d.layers.i3s.LayerElevationProvider")],f);var d=G(),D=I(0,0,0,0),l=v(),J=v(),V=v();var K=class{constructor(r,t,n,i){this.toMapSpace=r,this.transform=t,this.obb=n,this.geometry=i}};var Q=class{constructor(r,t){this.position=r,this.rotationScale=t,this.origin=void 0}};export{te as a,f as b,K as c,Q as d};
