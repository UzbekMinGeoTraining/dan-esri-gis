import{a as v,b as W,c as Q,d as de,e as he,m as me,n as ge,o as ye,p as ve,q as be,r as Se}from"./chunk-EOIOR3QN.js";import"./chunk-V2QHUPXP.js";import{a as xe}from"./chunk-LN3SPAIO.js";import"./chunk-2K7MVC27.js";import"./chunk-SDRDL3LF.js";import"./chunk-4UY52H4D.js";import"./chunk-3YHUBCUW.js";import"./chunk-EPI6QXKT.js";import{a as X}from"./chunk-YAFRUDEN.js";import{c as A}from"./chunk-PQ2CFAKW.js";import{$ as pe,A as N,D as B,E,F as ce,H as ue,L as j,Q as J,T as fe,U as G,V as O,Y as w,a as le,b as l,c as s,f as _,i as se,j as z,k as D,ka as we,l as U,o as b,p as Z,q as p,r as F,s as k,u as x,y as m,z as R}from"./chunk-4RJTDUBN.js";import"./chunk-MTRBRBPC.js";import"./chunk-A7GYEEN6.js";import"./chunk-3LZC5E4L.js";import"./chunk-WUZAEWWX.js";import"./chunk-ACVF7Z7X.js";import"./chunk-FKKNYWR6.js";import"./chunk-FIUHDVVO.js";import"./chunk-3HX6VT75.js";import"./chunk-ZGDQY5ZD.js";import"./chunk-QH2MD2O2.js";import"./chunk-6EZNY6L4.js";import"./chunk-7XLHE26H.js";import"./chunk-EN6CTWVM.js";import"./chunk-LVPMJTA6.js";import"./chunk-PFIMJ2UL.js";import"./chunk-PM4ZR7W6.js";import"./chunk-ENLR2WBX.js";import"./chunk-RI3FIROF.js";import"./chunk-PJX4LNSV.js";import"./chunk-NNETCWLJ.js";import"./chunk-EPTSNNZF.js";import"./chunk-VDNXTMSC.js";import"./chunk-K72LO6P2.js";import"./chunk-2R4SNL6O.js";import"./chunk-7D4IYTAJ.js";import"./chunk-TSNWBMBA.js";import"./chunk-GLWPOGYF.js";import"./chunk-OFZ6SV37.js";import"./chunk-YSOJWUIW.js";import"./chunk-Q5WFUDPQ.js";import"./chunk-DPZGANVI.js";import"./chunk-T7BKG6V3.js";import"./chunk-R6VC74T7.js";import"./chunk-6WKJD7BM.js";import"./chunk-3CR7P5WT.js";import"./chunk-S4PLWG55.js";import"./chunk-DZAY272R.js";import"./chunk-GYH7NDHH.js";import"./chunk-S3UQHW42.js";import"./chunk-BIVFGNT6.js";import"./chunk-7PEPFLZH.js";import"./chunk-BRVOQZDM.js";import"./chunk-TBYT66N3.js";import"./chunk-5PTS4JDF.js";import"./chunk-MUI46NAG.js";import{a as V}from"./chunk-N27U3N2T.js";import"./chunk-4R5NBZMW.js";import{a as T}from"./chunk-NDYVXEZ5.js";import"./chunk-CMMPCPP5.js";import"./chunk-4DLSYLKE.js";import"./chunk-VPXBKZQM.js";import"./chunk-ZTKK3KB7.js";import"./chunk-GZXWFBZI.js";import"./chunk-B7IARA3F.js";import"./chunk-IZVEJCCI.js";import"./chunk-TEY6TKJV.js";import"./chunk-4M6XQSBA.js";import"./chunk-2JF6YUJG.js";import"./chunk-GGZQ5GCM.js";import"./chunk-TFUPB3ZG.js";import"./chunk-ANPNMGFG.js";import"./chunk-BMVJCP2M.js";import"./chunk-GMC3I5VG.js";import"./chunk-WGF2T2BG.js";import"./chunk-YZP43POT.js";import"./chunk-VEDIBGHD.js";import"./chunk-3IBUFXWY.js";import"./chunk-BP73DJTS.js";import{g as f}from"./chunk-JEGVIFEP.js";var P=100;function oe(t,e){return f(this,null,function*(){let n=[];for(let r=0;r<e.arguments.length;r++)n.push(yield u(t,e.arguments[r]));return n})}function M(t,e,n){return f(this,null,function*(){return e.preparsed===!0?n(t,null,e.arguments):n(t,e,yield oe(t,e))})}var H=class extends se{constructor(e,n){super(),this.definition=null,this.context=null,this.definition=e,this.context=n}createFunction(e){return(...n)=>{let r={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:e.depthCounter+1},globalScope:this.context.globalScope};if(r.depthCounter.depth>64)throw new s(e,l.MaximumCallDepth,null);return $(this.definition,r,n,null)}}call(e,n){return L(e,n,(r,o,a)=>{let i={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1}};if(i.depthCounter.depth>64)throw new s(e,l.MaximumCallDepth,n);return $(this.definition,i,a,n)})}marshalledCall(e,n,r,o){return o(e,n,(a,i,c)=>f(this,null,function*(){let d={spatialReference:e.spatialReference,globalScope:r.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{}};return c=c.map(h=>!x(h)||h instanceof U?h:z(h,e,o)),z(yield $(this.definition,d,c,n),r,o)}))}},C=class extends le{constructor(e){super(),this.source=e}global(e){return f(this,null,function*(){let n=this.executingContext.globalScope[e.toLowerCase()];if(n.valueset||(n.value=yield u(this.executingContext,n.node),n.valueset=!0),x(n.value)&&!(n.value instanceof U)){let r=new U;r.fn=n.value,r.parameterEvaluator=L,r.context=this.executingContext,n.value=r}return n.value})}setGlobal(e,n){if(x(n))throw new s(null,l.AssignModuleFunction,null);this.executingContext.globalScope[e.toLowerCase()]={value:n,valueset:!0,node:null}}hasGlobal(e){return this.executingContext.exports[e]===void 0&&(e=e.toLowerCase()),this.executingContext.exports[e]!==void 0}loadModule(e){return f(this,null,function*(){let n=e.spatialReference;n==null&&(n=new T({wkid:102100})),this.moduleScope=Ce({},e.customfunctions,e.timeZone),this.executingContext={spatialReference:n,services:e.services,libraryResolver:new W(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:this.moduleScope,console:e.console??Ne,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},yield ae(this.executingContext,this.source.syntax)})}};function L(t,e,n){return f(this,null,function*(){return e.preparsed===!0?n(t,null,e.arguments):n(t,e,yield oe(t,e))})}function u(t,e){return f(this,null,function*(){e.breakpoint&&(yield e.breakpoint());try{switch(e.type){case"UpdateExpression":return yield De(t,e);case"AssignmentExpression":return yield Ue(t,e);case"TemplateLiteral":return yield He(t,e);case"Identifier":return yield ie(t,e);case"MemberExpression":return yield _e(t,e);case"Literal":return e.value;case"CallExpression":return yield $e(t,e);case"UnaryExpression":return yield ze(t,e);case"BinaryExpression":return yield Qe(t,e);case"LogicalExpression":return yield Xe(t,e);case"ArrayExpression":return yield Je(t,e);case"ObjectExpression":return yield Ee(t,e);default:throw new s(t,l.Unrecognized,e)}}catch(n){throw _(t,e,n)}})}function S(t,e){return f(this,null,function*(){e.breakpoint&&(yield e.breakpoint());try{switch(e.type){case"ImportDeclaration":return yield Te(t,e);case"ExportNamedDeclaration":return yield Ve(t,e);case"VariableDeclaration":return yield Re(t,e,0);case"BlockStatement":return yield ae(t,e);case"FunctionDeclaration":return yield qe(t,e);case"ReturnStatement":return yield Pe(t,e);case"IfStatement":return yield Ge(t,e);case"ExpressionStatement":return yield Ze(t,e);case"ForStatement":return yield Be(t,e);case"WhileStatement":return yield Oe(t,e);case"ForInStatement":return yield Le(t,e);case"BreakStatement":return F;case"EmptyStatement":return p;case"ContinueStatement":return k;default:throw new s(t,l.Unrecognized,e)}}catch(n){throw _(t,e,n)}})}function Ee(t,e){return f(this,null,function*(){let n=[];for(let i=0;i<e.properties.length;i++){let c=e.properties[i],d=yield u(t,c.value),h=c.key.type==="Identifier"?c.key.name:yield u(t,c.key);n[i]={key:h,value:d}}let r={},o=new Map;for(let i=0;i<n.length;i++){let c=n[i];if(x(c.value))throw new s(t,l.NoFunctionInDictionary,e);if(m(c.key)===!1)throw new s(t,l.KeyMustBeString,e);let d=c.key.toString(),h=d.toLowerCase();o.has(h)?d=o.get(h):o.set(h,d),c.value===p?r[d]=null:r[d]=c.value}let a=new A(r);return a.immutable=!1,a})}function Oe(t,e){return f(this,null,function*(){let n={testResult:!0,lastAction:p};if(n.testResult=yield u(t,e.test),n.testResult===!1)return p;if(n.testResult!==!0)throw new s(t,l.BooleanConditionRequired,e);for(;n.testResult===!0&&(n.lastAction=yield S(t,e.body),n.lastAction!==F)&&!(n.lastAction instanceof b);)if(n.testResult=yield u(t,e.test),n.testResult!==!0&&n.testResult!==!1)throw new s(t,l.BooleanConditionRequired,e);return n.lastAction instanceof b?n.lastAction:p})}function Fe(t,e,n){return f(this,null,function*(){let r=yield S(t,e.body);return n.lastAction=r,n.lastAction===F||n.lastAction instanceof b?(n.testResult=!1,n):(e.update!==null&&(yield u(t,e.update)),n)})}function ke(t,e,n){return f(this,null,function*(){if(e.test!==null){let r=yield u(t,e.test);if(t.abortSignal?.aborted===!0)throw new s(t,l.Cancelled,e);if(n.testResult=r,n.testResult===!1)return n;if(n.testResult!==!0)throw new s(t,l.BooleanConditionRequired,e);return Fe(t,e,n)}return Fe(t,e,n)})}function Y(t,e,n,r,o,a){try{ke(t,e,n).then(()=>{try{n.testResult===!0?++a>P?(a=0,setTimeout(()=>{Y(t,e,n,r,o,a)},0)):Y(t,e,n,r,o,a):n.lastAction instanceof b?r(n.lastAction):r(p)}catch(i){o(i)}},i=>{o(i)})}catch(i){o(i)}}function Be(t,e){return f(this,null,function*(){try{return e.init!==null&&(e.init.type==="VariableDeclaration"?yield S(t,e.init):yield u(t,e.init)),yield new Promise((n,r)=>{Y(t,e,{testResult:!0,lastAction:p},o=>{n(o)},o=>{r(o)},0)})}catch(n){throw n}})}function ee(t,e,n,r,o,a,i,c,d,h){try{if(r<=a)return void c(p);o.value=i==="k"?n[a]:a,S(t,e.body).then(y=>{try{y instanceof b?c(y):y===F?c(p):++h>P?(h=0,setTimeout(()=>{ee(t,e,n,r,o,a+1,i,c,d,h)},0)):ee(t,e,n,r,o,a+1,i,c,d,h)}catch(q){d(q)}},y=>{d(y)})}catch(y){d(y)}}function te(t,e,n,r,o,a,i,c,d){try{if(n.length()<=o)return void i(p);r.value=a==="k"?n.get(o):o,S(t,e.body).then(h=>{h instanceof b?i(h):h===F?i(p):++d>P?(d=0,setTimeout(()=>{te(t,e,n,r,o+1,a,i,c,d)},0)):te(t,e,n,r,o+1,a,i,c,d)},h=>{c(h)})}catch(h){c(h)}}function ne(t,e,n,r,o,a){try{if(a===void 0&&(a="i"),n.length===0)return void r.resolve(p);ee(t,e,n,n.length,o,0,a,i=>{r.resolve(i)},i=>{r.reject(i)},0)}catch(i){r.reject(i)}}function je(t,e,n,r,o,a){try{if(a===void 0&&(a="i"),n.length()===0)return void r.resolve(p);te(t,e,n,o,0,a,i=>{r.resolve(i)},i=>{r.reject(i)},0)}catch(i){r.reject(i)}}function Ke(t,e,n,r,o){try{ne(t,e,n.keys(),r,o,"k")}catch(a){r.reject(a)}}function re(t,e,n,r,o,a,i,c){try{t.next().then(d=>{try{if(d===null)a(p);else{let h=X.createFromGraphicLikeObject(d.geometry,d.attributes,r,e.timeZone);h._underlyingGraphic=d,o.value=h,S(e,n.body).then(y=>{try{y===F?a(p):y instanceof b?a(y):++c>P?(c=0,setTimeout(()=>{re(t,e,n,r,o,a,i,c)},0)):re(t,e,n,r,o,a,i,c)}catch(q){i(q)}},y=>{i(y)})}}catch(h){i(h)}},d=>{i(d)})}catch(d){i(d)}}function Le(t,e){return f(this,null,function*(){return new Promise((n,r)=>{u(t,e.right).then(o=>{try{let a;a=e.left.type==="VariableDeclaration"?S(t,e.left):Promise.resolve(),a.then(()=>{try{let i=v(e.left.type==="VariableDeclaration"?e.left.declarations[0].id:e.left),c=null;if(t.localScope!=null&&t.localScope[i]!==void 0&&(c=t.localScope[i]),c===null&&t.globalScope[i]!==void 0&&(c=t.globalScope[i]),c===null)return void r(new s(t,l.InvalidIdentifier,e));B(o)||m(o)?ne(t,e,o,{reject:r,resolve:n},c):j(o)?je(t,e,o,{reject:r,resolve:n},c):o instanceof A||E(o)?Ke(t,e,o,{reject:r,resolve:n},c):ue(o)?re(o.iterator(t.abortSignal),t,e,o,c,d=>{n(d)},d=>{r(d)},0):ne(t,e,[],{reject:r,resolve:n},c)}catch(i){r(i)}},r)}catch(a){r(a)}},r)})})}function De(t,e){return f(this,null,function*(){let n=e.argument;if(n.type==="CallExpression")throw new s(t,l.NeverReach,e);if(n.type==="MemberExpression"){let a=yield u(t,n.object),i,c;if(n.computed===!0)i=yield u(t,n.property);else{if(n.property.type!=="Identifier")throw new s(t,l.Unrecognized,e);i=n.property.name}if(B(a)){if(!N(i))throw new s(t,l.ArrayAccessorMustBeNumber,e);if(i<0&&(i=a.length+i),i<0||i>=a.length)throw new s(t,l.OutOfBounds,e);c=w(a[i]),a[i]=e.operator==="++"?c+1:c-1}else if(a instanceof A){if(m(i)===!1)throw new s(t,l.KeyAccessorMustBeString,e);if(a.hasField(i)!==!0)throw new s(t,l.FieldNotFound,e,{key:i});c=w(a.field(i)),a.setField(i,e.operator==="++"?c+1:c-1)}else if(a instanceof C){if(m(i)===!1)throw new s(t,l.ModuleAccessorMustBeString,e);if(a.hasGlobal(i)!==!0)throw new s(t,l.ModuleExportNotFound,e);c=w(yield a.global(i)),a.setGlobal(i,e.operator==="++"?c+1:c-1)}else{if(!E(a))throw j(a)?new s(t,l.Immutable,e):new s(t,l.InvalidParameter,e);if(m(i)===!1)throw new s(t,l.KeyAccessorMustBeString,e);if(a.hasField(i)!==!0)throw new s(t,l.FieldNotFound,e,{key:i});c=w(a.field(i)),a.setField(i,e.operator==="++"?c+1:c-1)}return e.prefix===!1?c:e.operator==="++"?c+1:c-1}let r=v(n),o;if(t.localScope!=null&&t.localScope[r]!==void 0)return o=w(t.localScope[r].value),t.localScope[r]={value:e.operator==="++"?o+1:o-1,valueset:!0,node:e},e.prefix===!1?o:e.operator==="++"?o+1:o-1;if(t.globalScope[r]!==void 0)return o=w(t.globalScope[r].value),t.globalScope[r]={value:e.operator==="++"?o+1:o-1,valueset:!0,node:e},e.prefix===!1?o:e.operator==="++"?o+1:o-1;throw new s(t,l.InvalidIdentifier,e)})}function I(t,e,n,r,o){switch(e){case"=":return t===p?null:t;case"/=":return w(n)/w(t);case"*=":return w(n)*w(t);case"-=":return w(n)-w(t);case"+=":return m(n)||m(t)?O(n)+O(t):w(n)+w(t);case"%=":return w(n)%w(t);default:throw new s(o,l.UnsupportedOperator,r)}}function Ue(t,e){return f(this,null,function*(){let n=e.left;if(n.type==="MemberExpression"){let o=yield u(t,n.object),a;if(n.computed===!0)a=yield u(t,n.property);else{if(n.property.type!=="Identifier")throw new s(t,l.InvalidIdentifier,e);a=n.property.name}let i=yield u(t,e.right);if(B(o)){if(!N(a))throw new s(t,l.ArrayAccessorMustBeNumber,e);if(a<0&&(a=o.length+a),a<0||a>o.length)throw new s(t,l.OutOfBounds,e);if(a===o.length){if(e.operator!=="=")throw new s(t,l.OutOfBounds,e);o[a]=I(i,e.operator,o[a],e,t)}else o[a]=I(i,e.operator,o[a],e,t)}else if(o instanceof A){if(m(a)===!1)throw new s(t,l.KeyAccessorMustBeString,e);if(o.hasField(a)===!0)o.setField(a,I(i,e.operator,o.field(a),e,t));else{if(e.operator!=="=")throw new s(t,l.FieldNotFound,e,{key:a});o.setField(a,I(i,e.operator,null,e,t))}}else if(o instanceof C){if(m(a)===!1)throw new s(t,l.KeyAccessorMustBeString,e);if(o.hasGlobal(a)!==!0)throw new s(t,l.ModuleExportNotFound,e);o.setGlobal(a,I(i,e.operator,yield o.global(a),e,t))}else{if(!E(o))throw j(o)?new s(t,l.Immutable,e):new s(t,l.InvalidParameter,e);if(m(a)===!1)throw new s(t,l.KeyAccessorMustBeString,e);if(o.hasField(a)===!0)o.setField(a,I(i,e.operator,o.field(a),e,t));else{if(e.operator!=="=")throw new s(t,l.FieldNotFound,e,{key:a});o.setField(a,I(i,e.operator,null,e,t))}}return p}let r=v(n);if(t.localScope!=null&&t.localScope[r]!==void 0){let o=yield u(t,e.right);return t.localScope[r]={value:I(o,e.operator,t.localScope[r].value,e,t),valueset:!0,node:e.right},p}if(t.globalScope[r]!==void 0){let o=yield u(t,e.right);return t.globalScope[r]={value:I(o,e.operator,t.globalScope[r].value,e,t),valueset:!0,node:e.right},p}throw new s(t,l.InvalidIdentifier,e)})}function Ze(t,e){return f(this,null,function*(){let n=yield u(t,e.expression);return n===p?p:new Z(n)})}function Ge(t,e){return f(this,null,function*(){let n=yield u(t,e.test);if(n===!0)return S(t,e.consequent);if(n===!1)return e.alternate!==null?S(t,e.alternate):p;throw new s(t,l.BooleanConditionRequired,e)})}function ae(t,e){return f(this,null,function*(){return Ie(t,e,0)})}function Ie(t,e,n){return f(this,null,function*(){if(n>=e.body.length)return p;let r=yield S(t,e.body[n]);return r instanceof b||r===F||r===k||n===e.body.length-1?r:Ie(t,e,n+1)})}function Pe(t,e){return f(this,null,function*(){if(e.argument===null)return new b(p);let n=yield u(t,e.argument);return new b(n)})}function qe(t,e){return f(this,null,function*(){let n=v(e.id);return t.globalScope[n]={valueset:!0,node:null,value:new H(e,t)},p})}function Te(t,e){return f(this,null,function*(){let n=v(e.specifiers[0].local),r=t.libraryResolver.loadLibrary(n),o;return t.libraryResolver._moduleSingletons?.has(r.uri)?o=t.libraryResolver._moduleSingletons.get(r.uri):(o=new C(r),yield o.loadModule(t),t.libraryResolver._moduleSingletons?.set(r.uri,o)),t.globalScope[n]={value:o,valueset:!0,node:e},p})}function Ve(t,e){return f(this,null,function*(){if(yield S(t,e.declaration),e.declaration.type==="FunctionDeclaration")t.exports[v(e.declaration.id)]="function";else if(e.declaration.type==="VariableDeclaration")for(let n of e.declaration.declarations)t.exports[v(n.id)]="variable";return p})}function Re(t,e,n){return f(this,null,function*(){return n>=e.declarations.length?p:(yield We(t,e.declarations[n]),n===e.declarations.length-1||(yield Re(t,e,n+1)),p)})}function We(t,e){return f(this,null,function*(){let n=null;if(n=e.init===null?null:yield u(t,e.init),t.localScope!==null){if(n===p&&(n=null),e.id.type!=="Identifier")throw new s(t,l.InvalidIdentifier,e);let o=v(e.id);return void(t.localScope!=null&&(t.localScope[o]={value:n,valueset:!0,node:e.init}))}if(e.id.type!=="Identifier")throw new s(t,l.InvalidIdentifier,e);let r=v(e.id);n===p&&(n=null),t.globalScope[r]={value:n,valueset:!0,node:e.init}})}function _e(t,e){return f(this,null,function*(){let n=yield u(t,e.object);if(n===null)throw new s(t,l.MemberOfNull,e);if(e.computed===!1){if(e.property.type==="Identifier"){if(n instanceof A||E(n))return n.field(e.property.name);if(n instanceof V)return Q(n,e.property.name,t,e);if(n instanceof C){if(!n.hasGlobal(e.property.name))throw new s(t,l.InvalidIdentifier,e);return n.global(e.property.name)}throw new s(t,l.InvalidMemberAccessKey,e)}throw new s(t,l.InvalidMemberAccessKey,e)}let r=yield u(t,e.property);if(n instanceof A||E(n)){if(m(r))return n.field(r);throw new s(t,l.InvalidMemberAccessKey,e)}if(n instanceof C){if(m(r))return n.global(r);throw new s(t,l.InvalidMemberAccessKey,e)}if(n instanceof V){if(m(r))return Q(n,r,t,e);throw new s(t,l.InvalidMemberAccessKey,e)}if(B(n)){if(N(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length+r),r>=n.length||r<0)throw new s(t,l.OutOfBounds,e);return n[r]}throw new s(t,l.InvalidMemberAccessKey,e)}if(j(n)){if(N(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length()+r),r>=n.length()||r<0)throw new s(t,l.OutOfBounds,e);return n.get(r)}throw new s(t,l.InvalidMemberAccessKey,e)}if(m(n)){if(N(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length+r),r>=n.length||r<0)throw new s(t,l.OutOfBounds,e);return n[r]}throw new s(t,l.InvalidMemberAccessKey,e)}throw new s(t,l.InvalidMemberAccessKey,e)})}function ze(t,e){return f(this,null,function*(){let n=yield u(t,e.argument);if(R(n)){if(e.operator==="!")return!n;if(e.operator==="-")return-1*w(n);if(e.operator==="+")return 1*w(n);if(e.operator==="~")return~w(n);throw new s(t,l.UnsupportedUnaryOperator,e)}if(e.operator==="-")return-1*w(n);if(e.operator==="+")return 1*w(n);if(e.operator==="~")return~w(n);throw new s(t,l.UnsupportedUnaryOperator,e)})}function Je(t,e){return f(this,null,function*(){let n=[];for(let r=0;r<e.elements.length;r++)n.push(yield u(t,e.elements[r]));for(let r=0;r<n.length;r++){if(x(n[r]))throw new s(t,l.NoFunctionInArray,e);n[r]===p&&(n[r]=null)}return n})}function Qe(t,e){return f(this,null,function*(){let n=yield u(t,e.left),r=yield u(t,e.right);switch(e.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return we(w(n),w(r),e.operator);case"==":return G(n,r);case"!=":return!G(n,r);case"<":case">":case"<=":case">=":return fe(n,r,e.operator);case"+":return m(n)||m(r)?O(n)+O(r):w(n)+w(r);case"-":return w(n)-w(r);case"*":return w(n)*w(r);case"/":return w(n)/w(r);case"%":return w(n)%w(r);default:throw new s(t,l.UnsupportedOperator,e)}})}function Xe(t,e){return f(this,null,function*(){let n=yield u(t,e.left);if(!R(n))throw new s(t,l.LogicalExpressionOnlyBoolean,e);switch(e.operator){case"||":{if(n===!0)return n;let r=yield u(t,e.right);if(R(r))return r;throw new s(t,l.LogicExpressionOrAnd,e)}case"&&":{if(n===!1)return n;let r=yield u(t,e.right);if(R(r))return r;throw new s(t,l.LogicExpressionOrAnd,e)}default:throw new s(t,l.LogicExpressionOrAnd,e)}})}function ie(t,e){return f(this,null,function*(){let n=v(e);if(t.localScope!=null&&t.localScope[n]!==void 0){let r=t.localScope[n];if(r.valueset===!0)return r.value;if(r.d!==null)return r.d;r.d=u(t,r.node);let o=yield r.d;return r.value=o,r.valueset=!0,o}if(t.globalScope[n]!==void 0){let r=t.globalScope[n];if(r.valueset===!0)return r.value;if(r.d!==null)return r.d;r.d=u(t,r.node);let o=yield r.d;return r.value=o,r.valueset=!0,o}throw new s(t,l.InvalidIdentifier,e)})}function $e(t,e){return f(this,null,function*(){if(e.callee.type==="MemberExpression"){let r=yield u(t,e.callee.object);if(!(r instanceof C))throw new s(t,l.FunctionNotFound,e);let o=e.callee.computed===!1?e.callee.property.name:yield u(t,e.callee.property);if(!r.hasGlobal(o))throw new s(t,l.FunctionNotFound,e);let a=yield r.global(o);if(!x(a))throw new s(t,l.CallNonFunction,e);return a.call(t,e)}if(e.callee.type!=="Identifier")throw new s(t,l.FunctionNotFound,e);let n=v(e.callee);if(t.localScope!=null&&t.localScope[n]!==void 0){let r=t.localScope[n];if(x(r.value))return r.value.call(t,e);throw new s(t,l.CallNonFunction,e)}if(t.globalScope[n]!==void 0){let r=t.globalScope[n];if(x(r.value))return r.value.call(t,e);throw new s(t,l.CallNonFunction,e)}throw new s(t,l.FunctionNotFound,e)})}function He(t,e){return f(this,null,function*(){let n="",r=0;for(let o of e.quasis)if(n+=o.value?o.value.cooked:"",o.tail===!1){if(e.expressions[r]){let a=yield u(t,e.expressions[r]);if(x(a))throw new s(t,l.NoFunctionInTemplateLiteral,e);n+=O(a)}r++}return n})}var g={};function Ae(t,e,n,r){return f(this,null,function*(){let o=yield u(t,e.arguments[n]);if(G(o,r))return u(t,e.arguments[n+1]);let a=e.arguments.length-n;return a===1?u(t,e.arguments[n]):a===2?null:a===3?u(t,e.arguments[n+2]):Ae(t,e,n+2,r)})}function Me(t,e,n,r){return f(this,null,function*(){if(r===!0)return u(t,e.arguments[n+1]);if(e.arguments.length-n===3)return u(t,e.arguments[n+2]);let o=yield u(t,e.arguments[n+2]);if(R(o)===!1)throw new s(t,l.ModuleExportNotFound,e.arguments[n+2]);return Me(t,e,n+2,o)})}function $(t,e,n,r){return f(this,null,function*(){let o=t.body;if(n.length!==t.params.length)throw new s(e,l.WrongNumberOfParameters,null);for(let i=0;i<n.length;i++){let c=t.params[i];c.type==="Identifier"&&e.localScope!=null&&(e.localScope[v(c)]={d:null,value:n[i],valueset:!0,node:null})}let a=yield S(e,o);if(a instanceof b)return a.value;if(a===F)throw new s(e,l.UnexpectedToken,r);if(a===k)throw new s(e,l.UnexpectedToken,r);return a instanceof Z?a.value:a})}ge(g,M),Se(g,M),ve(g,M),ye(g,M),be(g,M),xe({functions:g,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:M,standardFunctionAsync:L}),g.iif=function(t,e){return f(this,null,function*(){J(e.arguments===null?[]:e.arguments,3,3,t,e);let n=yield u(t,e.arguments[0]);if(R(n)===!1)throw new s(t,l.BooleanConditionRequired,e);return u(t,n?e.arguments[1]:e.arguments[2])})},g.defaultvalue=function(t,e){return f(this,null,function*(){J(e.arguments===null?[]:e.arguments,2,3,t,e);let n=yield u(t,e.arguments[0]);if(e.arguments.length===3){let r=yield u(t,e.arguments[1]),o=de(n,r);return o!=null&&o!==""?o:u(t,e.arguments[2])}return n==null||n===""?u(t,e.arguments[1]):n})},g.decode=function(t,e){return f(this,null,function*(){if(e.arguments.length<2)throw new s(t,l.WrongNumberOfParameters,e);if(e.arguments.length===2)return u(t,e.arguments[1]);if((e.arguments.length-1)%2==0)throw new s(t,l.WrongNumberOfParameters,e);return Ae(t,e,1,yield u(t,e.arguments[0]))})},g.when=function(t,e){return f(this,null,function*(){if(e.arguments.length<3)throw new s(t,l.WrongNumberOfParameters,e);if(e.arguments.length%2==0)throw new s(t,l.WrongNumberOfParameters,e);let n=yield u(t,e.arguments[0]);if(R(n)===!1)throw new s(t,l.BooleanConditionRequired,e.arguments[0]);return Me(t,e,0,n)})};var Ye={fixSpatialReference:pe,parseArguments:oe,standardFunction:M,standardFunctionAsync:L,evaluateIdentifier:ie};for(let t in g)g[t]={value:new D(g[t]),valueset:!0,node:null};var K=function(){};function Ce(t,e,n){let r=new K;t==null&&(t={}),e==null&&(e={});let o=new A({newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});o.immutable=!1,r.textformatting={value:o,valueset:!0,node:null};for(let a in e)r[a]={value:new D(e[a]),native:!0,valueset:!0,node:null};for(let a in t)r[a]={value:ce(t[a])?X.createFromGraphic(t[a],n):t[a],valueset:!0,node:null};return r}function Ne(t){console.log(t)}K.prototype=g,K.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},K.prototype.pi={value:Math.PI,valueset:!0,node:null};var bt=Ye;function et(t){let e={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:M,standardFunctionAsync:L,evaluateIdentifier:ie};for(let n=0;n<t.length;n++)t[n].registerFunctions(e);for(let n in e.functions)g[n]={value:new D(e.functions[n]),valueset:!0,node:null},K.prototype[n]=g[n];for(let n=0;n<e.signatures.length;n++)he(e.signatures[n],"async")}function St(t,e){return f(this,null,function*(){let n=e.spatialReference;n==null&&(n=new T({wkid:102100}));let r=null;t.usesModules&&(r=new W(new Map,t.loadedModules));let o=Ce(e.vars,e.customfunctions,e.timeZone),a={spatialReference:n,services:e.services,exports:{},libraryResolver:r,abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:o,console:e.console??Ne,timeZone:e.timeZone??null,lrucache:e.lrucache,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},i=yield ae(a,t);if(i instanceof b||i instanceof Z){let c=i.value;if(c===p)return null;if(x(c))throw new s(a,l.IllegalResult,null);return c}if(i===p)return null;throw i===F?new s(a,l.IllegalResult,null):i===k?new s(a,l.IllegalResult,null):new s(a,l.NeverReach,null)})}et([me]);export{St as executeScript,et as extend,bt as functionHelper};
