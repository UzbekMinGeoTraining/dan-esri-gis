import{a as D,b as K,c as $,d as _,e as S}from"./chunk-ZEZQI55V.js";import{a as Q}from"./chunk-VWZEQZNT.js";import"./chunk-YRCMQA7S.js";import"./chunk-DKD4OKJ2.js";import"./chunk-M2LOI65L.js";import{a as h}from"./chunk-MAZHSYWX.js";import{a as q}from"./chunk-7I5SNEJE.js";import"./chunk-S2YELA2I.js";import{a as J}from"./chunk-Y63DBETK.js";import{c as F}from"./chunk-X4XHTJSF.js";import"./chunk-YIBWVOPM.js";import"./chunk-PY5WUUCV.js";import{a as W}from"./chunk-R3XRMWAK.js";import{a as k}from"./chunk-PL6CVK2A.js";import"./chunk-J2R7NR2E.js";import"./chunk-VPH54J3G.js";import{a as H}from"./chunk-OD6TX477.js";import{a as U}from"./chunk-ISUG5L3D.js";import"./chunk-FOAEOOK3.js";import"./chunk-Q6ZVH4MK.js";import"./chunk-GKUDWGVQ.js";import"./chunk-EYI3QUAE.js";import"./chunk-NH3JQE75.js";import"./chunk-DBLGLVAQ.js";import"./chunk-63EK7JRZ.js";import"./chunk-HVNRUZWJ.js";import"./chunk-6EZNY6L4.js";import"./chunk-3IK5VXZ3.js";import"./chunk-EN6CTWVM.js";import"./chunk-EJO53FLN.js";import"./chunk-F7VAE37R.js";import{h as z,t as G}from"./chunk-FW33MEBA.js";import"./chunk-RM6CXOHZ.js";import"./chunk-AOA5JMXK.js";import"./chunk-TWW3KW7Z.js";import"./chunk-HWN5REN7.js";import"./chunk-XTES2GPX.js";import"./chunk-2HUIJUS4.js";import"./chunk-VDNXTMSC.js";import{a as M}from"./chunk-MBJHSEMD.js";import"./chunk-SEKMXZL5.js";import"./chunk-2R4SNL6O.js";import{a as A}from"./chunk-MXOOOTCV.js";import"./chunk-7D4IYTAJ.js";import"./chunk-TSNWBMBA.js";import"./chunk-GLWPOGYF.js";import"./chunk-YFBPRKIN.js";import"./chunk-P2YRCTWM.js";import"./chunk-OFZ6SV37.js";import"./chunk-LAJXTVEO.js";import"./chunk-5MNDZ6BX.js";import"./chunk-YSOJWUIW.js";import"./chunk-Q5WFUDPQ.js";import"./chunk-T7BKG6V3.js";import"./chunk-R6VC74T7.js";import{e as N}from"./chunk-6WKJD7BM.js";import"./chunk-3CR7P5WT.js";import"./chunk-QNZSBADV.js";import"./chunk-PYQRTZNZ.js";import"./chunk-S4PLWG55.js";import"./chunk-DZAY272R.js";import"./chunk-GYH7NDHH.js";import"./chunk-S3UQHW42.js";import{c}from"./chunk-VQHENXDQ.js";import{a as I}from"./chunk-VWF5VUO3.js";import"./chunk-HRP5LYWJ.js";import"./chunk-BIVFGNT6.js";import"./chunk-EUZMXXZJ.js";import"./chunk-7PEPFLZH.js";import{a as V}from"./chunk-BRVOQZDM.js";import"./chunk-3M7VXIQH.js";import{a as O}from"./chunk-TBYT66N3.js";import"./chunk-5PTS4JDF.js";import"./chunk-MUI46NAG.js";import{u as B,y as C}from"./chunk-N27U3N2T.js";import{a as x}from"./chunk-4R5NBZMW.js";import{a as j}from"./chunk-NDYVXEZ5.js";import{a as T}from"./chunk-CMMPCPP5.js";import{m as P}from"./chunk-4DLSYLKE.js";import"./chunk-VPXBKZQM.js";import"./chunk-ZTKK3KB7.js";import{a as L}from"./chunk-GZXWFBZI.js";import"./chunk-B7IARA3F.js";import"./chunk-IZVEJCCI.js";import"./chunk-TEY6TKJV.js";import"./chunk-4M6XQSBA.js";import"./chunk-2JF6YUJG.js";import{Q as a,m as f}from"./chunk-GGZQ5GCM.js";import{U as w}from"./chunk-TFUPB3ZG.js";import"./chunk-ANPNMGFG.js";import{a as i}from"./chunk-BMVJCP2M.js";import{D as b,l as R}from"./chunk-GMC3I5VG.js";import"./chunk-WGF2T2BG.js";import"./chunk-YZP43POT.js";import"./chunk-VEDIBGHD.js";import{r as g,t as u}from"./chunk-3IBUFXWY.js";import"./chunk-BP73DJTS.js";import{a as E,g as m}from"./chunk-JEGVIFEP.js";var ee={key:"type",defaultKeyValue:"image",base:$,typeMap:{image:_,video:S}},X=c.ofType(ee),d=class extends V.LoadableMixin(O(I.EventedAccessor)){constructor(e){super(e),this._index=new q,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=t=>{for(let r of t.removed){let s=this._elementViewsMap.get(r);this._elementViewsMap.delete(r),this._index.delete(s),this.removeHandles(s),s.destroy(),this.notifyChange("fullExtent")}let{spatialReference:o}=this;for(let r of t.added){if(this._elementViewsMap.get(r))continue;let s=new Q({spatialReference:o,element:r});this._elementViewsMap.set(r,s);let l=M(()=>s.coords,()=>this._updateIndexForElement(s,!1));this._updateIndexForElement(s,!0),this.addHandles(l,s)}this._elementsIndexes.clear(),this.elements.forEach((r,s)=>this._elementsIndexes.set(r,s)),this.emit("refresh")},this.elements=new X}load(e){return m(this,null,function*(){if(R(e),!this.spatialReference){let t=this.elements.find(o=>o.georeference?.coords!=null);this._set("spatialReference",t?t.georeference.coords.spatialReference:j.WGS84)}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.addHandles(this.elements.on("change",this._elementsChangedHandler)),this})}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(e){this._set("elements",A(e,this._get("elements"),X))}get fullExtent(){if(this.loadStatus==="not-loaded")return null;let e=this._index.fullBounds;return e==null?null:new C({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){this.loadStatus==="not-loaded"?this._set("spatialReference",e):g.getLogger(this).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}queryElements(e,t){return m(this,null,function*(){yield this.load(),yield G(e.spatialReference,this.spatialReference,null,t);let o=P(e.spatialReference,this.spatialReference)?e:z(e,this.spatialReference);if(!o)return[];let r=o.normalize(),s=[];for(let l of r)this._index.forEachInBounds(N(l),({normalizedCoords:y,element:Z})=>{y!=null&&B(l,y)&&s.push(Z)});return s.sort((l,y)=>this._elementsIndexes.get(l)-this._elementsIndexes.get(y)),s})}hasElement(e){return this.elements.includes(e)}_updateIndexForElement(e,t){let o=e.normalizedBounds,r=this._index.has(e),s=o!=null;this._index.delete(e),s&&this._index.set(e,o),this.notifyChange("fullExtent"),t||(r!==s?this.emit("refresh"):this.emit("change",{element:e.element}))}};i([a()],d.prototype,"elements",null),i([a({readOnly:!0})],d.prototype,"fullExtent",null),i([a()],d.prototype,"spatialReference",null),d=i([w("esri.layers.support.LocalMediaElementSource")],d);var p=d;function v(e){return typeof e=="object"&&e!=null&&"type"in e}function Y(e){return v(e)&&(e.type==="image"||e.type==="video")}var n=class extends F(W(k(J(H(U))))){constructor(e){super(e),this.effectiveSource=null,this.georeference=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this._debouncedSaveOperations=b((t,o,r)=>m(this,null,function*(){let{save:s,saveAs:l}=yield import("./chunk-TWWFPA5Q.js");switch(t){case h.SAVE:return s(this,o);case h.SAVE_AS:return l(this,r,o)}})),this.source=new p}load(e){return this.addResolvingPromise(this._doLoad(e)),Promise.resolve(this)}_doLoad(e){return m(this,null,function*(){yield this.loadFromPortal({supportedTypes:["Media Layer"]},e);let t=this.source;if(!t)throw new u("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer.");let o=this._getSourceOverride(t,this.georeference);o&&(this.setAtOrigin("source",o,"web-map"),this.setAtOrigin("source",o,"web-scene"),t=o);let r=v(t)?new p({elements:new c([t])}):t;this._set("effectiveSource",r),this.spatialReference&&(r.spatialReference=this.spatialReference),yield r.load(e),this.spatialReference=r.spatialReference})}destroy(){this.effectiveSource?.destroy(),this.effectiveSource!==this.source&&this.source?.destroy()}readGeoreference(e,t){return e&&"itemId"in t&&t.itemId?e:void 0}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}set source(e){this.loadStatus!=="loaded"&&this.loadStatus!=="failed"?this._set("source",e):g.getLogger(this).error("#source","source cannot be changed after the layer is loaded.")}castSource(e){return e?Array.isArray(e)?new p({elements:new c(e)}):e instanceof c?new p({elements:e}):e:null}readSource(e,t,o){if("itemId"in t&&t.itemId)return;let r=this._createSource(t);return r?.read(t,o),r}writeSource(e,t,o,r){if(e&&e instanceof p){let s=e.elements.length;if(s!==1)return void(r?.messages&&r.messages.push(new u("media-layer:unsupported-source",`local media element source can only be persisted if it contains exactly one ImageElement, but it has ${s}.`)));e=e.elements.at(0)}Y(e)?e.write(t,r):r?.messages&&(e?r.messages.push(new u("media-layer:unsupported-source","only media elements of type 'ImageElement' or 'VideoElement' can be persisted")):r.messages.push(new u("media-layer:unsupported-source","the media layer is missing a source")))}save(e){return m(this,null,function*(){return this._debouncedSaveOperations(h.SAVE,e)})}saveAs(e,t){return m(this,null,function*(){return this._debouncedSaveOperations(h.SAVE_AS,t,e)})}_createSource(e){if("mediaType"in e)switch(e.mediaType){case"image":return new _;case"video":return new S}return null}_getSourceOverride(e,t){if(v(e)&&this.originIdOf("source")===f.PORTAL_ITEM&&t&&(this.originIdOf("georeference")===f.WEB_MAP||this.originIdOf("georeference")===f.WEB_SCENE)){let o=e.toJSON(),r=this._createSource(o);return r.read(E({},o),{origin:"portal-item"}),r.read({georeference:t},{origin:"web-map"}),r.read({georeference:t},{origin:"web-scene"}),r}return null}};i([a({readOnly:!0})],n.prototype,"effectiveSource",void 0),i([a({readOnly:!0,json:{read:!1,write:!1,origins:{"web-document":{read:!0}}}})],n.prototype,"georeference",void 0),i([x("web-document","georeference")],n.prototype,"readGeoreference",null),i([a({type:String})],n.prototype,"copyright",void 0),i([a({readOnly:!0})],n.prototype,"fullExtent",null),i([a({type:["MediaLayer"]})],n.prototype,"operationalLayerType",void 0),i([a({type:["show","hide"]})],n.prototype,"listMode",void 0),i([a({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1,target:{url:{type:String},mediaType:{type:["image","video"]},georeference:{type:D}},overridePolicy(e,t,o){return{enabled:!0,allowNull:!1,ignoreOrigin:K(this,o?.origin)&&Y(e)&&!!e.georeference&&e.originIdOf("georeference")>f.PORTAL_ITEM}}}}})],n.prototype,"source",null),i([L("source")],n.prototype,"castSource",null),i([x("source",["url"])],n.prototype,"readSource",null),i([T("source")],n.prototype,"writeSource",null),i([a()],n.prototype,"spatialReference",void 0),i([a({readOnly:!0})],n.prototype,"type",void 0),n=i([w("esri.layers.MediaLayer")],n);var et=n;export{et as default};
