import{a as Te,b as Ae}from"./chunk-PDFLS2XB.js";import{a as xe,c as Re}from"./chunk-NJ2A46RA.js";import{b as Ce}from"./chunk-BJAL3HBH.js";import{b as ve}from"./chunk-TKXAXJNG.js";import{a as Se}from"./chunk-D3BMTQYU.js";import{c as Ve,q as De}from"./chunk-4DR6EKLV.js";import{b as Le}from"./chunk-IW2AVHBW.js";import{a as pe}from"./chunk-H4XRNT5U.js";import{b as ge,c as Pe,d as be}from"./chunk-VHVYC3RW.js";import{g as ye}from"./chunk-ZBOVC36T.js";import{a as Ee,b as m}from"./chunk-J7UK2QPE.js";import{b as q,c as me}from"./chunk-3AMG6HG6.js";import{a as A,b as M}from"./chunk-N6PITG7Q.js";import{g as fe}from"./chunk-MJXFSFCY.js";import{a as oe,b as he,c as ce,d as de,l as ue}from"./chunk-PTVRFY4B.js";import{a as S,c as V,d as ae}from"./chunk-3ZOLHUAU.js";import{a as F}from"./chunk-M2F4B74F.js";import{a as _e}from"./chunk-BXR2KKYP.js";import{d as le}from"./chunk-OFGHVREP.js";import{a as ne}from"./chunk-26R336GJ.js";import{a as L}from"./chunk-GB5RQL32.js";import{c as n}from"./chunk-4OZVVJHM.js";import{f as j}from"./chunk-X7XJWAFC.js";import{a as Y,m as $}from"./chunk-EPTSNNZF.js";import{a as re}from"./chunk-4RLJMQW4.js";import{b as N}from"./chunk-J6ZRC6RI.js";import{a as r}from"./chunk-7W6RATG7.js";import{a as W,b as ie,r as se}from"./chunk-BDF7KEUQ.js";import{b as E,c as y,d as ee,e as te}from"./chunk-2HUIJUS4.js";import{c as G}from"./chunk-YRTBL7EE.js";import{a as O,m as H}from"./chunk-3FPO2LOS.js";import{a,b as z,c as B}from"./chunk-PYQRTZNZ.js";import{b as K,h as Q}from"./chunk-5PTS4JDF.js";import{Q as T}from"./chunk-GGZQ5GCM.js";import{U as J}from"./chunk-TFUPB3ZG.js";import{a as o}from"./chunk-BMVJCP2M.js";import{c as k}from"./chunk-WGF2T2BG.js";var w=class extends _e{constructor(){super(...arguments),this.innerColor=B(1,1,1),this.innerWidth=1,this.glowColor=B(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=Q(6),this.pointDistanceOrigin=a(),this.pointDistanceTarget=a(),this.lineVerticalPlaneSegment=S(),this.intersectsLineSegment=S(),this.intersectsLineRadius=3,this.heightManifoldTarget=a(),this.lineStartWorld=a(),this.lineEndWorld=a()}},I=class extends M{constructor(e,i,s){super(e,i,new A(Re,()=>import("./chunk-J5QIMYOF.js")),s)}};var U=class extends w{constructor(){super(...arguments),this.origin=a()}},D=class extends M{constructor(e,i,s){super(e,i,new A(Ce,()=>import("./chunk-ADONEALK.js")),s,X)}},X=new Map([[r.START,0],[r.END,1],[r.EXTRUDE,2],[r.START_UP,3],[r.END_UP,4]]);var v=class{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=a(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){let i=Y(3*e.length),s=0;for(let l of e)i[s++]=l[0],i[s++]=l[1],i[s++]=l[2];this.buffers=[i]}set buffers(e){if(this._buffers=e,this._buffers.length>0){let i=this._buffers[0],s=3*Math.floor(i.length/3/2);y(this._origin,i[s],i[s+1],i[s+2])}else y(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){let i=this._ensureVAO(e);i!=null&&(e.bindVAO(i),e.drawArrays(ie.TRIANGLES,0,this._count))}dispose(){this._vao!=null&&this._vao.dispose()}get _layout(){return this._renderCoordsHelper.viewingMode===L.Global?Be:Oe}_ensureVAO(e){return this._buffers==null?null:(this._vao??=this._createVAO(e,this._buffers),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,i){let s=this._createDataBuffer(i);return this._dirty=!1,new pe(e,X,new Map([["data",re(this._layout)]]),new Map([["data",ne.createVertex(e,se.STATIC_DRAW,s)]]))}_ensureVertexData(e,i){if(!this._dirty)return;let s=this._createDataBuffer(i);e.vertexBuffers.get("data")?.setData(s),this._dirty=!1}_createDataBuffer(e){let i=e.reduce((c,d)=>c+Me(d),0);this._count=i;let s=this._layout.createBuffer(i),l=this._origin,_=0,u=0,h="startUp"in s?this._setUpVectors.bind(this,s):void 0;for(let c of e){for(let d=0;d<c.length;d+=3){let C=y(qe,c[d],c[d+1],c[d+2]);d===0?u=this._renderCoordsHelper.getAltitude(C):this._renderCoordsHelper.setAltitude(C,u);let p=_+2*d;h?.(d,p,c,C);let Z=te(qe,C,l);if(d<c.length-3){for(let b=0;b<6;b++)s.start.setVec(p+b,Z);s.extrude.setValues(p,0,-1),s.extrude.setValues(p+1,1,-1),s.extrude.setValues(p+2,1,1),s.extrude.setValues(p+3,0,-1),s.extrude.setValues(p+4,1,1),s.extrude.setValues(p+5,0,1)}if(d>0)for(let b=-6;b<0;b++)s.end.setVec(p+b,Z)}_+=Me(c)}return s.buffer}_setUpVectors(e,i,s,l,_){let u=this._renderCoordsHelper.worldUpAtPosition(_,ze);if(i<l.length-3)for(let h=0;h<6;h++)e.startUp.setVec(s+h,u);if(i>0)for(let h=-6;h<0;h++)e.endUp.setVec(s+h,u)}};function Me(t){return 3*(2*(t.length/3-1))}var ze=a(),qe=a(),Be=N().vec3f(r.START).vec3f(r.END).vec2f(r.EXTRUDE).vec3f(r.START_UP).vec3f(r.END_UP),Oe=N().vec3f(r.START).vec3f(r.END).vec2f(r.EXTRUDE);var f=class extends Ee{constructor(){super(...arguments),this.contrastControlEnabled=!1,this.spherical=!1}};o([m()],f.prototype,"contrastControlEnabled",void 0),o([m()],f.prototype,"spherical",void 0);var g=class extends f{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1}};o([m()],g.prototype,"heightManifoldEnabled",void 0),o([m()],g.prototype,"pointDistanceEnabled",void 0),o([m()],g.prototype,"lineVerticalPlaneEnabled",void 0),o([m()],g.prototype,"intersectsLineEnabled",void 0);var P=class extends me{constructor(t){super(t),this.produces=q.LASERLINES,this.consumes={required:[q.LASERLINES,"normals"]},this.requireGeometryDepth=!0,this._configuration=new g,this._pathTechniqueConfiguration=new f,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._passParameters=new U;let e=t.view._stage.renderView.techniques,i=new f;i.contrastControlEnabled=t.contrastControlEnabled,e.precompile(D,i)}initialize(){this._passParameters.renderCoordsHelper=this.view.renderCoordsHelper,this._pathTechniqueConfiguration.spherical=this.view.state.viewingMode===L.Global,this._pathTechniqueConfiguration.contrastControlEnabled=this.contrastControlEnabled,this._techniques.precompile(D,this._pathTechniqueConfiguration),this._blit=new ve(this._techniques,Se.PremultipliedAlpha)}destroy(){this._pathVerticalPlaneData=k(this._pathVerticalPlaneData),this._blit=null}get _techniques(){return this.view._stage.renderView.techniques}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(t){this._heightManifoldEnabled!==t&&(this._heightManifoldEnabled=t,this.requestRender(n.UPDATE))}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(t){E(this._passParameters.heightManifoldTarget,t),this.requestRender(n.UPDATE)}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(t){t!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=t,this.requestRender(n.UPDATE))}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(t){E(this._passParameters.pointDistanceTarget,t),this.requestRender(n.UPDATE)}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(t){E(this._passParameters.pointDistanceOrigin,t),this.requestRender(n.UPDATE)}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(t){t!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=t,this.requestRender(n.UPDATE))}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(t){V(t,this._passParameters.lineVerticalPlaneSegment),this.requestRender(n.UPDATE)}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(t){t!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=t,this.requestRender(n.UPDATE))}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(t){V(t,this._passParameters.intersectsLineSegment),this.requestRender(n.UPDATE)}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(t){t!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=t,this.requestRender(n.UPDATE))}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(t){t!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=t,this.requestRender(n.UPDATE))}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(t){t!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=t,this._pathVerticalPlaneData!=null&&this.requestRender(n.UPDATE))}set pathVerticalPlaneVertices(t){this._pathVerticalPlaneData==null&&(this._pathVerticalPlaneData=new v(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=t,this.pathVerticalPlaneEnabled&&this.requestRender(n.UPDATE)}set pathVerticalPlaneBuffers(t){this._pathVerticalPlaneData==null&&(this._pathVerticalPlaneData=new v(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=t,this.pathVerticalPlaneEnabled&&this.requestRender(n.UPDATE)}setParameters(t){fe(this._passParameters,t)&&this.requestRender(n.UPDATE)}precompile(){this._acquireTechnique().release()}render(t){let e=t.find(({name:u})=>u===q.LASERLINES);if(!this.bindParameters.decorations||this._blit==null)return e;let i=this.renderingContext,s=t.find(({name:u})=>u==="normals");this._passParameters.normals=s?.getTexture();let l=()=>{(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(),this.pathVerticalPlaneEnabled&&this._renderPath()};if(!this.contrastControlEnabled)return i.bindFramebuffer(e.fbo),l(),e;this._passParameters.colors=e.getTexture();let _=this.fboCache.acquire(e.fbo.width,e.fbo.height,"laser lines");return i.bindFramebuffer(_.fbo),i.setClearColor(0,0,0,0),i.clear(W.COLOR|W.DEPTH),l(),i.unbindTexture(e.getTexture()),this._blit.blend(i,_,e,this.bindParameters)||this.requestRender(n.UPDATE),_.release(),e}_acquireTechnique(){return this._configuration.heightManifoldEnabled=this.heightManifoldEnabled,this._configuration.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._configuration.pointDistanceEnabled=this.pointDistanceEnabled,this._configuration.intersectsLineEnabled=this.intersectsLineEnabled,this._configuration.contrastControlEnabled=this.contrastControlEnabled,this._configuration.spherical=this.view.state.viewingMode===L.Global,this._techniques.acquire(I,this._configuration)}_renderUnified(){if(!this._updatePassParameters())return;let t=this._acquireTechnique();if(t.compiled){let e=this.renderingContext;e.bindTechnique(t,this.bindParameters,this._passParameters),e.screen.draw()}else this.requestRender(n.UPDATE);t.release()}_renderPath(){if(this._pathVerticalPlaneData==null)return;let t=this._techniques.acquire(D,this._pathTechniqueConfiguration);if(t.compiled){let e=this.renderingContext;this._passParameters.origin=this._pathVerticalPlaneData.origin,e.bindTechnique(t,this.bindParameters,this._passParameters),this._pathVerticalPlaneData.draw(e)}else this.requestRender(n.UPDATE);t.release()}_updatePassParameters(){if(!this._intersectsLineEnabled)return!0;let t=this.bindParameters.camera,e=this._passParameters;if(this._intersectsLineInfinite){if(he(le(e.intersectsLineSegment.origin,e.intersectsLineSegment.vector),x),x.c0=-Number.MAX_VALUE,!ue(t.frustum,x))return!1;ce(x,e.lineStartWorld),de(x,e.lineEndWorld)}else E(e.lineStartWorld,e.intersectsLineSegment.origin),ee(e.lineEndWorld,e.intersectsLineSegment.origin,e.intersectsLineSegment.vector);return!0}get test(){}};o([T({constructOnly:!0})],P.prototype,"contrastControlEnabled",void 0),o([T({constructOnly:!0})],P.prototype,"isDecoration",void 0),o([T()],P.prototype,"produces",void 0),o([T()],P.prototype,"consumes",void 0),P=o([J("esri.views.3d.webgl-engine.effects.laserlines.LaserLineRenderer")],P);var x=oe();var we=class extends Te{constructor(e){super(e),this._angleCutoff=xe,this._style={},this._heightManifoldTarget=a(),this._heightManifoldEnabled=!1,this._intersectsLine=S(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){e!=null?(E(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(e==null)return void(this.intersectsLine=null);let i=this.view.renderCoordsHelper.worldUpAtPosition(e,He);this.intersectsLine=ae(e,i),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){e!=null?(V(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=e!=null?V(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=e!=null?{origin:z(e.origin),target:e.target?z(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||this._pointDistanceLine!=null||this._pathVerticalPlaneBuffers!=null)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){this._renderer==null&&(this._renderer=new P({view:this.view,contrastControlEnabled:!0,isDecoration:this.isDecoration}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff())}_syncStyle(){this._renderer!=null&&(this._renderer.setParameters(this._style),this._style.intersectsLineRadius!=null&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){this._renderer!=null&&this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){this._renderer!=null&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){this._renderer!=null&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){this._renderer!=null&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){this._renderer!=null&&(this._renderer.pathVerticalPlaneEnabled=this._pathVerticalPlaneBuffers!=null&&this.visible,this._pathVerticalPlaneBuffers!=null&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){this._renderer!=null&&(this._renderer.lineVerticalPlaneEnabled=this._lineVerticalPlaneSegment!=null&&this.visible,this._lineVerticalPlaneSegment!=null&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(this._renderer==null)return;let e=this._pointDistanceLine,i=e!=null;this._renderer.pointDistanceEnabled=i&&e.target!=null&&this.visible,i&&(this._renderer.pointDistanceOrigin=e.origin,e.target!=null&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){this._renderer!=null&&this.view._stage&&(this._renderer.destroy(),this._renderer=null)}},He=a();var Ie=class extends Ae{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=G(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=G(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){let i=this._preferredTextureSize;this._size=e,i<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){H(e,this._color)||(O(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){H(e,this._outlineColor)||(O(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material?.setParameters(this._materialParameters)}_updateSizeAttribute(){let e=this.object;if(e==null)return;let i=e.geometries[0];if(i==null)return;let s=i.getMutableAttribute(r.SIZE).data,l=this._geometrySize;s[0]=l,s[1]=l,e.geometryVertexAttributeUpdated(e.geometries[0],r.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:Pe(this._primitive),distanceFieldBoundingBox:Ge,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/R}createExternalResources(){this._texture=be(this._primitive,this._preferredTextureSize),this._material=new Le(this._materialParameters,this.view.state.viewingMode===L.Global);let e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){let i=this._createRenderGeometry();i!=null&&e.addGeometry(i)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return K(2*this._geometrySize,16,128)}calculateMapBounds(e){let i=this.object?.geometries[0];if(!i)return!1;let s=i.attributes.get(r.POSITION).data;return F(s,this.view.renderCoordsHelper.spatialReference,Ue,this.view.spatialReference),$(e,Ue),!0}_createRenderGeometry(){let{geometry:e,_material:i}=this;if(e==null||i==null)return null;let{renderCoordsHelper:s,elevationProvider:l}=this.view,_=Ve(e,l,De.fromElevationInfo(this.elevationInfo),s),u=y(j.get(),e.x,e.y,_),h=j.get();F(u,e.spatialReference,h,s.spatialReference);let c=this._geometrySize;return ye(i,null,h,null,null,[c,c],[0,0,0,1])}},R=ge,Ge=[R/2,R/2,1-R/2,1-R/2],Ue=a();export{we as a,Ie as b};
