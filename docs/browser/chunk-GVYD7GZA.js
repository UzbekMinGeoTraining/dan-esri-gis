import{b as G}from"./chunk-LZJYAKDL.js";import{c as at}from"./chunk-2SZOQMAQ.js";import{a as Ne}from"./chunk-QCDIRHTH.js";import{a as Se,b as Jt}from"./chunk-XI5TLVWU.js";import{a as Fe,b as ot}from"./chunk-T6V6CYCJ.js";import{b as Xt}from"./chunk-6ISQQD7M.js";import{o as _e}from"./chunk-PTVRFY4B.js";import{a as jt,b as kt,e as Vt}from"./chunk-3ZOLHUAU.js";import{a as ue}from"./chunk-M2F4B74F.js";import{b as qt,f as Wt,m as Bt}from"./chunk-7ISKCG7U.js";import{d as Pe}from"./chunk-OFGHVREP.js";import{a as le}from"./chunk-GB5RQL32.js";import{I as Ut,K as rt,R as ce,S as Gt,T as zt,o as Ht,u as tt,z as nt}from"./chunk-X7XJWAFC.js";import{a as se,b as Lt}from"./chunk-7X2HMUNN.js";import{a as be}from"./chunk-XXOIKNT6.js";import{h as Ye,q as It}from"./chunk-FW33MEBA.js";import{a as Ft,b as et,c as Nt}from"./chunk-HWN5REN7.js";import{w as Dt}from"./chunk-XTES2GPX.js";import{H as _t,I as $e,a as S,b as P,c as Ot,d as B,e as X,n as w,o as Re,p as ae,q as Qe,s as bt,u as ne,v as C,w as U,x as Pt,y as ie}from"./chunk-2HUIJUS4.js";import{j as St,k as wt,p as vt,s as Et}from"./chunk-5MNDZ6BX.js";import{o as Me}from"./chunk-T7BKG6V3.js";import{h as De}from"./chunk-R6VC74T7.js";import{p as Rt}from"./chunk-6WKJD7BM.js";import{a as Ct}from"./chunk-YRTBL7EE.js";import{c as xt,h as At}from"./chunk-3FPO2LOS.js";import{a as Ke}from"./chunk-QNZSBADV.js";import{a as f,b as Oe,c as W,i as Ze}from"./chunk-PYQRTZNZ.js";import{b as Mt,f as Je,h,i as v,k as ye,l as H}from"./chunk-5PTS4JDF.js";import{h as yt,l as T,y as Ie}from"./chunk-N27U3N2T.js";import{a as Te}from"./chunk-NDYVXEZ5.js";import{J as F,j as oe}from"./chunk-4DLSYLKE.js";import{l as b}from"./chunk-GMC3I5VG.js";import{r as Tt}from"./chunk-3IBUFXWY.js";import{a as ht,b as gt,g as L}from"./chunk-JEGVIFEP.js";var Ln=f(),Le=f();function He(){return{direction:f(),up:f()}}function Ue(e,t,n,r,o){let a=ne(Ln,e),i=C(a,r),s=i>0;i=Math.abs(i),i>.99&&(i=Math.abs(C(t,r)),i<.99?(P(a,t),s&&w(a,a,-1)):a=null);let c=0;if(a){w(Le,r,C(r,a)),X(a,a,Le);let u=C(a,o)/(S(a)*S(o));U(Le,a,o),c=(C(Le,r)>0?1:-1)*v(ye(u))}let l=v(ye(-C(r,e)/S(e)));return n?(n.heading=c,n.tilt=l,n):{heading:c,tilt:l}}function Ge(e,t,n,r){X(Zt,n,t),Ut(r,kt(t,Zt),e)||e===n||P(e,n)}var Zt=f();function Br(e,t,n,r){return e.renderCoordsHelper.fromRenderCoords(t.eye,ze,r)!=null&&Rt(n,ze)}function Hn(e,t){return e.elevationProvider?e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function Qt(e,t,n,r){let o=e.state.camera.clone();t&&n&&r&&(o.eye=t,o.center=n,o.up=r),Un(e,o.ray,J)||P(J,o.center);let a=e.state.constraints,i=a.minimumPoiDistance;if(Qe(o.eye,J)<i){let s=a.collision.enabled;P(re,o.viewForward),w(re,re,i),s?o.eye=X(ze,J,re):B(J,o.eye,re);let c=e.renderCoordsHelper,l=c.getAltitude(o.eye),u=a.collision.elevationMargin;s&&l<u&&(X(re,J,o.eye),o.eye=c.setAltitude(ze,u,o.eye),B(J,o.eye,re))}return o.center=J,o}function Kt(e,t,n){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;let r=Hn(e,t),o=e.stateManager.constraintsManager.nearFarHeuristic,{far:a}=o.compute(t,n,e.renderDataExtent,r,zn),i=a*a;return Qe(t,n)>i}function Un(e,t,n){let r=Yt[e.viewingMode];r||(r=Xt(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,Yt[e.viewingMode]=r);let{isGlobal:o}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,n)||Kt(e,t.origin,n))||!(!e.renderCoordsHelper.intersectManifold(t,0,n)||Kt(e,t.origin,n))||!!o&&Gn(t,n,F(e.spatialReference).radius)}function Gn(e,t,n){let r=C(e.origin,e.origin)-n*n,o=r>0?Math.sqrt(r)/3:1;return w(t,e.direction,o/S(e.direction)),B(t,t,e.origin),!0}var Yt={},ze=f(),J=f(),re=f(),zn={near:0,far:0};function $t(e,t){let n=[],r=[];return je(n,e,t,N.LEFT),je(r,n,t,N.BOTTOM),je(n,r,t,N.RIGHT),je(r,n,t,N.TOP),r}function je(e,t,n,r){let o=jn(n,r);if(e.length=0,t.length){o(ke,t[0],t[0])===I.INSIDE&&we(e,t[0]);for(let a=0;a<t.length;a++){let i=t[a===t.length-1?0:a+1];switch(o(ke,t[a],i)){case I.INSIDE:we(e,i);break;case I.INSIDE_OUT:we(e,et(ke));break;case I.OUTSIDE_IN:we(e,et(ke)),we(e,i);case I.OUTSIDE:}}}}function we(e,t){e.length!==0&&Dt(e.at(-1),t)||e.push(t)}function jn(e,t){let n=t===N.LEFT||t===N.RIGHT?0:1,r=e[t],o=t===N.LEFT||t===N.BOTTOM?fe.MIN:fe.MAX,a=n===0?1:0;return(i,s,c)=>{if(s[n]<r&&c[n]<r)return o===fe.MIN?I.OUTSIDE:I.INSIDE;if(s[n]>r&&c[n]>r)return o===fe.MIN?I.INSIDE:I.OUTSIDE;let l=(c[a]-s[a])/(c[n]-s[n]),u=s[a]+l*(r-s[n]);return i[n]=r,i[a]=u,(s[n]<r?1:-1)*o>0?I.OUTSIDE_IN:I.INSIDE_OUT}}var fe,I,N;(function(e){e[e.MIN=1]="MIN",e[e.MAX=-1]="MAX"})(fe||(fe={})),function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE_IN=2]="OUTSIDE_IN",e[e.INSIDE_OUT=3]="INSIDE_OUT"}(I||(I={})),function(e){e[e.LEFT=0]="LEFT",e[e.BOTTOM=1]="BOTTOM",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP"}(N||(N={}));var ke=Ft();var en=W(0,1,0),tn=W(0,0,1),ve=be(),z=f(),j=f();function nn(e,t,n,r=He()){let{direction:o,up:a}=r;return Et(ve,-h(t)),wt(ve,ve,h(n)),ie(o,tn,ve),w(o,o,-1),ie(a,en,ve),r}function kn(e,t,n,r){return Ue(t,n,r,tn,en)}function Vn(e,t,n,r){let o=nn(e,n,r),a=f();return w(a,o.direction,-t),B(a,a,e),{up:o.up,eye:a,heading:n,tilt:r}}function qn(e){return v(e)}function Wn(e){return h(e)}function Bn(e,t,n,r,o){let a=e.renderSpatialReference,i=e.spatialReference??t.spatialReference;return se(t,z,a),se(t,j,a),z[0]-=n/2,j[0]+=n/2,z[1]-=r/2,j[1]+=r/2,ue(z,a,z,i),ue(j,a,j,i),o?(o.xmin=z[0],o.ymin=z[1],o.xmax=j[0],o.ymax=j[1],o.spatialReference=i):o=new Ie(z[0],z[1],j[0],j[1],i),o}function Xn(e,t){let n=e.frustum,{renderCoordsHelper:r}=e,o=r.getAltitude(t),a=e.spatialReference,i=e.state.camera.eye,s=[],c=n.planes[_e.FAR];for(let l=0;l<4;l++){let u=n.lines[l];r.intersectInfiniteManifold(Pe(u.origin,u.direction),o,_)||Jn(_,n,r,u.endpoint,o),Ge(_,i,_,c),s.push(Nt(_[0],_[1]))}return Zn($t(s,r.extent),r,a)}function Jn(e,t,n,r,o){let a=t.lines[G.FAR_LEFT].direction,i=(o-n.getAltitude(r))/a[2];Re(e,r,a,i)}function Zn(e,t,n){let r=e.map(o=>(Ot(_,o[0],o[1],0),t.fromRenderCoords(_,_,n),[_[0],_[1]]));return r.length<=2?new Me({spatialReference:n}):(r.push(r[0].slice()),De(r)||r.reverse(),new Me({rings:[r],spatialReference:n}))}var _=f(),rn=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:kn,eyeForCenterWithHeadingTilt:Vn,eyeTiltToLookAtTilt:Wn,headingTiltToDirectionUp:nn,lookAtTiltToEyeTilt:qn,toArea:Xn,toExtent:Bn},Symbol.toStringTag,{value:"Module"}));function an(e,t,n){e.worldUpAtPosition(t,on),X(it,n,t);let r=S(it);return r===0?0:ye(C(it,on)/r)}var on=f(),it=f();function sn(e,t,n){if(t.longitude==null||t.latitude==null||n.longitude==null||n.latitude==null)throw new Error("Invalid points: no lon/lat");return Kn(e,t.longitude,t.latitude,n.longitude,n.latitude)}function Kn(e,t,n,r,o){let a=h(n),i=h(o),s=a-i,c=h(t)-h(r),l=Math.sin(s/2),u=Math.sin(c/2),m=2*H(Math.sqrt(l*l+Math.cos(a)*Math.cos(i)*u*u))*e;return Math.round(1e4*m)/1e4}function cn(e,t,n){let r=t.spatialReference,o=F(r),a=new T(t.x,e.y,r),i=new T(n.x,e.y,r),s=new T(e.x,t.y,r),c=new T(e.x,n.y,r);return{lon:sn(o.radius,a,i),lat:sn(o.radius,s,c)}}function ln(e,t,n){let r=t/n,o=h(e),a=Math.sin(r/2),i=Math.cos(o),s=2*H(Math.sqrt(a*a/(i*i)));return v(s)}function Yn(e,t){let n=e/15;return t||(n=Math.round(n)),n}function vo(e,t){let n=e?.[0];if(n==null)return null;t||(t={hours:0,minutes:0,seconds:0}),t.hours=Yn(n,!0);let r=t.hours%1;t.hours-=r,t.minutes=60*r;let o=t.minutes%1;return t.minutes-=o,t.seconds=Math.round(60*o),t}var fn=W(0,0,1),mn=ne(f(),W(1,1,1)),Qn=new Se(-180,180),Ee=be(),Z=f(),me=f();function pn(e,t,n,r=He()){U(Z,e,fn),C(Z,Z)===0&&U(Z,e,mn),vt(Ee,-h(t),e),St(Ee,Ee,-h(n),Z);let{up:o,direction:a}=r;return U(o,Z,e),ne(o,o),ie(o,o,Ee),ne(a,e),bt(a,a),ie(a,a,Ee),r}function $n(e,t,n,r){let o=Z,a=me;return ne(o,e),U(me,o,fn),C(me,me)===0&&U(me,o,mn),U(a,me,o),Ue(t,n,r,o,a)}function er(e,t,n,r){let o={eye:f(),up:null,tilt:r,heading:n},a=Z;a[0]=e[0],a[1]=e[2],a[2]=-e[1];let i=t,s=h(n),c=h(r),l=Math.sin(s),u=Math.cos(s),m=Math.sin(c),p=Math.cos(c),g=S(a),d;if(Math.abs(c)<1e-8)d=i+g;else{let Ae=g/m,Ce=H(i/Ae),Xe=Math.PI-c-Ce;d=Ae*Math.sin(Xe)}let x=p*i,O=i*i*(m*m),D=u*u*O,A=d-x,y=A*A,M=D*(D+y-a[1]*a[1]);if(M<0)return w(o.eye,a,d/g),o.tilt=0,Ve(o,e);let Q=Math.sqrt(M),k=a[1]*A,V=D+y,$;if($=u>0?-Q+k:Q+k,Math.abs(V)<1e-8)return g<1e-8?(o.eye[0]=0,o.eye[1]=0,o.eye[2]=i):w(o.eye,a,d/g),o.tilt=0,st(o.eye),Ve(o,e);o.eye[1]=$/V;let R=l*l*O,he=m*i,Be=u*he*o.eye[1],ge=o.eye[1]*o.eye[1],ee=1-ge,q=Math.sqrt(ee),te=D*ge+R-2*Be*q*A+ee*y;return Math.abs(te)<1e-8?(w(o.eye,a,d/g),o.tilt=0,st(o.eye),Ve(o,e)):(o.eye[0]=(ee*(d*a[0]-x*a[0])-he*q*(a[0]*o.eye[1]*u+a[2]*l))/te,o.eye[2]=(ee*(d*a[2]-x*a[2])-he*q*(a[2]*o.eye[1]*u-a[0]*l))/te,w(o.eye,o.eye,d),st(o.eye),Ve(o,e))}function st(e){let t=e[1];e[1]=-e[2],e[2]=t}function Ve(e,t){let n=pn(t,e.heading,e.tilt);return e.up=n.up,e}function tr(e,t,n){let r=S(t),o=Math.sqrt(n*n+r*r-2*n*r*Math.cos(Math.PI-e)),a=H(n/(o/Math.sin(e)));return v(e-a)}function nr(e,t,n){let r=h(e),o=S(t);return H(n/(o/Math.sin(r)))+r}function rr(e,t,n,r,o){let a,i,s,c,l=t.latitude,u=F(e.spatialReference).radius,m=t.longitude,p=ln(l,n,u)/2;a=m-p,i=m+p;let g=h(l),d=(1+Math.sin(g))/(1-Math.sin(g)),x=(d+1)*Math.tan(r/u/2),O=x*x;function D(y){let M=Math.PI/2;return(y=Jt.normalize(y,-M))>M&&(y=Math.PI-y),y}if(s=1.5*Math.PI-2*Math.atan(.5*(x+Math.sqrt(4*d+O))),c=s+r/u,s=D(s),c=D(c),c<s){let y=c;c=s,s=y}if(s=Math.max(v(s),-90),c=Math.min(v(c),90),i=Qn.monotonic(a,i),i-a>180){let y=(i-a-180)/2;a+=y,i-=y}let A=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:Te.WGS84;return o?(o.xmin=a,o.ymin=s,o.xmax=i,o.ymax=c,o.spatialReference=A):o=new Ie(a,s,i,c,A),e.spatialReference&&e.spatialReference.isWebMercator&&yt(o,!1,o),o}function or(e,t){let n=e.frustum,{renderCoordsHelper:r}=e,o=r.getAltitude(t),a=e.spatialReference,i=r.referenceEllipsoid.radius,s=e.state.camera,c=s.eye,l=1+ae(c,t)/(i+o),u=Math.sqrt(l*l-1),{minCurvature:m,maxCurvature:p,minSamples:g,maxSamples:d}=cr,x=sr(e),O=Mt((u-m)/(p-m),0,1),D=Math.round(Je(g,d,O)),A=s.aboveGround,y=n.planes[_e.FAR],M=[],Q=nt(Ze,lr,tt()),k=nt(Ze,ur,tt());xt(ct,0,0,0,0);let V=R=>{};for(let R=0;R<4;R++){let he=R===G.NEAR_FAR_BOTTOM_RIGHT&&!A||R===G.NEAR_FAR_TOP_LEFT&&A?1-x:0,Be=R===G.NEAR_FAR_BOTTOM_RIGHT&&A||R===G.NEAR_FAR_TOP_LEFT&&!A?x:1,ge=n.lines[R],ee=n.lines[R===3?0:R+1];for(let q=0;q<D;q++){let te=q/D,Ae=R===G.NEAR_FAR_BOTTOM_RIGHT?1-(1-te)**2:R===G.NEAR_FAR_TOP_LEFT?te**2:te,Ce=q===0?0:Je(he,Be,Ae),Xe=Pt(mr,ge.origin,ee.origin,Ce),Fn=Ht(ge.direction,ee.direction,Ce,fr);r.intersectManifoldClosestSilhouette(Pe(Xe,Fn),o,E),Ge(E,c,E,y),M.push(Oe(E)),M.length!==0&&V($e(M.at(-1),E));let Nn=(rt(Q,E)?1:0)|(rt(k,E)?2:0);ct[Nn]=1}}M.length>2&&V($e(M[0],M.at(-1)));let $=ar(At(ct)>1?ir(dn(M,Q),k):[M],r,a);return new Me({rings:$,spatialReference:a})}function ar(e,t,n){let r=2*Ke();return e.map(o=>{let a=[],i=!1;for(let s of o)t.fromRenderCoords(s,E,n),Math.abs(s[0])<r&&Math.abs(s[1])<r?(a.push([null,E[1]]),a.push([null,E[1]]),i=!0):a.push([E[0],E[1]]);if(i)for(let s=0;s<a.length;s++){let c=a[s];if(c[0]!=null)continue;let l=a[s+1],u=a.at(s===0?-1:s-1);c[0]=u[0],s++;let m=a.at(s===a.length-1?0:s+1);l[0]=m[0]}return a.push(a[0]),De(a)||a.reverse(),a})}function ir(e,t){let n=[];for(let r of e)n.push(...dn(r,t));return n}function dn(e,t){let n=[],r=[],o=Ke();for(let i=0;i<e.length;i++){let s=e[i],c=i===e.length-1?e[0]:e[i+1],l=Vt(s,c,pr),u=Gt(t,l.origin,l.vector,zt.NONE,E);switch(u){case ce.INSIDE:n.push(s);break;case ce.OUTSIDE:r.push(s);break;case ce.INTERSECTS_INSIDE_OUT:case ce.INTERSECTS_OUTSIDE_IN:{let[m,p,g]=u===ce.INTERSECTS_INSIDE_OUT?[1,n,r]:[-1,r,n],d=t,x=Re(f(),E,d,m*o),O=Re(f(),E,d,m*-o);p.push(s),p.push(x),g.push(O)}}}let a=[];return n.length&&a.push(n),r.length&&a.push(r),a}function sr(e){let{renderCoordsHelper:t,state:{camera:n}}=e,{center:r,eye:o}=n,a=Math.abs(t.getAltitude(r)),i=Math.abs(Math.PI/2-an(t,r,o));return Wt(un,t.referenceEllipsoid.radius+a),Bt(un,i,n.distance,n.fovY)}var cr={minCurvature:h(5),maxCurvature:h(50),minSamples:1,maxSamples:6},lr=W(1,0,0),ur=W(0,1,0),fr=f(),mr=f(),E=f(),un=qt(),pr=jt(),ct=Ct(),hn=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:$n,eyeForCenterWithHeadingTilt:er,eyeTiltToLookAtTilt:nr,headingTiltToDirectionUp:pn,lookAtTiltToEyeTilt:tr,toArea:or,toExtent:rr},Symbol.toStringTag,{value:"Module"}));function gn(e,t){return e!=null&&(t==null||(t===le.Local?!e.isGeographic||e.isWGS84||e.wkid===oe.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===oe.CGCS2000||e.wkid===oe.GCSMARS2000||e.wkid===oe.GCSMARS2000_SPHERE||e.wkid===oe.GCSMOON2000))}var ft=()=>Tt.getLogger("esri.views.3d.support.cameraUtils"),yn=39.37,Mn=96,dr=Mn*yn,lt=1,hr=8,gr=5,Rn=1,Tr={heading:0,tilt:0},xe=f(),yr=new Se(-20037508342788905e-9,20037508342788905e-9),Mr=new Se(-180,180),K;function de(e){return e.spatialReference??Te.WGS84}function Y({state:e}){return e.isGlobal?hn:rn}function va(e,t,n,r,o){return Y(e).headingTiltToDirectionUp(t,n,r,o)}function Rr(e,t){if(t==null)return null;let n=e.renderSpatialReference,r=Y(e).headingTiltToDirectionUp,o=f();if(!se(t.position,o,n))return null;let a=r(o,t.heading,t.tilt);w(a.direction,a.direction,e.state.camera.distance),B(a.direction,a.direction,o);let i=Qt(e,o,a.direction,a.up);return i.fov=h(t.fov),i.row=t.layout.row,i.rows=t.layout.rows,i.column=t.layout.column,i.columns=t.layout.columns,i}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(K||(K={}));var pe=f();function Ea(e,t,n){let r=e.renderSpatialReference,o=mt(e,t.eye,t.viewForward,t.up,Tr),a=de(e);return ue(t.eye,r,pe,a)||(a=Te.WGS84,ue(t.eye,r,pe,a)),n==null?n=new Ne(new T(pe,a),o.heading,o.tilt,v(t.fov)):(n.position.x=pe[0],n.position.y=pe[1],n.position.z=pe[2],n.position.spatialReference=a,n.heading=o.heading,n.tilt=o.tilt,n.fov=v(t.fov)),n.layout.row=t.row,n.layout.rows=t.rows,n.layout.column=t.column,n.layout.columns=t.columns,n}function ut(e,t){let{camera:n}=e.state,{unitInMeters:r}=e.renderCoordsHelper;return n.width/2/n.pixelRatio/(Mn*yn/(t/=r))/Math.tan(n.fovX/2)}function Sr(e,t){let{camera:n}=e.state,{unitInMeters:r}=e.renderCoordsHelper,o=t*Math.tan(n.fovX/2),a=n.width/2/n.pixelRatio;return dr/(a/o)*r}function wr(e,t,n,r){let o=r.levelAtScale(t),a=Sn(mt(e,n.eye,n.viewForward,n.up).tilt),i=Math.max(o-a,0);return r.scaleAtLevel(i)}function Tn(e,t,n){let r=n.levelAtScale(e),o=Sn(t);return n.scaleAtLevel(r+o)}function Sn(e){return 2*((e>90?180-e:e)/90)**2}function vr(e,t,n){let r=e.basemapTerrain?.tilingScheme;if(!r)return 0;if(n==null){let i=e.pointsOfInterest?.cameraOnSurface?.renderLocation;n=(i&&e.renderCoordsHelper?.getAltitude(i))??0}let o=F(e.spatialReference).radius,a=e.state.viewingMode===le.Local?t.eye[2]:S(t.eye)-o;return wr(e,Sr(e,Math.abs(a-n)),t,r)}function Er(e,t,n){let r=Rr(e,t);return r?vr(e,r,n):0}var xr=1,Ar=100;function xa(e,t,n,r,o){if(t===0)return 0;let a=ae(n.eye,r),i=e.basemapTerrain?.tilingScheme;if(!i)return ft().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),a;let s=a,c=mt(e,n.eye,n.viewForward,n.up),l=c.tilt>90;if(e.state.viewingMode===le.Local){let u=(ut(e,Tn(t,c.tilt,i))-Math.abs(n.eye[2]-o[2]))/Math.cos(h(c.tilt));s=l?s-u:s+u}else{let u=1/0,m=0,p=qe(e,c.heading,c.tilt,r,a,K.ADJUST);if(!p)return s;let g=S(o);for(;u>xr&&m<Ar;){let d=S(p.eye),x=l?180-p.tilt:p.tilt,O=h(x),D=Math.sin(O)*d,A=Math.cos(O)*d,y=ut(e,Tn(t,p.tilt,i)),M=l?g-y:g+y,Q=H(D/M),k=Math.cos(Q)*M-A,V=ae(p.eye,r);s=l?V-k:V+k,p=qe(e,c.heading,c.tilt,r,s,K.ADJUST);let $=dt(e,p,v(n.fov));if(!p||!$)return s;let R=Er(e,$,g-F(e.spatialReference).radius);u=Math.abs(t-R),++m}}return s}function Aa(e,t,n,r,o,a){return L(this,null,function*(){return Cr(e,t,ut(e,n),r,o,a)})}function Ca(e,t,n,r,o,a){return dt(e,qe(e,r.heading,r.tilt,t,n,o),r.fov,a)}function Cr(e,t,n,r,o,a){return L(this,null,function*(){let i=yield vn(e,r.heading,r.tilt,t,n,o,a);return b(a),_n(e,i,r.fov,a)})}function mt(e,t,n,r,o){return Y(e).directionToHeadingTilt(t,n,r,o)}function wn(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,xe,e.spatialReference)&&e.elevationProvider&&(at(e.elevationProvider,xe)??0)>xe[2]-Rn)}function Ir(e,t,n){return L(this,null,function*(){if(wn(e,t))return!0;let{elevationProvider:r,spatialReference:o,renderCoordsHelper:a}=e;if(r==null||!a.fromRenderCoords(t,xe,o))return!1;let[i,s,c]=xe,l=(yield r.queryElevation(i,s,c,o,"ground",n))??0;return b(n),l>c-Rn})}function Dr(e,t,n){return L(this,null,function*(){let r=f();if(t==null)return P(r,e.state.camera.center);if(t instanceof T){let{renderSpatialReference:o,basemapTerrain:a,elevationProvider:i}=e,s=t.spatialReference;if(yield Lt(t,r,o,0,{signal:n}),b(n),t.z==null&&a!=null&&i!=null){let c=yield i.queryElevation(t.x,t.y,t.z??0,s,"ground",n);b(n),c!=null&&e.renderCoordsHelper.setAltitude(r,c)}return r}return P(r,t)})}function Or(e,t){let n=f();if(t==null)return P(n,e.state.camera.center);if(t instanceof T){if(!se(t,n,e.renderSpatialReference))return null;let{basemapTerrain:r,elevationProvider:o}=e;if(t.z==null&&r!=null&&o!=null){let a=at(o,t);a!=null&&e.renderCoordsHelper.setAltitude(n,a)}return n}return P(n,t)}function qe(e,t,n,r,o,a){return En(e,t,n,r instanceof T?r:null,Or(e,r),o,a)}function vn(e,t,n,r,o,a,i){return L(this,null,function*(){let s=r instanceof T?r:null,c=yield Dr(e,r,i);return b(i),xn(e,t,n,s,c,o,a,i)})}function En(e,t,n,r,o,a,i){if(o==null||!r&&(r=new T({spatialReference:de(e)}),!Fe(o,e.renderSpatialReference,r)))return null;let s=An(e,t,n,o,a,i);if(Cn(e,n,i)&&wn(e,s.eye)){let{tilt:c,mode:l}=In(e,n,o,a);return En(e,t,c,r,o,a,l)}return Dn(s,o)}function xn(e,t,n,r,o,a,i,s){return L(this,null,function*(){r||(r=new T({spatialReference:de(e)}),(yield ot(o,e.renderSpatialReference,r,{signal:s}))||(r=null)),b(s);let c=An(e,t,n,o,a,i);if(Cn(e,n,i)&&(yield Ir(e,c.eye,s))){b(s);let{tilt:l,mode:u}=In(e,n,o,a);return xn(e,t,l,r,o,a,u,s)}return Dn(c,o)})}function An(e,t,n,r,o,a){let i=Pr(e,t,n,r,o=Math.max(o,e.state.constraints.minimumPoiDistance),a);return(0,Y(e).eyeForCenterWithHeadingTilt)(r,o,i.heading,i.tilt)}function Cn(e,t,n){let r=e.map.ground.navigationConstraint;return n===K.ADJUST&&e.state.isGlobal&&t>0&&(r==null||r.type==="stay-above")}function In(e,t,n,r){let o=Pn(e,n,r,Fr(e,r,t,n));return{tilt:o,mode:t-o<1?K.LOCKED:K.ADJUST}}function Dn(e,t){return gt(ht({},e),{center:Oe(t)})}function On(e,t){let{state:n,spatialReference:r}=e,o=t.spatialReference;return n.isGlobal&&gn(o,le.Global)||n.isLocal&&r.equals(o)}function bn(e,t){let n,r,o;if(e.state.isGlobal){let u=new T(t.xmin,t.ymin,t.spatialReference),m=new T(t.xmax,t.ymax,t.spatialReference),p=t.spatialReference.isGeographic?Mr:yr;n=new T({x:p.center(u.x,m.x),y:(m.y+u.y)/2,z:t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0,spatialReference:t.spatialReference});let g=F(t.spatialReference),d=cn(n,u,m);r=d.lon,o=d.lat,p.diff(u.x,m.x)>p.range/2&&(r+=g.halfCircumference),r=Math.min(r,g.halfCircumference),o=Math.min(o,g.halfCircumference)}else{let u=e.renderSpatialReference??t.spatialReference;u.equals(t.spatialReference)||(t=Ye(t,u)),r=t.xmax-t.xmin,o=t.ymax-t.ymin;let m=t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0;n=new T({x:t.xmin+.5*r,y:t.ymin+.5*o,z:m,spatialReference:u})}let a=t.zmax!=null&&t.zmin!=null?t.zmax-t.zmin:0,i=e.state.camera,s=1/Math.tan(i.fovX/2),c=1/Math.tan(i.fovY/2),l=1/Math.tan(i.fov/2);return{center:n,distance:Math.max(.5*r*s,.5*o*c,.5*a*l)/lt}}function Ia(e,t,n,r,o,a){return L(this,null,function*(){let i=On(e,t)?t:yield It(t,e.spatialReference,{signal:a});b(a);let{center:s,distance:c}=bn(e,i),l=yield vn(e,n,r,s,c,o,a);return b(a),_n(e,l,e.camera.fov,a)})}function Da(e,t,n,r,o,a){let i;try{i=On(e,t)?t:Ye(t,e.spatialReference)}catch{return null}let{center:s,distance:c}=bn(e,i),l=qe(e,n,r,s,c,o);return l==null?null:dt(e,l,e.camera.fov,a)}function Oa(e,t,n){let r=e.renderSpatialReference,o=new T({spatialReference:de(e)});if(!Fe(n,r,o))return null;let a=Math.tan(t.fovX/2),i=Math.tan(t.fovY/2),s=_t(t.eye,n),c=2*s*a*lt,l=2*s*i*lt;return Y(e).toExtent(e,o,c,l)}function ba(e,t){return Y(e).toArea(e,t)}function br(e,t,n){let r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(n/r)/Math.LN2>hr)return!0;let o=t,a=e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return ae(o,a)/(Math.tan(.5*e.state.camera.fov)*r)>gr}function Pr(e,t,n,r,o,a){let i=0;return a===K.ADJUST&&br(e,r,o)?(t=0,i=_r(e,o,n,r)):i=pt(e,r,o,n),i=e.state.constraints.clampTilt(o,i),{heading:t,tilt:n=Pn(e,r,o,i)}}var We=.7;function _r(e,t,n,r){let o=pt(e,r,t,n);if(!e.state.constraints.tilt)return o;let a=e.state.constraints.tilt(t);a.max=Math.min(a.max,.5*Math.PI);let i=a.min*(1-We)+a.max*We;return Math.min(o,i)}function Fr(e,t,n,r){let o=pt(e,r,t,n);if(!e.state.constraints.tilt)return o;let a=e.state.constraints.tilt(t);return o=Math.min(o,.5*Math.PI),a.min*(1-We)+o*We}function Pn(e,t,n,r){return Y(e).lookAtTiltToEyeTilt(r,t,n)}function pt(e,t,n,r){return Y(e).eyeTiltToLookAtTilt(r,t,n)}function dt(e,t,n,r){if(t==null)return null;let o=e.renderSpatialReference,a=new T({spatialReference:de(e)});return Fe(t.eye,o,a)?(r??=new Ne,r.position=a,r.heading=t.heading,r.tilt=t.tilt,r.fov=n,r):null}function _n(e,t,n,r){return L(this,null,function*(){let o=e.renderSpatialReference,a=new T({spatialReference:de(e)});return yield ot(t.eye,o,a,{signal:r}),b(r),new Ne(a,t.heading,t.tilt,n)})}function Pa(e,t){let n=e.basemapTerrain?.tilingScheme;if(n)return n.levelAtScale(t);ft().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function _a(e,t){let n=e.basemapTerrain?.tilingScheme;if(n)return n.scaleAtLevel(t);ft().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}export{Br as a,Hn as b,Qt as c,He as d,an as e,vo as f,gn as g,K as h,de as i,va as j,Rr as k,Ea as l,ut as m,Sr as n,wr as o,xa as p,Aa as q,Ca as r,Cr as s,mt as t,qe as u,Ia as v,Da as w,Oa as x,ba as y,Pa as z,_a as A};
