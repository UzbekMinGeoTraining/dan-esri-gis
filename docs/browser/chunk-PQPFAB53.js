import{j as Z}from"./chunk-MJXFSFCY.js";import{a as Y}from"./chunk-6N46AY7Z.js";import{a as X}from"./chunk-523X5JOP.js";import{a as N}from"./chunk-BXR2KKYP.js";import{a as L}from"./chunk-B7GIKKEW.js";import{a as q}from"./chunk-NH3JQE75.js";import{a as S}from"./chunk-XXOIKNT6.js";import{a as $}from"./chunk-DBLGLVAQ.js";import{a as b}from"./chunk-3IK5VXZ3.js";import{c as _}from"./chunk-2HUIJUS4.js";import{a as w,b as P,c as I,g as T,h as A,i as R,k as O,l as E,m as k}from"./chunk-5MNDZ6BX.js";import{a as M}from"./chunk-PYQRTZNZ.js";import{b as x}from"./chunk-5PTS4JDF.js";var j=class extends X{constructor(i,e,n){super(i,"vec4",L.Pass,(o,s,l)=>o.setUniform4fv(i,e(s,l)),n)}};var a,B;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(a||(a={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(B||(B={}));var m=class{constructor(i){this.field=i}},g=class extends m{constructor(i){super(i),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[a.Undefined,a.Undefined,a.Undefined]}},C=class extends m{constructor(i){super(i),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},D=class extends m{constructor(i){super(i),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}};var U=class{};function p(t){return t!=null}function c(t){return typeof t=="number"}function h(t){return typeof t=="string"}function it(t){return t==null||h(t)}function r(t,i){t&&t.push(i)}function ot(t,i,e,n=S()){let o=t||0,s=i||0,l=e||0;return o!==0&&k(n,n,-o/180*Math.PI),s!==0&&O(n,n,s/180*Math.PI),l!==0&&E(n,n,l/180*Math.PI),n}function u(t,i,e,n,o){let s=t.minSize,l=t.maxSize;if(t.useSymbolValue){let v=n.symbolSize[e];return i.minSize[e]=v,i.maxSize[e]=v,i.offset[e]=i.minSize[e],i.factor[e]=0,i.type[e]=a.DefinedSize,!0}if(p(t.field))return p(t.stops)?t.stops.length===2&&c(t.stops[0].size)&&c(t.stops[1].size)?(G(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,i,e),i.type[e]=a.DefinedSize,!0):(r(o,"Could not convert size info: stops only supported with 2 elements"),!1):c(s)&&c(l)&&p(t.minDataValue)&&p(t.maxDataValue)?(G(s,l,t.minDataValue,t.maxDataValue,i,e),i.type[e]=a.DefinedSize,!0):t.valueUnit==="unknown"?(r(o,"Could not convert size info: proportional size not supported"),!1):b[t.valueUnit]!=null?(i.minSize[e]=-1/0,i.maxSize[e]=1/0,i.offset[e]=0,i.factor[e]=1/b[t.valueUnit],i.type[e]=a.DefinedSize,!0):(r(o,"Could not convert size info: scale-dependent size not supported"),!1);if(!p(t.field)){if(t.stops?.[0]&&c(t.stops[0].size))return i.minSize[e]=t.stops[0].size,i.maxSize[e]=t.stops[0].size,i.offset[e]=i.minSize[e],i.factor[e]=0,i.type[e]=a.DefinedSize,!0;if(c(s))return i.minSize[e]=s,i.maxSize[e]=s,i.offset[e]=s,i.factor[e]=0,i.type[e]=a.DefinedSize,!0}return r(o,"Could not convert size info: unsupported variant of sizeInfo"),!1}function G(t,i,e,n,o,s){let l=Math.abs(n-e)>0?(i-t)/(n-e):0;o.minSize[s]=l>0?t:i,o.maxSize[s]=l>0?i:t,o.offset[s]=t-e*l,o.factor[s]=l}function et(t,i,e,n){if(t.normalizationField||t.valueRepresentation)return r(n,"Could not convert size info: unsupported property"),null;if(!it(t.field))return r(n,"Could not convert size info: field is not a string"),null;if(i.size){if(t.field)if(i.size.field){if(t.field!==i.size.field)return r(n,"Could not convert size info: multiple fields in use"),null}else i.size.field=t.field}else i.size=new g(t.field);let o;switch(t.axis){case"width":return o=u(t,i.size,0,e,n),o?i:null;case"height":return o=u(t,i.size,2,e,n),o?i:null;case"depth":return o=u(t,i.size,1,e,n),o?i:null;case"width-and-depth":return o=u(t,i.size,0,e,n),o&&u(t,i.size,1,e,n),o?i:null;case null:case void 0:case"all":return o=u(t,i.size,0,e,n),o=o&&u(t,i.size,1,e,n),o=o&&u(t,i.size,2,e,n),o?i:null;default:return r(n,`Could not convert size info: unknown axis "${t.axis}""`),null}}function nt(t,i,e){for(let o=0;o<3;++o){let s=i.unitInMeters;t.type[o]===a.DefinedSize&&(s*=i.modelSize[o],t.type[o]=a.DefinedScale),t.minSize[o]=t.minSize[o]/s,t.maxSize[o]=t.maxSize[o]/s,t.offset[o]=t.offset[o]/s,t.factor[o]=t.factor[o]/s}let n;if(t.type[0]!==a.Undefined)n=0;else if(t.type[1]!==a.Undefined)n=1;else{if(t.type[2]===a.Undefined)return r(e,"No size axis contains a valid size or scale"),!1;n=2}for(let o=0;o<3;++o)t.type[o]===a.Undefined&&(t.minSize[o]=t.minSize[n],t.maxSize[o]=t.maxSize[n],t.offset[o]=t.offset[n],t.factor[o]=t.factor[n],t.type[o]=t.type[n]);return!0}function H(t,i,e){t[4*i]=e.r/255,t[4*i+1]=e.g/255,t[4*i+2]=e.b/255,t[4*i+3]=e.a}function st(t,i,e){if(t.normalizationField)return r(e,"Could not convert color info: unsupported property"),null;if(h(t.field)){if(!t.stops)return r(e,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return r(e,"Could not convert color info: too many color stops"),null;i.color=new C(t.field);let n=t.stops;for(let o=0;o<8;++o){let s=n[Math.min(o,n.length-1)];i.color.values[o]=s.value,H(i.color.colors,o,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return r(e,"Could not convert color info: no field and no colors/stops"),null;{let n=t.stops&&t.stops.length>=0&&t.stops[0].color;i.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let o=0;o<8;o++)i.color.values[o]=1/0,H(i.color.colors,o,n)}}return i}function rt(t,i,e){if(t.normalizationField)return r(e,"Could not convert opacity info: unsupported property"),null;if(h(t.field)){if(!t.stops)return r(e,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return r(e,"Could not convert opacity info: too many opacity stops"),null;i.opacity=new D(t.field);let n=t.stops;for(let o=0;o<8;++o){let s=n[Math.min(o,n.length-1)];i.opacity.values[o]=s.value,i.opacity.opacityValues[o]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return r(e,"Could not convert opacity info: no field and no opacities/stops"),null;{let n=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;i.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let o=0;o<8;o++)i.opacity.values[o]=1/0,i.opacity.opacityValues[o]=n}}return i}function V(t,i,e){let n=e===2&&t.rotationType==="arithmetic";i.offset[e]=n?90:0,i.factor[e]=n?-1:1,i.type[e]=1}function at(t,i,e){if(!h(t.field))return r(e,"Could not convert rotation info: field is not a string"),null;if(i.rotation){if(t.field)if(i.rotation.field){if(t.field!==i.rotation.field)return r(e,"Could not convert rotation info: multiple fields in use"),null}else i.rotation.field=t.field}else i.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return V(t,i.rotation,0),i;case"roll":return V(t,i.rotation,1),i;case null:case void 0:case"heading":return V(t,i.rotation,2),i;default:return r(e,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}var K=class{constructor(i,e=[1,1,1],n=[1,1,1],o=1,s=[0,0,0],l=[1,1,1],v=[0,0,0]){this.supports=i,this.modelSize=e,this.symbolSize=n,this.unitInMeters=o,this.anchor=s,this.scale=l,this.rotation=v}};function W(t,i,e){if(!t)return null;let n=t.reduce((o,s)=>{if(!o)return o;if(s.valueExpression)return r(e,"Could not convert visual variables: arcade expressions not supported"),null;switch(s.type){case"size":return i.supports.size?et(s,o,i,e):o;case"color":return i.supports.color?st(s,o,e):o;case"opacity":return i.supports.opacity?rt(s,o,e):null;case"rotation":return i.supports.rotation?at(s,o,e):o;default:return null}},new U);return!(t.length>0&&n)||n.size||n.color||n.opacity||n.rotation?n?.size&&!nt(n.size,i,e)?null:n:null}var F=class{constructor(i,e,n){this.visualVariables=i,this.materialParameters=e,this.requiresShaderTransformation=n}};function Vt(t,i){if(!t||Y.TESTS_DISABLE_FAST_UPDATES)return null;let e=W(t.visualVariables,i);return e?new F(e,J(e,i),!!e.size):null}function gt(t,i,e){if(!i||!t)return!1;let n=t.visualVariables,o=W(i.visualVariables,e);return!!o&&!!(y(n.size,o.size,"size")&&y(n.color,o.color,"color")&&y(n.rotation,o.rotation,"rotation")&&y(n.opacity,o.opacity,"opacity"))&&(t.visualVariables=o,t.materialParameters=J(o,e),t.requiresShaderTransformation=!!o.size,!0)}function y(t,i,e){if(!!t!=!!i||t&&t.field!==i?.field)return!1;if(t&&e==="rotation"){let n=t,o=i;for(let s=0;s<3;s++)if(n.type[s]!==o.type[s]||n.offset[s]!==o.offset[s]||n.factor[s]!==o.factor[s])return!1}return!0}var z=class extends N{constructor(i){super(),this.vvSize=i?.size??null,this.vvColor=i?.color??null,this.vvOpacity=i?.opacity??null}};function J(t,i){let e=new z(t);return e.vvSize&&(e.vvSymbolAnchor=i.anchor,I(d),ot(i.rotation[2],i.rotation[0],i.rotation[1],d),e.vvSymbolRotationMatrix=e.vvSymbolRotationMatrix||$(),q(e.vvSymbolRotationMatrix,d)),e}function Ct(t,i,e){if(!t.vvSize)return e;w(f,e);let n=t.vvSymbolRotationMatrix;P(d,n[0],n[1],n[2],0,n[3],n[4],n[5],0,n[6],n[7],n[8],0,0,0,0,1),T(f,f,d);for(let o=0;o<3;++o){let s=t.vvSize.offset[o]+i[0]*t.vvSize.factor[o];Q[o]=x(s,t.vvSize.minSize[o],t.vvSize.maxSize[o])}return R(f,f,Q),A(f,f,t.vvSymbolAnchor),f}function Dt(t,i,e){if(!i.vvSize)return _(t,1,1,1),t;for(let n=0;n<3;++n){let o=i.vvSize.offset[n]+e[0]*i.vvSize.factor[n];t[n]=x(o,i.vvSize.minSize[n],i.vvSize.maxSize[n])}return t}function Ut(t,i){let e=t==null?0:i.attributes[t];return typeof e=="number"&&isFinite(e)?e:0}var f=S(),Q=M(),d=S();var tt=class extends z{constructor(){super(...arguments),this.renderOccluded=Z.Occlude,this.isDecoration=!1}},Pt=8;export{j as a,K as b,Vt as c,gt as d,Ct as e,Dt as f,Ut as g,tt as h,Pt as i};
