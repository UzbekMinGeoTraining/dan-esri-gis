import{a as ee}from"./chunk-Q6ZVH4MK.js";import{a as oe}from"./chunk-RRDM7P6F.js";import{a as b}from"./chunk-EN6CTWVM.js";import{M as se,f as re,j as ie}from"./chunk-7D4IYTAJ.js";import{a as P}from"./chunk-DPZGANVI.js";import{a as Zt}from"./chunk-GYH7NDHH.js";import{c as U}from"./chunk-VQHENXDQ.js";import{a as nt}from"./chunk-4R5NBZMW.js";import{a as w}from"./chunk-CMMPCPP5.js";import{a as te}from"./chunk-GZXWFBZI.js";import{a as Xt,b as Yt}from"./chunk-B7IARA3F.js";import{h as a}from"./chunk-2JF6YUJG.js";import{Q as o,S as pt}from"./chunk-GGZQ5GCM.js";import{I as Qt,J as y,U as i}from"./chunk-TFUPB3ZG.js";import{a as t}from"./chunk-BMVJCP2M.js";import{B as Ht}from"./chunk-GMC3I5VG.js";import{b as d,r as $t}from"./chunk-3IBUFXWY.js";import{a as Gt,g as st}from"./chunk-JEGVIFEP.js";var gt,j=gt=class extends a{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new gt({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};t([o({type:String,json:{write:!0}})],j.prototype,"name",void 0),t([o({type:String,json:{write:!0}})],j.prototype,"title",void 0),t([o({type:String,json:{write:!0}})],j.prototype,"expression",void 0),t([o({type:["string","number"],json:{write:!0}})],j.prototype,"returnType",void 0),j=gt=t([i("esri.popup.ExpressionInfo")],j);var pe=j;var Nt,u=Nt=class extends ee(pt){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new Nt({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};t([o()],u.prototype,"active",void 0),t([o()],u.prototype,"className",void 0),t([o()],u.prototype,"disabled",void 0),t([o()],u.prototype,"icon",void 0),t([o()],u.prototype,"id",void 0),t([o()],u.prototype,"indicator",void 0),t([o()],u.prototype,"title",void 0),t([o()],u.prototype,"type",void 0),t([o()],u.prototype,"visible",void 0),u=Nt=t([i("esri.support.actions.ActionBase")],u);var D=u;var St,at=St=class extends D{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new St({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};t([o()],at.prototype,"image",void 0),at=St=t([i("esri.support.actions.ActionButton")],at);var ne=at;var lt=class extends a{constructor(e){super(e),this.type=null}};t([o({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],lt.prototype,"type",void 0),lt=t([i("esri.popup.content.Content")],lt);var m=lt;var Ft,O=Ft=class extends m{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new Ft({description:this.description,displayType:this.displayType,title:this.title})}};t([o({type:String,json:{write:!0}})],O.prototype,"description",void 0),t([o({type:["auto","preview","list"],json:{write:!0}})],O.prototype,"displayType",void 0),t([o({type:String,json:{write:!0}})],O.prototype,"title",void 0),t([o({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],O.prototype,"type",void 0),O=Ft=t([i("esri.popup.content.AttachmentsContent")],O);var T=O;var _t,C=_t=class extends m{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new _t({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?d(this.outFields):null})}};t([o()],C.prototype,"creator",void 0),t([o()],C.prototype,"destroyer",void 0),t([o()],C.prototype,"outFields",void 0),t([o({type:["custom"],readOnly:!0})],C.prototype,"type",void 0),C=_t=t([i("esri.popup.content.CustomContent")],C);var jt=C;var Ot,W=Ot=class extends a{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new Ot({title:this.title,expression:this.expression})}};t([o({type:String,json:{write:!0}})],W.prototype,"title",void 0),t([o({type:String,json:{write:!0}})],W.prototype,"expression",void 0),t([o({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],W.prototype,"returnType",void 0),W=Ot=t([i("esri.popup.ElementExpressionInfo")],W);var ae=W;var Tt,G=Tt=class extends m{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){return new Tt({expressionInfo:this.expressionInfo?.clone()})}};t([o({type:ae,json:{write:!0}})],G.prototype,"expressionInfo",void 0),t([o({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],G.prototype,"type",void 0),G=Tt=t([i("esri.popup.content.ExpressionContent")],G);var K=G;var z=class extends b(a){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};t([P(Zt)],z.prototype,"dateFormat",void 0),t([o({type:Boolean,json:{write:!0}})],z.prototype,"digitSeparator",void 0),t([o({type:y,json:{write:!0}})],z.prototype,"places",void 0),z=t([i("esri.popup.support.FieldInfoFormat")],z);var le=z;var Ct,h=Ct=class extends a{constructor(e){super(e),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new Ct({fieldName:this.fieldName,format:this.format?.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};t([o({type:String,json:{write:!0}})],h.prototype,"fieldName",void 0),t([o({type:le,json:{write:!0}})],h.prototype,"format",void 0),t([o({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],h.prototype,"isEditable",void 0),t([o({type:String,json:{write:!0}})],h.prototype,"label",void 0),t([P(new Xt({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],h.prototype,"stringFieldOption",void 0),t([o({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],h.prototype,"statisticType",void 0),t([o({type:String,json:{write:!0}})],h.prototype,"tooltip",void 0),t([o({type:Boolean,json:{write:!0}})],h.prototype,"visible",void 0),h=Ct=t([i("esri.popup.FieldInfo")],h);var mt=h;var At,N=At=class extends m{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,r){r.fieldInfos=e&&e.map(s=>s.toJSON())}clone(){return new At(d({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};t([o({type:Object,json:{write:!0}})],N.prototype,"attributes",void 0),t([o({type:String,json:{write:!0}})],N.prototype,"description",void 0),t([o({type:[mt]})],N.prototype,"fieldInfos",void 0),t([w("fieldInfos")],N.prototype,"writeFieldInfos",null),t([o({type:String,json:{write:!0}})],N.prototype,"title",void 0),t([o({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],N.prototype,"type",void 0),N=At=t([i("esri.popup.content.FieldsContent")],N);var A=N;var R=class extends a{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};t([o({type:String,json:{write:!0}})],R.prototype,"altText",void 0),t([o({type:String,json:{write:!0}})],R.prototype,"caption",void 0),t([o({type:String,json:{write:!0}})],R.prototype,"title",void 0),t([o({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],R.prototype,"type",void 0),R=t([i("esri.popup.content.mixins.MediaInfo")],R);var V=R;var Rt,M=Rt=class extends pt{constructor(e){super(e),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new Rt({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};t([o()],M.prototype,"color",void 0),t([o()],M.prototype,"fieldName",void 0),t([o()],M.prototype,"tooltip",void 0),t([o()],M.prototype,"value",void 0),M=Rt=t([i("esri.popup.content.support.ChartMediaInfoValueSeries")],M);var me=M;var Mt,S=Mt=class extends a{constructor(e){super(e),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new Mt({colors:d(this.colors),fields:d(this.fields),normalizeField:this.normalizeField,series:d(this.series),tooltipField:this.tooltipField})}};t([o({type:[oe],json:{type:[[y]],write:!0}})],S.prototype,"colors",void 0),t([o({type:[String],json:{write:!0}})],S.prototype,"fields",void 0),t([o({type:String,json:{write:!0}})],S.prototype,"normalizeField",void 0),t([o({type:[me],json:{read:!1}})],S.prototype,"series",void 0),t([o({type:String,json:{write:!0}})],S.prototype,"tooltipField",void 0),S=Mt=t([i("esri.popup.content.support.ChartMediaInfoValue")],S);var de=S;var $=class extends V{constructor(e){super(e),this.type=null,this.value=void 0}};t([o({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],$.prototype,"type",void 0),t([o({type:de,json:{write:!0}})],$.prototype,"value",void 0),$=t([i("esri.popup.content.mixins.ChartMediaInfo")],$);var F=$;var _=Yt()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var Jt,dt=Jt=class extends F{constructor(e){super(e),this.type="bar-chart"}clone(){return new Jt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:_.write}})],dt.prototype,"type",void 0),dt=Jt=t([i("esri.popup.content.BarChartMediaInfo")],dt);var ct=dt;var Et,ut=Et=class extends F{constructor(e){super(e),this.type="column-chart"}clone(){return new Et({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:_.write}})],ut.prototype,"type",void 0),ut=Et=t([i("esri.popup.content.ColumnChartMediaInfo")],ut);var ft=ut;var Bt,H=Bt=class extends a{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new Bt({linkURL:this.linkURL,sourceURL:this.sourceURL})}};t([o({type:String,json:{write:!0}})],H.prototype,"linkURL",void 0),t([o({type:String,json:{write:!0}})],H.prototype,"sourceURL",void 0),H=Bt=t([i("esri.popup.content.support.ImageMediaInfoValue")],H);var ce=H;var kt,q=kt=class extends V{constructor(e){super(e),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new kt({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};t([o({type:Number,json:{write:!0}})],q.prototype,"refreshInterval",void 0),t([o({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],q.prototype,"type",void 0),t([o({type:ce,json:{write:!0}})],q.prototype,"value",void 0),q=kt=t([i("esri.popup.content.ImageMediaInfo")],q);var yt=q;var Lt,ht=Lt=class extends F{constructor(e){super(e),this.type="line-chart"}clone(){return new Lt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:_.write}})],ht.prototype,"type",void 0),ht=Lt=t([i("esri.popup.content.LineChartMediaInfo")],ht);var vt=ht;var Ut,xt=Ut=class extends F{constructor(e){super(e),this.type="pie-chart"}clone(){return new Ut({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:_.write}})],xt.prototype,"type",void 0),xt=Ut=t([i("esri.popup.content.PieChartMediaInfo")],xt);var wt=xt;var Q={base:V,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":ct,"column-chart":ft,"line-chart":vt,"pie-chart":wt,image:yt}};var Pt,v=Pt=class extends m{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(r=>r.type==="image"?yt.fromJSON(r):r.type==="barchart"?ct.fromJSON(r):r.type==="columnchart"?ft.fromJSON(r):r.type==="linechart"?vt.fromJSON(r):r.type==="piechart"?wt.fromJSON(r):void 0).filter(Boolean)}writeMediaInfos(e,r){r.mediaInfos=e&&e.map(s=>s.toJSON())}clone(){return new Pt(d({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};t([o()],v.prototype,"activeMediaInfoIndex",void 0),t([o({type:Object,json:{write:!0}})],v.prototype,"attributes",void 0),t([o({type:String,json:{write:!0}})],v.prototype,"description",void 0),t([o({types:[Q]})],v.prototype,"mediaInfos",void 0),t([nt("mediaInfos")],v.prototype,"readMediaInfos",null),t([w("mediaInfos")],v.prototype,"writeMediaInfos",null),t([o({type:String,json:{write:!0}})],v.prototype,"title",void 0),t([o({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],v.prototype,"type",void 0),v=Pt=t([i("esri.popup.content.MediaContent")],v);var J=v;var Dt,X=Dt=class extends a{constructor(e){super(e),this.field=null,this.order=null}clone(){return new Dt({field:this.field,order:this.order})}};t([o({type:String,json:{write:!0}})],X.prototype,"field",void 0),t([o({type:["asc","desc"],json:{write:!0}})],X.prototype,"order",void 0),X=Dt=t([i("esri.popup.support.RelatedRecordsInfoFieldOrder")],X);var bt=X;var I=class extends b(m){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};t([o({type:String,json:{write:!0}})],I.prototype,"description",void 0),t([o({type:Number,json:{type:y,write:!0}})],I.prototype,"displayCount",void 0),t([o({type:["list"],json:{write:!0}})],I.prototype,"displayType",void 0),t([o({type:[bt],json:{write:!0}})],I.prototype,"orderByFields",void 0),t([o({type:Number,json:{type:y,write:!0}})],I.prototype,"relationshipId",void 0),t([o({type:String,json:{write:!0}})],I.prototype,"title",void 0),t([o({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],I.prototype,"type",void 0),I=t([i("esri.popup.content.RelationshipContent")],I);var E=I;var Wt,Y=Wt=class extends m{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new Wt({text:this.text})}};t([o({type:String,json:{write:!0}})],Y.prototype,"text",void 0),t([o({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],Y.prototype,"type",void 0),Y=Wt=t([i("esri.popup.content.TextContent")],Y);var B=Y;var g=class extends b(a){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.open=!1,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};t([o({type:String,json:{write:!0}})],g.prototype,"title",void 0),t([o({type:String,json:{write:!0}})],g.prototype,"description",void 0),t([o({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],g.prototype,"type",void 0),t([o({type:Boolean,json:{read:!1}})],g.prototype,"open",void 0),t([o({type:Number,json:{type:y,write:!0}})],g.prototype,"associatedNetworkSourceId",void 0),t([o({type:Number,json:{type:y,write:!0}})],g.prototype,"associatedAssetGroup",void 0),t([o({type:Number,json:{type:y,write:!0}})],g.prototype,"associatedAssetType",void 0),g=t([i("esri.popup.support.UtilityNetworkAssociationType")],g);var ue=g;var k=class extends b(m){constructor(e){super(e),this.description=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};t([o({type:String,json:{write:!0}})],k.prototype,"description",void 0),t([o({type:String,json:{write:!0}})],k.prototype,"title",void 0),t([o({type:[ue],json:{write:!0}})],k.prototype,"associationTypes",void 0),t([P({utilityNetworkAssociations:"utility-network-associations"})],k.prototype,"type",void 0),k=t([i("esri.popup.content.UtilityNetworkAssociationsContent")],k);var Z=k;var fe={base:null,key:"type",typeMap:{attachment:T,media:J,text:B,expression:K,field:A,relationship:E,utilityNetworkAssociations:Z}},ye={base:null,key:"type",typeMap:{attachment:T,media:J,text:B,expression:K,field:A,relationship:E}};var Kt,tt=Kt=class extends a{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new Kt({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};t([o({type:Boolean,json:{write:!0}})],tt.prototype,"returnTopmostRaster",void 0),t([o({type:Boolean,json:{write:!0}})],tt.prototype,"showNoDataRecords",void 0),tt=Kt=t([i("esri.popup.LayerOptions")],tt);var he=tt;var zt,et=zt=class extends a{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new zt({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?d(this.orderByFields):null})}};t([o({type:Boolean,json:{write:!0}})],et.prototype,"showRelatedRecords",void 0),t([o({type:[bt],json:{write:!0}})],et.prototype,"orderByFields",void 0),et=zt=t([i("esri.popup.RelatedRecordsInfo")],et);var Vt=et;var qt,ot=qt=class extends D{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new qt({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};t([o()],ot.prototype,"image",void 0),t([o()],ot.prototype,"value",void 0),ot=qt=t([i("esri.support.actions.ActionToggle")],ot);var ve=ot;var rt="relationships/",xe="expression/",be=U.ofType({key:"type",defaultKeyValue:"button",base:D,typeMap:{button:ne,toggle:ve}}),Ie={base:m,key:"type",typeMap:{media:J,custom:jt,text:B,attachments:T,fields:A,expression:K,relationship:E,utilityNetworkAssociations:Z}},we=new Set(["attachments","fields","media","text","expression","relationship"]),ge=new Set([...we,"utility-network-associations"]),l=class extends b(a){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>Qt(Ie,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Ht(e)?e:($t.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,r){let{popupElements:s}=r;return Array.isArray(s)&&s.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,s):this._readPopupInfo(r)}writeWebSceneContent(e,r,s,p){this._writePopupTemplateContent(e,r,p)}writeWebMapContent(e,r,s,p){this._writePopupTemplateContent(e,r,p)}writeFieldInfos(e,r,s,p){let{content:n}=this,c=Array.isArray(n)?n:null;if(e){let f=c?c.filter(x=>x.type==="fields"):[],L=f.length&&f.every(x=>x.fieldInfos?.length);r.fieldInfos=e.filter(Boolean).map(x=>{let it=x.toJSON(p);return L&&(it.visible=!1),it})}if(c)for(let f of c)f.type==="fields"&&this._writeFieldsContent(f,r)}writeLayerOptions(e,r,s,p){r[s]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(p)}writeTitle(e,r){r.title=e||""}collectRequiredFields(e,r){return st(this,null,function*(){let s=this.expressionInfos||[];yield this._collectExpressionInfoFields(e,r,[...s,...this._getContentExpressionInfos(this.content,s)]),re(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])})}getRequiredFields(e){return st(this,null,function*(){let r=new Set;return yield this.collectRequiredFields(r,e),[...r].sort()})}_writePopupTemplateContent(e,r,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(p=>s?.origin==="web-scene"?we.has(p.type):ge.has(p.type)).map(p=>p?.toJSON(s)),r.popupElements.forEach(p=>{p.type==="attachments"?this._writeAttachmentContent(r):p.type==="media"?this._writeMediaContent(p,r):p.type==="text"?this._writeTextContent(p,r):p.type==="relationship"&&this._writeRelationshipContent(p,r)})):r.description=e}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;let s=d(e.fieldInfos);Array.isArray(r.fieldInfos)?s.forEach(p=>{let n=r.fieldInfos.find(c=>c.fieldName?.toLowerCase()===p.fieldName?.toLowerCase());n?n.visible=!0:r.fieldInfos.push(p)}):r.fieldInfos=s}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){let s=e.orderByFields?.map(n=>this._toFieldOrderJSON(n,e.relationshipId))||[],p=[...r.relatedRecordsInfo?.orderByFields||[],...s];r.relatedRecordsInfo=Gt({showRelatedRecords:!0},p?.length&&{orderByFields:p})}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;let s=d(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...s]:r.mediaInfos=s}_readPopupInfoElements(e,r,s){let p={description:!1,mediaInfos:!1};return s.map(n=>n.type==="media"?(n.mediaInfos||!r||p.mediaInfos||(n.mediaInfos=r,p.mediaInfos=!0),J.fromJSON(n)):n.type==="text"?(n.text||!e||p.description||(n.text=e,p.description=!0),B.fromJSON(n)):n.type==="attachments"?T.fromJSON(n):n.type==="fields"?A.fromJSON(n):n.type==="expression"?K.fromJSON(n):n.type==="relationship"?E.fromJSON(n):n.type==="utilityNetworkAssociations"?Z.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){let{field:r,order:s}=e;if(!r?.startsWith(rt))return null;let p=r.replace(rt,"").split("/");if(p.length!==2)return null;let n=parseInt(p[0],10),c=p[1];return typeof n=="number"&&c?E.fromJSON({relationshipId:n,orderByFields:[{field:c,order:s}]}):null}_toFieldOrderJSON(e,r){let{order:s,field:p}=e;return{field:`${rt}${r}/${p}`,order:s}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:s,relatedRecordsInfo:p={showRelatedRecords:!1}}){let n=[];e?n.push(new B({text:e})):n.push(new A),Array.isArray(r)&&r.length&&n.push(J.fromJSON({mediaInfos:r})),s&&n.push(T.fromJSON({displayType:"auto"}));let{showRelatedRecords:c,orderByFields:f}=p;return c&&f?.length&&f.forEach(L=>{let x=this._toRelationshipContent(L);x&&n.push(x)}),n.length?n:e}_getContentElementFields(e){let r=e?.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){let s=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...s.reduce((p,n)=>[...p,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):r==="relationship"||r==="utility-network-associations"?[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)]:[]}_getMediaInfoFields(e){let{caption:r,title:s,value:p}=e,n=p||{},{fields:c,normalizeField:f,tooltipField:L,sourceURL:x,linkURL:it}=n,It=[...this._extractFieldNames(s),...this._extractFieldNames(r),...this._extractFieldNames(x),...this._extractFieldNames(it),...c??[]];return f&&It.push(f),L&&It.push(L),It}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((s,p)=>[...s,...p.type==="expression"&&p.expressionInfo?[p.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,s)=>[...r,...this._getContentElementFields(s)],[]):[]}_collectExpressionInfoFields(e,r,s){return st(this,null,function*(){s&&(yield Promise.all(s.map(p=>ie(e,r,p.expression))))})}_getFieldInfoFields(e){return e?e.filter(({fieldName:r,visible:s})=>!(s!==void 0&&!s||!r||r.startsWith(rt)||r.startsWith(xe))).map(r=>r.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((r,s)=>[...r,...this._getActionFields(s)],[]):[]}_getActionFields(e){let{className:r,title:s,type:p}=e,n=p==="button"||p==="toggle"?e.image:"";return[...this._extractFieldNames(s),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return se(e).filter(r=>!(r.indexOf(rt)===0||r.indexOf(xe)===0))}};t([o({type:be})],l.prototype,"actions",void 0),t([o()],l.prototype,"content",void 0),t([te("content")],l.prototype,"castContent",null),t([nt("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],l.prototype,"readContent",null),t([w("web-scene","content",{popupElements:{type:U.ofType(ye)},showAttachments:{type:Boolean},mediaInfos:{type:U.ofType(Q)},description:{type:String},relatedRecordsInfo:{type:Vt}})],l.prototype,"writeWebSceneContent",null),t([w("content",{popupElements:{type:U.ofType(fe)},showAttachments:{type:Boolean},mediaInfos:{type:U.ofType(Q)},description:{type:String},relatedRecordsInfo:{type:Vt}})],l.prototype,"writeWebMapContent",null),t([o({type:[pe],json:{write:!0}})],l.prototype,"expressionInfos",void 0),t([o({type:[mt]})],l.prototype,"fieldInfos",void 0),t([w("fieldInfos")],l.prototype,"writeFieldInfos",null),t([o({type:he})],l.prototype,"layerOptions",void 0),t([w("layerOptions")],l.prototype,"writeLayerOptions",null),t([o({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],l.prototype,"lastEditInfoEnabled",void 0),t([o()],l.prototype,"outFields",void 0),t([o()],l.prototype,"overwriteActions",void 0),t([o()],l.prototype,"returnGeometry",void 0),t([o({json:{type:String}})],l.prototype,"title",void 0),t([w("title")],l.prototype,"writeTitle",null),l=t([i("esri.PopupTemplate")],l);var ta=l;export{T as a,ae as b,le as c,mt as d,A as e,me as f,J as g,bt as h,B as i,pe as j,D as k,ne as l,ve as m,ta as n};
