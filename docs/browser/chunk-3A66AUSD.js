import{b as Ce}from"./chunk-UUKQEAQR.js";import{b as Q}from"./chunk-6UUMJQNV.js";import{a as W}from"./chunk-4BLMEKFL.js";import{a as Ve,b as _,d as De,e as Ne,h as Re,i as F,l as Pe,n as X}from"./chunk-RPIA54UY.js";import{K as _e,M as je}from"./chunk-AXPRNSO3.js";import{b as Me}from"./chunk-R6S6A5GA.js";import{a as Te}from"./chunk-25T3ULWN.js";import{a as Ee}from"./chunk-OL43UY3L.js";import{i as A,k as Ie,m as B}from"./chunk-NZ7WSL6F.js";import{a as u}from"./chunk-RRDM7P6F.js";import{a as L}from"./chunk-EN6CTWVM.js";import{a as Se}from"./chunk-AO7UDTUI.js";import{a as be}from"./chunk-PFIMJ2UL.js";import{a as we,b as ve,c as xe}from"./chunk-NKMODNM6.js";import{g as Fe,j as P}from"./chunk-7D4IYTAJ.js";import{a as Oe,d as Le}from"./chunk-GLWPOGYF.js";import{c as z}from"./chunk-YFBPRKIN.js";import{d as he,e as ge}from"./chunk-Q5WFUDPQ.js";import{a as O}from"./chunk-DPZGANVI.js";import{a as Z}from"./chunk-CMMPCPP5.js";import{a as fe}from"./chunk-GZXWFBZI.js";import{k as G}from"./chunk-TEY6TKJV.js";import{h as D}from"./chunk-2JF6YUJG.js";import{Q as i}from"./chunk-GGZQ5GCM.js";import{J as ye,O as ce,P as de,U as m,w as me}from"./chunk-TFUPB3ZG.js";import{a as r}from"./chunk-BMVJCP2M.js";import{t as ue}from"./chunk-GMC3I5VG.js";import{b as a,r as N,t as pe}from"./chunk-3IBUFXWY.js";import{u as ae}from"./chunk-BP73DJTS.js";import{a as J,b as ne,d as le,g as d}from"./chunk-JEGVIFEP.js";var qe="esri.renderers.support.DictionaryLoader",Be={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}},k=class{constructor(t,o,s){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new Se(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=t,this.config=o,this.fieldMap=s}getSymbolFields(){return this._symbolFields}getSymbolAsync(t,o){return d(this,null,function*(){let s;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(o));try{s=yield this._dictionaryPromise}catch(f){if(ue(f))return this._dictionaryPromise=null,null}let c=this._dictionaryVersion?.greaterEqual(4,0),l={};if(this.fieldMap)for(let f of this._symbolFields){let h=je(this.fieldMap[f],this._fieldIndex);if(h){let n=t.attributes[h];l[f]=c?n:n!=null?""+t.attributes[h]:""}else l[f]=""}let p=null;try{p=s?.(l,o)}catch{return null}if(!p||typeof p!="string"||p==="invalid")return null;let I=p.split(";"),S=[],w=[];for(let f=0;f<I.length;f++){let h=I[f];if(h){if(h.includes("po:")){let n=h.slice(3).split("|");if(n.length===3){let E=n[0],V=n[1],v=n[2],q="countrylabel";if(E===q&&V==="TextString"){if(this.fieldMap!=null){let x=this.fieldMap[q];x==null&&(x=q,this.fieldMap[x]=x),t.attributes[x]=v}continue}if(V==="DashTemplate")v=v.split(" ").map(x=>Number(x));else if(V==="Color"){let x=new u(v).toRgba();v=[x[0],x[1],x[2],255*x[3]]}else v=Number(v);w.push({primitiveName:E,propertyName:V,value:v,defaultValue:null})}}else if(h.includes("|")){for(let n of h.split("|"))if(this._itemNames.has(n)){S.push(n);break}}else if(this._itemNames.has(h))S.push(h);else if(f===0){S.length=0;let n="Invalid_P";t.geometry!=null&&(ge(t.geometry)?n="Invalid_A":he(t.geometry)&&(n="Invalid_L")),S.push(n);break}}}let C=t.geometry==null||!t.geometry.hasZ&&t.geometry.type==="point";return this._cimPartsToCIMSymbol(t,S,w,C,o)})}fetchResources(t){return d(this,null,function*(){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void N.getLogger(qe).error("no valid URL!");let o=G(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:t!=null?t.signal:null}),[{data:s}]=yield Promise.all([o,Oe()]);if(!s)throw this._dictionaryPromise=null,new pe("esri.renderers.DictionaryRenderer","Bad dictionary data!");let{authoringInfo:c,dictionary_version:l,expression:p,itemsNames:I}=s,S=p,w=!1;l&&(this._dictionaryVersion=Te.parse(l),w=this._dictionaryVersion.greaterEqual(4,0)),this._refSymbolUrlTemplate=this.url+"/"+s.cimRefTemplateUrl,this._itemNames=new Set(I),this._symbolFields=c.symbol;let C={};if(this.config){let n=this.config;for(let E in n)C[E]=n[E]}if(c.configuration)for(let n of c.configuration)C.hasOwnProperty(n.name)||(C[n.name]=n.value);let f=[];if(t?.fields&&this.fieldMap)for(let n in this.fieldMap){let E=this.fieldMap[n],V=t.fields.filter(v=>v.name.toLowerCase()===E?.toLowerCase());V.length>0&&f.push(ne(J({},V[0]),{type:w?V[0].type:"esriFieldTypeString"}))}f.length>0&&(this._fieldIndex=new be(f));let h=Le(S,t!=null?t.spatialReference:null,f,C).then(n=>{let E={scale:0};return(V,v)=>{if(n==null)return null;let q=n.repurposeFeature({geometry:null,attributes:V});return E.scale=v!=null?v.scale??void 0:void 0,n.evaluate({$feature:q,$view:E},n.services)}}).catch(n=>(N.getLogger(qe).error("Creating dictionary expression failed:",n),null));return this._dictionaryPromise=h,h})}_cimPartsToCIMSymbol(t,o,s,c,l){return d(this,null,function*(){let p=new Array(o.length);for(let w=0;w<o.length;w++)p[w]=this._getSymbolPart(o[w],l);let I=yield Promise.all(p),S=this.fieldMap;if(S){I=a(I);for(let w of I)Ce.applyDictionaryTextOverrides(w,t,S,this._fieldIndex,_e(w))}return new Ee({data:Ue(I,s,c)})})}_getSymbolPart(t,o){return d(this,null,function*(){let s=this._symbolCache.get(t);if(s)return s;if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(p=>p.data);let c=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,t),l=G(c,J({responseType:"json",query:{f:"json"}},o));this._ongoingRequests.set(t,l),l.finally(()=>this._ongoingRequests.delete(t));try{let p=yield l;return this._symbolCache.put(t,p.data),p.data}catch(p){throw p}})}};function Ue(e,t,o){if(!e||e.length===0)return null;let s=J({},e[0]);if(e.length>1){s.effects=null,s.symbolLayers=[];for(let c of e){let l=c;if(l.effects!=null)for(let p of l.symbolLayers)p.effects==null?p.effects=l.effects:p.effects.unshift(...l.effects);s.symbolLayers.unshift(...l.symbolLayers)}}return o&&(s.callout=Be),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:t}}var Y,j=Y=class extends F(_){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new k(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,o,s){s?.origin||super.writeVisualVariables(e,t,o,s)}clone(){return new Y({config:a(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:a(this.fieldMap),url:a(this.url),visualVariables:a(this.visualVariables)})}getSymbolAsync(e,t){return d(this,null,function*(){return this._loader.getSymbolAsync(e,t)})}collectRequiredFields(e,t){return d(this,null,function*(){yield this.collectVVRequiredFields(e,t),this.scaleExpression&&(yield P(e,t,this.scaleExpression));for(let o in this.fieldMap){let s=this.fieldMap[o];t.has(s)&&e.add(s)}})}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};r([i({type:k})],j.prototype,"_loader",null),r([i({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],j.prototype,"config",void 0),r([i({type:Object,json:{write:!0}})],j.prototype,"fieldMap",void 0),r([i({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],j.prototype,"scaleExpression",void 0),r([Z("scaleExpression")],j.prototype,"writeData",null),r([i({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],j.prototype,"scaleExpressionTitle",void 0),r([i({type:String,json:{write:!0}})],j.prototype,"url",void 0),r([Z("visualVariables")],j.prototype,"writeVisualVariables",null),j=Y=r([m("esri.renderers.DictionaryRenderer")],j);var Ae=j;var ee,R=ee=class extends D{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(N.getLogger(this).error(".field: field must be a string value"),null):me(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new ee({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};r([i({type:u,json:{type:[Number],write:!0}})],R.prototype,"color",void 0),r([i({type:String,json:{write:!0}})],R.prototype,"field",void 0),r([fe("field")],R.prototype,"castField",null),r([i({type:String,json:{write:!0}})],R.prototype,"label",void 0),r([i({type:String,json:{write:!0}})],R.prototype,"valueExpression",void 0),r([i({type:String,json:{write:!0}})],R.prototype,"valueExpressionTitle",void 0),R=ee=r([m("esri.renderers.support.AttributeColorInfo")],R);var U=R;var te,K=te=class extends D{constructor(){super(...arguments),this.unit=null}clone(){return new te({unit:this.unit})}};r([i({type:String,json:{write:!0}})],K.prototype,"unit",void 0),K=te=r([m("esri.renderers.support.DotDensityLegendOptions")],K);var ke=K;var re,g=re=class extends F(_){constructor(e){super(e),this.attributes=null,this.backgroundColor=new u([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new A,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;let t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new Ie({outline:this.outline})}getSymbolAsync(){return d(this,null,function*(){return this.getSymbol()})}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new re({attributes:a(this.attributes),backgroundColor:a(this.backgroundColor),dotBlendingEnabled:a(this.dotBlendingEnabled),dotShape:a(this.dotShape),dotSize:a(this.dotSize),dotValue:a(this.dotValue),legendOptions:a(this.legendOptions),outline:a(this.outline),referenceScale:a(this.referenceScale),seed:a(this.seed),visualVariables:a(this.visualVariables),authoringInfo:a(this.authoringInfo)})}getControllerHash(){return`${this.attributes?.map(t=>t.field||t.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}collectRequiredFields(e,t){return d(this,null,function*(){yield this.collectVVRequiredFields(e,t);for(let o of this.attributes??[])o.valueExpression&&(yield P(e,t,o.valueExpression)),o.field&&e.add(o.field)})}};r([i({type:[U],json:{write:!0}})],g.prototype,"attributes",void 0),r([i({type:u,json:{write:!0}})],g.prototype,"backgroundColor",void 0),r([i({type:Boolean,json:{write:!0}})],g.prototype,"dotBlendingEnabled",void 0),r([i({type:String,json:{write:!1}})],g.prototype,"dotShape",void 0),r([i({type:Number,json:{write:!0}})],g.prototype,"dotSize",void 0),r([i({type:ke,json:{write:!0}})],g.prototype,"legendOptions",void 0),r([i({type:A,json:{default:null,write:!0}})],g.prototype,"outline",void 0),r([i({type:Number,json:{write:!0}})],g.prototype,"dotValue",void 0),r([i({type:Number,json:{write:!0}})],g.prototype,"referenceScale",void 0),r([i({type:Number,json:{write:!0}})],g.prototype,"seed",void 0),r([O({dotDensity:"dot-density"})],g.prototype,"type",void 0),g=re=r([m("esri.renderers.DotDensityRenderer")],g);var He=g;var ie,H=ie=class extends D{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new ie({color:this.color&&this.color.clone(),ratio:this.ratio})}};r([i({type:u,json:{type:[ye],default:null,write:!0}})],H.prototype,"color",void 0),r([i({type:Number,json:{write:!0}})],H.prototype,"ratio",void 0),H=ie=r([m("esri.renderers.support.HeatmapColorStop")],H);var $=H;var T=class extends L(D){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};r([i({type:String,json:{write:!0}})],T.prototype,"minLabel",void 0),r([i({type:String,json:{write:!0}})],T.prototype,"maxLabel",void 0),r([i({type:String,json:{write:!0}})],T.prototype,"title",void 0),T=r([m("esri.renderers.support.HeatmapLegendOptions")],T);var oe;function $e(e){if(e!=null){let{maxDensity:o,minDensity:s,radius:c}=e;if(o!=null||s!=null||c!=null){let t=e,{blurRadius:l,maxPixelIntensity:p,minPixelIntensity:I}=t;return le(t,["blurRadius","maxPixelIntensity","minPixelIntensity"])}}return e}var y=oe=class extends _{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new $({ratio:0,color:new u("rgba(255, 140, 0, 0)")}),new $({ratio:.75,color:new u("rgba(255, 140, 0, 1)")}),new $({ratio:.9,color:new u("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(e){return $e(e)}get blurRadius(){return xe(this.radius)}set blurRadius(e){let t=this.maxPixelIntensity,o=this.minPixelIntensity;this._set("radius",ve(e)),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",o*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(we**2*this.blurRadius**4)}read(e,t){e=$e(e),super.read(e,t)}getSymbol(){return new B}getSymbolAsync(){return d(this,null,function*(){return this.getSymbol()})}getSymbols(){return[this.getSymbol()]}collectRequiredFields(e,t){return d(this,null,function*(){let o=this.field,s=this.valueExpression;o&&typeof o=="string"&&Fe(e,t,o),s&&typeof s=="string"&&(yield P(e,t,s))})}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new oe({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:a(this.colorStops),field:this.field,legendOptions:a(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};r([i({type:Ve,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],y.prototype,"authoringInfo",void 0),r([i({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],y.prototype,"blurRadius",null),r([i({type:[$],json:{write:!0}})],y.prototype,"colorStops",void 0),r([i({type:String,json:{write:!0}})],y.prototype,"field",void 0),r([i({type:T,json:{write:!0}})],y.prototype,"legendOptions",void 0),r([i({type:Number,json:{write:!0}})],y.prototype,"maxDensity",void 0),r([i({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],y.prototype,"maxPixelIntensity",null),r([i({type:Number,json:{write:!0}})],y.prototype,"minDensity",void 0),r([i({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],y.prototype,"minPixelIntensity",null),r([i({type:Number,cast:z,json:{write:!0}})],y.prototype,"radius",void 0),r([i({type:Number,range:{min:0},json:{default:0,write:!0}})],y.prototype,"referenceScale",void 0),r([O({heatmap:"heatmap"})],y.prototype,"type",void 0),r([i({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],y.prototype,"valueExpression",void 0),r([i({type:String})],y.prototype,"valueExpressionTitle",void 0),r([i({readOnly:!0})],y.prototype,"_pixelIntensityToDensity",null),y=oe=r([m("esri.renderers.HeatmapRenderer")],y);var se=y;var M=class extends L(D){constructor(){super(...arguments),this.color=new u([0,0,0,0]),this.label=null,this.threshold=0}};r([i({type:u,json:{write:!0}})],M.prototype,"color",void 0),r([i({type:String,json:{write:!0}})],M.prototype,"label",void 0),r([i({type:Number,range:{min:0,max:1},json:{write:!0}})],M.prototype,"threshold",void 0),M=r([m("esri.renderers.support.OthersCategory")],M);var Ke={base:De,key:"type",typeMap:{size:Re,opacity:Ne}},b=class extends F(L(_)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new u([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new M,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){return new B({size:this.size?this.size/2+(this.outline?.width||0):0})}getSymbolAsync(){return d(this,null,function*(){return this.getSymbol()})}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(ae)}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}collectRequiredFields(e,t){return d(this,null,function*(){yield this.collectVVRequiredFields(e,t);for(let o of this.attributes)o.valueExpression&&(yield P(e,t,o.valueExpression)),o.field&&e.add(o.field)})}};r([i({type:[U],json:{write:!0}})],b.prototype,"attributes",void 0),r([i(Pe)],b.prototype,"backgroundFillSymbol",void 0),r([i({type:u,json:{write:!0}})],b.prototype,"defaultColor",void 0),r([i({type:String,json:{write:!0}})],b.prototype,"defaultLabel",void 0),r([i({type:Number,range:{min:0,max:1},json:{write:!0}})],b.prototype,"holePercentage",void 0),r([i({type:M,json:{write:!0}})],b.prototype,"othersCategory",void 0),r([i({type:Me,json:{write:!0}})],b.prototype,"legendOptions",void 0),r([i({type:A,json:{default:null,write:!0}})],b.prototype,"outline",void 0),r([i({type:Number,cast:z,json:{write:!0}})],b.prototype,"size",void 0),r([O({pieChart:"pie-chart"})],b.prototype,"type",void 0),r([i({types:[Ke]})],b.prototype,"visualVariables",void 0),b=r([m("esri.renderers.PieChartRenderer")],b);var Je=b;var ze={key:"type",base:_,typeMap:{heatmap:se,simple:W,"unique-value":X,"class-breaks":Q,"dot-density":He,dictionary:Ae,"pie-chart":Je},errorContext:"renderer"},Gi={key:"type",base:_,typeMap:{simple:W,"unique-value":X,"class-breaks":Q,heatmap:se},errorContext:"renderer",validate:Ge};function Ge(e){switch(e.type){case"simple":return Ze(e);case"unique-value":return Qe(e);case"class-breaks":return We(e);case"heatmap":return e}}function Ze(e){if(e.symbol)return e;N.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function Qe(e){let t=e.uniqueValueInfos,o=t?.filter(({symbol:s,label:c},l)=>(s||N.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${l}] ${c}) without a symbol from web scene.`),!!s));return o?.length!==t?.length&&(e.uniqueValueInfos=o),e}function We(e){let t=e.classBreakInfos,o=t?.filter(({symbol:s,label:c},l)=>(s||N.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${l}] ${c}) without a symbol from web scene.`),!!s));return o?.length!==t?.length&&(e.classBreakInfos=o),e}function Yi(e,t){return Ye(e,null,t)}var Xe=de({types:ze});function Ye(e,t,o){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(o?.messages&&o.messages.push(new ce("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:o})),null):Xe(e,t,o):null}export{$ as a,ze as b,Gi as c,Yi as d,Ye as e};
