import{a as et}from"./chunk-UYKI77KI.js";import{b as nt,e as lt,f as ct,h as pt}from"./chunk-4FO73WSB.js";import{c as st,d as at,f as ot,l as q,m as v,n as U,o as B,p as ht}from"./chunk-Q5GL3CSI.js";import{d as tt,e as re,j as P,m as rt,q as it}from"./chunk-4DR6EKLV.js";import{b as ut}from"./chunk-BJF27AOA.js";import{a as Ke}from"./chunk-SDHCGQUI.js";import{c as Xe}from"./chunk-B3W5V2XP.js";import{a as F}from"./chunk-S2HMCZNZ.js";import{j as Qe,l as Ye,m as Ze}from"./chunk-WUAC4CFP.js";import{a as Je}from"./chunk-NNNTRPDR.js";import{b as g}from"./chunk-J7UK2QPE.js";import{a as Be,b as je}from"./chunk-N6PITG7Q.js";import{d as He}from"./chunk-UW734WOQ.js";import{b as Ve,k as ze,l as Me,m as Ne}from"./chunk-ATV5GTE5.js";import{i as $e,k as We}from"./chunk-MJXFSFCY.js";import{b as ke}from"./chunk-TCQTMUK4.js";import{a as te}from"./chunk-NPIYHDQ7.js";import{a as ee}from"./chunk-YJ3RZNO6.js";import{b as _}from"./chunk-H7Y5XCPW.js";import{b as I}from"./chunk-JLNQ6WQT.js";import{a as Ue}from"./chunk-GB5RQL32.js";import{b as w,c as E}from"./chunk-OL24FY3J.js";import{r as Fe,s as qe}from"./chunk-OL43UY3L.js";import{a as X}from"./chunk-RRDM7P6F.js";import{i as Ie}from"./chunk-KLUVHTFQ.js";import{d as Pe,e as Oe}from"./chunk-O4AQRVFI.js";import{m as De}from"./chunk-PM4ZR7W6.js";import{E as _e,F as J,G as Ee,P as ve,j as Se,o as Le}from"./chunk-EPTSNNZF.js";import{b as we}from"./chunk-J6ZRC6RI.js";import{a as m}from"./chunk-7W6RATG7.js";import{c as G,i as K}from"./chunk-BDF7KEUQ.js";import{a as Re}from"./chunk-HWN5REN7.js";import{g as Ae}from"./chunk-XTES2GPX.js";import{n as Te}from"./chunk-2HUIJUS4.js";import{a as Z}from"./chunk-YFBPRKIN.js";import{a as fe,o as be}from"./chunk-T7BKG6V3.js";import{a as Y,j as ge}from"./chunk-6WKJD7BM.js";import{a as xe,c as Ce,f as Ge}from"./chunk-YRTBL7EE.js";import{a as R}from"./chunk-PYQRTZNZ.js";import{a as T}from"./chunk-HRP5LYWJ.js";import{m as de}from"./chunk-4DLSYLKE.js";import{k as ue}from"./chunk-TFUPB3ZG.js";import{a as f}from"./chunk-BMVJCP2M.js";import{E as ye,k as C,l as H,q as Q,r as me}from"./chunk-GMC3I5VG.js";import{q as ce,r as pe,t as W}from"./chunk-3IBUFXWY.js";import{t as ne,u as x,v as le,y as he}from"./chunk-BP73DJTS.js";import{a as d,b as L,g as u}from"./chunk-JEGVIFEP.js";function vt(s){return s==null||s.type==="simple"||s.type==="unique-value"||s.type==="class-breaks"||s.type==="dictionary"||s.type==="heatmap"}function Ut(s,e){if(s==null)return null;if(!vt(s))return new W("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${s.type||s.declaredClass}'`,{renderer:s});switch(s.type){case"simple":return Dt(s,e);case"unique-value":return xt(s,e);case"class-breaks":return Ct(s,e);case"dictionary":case"heatmap":return null}return null}function ie(s,e){if(!e)return null;let t;if(t=Array.isArray(e)?e:[e],t.length>0){let r=t.map(a=>a.details.symbol.type||a.details.symbol.declaredClass).filter(a=>!!a);r.sort();let i=[];return r.forEach((a,o)=>{o!==0&&a===r[o-1]||i.push(a)}),new W("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${i.join(", ")}) which are not supported in 3D`,{renderer:s,symbolErrors:t})}return null}function Dt(s,e){let t=L(d(d({},w),e),{cimFallbackEnabled:!0});return ie(s,E(s.symbol,t).error)}function xt(s,e){let t=L(d(d({},w),e),{cimFallbackEnabled:!0}),r=s.uniqueValueInfos?.map(a=>E(a.symbol,t).error).filter(x),i=E(s.defaultSymbol,t);return i.error&&r?.unshift(i.error),ie(s,r)}function Ct(s,e){let t=L(d(d({},w),e),{cimFallbackEnabled:!0}),r=s.classBreakInfos.map(a=>E(a.symbol,t).error).filter(x),i=E(s.defaultSymbol,t);return i.error&&r.unshift(i.error),ie(s,r)}var mt=class{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}queryElevation(e,t,r,i,a){return u(this,null,function*(){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,a,r,i)})}},yt=class{constructor(e,t,r,i){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions=L(d({},i),{ignoreInvisibleLayers:!0}),this._frameTask=e.registerTask(Pe.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Oe);else for(let t of this._queries)t.result.reject(C())}queryElevation(e,t,r,i=0){let a=ye(),o={x:e,y:t,minDemResolution:i,result:a,signal:r};return this._queries.push(o),Q(r,()=>{ne(this._queries,o),a.reject(C())}),a.promise}get running(){return this._queries.length>0}runTask(e){let t=this._queries;this._queries=[];let r=this._getElevationQueryProvider();if(!r)return t.forEach(h=>h.result.reject()),void e.madeProgress();let i=t.map(h=>[h.x,h.y]),a=t.reduce((h,c)=>Math.min(h,c.minDemResolution),1/0),o=new fe({points:i,spatialReference:this.spatialReference}),n=t.length>1&&t.some(h=>!!h.signal)?new AbortController:null,l=n!=null?n.signal:t[0].signal;if(n!=null){let h=0;t.forEach(c=>Q(c.signal,()=>{h++,c.result.reject(C()),h===t.length&&n.abort()}))}let p=L(d({},this._queryOptions),{minDemResolution:a,signal:l});r.queryElevation(o,p).then(h=>{t.forEach((c,$)=>{c.signal!=null&&c.signal.aborted?c.result.reject(C()):c.result.resolve(h.geometry.points[$][2])})}).catch(h=>{t.forEach(c=>c.result.reject(h))}),e.madeProgress()}get test(){}};var S,b;(function(s){s[s.USER=1]="USER",s[s.SCALE_RANGE=2]="SCALE_RANGE",s[s.FILTER=4]="FILTER",s[s.DECONFLICTION=8]="DECONFLICTION",s[s.ALL_GRAPHIC=15]="ALL_GRAPHIC",s[s.ALL_LABEL=255]="ALL_LABEL"})(S||(S={})),function(s){s[s.GRAPHIC=1]="GRAPHIC",s[s.LABEL=16]="LABEL"}(b||(b={}));var V=class{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}};var dt=class{constructor(e,t){this.scheduler=e,this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===Ue.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}},z=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var M=class extends je{constructor(e,t,r){super(e,t,new Be(ut,()=>import("./chunk-NZOQQKI2.js")),r)}initializePipeline(e){let t={func:e.terrainDepthTest?K.ALWAYS:K.LESS};return Ne(e.hudDepth?{depthTest:t,depthWrite:ze}:{blending:Ve(G.ONE,G.SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),depthTest:t,colorWrite:Me})}};var y=class extends Je{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.hasSlicePlane=!1,this.terrainDepthTest=!1,this.hasSliceInVertexProgram=!0,this.draped=!1}};f([g()],y.prototype,"screenCenterOffsetUnitsEnabled",void 0),f([g()],y.prototype,"occlusionTestEnabled",void 0),f([g()],y.prototype,"hasVerticalOffset",void 0),f([g()],y.prototype,"hasScreenSizePerspective",void 0),f([g()],y.prototype,"hudDepth",void 0),f([g()],y.prototype,"hudDepthAlignStart",void 0),f([g()],y.prototype,"hasSlicePlane",void 0),f([g()],y.prototype,"terrainDepthTest",void 0);var D=class extends $e{constructor(e,t){super(e,O),this.produces=new Map([[F.LINE_CALLOUTS,r=>r===te.Color],[F.LINE_CALLOUTS_HUD_DEPTH,r=>r===te.Color]]),this._configuration=new y(t),this._uniqueMaterialIdentifier=N(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){let r=t.slot===F.LINE_CALLOUTS_HUD_DEPTH;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hudDepth=r,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration}get visible(){return this.parameters.color[3]>=ee||(this.parameters.borderColor?.[3]??0)>=ee}intersect(){}createGLMaterial(e){return new se(e)}createBufferWriter(){return new ae}validateParameters(e){this._uniqueMaterialIdentifier=N(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}};function N({renderOccluded:s,isDecoration:e,horizontalScreenOffset:t,color:r,size:i,occlusionTest:a,shaderPolygonOffset:o,hudDepthAlignStart:n,centerOffsetUnits:l,hasSlicePlane:p,screenSizePerspective:h,verticalOffset:c,borderColor:$}){return ce`${s}:${e}:${t}:[${r}]:${i}:${a}:${o}:${n}:${l}:${p}:${h!=null}:{${c.screenLength}:${c.minWorldLength}:${c.maxWorldLength}}:[${$}]`}var se=class extends He{beginSlot(e){return this.acquireTechnique(M,e)}},O=class extends We{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=Ce(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}},Gt=we().vec3f(m.POSITION).vec3f(m.NORMAL).vec2f(m.UV0).vec4f(m.CENTEROFFSETANDDISTANCE),ft=[_(0,0),_(1,0),_(0,1),_(1,0),_(1,1),_(0,1)],ae=class{constructor(){this.vertexBufferLayout=Gt}elementCount(e){return 6*e.get(m.POSITION).indices.length}write(e,t,r,i,a,o){Ye(r.get(m.POSITION),e,a.position,o,6),Ze(r.get(m.NORMAL),t,a.normal,o,6),Qe(r.get(m.CENTEROFFSETANDDISTANCE),a.centerOffsetAndDistance,o,6);for(let n=0;n<ft.length;++n)a.uv0.setVec(o+n,ft[n])}};var A=class s extends ht{constructor(e,t){super(e,null,t,At),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}doLoad(){return u(this,null,function*(){this._materials[0]=new D(this._materialParameters,this._context.spherical),this._context.stage.add(this._materials[0])})}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){let t=this._materialParameters;return t.horizontalScreenOffset=e.horizontalScreenOffset??0,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){let e=new O,t=this.symbol,r=t.callout;if(r.color){let o=X.toUnitRGBA(r.color);o[3]*=this._getLayerOpacity(),e.color=o}else e.color=Ge;if(e.size=Z(r.size||0),t.verticalOffset){let{screenLength:o,minWorldLength:n,maxWorldLength:l}=t.verticalOffset;e.verticalOffset={screenLength:Z(o),minWorldLength:n||0,maxWorldLength:l??1/0}}e.borderColor=r.border?.color!=null?X.toUnitRGBA(r.border.color):null;let i=t.symbolLayers.at(0).type==="object",a=t.type==="label-3d";return e.occlusionTest=!i,e.shaderPolygonOffset=i?0:void 0,e.hudDepthAlignStart=a,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Ot}createGraphics3DGraphic(e){let t=e.renderingInfo,r=e.graphic,i=this.setGraphicElevationContext(r,new it,t.elevationOffset||0),a=t.symbol,o=this._elevationContext.mode==="on-the-ground"&&(a.type==="cim"||!a.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(a.type!=="label-3d"&&o||a.type==="point-3d"&&a.symbolLayers.every(l=>l.type==="text"&&!qe(l)))return null;let n=Ke(r.geometry);return n==null?null:this._createAs3DShape(n,i,t,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,r){let i=this._elevationContext.mode,a=tt(s.elevationModeChangeTypes,r,i);return a!==P.UPDATE||e.forEach(o=>{let n=t(o);n!=null&&this.updateGraphicElevationContext(o.graphic,n)}),a}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,t,r=0){return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(r),t}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata!=null?t.metadata.elevationOffset:0),t.needsElevationUpdates=re(t.elevationContext.mode)}computeComplexity(){return new st({verticesPerFeature:6})}_getOrCreateMaterial(e){let t=this._perInstanceMaterialParameters(e),r=N(t);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let i=e.materialCollection.get(r);return i==null&&(i=new D(t,this._context.spherical),e.materialCollection.add(r,i)),{material:i,isUnique:!1}}return{material:new D(t,this._context.spherical),isUnique:!0}}_createAs3DShape(e,t,r,i){let a=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:a}),n=this._getOrCreateMaterial(r),l=new Xe(n.material,Pt(r),null,ke.Point,o),p=ct(this._context,e,l,t,i);if(p==null)return null;let h=new q(this,p.object,[l],n.isUnique?[n.material]:null,null,nt,t);return h.metadata=new lt(r.elevationOffset),h.alignedSampledElevation=p.sampledElevation,h.needsElevationUpdates=re(t.mode),pt(h,e,this._context.elevationProvider),h}};function Pt(s){let{translation:e,centerOffset:t}=s,r=new I(e?[e[0],e[1],e[2]]:[0,0,0],oe,3,!0),i=new I(t?[t[0],t[1],t[2],t[3]]:[0,0,0,1],oe,4,!0);return[[m.POSITION,r],[m.NORMAL,new I([0,0,1],oe,3,!0)],[m.CENTEROFFSETANDDISTANCE,i]]}A.elevationModeChangeTypes={definedChanged:P.UPDATE,staysOnTheGround:P.UPDATE,onTheGroundChanged:P.RECREATE};var oe=[0],Ot={mode:"relative-to-ground",offset:0},At={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},gt=class{constructor(e,t,r=R(),i=xe(),a=0,o="world",n=0,l=null){this.renderer=e,this.symbol=t,this.translation=r,this.centerOffset=i,this.horizontalScreenOffset=a,this.centerOffsetUnits=o,this.elevationOffset=n,this.materialCollection=l}},bt=class extends V{};var St=()=>pe.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Hr(s,e){if(!Fe(s))return St().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${s.type}' does not support callouts`),null;if(!s.callout)return null;let t=Tt[s.callout.type];return t?new t(s,e):(St().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${s.callout.type}`),null)}var Tt={line:A};var Lt=class extends U{constructor(e,t,r){super(t),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}doLoad(e){return u(this,null,function*(){let t=yield this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),this.graphics3DSymbol!=null&&(yield this.graphics3DSymbol.load())})}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:at}globalPropertyChanged(e,t){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,t):v.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,t)}updateTransform(e,t,r,i){return this.graphics3DSymbol?.updateTransform(e,t,r,i)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};var _t=new ue(Array,s=>_e(s,ve),null,10,5),Rt=Y(),j=class{get labelLayers(){return this._labelLayers||le}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,t,r,i,a){this.graphic=e,this.graphics3DSymbol=t,this.layers=r,this._visibleFlags=S.ALL_LABEL,this.deconflictionPriority=0,++t.referenced,this._featureExpressionFeature=a?rt(a,e,i):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(t=>{t.initialize(e),t.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(b.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(t=>{t.type==="draped"&&(e=!0)}),e}isVisible(e=b.GRAPHIC,t){let r=t?this._visibleFlags|t|b.LABEL*t:this._visibleFlags;return e===b.GRAPHIC?(r&S.ALL_GRAPHIC)===S.ALL_GRAPHIC:(r&S.ALL_LABEL)===S.ALL_LABEL}setVisibilityFlag(e,t,r){let i=this.isVisible(e);r?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);let a=this.isVisible(e);if(i===a)return!1;if(e===b.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(a));else{this._forEachSymbolLayerGraphic(n=>n.setVisibility(a));let o=this.isVisible(b.LABEL);this._forEachLabelGraphic(n=>n.setVisibility(o))}return!0}getVisibilityFlag(e,t){return!!(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){let t=this.graphic.geometry;if(t==null)return!1;this._extent=Y(),Ie(t,this._extent);let r=t.spatialReference;if(!de(r,e)&&!et(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,r){let i=e.geometry;return i.type!=="mesh"&&i.type!=="extent"||(i=be.fromExtent(i.type==="mesh"?i.extent:i)),De(i,t,r)}get usedMemory(){let e=he(this.graphic.attributes);return this._forEachSymbolLayerGraphic(t=>e+=t.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){let e={render:{origin:R(),num:0},draped:{origin:Re(),num:0}};for(let t of this.layers)t?.computeAttachmentOrigin(e);return e.render.num>1&&Te(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Ae(e.draped.origin,e.draped.origin,1/e.draped.num),e}getProjectedBoundingBox(e,t,r,i,a){return u(this,null,function*(){return a||(a={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),a.boundingBox?J(a.boundingBox):a.boundingBox=J(),a.requiresDrapedElevation=!1,yield T(this.layers,o=>u(this,null,function*(){if(o==null)return;let n=o.type==="draped"?t:e,l=_t.acquire(),p=yield o.getProjectedBoundingBox(n,r,a.screenSpaceObjects,i,l);isFinite(p[2])&&isFinite(p[5])||(a.requiresDrapedElevation=!0),p&&Se(a.boundingBox,l),_t.release(l)})),Le(a.boundingBox)||ge(Ee(a.boundingBox,Rt))?a:null})}needsElevationUpdates(){for(let e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,t,r){this._forEachRenderedGraphic(i=>{i.type!=="object3d"&&i.type!=="lod-instance"||i.alignWithElevation(e,t,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,t,r){this._forEachRenderedGraphic(i=>{i.type==="object3d"&&i.alignWithAbsoluteElevation(e,t,r)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(t=>t.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(t=>t.removeObjectState(e))}_forEachGraphicList(e,t){e?.forEach(r=>r&&t(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}};var Et=class extends U{set symbol(e){this._symbol=e,e.symbolLayers.forEach((t,r)=>{let i=this.symbolLayers[r];i!=null&&(i.symbol=e,i.symbolLayer=t)})}get symbol(){return this._symbol}constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}doLoad(e){return u(this,null,function*(){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));let r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;let i=[],{make:a}=yield import("./chunk-EL2BUUUI.js");for(let o=0;o<r;o++){let n=t.at(o);if(n.enabled===!1)continue;k.renderPriority=1-(1+o)/r,k.renderPriorityStep=1/r,k.ignoreDrivers=n.ignoreDrivers;let l=a(this.symbol,n,this._context,k),p=me(e,()=>{this.symbolLayers[o]=null,l.destroy()});p&&i.push(p),this.symbolLayers[o]=l}if(yield T(this.symbolLayers,(o,n)=>u(this,null,function*(){if(o!=null)try{yield o.load(),this._extentPadding+=Math.max(this._extentPadding,o.extentPadding)}catch{this.symbolLayers[n]=null}})),i.forEach(o=>o.remove()),H(e),this.symbolLayers.length&&!this.symbolLayers.some(o=>!!o))throw new Error})}getSymbolLayerSize(e){let t=this.symbolLayers[e];return t!=null?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}createGraphics3DGraphic(e,t){let r=e.graphic,i=this.symbolLayers.map(o=>o?.createGraphics3DGraphic(e)??null),a=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new j(r,t||this,i,e.layer,a)}get complexity(){return ot(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,t){let r=this.symbolLayers.length;for(let i=0;i<r;i++){let a=this.symbolLayers[i],o=n=>{let l=n.layers[i];return l instanceof q?l:null};if(a!=null&&!a.globalPropertyChanged(e,t,o))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==B.LOADED?v.RecreateSymbol:this.symbolLayers.reduce((r,i)=>r!==v.RecreateSymbol&&i!=null?Math.min(r,i.applyRendererDiff(e,t)):r,v.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===B.FAILED||e.diff.type!=="partial")return;let t=e.diff.diff;if(!t.symbolLayers||t.symbolLayers.type!=="partial")return;let r=t.symbolLayers.diff;this.symbolLayers.forEach((i,a)=>{if(i==null)return;let o=r[a];if(o){let n={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};i.prepareSymbolLayerPatch(n),e.symbolStatePatches.push(...n.symbolLayerStatePatches),n.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,p)=>{let h=l.layers[a];h!=null&&n.graphics3DGraphicPatches.forEach(c=>c(h,p))})}})}updateGeometry(e,t){return this._updateGeometryOrTransform(e,(r,i)=>r.updateGeometry(i,t))}updateTransform(e,t,r,i){return this._updateGeometryOrTransform(e,(a,o)=>a.updateTransform(o,t,r,i))}_updateGeometryOrTransform(e,t){for(let r=0;r<this.symbolLayers.length;r++){let i=this.symbolLayers[r];if(i==null)continue;let a=e.layers[r];if(!a||!t(i,a))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){let r=this.symbolLayers[t];if(r==null)continue;let i=e.layers[t];i!=null&&r.onRemoveGraphic(i)}}getFastUpdateStatus(){let e=0,t=0,r=0;return this.symbolLayers.forEach(i=>{i!=null&&(i.loadStatus===B.LOADING?e++:i.isFastUpdatesEnabled()?r++:t++)}),{loading:e,slow:t,fast:r}}queryForSnapping(e,t,r,i){return u(this,null,function*(){let a=this.symbolLayers.filter(x).filter(n=>n.queryForSnapping!=null).map(n=>n.queryForSnapping(e,t,r,i)),o=yield Promise.all(a);return H(i),o.flat()})}destroy(){if(!this.destroyed){super.destroy();for(let e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}},k=new z;export{vt as a,Ut as b,mt as c,yt as d,S as e,b as f,V as g,dt as h,gt as i,bt as j,Hr as k,Et as l,Lt as m};
