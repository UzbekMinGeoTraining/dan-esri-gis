import{a as Y}from"./chunk-SDRDL3LF.js";import{a as Se}from"./chunk-4UY52H4D.js";import{a as Ae}from"./chunk-3YHUBCUW.js";import{a as B,b as q,c as V,d as Ne,e as M,f as Z,g as Le,h as Ce,i as ve,j as $e,l as Pe,m as ee,n as Ue,o as Re,r as Me,s as le}from"./chunk-PEVPE7KH.js";import"./chunk-EPI6QXKT.js";import{r as oe,v as Ze}from"./chunk-W5YQAWKU.js";import{a as be}from"./chunk-YAFRUDEN.js";import{c as $}from"./chunk-PQ2CFAKW.js";import{B as De,D as A,E as _,H as N,J as ae,L as R,M as re,N as J,O as Te,Q as E,V as b,Y as O,Z as xe,_ as z,b as c,c as m,ia as Ee,sa as se,t as K,u as ge,w as L,y as v}from"./chunk-4RJTDUBN.js";import{c as Q}from"./chunk-MTRBRBPC.js";import{a as Ie}from"./chunk-A7GYEEN6.js";import"./chunk-3LZC5E4L.js";import{a as X}from"./chunk-VHWLEJLO.js";import"./chunk-XMXL44YY.js";import"./chunk-4HD5O3T7.js";import"./chunk-OSH5MRH4.js";import"./chunk-M5EU7OBK.js";import"./chunk-ZIKE37L7.js";import"./chunk-RMOAL4BI.js";import"./chunk-4SXNSTQ4.js";import"./chunk-A74W4U2J.js";import"./chunk-MAZHSYWX.js";import"./chunk-YVFVORWT.js";import"./chunk-DAAL3W2C.js";import"./chunk-YB6FP3Z6.js";import"./chunk-T7FSW5ND.js";import"./chunk-WUZAEWWX.js";import{e as D}from"./chunk-KAOR3JAH.js";import{a as Fe}from"./chunk-ACVF7Z7X.js";import"./chunk-U3ETEC6R.js";import"./chunk-A2IYJOJO.js";import"./chunk-EFOMVUIX.js";import"./chunk-42DKYLC7.js";import"./chunk-LB3WSIYI.js";import"./chunk-B7ZDEOLU.js";import"./chunk-22JBWFHY.js";import"./chunk-6YHOGO6F.js";import"./chunk-VY6QN6EN.js";import"./chunk-VZPIZOOE.js";import"./chunk-BWCHJXL6.js";import"./chunk-R7X3CKFH.js";import"./chunk-64FW22PO.js";import"./chunk-3EB3OCOV.js";import"./chunk-7Z3Y27UA.js";import"./chunk-HFXUZM7A.js";import"./chunk-3A66AUSD.js";import"./chunk-UUKQEAQR.js";import"./chunk-6UUMJQNV.js";import"./chunk-Y63DBETK.js";import"./chunk-GNKF5TIB.js";import"./chunk-X4XHTJSF.js";import"./chunk-YIBWVOPM.js";import"./chunk-PY5WUUCV.js";import"./chunk-R3XRMWAK.js";import"./chunk-PL6CVK2A.js";import"./chunk-J2R7NR2E.js";import"./chunk-VPH54J3G.js";import"./chunk-OD6TX477.js";import"./chunk-ISUG5L3D.js";import"./chunk-FKKNYWR6.js";import"./chunk-YJ3RZNO6.js";import"./chunk-M4PATAW3.js";import"./chunk-BNQ5VRNF.js";import"./chunk-NOFXYDQS.js";import"./chunk-4BLMEKFL.js";import"./chunk-RPIA54UY.js";import"./chunk-WRN6YTSB.js";import"./chunk-BQ7BWYEG.js";import"./chunk-CA2IXN6Q.js";import"./chunk-AXPRNSO3.js";import"./chunk-FIUHDVVO.js";import"./chunk-3HX6VT75.js";import"./chunk-U4Y7WABQ.js";import"./chunk-WYOOSF42.js";import"./chunk-R6S6A5GA.js";import"./chunk-25T3ULWN.js";import"./chunk-C3YONAAM.js";import"./chunk-2GSAHDXY.js";import"./chunk-OL24FY3J.js";import"./chunk-QBRYULPI.js";import"./chunk-GPQLPPA5.js";import"./chunk-OXRGERMH.js";import"./chunk-LHH3AZP2.js";import"./chunk-HVNUIUKO.js";import"./chunk-Y5M2SONX.js";import"./chunk-Q6ZVH4MK.js";import"./chunk-OL43UY3L.js";import"./chunk-H2QMNAXT.js";import"./chunk-GKUDWGVQ.js";import"./chunk-NZ7WSL6F.js";import"./chunk-RRDM7P6F.js";import"./chunk-EYI3QUAE.js";import"./chunk-63EK7JRZ.js";import"./chunk-HVNRUZWJ.js";import"./chunk-ZGDQY5ZD.js";import"./chunk-QH2MD2O2.js";import"./chunk-6EZNY6L4.js";import"./chunk-3IK5VXZ3.js";import"./chunk-7XLHE26H.js";import"./chunk-MBVOWLUI.js";import"./chunk-EN6CTWVM.js";import"./chunk-IRJNWXGT.js";import{e as W}from"./chunk-LVPMJTA6.js";import"./chunk-7LUQF6AI.js";import"./chunk-AO7UDTUI.js";import"./chunk-Q7O5PY54.js";import"./chunk-PFIMJ2UL.js";import"./chunk-PM4ZR7W6.js";import"./chunk-ENLR2WBX.js";import"./chunk-RI3FIROF.js";import"./chunk-PJX4LNSV.js";import"./chunk-NNETCWLJ.js";import"./chunk-EPTSNNZF.js";import"./chunk-FW33MEBA.js";import"./chunk-RM6CXOHZ.js";import"./chunk-AOA5JMXK.js";import"./chunk-TWW3KW7Z.js";import"./chunk-VDNXTMSC.js";import"./chunk-MBJHSEMD.js";import"./chunk-K72LO6P2.js";import"./chunk-NKMODNM6.js";import"./chunk-SEKMXZL5.js";import"./chunk-2R4SNL6O.js";import"./chunk-MXOOOTCV.js";import"./chunk-7D4IYTAJ.js";import"./chunk-TSNWBMBA.js";import"./chunk-GLWPOGYF.js";import"./chunk-YFBPRKIN.js";import"./chunk-P2YRCTWM.js";import"./chunk-OFZ6SV37.js";import"./chunk-LAJXTVEO.js";import"./chunk-5MNDZ6BX.js";import"./chunk-RDHMB7M5.js";import"./chunk-YSOJWUIW.js";import"./chunk-Q5WFUDPQ.js";import"./chunk-DPZGANVI.js";import"./chunk-T7BKG6V3.js";import"./chunk-R6VC74T7.js";import"./chunk-6WKJD7BM.js";import"./chunk-3CR7P5WT.js";import"./chunk-YRTBL7EE.js";import"./chunk-3FPO2LOS.js";import"./chunk-QNZSBADV.js";import"./chunk-PYQRTZNZ.js";import"./chunk-S4PLWG55.js";import"./chunk-DZAY272R.js";import"./chunk-GYH7NDHH.js";import"./chunk-S3UQHW42.js";import"./chunk-VQHENXDQ.js";import"./chunk-VWF5VUO3.js";import"./chunk-HRP5LYWJ.js";import"./chunk-BIVFGNT6.js";import"./chunk-EUZMXXZJ.js";import{c as fe}from"./chunk-7PEPFLZH.js";import"./chunk-BRVOQZDM.js";import"./chunk-3M7VXIQH.js";import"./chunk-TBYT66N3.js";import"./chunk-5PTS4JDF.js";import"./chunk-MUI46NAG.js";import"./chunk-N27U3N2T.js";import"./chunk-4R5NBZMW.js";import"./chunk-NDYVXEZ5.js";import"./chunk-CMMPCPP5.js";import"./chunk-4DLSYLKE.js";import"./chunk-VPXBKZQM.js";import"./chunk-ZTKK3KB7.js";import"./chunk-GZXWFBZI.js";import"./chunk-B7IARA3F.js";import"./chunk-IZVEJCCI.js";import"./chunk-TEY6TKJV.js";import"./chunk-4M6XQSBA.js";import"./chunk-2JF6YUJG.js";import"./chunk-GGZQ5GCM.js";import"./chunk-TFUPB3ZG.js";import"./chunk-ANPNMGFG.js";import"./chunk-BMVJCP2M.js";import{B as he}from"./chunk-GMC3I5VG.js";import"./chunk-WGF2T2BG.js";import"./chunk-YZP43POT.js";import"./chunk-VEDIBGHD.js";import"./chunk-3IBUFXWY.js";import"./chunk-BP73DJTS.js";import{g as S}from"./chunk-JEGVIFEP.js";function je(r){if(r.length===1){if(A(r[0]))return Y("distinct",r[0],-1);if(R(r[0]))return Y("distinct",r[0].toArray(),-1)}return Y("distinct",r,-1)}function de(r,n,i){return S(this,null,function*(){let y=r.getVariables();if(y.length>0){let g=[];for(let t=0;t<y.length;t++){let s={name:y[t]};g.push(yield n.evaluateIdentifier(i,s))}let e={};for(let t=0;t<y.length;t++)e[y[t]]=g[t];return r.parameters=e,r}return r})}function u(r,n,i=null){for(let y in r)if(y.toLowerCase()===n.toLowerCase())return r[y];return i}function ke(r){if(r===null)return null;let n={type:u(r,"type",""),name:u(r,"name","")};if(n.type==="range")n.range=u(r,"range",[]);else{n.codedValues=[];for(let i of u(r,"codedValues",[]))n.codedValues.push({name:u(i,"name",""),code:u(i,"code",null)})}return n}function ue(r){if(r===null)return null;let n={},i=u(r,"wkt");i!==null&&(n.wkt=i);let y=u(r,"wkid");return y!==null&&(n.wkid=y),n}function Oe(r){if(r===null)return null;let n={hasZ:u(r,"hasz",!1),hasM:u(r,"hasm",!1)},i=u(r,"spatialreference");i!=null&&(n.spatialReference=ue(i));let y=u(r,"x",null);if(y!==null)return n.x=y,n.y=u(r,"y",null),n.hasZ&&(n.z=u(r,"z",null)),n.hasM&&(n.m=u(r,"m",null)),n;let g=u(r,"rings",null);if(g!==null)return n.rings=g,n;let e=u(r,"paths",null);if(e!==null)return n.paths=e,n;let t=u(r,"points",null);if(t!==null)return n.points=t,n;for(let s of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){let l=u(r,s,null);l!==null&&(n[s]=l)}return n}function He(r,n){for(let i of n)if(i===r)return!0;return!1}function Ge(r){return!!r.layerDefinition&&!!r.featureSet&&He(r.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])!==!1&&A(r.layerDefinition.fields)!==!1&&A(r.featureSet.features)!==!1}function j(r){return r?.toLowerCase()==="utc"?"UTC":r?.toLowerCase()==="unknown"?"Unknown":r}function wn(r){r.mode==="async"&&(r.functions.timezone=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){if(E(e,1,2,n,i),Te(e[0])||J(e[0]))return"Unknown";if(N(e[0])){if(yield e[0].load(),e.length===1||e[1]===null)return e[0].datesInUnknownTimezone?j("unknown"):j(e[0].dateFieldsTimeZone);if(!(e[1]instanceof $)||e[1].hasField("type")===!1)throw new m(n,c.InvalidParameter,i);let l=e[1].field("type");if(v(l)===!1)throw new m(n,c.InvalidParameter,i);switch(b(l).toLowerCase()){case"preferredtimezone":return j(e[0].preferredTimeZone);case"editfieldsinfo":return j(e[0].editFieldsInfo?.timeZone??null);case"timeinfo":return j(e[0].timeInfo?.timeZone??null);case"field":if(e[1].hasField("fieldname")&&v(e[1].field("fieldname")))return j(e[0].fieldTimeZone(b(e[1].field("fieldname"))))}throw new m(n,c.InvalidParameter,i)}let t=xe(e[0],se(n));if(t===null)return null;let s=t.timeZone;return s==="system"?Fe.systemTimeZoneCanonicalName:s.toLowerCase()==="utc"?"UTC":s.toLowerCase()==="unknown"?"Unknown":s}))},r.functions.sqltimestamp=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){E(e,1,3,n,i);let t=e[0];if(re(t)){if(e.length===1)return t.toSQLWithKeyword();if(e.length===2)return t.changeTimeZone(b(e[1])).toSQLWithKeyword();throw new m(n,c.InvalidParameter,i)}if(J(t))return t.toSQLWithKeyword();if(N(t)){if(e.length!==3)throw new m(n,c.InvalidParameter,i);yield t.load();let s=b(e[1]);if(J(e[2]))return e[2].toSQLWithKeyword();if(re(e[2])===!1)throw new m(n,c.InvalidParameter,i);let l=t.fieldTimeZone(s);return l===null?e[2].toSQLWithKeyword():e[2].changeTimeZone(l).toSQLWithKeyword()}throw new m(n,c.InvalidParameter,i)}))},r.signatures.push({name:"sqltimestamp",min:2,max:4}),r.functions.featuresetbyid=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>{if(E(e,2,4,n,i),ae(e[0])){let t=b(e[1]),s=L(e[2],null),l=z(L(e[3],!0));if(s===null&&(s=["*"]),A(s)===!1)throw new m(n,c.InvalidParameter,i);return e[0].featureSetById(t,l,s)}throw new m(n,c.InvalidParameter,i)})},r.signatures.push({name:"featuresetbyid",min:2,max:4}),r.functions.getfeatureset=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){if(E(e,1,2,n,i),_(e[0])){let t=L(e[1],"datasource");return t===null&&(t="datasource"),t=b(t).toLowerCase(),Me(e[0].fullSchema(),t,n.lrucache,n.interceptor,n.spatialReference??null)}throw new m(n,c.InvalidParameter,i)}))},r.signatures.push({name:"getfeatureset",min:1,max:2}),r.functions.featuresetbyportalitem=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>{if(E(e,2,5,n,i),e[0]===null)throw new m(n,c.PortalRequired,i);if(e[0]instanceof Ae){let f=b(e[1]),a=b(e[2]),o=L(e[3],null),d=z(L(e[4],!0));if(o===null&&(o=["*"]),A(o)===!1)throw new m(n,c.InvalidParameter,i);let w;return w=n.services?.portal?n.services.portal:fe.getDefault(),w=Se(e[0],w),le(f,a,n.spatialReference??null,o,d,w,n.lrucache,n.interceptor)}if(v(e[0])===!1)throw new m(n,c.PortalRequired,i);let t=b(e[0]),s=b(e[1]),l=L(e[2],null),p=z(L(e[3],!0));if(l===null&&(l=["*"]),A(l)===!1)throw new m(n,c.InvalidParameter,i);return le(t,s,n.spatialReference??null,l,p,n.services?.portal??fe.getDefault(),n.lrucache,n.interceptor)})},r.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),r.functions.featuresetbyname=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>{if(E(e,2,4,n,i),ae(e[0])){let t=b(e[1]),s=L(e[2],null),l=z(L(e[3],!0));if(s===null&&(s=["*"]),A(s)===!1)throw new m(n,c.InvalidParameter,i);return e[0].featureSetByName(t,l,s)}throw new m(n,c.InvalidParameter,i)})},r.signatures.push({name:"featuresetbyname",min:2,max:4}),r.functions.featureset=function(n,i){return r.standardFunction(n,i,(y,g,e)=>{E(e,1,1,n,i);let t={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",hasM:!1,hasZ:!1,fields:[]},featureSet:{geometryType:"",features:[]}};if(v(e[0])){let s=JSON.parse(e[0]);s.layerDefinition!==void 0?(t.layerDefinition=s.layerDefinition,t.featureSet=s.featureSet,s.layerDefinition.spatialReference&&(t.layerDefinition.spatialReference=s.layerDefinition.spatialReference)):(t.featureSet.features=s.features,t.featureSet.geometryType=s.geometryType,t.layerDefinition.geometryType=t.featureSet.geometryType,t.layerDefinition.objectIdField=s.objectIdFieldName??"",t.layerDefinition.typeIdField=s.typeIdFieldName,t.layerDefinition.globalIdField=s.globalIdFieldName,t.layerDefinition.fields=s.fields,s.spatialReference&&(t.layerDefinition.spatialReference=s.spatialReference))}else{if(!(e[0]instanceof $))throw new m(n,c.InvalidParameter,i);{let s=JSON.parse(e[0].castToText(!0)),l=u(s,"layerdefinition");if(l!==null){t.layerDefinition.geometryType=u(l,"geometrytype",""),t.featureSet.geometryType=t.layerDefinition.geometryType,t.layerDefinition.globalIdField=u(l,"globalidfield",""),t.layerDefinition.objectIdField=u(l,"objectidfield",""),t.layerDefinition.typeIdField=u(l,"typeidfield",""),t.layerDefinition.hasZ=u(l,"hasz",!1)===!0,t.layerDefinition.hasM=u(l,"hasm",!1)===!0;let p=u(l,"spatialreference");p&&(t.layerDefinition.spatialReference=ue(p));let f=[];for(let o of u(l,"fields",[])){let d={name:u(o,"name",""),alias:u(o,"alias",""),type:u(o,"type",""),nullable:u(o,"nullable",!0),editable:u(o,"editable",!0),length:u(o,"length",null),domain:ke(u(o,"domain"))};f.push(d)}t.layerDefinition.fields=f;let a=u(s,"featureset");if(a){let o={};for(let d of f)o[d.name.toLowerCase()]=d.name;for(let d of u(a,"features",[])){let w={},T=u(d,"attributes",{});for(let F in T)w[o[F.toLowerCase()]]=T[F];t.featureSet.features.push({attributes:w,geometry:Oe(u(d,"geometry"))})}}}else{t.layerDefinition.hasZ=u(s,"hasz",!1)===!0,t.layerDefinition.hasM=u(s,"hasm",!1)===!0,t.layerDefinition.geometryType=u(s,"geometrytype",""),t.featureSet.geometryType=t.layerDefinition.geometryType,t.layerDefinition.objectIdField=u(s,"objectidfieldname",""),t.layerDefinition.typeIdField=u(s,"typeidfieldname","");let p=u(s,"spatialreference");p&&(t.layerDefinition.spatialReference=ue(p));let f=[],a=u(s,"fields",null);if(!A(a))throw new m(n,c.InvalidParameter,i);for(let w of a){let T={name:u(w,"name",""),alias:u(w,"alias",""),type:u(w,"type",""),nullable:u(w,"nullable",!0),editable:u(w,"editable",!0),length:u(w,"length",null),domain:ke(u(w,"domain"))};f.push(T)}t.layerDefinition.fields=f;let o={};for(let w of f)o[w.name.toLowerCase()]=w.name;let d=u(s,"features",null);if(A(d))for(let w of d){let T={},F=u(w,"attributes",{});for(let x in F)T[o[x.toLowerCase()]]=F[x];t.featureSet.features.push({attributes:T,geometry:Oe(u(w,"geometry",null))})}else d=null,t.featureSet.features=d}}}if(Ge(t)===!1)throw new m(n,c.InvalidParameter,i);return t.layerDefinition.geometryType||(t.layerDefinition.geometryType="esriGeometryNull"),$e.create(t,n.spatialReference)})},r.signatures.push({name:"featureset",min:1,max:1}),r.functions.filter=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){if(E(e,2,2,n,i),A(e[0])||R(e[0])){let t=[],s,l=e[0];if(l instanceof Ie&&(l=l.toArray()),!ge(e[1]))throw new m(n,c.InvalidParameter,i);s=e[1].createFunction(n);for(let p of l){let f=s(p);he(f)?(yield f)===!0&&t.push(p):f===!0&&t.push(p)}return t}if(N(e[0])){let t=yield e[0].load(),s=D.create(e[1],{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC}),l=s.getVariables();if(l.length>0){let p=[];for(let a=0;a<l.length;a++){let o={name:l[a]};p.push(yield r.evaluateIdentifier(n,o))}let f={};for(let a=0;a<l.length;a++)f[l[a]]=p[a];return s.parameters=f,new B({parentfeatureset:e[0],whereclause:s})}return new B({parentfeatureset:e[0],whereclause:s})}throw new m(n,c.InvalidParameter,i)}))},r.signatures.push({name:"filter",min:2,max:2}),r.functions.orderby=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){if(E(e,2,2,n,i),N(e[0])){let t=new Le(e[1]);return new Ce({parentfeatureset:e[0],orderbyclause:t})}throw new m(n,c.InvalidParameter,i)}))},r.signatures.push({name:"orderby",min:2,max:2}),r.functions.top=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){if(E(e,2,2,n,i),N(e[0]))return new ve({parentfeatureset:e[0],topnum:e[1]});if(A(e[0]))return O(e[1])>=e[0].length?e[0].slice():e[0].slice(0,O(e[1]));if(R(e[0]))return O(e[1])>=e[0].length()?e[0].slice():e[0].slice(0,O(e[1]));throw new m(n,c.InvalidParameter,i)}))},r.signatures.push({name:"top",min:2,max:2}),r.functions.first=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){if(E(e,1,1,n,i),N(e[0])){let t=yield e[0].first(y.abortSignal);if(t!==null){let s=be.createFromGraphicLikeObject(t.geometry,t.attributes,e[0],n.timeZone);return s._underlyingGraphic=t,s}return t}return A(e[0])?e[0].length===0?null:e[0][0]:R(e[0])?e[0].length()===0?null:e[0].get(0):null}))},r.signatures.push({name:"first",min:1,max:1}),r.functions.attachments=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){E(e,1,2,n,i);let t={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1){if(e[1]instanceof $){if(e[1].hasField("minsize")&&(t.minsize=O(e[1].field("minsize"))),e[1].hasField("metadata")&&(t.returnMetadata=z(e[1].field("metadata"))),e[1].hasField("maxsize")&&(t.maxsize=O(e[1].field("maxsize"))),e[1].hasField("types")){let s=Ee(e[1].field("types"),!1);s.length>0&&(t.types=s)}}else if(e[1]!==null)throw new m(n,c.InvalidParameter,i)}if(_(e[0])){let s=e[0]._layer;return s instanceof X&&(s=ee(s,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),s===null?[]:N(s)===!1?[]:(yield s.load(),s.queryAttachments(e[0].field(s.objectIdField),t.minsize,t.maxsize,t.types,t.returnMetadata))}if(e[0]===null)return[];throw new m(n,c.InvalidParameter,i)}))},r.signatures.push({name:"attachments",min:1,max:2}),r.functions.featuresetbyrelationshipname=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){E(e,2,4,n,i);let t=e[0],s=b(e[1]),l=L(e[2],null),p=z(L(e[3],!0));if(l===null&&(l=["*"]),A(l)===!1)throw new m(n,c.InvalidParameter,i);if(e[0]===null)return null;if(!_(e[0]))throw new m(n,c.InvalidParameter,i);let f=t._layer;if(f instanceof X&&(f=ee(f,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),f===null||N(f)===!1)return null;f=yield f.load();let a=f.relationshipMetaData().filter(F=>F.name===s);if(a.length===0)return null;if(a[0].relationshipTableId!==void 0&&a[0].relationshipTableId!==null&&a[0].relationshipTableId>-1)return Re(f,a[0],t.field(f.objectIdField),f.spatialReference,l,p,n.lrucache,n.interceptor);let o=f.serviceUrl();if(!o)return null;o=o.charAt(o.length-1)==="/"?o+a[0].relatedTableId.toString():o+"/"+a[0].relatedTableId.toString();let d=yield Pe(o,f.spatialReference,l,p,n.lrucache,n.interceptor);yield d.load();let w=d.relationshipMetaData();if(w=w.filter(F=>F.id===a[0].id),t.hasField(a[0].keyField)===!1||t.field(a[0].keyField)===null){let F=yield f.getFeatureByObjectId(t.field(f.objectIdField),[a[0].keyField]);if(F){let x=D.create(w[0].keyField+"= @id",{fieldsIndex:d.getFieldsIndex(),timeZone:d.dateFieldsTimeZoneDefaultUTC});return x.parameters={id:F.attributes[a[0].keyField]},d.filter(x)}return new Ze({parentfeatureset:d})}let T=D.create(w[0].keyField+"= @id",{fieldsIndex:d.getFieldsIndex(),timeZone:d.dateFieldsTimeZoneDefaultUTC});return T.parameters={id:t.field(a[0].keyField)},d.filter(T)}))},r.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),r.functions.featuresetbyassociation=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){E(e,2,3,n,i);let t=e[0],s=b(L(e[1],"")).toLowerCase(),l=v(e[2])?b(e[2]):null;if(e[0]===null)return null;if(!_(e[0]))throw new m(n,c.InvalidParameter,i);let p=t._layer;if(p instanceof X&&(p=ee(p,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),p===null||N(p)===!1)return null;yield p.load();let f=p.serviceUrl(),a=yield Ue(f,n.spatialReference),o=null,d=null,w=!1;if(l!==null&&l!==""&&l!==void 0){for(let I of a.terminals)I.terminalName===l&&(d=I.terminalId);d===null&&(w=!0)}let T=a.associations.getFieldsIndex(),F=T.get("TOGLOBALID").name,x=T.get("FROMGLOBALID").name,ne=T.get("TOTERMINALID").name,te=T.get("FROMTERMINALID").name,H=T.get("FROMNETWORKSOURCEID").name,G=T.get("TONETWORKSOURCEID").name,k=T.get("ASSOCIATIONTYPE").name,ze=T.get("ISCONTENTVISIBLE").name,We=T.get("OBJECTID").name;for(let I of p.fields)if(I.type==="global-id"){o=t.field(I.name);break}let P=null,ce=new M(new W({name:"percentalong",alias:"percentalong",type:"double"}),D.create("0",{fieldsIndex:a.associations.getFieldsIndex(),timeZone:a.associations.dateFieldsTimeZoneDefaultUTC})),me=new M(new W({name:"side",alias:"side",type:"string"}),D.create("''",{fieldsIndex:a.associations.getFieldsIndex(),timeZone:a.associations.dateFieldsTimeZoneDefaultUTC})),C="globalid",pe="globalId",ye={};for(let I in a.lkp)ye[I]=a.lkp[I].sourceId;let U=new Ne(new W({name:"classname",alias:"classname",type:"string"}),null,ye),h="";switch(s){case"midspan":{h=`((${F}='${o}') OR ( ${x}='${o}')) AND (${k} IN (5))`,U.codefield=D.create(`CASE WHEN (${F}='${o}') THEN ${H} ELSE ${G} END`,{fieldsIndex:a.associations.getFieldsIndex(),timeZone:a.associations.dateFieldsTimeZoneDefaultUTC});let I=Q(Z.findField(a.associations.fields,x));I.name=C,I.alias=C,P=new M(I,D.create(`CASE WHEN (${x}='${o}') THEN ${F} ELSE ${x} END`,{fieldsIndex:a.associations.getFieldsIndex(),timeZone:a.associations.dateFieldsTimeZoneDefaultUTC})),ce=a.unVersion>=4?new q(Z.findField(a.associations.fields,T.get("PERCENTALONG").name)):new M(new W({name:"percentalong",alias:"percentalong",type:"double"}),D.create("0",{fieldsIndex:a.associations.getFieldsIndex(),timeZone:a.associations.dateFieldsTimeZoneDefaultUTC}));break}case"junctionedge":{h=`((${F}='${o}') OR ( ${x}='${o}')) AND (${k} IN (4,6))`,U.codefield=D.create(`CASE WHEN (${F}='${o}') THEN ${H} ELSE ${G} END`,{fieldsIndex:a.associations.getFieldsIndex(),timeZone:a.associations.dateFieldsTimeZoneDefaultUTC});let I=Q(Z.findField(a.associations.fields,x));I.name=C,I.alias=C,P=new M(I,D.create(`CASE WHEN (${x}='${o}') THEN ${F} ELSE ${x} END`,{fieldsIndex:a.associations.getFieldsIndex(),timeZone:a.associations.dateFieldsTimeZoneDefaultUTC})),me=new M(new W({name:"side",alias:"side",type:"string"}),D.create(`CASE WHEN (${k}=4) THEN 'from' ELSE 'to' END`,{fieldsIndex:a.associations.getFieldsIndex(),timeZone:a.associations.dateFieldsTimeZoneDefaultUTC}));break}case"connected":{let I=`${F}='@T'`,we=`${x}='@T'`;d!==null&&(I+=` AND ${ne}=@A`,we+=` AND ${te}=@A`),h="(("+I+") OR ("+we+"))",h=K(h,"@T",o??""),I=K(I,"@T",o??""),d!==null&&(I=K(I,"@A",d.toString()),h=K(h,"@A",d.toString())),U.codefield=D.create("CASE WHEN "+I+` THEN ${H} ELSE ${G} END`,{fieldsIndex:a.associations.getFieldsIndex(),timeZone:a.associations.dateFieldsTimeZoneDefaultUTC});let ie=Q(Z.findField(a.associations.fields,x));ie.name=C,ie.alias=C,P=new M(ie,D.create("CASE WHEN "+I+` THEN ${x} ELSE ${F} END`,{fieldsIndex:a.associations.getFieldsIndex(),timeZone:a.associations.dateFieldsTimeZoneDefaultUTC}));break}case"container":h=`${F}='${o}' AND ${k} = 2`,d!==null&&(h+=` AND ${ne} = `+d.toString()),U.codefield=H,h="( "+h+" )",P=new V(Z.findField(a.associations.fields,x),C,C);break;case"content":h=`(${x}='${o}' AND ${k} = 2)`,d!==null&&(h+=` AND ${te} = `+d.toString()),U.codefield=G,h="( "+h+" )",P=new V(Z.findField(a.associations.fields,F),C,C);break;case"structure":h=`(${F}='${o}' AND ${k} = 3)`,d!==null&&(h+=` AND ${ne} = `+d.toString()),U.codefield=H,h="( "+h+" )",P=new V(Z.findField(a.associations.fields,x),C,pe);break;case"attached":h=`(${x}='${o}' AND ${k} = 3)`,d!==null&&(h+=` AND ${te} = `+d.toString()),U.codefield=G,h="( "+h+" )",P=new V(Z.findField(a.associations.fields,F),C,pe);break;default:throw new m(n,c.InvalidParameter,i)}return w&&(h="1 <> 1"),new Z({parentfeatureset:a.associations,adaptedFields:[new q(Z.findField(a.associations.fields,We)),new q(Z.findField(a.associations.fields,ze)),P,me,U,ce],extraFilter:h?D.create(h,{fieldsIndex:a.associations.getFieldsIndex(),timeZone:a.associations.dateFieldsTimeZoneDefaultUTC}):null})}))},r.signatures.push({name:"featuresetbyassociation",min:2,max:6}),r.functions.groupby=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){if(E(e,3,3,n,i),!N(e[0]))throw new m(n,c.InvalidParameter,i);let t=yield e[0].load(),s=[],l=[],p=!1,f=[];if(v(e[1]))f.push(e[1]);else if(e[1]instanceof $)f.push(e[1]);else if(A(e[1]))f=e[1];else{if(!R(e[1]))throw new m(n,c.InvalidParameter,i);f=e[1].toArray()}for(let a of f)if(v(a)){let o=D.create(b(a),{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC}),d=oe(o)===!0?b(a):"%%%%FIELDNAME";s.push({name:d,expression:o}),d==="%%%%FIELDNAME"&&(p=!0)}else{if(!(a instanceof $))throw new m(n,c.InvalidParameter,i);{let o=a.hasField("name")?a.field("name"):"%%%%FIELDNAME",d=a.hasField("expression")?a.field("expression"):"";if(o==="%%%%FIELDNAME"&&(p=!0),!o)throw new m(n,c.InvalidParameter,i);s.push({name:o,expression:D.create(d||o,{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC})})}}if(f=[],v(e[2]))f.push(e[2]);else if(A(e[2]))f=e[2];else if(R(e[2]))f=e[2].toArray();else{if(!(e[2]instanceof $))throw new m(n,c.InvalidParameter,i);f.push(e[2])}for(let a of f){if(!(a instanceof $))throw new m(n,c.InvalidParameter,i);{let o=a.hasField("name")?a.field("name"):"",d=a.hasField("statistic")?a.field("statistic"):"",w=a.hasField("expression")?a.field("expression"):"";if(!o||!d||!w)throw new m(n,c.InvalidParameter,i);l.push({name:o,statistic:d.toLowerCase(),expression:D.create(w,{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC})})}}if(p){let a={};for(let d of t.fields)a[d.name.toLowerCase()]=1;for(let d of s)d.name!=="%%%%FIELDNAME"&&(a[d.name.toLowerCase()]=1);for(let d of l)d.name!=="%%%%FIELDNAME"&&(a[d.name.toLowerCase()]=1);let o=0;for(let d of s)if(d.name==="%%%%FIELDNAME"){for(;a["field_"+o.toString()]===1;)o++;a["field_"+o.toString()]=1,d.name="FIELD_"+o.toString()}}for(let a of s)yield de(a.expression,r,n);for(let a of l)yield de(a.expression,r,n);return e[0].groupby(s,l)}))},r.signatures.push({name:"groupby",min:3,max:3}),r.functions.distinct=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){if(N(e[0])){E(e,2,2,n,i);let t=yield e[0].load(),s=[],l=[];if(v(e[1]))l.push(e[1]);else if(e[1]instanceof $)l.push(e[1]);else if(A(e[1]))l=e[1];else{if(!R(e[1]))throw new m(n,c.InvalidParameter,i);l=e[1].toArray()}let p=!1;for(let f of l)if(v(f)){let a=D.create(b(f),{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC}),o=oe(a)===!0?b(f):"%%%%FIELDNAME";s.push({name:o,expression:a}),o==="%%%%FIELDNAME"&&(p=!0)}else{if(!(f instanceof $))throw new m(n,c.InvalidParameter,i);{let a=f.hasField("name")?f.field("name"):"%%%%FIELDNAME",o=f.hasField("expression")?f.field("expression"):"";if(a==="%%%%FIELDNAME"&&(p=!0),!a)throw new m(n,c.InvalidParameter,i);s.push({name:a,expression:D.create(o||a,{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC})})}}if(p){let f={};for(let o of t.fields)f[o.name.toLowerCase()]=1;for(let o of s)o.name!=="%%%%FIELDNAME"&&(f[o.name.toLowerCase()]=1);let a=0;for(let o of s)if(o.name==="%%%%FIELDNAME"){for(;f["field_"+a.toString()]===1;)a++;f["field_"+a.toString()]=1,o.name="FIELD_"+a.toString()}}for(let f of s)yield de(f.expression,r,n);return e[0].groupby(s,[])}return je(e)}))},r.functions.getfeaturesetinfo=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){if(E(e,1,1,n,i),!N(e[0]))return null;let t=yield e[0].getFeatureSetInfo();return t?$.convertObjectToArcadeDictionary({layerId:t.layerId,layerName:t.layerName,itemId:t.itemId,serviceLayerUrl:t.serviceLayerUrl,webMapLayerId:t.webMapLayerId??null,webMapLayerTitle:t.webMapLayerTitle??null,className:null,objectClassId:null},se(n),!1,!1):null}))},r.signatures.push({name:"getfeaturesetinfo",min:1,max:1}),r.functions.filterbysubtypecode=function(n,i){return r.standardFunctionAsync(n,i,(y,g,e)=>S(this,null,function*(){if(E(e,2,2,n,i),N(e[0])){let t=yield e[0].load(),s=e[1];if(!De(s))throw new m(n,c.InvalidParameter,i);if(t.subtypeField){let p=D.create(`${t.subtypeField}= ${e[1]}`,{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC});return new B({parentfeatureset:e[0],whereclause:p})}if(t.typeIdField===null||t.typeIdField==="")throw new m(n,c.FeatureSetDoesNotHaveSubtypes,i);let l=D.create(`${t.typeIdField}= ${e[1]}`,{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC});return new B({parentfeatureset:e[0],whereclause:l})}throw new m(n,c.InvalidParameter,i)}))},r.signatures.push({name:"filterbysubtypecode",min:2,max:2}))}export{wn as registerFunctions};
