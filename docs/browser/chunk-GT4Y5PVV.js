import{c as B,g as yt,h as W,l as ot,r as dt}from"./chunk-FW33MEBA.js";import{o as q}from"./chunk-T7BKG6V3.js";import{l as v,y as A}from"./chunk-N27U3N2T.js";import{a as et}from"./chunk-NDYVXEZ5.js";import{c as nt,d as C,da as I,e as j,f as ht,h as pt,n as gt}from"./chunk-4DLSYLKE.js";import{t as tt}from"./chunk-3IBUFXWY.js";import{u as xt}from"./chunk-BP73DJTS.js";import{a as Z,b as $,g as mt}from"./chunk-JEGVIFEP.js";var lt;function Nt(t,n,o){return!dt(t,n,o)}function L(t,n,o){let i=Nt(t,n,o);if(i&&!B())throw new tt("rasterprojectionhelper-project","projection engine is not loaded");return i}(function(t){t[t.None=0]="None",t[t.North=1]="North",t[t.South=2]="South",t[t.Both=3]="Both"})(lt||(lt={}));var wt=(t,n,o,i=0)=>{if(o[0]===1)return[0,0];let s=1,e=-1,r=1,f=-1;for(let m=0;m<t.length;m+=2)isNaN(t[m])||(s=s>t[m]?t[m]:s,e=e>t[m]?e:t[m],r=r>t[m+1]?t[m+1]:r,f=f>t[m+1]?f:t[m+1]);let{cols:a,rows:l}=n,c=(e-s)/a/o[0],w=(f-r)/l/o[1],g=2*i,u=0,x=!1,p=[0,0];for(let m=0;m<a-3;m++){for(let M=0;M<l-3;M++){let h=m*l*2+2*M,y=(t[h]+t[h+4]+t[h+4*l]+t[h+4*l+4])/4,d=(t[h+1]+t[h+5]+t[h+4*l+1]+t[h+4*l+5])/4,R=Math.abs((y-t[h+2*l+2])/c),P=Math.abs((d-t[h+2*l+3])/w);if(R+P>u&&(u=R+P,p=[R,P]),g&&u>g){x=!0;break}}if(x)break}return p},It={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},D=32,J=4,it=J,rt=new Map,st=new Map,X=500,K=null;function en(){return mt(this,null,function*(){K&&B()||(B()||(yield yt()),K=yield import("./chunk-RCUZLKRT.js"))})}function Lt(t,n,o){return L(t.spatialReference,n),o?ot(n,t.spatialReference,t):ot(t.spatialReference,n,t)}function on(t,n,o,i=null){let s=t.spatialReference;if(!s||!n||s.equals(n))return t;L(s,n,i);let e=o.center,r=new A({xmin:e.x-t.x/2,xmax:e.x+t.x/2,ymin:e.y-t.y/2,ymax:e.y+t.y/2,spatialReference:s}),f=W(r,n,i),a=_(n);return f==null||a!=null&&f.width>=a?Y(t,s,n):{x:f.width,y:f.height}}function Y(t,n,o){let i=I(n)/I(o);return{x:t.x*i,y:t.y*i}}function Mt(t,n,o){let{spatialReference:i}=o;if(!i||!n||i.equals(n))return t;if(i.isGeographic&&n.isGeographic)return Y(t,i,n);if(L(i,n),!K)throw new tt("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:s,y:e}=t,r=(s+e)/2*I(i),f=1;r>30&&(f=30/r,s*=f,e*=f);let a=256,l=s*a/2,c=e*a/2,{x:w,y:g}=o.center,u=[];for(let S=0;S<=a;S++)u.push([w-l,g-c+S*e]);for(let S=1;S<=a;S++)u.push([w-l+S*s,g+c]);for(let S=1;S<=a;S++)u.push([w+l,g+c-S*e]);for(let S=1;S<a;S++)u.push([w+l-S*s,g-c]);u.push(u[0]);let x=new q({rings:[u],spatialReference:i}),p=W(x,n);if(!p)return Y(t,i,n);let m=p.extent,M=_(n);if(m==null||M!=null&&m.width>=M)return Y(t,i,n);let h=K.planarArea(p),y=s*e*a*a,d=Math.sqrt(h/y)/f,R={x:m.width/f/a,y:m.height/f/a},P={x:s*d,y:e*d},k=R.x*R.y;return Math.abs(k-P.x*P.y)/k<.1?R:P}function T(t,n=.01){return I(t)?n/I(t):0}function Rt(t,n,o=null,i=!0){let s=t.spatialReference;if(s.equals(n))return t;L(s,n,o);let e=W(t,n,o);return i&&e&&Tt([t],[e],s,n),e}function Tt(t,n,o,i){let s=U(o,!0),e=U(i,!0),r=T(o,X),f=T(i,X);if(r&&s!=null&&e!=null)for(let a=0;a<t.length;a++){let l=n[a];if(!l)continue;let{x:c}=t[a],{x:w}=l;w>=e[1]-f&&Math.abs(c-s[0])<r?l.x-=e[1]-e[0]:w<=e[0]+f&&Math.abs(c-s[1])<r&&(l.x+=e[1]-e[0])}}function Ot(t){let{inSR:n,outSR:o,datumTransformation:i,preferPE:s}=t;if(n.equals(o)){let{points:e}=ct(t,null);return e}return n.isWebMercator&&o.isWGS84||n.isWGS84&&o.isWebMercator?Ft(t):L(n,o,i)&&s&&(n.isGeographic||O(n)!=null)?Pt(t):At(t)}function At(t){let{points:n}=ct(t,null),{inSR:o,outSR:i,datumTransformation:s}=t,e=n.map(f=>new v(f[0],f[1],o)),r=W(e,i,s);return s&&Tt(e,r,o,i),r.map(f=>f?[f.x,f.y]:[NaN,NaN])}function Pt(t){let{inSR:n,outSR:o,datumTransformation:i}=t,s=O(n),{points:e,mask:r}=ct(t,s);if(!n.isGeographic){let a=n.wkid?j.coordsys(n.wkid):j.fromString(n.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,n.wkt2||n.wkt);nt.projToGeog(a,e.length,e)}if(i!=null&&i.steps.length){let a;if(o.isGeographic&&(a=e.map(([c])=>c>179.9955?1:c<-179.9955?-1:0)),i.steps.forEach(c=>{let w=c.wkid?j.geogtran(c.wkid):j.fromString(C.PE_TYPE_GEOGTRAN,c.wkt);ht.geogToGeog(w,e.length,e,null,c.isInverse?C.PE_TRANSFORM_2_TO_1:C.PE_TRANSFORM_1_TO_2)}),a)for(let c=0;c<e.length;c++){let w=a[c],g=e[c][0],u=g>179.9955?1:g<-179.9955?-1:0;w&&u&&w!==u&&(e[c][0]=w>0?g+360:g-360)}}if(!o.isGeographic){let a=O(o,!0),l=a!=null&&a.isEnvelope?[a.bbox[1],a.bbox[3]]:[-90,90];Bt(e,l);let c=o.wkid?j.coordsys(o.wkid):j.fromString(o.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,o.wkt2||o.wkt);nt.geogToProj(c,e.length,e)}let f=e;if(r&&e.length!==r.length){f=[];for(let a=0,l=0;a<r.length;a++)r[a]?f.push(e[l++]):f.push([NaN,NaN])}return f}function Ft(t){let{cols:n,rows:o,xres:i,yres:s,usePixelCenter:e,inSR:r,outSR:f}=t,{xmin:a,ymax:l}=t;e&&(a+=i/2,l-=s/2);let c=[],w=[],g=Math.max(n,o);for(let x=0;x<g;x++){let p=a+i*Math.min(n,x),m=l-s*Math.min(o,x),M=W(new v({x:p,y:m,spatialReference:r}),f);x<=n&&c.push(M.x),x<=o&&w.push(M.y)}let u=[];for(let x=0;x<n;x++)for(let p=0;p<o;p++)u.push([c[x],w[p]]);return u}function O(t,n=!1){let o=t.wkid||t.wkt2||t.wkt;if(!o||t.isGeographic)return null;if(o=String(o),rt.has(o)){let r=rt.get(o);return n?r?.gcs:r?.pcs}let i=t.wkid?j.coordsys(t.wkid):j.fromString(t.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,t.wkt2||t.wkt),s=St(i,T(t,1e-4)),e=St(i,0,!0);return rt.set(o,{pcs:s,gcs:e}),n?e:s}function St(t,n=0,o=!1){let i=pt.generate(t),s=o?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!i||!s?.length)return null;let e=!1,r=s.find(m=>m.getInclusive()===1&&m.getKind()===1);if(!r){if(r=s.find(m=>m.getInclusive()===1&&m.getKind()===0),!r)return null;e=!0}let f=o?0:(i.getNorthPoleLocation()===2?1:0)|(i.getSouthPoleLocation()===2?2:0),a=i.isPannableRectangle(),l=r.getCoord();if(e)return{isEnvelope:e,isPannable:a,vertices:l,coef:null,bbox:[l[0][0]-n,l[0][1]-n,l[1][0]+n,l[1][1]+n],poleLocation:f};let c=0,w=[],[g,u]=l[0],[x,p]=l[0];for(let m=0,M=l.length;m<M;m++){c++,c===M&&(c=0);let[h,y]=l[m],[d,R]=l[c];if(R===y)w.push([h,d,y,R,2]);else{let P=(d-h)/(R-y||1e-4),k=h-P*y;y<R?w.push([P,k,y,R,0]):w.push([P,k,R,y,1])}g=g<h?g:h,u=u<y?u:y,x=x>h?x:h,p=p>y?p:y}return{isEnvelope:!1,isPannable:a,vertices:l,coef:w,bbox:[g,u,x,p],poleLocation:f}}function ct(t,n){let o=[],{cols:i,rows:s,xres:e,yres:r,usePixelCenter:f}=t,{xmin:a,ymax:l}=t;if(f&&(a+=e/2,l-=r/2),n==null){for(let u=0;u<i;u++)for(let x=0;x<s;x++)o.push([a+e*u,l-r*x]);return{points:o}}let c=new Uint8Array(i*s);if(n.isEnvelope){let{bbox:[u,x,p,m]}=n;for(let M=0,h=0;M<i;M++){let y=a+e*M,d=n.isPannable||y>=u&&y<=p;for(let R=0;R<s;R++,h++){let P=l-r*R;d&&P>=x&&P<=m&&(o.push([y,P]),c[h]=1)}}return{points:o,mask:c}}let w=n.coef,g=[];for(let u=0;u<s;u++){let x=l-r*u,p=[],m=[];for(let h=0;h<w.length;h++){let[y,d,R,P,k]=w[h];if(x===R&&R===P)p.push(y),p.push(d),m.push(2),m.push(2);else if(x>=R&&x<=P){let S=y*x+d;p.push(S),m.push(k)}}let M=p;if(p.length>2){let h=m[0]===2?0:m[0],y=p[0];M=[];for(let d=1;d<m.length;d++)m[d]===2&&d!==m.length-1||(m[d]!==h&&(M.push(h===0?Math.min(y,p[d-1]):Math.max(y,p[d-1])),h=m[d],y=p[d]),d===m.length-1&&M.push(m[d]===0?Math.min(y,p[d]):Math.max(y,p[d])));M.sort((d,R)=>d-R)}else p[0]>p[1]&&(M=[p[1],p[0]]);g.push(M)}for(let u=0,x=0;u<i;u++){let p=a+e*u;for(let m=0;m<s;m++,x++){let M=l-r*m,h=g[m];if(h.length===2)p>=h[0]&&p<=h[1]&&(o.push([p,M]),c[x]=1);else if(h.length>2){let y=!1;for(let d=0;d<h.length;d+=2)if(p>=h[d]&&p<=h[d+1]){y=!0;break}y&&(o.push([p,M]),c[x]=1)}}}return{points:o,mask:c}}function Bt(t,n){let[o,i]=n;for(let s=0;s<t.length;s++){let e=t[s][1];(e<o||e>i)&&(t[s]=[NaN,NaN])}}function vt(t,n){let o=_(t[0].spatialReference);if(t.length<2||o==null||(n=n??T(t[0].spatialReference),(t=t.filter(f=>f.width>n)).length===1))return t[0];let{xmin:i,xmax:s,ymin:e,ymax:r}=t[0];for(let f=1;f<t.length;f++){let a=t[f];s=a.xmax+o*f,e=Math.min(e,a.ymin),r=Math.max(r,a.ymax)}return new A({xmin:i,xmax:s,ymin:e,ymax:r,spatialReference:t[0].spatialReference})}function Ct(t,n,o=null,i=!0){let s=t.spatialReference;if(s.equals(n))return t;let e=jt(t),r=_(s,!0),f=_(n);if(e===0||r==null||f==null){let l=Gt(t,n,o,i);if(r==null&&f!=null&&Math.abs(l.width-f)<T(n)&&B()){let c=O(s);if(c!=null&&c.poleLocation===lt.None&&t.width<(c.bbox[2]-c.bbox[0])/2)return qt(t,n)||l}return l}let a=t.clone().normalize();if(a.length===1&&t.xmax<r&&t.xmax-r/2>T(s)){let{xmin:l,xmax:c}=t;for(let w=0;w<=e;w++){let g=w===0?l:-r/2,u=w===e?c-r*w:r/2;a[w]=new A({xmin:g,xmax:u,ymin:t.ymin,ymax:t.ymax,spatialReference:s})}}return vt(a.map(l=>Gt(l,n,o,i)).filter(xt))}function rn(t,n,o){if(t.type==="extent"){let{xmin:i,ymin:s,xmax:e,ymax:r,spatialReference:f}=t;t=new q({rings:[[[i,r],[e,r],[e,s],[i,s],[i,r]]],spatialReference:f})}return t.spatialReference.equals(n)?t:(L(t.spatialReference,n,o),W(t,n,o))}function qt(t,n){let o=_(n);if(o==null)return null;let{xmin:i,ymin:s,xmax:e,ymax:r}=t,f=t.spatialReference,a=new q({spatialReference:f,rings:[[[i,s],[e,s],[e,r],[i,r],[i,s]]]}),l=W(a,n);if(l.rings.length!==2||!l.rings[0].length||!l.rings[1].length)return null;let{rings:c}=l,w=T(f),g=new A({spatialReference:n});for(let u=0;u<2;u++){i=e=c[u][0][0],s=r=c[u][0][1];for(let x=0;x<c[u].length;x++)i=i>c[u][x][0]?c[u][x][0]:i,e=e<c[u][x][0]?c[u][x][0]:e,s=s>c[u][x][1]?c[u][x][1]:s,r=r<c[u][x][1]?c[u][x][1]:r;if(u===0)g.ymin=s,g.ymax=r,g.xmin=i,g.xmax=e;else if(g.ymin=Math.min(g.ymin,s),g.ymax=Math.max(g.ymax,r),Math.abs(e-o/2)<w)g.xmin=i,g.xmax=g.xmax+o;else{if(!(Math.abs(i+o/2)<w))return null;g.xmax=e+o}}return g}function Gt(t,n,o=null,i=!0,s=!0){let e=t.spatialReference;if(e.equals(n)||!n)return t;L(e,n,o);let r=W(t,n,o);if(s&&n.isWebMercator&&r&&(r.ymax=Math.min(20037508342787e-6,r.ymax),r.ymin=Math.max(-20037508342787e-6,r.ymin),r.ymin>=r.ymax))return null;if(!i||!r)return r;let f=U(e,!0),a=U(n,!0);if(f==null||a==null)return r;let l=T(e,.001),c=T(e,X),w=T(n,.001);if(Math.abs(r.xmin-a[0])<w&&Math.abs(r.xmax-a[1])<w){let g=Math.abs(t.xmin-f[0]),u=Math.abs(f[1]-t.xmax);if(g<l&&u>c){r.xmin=a[0];let x=[];x.push(new v(t.xmax,t.ymin,e)),x.push(new v(t.xmax,(t.ymin+t.ymax)/2,e)),x.push(new v(t.xmax,t.ymax,e));let p=x.map(m=>Rt(m,n,o)).filter(m=>!isNaN(m?.x)).map(m=>m.x);r.xmax=Math.max.apply(null,p)}if(u<l&&g>c){r.xmax=a[1];let x=[];x.push(new v(t.xmin,t.ymin,e)),x.push(new v(t.xmin,(t.ymin+t.ymax)/2,e)),x.push(new v(t.xmin,t.ymax,e));let p=x.map(m=>Rt(m,n,o)).filter(m=>!isNaN(m?.x)).map(m=>m.x);r.xmin=Math.min.apply(null,p)}}else{let g=T(n,.001);Math.abs(r.xmin-a[0])<g&&(r.xmin=a[0]),Math.abs(r.xmax-a[1])<g&&(r.xmax=a[1])}return r}function _(t,n=!1){if(!t)return null;let o=n?20037508342787e-6:20037508342788905e-9;return t.isWebMercator?2*o:t.wkid&&t.isGeographic?360:2*It[t.wkid]||null}function U(t,n=!1){if(t.isGeographic)return[-180,180];let o=_(t,n);return o!=null?[-o/2,o/2]:null}function bt(t,n,o,i){let s=(t-n)/o;return s-Math.floor(s)!=0?s=Math.floor(s):i&&(s-=1),s}function jt(t,n=!1){let o=_(t.spatialReference);if(o==null)return 0;let i=n?0:-(o/2),s=T(t.spatialReference),e=!n&&Math.abs(t.xmax-o/2)<s?o/2:t.xmax,r=!n&&Math.abs(t.xmin+o/2)<s?-o/2:t.xmin;return bt(e,i,o,!0)-bt(r,i,o,!1)}function sn(t){let n=t.storageInfo.origin.x,o=_(t.spatialReference,!0);if(o==null)return{originX:n,halfWorldWidth:null,pyramidsInfo:null};let i=o/2,{nativePixelSize:s,storageInfo:e,extent:r}=t,{maximumPyramidLevel:f,blockWidth:a,pyramidScalingFactor:l}=e,c=s.x,w=[],g=t.transform!=null&&t.transform.type==="gcs-shift",u=n+(g?0:i),x=g?o-n:i-n;for(let p=0;p<=f;p++){let m=(r.xmax-n)/c/a,M=m-Math.floor(m)==0?m:Math.ceil(m),h=x/c/a,y=h-Math.floor(h)==0?h:Math.ceil(h),d=Math.floor(u/c/a),R=Math.round(u/c)%a,P=(a-Math.round(x/c)%a)%a;w.push({resolutionX:c,blockWidth:a,datasetColumnCount:M,worldColumnCountFromOrigin:y,leftMargin:R,rightPadding:P,originColumnOffset:d}),c*=l}return{originX:n,halfWorldWidth:i,pyramidsInfo:w,hasGCSSShiftTransform:g}}function Yt(t){if(!t||t.isGeographic)return t;let n=String(t.wkid||t.wkt2||t.wkt),o;return st.has(n)?o=st.get(n):(o=(t.wkid?j.coordsys(t.wkid):j.fromString(C.PE_TYPE_PROJCS,t.wkt2||t.wkt)).getGeogcs().getCode(),st.set(n,o)),new et({wkid:o})}function an(t){let n=t.isAdaptive&&t.spacing==null,o=t.spacing||[D,D],i=at(t),s={cols:i.size[0]+1,rows:i.size[1]+1},e=i.outofBoundPointCount>0&&i.outofBoundPointCount<i.offsets.length/2,r=i.outofBoundPointCount===i.offsets.length/2||n&&e?[0,0]:wt(i.offsets,s,o,it),f=(r[0]+r[1])/2,a=t.projectedExtent.spatialReference,l=t.srcBufferExtent.spatialReference;if(n&&(e||f>it)&&(Nt(a,l,t.datumTransformation)&&(a.isGeographic||O(a)),o=[J,J],i=at($(Z({},t),{spacing:o})),s={cols:i.size[0]+1,rows:i.size[1]+1},r=wt(i.offsets,s,o,it)),i.error=r,o[0]>1&&(i.coefficients=Et(i.offsets,s,e)),t.includeGCSGrid&&!a.isGeographic&&!a.isWebMercator)if(l.isGeographic)i.gcsGrid={offsets:i.offsets,coefficients:i.coefficients,spacing:o};else{let c=O(a);if(c!=null&&!c.isEnvelope){let w=Yt(a),g=Ct(t.projectedExtent,w),{offsets:u}=at($(Z({},t),{srcBufferExtent:g,spacing:o})),x=Et(u,s,e);i.gcsGrid={offsets:u,coefficients:x,spacing:o}}}return i}function at(t){let{projectedExtent:n,srcBufferExtent:o,pixelSize:i,datumTransformation:s,rasterTransform:e}=t,r=n.spatialReference,f=o.spatialReference,a=L(r,f),{xmin:l,ymin:c,xmax:w,ymax:g}=n,u=_(f),x=u!=null&&(t.hasWrapAround||e?.type==="gcs-shift"),p=t.spacing||[D,D],m=p[0]*i.x,M=p[1]*i.y,h=p[0]===1,y=Math.ceil((w-l)/m-.1/p[0])+(h?0:1),d=Math.ceil((g-c)/M-.1/p[1])+(h?0:1),R=Ot({cols:y,rows:d,xmin:l,ymax:g,xres:m,yres:M,inSR:r,outSR:f,datumTransformation:s,preferPE:p[0]<=J,usePixelCenter:h}),P=[],k,S=0,G=h?-1:NaN,{xmin:E,xmax:N,ymax:H,width:Q,height:_t}=o,Wt=T(f,X),zt=u!=null&&E>0&&N>u/2,ft=!1;if(a){let z=O(r);ft=z!=null&&z.poleLocation>0}for(let z=0;z<y;z++){let V=[];for(let F=0;F<d;F++){let b=R[z*d+F];if(x&&b[0]>N&&b[0]>u/2-Wt?b[0]-=u:x&&z===0&&b[0]<0&&zt&&!e&&(b[0]+=u),!b||isNaN(b[0])||isNaN(b[1]))P.push(G),P.push(G),V.push(null),S++;else{if(e){let ut=e.inverseTransform(new v({x:b[0],y:b[1],spatialReference:f}));b=[ut.x,ut.y]}V.push(b),z>0&&x&&k[F]&&b[0]<k[F][0]&&(b[0]+=u,ft&&b[0]>N&&b[0]>u&&(b[0]-=u)),P.push((b[0]-E)/Q),P.push((H-b[1])/_t)}}k=V}return{offsets:P,error:null,coefficients:null,outofBoundPointCount:S,spacing:p,size:h?[y,d]:[y-1,d-1]}}function Et(t,n,o){let{cols:i,rows:s}=n,e=new Float32Array((i-1)*(s-1)*2*6),r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),f=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let a=0;a<i-1;a++){for(let l=0;l<s-1;l++){let c=a*s*2+2*l,w=t[c],g=t[c+1],u=t[c+2],x=t[c+3];c+=2*s;let p=t[c],m=t[c+1],M=t[c+2],h=t[c+3],y=0,d=12*(l*(i-1)+a);for(let R=0;R<3;R++)e[d++]=r[y++]*w+r[y++]*u+r[y++]*M;y=0;for(let R=0;R<3;R++)e[d++]=r[y++]*g+r[y++]*x+r[y++]*h;y=0;for(let R=0;R<3;R++)e[d++]=f[y++]*w+f[y++]*p+f[y++]*M;y=0;for(let R=0;R<3;R++)e[d++]=f[y++]*g+f[y++]*m+f[y++]*h}if(o)for(let l=0;l<e.length;l++)isNaN(e[l])&&(e[l]=-1)}return e}function Dt(t,n){let o=t.clone().normalize();return o.length===1?o[0]:vt(o,n)}function ln(t){let{spatialReference:n}=t,o=gt(n);if(!o)return t;let[i,s]=o.valid,e=s-i,r=0;if(t.xmin<i){let f=i-t.xmin;r=Math.ceil(f/e)}else if(t.xmin>s){let f=t.xmin-s;r=-Math.ceil(f/e)}return new A({spatialReference:t.spatialReference,xmin:t.xmin+r*e,ymin:t.ymin,xmax:t.xmax+r*e,ymax:t.ymax})}function cn(t,n,o){let{storageInfo:i,pixelSize:s}=n,e=0,r=!1,{pyramidResolutions:f}=i,a=i.tileInfo.format?.toLowerCase()==="mixed"?Math.max(1,Math.min(3,i.tileInfo.dpi/96)):1,l=(t.x+t.y)/2/a;if(f!=null&&f.length){let x=f[f.length-1],p=(x.x+x.y)/2,m=(s.x+s.y)/2;if(l<=m)e=0;else if(l>=p)e=f.length,r=l/p>8;else{let h,y=m;for(let d=1;d<=f.length;d++){if(h=(f[d-1].x+f[d-1].y)/2,l<=h){l===h?e=d:o==="down"?(e=d-1,r=l/y>8):e=o==="up"||l-y>h-l||l/y>2?d:d-1;break}y=h}}let M=e===0?s:f[e-1];return r&&Math.min(M.x,M.y)*I(n.spatialReference)>19567&&(r=!1),{pyramidLevel:e,pyramidResolution:new v({x:M.x,y:M.y,spatialReference:n.spatialReference}),excessiveReading:r}}let c=Math.log(t.x/s.x)/Math.LN2,w=Math.log(t.y/s.y)/Math.LN2,g=n.storageInfo.maximumPyramidLevel||0;e=o==="down"?Math.floor(Math.min(c,w)):o==="up"?Math.ceil(Math.max(c,w)):Math.round((c+w)/2),e<0?e=0:e>g&&(r=e>g+3,e=g);let u=2**e;return{pyramidLevel:e,pyramidResolution:new v({x:u*n.nativePixelSize.x,y:u*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:r}}function kt(t,n){let{pixelSize:o,extent:i}=t,s=Lt(i,n,!1);return Ct(Dt(i,(o.x+o.y)/16),n,s)}function fn(t,n,o){let i=o?.tileSize??512,s=o?.alignGlobalDatasetWithAGOL??!0,e=!!o?.limitToSrcResolution,{extent:r,spatialReference:f,pixelSize:a}=t,l=Mt(a,n,r);if(l==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};let c=(l.x+l.y)/2,w=I(n),g=c*w*96*39.37,u=n.isGeographic?256/i*2958287637958547e-7:256/i*591657527591555e-6,x=t.dataType==="vector-magdir"||t.dataType==="vector-uv",p=kt(t,n),m=Math.min(Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2),Math.ceil(Math.log(u/2/g)/Math.LN2));if(!x&&s&&(n.isGeographic||n.isWebMercator)){let G=_(n);if(x=jt(p)>0||G!=null&&p.width>G/4,!x&&G!=null){let E=-1;if(m<3)E=2**m*c*i;else if(t.storageInfo){let{maximumPyramidLevel:H=0,pyramidScalingFactor:Q=2}=t.storageInfo;E=Q**H*c*i}let N=Math.ceil(G/E);x=N===1||N===2&&G/2-p.xmax<E}}let M,h=g,y=1.001,d=Math.min(2,Math.max(1.414,t.storageInfo?.pyramidScalingFactor||2));if(x){h=u;let G=n.isGeographic?1341104507446289e-21:.29858214164761665,E=G*(96*w*39.37),N=n.isGeographic?4326:3857;M=Mt({x:G,y:G},f,kt(t,new et({wkid:N}))),M.x*=h/E,M.y*=h/E}else{M={x:a.x,y:a.y};let G=0;for(;h<u*(y/2)&&G<m;)G++,h*=d,M.x*=d,M.y*=d;Math.max(h,u)/Math.min(h,u)<=y&&(h=u)}let R=[h],P=[{x:M.x,y:M.y}],k=70.5310735,S=Math.min(k,g)/y;for(;h>=S;)h/=d,M.x/=d,M.y/=d,R.push(h),P.push({x:M.x,y:M.y});if(e){let G=.001*a.x,E=P.findIndex(N=>N.x>=a.x-G&&N.x<=a.x+G);E>-1?(P.length=E+1,R.length=E+1):(E=P.findIndex(N=>N.x<=a.x+G),E>0&&(P.length=E,R.length=E))}return{projectedPixelSize:l,scales:R,srcResolutions:P,isCustomTilingScheme:!x}}export{Nt as a,en as b,Lt as c,on as d,Rt as e,Ct as f,rn as g,_ as h,jt as i,sn as j,an as k,ln as l,cn as m,kt as n,fn as o};
