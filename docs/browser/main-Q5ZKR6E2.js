import{$ as ja,$a as Kr,$b as Pm,A as K1,Aa as Em,Ab as Zt,B as Es,Ba as Rm,Bb as Qt,C as Y1,Ca as ck,Cb as dM,D as X1,Da as dk,Db as or,E as Hh,Ea as hk,Eb as wk,F as Jc,Fa as uk,Fb as $g,G as J1,Ga as mk,Gb as xk,H as XO,Ha as pk,Hb as Ck,I as JO,Ia as fk,Ib as Sk,J as ek,Ja as Un,Jb as Hs,K as gb,Ka as gk,Kb as hM,L as dn,La as Gg,Lb as uM,M as Tn,Ma as Ft,Mb as mM,N as ki,Na as Us,Nb as ls,O as fr,Oa as sM,Ob as Tk,P as Gi,Pa as qg,Pb as It,Q as jh,Qa as Ga,Qb as bb,R as fe,Ra as Yl,Rb as pM,S as Xt,Sa as Am,Sb as Mk,T as tk,Ta as yb,Tb as wb,U as He,Ua as nM,Ub as fM,V as eM,Va as oM,Vb as Ek,W as jt,Wa as _k,Wb as Rk,X as M,Xa as yk,Xb as bt,Y as Mm,Ya as it,Yb as Dm,Z as ik,Za as ei,Zb as Ak,_ as Kl,_a as Li,_b as Ik,a as po,aa as Gh,ab as Yr,ac as Dk,b as ZO,ba as na,bb as tr,bc as $h,c as Bh,ca as oa,cb as aM,cc as Pk,d as Z1,da as tM,db as lM,dc as Ok,e as pb,ea as as,eb as cM,ec as gM,f as $e,fa as wi,fb as td,fc as kk,g as Pr,ga as _b,gb as Ri,h as Kc,ha as rk,hb as Mr,i as fo,ia as iM,ib as vb,ic as Lk,j as Ue,ja as yi,jb as Ui,jc as _M,k as zh,ka as vt,kb as Im,kc as yM,l as Vg,la as qh,lb as Mn,m as QO,ma as sk,mb as De,mc as vM,n as rt,na as Jt,nb as Ze,nc as bM,o as Bg,oa as Wh,ob as pi,oc as wM,p as go,pa as nk,pb as aa,pc as xM,q as fb,qa as Ug,qb as Wg,qc as CM,r as zg,ra as ok,rb as vk,s as KO,sa as ed,sb as qi,t as YO,ta as bs,tb as bk,u as sa,ua as Hg,ub as hn,v as zi,va as ak,vb as gr,w as Q1,wa as rM,wb as Gt,x as Yc,xa as lk,xb as la,y as Uh,ya as _o,yb as Or,z as Xc,za as jg,zb as ws}from"./chunk-ALH7B5IV.js";import{b as p3}from"./chunk-UUYPGF7J.js";import{a as f3,c as g3}from"./chunk-EP7HV3YE.js";import{a as _3,c as y3}from"./chunk-VWQVJZAN.js";import{a as w3,b as x3,d as C3}from"./chunk-YNAEOERN.js";import{a as v3,c as b3}from"./chunk-KYOBP2SZ.js";import{a as s3}from"./chunk-P7IC3XYD.js";import{a as Pd,b as _w,c as yw,f as r3}from"./chunk-C5HCJUO4.js";import{a as n3,c as o3}from"./chunk-3ES6BOWO.js";import{b as a3}from"./chunk-EFMAQGWB.js";import{b as l3}from"./chunk-SEH6YMYI.js";import"./chunk-NTN3HUFI.js";import{a as c3,c as d3}from"./chunk-6S5HT5VE.js";import{b as h3}from"./chunk-EIGIHXZ3.js";import{b as u3}from"./chunk-WKXUZRYD.js";import{b as m3}from"./chunk-NYQPADZO.js";import{a as Ys,b as Dd,c as Zz,e as Qz}from"./chunk-DEB7AHRY.js";import{a as Ip,c as Kz}from"./chunk-WCNMTNYB.js";import{b as Yz}from"./chunk-PK2J3EYE.js";import{a as Ap,b as z_,c as gw}from"./chunk-757AZ3K3.js";import{a as Xz,c as Jz}from"./chunk-46J4MEI5.js";import{b as e3}from"./chunk-WZZQID3D.js";import{a as t3,c as i3}from"./chunk-SPZZT23H.js";import"./chunk-QOAGYFD2.js";import{a as Sa,b as zz,c as Uz,d as fw,f as Hz}from"./chunk-G76W2O3K.js";import"./chunk-KGCWA4JJ.js";import{a as yu,b as jz,c as Gz,e as qz}from"./chunk-CIFPBIYH.js";import{d as pw}from"./chunk-4USQQEIR.js";import{a as jE,b as Wz,d as $z}from"./chunk-54AEHC6E.js";import{a as HE,b as Rp,g as Bz}from"./chunk-VGH5GCLB.js";import{a as Nz,c as Id,d as B_,e as Vz,f as Ks,g as ms,h as Ca}from"./chunk-FPU7DPG3.js";import"./chunk-ZZBU366R.js";import{a as Lz,b as Fz,c as zE}from"./chunk-ZLMPM3CL.js";import{A as ew,a as K0,b as _p,c as xd,d as hB,e as wa,f as CE,g as SE,h as On,i as TE,j as uB,k as Io,l as Cd,m as ME,n as Sd,o as mB,p as pB,q as fB,r as gB,s as X0,t as EE,u as _B,v as RE,w as yp,x as J0,y as yB,z as vB}from"./chunk-GVYD7GZA.js";import"./chunk-WG3SYF7L.js";import{a as Oo,b as UE}from"./chunk-H5ZQROVO.js";import{a as Y0}from"./chunk-LZJYAKDL.js";import{b as pc}from"./chunk-6B25GJQF.js";import{a as kz}from"./chunk-KHVSRF6E.js";import{b as dB,d as Az,e as Dz,f as Ep,g as Pz,h as Oz}from"./chunk-PVWWD2I2.js";import{a as Iz}from"./chunk-PX7LT6IQ.js";import"./chunk-ZQL3TKF7.js";import{a as mV,b as pV}from"./chunk-4QB6GMEG.js";import"./chunk-NUNUXWV4.js";import{a as Mp,b as mw}from"./chunk-TKXAXJNG.js";import{b as hw,d as gl,e as uw}from"./chunk-UZVBE57Y.js";import{a as mc,b as Ez,c as Rz}from"./chunk-D3BMTQYU.js";import{a as gz}from"./chunk-4YKQUZA5.js";import{a as GB}from"./chunk-LSPZMBFV.js";import{a as L_,b as HB,c as jB}from"./chunk-UMYW2XL7.js";import{b as _z}from"./chunk-U4ERJPQO.js";import"./chunk-ZRDZCHT6.js";import{a as yz,b as _u,c as V_,d as cw,e as vz,f as xa,g as bz,h as Po,i as wz,j as xz,k as Cz,l as Sz,m as Tz,o as Qs,p as dw,q as Ad}from"./chunk-JXSQTGAO.js";import{b as Mz}from"./chunk-7BVEXOSH.js";import{a as qB,d as WB,e as Ed,f as fl}from"./chunk-OW4OHJOK.js";import{b as sw}from"./chunk-SV4KOVAG.js";import{a as fz}from"./chunk-RHS3EARZ.js";import{a as Q0}from"./chunk-UYKI77KI.js";import"./chunk-TWEIBILM.js";import{b as tz,d as iz,e as rz,f as sz,g as ow,h as cz,i as aw,j as dz,k as NE,l as hz,m as uz,n as mz,o as pz,q as BE}from"./chunk-4YNUZOQW.js";import{a as VE,b as lw}from"./chunk-4EBEFT6T.js";import{a as Rd,b as nw,c as ZB,d as QB,e as KB,f as YB,g as FE}from"./chunk-W4FJ4A5Q.js";import"./chunk-4FO73WSB.js";import"./chunk-Q5GL3CSI.js";import{a as $B,c as lz}from"./chunk-X7CRJ427.js";import"./chunk-4DR6EKLV.js";import{c as I_}from"./chunk-2SZOQMAQ.js";import{c as Tp}from"./chunk-OT635BJR.js";import"./chunk-EDY6B353.js";import{a as XB,b as JB,c as ez,d as N_}from"./chunk-KS6SWJU3.js";import"./chunk-JHBR5RZV.js";import"./chunk-6J446DPN.js";import{a as gu,b as F_}from"./chunk-E3LKQDEM.js";import"./chunk-UGVZ3EW2.js";import"./chunk-GWDYH5GG.js";import"./chunk-XCZY4IUQ.js";import"./chunk-DZBIKPHA.js";import"./chunk-F4QTXEUP.js";import"./chunk-C6VBL32Q.js";import"./chunk-OXOFK4XQ.js";import"./chunk-3DR4YGRI.js";import{a as nz,b as oz}from"./chunk-WCQK6XOZ.js";import{i as az}from"./chunk-RCCESRES.js";import"./chunk-FTNMSGGI.js";import"./chunk-4DJFVMMN.js";import{$ as LE,A as wp,B as AE,C as xp,D as Td,E as IE,F as k_,G as OB,H as kB,I as LB,J as FB,K as NB,L as Md,N as VB,O as pu,R as DE,S as pl,T as gn,U as Cp,V as Sp,W as BB,X as zB,Y as PE,Z as OE,_ as kE,a as uu,aa as _n,b as D_,ba as fu,c as mu,d as bB,e as P_,f as tw,g as wB,h as xB,i as CB,j as SB,k as hr,l as li,m as vp,n as EB,o as RB,p as bp,q as AB,r as IB,s as xr,t as Cr,u as O_,v as DB,w as PB,x as W,y as iw}from"./chunk-SVK2E2V5.js";import{b as MB}from"./chunk-PA5IAWXD.js";import{b as TB}from"./chunk-AR3SF3CU.js";import{a as UB}from"./chunk-MXVB4FQA.js";import"./chunk-DQVRRO4N.js";import{a as rw}from"./chunk-MM6IP4FS.js";import{a as Kn,b as Do,c as bi}from"./chunk-DYNH5H2C.js";import{b as gV,c as _V}from"./chunk-WP7QHDBV.js";import"./chunk-BJF27AOA.js";import{a as oB,b as aB,c as lB,d as cB}from"./chunk-IML2KDLV.js";import{a as sB,e as nB}from"./chunk-NZBGJPML.js";import{a as rB}from"./chunk-YGFTG2WH.js";import{a as ml,c as fV,d as du,e as hu}from"./chunk-BBIP22OX.js";import{a as A_}from"./chunk-IWGILE5R.js";import{c as zV,d as UV,f as HV,g as jV,h as GV}from"./chunk-52LYF2E7.js";import{a as NV,b as wE,c as XV}from"./chunk-MXWCWT2J.js";import{a as VV,b as BV}from"./chunk-AQKUJSNM.js";import{a as KV,b as G0,c as YV,d as q0,e as W0,f as $0}from"./chunk-SQ32H7D4.js";import{a as FV}from"./chunk-FWIPQIA2.js";import{b as Ge,c as k0,d as ul}from"./chunk-F7R3VTP4.js";import{a as fn}from"./chunk-MNU4KXU7.js";import{a as rr,b as B0,c as yV,d as Ao,f as vV,g as bV,i as wV,j as xV,k as CV,l as SV,m as TV,n as MV,o as EV,p as RV,q as AV,r as vE,s as IV,u as DV,v as bE,w as PV,y as OV}from"./chunk-FVIAJTXY.js";import{a as pn}from"./chunk-QCDIRHTH.js";import{a as V0}from"./chunk-XRVFK5TR.js";import{a as xE}from"./chunk-MXNLAO6J.js";import{a as Z0}from"./chunk-AJSXTGZB.js";import{e as z0}from"./chunk-CO3N3TAZ.js";import"./chunk-TPSXW4OU.js";import{c as LV}from"./chunk-IWNXLWJE.js";import{a as JV,b as eB,c as tB,d as iB}from"./chunk-TCQSMTOV.js";import{a as kV,r as $V,s as ZV,v as QV}from"./chunk-JLO7PPGZ.js";import"./chunk-NRJMGJMB.js";import{a as fp}from"./chunk-YNYZNNM2.js";import{d as U0,e as H0,f as j0,h as gp,i as qV,j as WV}from"./chunk-2F2E6NNR.js";import{a as oV,b as aV,c as lV,d as cV}from"./chunk-NXSOTKIA.js";import{a as fE,b as UN,c as E_,d as R_,e as F0,f as sV,g as nV,h as dV,i as hV,j as uc,k as uV,m as N0}from"./chunk-VTMWGNPI.js";import"./chunk-RB4JCGG3.js";import"./chunk-GJ5HVP34.js";import{a as st,b as hc,c as pp,d as GN,e as cu,f as qN,g as eV}from"./chunk-UO2ZXJZK.js";import{a as L0}from"./chunk-N5XPA5VH.js";import{b as HN,n as jN}from"./chunk-23WSQWHC.js";import"./chunk-E24SCC45.js";import"./chunk-WLE5UO7K.js";import{h as iV,i as rV}from"./chunk-MA4NJINO.js";import{a as tV}from"./chunk-ES4GGVYJ.js";import{a as yE,b as YN,c as XN,d as JN}from"./chunk-ZAR3FBU3.js";import{d as WN,e as $N,g as ZN,h as gE,i as QN,j as KN,k as _E}from"./chunk-KROK7VT6.js";import{b as BN,c as zN}from"./chunk-K526BL2B.js";import{a as VN}from"./chunk-JU3UMX5L.js";import{a as mp}from"./chunk-7H2KDY7G.js";import"./chunk-CEM45EZZ.js";import"./chunk-GLY75KSJ.js";import"./chunk-H7LSTWKZ.js";import{a as NN}from"./chunk-VXGV7YAZ.js";import"./chunk-MNOCKVQA.js";import{b as LN,c as FN}from"./chunk-ZMNG2DP3.js";import"./chunk-BALLTG2E.js";import{a as kN,b as T_,c as pE}from"./chunk-2LC7VTRT.js";import{a as PN}from"./chunk-MDCTC4QF.js";import{h as ON,n as mE}from"./chunk-4QRGVGHK.js";import{c as DN}from"./chunk-VWT6NXFZ.js";import{u as EN}from"./chunk-3KFX3FFC.js";import{a as hE,c as ba,d as uE}from"./chunk-XI5TLVWU.js";import{a as P0}from"./chunk-SQOSDNZX.js";import{a as RN,b as O0,c as AN,d as IN}from"./chunk-MJEY53M3.js";import{a as dc}from"./chunk-IBNL7ZHZ.js";import{a as SN,b as TN}from"./chunk-UEEF43TP.js";import{a as dE,b as I0,c as xN,d as CN}from"./chunk-GSK5DBW5.js";import"./chunk-Q5HG4NWF.js";import{a as cE}from"./chunk-T6V6CYCJ.js";import"./chunk-U45ID7OR.js";import{a as vN,b as A0}from"./chunk-IW2AVHBW.js";import"./chunk-SDHCGQUI.js";import"./chunk-VSPQNL6A.js";import"./chunk-7H32J6FD.js";import{b as $F,c as ZF}from"./chunk-XNAAMINV.js";import{a as qF,b as WF,c as sp,e as x0}from"./chunk-NPF6KTZO.js";import{a as oE,b as Eo,c as Ds,d as QF,e as St}from"./chunk-WNU76WNW.js";import{a as Dn}from"./chunk-H4XRNT5U.js";import"./chunk-WIJFCRLT.js";import{a as op,b as mn,c as tN}from"./chunk-6ISQQD7M.js";import"./chunk-VHVYC3RW.js";import{f as wN}from"./chunk-ZBOVC36T.js";import{a as cr,b as ol}from"./chunk-BUWHOOA3.js";import"./chunk-RLQK45UV.js";import{a as iN}from"./chunk-SDC4SION.js";import"./chunk-6VHG3ZEH.js";import{a as va,b as ll,g as JF,h as aE}from"./chunk-N3AGC3JB.js";import"./chunk-KHTVZWEX.js";import{c as lE,d as eN,e as cc}from"./chunk-IGNHVSQC.js";import{a as bN}from"./chunk-B3W5V2XP.js";import"./chunk-NP35J4DQ.js";import"./chunk-JBGML6IF.js";import{a as ne}from"./chunk-S2HMCZNZ.js";import{a as hp,c as pN,d as E0,e as fN,f as gN,g as _N,h as R0}from"./chunk-WUAC4CFP.js";import"./chunk-ONDKJR4V.js";import{e as aN}from"./chunk-QB4KDO4M.js";import{a as yN}from"./chunk-NNNTRPDR.js";import{b as mN}from"./chunk-KDLA3TQ2.js";import{a as wd}from"./chunk-RPMDOAYZ.js";import{a as up,b as ai}from"./chunk-J7UK2QPE.js";import"./chunk-6DXGZQQN.js";import{a as bd}from"./chunk-3PK63SMD.js";import{a as C_}from"./chunk-2DN2BYDF.js";import"./chunk-GQ2SPTYG.js";import"./chunk-RBWI4VLW.js";import{a as Qn}from"./chunk-MEA3RU4I.js";import"./chunk-3QNHUVFJ.js";import"./chunk-7OTZECLS.js";import"./chunk-XBFBZZXW.js";import"./chunk-LWUJWBPJ.js";import"./chunk-V7QAQAGA.js";import"./chunk-K5V3S3K3.js";import"./chunk-HCCGI45Q.js";import"./chunk-Q6D44QVW.js";import{b as cN}from"./chunk-C3EWQ5V5.js";import{a as dN,b as hN,c as uN}from"./chunk-3UBXEUOT.js";import{a as dr,b as ts}from"./chunk-6WV5YJL7.js";import{a as zr,b as Fe,c as Pn}from"./chunk-3AMG6HG6.js";import"./chunk-I6ETUG5Q.js";import{a as M0}from"./chunk-4MZSW4Z6.js";import"./chunk-BERIM72F.js";import"./chunk-YOBNM4T6.js";import"./chunk-MEBZWNWT.js";import{f as dp}from"./chunk-XZ52TEBV.js";import"./chunk-WAPQB6I3.js";import"./chunk-L3GHXHDP.js";import{a as ot,b as at}from"./chunk-N6PITG7Q.js";import"./chunk-XC4LDHG5.js";import"./chunk-S3ASAZCA.js";import"./chunk-ZUUCQTSR.js";import"./chunk-GKUBZAEG.js";import{a as lN}from"./chunk-UW734WOQ.js";import"./chunk-BIZV3H6H.js";import"./chunk-UCYGH5UZ.js";import{a as ap,b as cl,d as lp,e as nN,f as cp,g as dl,h as S0,k as oN,l as wt,m as mt}from"./chunk-ATV5GTE5.js";import"./chunk-X7WNJQZZ.js";import"./chunk-PQPFAB53.js";import"./chunk-QPPQKNYU.js";import{a as C0,b as rN,e as sN,j as Br}from"./chunk-MJXFSFCY.js";import{a as Vr}from"./chunk-6N46AY7Z.js";import{b as T0}from"./chunk-TCQTMUK4.js";import{a as al}from"./chunk-AY3YVZUY.js";import"./chunk-7DCEI345.js";import"./chunk-ZG3FCPXY.js";import"./chunk-RIUAG34V.js";import{a as hl}from"./chunk-G5SIQY64.js";import"./chunk-WW7S4V24.js";import"./chunk-UGAMS6PU.js";import"./chunk-EHDNZUTT.js";import"./chunk-ECBUS54L.js";import"./chunk-NH7OOX2I.js";import"./chunk-B72PB7U4.js";import"./chunk-644SLL4Y.js";import"./chunk-A54VD7GL.js";import{a as KF,b as S_,c as np,j as YF,k as XF}from"./chunk-K55ZDM2S.js";import"./chunk-UHYNS4LH.js";import"./chunk-Z3USGHSR.js";import"./chunk-SLEIRDN7.js";import"./chunk-W3OGU5I2.js";import"./chunk-OO4IIGVK.js";import"./chunk-KQHYII76.js";import"./chunk-6I6DPRXI.js";import"./chunk-RNN6GAXL.js";import"./chunk-4IVMQ5PX.js";import"./chunk-CQUOQXLP.js";import{a as iE}from"./chunk-F5CPBNZH.js";import{a as yd}from"./chunk-VMYCUJRH.js";import{e as v_,g as b_,j as w_,k as sE,n as x_,o as _d,r as kF}from"./chunk-PTVRFY4B.js";import"./chunk-3ZOLHUAU.js";import{a as rp}from"./chunk-O6YJVL7E.js";import"./chunk-I6ZCG7XQ.js";import{a as lu}from"./chunk-URULUATZ.js";import"./chunk-WOTA3FFP.js";import{c as NF}from"./chunk-BNUQT6PD.js";import{a as BF,b as zF}from"./chunk-5DAF2FXI.js";import{a as sl}from"./chunk-M2F4B74F.js";import"./chunk-2WNCPIJC.js";import{b as LF}from"./chunk-GDB2EJGA.js";import{a as vd}from"./chunk-RDGFIF46.js";import"./chunk-C2ONI6UP.js";import"./chunk-H6LJ2DCJ.js";import{a as w0,c as FF}from"./chunk-IMNO5TXZ.js";import{b as VF}from"./chunk-LCDA6FHZ.js";import"./chunk-RZPELDHM.js";import"./chunk-S3J33BKD.js";import{a as K,h as nE}from"./chunk-NPIYHDQ7.js";import"./chunk-BL63T6AU.js";import"./chunk-AOTWUAUY.js";import"./chunk-VI4TDFI5.js";import"./chunk-GXSLPADW.js";import"./chunk-2HN33SWB.js";import"./chunk-523X5JOP.js";import{a as nl}from"./chunk-BXR2KKYP.js";import{b as Nr,d as DF,e as PF,f as tp,i as fd,l as gd,o as OF,r as ip}from"./chunk-7ISKCG7U.js";import{b as Zn,d as ya,g as rE}from"./chunk-OFGHVREP.js";import"./chunk-BYXBJQAS.js";import{b as jF,c as GF}from"./chunk-3GXNRMPX.js";import"./chunk-YHATXFDZ.js";import{a as UF,b as HF}from"./chunk-X4WWRRJM.js";import{a as Ub}from"./chunk-U3ETEC6R.js";import"./chunk-A2IYJOJO.js";import"./chunk-EFOMVUIX.js";import"./chunk-42DKYLC7.js";import"./chunk-LB3WSIYI.js";import"./chunk-B7ZDEOLU.js";import"./chunk-22JBWFHY.js";import"./chunk-6YHOGO6F.js";import"./chunk-VY6QN6EN.js";import"./chunk-VZPIZOOE.js";import"./chunk-BWCHJXL6.js";import"./chunk-R7X3CKFH.js";import"./chunk-64FW22PO.js";import"./chunk-3EB3OCOV.js";import"./chunk-7Z3Y27UA.js";import"./chunk-HFXUZM7A.js";import{d as bF}from"./chunk-3A66AUSD.js";import"./chunk-UUKQEAQR.js";import"./chunk-6UUMJQNV.js";import"./chunk-Y63DBETK.js";import"./chunk-GNKF5TIB.js";import"./chunk-X4XHTJSF.js";import{c as t2}from"./chunk-YIBWVOPM.js";import"./chunk-PY5WUUCV.js";import"./chunk-R3XRMWAK.js";import"./chunk-PL6CVK2A.js";import"./chunk-J2R7NR2E.js";import"./chunk-VPH54J3G.js";import"./chunk-OD6TX477.js";import"./chunk-ISUG5L3D.js";import{a as D0}from"./chunk-FKKNYWR6.js";import"./chunk-YJ3RZNO6.js";import{l as Xm}from"./chunk-M4PATAW3.js";import"./chunk-BNQ5VRNF.js";import"./chunk-NOFXYDQS.js";import{a as u0}from"./chunk-4BLMEKFL.js";import{g as vF,h as f_}from"./chunk-RPIA54UY.js";import"./chunk-WRN6YTSB.js";import"./chunk-BQ7BWYEG.js";import{a as tE}from"./chunk-LQ6VWBUN.js";import{a as hF}from"./chunk-74RJCD5E.js";import"./chunk-NN4OC7FN.js";import"./chunk-E2R5NVHR.js";import{a as X2,b as J2}from"./chunk-Z5PXCHKK.js";import"./chunk-KCNSUZFF.js";import{a as d0,b as sF,c as rl,d as Ym}from"./chunk-243IQYOZ.js";import"./chunk-6BV3ATJ4.js";import{a as cF}from"./chunk-YNTLVJOI.js";import{c as nF,e as oF,g as aF,j as lF}from"./chunk-PVCDKA4D.js";import{a as c0}from"./chunk-TTXY6GKV.js";import{b as YM}from"./chunk-H7Y5XCPW.js";import"./chunk-UJ2T4QLZ.js";import{a as es}from"./chunk-26R336GJ.js";import{a as eF}from"./chunk-FPZYH52G.js";import{a as tF,b as Di,d as Rr}from"./chunk-OC7V2CEX.js";import{a as KM,g as fa,h as iF,i as rF}from"./chunk-VTCODMOL.js";import"./chunk-B7GIKKEW.js";import"./chunk-4TKIIMKN.js";import"./chunk-PXLEIVAM.js";import"./chunk-CA2IXN6Q.js";import"./chunk-AXPRNSO3.js";import"./chunk-FIUHDVVO.js";import"./chunk-3HX6VT75.js";import"./chunk-U4Y7WABQ.js";import"./chunk-WYOOSF42.js";import{c as _a}from"./chunk-R7P6RQXJ.js";import{c as IF}from"./chunk-4I7LQWUX.js";import{a as AF}from"./chunk-JLNQ6WQT.js";import{a as we,b as y_,c as b0}from"./chunk-GB5RQL32.js";import"./chunk-R6S6A5GA.js";import{a as RF}from"./chunk-IXBI5R7J.js";import{b as EF}from"./chunk-GYJJE3EF.js";import"./chunk-25T3ULWN.js";import{c as Te,d as eE,e as v0}from"./chunk-4OZVVJHM.js";import"./chunk-IZRBPB5G.js";import{D as JM,E as MF,H as y0,Q as lc,c as p0,d as xF,f as Si,g as CF,h as SF,j as f0,n as __,o as TF,q as Jm,r as ep,u as ac,x as au,y as g0,z as _0}from"./chunk-X7XJWAFC.js";import{a as m0}from"./chunk-FOAEOOK3.js";import{e as wF}from"./chunk-ILCAH2F6.js";import{a as g_}from"./chunk-CYCLIMTY.js";import"./chunk-C3YONAAM.js";import"./chunk-RZZNDDYQ.js";import"./chunk-E25QWDXZ.js";import"./chunk-2GSAHDXY.js";import"./chunk-OL24FY3J.js";import"./chunk-QBRYULPI.js";import"./chunk-GPQLPPA5.js";import"./chunk-OXRGERMH.js";import"./chunk-LHH3AZP2.js";import{a as ga}from"./chunk-HVNUIUKO.js";import{n as XM}from"./chunk-Y5M2SONX.js";import{a as LL,b as Bm}from"./chunk-Q6ZVH4MK.js";import{b as pF,i as fF,l as gF,x as _F,y as yF}from"./chunk-OL43UY3L.js";import"./chunk-H2QMNAXT.js";import{a as uF,b as mF}from"./chunk-GKUDWGVQ.js";import{i as h0,k as ou,m as pd,n as dF}from"./chunk-NZ7WSL6F.js";import{a as Ar}from"./chunk-RRDM7P6F.js";import"./chunk-EYI3QUAE.js";import{c as Q2}from"./chunk-LCTRO7CL.js";import{a as md,b as l0}from"./chunk-7X2HMUNN.js";import"./chunk-LW2464MZ.js";import"./chunk-WJDHM47L.js";import{a as q2,b as W2,d as $2}from"./chunk-LWJTIQQT.js";import{b as Z2}from"./chunk-IHBD2IWR.js";import{a as Zm,b as s0,c as Qm,d as hd,e as n0,g as o0,h as oc,i as Km,j as a0,n as G2}from"./chunk-NH3JQE75.js";import{a as Ht,c as QM,d as ud}from"./chunk-XXOIKNT6.js";import{a as un}from"./chunk-DBLGLVAQ.js";import{a as K2}from"./chunk-55A6ZSIC.js";import"./chunk-63EK7JRZ.js";import"./chunk-HVNRUZWJ.js";import{a as il}from"./chunk-AYOI2Y26.js";import{a as i2,b as r2}from"./chunk-IH2TDIRR.js";import"./chunk-3FCM74ZB.js";import{a as o2,b as jM}from"./chunk-ZGDQY5ZD.js";import"./chunk-QH2MD2O2.js";import{a as a2}from"./chunk-6EZNY6L4.js";import"./chunk-3IK5VXZ3.js";import"./chunk-7XLHE26H.js";import"./chunk-MBVOWLUI.js";import{a as n2,b as ad}from"./chunk-EN6CTWVM.js";import"./chunk-KLUVHTFQ.js";import"./chunk-JMSMQ4Z7.js";import{a as Y2}from"./chunk-IRJNWXGT.js";import"./chunk-LVPMJTA6.js";import"./chunk-7NYR66Q3.js";import"./chunk-WDFAQFJ4.js";import"./chunk-7LUQF6AI.js";import{a as ar,c as Yb,d as si,e as qn,f as Jh}from"./chunk-O4AQRVFI.js";import{a as Fi}from"./chunk-NDPAZKBG.js";import"./chunk-7AZ5UVCG.js";import{a as To}from"./chunk-6GGK7PRJ.js";import"./chunk-G3PA3VVF.js";import"./chunk-AO7UDTUI.js";import{b as k2,c as WM}from"./chunk-Q7O5PY54.js";import"./chunk-PFIMJ2UL.js";import{d as O2}from"./chunk-CY477QBZ.js";import"./chunk-EJO53FLN.js";import"./chunk-XXR5OT24.js";import{a as jm,b as Gm,c as qm}from"./chunk-4XIZVPNF.js";import"./chunk-F7VAE37R.js";import"./chunk-PM4ZR7W6.js";import"./chunk-ENLR2WBX.js";import"./chunk-RI3FIROF.js";import"./chunk-PJX4LNSV.js";import"./chunk-NNETCWLJ.js";import{E as p2,F as rc,G as f2,K as g2,M as _2,a as l2,d as ld,e as GM,j as c2,l as Zb,p as d2,q as h2,r as u2,t as m2}from"./chunk-EPTSNNZF.js";import{c as A2,e as el,f as I2,g as D2,h as sc,p as qM,q as Xh,r as Kb,u as P2}from"./chunk-FW33MEBA.js";import"./chunk-RM6CXOHZ.js";import{c as u_,f as T2,k as M2,n as E2,p as R2}from"./chunk-AOA5JMXK.js";import"./chunk-TWW3KW7Z.js";import{a as nu,d as j2}from"./chunk-7KH77MT4.js";import{a as r0}from"./chunk-I6LCIPDY.js";import{a as i0,d as H2}from"./chunk-Y6H3NTW7.js";import{a as In}from"./chunk-4RLJMQW4.js";import{b as $n}from"./chunk-J6ZRC6RI.js";import{a as us,e as ZM}from"./chunk-EBGO44EK.js";import"./chunk-THY6AAMN.js";import{a as Ii}from"./chunk-7W6RATG7.js";import"./chunk-45SNVLPM.js";import{a as Ni,b as ni,c as oi,d as z2,h as ru,i as Vi,j as e0,k as An,l as lr,m as p_,n as Ci,o as dd,p as tl,q as t0,r as Is,w as pa,x as U2,y as su}from"./chunk-BDF7KEUQ.js";import{a as ir,b as V2,c as m_,e as B2,f as iu}from"./chunk-HWN5REN7.js";import{c as N2,p as $M}from"./chunk-B4JAL745.js";import{a as wr,b as En,d as Xb,i as ma,q as eu,s as tu,w as Jb}from"./chunk-XTES2GPX.js";import{A as L2,D as Wm,E as cd,F as $m,G as gi,H as hs,I as F2,J as Fr,a as be,b as G,c as ve,d as te,e as ge,n as q,o as nc,p as Ai,q as Mo,r as ds,s as Wn,u as Z,v as X,w as Ct,x as di,y as fi,z as Rn}from"./chunk-2HUIJUS4.js";import{a as Lm,b as DM,c as Fm,d as Jr,e as yr}from"./chunk-JTM5BEUP.js";import{c as pL}from"./chunk-S5E62J6M.js";import{e as A}from"./chunk-AKDLIRLE.js";import{b as n_}from"./chunk-L62KOIOF.js";import{f as r_,h as s_,j as uL,k as mL}from"./chunk-5TKTI2G2.js";import"./chunk-VDNXTMSC.js";import{a as T,b as _r,c as xi,d as Gs,g as Re,h as ie,i as Ce}from"./chunk-MBJHSEMD.js";import"./chunk-K72LO6P2.js";import"./chunk-R7Q3STHM.js";import{a as x2,b as C2,c as S2}from"./chunk-G4PDP3HY.js";import{b as Ro}from"./chunk-EKU2FJZS.js";import"./chunk-NHN544WL.js";import{a as fL}from"./chunk-WZ5A3YGX.js";import"./chunk-NKMODNM6.js";import"./chunk-SEKMXZL5.js";import"./chunk-2R4SNL6O.js";import{a as Lb}from"./chunk-MXOOOTCV.js";import{L as MN}from"./chunk-7D4IYTAJ.js";import{a as s2}from"./chunk-TSNWBMBA.js";import"./chunk-GLWPOGYF.js";import{a as Ja,b as UL,d as vr,f as ri,g as HL,h as Kh,i as ua}from"./chunk-YFBPRKIN.js";import"./chunk-P2YRCTWM.js";import"./chunk-OFZ6SV37.js";import{a as FL,b as NL,c as rd,d as sd,e as nd,h as VL,i as c_,j as VM,k as BM,l as zm,q as BL,r as zL}from"./chunk-LAJXTVEO.js";import{B as YL,C as XL,D as JL,E as e2,a as od,c as Yh,e as QL,f as zM,g as Gn,h as UM,j as xo,k as HM,l as KL,m as d_,p as Co}from"./chunk-5MNDZ6BX.js";import"./chunk-RDHMB7M5.js";import"./chunk-YSOJWUIW.js";import"./chunk-Q5WFUDPQ.js";import{a as $b}from"./chunk-DPZGANVI.js";import{a as ML,o as Xa}from"./chunk-T7BKG6V3.js";import{b as EL}from"./chunk-R6VC74T7.js";import{A as da,B as OL,C as ha,E as kL,a as ii,c as a_,d as RL,e as AL,f as Hb,g as IL,h as Ya,j as LM,k as bo,l as ic,o as jb,q as FM,t as DL,v as id,w as NM,x as l_,y as PL,z as Gb}from"./chunk-6WKJD7BM.js";import"./chunk-3CR7P5WT.js";import{a as br,b as w2,c as $s,f as Zs}from"./chunk-YRTBL7EE.js";import{a as Hm,c as So,d as y2,e as Qb,k as v2,l as h_,m as b2}from"./chunk-3FPO2LOS.js";import{a as Wb,c as Um}from"./chunk-QNZSBADV.js";import{a as b,b as Ws,c as dt,d as qb,e as jL,f as GL,h as qL,i as wo,k as WL,l as $L,m as ZL}from"./chunk-PYQRTZNZ.js";import{b as Ob,d as ca}from"./chunk-S4PLWG55.js";import{b as kb}from"./chunk-DZAY272R.js";import{c as IM}from"./chunk-GYH7NDHH.js";import{a as aL,h as lL}from"./chunk-S3UQHW42.js";import{a as PM,c as qe}from"./chunk-VQHENXDQ.js";import{a as ti}from"./chunk-VWF5VUO3.js";import{c as i_,f as js}from"./chunk-HRP5LYWJ.js";import"./chunk-BIVFGNT6.js";import"./chunk-EUZMXXZJ.js";import{c as M_}from"./chunk-7PEPFLZH.js";import{a as o_}from"./chunk-BRVOQZDM.js";import"./chunk-3M7VXIQH.js";import{a as dL,b as hL}from"./chunk-TBYT66N3.js";import{b as U,c as Qh,f as Ke,h as Vt,i as ec,k as vo,l as Vm,q as tc}from"./chunk-5PTS4JDF.js";import"./chunk-MUI46NAG.js";import{a as bL,c as wL,e as xL,h as Bb,j as CL,l as je,m as zb,q as SL,r as TL,y as vi}from"./chunk-N27U3N2T.js";import{a as kM}from"./chunk-4R5NBZMW.js";import{a as gt}from"./chunk-NDYVXEZ5.js";import{a as Nm}from"./chunk-CMMPCPP5.js";import{J as ht,a as gL,ba as vL,da as Zh,j as OM,m as Ka,n as _L,q as yL,v as Fb,x as Nb,z as Vb}from"./chunk-4DLSYLKE.js";import{a as qs}from"./chunk-VPXBKZQM.js";import{a as oL,c as km}from"./chunk-ZTKK3KB7.js";import{a as Lr}from"./chunk-GZXWFBZI.js";import{a as nL}from"./chunk-B7IARA3F.js";import{a as cL,b as t_}from"./chunk-IZVEJCCI.js";import{g as sL,k as jn}from"./chunk-TEY6TKJV.js";import{P as Pb,S as rL}from"./chunk-4M6XQSBA.js";import{f as iL,h as Wi}from"./chunk-2JF6YUJG.js";import{I as Kk,J as Yk,K as Xk,N as Jk,Q as h,S as k,f as Uk,g as SM,h as qa,j as Om,m as Xl,r as Yg,t as Xg,u as Ab,v as As,w as Zk,z as Qk}from"./chunk-GGZQ5GCM.js";import{A as Db,B as Qa,I as tL,J as RM,O as AM,U as w,b as EM,k as yo,s as Ib,u as eL}from"./chunk-TFUPB3ZG.js";import"./chunk-ANPNMGFG.js";import{a as c}from"./chunk-BMVJCP2M.js";import{A as Wk,B as Za,D as $k,E as Hn,a as kr,c as MM,f as jk,g as Wa,i as Sb,k as cs,l as Ut,n as Jl,o as Gk,q as $a,s as Tb,t as xs,u as Jg,w as e_,x as qk,z as Mb}from"./chunk-GMC3I5VG.js";import{a as Hk,b as z,c as Ne,d as Nt,e as Er,f as Hi,h as TM,i as Kg}from"./chunk-WGF2T2BG.js";import{a as Eb,b as Rb}from"./chunk-YZP43POT.js";import{a as Dt}from"./chunk-VEDIBGHD.js";import{b as Xr,k as Qg,m as Bk,o as zk,r as V,t as le}from"./chunk-3IBUFXWY.js";import{L as Vk,a as Qe,c as Fk,g as xb,h as Nk,i as Zg,o as Cb,u as Rs}from"./chunk-BP73DJTS.js";import"./chunk-LOX6V3YR.js";import"./chunk-FGVQZMJ3.js";import"./chunk-PXV7KILP.js";import"./chunk-C73532AX.js";import{a as I,b as se,d as $1,g as P,j as $O}from"./chunk-JEGVIFEP.js";var qE=class{};var Dp=class e{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(t){t?typeof t=="string"?this.lazyInit=()=>{this.headers=new Map,t.split(`
`).forEach(i=>{let r=i.indexOf(":");if(r>0){let s=i.slice(0,r),n=i.slice(r+1).trim();this.addHeaderEntry(s,n)}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((i,r)=>{this.addHeaderEntry(r,i)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([i,r])=>{this.setHeaderEntries(i,r)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();let i=this.headers.get(t.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,i){return this.clone({name:t,value:i,op:"a"})}set(t,i){return this.clone({name:t,value:i,op:"s"})}delete(t,i){return this.clone({name:t,value:i,op:"d"})}maybeSetNormalizedName(t,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,t)}init(){this.lazyInit&&(this.lazyInit instanceof e?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(i=>{this.headers.set(i,t.headers.get(i)),this.normalizedNames.set(i,t.normalizedNames.get(i))})}clone(t){let i=new e;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof e?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([t]),i}applyUpdate(t){let i=t.name.toLowerCase();switch(t.op){case"a":case"s":let r=t.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(t.name,i);let s=(t.op==="a"?this.headers.get(i):void 0)||[];s.push(...r),this.headers.set(i,s);break;case"d":let n=t.value;if(!n)this.headers.delete(i),this.normalizedNames.delete(i);else{let o=this.headers.get(i);if(!o)return;o=o.filter(a=>n.indexOf(a)===-1),o.length===0?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,o)}break}}addHeaderEntry(t,i){let r=t.toLowerCase();this.maybeSetNormalizedName(t,r),this.headers.has(r)?this.headers.get(r).push(i):this.headers.set(r,[i])}setHeaderEntries(t,i){let r=(Array.isArray(i)?i:[i]).map(n=>n.toString()),s=t.toLowerCase();this.headers.set(s,r),this.maybeSetNormalizedName(t,s)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>t(this.normalizedNames.get(i),this.headers.get(i)))}};var WE=class{encodeKey(t){return S3(t)}encodeValue(t){return S3(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}};function p6(e,t){let i=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(s=>{let n=s.indexOf("="),[o,a]=n==-1?[t.decodeKey(s),""]:[t.decodeKey(s.slice(0,n)),t.decodeValue(s.slice(n+1))],l=i.get(o)||[];l.push(a),i.set(o,l)}),i}var f6=/%(\d[a-f0-9])/gi,g6={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function S3(e){return encodeURIComponent(e).replace(f6,(t,i)=>g6[i]??t)}function vw(e){return`${e}`}var Od=class e{map;encoder;updates=null;cloneFrom=null;constructor(t={}){if(this.encoder=t.encoder||new WE,t.fromString){if(t.fromObject)throw new Gi(2805,!1);this.map=p6(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(i=>{let r=t.fromObject[i],s=Array.isArray(r)?r.map(vw):[vw(r)];this.map.set(i,s)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();let i=this.map.get(t);return i?i[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,i){return this.clone({param:t,value:i,op:"a"})}appendAll(t){let i=[];return Object.keys(t).forEach(r=>{let s=t[r];Array.isArray(s)?s.forEach(n=>{i.push({param:r,value:n,op:"a"})}):i.push({param:r,value:s,op:"a"})}),this.clone(i)}set(t,i){return this.clone({param:t,value:i,op:"s"})}delete(t,i){return this.clone({param:t,value:i,op:"d"})}toString(){return this.init(),this.keys().map(t=>{let i=this.encoder.encodeKey(t);return this.map.get(t).map(r=>i+"="+this.encoder.encodeValue(r)).join("&")}).filter(t=>t!=="").join("&")}clone(t){let i=new e({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(t),i}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":let i=(t.op==="a"?this.map.get(t.param):void 0)||[];i.push(vw(t.value)),this.map.set(t.param,i);break;case"d":if(t.value!==void 0){let r=this.map.get(t.param)||[],s=r.indexOf(vw(t.value));s!==-1&&r.splice(s,1),r.length>0?this.map.set(t.param,r):this.map.delete(t.param)}else{this.map.delete(t.param);break}}}),this.cloneFrom=this.updates=null)}};var $E=class{map=new Map;set(t,i){return this.map.set(t,i),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}};function _6(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function T3(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function M3(e){return typeof Blob<"u"&&e instanceof Blob}function E3(e){return typeof FormData<"u"&&e instanceof FormData}function y6(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}var v6="X-Request-URL",R3="text/plain",A3="application/json",Gre=`${A3}, ${R3}, */*`,U_=class e{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(t,i,r,s){this.url=i,this.method=t.toUpperCase();let n;if(_6(this.method)||s?(this.body=r!==void 0?r:null,n=s):n=r,n&&(this.reportProgress=!!n.reportProgress,this.withCredentials=!!n.withCredentials,n.responseType&&(this.responseType=n.responseType),n.headers&&(this.headers=n.headers),n.context&&(this.context=n.context),n.params&&(this.params=n.params),this.transferCache=n.transferCache),this.headers??=new Dp,this.context??=new $E,!this.params)this.params=new Od,this.urlWithParams=i;else{let o=this.params.toString();if(o.length===0)this.urlWithParams=i;else{let a=i.indexOf("?"),l=a===-1?"?":a<i.length-1?"&":"";this.urlWithParams=i+l+o}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||T3(this.body)||M3(this.body)||E3(this.body)||y6(this.body)?this.body:this.body instanceof Od?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||E3(this.body)?null:M3(this.body)?this.body.type||null:T3(this.body)?null:typeof this.body=="string"?R3:this.body instanceof Od?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?A3:null}clone(t={}){let i=t.method||this.method,r=t.url||this.url,s=t.responseType||this.responseType,n=t.transferCache??this.transferCache,o=t.body!==void 0?t.body:this.body,a=t.withCredentials??this.withCredentials,l=t.reportProgress??this.reportProgress,d=t.headers||this.headers,u=t.params||this.params,m=t.context??this.context;return t.setHeaders!==void 0&&(d=Object.keys(t.setHeaders).reduce((p,f)=>p.set(f,t.setHeaders[f]),d)),t.setParams&&(u=Object.keys(t.setParams).reduce((p,f)=>p.set(f,t.setParams[f]),u)),new e(i,r,o,{params:u,headers:d,context:m,reportProgress:l,responseType:s,withCredentials:a,transferCache:n})}},I3=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(I3||{}),ZE=class{headers;status;statusText;url;ok;type;constructor(t,i=200,r="OK"){this.headers=t.headers||new Dp,this.status=t.status!==void 0?t.status:i,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}};var QE=class e extends ZE{body;constructor(t={}){super(t),this.body=t.body!==void 0?t.body:null}type=I3.Response;clone(t={}){return new e({body:t.body!==void 0?t.body:this.body,headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}};function GE(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials,transferCache:e.transferCache}}var D3=(()=>{class e{handler;constructor(i){this.handler=i}request(i,r,s={}){let n;if(i instanceof U_)n=i;else{let l;s.headers instanceof Dp?l=s.headers:l=new Dp(s.headers);let d;s.params&&(s.params instanceof Od?d=s.params:d=new Od({fromObject:s.params})),n=new U_(i,r,s.body!==void 0?s.body:null,{headers:l,context:s.context,params:d,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials,transferCache:s.transferCache})}let o=Ue(n).pipe(Uh(l=>this.handler.handle(l)));if(i instanceof U_||s.observe==="events")return o;let a=o.pipe(zi(l=>l instanceof QE));switch(s.observe||"body"){case"body":switch(n.responseType){case"arraybuffer":return a.pipe(rt(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return l.body}));case"blob":return a.pipe(rt(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new Error("Response is not a Blob.");return l.body}));case"text":return a.pipe(rt(l=>{if(l.body!==null&&typeof l.body!="string")throw new Error("Response is not a string.");return l.body}));case"json":default:return a.pipe(rt(l=>l.body))}case"response":return a;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(i,r={}){return this.request("DELETE",i,r)}get(i,r={}){return this.request("GET",i,r)}head(i,r={}){return this.request("HEAD",i,r)}jsonp(i,r){return this.request("JSONP",i,{params:new Od().append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(i,r={}){return this.request("OPTIONS",i,r)}patch(i,r,s={}){return this.request("PATCH",i,GE(s,r))}post(i,r,s={}){return this.request("POST",i,GE(s,r))}put(i,r,s={}){return this.request("PUT",i,GE(s,r))}static \u0275fac=function(r){return new(r||e)(jt(qE))};static \u0275prov=fe({token:e,factory:e.\u0275fac})}return e})();var qre=RegExp(`^${v6}:`,"m");var YE=class extends Rk{supportsDOMEvents=!0},XE=class e extends YE{static makeCurrent(){Ek(new e)}onAndCancel(t,i,r,s){return t.addEventListener(i,r,s),()=>{t.removeEventListener(i,r,s)}}dispatchEvent(t,i){t.dispatchEvent(i)}remove(t){t.remove()}createElement(t,i){return i=i||this.getDefaultDocument(),i.createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,i){return i==="window"?window:i==="document"?t:i==="body"?t.body:null}getBaseHref(t){let i=x6();return i==null?null:C6(i)}resetBaseElement(){H_=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Ak(document.cookie,t)}},H_=null;function x6(){return H_=H_||document.querySelector("base"),H_?H_.getAttribute("href"):null}function C6(e){return new URL(e,document.baseURI).pathname}var S6=(()=>{class e{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac})}return e})(),JE=new He(""),F3=(()=>{class e{_zone;_plugins;_eventNameToPlugin=new Map;constructor(i,r){this._zone=r,i.forEach(s=>{s.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,r,s,n){return this._findPluginFor(r).addEventListener(i,r,s,n)}getZone(){return this._zone}_findPluginFor(i){let r=this._eventNameToPlugin.get(i);if(r)return r;if(r=this._plugins.find(n=>n.supports(i)),!r)throw new Gi(5101,!1);return this._eventNameToPlugin.set(i,r),r}static \u0275fac=function(r){return new(r||e)(jt(JE),jt(vt))};static \u0275prov=fe({token:e,factory:e.\u0275fac})}return e})(),ww=class{_doc;constructor(t){this._doc=t}manager},bw="ng-app-id";function P3(e){for(let t of e)t.remove()}function O3(e,t){let i=t.createElement("style");return i.textContent=e,i}function T6(e,t,i,r){let s=e.head?.querySelectorAll(`style[${bw}="${t}"],link[${bw}="${t}"]`);if(s)for(let n of s)n.removeAttribute(bw),n instanceof HTMLLinkElement?r.set(n.href.slice(n.href.lastIndexOf("/")+1),{usage:0,elements:[n]}):n.textContent&&i.set(n.textContent,{usage:0,elements:[n]})}function eR(e,t){let i=t.createElement("link");return i.setAttribute("rel","stylesheet"),i.setAttribute("href",e),i}var N3=(()=>{class e{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(i,r,s,n={}){this.doc=i,this.appId=r,this.nonce=s,this.isServer=gM(n),T6(i,r,this.inline,this.external),this.hosts.add(i.head)}addStyles(i,r){for(let s of i)this.addUsage(s,this.inline,O3);r?.forEach(s=>this.addUsage(s,this.external,eR))}removeStyles(i,r){for(let s of i)this.removeUsage(s,this.inline);r?.forEach(s=>this.removeUsage(s,this.external))}addUsage(i,r,s){let n=r.get(i);n?n.usage++:r.set(i,{usage:1,elements:[...this.hosts].map(o=>this.addElement(o,s(i,this.doc)))})}removeUsage(i,r){let s=r.get(i);s&&(s.usage--,s.usage<=0&&(P3(s.elements),r.delete(i)))}ngOnDestroy(){for(let[,{elements:i}]of[...this.inline,...this.external])P3(i);this.hosts.clear()}addHost(i){this.hosts.add(i);for(let[r,{elements:s}]of this.inline)s.push(this.addElement(i,O3(r,this.doc)));for(let[r,{elements:s}]of this.external)s.push(this.addElement(i,eR(r,this.doc)))}removeHost(i){this.hosts.delete(i)}addElement(i,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(bw,this.appId),i.appendChild(r)}static \u0275fac=function(r){return new(r||e)(jt(bt),jt(Ug),jt(Hg,8),jt(ed))};static \u0275prov=fe({token:e,factory:e.\u0275fac})}return e})(),KE={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},sR=/%COMP%/g,V3="%COMP%",M6=`_nghost-${V3}`,E6=`_ngcontent-${V3}`,R6=!0,A6=new He("",{providedIn:"root",factory:()=>R6});function I6(e){return E6.replace(sR,e)}function D6(e){return M6.replace(sR,e)}function B3(e,t){return t.map(i=>i.replace(sR,e))}var xw=(()=>{class e{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(i,r,s,n,o,a,l,d=null,u=null){this.eventManager=i,this.sharedStylesHost=r,this.appId=s,this.removeStylesOnCompDestroy=n,this.doc=o,this.platformId=a,this.ngZone=l,this.nonce=d,this.tracingService=u,this.platformIsServer=gM(a),this.defaultRenderer=new j_(i,o,l,this.platformIsServer,this.tracingService)}createRenderer(i,r){if(!i||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===jg.ShadowDom&&(r=se(I({},r),{encapsulation:jg.Emulated}));let s=this.getOrCreateRenderer(i,r);return s instanceof Cw?s.applyToHost(i):s instanceof G_&&s.applyStyles(),s}getOrCreateRenderer(i,r){let s=this.rendererByCompId,n=s.get(r.id);if(!n){let o=this.doc,a=this.ngZone,l=this.eventManager,d=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,m=this.platformIsServer;switch(r.encapsulation){case jg.Emulated:n=new Cw(l,d,r,this.appId,u,o,a,m,this.tracingService);break;case jg.ShadowDom:return new tR(l,d,i,r,o,a,this.nonce,m,this.tracingService);default:n=new G_(l,d,r,u,o,a,m,this.tracingService);break}s.set(r.id,n)}return n}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(i){this.rendererByCompId.get(i)?.destroy(),this.rendererByCompId.delete(i)}static \u0275fac=function(r){return new(r||e)(jt(F3),jt(N3),jt(Ug),jt(A6),jt(bt),jt(ed),jt(vt),jt(Hg),jt(ak,8))};static \u0275prov=fe({token:e,factory:e.\u0275fac})}return e})(),j_=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(t,i,r,s,n){this.eventManager=t,this.doc=i,this.ngZone=r,this.platformIsServer=s,this.tracingService=n}destroy(){}destroyNode=null;createElement(t,i){return i?this.doc.createElementNS(KE[i]||i,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,i){(k3(t)?t.content:t).appendChild(i)}insertBefore(t,i,r){t&&(k3(t)?t.content:t).insertBefore(i,r)}removeChild(t,i){i.remove()}selectRootElement(t,i){let r=typeof t=="string"?this.doc.querySelector(t):t;if(!r)throw new Gi(-5104,!1);return i||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,i,r,s){if(s){i=s+":"+i;let n=KE[s];n?t.setAttributeNS(n,i,r):t.setAttribute(i,r)}else t.setAttribute(i,r)}removeAttribute(t,i,r){if(r){let s=KE[r];s?t.removeAttributeNS(s,i):t.removeAttribute(`${r}:${i}`)}else t.removeAttribute(i)}addClass(t,i){t.classList.add(i)}removeClass(t,i){t.classList.remove(i)}setStyle(t,i,r,s){s&(Gg.DashCase|Gg.Important)?t.style.setProperty(i,r,s&Gg.Important?"important":""):t.style[i]=r}removeStyle(t,i,r){r&Gg.DashCase?t.style.removeProperty(i):t.style[i]=""}setProperty(t,i,r){t!=null&&(t[i]=r)}setValue(t,i){t.nodeValue=i}listen(t,i,r,s){if(typeof t=="string"&&(t=fM().getGlobalEventTarget(this.doc,t),!t))throw new Error(`Unsupported event target ${t} for event ${i}`);let n=this.decoratePreventDefault(r);return this.tracingService!==null&&this.tracingService.wrapEventListener&&(n=this.tracingService.wrapEventListener(t,i,n)),this.eventManager.addEventListener(t,i,n,s)}decoratePreventDefault(t){return i=>{if(i==="__ngUnwrap__")return t;(this.platformIsServer?this.ngZone.runGuarded(()=>t(i)):t(i))===!1&&i.preventDefault()}}};function k3(e){return e.tagName==="TEMPLATE"&&e.content!==void 0}var tR=class extends j_{sharedStylesHost;hostEl;shadowRoot;constructor(t,i,r,s,n,o,a,l,d){super(t,n,o,l,d),this.sharedStylesHost=i,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=B3(s.id,s.styles);for(let p of u){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=p,this.shadowRoot.appendChild(f)}let m=s.getExternalStyles?.();if(m)for(let p of m){let f=eR(p,n);a&&f.setAttribute("nonce",a),this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,i){return super.appendChild(this.nodeOrShadowRoot(t),i)}insertBefore(t,i,r){return super.insertBefore(this.nodeOrShadowRoot(t),i,r)}removeChild(t,i){return super.removeChild(null,i)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},G_=class extends j_{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(t,i,r,s,n,o,a,l,d){super(t,n,o,a,l),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=s,this.styles=d?B3(d,r.styles):r.styles,this.styleUrls=r.getExternalStyles?.(d)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Cw=class extends G_{contentAttr;hostAttr;constructor(t,i,r,s,n,o,a,l,d){let u=s+"-"+r.id;super(t,i,r,n,o,a,l,d,u),this.contentAttr=I6(u),this.hostAttr=D6(u)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,i){let r=super.createElement(t,i);return super.setAttribute(r,this.contentAttr,""),r}},P6=(()=>{class e extends ww{constructor(i){super(i)}supports(i){return!0}addEventListener(i,r,s,n){return i.addEventListener(r,s,n),()=>this.removeEventListener(i,r,s,n)}removeEventListener(i,r,s,n){return i.removeEventListener(r,s,n)}static \u0275fac=function(r){return new(r||e)(jt(bt))};static \u0275prov=fe({token:e,factory:e.\u0275fac})}return e})(),L3=["alt","control","meta","shift"],O6={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},k6={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey},L6=(()=>{class e extends ww{constructor(i){super(i)}supports(i){return e.parseEventName(i)!=null}addEventListener(i,r,s,n){let o=e.parseEventName(r),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>fM().onAndCancel(i,o.domEventName,a,n))}static parseEventName(i){let r=i.toLowerCase().split("."),s=r.shift();if(r.length===0||!(s==="keydown"||s==="keyup"))return null;let n=e._normalizeKey(r.pop()),o="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),o="code."),L3.forEach(d=>{let u=r.indexOf(d);u>-1&&(r.splice(u,1),o+=d+".")}),o+=n,r.length!=0||n.length===0)return null;let l={};return l.domEventName=s,l.fullKey=o,l}static matchEventFullKeyCode(i,r){let s=O6[i.key]||i.key,n="";return r.indexOf("code.")>-1&&(s=i.code,n="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),L3.forEach(o=>{if(o!==s){let a=k6[o];a(i)&&(n+=o+".")}}),n+=s,n===r)}static eventCallback(i,r,s){return n=>{e.matchEventFullKeyCode(n,i)&&s.runGuarded(()=>r(n))}}static _normalizeKey(i){return i==="esc"?"escape":i}static \u0275fac=function(r){return new(r||e)(jt(bt))};static \u0275prov=fe({token:e,factory:e.\u0275fac})}return e})();function z3(e,t){return Tk(I({rootComponent:e},F6(t)))}function F6(e){return{appProviders:[...U6,...e?.providers??[]],platformProviders:z6}}function N6(){XE.makeCurrent()}function V6(){return new qh}function B6(){return nk(document),document}var z6=[{provide:ed,useValue:Pk},{provide:ok,useValue:N6,multi:!0},{provide:bt,useFactory:B6,deps:[]}];var U6=[{provide:ik,useValue:"root"},{provide:qh,useFactory:V6,deps:[]},{provide:JE,useClass:P6,multi:!0,deps:[bt,vt,ed]},{provide:JE,useClass:L6,multi:!0,deps:[bt]},xw,N3,F3,{provide:Ga,useExisting:xw},{provide:kk,useClass:S6,deps:[]},[]];var U3=(()=>{class e{_doc;constructor(i){this._doc=i}getTitle(){return this._doc.title}setTitle(i){this._doc.title=i||""}static \u0275fac=function(r){return new(r||e)(jt(bt))};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var nR=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:function(r){let s=null;return r?s=new(r||e):s=jt(H6),s},providedIn:"root"})}return e})(),H6=(()=>{class e extends nR{_doc;constructor(i){super(),this._doc=i}sanitize(i,r){if(r==null)return null;switch(i){case Un.NONE:return r;case Un.HTML:return Rm(r,"HTML")?Em(r):fk(this._doc,String(r)).toString();case Un.STYLE:return Rm(r,"Style")?Em(r):r;case Un.SCRIPT:if(Rm(r,"Script"))return Em(r);throw new Gi(5200,!1);case Un.URL:return Rm(r,"URL")?Em(r):pk(String(r));case Un.RESOURCE_URL:if(Rm(r,"ResourceURL"))return Em(r);throw new Gi(5201,!1);default:throw new Gi(5202,!1)}}bypassSecurityTrustHtml(i){return ck(i)}bypassSecurityTrustStyle(i){return dk(i)}bypassSecurityTrustScript(i){return hk(i)}bypassSecurityTrustUrl(i){return uk(i)}bypassSecurityTrustResourceUrl(i){return mk(i)}static \u0275fac=function(r){return new(r||e)(jt(bt))};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var xt="primary",oy=Symbol("RouteTitle"),dR=class{params;constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){let i=this.params[t];return Array.isArray(i)?i[0]:i}return null}getAll(t){if(this.has(t)){let i=this.params[t];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}};function Np(e){return new dR(e)}function G6(e,t,i){let r=i.path.split("/");if(r.length>e.length||i.pathMatch==="full"&&(t.hasChildren()||r.length<e.length))return null;let s={};for(let n=0;n<r.length;n++){let o=r[n],a=e[n];if(o[0]===":")s[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:e.slice(0,r.length),posParams:s}}function q6(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!_l(e[i],t[i]))return!1;return!0}function _l(e,t){let i=e?hR(e):void 0,r=t?hR(t):void 0;if(!i||!r||i.length!=r.length)return!1;let s;for(let n=0;n<i.length;n++)if(s=i[n],!K3(e[s],t[s]))return!1;return!0}function hR(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function K3(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;let i=[...e].sort(),r=[...t].sort();return i.every((s,n)=>r[n]===s)}else return e===t}function Y3(e){return e.length>0?e[e.length-1]:null}function kd(e){return Vg(e)?e:lM(e)?fo(Promise.resolve(e)):Ue(e)}var W6={exact:J3,subset:eU},X3={exact:$6,subset:Z6,ignored:()=>!0};function j3(e,t,i){return W6[i.paths](e.root,t.root,i.matrixParams)&&X3[i.queryParams](e.queryParams,t.queryParams)&&!(i.fragment==="exact"&&e.fragment!==t.fragment)}function $6(e,t){return _l(e,t)}function J3(e,t,i){if(!bu(e.segments,t.segments)||!Mw(e.segments,t.segments,i)||e.numberOfChildren!==t.numberOfChildren)return!1;for(let r in t.children)if(!e.children[r]||!J3(e.children[r],t.children[r],i))return!1;return!0}function Z6(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(i=>K3(e[i],t[i]))}function eU(e,t,i){return tU(e,t,t.segments,i)}function tU(e,t,i,r){if(e.segments.length>i.length){let s=e.segments.slice(0,i.length);return!(!bu(s,i)||t.hasChildren()||!Mw(s,i,r))}else if(e.segments.length===i.length){if(!bu(e.segments,i)||!Mw(e.segments,i,r))return!1;for(let s in t.children)if(!e.children[s]||!eU(e.children[s],t.children[s],r))return!1;return!0}else{let s=i.slice(0,e.segments.length),n=i.slice(e.segments.length);return!bu(e.segments,s)||!Mw(e.segments,s,r)||!e.children[xt]?!1:tU(e.children[xt],t,n,r)}}function Mw(e,t,i){return t.every((r,s)=>X3[i](e[s].parameters,r.parameters))}var gc=class{root;queryParams;fragment;_queryParamMap;constructor(t=new Ti([],{}),i={},r=null){this.root=t,this.queryParams=i,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Np(this.queryParams),this._queryParamMap}toString(){return Y6.serialize(this)}},Ti=class{segments;children;parent=null;constructor(t,i){this.segments=t,this.children=i,Object.values(i).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ew(this)}},vu=class{path;parameters;_parameterMap;constructor(t,i){this.path=t,this.parameters=i}get parameterMap(){return this._parameterMap??=Np(this.parameters),this._parameterMap}toString(){return rU(this)}};function Q6(e,t){return bu(e,t)&&e.every((i,r)=>_l(i.parameters,t[r].parameters))}function bu(e,t){return e.length!==t.length?!1:e.every((i,r)=>i.path===t[r].path)}function K6(e,t){let i=[];return Object.entries(e.children).forEach(([r,s])=>{r===xt&&(i=i.concat(t(s,r)))}),Object.entries(e.children).forEach(([r,s])=>{r!==xt&&(i=i.concat(t(s,r)))}),i}var NR=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:()=>new K_,providedIn:"root"})}return e})(),K_=class{parse(t){let i=new mR(t);return new gc(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(t){let i=`/${q_(t.root,!0)}`,r=e$(t.queryParams),s=typeof t.fragment=="string"?`#${X6(t.fragment)}`:"";return`${i}${r}${s}`}},Y6=new K_;function Ew(e){return e.segments.map(t=>rU(t)).join("/")}function q_(e,t){if(!e.hasChildren())return Ew(e);if(t){let i=e.children[xt]?q_(e.children[xt],!1):"",r=[];return Object.entries(e.children).forEach(([s,n])=>{s!==xt&&r.push(`${s}:${q_(n,!1)}`)}),r.length>0?`${i}(${r.join("//")})`:i}else{let i=K6(e,(r,s)=>s===xt?[q_(e.children[xt],!1)]:[`${s}:${q_(r,!1)}`]);return Object.keys(e.children).length===1&&e.children[xt]!=null?`${Ew(e)}/${i[0]}`:`${Ew(e)}/(${i.join("//")})`}}function iU(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Sw(e){return iU(e).replace(/%3B/gi,";")}function X6(e){return encodeURI(e)}function uR(e){return iU(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Rw(e){return decodeURIComponent(e)}function G3(e){return Rw(e.replace(/\+/g,"%20"))}function rU(e){return`${uR(e.path)}${J6(e.parameters)}`}function J6(e){return Object.entries(e).map(([t,i])=>`;${uR(t)}=${uR(i)}`).join("")}function e$(e){let t=Object.entries(e).map(([i,r])=>Array.isArray(r)?r.map(s=>`${Sw(i)}=${Sw(s)}`).join("&"):`${Sw(i)}=${Sw(r)}`).filter(i=>i);return t.length?`?${t.join("&")}`:""}var t$=/^[^\/()?;#]+/;function oR(e){let t=e.match(t$);return t?t[0]:""}var i$=/^[^\/()?;=#]+/;function r$(e){let t=e.match(i$);return t?t[0]:""}var s$=/^[^=?&#]+/;function n$(e){let t=e.match(s$);return t?t[0]:""}var o$=/^[^&#]+/;function a$(e){let t=e.match(o$);return t?t[0]:""}var mR=class{url;remaining;constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Ti([],{}):new Ti([],this.parseChildren())}parseQueryParams(){let t={};if(this.consumeOptional("?"))do this.parseQueryParam(t);while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(i).length>0)&&(r[xt]=new Ti(t,i)),r}parseSegment(){let t=oR(this.remaining);if(t===""&&this.peekStartsWith(";"))throw new Gi(4009,!1);return this.capture(t),new vu(Rw(t),this.parseMatrixParams())}parseMatrixParams(){let t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){let i=r$(this.remaining);if(!i)return;this.capture(i);let r="";if(this.consumeOptional("=")){let s=oR(this.remaining);s&&(r=s,this.capture(r))}t[Rw(i)]=Rw(r)}parseQueryParam(t){let i=n$(this.remaining);if(!i)return;this.capture(i);let r="";if(this.consumeOptional("=")){let o=a$(this.remaining);o&&(r=o,this.capture(r))}let s=G3(i),n=G3(r);if(t.hasOwnProperty(s)){let o=t[s];Array.isArray(o)||(o=[o],t[s]=o),o.push(n)}else t[s]=n}parseParens(t){let i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=oR(this.remaining),s=this.remaining[r.length];if(s!=="/"&&s!==")"&&s!==";")throw new Gi(4010,!1);let n;r.indexOf(":")>-1?(n=r.slice(0,r.indexOf(":")),this.capture(n),this.capture(":")):t&&(n=xt);let o=this.parseChildren();i[n]=Object.keys(o).length===1?o[xt]:new Ti([],o),this.consumeOptional("//")}return i}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return this.peekStartsWith(t)?(this.remaining=this.remaining.substring(t.length),!0):!1}capture(t){if(!this.consumeOptional(t))throw new Gi(4011,!1)}};function sU(e){return e.segments.length>0?new Ti([],{[xt]:e}):e}function nU(e){let t={};for(let[r,s]of Object.entries(e.children)){let n=nU(s);if(r===xt&&n.segments.length===0&&n.hasChildren())for(let[o,a]of Object.entries(n.children))t[o]=a;else(n.segments.length>0||n.hasChildren())&&(t[r]=n)}let i=new Ti(e.segments,t);return l$(i)}function l$(e){if(e.numberOfChildren===1&&e.children[xt]){let t=e.children[xt];return new Ti(e.segments.concat(t.segments),t.children)}return e}function Y_(e){return e instanceof gc}function c$(e,t,i=null,r=null){let s=oU(e);return aU(s,t,i,r)}function oU(e){let t;function i(n){let o={};for(let l of n.children){let d=i(l);o[l.outlet]=d}let a=new Ti(n.url,o);return n===e&&(t=a),a}let r=i(e.root),s=sU(r);return t??s}function aU(e,t,i,r){let s=e;for(;s.parent;)s=s.parent;if(t.length===0)return aR(s,s,s,i,r);let n=d$(t);if(n.toRoot())return aR(s,s,new Ti([],{}),i,r);let o=h$(n,s,e),a=o.processChildren?$_(o.segmentGroup,o.index,n.commands):cU(o.segmentGroup,o.index,n.commands);return aR(s,o.segmentGroup,a,i,r)}function Aw(e){return typeof e=="object"&&e!=null&&!e.outlets&&!e.segmentPath}function X_(e){return typeof e=="object"&&e!=null&&e.outlets}function aR(e,t,i,r,s){let n={};r&&Object.entries(r).forEach(([l,d])=>{n[l]=Array.isArray(d)?d.map(u=>`${u}`):`${d}`});let o;e===t?o=i:o=lU(e,t,i);let a=sU(nU(o));return new gc(a,n,s)}function lU(e,t,i){let r={};return Object.entries(e.children).forEach(([s,n])=>{n===t?r[s]=i:r[s]=lU(n,t,i)}),new Ti(e.segments,r)}var Iw=class{isAbsolute;numberOfDoubleDots;commands;constructor(t,i,r){if(this.isAbsolute=t,this.numberOfDoubleDots=i,this.commands=r,t&&r.length>0&&Aw(r[0]))throw new Gi(4003,!1);let s=r.find(X_);if(s&&s!==Y3(r))throw new Gi(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function d$(e){if(typeof e[0]=="string"&&e.length===1&&e[0]==="/")return new Iw(!0,0,e);let t=0,i=!1,r=e.reduce((s,n,o)=>{if(typeof n=="object"&&n!=null){if(n.outlets){let a={};return Object.entries(n.outlets).forEach(([l,d])=>{a[l]=typeof d=="string"?d.split("/"):d}),[...s,{outlets:a}]}if(n.segmentPath)return[...s,n.segmentPath]}return typeof n!="string"?[...s,n]:o===0?(n.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?i=!0:a===".."?t++:a!=""&&s.push(a))}),s):[...s,n]},[]);return new Iw(i,t,r)}var kp=class{segmentGroup;processChildren;index;constructor(t,i,r){this.segmentGroup=t,this.processChildren=i,this.index=r}};function h$(e,t,i){if(e.isAbsolute)return new kp(t,!0,0);if(!i)return new kp(t,!1,NaN);if(i.parent===null)return new kp(i,!0,0);let r=Aw(e.commands[0])?0:1,s=i.segments.length-1+r;return u$(i,s,e.numberOfDoubleDots)}function u$(e,t,i){let r=e,s=t,n=i;for(;n>s;){if(n-=s,r=r.parent,!r)throw new Gi(4005,!1);s=r.segments.length}return new kp(r,!1,s-n)}function m$(e){return X_(e[0])?e[0].outlets:{[xt]:e}}function cU(e,t,i){if(e??=new Ti([],{}),e.segments.length===0&&e.hasChildren())return $_(e,t,i);let r=p$(e,t,i),s=i.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){let n=new Ti(e.segments.slice(0,r.pathIndex),{});return n.children[xt]=new Ti(e.segments.slice(r.pathIndex),e.children),$_(n,0,s)}else return r.match&&s.length===0?new Ti(e.segments,{}):r.match&&!e.hasChildren()?pR(e,t,i):r.match?$_(e,0,s):pR(e,t,i)}function $_(e,t,i){if(i.length===0)return new Ti(e.segments,{});{let r=m$(i),s={};if(Object.keys(r).some(n=>n!==xt)&&e.children[xt]&&e.numberOfChildren===1&&e.children[xt].segments.length===0){let n=$_(e.children[xt],t,i);return new Ti(e.segments,n.children)}return Object.entries(r).forEach(([n,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(s[n]=cU(e.children[n],t,o))}),Object.entries(e.children).forEach(([n,o])=>{r[n]===void 0&&(s[n]=o)}),new Ti(e.segments,s)}}function p$(e,t,i){let r=0,s=t,n={match:!1,pathIndex:0,commandIndex:0};for(;s<e.segments.length;){if(r>=i.length)return n;let o=e.segments[s],a=i[r];if(X_(a))break;let l=`${a}`,d=r<i.length-1?i[r+1]:null;if(s>0&&l===void 0)break;if(l&&d&&typeof d=="object"&&d.outlets===void 0){if(!W3(l,d,o))return n;r+=2}else{if(!W3(l,{},o))return n;r++}s++}return{match:!0,pathIndex:s,commandIndex:r}}function pR(e,t,i){let r=e.segments.slice(0,t),s=0;for(;s<i.length;){let n=i[s];if(X_(n)){let l=f$(n.outlets);return new Ti(r,l)}if(s===0&&Aw(i[0])){let l=e.segments[t];r.push(new vu(l.path,q3(i[0]))),s++;continue}let o=X_(n)?n.outlets[xt]:`${n}`,a=s<i.length-1?i[s+1]:null;o&&a&&Aw(a)?(r.push(new vu(o,q3(a))),s+=2):(r.push(new vu(o,{})),s++)}return new Ti(r,{})}function f$(e){let t={};return Object.entries(e).forEach(([i,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(t[i]=pR(new Ti([],{}),0,r))}),t}function q3(e){let t={};return Object.entries(e).forEach(([i,r])=>t[i]=`${r}`),t}function W3(e,t,i){return e==i.path&&_l(t,i.parameters)}var Z_="imperative",Ps=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(Ps||{}),ko=class{id;url;constructor(t,i){this.id=t,this.url=i}},J_=class extends ko{type=Ps.NavigationStart;navigationTrigger;restoredState;constructor(t,i,r="imperative",s=null){super(t,i),this.navigationTrigger=r,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},wu=class extends ko{urlAfterRedirects;type=Ps.NavigationEnd;constructor(t,i,r){super(t,i),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Xn=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(Xn||{}),fR=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(fR||{}),fc=class extends ko{reason;code;type=Ps.NavigationCancel;constructor(t,i,r,s){super(t,i),this.reason=r,this.code=s}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},xu=class extends ko{reason;code;type=Ps.NavigationSkipped;constructor(t,i,r,s){super(t,i),this.reason=r,this.code=s}},ey=class extends ko{error;target;type=Ps.NavigationError;constructor(t,i,r,s){super(t,i),this.error=r,this.target=s}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Dw=class extends ko{urlAfterRedirects;state;type=Ps.RoutesRecognized;constructor(t,i,r,s){super(t,i),this.urlAfterRedirects=r,this.state=s}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},gR=class extends ko{urlAfterRedirects;state;type=Ps.GuardsCheckStart;constructor(t,i,r,s){super(t,i),this.urlAfterRedirects=r,this.state=s}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},_R=class extends ko{urlAfterRedirects;state;shouldActivate;type=Ps.GuardsCheckEnd;constructor(t,i,r,s,n){super(t,i),this.urlAfterRedirects=r,this.state=s,this.shouldActivate=n}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},yR=class extends ko{urlAfterRedirects;state;type=Ps.ResolveStart;constructor(t,i,r,s){super(t,i),this.urlAfterRedirects=r,this.state=s}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},vR=class extends ko{urlAfterRedirects;state;type=Ps.ResolveEnd;constructor(t,i,r,s){super(t,i),this.urlAfterRedirects=r,this.state=s}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},bR=class{route;type=Ps.RouteConfigLoadStart;constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},wR=class{route;type=Ps.RouteConfigLoadEnd;constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},xR=class{snapshot;type=Ps.ChildActivationStart;constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},CR=class{snapshot;type=Ps.ChildActivationEnd;constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},SR=class{snapshot;type=Ps.ActivationStart;constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},TR=class{snapshot;type=Ps.ActivationEnd;constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var ty=class{},Vp=class{url;navigationBehaviorOptions;constructor(t,i){this.url=t,this.navigationBehaviorOptions=i}};function g$(e,t){return e.providers&&!e._injector&&(e._injector=yk(e.providers,t,`Route: ${e.path}`)),e._injector??t}function Ta(e){return e.outlet||xt}function _$(e,t){let i=e.filter(r=>Ta(r)===t);return i.push(...e.filter(r=>Ta(r)!==t)),i}function ay(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){let i=t.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}var MR=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return ay(this.route?.snapshot)??this.rootInjector}constructor(t){this.rootInjector=t,this.children=new Vw(this.rootInjector)}},Vw=(()=>{class e{rootInjector;contexts=new Map;constructor(i){this.rootInjector=i}onChildOutletCreated(i,r){let s=this.getOrCreateContext(i);s.outlet=r,this.contexts.set(i,s)}onChildOutletDestroyed(i){let r=this.getContext(i);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let i=this.contexts;return this.contexts=new Map,i}onOutletReAttached(i){this.contexts=i}getOrCreateContext(i){let r=this.getContext(i);return r||(r=new MR(this.rootInjector),this.contexts.set(i,r)),r}getContext(i){return this.contexts.get(i)||null}static \u0275fac=function(r){return new(r||e)(jt(Kl))};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Pw=class{_root;constructor(t){this._root=t}get root(){return this._root.value}parent(t){let i=this.pathFromRoot(t);return i.length>1?i[i.length-2]:null}children(t){let i=ER(t,this._root);return i?i.children.map(r=>r.value):[]}firstChild(t){let i=ER(t,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(t){let i=RR(t,this._root);return i.length<2?[]:i[i.length-2].children.map(s=>s.value).filter(s=>s!==t)}pathFromRoot(t){return RR(t,this._root).map(i=>i.value)}};function ER(e,t){if(e===t.value)return t;for(let i of t.children){let r=ER(e,i);if(r)return r}return null}function RR(e,t){if(e===t.value)return[t];for(let i of t.children){let r=RR(e,i);if(r.length)return r.unshift(t),r}return[]}var Yn=class{value;children;constructor(t,i){this.value=t,this.children=i}toString(){return`TreeNode(${this.value})`}};function Op(e){let t={};return e&&e.children.forEach(i=>t[i.value.outlet]=i),t}var Ow=class extends Pw{snapshot;constructor(t,i){super(t),this.snapshot=i,VR(this,t)}toString(){return this.snapshot.toString()}};function dU(e){let t=y$(e),i=new Pr([new vu("",{})]),r=new Pr({}),s=new Pr({}),n=new Pr({}),o=new Pr(""),a=new Bp(i,r,n,o,s,xt,e,t.root);return a.snapshot=t.root,new Ow(new Yn(a,[]),t)}function y$(e){let t={},i={},r={},s="",n=new Lp([],t,r,s,i,xt,e,null,{});return new Lw("",new Yn(n,[]))}var Bp=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(t,i,r,s,n,o,a,l){this.urlSubject=t,this.paramsSubject=i,this.queryParamsSubject=r,this.fragmentSubject=s,this.dataSubject=n,this.outlet=o,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(rt(d=>d[oy]))??Ue(void 0),this.url=t,this.params=i,this.queryParams=r,this.fragment=s,this.data=n}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(rt(t=>Np(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(rt(t=>Np(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function kw(e,t,i="emptyOnly"){let r,{routeConfig:s}=e;return t!==null&&(i==="always"||s?.path===""||!t.component&&!t.routeConfig?.loadComponent)?r={params:I(I({},t.params),e.params),data:I(I({},t.data),e.data),resolve:I(I(I(I({},e.data),t.data),s?.data),e._resolvedData)}:r={params:I({},e.params),data:I({},e.data),resolve:I(I({},e.data),e._resolvedData??{})},s&&uU(s)&&(r.resolve[oy]=s.title),r}var Lp=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[oy]}constructor(t,i,r,s,n,o,a,l,d){this.url=t,this.params=i,this.queryParams=r,this.fragment=s,this.data=n,this.outlet=o,this.component=a,this.routeConfig=l,this._resolve=d}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Np(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Np(this.queryParams),this._queryParamMap}toString(){let t=this.url.map(r=>r.toString()).join("/"),i=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${t}', path:'${i}')`}},Lw=class extends Pw{url;constructor(t,i){super(i),this.url=t,VR(this,i)}toString(){return hU(this._root)}};function VR(e,t){t.value._routerState=e,t.children.forEach(i=>VR(e,i))}function hU(e){let t=e.children.length>0?` { ${e.children.map(hU).join(", ")} } `:"";return`${e.value}${t}`}function lR(e){if(e.snapshot){let t=e.snapshot,i=e._futureSnapshot;e.snapshot=i,_l(t.queryParams,i.queryParams)||e.queryParamsSubject.next(i.queryParams),t.fragment!==i.fragment&&e.fragmentSubject.next(i.fragment),_l(t.params,i.params)||e.paramsSubject.next(i.params),q6(t.url,i.url)||e.urlSubject.next(i.url),_l(t.data,i.data)||e.dataSubject.next(i.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function AR(e,t){let i=_l(e.params,t.params)&&Q6(e.url,t.url),r=!e.parent!=!t.parent;return i&&!r&&(!e.parent||AR(e.parent,t.parent))}function uU(e){return typeof e.title=="string"||e.title===null}var v$=new He(""),b$=(()=>{class e{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=xt;activateEvents=new yi;deactivateEvents=new yi;attachEvents=new yi;detachEvents=new yi;routerOutletData=sk(void 0);parentContexts=M(Vw);location=M(Am);changeDetector=M(ls);inputBinder=M(BR,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(i){if(i.name){let{firstChange:r,previousValue:s}=i.name;if(r)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(i){return this.parentContexts.getContext(i)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let i=this.parentContexts.getContext(this.name);i?.route&&(i.attachRef?this.attach(i.attachRef,i.route):this.activateWith(i.route,i.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Gi(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Gi(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Gi(4012,!1);this.location.detach();let i=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(i.instance),i}attach(i,r){this.activated=i,this._activatedRoute=r,this.location.insert(i.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(i.instance)}deactivate(){if(this.activated){let i=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(i)}}activateWith(i,r){if(this.isActivated)throw new Gi(4013,!1);this._activatedRoute=i;let s=this.location,o=i.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new IR(i,a,s.injector,this.routerOutletData);this.activated=s.createComponent(o,{index:s.length,injector:l,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Gh]})}return e})(),IR=class e{route;childContexts;parent;outletData;__ngOutletInjector(t){return new e(this.route,this.childContexts,t,this.outletData)}constructor(t,i,r,s){this.route=t,this.childContexts=i,this.parent=r,this.outletData=s}get(t,i){return t===Bp?this.route:t===Vw?this.childContexts:t===v$?this.outletData:this.parent.get(t,i)}},BR=new He("");function w$(e,t,i){let r=iy(e,t._root,i?i._root:void 0);return new Ow(r,t)}function iy(e,t,i){if(i&&e.shouldReuseRoute(t.value,i.value.snapshot)){let r=i.value;r._futureSnapshot=t.value;let s=x$(e,t,i);return new Yn(r,s)}else{if(e.shouldAttach(t.value)){let n=e.retrieve(t.value);if(n!==null){let o=n.route;return o.value._futureSnapshot=t.value,o.children=t.children.map(a=>iy(e,a)),o}}let r=C$(t.value),s=t.children.map(n=>iy(e,n));return new Yn(r,s)}}function x$(e,t,i){return t.children.map(r=>{for(let s of i.children)if(e.shouldReuseRoute(r.value,s.value.snapshot))return iy(e,r,s);return iy(e,r)})}function C$(e){return new Bp(new Pr(e.url),new Pr(e.params),new Pr(e.queryParams),new Pr(e.fragment),new Pr(e.data),e.outlet,e.component,e)}var ry=class{redirectTo;navigationBehaviorOptions;constructor(t,i){this.redirectTo=t,this.navigationBehaviorOptions=i}},mU="ngNavigationCancelingError";function Fw(e,t){let{redirectTo:i,navigationBehaviorOptions:r}=Y_(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,s=pU(!1,Xn.Redirect);return s.url=i,s.navigationBehaviorOptions=r,s}function pU(e,t){let i=new Error(`NavigationCancelingError: ${e||""}`);return i[mU]=!0,i.cancellationCode=t,i}function S$(e){return fU(e)&&Y_(e.url)}function fU(e){return!!e&&e[mU]}var T$=(e,t,i,r)=>rt(s=>(new DR(t,s.targetRouterState,s.currentRouterState,i,r).activate(e),s)),DR=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(t,i,r,s,n){this.routeReuseStrategy=t,this.futureState=i,this.currState=r,this.forwardEvent=s,this.inputBindingEnabled=n}activate(t){let i=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,r,t),lR(this.futureState.root),this.activateChildRoutes(i,r,t)}deactivateChildRoutes(t,i,r){let s=Op(i);t.children.forEach(n=>{let o=n.value.outlet;this.deactivateRoutes(n,s[o],r),delete s[o]}),Object.values(s).forEach(n=>{this.deactivateRouteAndItsChildren(n,r)})}deactivateRoutes(t,i,r){let s=t.value,n=i?i.value:null;if(s===n)if(s.component){let o=r.getContext(s.outlet);o&&this.deactivateChildRoutes(t,i,o.children)}else this.deactivateChildRoutes(t,i,r);else n&&this.deactivateRouteAndItsChildren(i,r)}deactivateRouteAndItsChildren(t,i){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,i):this.deactivateRouteAndOutlet(t,i)}detachAndStoreRouteSubtree(t,i){let r=i.getContext(t.value.outlet),s=r&&t.value.component?r.children:i,n=Op(t);for(let o of Object.values(n))this.deactivateRouteAndItsChildren(o,s);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:o,route:t,contexts:a})}}deactivateRouteAndOutlet(t,i){let r=i.getContext(t.value.outlet),s=r&&t.value.component?r.children:i,n=Op(t);for(let o of Object.values(n))this.deactivateRouteAndItsChildren(o,s);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(t,i,r){let s=Op(i);t.children.forEach(n=>{this.activateRoutes(n,s[n.value.outlet],r),this.forwardEvent(new TR(n.value.snapshot))}),t.children.length&&this.forwardEvent(new CR(t.value.snapshot))}activateRoutes(t,i,r){let s=t.value,n=i?i.value:null;if(lR(s),s===n)if(s.component){let o=r.getOrCreateContext(s.outlet);this.activateChildRoutes(t,i,o.children)}else this.activateChildRoutes(t,i,r);else if(s.component){let o=r.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){let a=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),lR(a.route.value),this.activateChildRoutes(t,null,o.children)}else o.attachRef=null,o.route=s,o.outlet&&o.outlet.activateWith(s,o.injector),this.activateChildRoutes(t,null,o.children)}else this.activateChildRoutes(t,null,r)}},Nw=class{path;route;constructor(t){this.path=t,this.route=this.path[this.path.length-1]}},Fp=class{component;route;constructor(t,i){this.component=t,this.route=i}};function M$(e,t,i){let r=e._root,s=t?t._root:null;return W_(r,s,i,[r.value])}function E$(e){let t=e.routeConfig?e.routeConfig.canActivateChild:null;return!t||t.length===0?null:{node:e,guards:t}}function Up(e,t){let i=Symbol(),r=t.get(e,i);return r===i?typeof e=="function"&&!tk(e)?e:t.get(e):r}function W_(e,t,i,r,s={canDeactivateChecks:[],canActivateChecks:[]}){let n=Op(t);return e.children.forEach(o=>{R$(o,n[o.value.outlet],i,r.concat([o.value]),s),delete n[o.value.outlet]}),Object.entries(n).forEach(([o,a])=>Q_(a,i.getContext(o),s)),s}function R$(e,t,i,r,s={canDeactivateChecks:[],canActivateChecks:[]}){let n=e.value,o=t?t.value:null,a=i?i.getContext(e.value.outlet):null;if(o&&n.routeConfig===o.routeConfig){let l=A$(o,n,n.routeConfig.runGuardsAndResolvers);l?s.canActivateChecks.push(new Nw(r)):(n.data=o.data,n._resolvedData=o._resolvedData),n.component?W_(e,t,a?a.children:null,r,s):W_(e,t,i,r,s),l&&a&&a.outlet&&a.outlet.isActivated&&s.canDeactivateChecks.push(new Fp(a.outlet.component,o))}else o&&Q_(t,a,s),s.canActivateChecks.push(new Nw(r)),n.component?W_(e,null,a?a.children:null,r,s):W_(e,null,i,r,s);return s}function A$(e,t,i){if(typeof i=="function")return i(e,t);switch(i){case"pathParamsChange":return!bu(e.url,t.url);case"pathParamsOrQueryParamsChange":return!bu(e.url,t.url)||!_l(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!AR(e,t)||!_l(e.queryParams,t.queryParams);case"paramsChange":default:return!AR(e,t)}}function Q_(e,t,i){let r=Op(e),s=e.value;Object.entries(r).forEach(([n,o])=>{s.component?t?Q_(o,t.children.getContext(n),i):Q_(o,null,i):Q_(o,t,i)}),s.component?t&&t.outlet&&t.outlet.isActivated?i.canDeactivateChecks.push(new Fp(t.outlet.component,s)):i.canDeactivateChecks.push(new Fp(null,s)):i.canDeactivateChecks.push(new Fp(null,s))}function ly(e){return typeof e=="function"}function I$(e){return typeof e=="boolean"}function D$(e){return e&&ly(e.canLoad)}function P$(e){return e&&ly(e.canActivate)}function O$(e){return e&&ly(e.canActivateChild)}function k$(e){return e&&ly(e.canDeactivate)}function L$(e){return e&&ly(e.canMatch)}function gU(e){return e instanceof QO||e?.name==="EmptyError"}var Tw=Symbol("INITIAL_VALUE");function zp(){return Tn(e=>Bg(e.map(t=>t.pipe(Es(1),dn(Tw)))).pipe(rt(t=>{for(let i of t)if(i!==!0){if(i===Tw)return Tw;if(i===!1||F$(i))return i}return!0}),zi(t=>t!==Tw),Es(1)))}function F$(e){return Y_(e)||e instanceof ry}function N$(e,t){return go(i=>{let{targetSnapshot:r,currentSnapshot:s,guards:{canActivateChecks:n,canDeactivateChecks:o}}=i;return o.length===0&&n.length===0?Ue(se(I({},i),{guardsResult:!0})):V$(o,r,s,e).pipe(go(a=>a&&I$(a)?B$(r,n,e,t):Ue(a)),rt(a=>se(I({},i),{guardsResult:a})))})}function V$(e,t,i,r){return fo(e).pipe(go(s=>G$(s.component,s.route,i,t,r)),Jc(s=>s!==!0,!0))}function B$(e,t,i,r){return fo(t).pipe(Uh(s=>fb(U$(s.route.parent,r),z$(s.route,r),j$(e,s.path,i),H$(e,s.route,i))),Jc(s=>s!==!0,!0))}function z$(e,t){return e!==null&&t&&t(new SR(e)),Ue(!0)}function U$(e,t){return e!==null&&t&&t(new xR(e)),Ue(!0)}function H$(e,t,i){let r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||r.length===0)return Ue(!0);let s=r.map(n=>zg(()=>{let o=ay(t)??i,a=Up(n,o),l=P$(a)?a.canActivate(t,e):ja(o,()=>a(t,e));return kd(l).pipe(Jc())}));return Ue(s).pipe(zp())}function j$(e,t,i){let r=t[t.length-1],n=t.slice(0,t.length-1).reverse().map(o=>E$(o)).filter(o=>o!==null).map(o=>zg(()=>{let a=o.guards.map(l=>{let d=ay(o.node)??i,u=Up(l,d),m=O$(u)?u.canActivateChild(r,e):ja(d,()=>u(r,e));return kd(m).pipe(Jc())});return Ue(a).pipe(zp())}));return Ue(n).pipe(zp())}function G$(e,t,i,r,s){let n=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!n||n.length===0)return Ue(!0);let o=n.map(a=>{let l=ay(t)??s,d=Up(a,l),u=k$(d)?d.canDeactivate(e,t,i,r):ja(l,()=>d(e,t,i,r));return kd(u).pipe(Jc())});return Ue(o).pipe(zp())}function q$(e,t,i,r){let s=t.canLoad;if(s===void 0||s.length===0)return Ue(!0);let n=s.map(o=>{let a=Up(o,e),l=D$(a)?a.canLoad(t,i):ja(e,()=>a(t,i));return kd(l)});return Ue(n).pipe(zp(),_U(r))}function _U(e){return ZO(fr(t=>{if(typeof t!="boolean")throw Fw(e,t)}),rt(t=>t===!0))}function W$(e,t,i,r){let s=t.canMatch;if(!s||s.length===0)return Ue(!0);let n=s.map(o=>{let a=Up(o,e),l=L$(a)?a.canMatch(t,i):ja(e,()=>a(t,i));return kd(l)});return Ue(n).pipe(zp(),_U(r))}var sy=class{segmentGroup;constructor(t){this.segmentGroup=t||null}},ny=class extends Error{urlTree;constructor(t){super(),this.urlTree=t}};function Pp(e){return zh(new sy(e))}function $$(e){return zh(new Gi(4e3,!1))}function Z$(e){return zh(pU(!1,Xn.GuardRejected))}var PR=class{urlSerializer;urlTree;constructor(t,i){this.urlSerializer=t,this.urlTree=i}lineralizeSegments(t,i){let r=[],s=i.root;for(;;){if(r=r.concat(s.segments),s.numberOfChildren===0)return Ue(r);if(s.numberOfChildren>1||!s.children[xt])return $$(`${t.redirectTo}`);s=s.children[xt]}}applyRedirectCommands(t,i,r,s,n){if(typeof i!="string"){let a=i,{queryParams:l,fragment:d,routeConfig:u,url:m,outlet:p,params:f,data:g,title:_}=s,y=ja(n,()=>a({params:f,data:g,queryParams:l,fragment:d,routeConfig:u,url:m,outlet:p,title:_}));if(y instanceof gc)throw new ny(y);i=y}let o=this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),t,r);if(i[0]==="/")throw new ny(o);return o}applyRedirectCreateUrlTree(t,i,r,s){let n=this.createSegmentGroup(t,i.root,r,s);return new gc(n,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(t,i){let r={};return Object.entries(t).forEach(([s,n])=>{if(typeof n=="string"&&n[0]===":"){let a=n.substring(1);r[s]=i[a]}else r[s]=n}),r}createSegmentGroup(t,i,r,s){let n=this.createSegments(t,i.segments,r,s),o={};return Object.entries(i.children).forEach(([a,l])=>{o[a]=this.createSegmentGroup(t,l,r,s)}),new Ti(n,o)}createSegments(t,i,r,s){return i.map(n=>n.path[0]===":"?this.findPosParam(t,n,s):this.findOrReturn(n,r))}findPosParam(t,i,r){let s=r[i.path.substring(1)];if(!s)throw new Gi(4001,!1);return s}findOrReturn(t,i){let r=0;for(let s of i){if(s.path===t.path)return i.splice(r),s;r++}return t}},OR={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Q$(e,t,i,r,s){let n=yU(e,t,i);return n.matched?(r=g$(t,r),W$(r,t,i,s).pipe(rt(o=>o===!0?n:I({},OR)))):Ue(n)}function yU(e,t,i){if(t.path==="**")return K$(i);if(t.path==="")return t.pathMatch==="full"&&(e.hasChildren()||i.length>0)?I({},OR):{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};let s=(t.matcher||G6)(i,e,t);if(!s)return I({},OR);let n={};Object.entries(s.posParams??{}).forEach(([a,l])=>{n[a]=l.path});let o=s.consumed.length>0?I(I({},n),s.consumed[s.consumed.length-1].parameters):n;return{matched:!0,consumedSegments:s.consumed,remainingSegments:i.slice(s.consumed.length),parameters:o,positionalParamSegments:s.posParams??{}}}function K$(e){return{matched:!0,parameters:e.length>0?Y3(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}function $3(e,t,i,r){return i.length>0&&J$(e,i,r)?{segmentGroup:new Ti(t,X$(r,new Ti(i,e.children))),slicedSegments:[]}:i.length===0&&e7(e,i,r)?{segmentGroup:new Ti(e.segments,Y$(e,i,r,e.children)),slicedSegments:i}:{segmentGroup:new Ti(e.segments,e.children),slicedSegments:i}}function Y$(e,t,i,r){let s={};for(let n of i)if(Bw(e,t,n)&&!r[Ta(n)]){let o=new Ti([],{});s[Ta(n)]=o}return I(I({},r),s)}function X$(e,t){let i={};i[xt]=t;for(let r of e)if(r.path===""&&Ta(r)!==xt){let s=new Ti([],{});i[Ta(r)]=s}return i}function J$(e,t,i){return i.some(r=>Bw(e,t,r)&&Ta(r)!==xt)}function e7(e,t,i){return i.some(r=>Bw(e,t,r))}function Bw(e,t,i){return(e.hasChildren()||t.length>0)&&i.pathMatch==="full"?!1:i.path===""}function t7(e,t,i){return t.length===0&&!e.children[i]}var kR=class{};function i7(e,t,i,r,s,n,o="emptyOnly"){return new LR(e,t,i,r,s,o,n).recognize()}var r7=31,LR=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(t,i,r,s,n,o,a){this.injector=t,this.configLoader=i,this.rootComponentType=r,this.config=s,this.urlTree=n,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new PR(this.urlSerializer,this.urlTree)}noMatchError(t){return new Gi(4002,`'${t.segmentGroup}'`)}recognize(){let t=$3(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(rt(({children:i,rootSnapshot:r})=>{let s=new Yn(r,i),n=new Lw("",s),o=c$(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,n.url=this.urlSerializer.serialize(o),{state:n,tree:o}}))}match(t){let i=new Lp([],Object.freeze({}),Object.freeze(I({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),xt,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,t,xt,i).pipe(rt(r=>({children:r,rootSnapshot:i})),Yc(r=>{if(r instanceof ny)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof sy?this.noMatchError(r):r}))}processSegmentGroup(t,i,r,s,n){return r.segments.length===0&&r.hasChildren()?this.processChildren(t,i,r,n):this.processSegment(t,i,r,r.segments,s,!0,n).pipe(rt(o=>o instanceof Yn?[o]:[]))}processChildren(t,i,r,s){let n=[];for(let o of Object.keys(r.children))o==="primary"?n.unshift(o):n.push(o);return fo(n).pipe(Uh(o=>{let a=r.children[o],l=_$(i,o);return this.processSegmentGroup(t,l,a,o,s)}),JO((o,a)=>(o.push(...a),o)),K1(null),XO(),go(o=>{if(o===null)return Pp(r);let a=vU(o);return s7(a),Ue(a)}))}processSegment(t,i,r,s,n,o,a){return fo(i).pipe(Uh(l=>this.processSegmentAgainstRoute(l._injector??t,i,l,r,s,n,o,a).pipe(Yc(d=>{if(d instanceof sy)return Ue(null);throw d}))),Jc(l=>!!l),Yc(l=>{if(gU(l))return t7(r,s,n)?Ue(new kR):Pp(r);throw l}))}processSegmentAgainstRoute(t,i,r,s,n,o,a,l){return Ta(r)!==o&&(o===xt||!Bw(s,n,r))?Pp(s):r.redirectTo===void 0?this.matchSegmentAgainstRoute(t,s,r,n,o,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(t,s,i,r,n,o,l):Pp(s)}expandSegmentAgainstRouteUsingRedirect(t,i,r,s,n,o,a){let{matched:l,parameters:d,consumedSegments:u,positionalParamSegments:m,remainingSegments:p}=yU(i,s,n);if(!l)return Pp(i);typeof s.redirectTo=="string"&&s.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>r7&&(this.allowRedirects=!1));let f=new Lp(n,d,Object.freeze(I({},this.urlTree.queryParams)),this.urlTree.fragment,Z3(s),Ta(s),s.component??s._loadedComponent??null,s,Q3(s)),g=kw(f,a,this.paramsInheritanceStrategy);f.params=Object.freeze(g.params),f.data=Object.freeze(g.data);let _=this.applyRedirects.applyRedirectCommands(u,s.redirectTo,m,f,t);return this.applyRedirects.lineralizeSegments(s,_).pipe(go(y=>this.processSegment(t,r,i,y.concat(p),o,!1,a)))}matchSegmentAgainstRoute(t,i,r,s,n,o){let a=Q$(i,r,s,t,this.urlSerializer);return r.path==="**"&&(i.children={}),a.pipe(Tn(l=>l.matched?(t=r._injector??t,this.getChildConfig(t,r,s).pipe(Tn(({routes:d})=>{let u=r._loadedInjector??t,{parameters:m,consumedSegments:p,remainingSegments:f}=l,g=new Lp(p,m,Object.freeze(I({},this.urlTree.queryParams)),this.urlTree.fragment,Z3(r),Ta(r),r.component??r._loadedComponent??null,r,Q3(r)),_=kw(g,o,this.paramsInheritanceStrategy);g.params=Object.freeze(_.params),g.data=Object.freeze(_.data);let{segmentGroup:y,slicedSegments:v}=$3(i,p,f,d);if(v.length===0&&y.hasChildren())return this.processChildren(u,d,y,g).pipe(rt(S=>new Yn(g,S)));if(d.length===0&&v.length===0)return Ue(new Yn(g,[]));let x=Ta(r)===n;return this.processSegment(u,d,y,v,x?xt:n,!0,g).pipe(rt(S=>new Yn(g,S instanceof Yn?[S]:[])))}))):Pp(i)))}getChildConfig(t,i,r){return i.children?Ue({routes:i.children,injector:t}):i.loadChildren?i._loadedRoutes!==void 0?Ue({routes:i._loadedRoutes,injector:i._loadedInjector}):q$(t,i,r,this.urlSerializer).pipe(go(s=>s?this.configLoader.loadChildren(t,i).pipe(fr(n=>{i._loadedRoutes=n.routes,i._loadedInjector=n.injector})):Z$(i))):Ue({routes:[],injector:t})}};function s7(e){e.sort((t,i)=>t.value.outlet===xt?-1:i.value.outlet===xt?1:t.value.outlet.localeCompare(i.value.outlet))}function n7(e){let t=e.value.routeConfig;return t&&t.path===""}function vU(e){let t=[],i=new Set;for(let r of e){if(!n7(r)){t.push(r);continue}let s=t.find(n=>r.value.routeConfig===n.value.routeConfig);s!==void 0?(s.children.push(...r.children),i.add(s)):t.push(r)}for(let r of i){let s=vU(r.children);t.push(new Yn(r.value,s))}return t.filter(r=>!i.has(r))}function Z3(e){return e.data||{}}function Q3(e){return e.resolve||{}}function o7(e,t,i,r,s,n){return go(o=>i7(e,t,i,r,o.extractedUrl,s,n).pipe(rt(({state:a,tree:l})=>se(I({},o),{targetSnapshot:a,urlAfterRedirects:l}))))}function a7(e,t){return go(i=>{let{targetSnapshot:r,guards:{canActivateChecks:s}}=i;if(!s.length)return Ue(i);let n=new Set(s.map(l=>l.route)),o=new Set;for(let l of n)if(!o.has(l))for(let d of bU(l))o.add(d);let a=0;return fo(o).pipe(Uh(l=>n.has(l)?l7(l,r,e,t):(l.data=kw(l,l.parent,e).resolve,Ue(void 0))),fr(()=>a++),J1(1),go(l=>a===o.size?Ue(i):Kc))})}function bU(e){let t=e.children.map(i=>bU(i)).flat();return[e,...t]}function l7(e,t,i,r){let s=e.routeConfig,n=e._resolve;return s?.title!==void 0&&!uU(s)&&(n[oy]=s.title),c7(n,e,t,r).pipe(rt(o=>(e._resolvedData=o,e.data=kw(e,e.parent,i).resolve,null)))}function c7(e,t,i,r){let s=hR(e);if(s.length===0)return Ue({});let n={};return fo(s).pipe(go(o=>d7(e[o],t,i,r).pipe(Jc(),fr(a=>{if(a instanceof ry)throw Fw(new K_,a);n[o]=a}))),J1(1),rt(()=>n),Yc(o=>gU(o)?Kc:zh(o)))}function d7(e,t,i,r){let s=ay(t)??r,n=Up(e,s),o=n.resolve?n.resolve(t,i):ja(s,()=>n(t,i));return kd(o)}function cR(e){return Tn(t=>{let i=e(t);return i?fo(i).pipe(rt(()=>t)):Ue(t)})}var wU=(()=>{class e{buildTitle(i){let r,s=i.root;for(;s!==void 0;)r=this.getResolvedTitleForRoute(s)??r,s=s.children.find(n=>n.outlet===xt);return r}getResolvedTitleForRoute(i){return i.data[oy]}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:()=>M(h7),providedIn:"root"})}return e})(),h7=(()=>{class e extends wU{title;constructor(i){super(),this.title=i}updateTitle(i){let r=this.buildTitle(i);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||e)(jt(U3))};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),zR=new He("",{providedIn:"root",factory:()=>({})}),u7=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,s){r&1&&pi(0,"router-outlet")},dependencies:[b$],encapsulation:2})}return e})();function UR(e){let t=e.children&&e.children.map(UR),i=t?se(I({},e),{children:t}):I({},e);return!i.component&&!i.loadComponent&&(t||i.loadChildren)&&i.outlet&&i.outlet!==xt&&(i.component=u7),i}var HR=new He(""),m7=(()=>{class e{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=M(mM);loadComponent(i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return Ue(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);let r=kd(i.loadComponent()).pipe(rt(xU),fr(n=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=n}),Hh(()=>{this.componentLoaders.delete(i)})),s=new pb(r,()=>new $e).pipe(Z1());return this.componentLoaders.set(i,s),s}loadChildren(i,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Ue({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let n=p7(r,this.compiler,i,this.onLoadEndListener).pipe(Hh(()=>{this.childrenLoaders.delete(r)})),o=new pb(n,()=>new $e).pipe(Z1());return this.childrenLoaders.set(r,o),o}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function p7(e,t,i,r){return kd(e.loadChildren()).pipe(rt(xU),go(s=>s instanceof _k||Array.isArray(s)?Ue(s):fo(t.compileModuleAsync(s))),rt(s=>{r&&r(e);let n,o,a=!1;return Array.isArray(s)?(o=s,a=!0):(n=s.create(i).injector,o=n.get(HR,[],{optional:!0,self:!0}).flat()),{routes:o.map(UR),injector:n}}))}function f7(e){return e&&typeof e=="object"&&"default"in e}function xU(e){return f7(e)?e.default:e}var jR=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:()=>M(g7),providedIn:"root"})}return e})(),g7=(()=>{class e{shouldProcessUrl(i){return!0}extract(i){return i}merge(i,r){return i}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),_7=new He("");var y7=new He(""),v7=(()=>{class e{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new $e;transitionAbortSubject=new $e;configLoader=M(m7);environmentInjector=M(Kl);urlSerializer=M(NR);rootContexts=M(Vw);location=M(Dm);inputBindingEnabled=M(BR,{optional:!0})!==null;titleStrategy=M(wU);options=M(zR,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=M(jR);createViewTransition=M(_7,{optional:!0});navigationErrorHandler=M(y7,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Ue(void 0);rootComponentType=null;constructor(){let i=s=>this.events.next(new bR(s)),r=s=>this.events.next(new wR(s));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=i}complete(){this.transitions?.complete()}handleNavigationRequest(i){let r=++this.navigationId;this.transitions?.next(se(I(I({},this.transitions.value),i),{id:r}))}setupNavigations(i,r,s){return this.transitions=new Pr({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Z_,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(zi(n=>n.id!==0),rt(n=>se(I({},n),{extractedUrl:this.urlHandlingStrategy.extract(n.rawUrl)})),Tn(n=>{let o=!1,a=!1;return Ue(n).pipe(Tn(l=>{if(this.navigationId>n.id)return this.cancelNavigationTransition(n,"",Xn.SupersededByNewNavigation),Kc;this.currentTransition=n,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?se(I({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let d=!i.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=l.extras.onSameUrlNavigation??i.onSameUrlNavigation;if(!d&&u!=="reload"){let m="";return this.events.next(new xu(l.id,this.urlSerializer.serialize(l.rawUrl),m,fR.IgnoredSameUrlNavigation)),l.resolve(!1),Kc}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return Ue(l).pipe(Tn(m=>{let p=this.transitions?.getValue();return this.events.next(new J_(m.id,this.urlSerializer.serialize(m.extractedUrl),m.source,m.restoredState)),p!==this.transitions?.getValue()?Kc:Promise.resolve(m)}),o7(this.environmentInjector,this.configLoader,this.rootComponentType,i.config,this.urlSerializer,this.paramsInheritanceStrategy),fr(m=>{n.targetSnapshot=m.targetSnapshot,n.urlAfterRedirects=m.urlAfterRedirects,this.currentNavigation=se(I({},this.currentNavigation),{finalUrl:m.urlAfterRedirects});let p=new Dw(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(p)}));if(d&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:m,extractedUrl:p,source:f,restoredState:g,extras:_}=l,y=new J_(m,this.urlSerializer.serialize(p),f,g);this.events.next(y);let v=dU(this.rootComponentType).snapshot;return this.currentTransition=n=se(I({},l),{targetSnapshot:v,urlAfterRedirects:p,extras:se(I({},_),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=p,Ue(n)}else{let m="";return this.events.next(new xu(l.id,this.urlSerializer.serialize(l.extractedUrl),m,fR.IgnoredByUrlHandlingStrategy)),l.resolve(!1),Kc}}),fr(l=>{let d=new gR(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(d)}),rt(l=>(this.currentTransition=n=se(I({},l),{guards:M$(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),n)),N$(this.environmentInjector,l=>this.events.next(l)),fr(l=>{if(n.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw Fw(this.urlSerializer,l.guardsResult);let d=new _R(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(d)}),zi(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",Xn.GuardRejected),!1)),cR(l=>{if(l.guards.canActivateChecks.length)return Ue(l).pipe(fr(d=>{let u=new yR(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(u)}),Tn(d=>{let u=!1;return Ue(d).pipe(a7(this.paramsInheritanceStrategy,this.environmentInjector),fr({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(d,"",Xn.NoDataFromResolver)}}))}),fr(d=>{let u=new vR(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(u)}))}),cR(l=>{let d=u=>{let m=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&m.push(this.configLoader.loadComponent(u.routeConfig).pipe(fr(p=>{u.component=p}),rt(()=>{})));for(let p of u.children)m.push(...d(p));return m};return Bg(d(l.targetSnapshot.root)).pipe(K1(null),Es(1))}),cR(()=>this.afterPreactivation()),Tn(()=>{let{currentSnapshot:l,targetSnapshot:d}=n,u=this.createViewTransition?.(this.environmentInjector,l.root,d.root);return u?fo(u).pipe(rt(()=>n)):Ue(n)}),rt(l=>{let d=w$(i.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=n=se(I({},l),{targetRouterState:d}),this.currentNavigation.targetRouterState=d,n}),fr(()=>{this.events.next(new ty)}),T$(this.rootContexts,i.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),Es(1),fr({next:l=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new wu(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{o=!0}}),ki(this.transitionAbortSubject.pipe(fr(l=>{throw l}))),Hh(()=>{!o&&!a&&this.cancelNavigationTransition(n,"",Xn.SupersededByNewNavigation),this.currentTransition?.id===n.id&&(this.currentNavigation=null,this.currentTransition=null)}),Yc(l=>{if(a=!0,fU(l))this.events.next(new fc(n.id,this.urlSerializer.serialize(n.extractedUrl),l.message,l.cancellationCode)),S$(l)?this.events.next(new Vp(l.url,l.navigationBehaviorOptions)):n.resolve(!1);else{let d=new ey(n.id,this.urlSerializer.serialize(n.extractedUrl),l,n.targetSnapshot??void 0);try{let u=ja(this.environmentInjector,()=>this.navigationErrorHandler?.(d));if(u instanceof ry){let{message:m,cancellationCode:p}=Fw(this.urlSerializer,u);this.events.next(new fc(n.id,this.urlSerializer.serialize(n.extractedUrl),m,p)),this.events.next(new Vp(u.redirectTo,u.navigationBehaviorOptions))}else throw this.events.next(d),l}catch(u){this.options.resolveNavigationPromiseOnError?n.resolve(!1):n.reject(u)}}return Kc}))}))}cancelNavigationTransition(i,r,s){let n=new fc(i.id,this.urlSerializer.serialize(i.extractedUrl),r,s);this.events.next(n),i.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let i=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return i.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function b7(e){return e!==Z_}var w7=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:()=>M(x7),providedIn:"root"})}return e})(),FR=class{shouldDetach(t){return!1}store(t,i){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,i){return t.routeConfig===i.routeConfig}},x7=(()=>{class e extends FR{static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),CU=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:()=>M(C7),providedIn:"root"})}return e})(),C7=(()=>{class e extends CU{location=M(Dm);urlSerializer=M(NR);options=M(zR,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=M(jR);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new gc;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=dU(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(i){return this.location.subscribe(r=>{r.type==="popstate"&&i(r.url,r.state)})}handleRouterEvent(i,r){if(i instanceof J_)this.stateMemento=this.createStateMemento();else if(i instanceof xu)this.rawUrlTree=r.initialUrl;else if(i instanceof Dw){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??s,r)}}else i instanceof ty?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):i instanceof fc&&(i.code===Xn.GuardRejected||i.code===Xn.NoDataFromResolver)?this.restoreHistory(r):i instanceof ey?this.restoreHistory(r,!0):i instanceof wu&&(this.lastSuccessfulId=i.id,this.currentPageId=this.browserPageId)}setBrowserUrl(i,r){let s=i instanceof gc?this.urlSerializer.serialize(i):i;if(this.location.isCurrentPathEqualTo(s)||r.extras.replaceUrl){let n=this.browserPageId,o=I(I({},r.extras.state),this.generateNgRouterState(r.id,n));this.location.replaceState(s,"",o)}else{let n=I(I({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(s,"",n)}}restoreHistory(i,r=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,n=this.currentPageId-s;n!==0?this.location.historyGo(n):this.currentUrlTree===i.finalUrl&&n===0&&(this.resetState(i),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(i),this.resetUrlToCurrentUrlTree())}resetState(i){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,i.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(i,r){return this.canceledNavigationResolution==="computed"?{navigationId:i,\u0275routerPageId:r}:{navigationId:i}}static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function S7(e,t){e.events.pipe(zi(i=>i instanceof wu||i instanceof fc||i instanceof ey||i instanceof xu),rt(i=>i instanceof wu||i instanceof xu?0:(i instanceof fc?i.code===Xn.Redirect||i.code===Xn.SupersededByNewNavigation:!1)?2:1),zi(i=>i!==2),Es(1)).subscribe(()=>{t()})}var T7={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},M7={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},SU=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=M(aM);stateManager=M(CU);options=M(zR,{optional:!0})||{};pendingTasks=M(iM);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=M(v7);urlSerializer=M(NR);location=M(Dm);urlHandlingStrategy=M(jR);_events=new $e;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=M(w7);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=M(HR,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!M(BR,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:i=>{this.console.warn(i)}}),this.subscribeToNavigationEvents()}eventsSubscription=new po;subscribeToNavigationEvents(){let i=this.navigationTransitions.events.subscribe(r=>{try{let s=this.navigationTransitions.currentTransition,n=this.navigationTransitions.currentNavigation;if(s!==null&&n!==null){if(this.stateManager.handleRouterEvent(r,n),r instanceof fc&&r.code!==Xn.Redirect&&r.code!==Xn.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof wu)this.navigated=!0;else if(r instanceof Vp){let o=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,s.currentRawUrl),l=I({browserUrl:s.extras.browserUrl,info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:s.extras.replaceUrl||this.urlUpdateStrategy==="eager"||b7(s.source)},o);this.scheduleNavigation(a,Z_,null,l,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}R7(r)&&this._events.next(r)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(i)}resetRootComponentType(i){this.routerState.root.component=i,this.navigationTransitions.rootComponentType=i}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Z_,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((i,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(i,"popstate",r)},0)})}navigateToSyncWithBrowser(i,r,s){let n={replaceUrl:!0},o=s?.navigationId?s:null;if(s){let l=I({},s);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(n.state=l)}let a=this.parseUrl(i);this.scheduleNavigation(a,r,o,n)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(i){this.config=i.map(UR),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(i,r={}){let{relativeTo:s,queryParams:n,fragment:o,queryParamsHandling:a,preserveFragment:l}=r,d=l?this.currentUrlTree.fragment:o,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=I(I({},this.currentUrlTree.queryParams),n);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=n||null}u!==null&&(u=this.removeEmptyProps(u));let m;try{let p=s?s.snapshot:this.routerState.snapshot.root;m=oU(p)}catch{(typeof i[0]!="string"||i[0][0]!=="/")&&(i=[]),m=this.currentUrlTree.root}return aU(m,i,u,d??null)}navigateByUrl(i,r={skipLocationChange:!1}){let s=Y_(i)?i:this.parseUrl(i),n=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(n,Z_,null,r)}navigate(i,r={skipLocationChange:!1}){return E7(i),this.navigateByUrl(this.createUrlTree(i,r),r)}serializeUrl(i){return this.urlSerializer.serialize(i)}parseUrl(i){try{return this.urlSerializer.parse(i)}catch{return this.urlSerializer.parse("/")}}isActive(i,r){let s;if(r===!0?s=I({},T7):r===!1?s=I({},M7):s=r,Y_(i))return j3(this.currentUrlTree,i,s);let n=this.parseUrl(i);return j3(this.currentUrlTree,n,s)}removeEmptyProps(i){return Object.entries(i).reduce((r,[s,n])=>(n!=null&&(r[s]=n),r),{})}scheduleNavigation(i,r,s,n,o){if(this.disposed)return Promise.resolve(!1);let a,l,d;o?(a=o.resolve,l=o.reject,d=o.promise):d=new Promise((m,p)=>{a=m,l=p});let u=this.pendingTasks.add();return S7(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:i,extras:n,resolve:a,reject:l,promise:d,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),d.catch(m=>Promise.reject(m))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function E7(e){for(let t=0;t<e.length;t++)if(e[t]==null)throw new Gi(4008,!1)}function R7(e){return!(e instanceof ty)&&!(e instanceof Vp)}var A7=new He("");function TU(e,...t){return Mm([{provide:HR,multi:!0,useValue:e},[],{provide:Bp,useFactory:I7,deps:[SU]},{provide:cM,multi:!0,useFactory:D7},t.map(i=>i.\u0275providers)])}function I7(e){return e.routerState.root}function D7(){let e=M(wi);return t=>{let i=e.get(td);if(t!==i.components[0])return;let r=e.get(SU),s=e.get(P7);e.get(O7)===1&&r.initialNavigation(),e.get(k7,null,eM.Optional)?.setUpPreloading(),e.get(A7,null,eM.Optional)?.init(),r.resetRootComponentType(i.componentTypes[0]),s.closed||(s.next(),s.complete(),s.unsubscribe())}}var P7=new He("",{factory:()=>new $e}),O7=new He("",{providedIn:"root",factory:()=>1});var k7=new He("");function Lo(e){return e!=null&&`${e}`!="false"}function Hp(e,t=0){return L7(e)?Number(e):arguments.length===2?t:0}function L7(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}function jp(e){return Array.isArray(e)?e:[e]}function Ur(e){return e==null?"":typeof e=="string"?e:`${e}px`}function Ma(e){return e instanceof Jt?e.nativeElement:e}var qR;try{qR=typeof Intl<"u"&&Intl.v8BreakIterator}catch{qR=!1}var sr=(()=>{class e{_platformId=M(ed);isBrowser=this._platformId?Ok(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||qR)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var cy;function F7(){if(cy==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>cy=!0}))}finally{cy=cy||!1}return cy}function Gp(e){return F7()?e:!!e.capture}var Ea=function(e){return e[e.NORMAL=0]="NORMAL",e[e.NEGATED=1]="NEGATED",e[e.INVERTED=2]="INVERTED",e}(Ea||{}),zw,Cu;function Uw(){if(Cu==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Cu=!1,Cu;if("scrollBehavior"in document.documentElement.style)Cu=!0;else{let e=Element.prototype.scrollTo;e?Cu=!/\{\s*\[native code\]\s*\}/.test(e.toString()):Cu=!1}}return Cu}function qp(){if(typeof document!="object"||!document)return Ea.NORMAL;if(zw==null){let e=document.createElement("div"),t=e.style;e.dir="rtl",t.width="1px",t.overflow="auto",t.visibility="hidden",t.pointerEvents="none",t.position="absolute";let i=document.createElement("div"),r=i.style;r.width="2px",r.height="1px",e.appendChild(i),document.body.appendChild(e),zw=Ea.NORMAL,e.scrollLeft===0&&(e.scrollLeft=1,zw=e.scrollLeft===0?Ea.NEGATED:Ea.INVERTED),e.remove()}return zw}var GR;function N7(){if(GR==null){let e=typeof document<"u"?document.head:null;GR=!!(e&&(e.createShadowRoot||e.attachShadow))}return GR}function MU(e){if(N7()){let t=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}function Wp(){let e=typeof document<"u"&&document?document.activeElement:null;for(;e&&e.shadowRoot;){let t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}function Fo(e){return e.composedPath?e.composedPath()[0]:e.target}function WR(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}var V7=new He("cdk-dir-doc",{providedIn:"root",factory:B7});function B7(){return M(bt)}var z7=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function U7(e){let t=e?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?z7.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var Jn=(()=>{class e{value="ltr";change=new yi;constructor(){let i=M(V7,{optional:!0});if(i){let r=i.body?i.body.dir:null,s=i.documentElement?i.documentElement.dir:null;this.value=U7(r||s||"ltr")}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var dy=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({})}return e})();var Hw=class{_multiple;_emitChanges;compareWith;_selection=new Set;_deselectedToEmit=[];_selectedToEmit=[];_selected;get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}changed=new $e;constructor(t=!1,i,r=!0,s){this._multiple=t,this._emitChanges=r,this.compareWith=s,i&&i.length&&(t?i.forEach(n=>this._markSelected(n)):this._markSelected(i[0]),this._selectedToEmit.length=0)}select(...t){this._verifyValueAssignment(t),t.forEach(r=>this._markSelected(r));let i=this._hasQueuedChanges();return this._emitChangeEvent(),i}deselect(...t){this._verifyValueAssignment(t),t.forEach(r=>this._unmarkSelected(r));let i=this._hasQueuedChanges();return this._emitChangeEvent(),i}setSelection(...t){this._verifyValueAssignment(t);let i=this.selected,r=new Set(t);t.forEach(n=>this._markSelected(n)),i.filter(n=>!r.has(this._getConcreteValue(n,r))).forEach(n=>this._unmarkSelected(n));let s=this._hasQueuedChanges();return this._emitChangeEvent(),s}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();let i=this._hasQueuedChanges();return t&&this._emitChangeEvent(),i}isSelected(t){return this._selection.has(this._getConcreteValue(t))}isEmpty(){return this._selection.size===0}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){t=this._getConcreteValue(t),this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){t=this._getConcreteValue(t),this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){t.length>1&&this._multiple}_hasQueuedChanges(){return!!(this._deselectedToEmit.length||this._selectedToEmit.length)}_getConcreteValue(t,i){if(this.compareWith){i=i??this._selection;for(let r of i)if(this.compareWith(t,r))return r;return t}else return t}};var H7=20,hy=(()=>{class e{_ngZone=M(vt);_platform=M(sr);_renderer=M(Ga).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new $e;_scrolledCount=0;scrollContainers=new Map;register(i){this.scrollContainers.has(i)||this.scrollContainers.set(i,i.elementScrolled().subscribe(()=>this._scrolled.next(i)))}deregister(i){let r=this.scrollContainers.get(i);r&&(r.unsubscribe(),this.scrollContainers.delete(i))}scrolled(i=H7){return this._platform.isBrowser?new Bh(r=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let s=i>0?this._scrolled.pipe(Q1(i)).subscribe(r):this._scrolled.subscribe(r);return this._scrolledCount++,()=>{s.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):Ue()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((i,r)=>this.deregister(r)),this._scrolled.complete()}ancestorScrolled(i,r){let s=this.getAncestorScrollContainers(i);return this.scrolled(r).pipe(zi(n=>!n||s.indexOf(n)>-1))}getAncestorScrollContainers(i){let r=[];return this.scrollContainers.forEach((s,n)=>{this._scrollableContainsElement(n,i)&&r.push(n)}),r}_scrollableContainsElement(i,r){let s=Ma(r),n=i.getElementRef().nativeElement;do if(s==n)return!0;while(s=s.parentElement);return!1}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),jw=(()=>{class e{elementRef=M(Jt);scrollDispatcher=M(hy);ngZone=M(vt);dir=M(Jn,{optional:!0});_scrollElement=this.elementRef.nativeElement;_destroyed=new $e;_renderer=M(Yl);_cleanupScroll;_elementScrolled=new $e;constructor(){}ngOnInit(){this._cleanupScroll=this.ngZone.runOutsideAngular(()=>this._renderer.listen(this._scrollElement,"scroll",i=>this._elementScrolled.next(i))),this.scrollDispatcher.register(this)}ngOnDestroy(){this._cleanupScroll?.(),this._elementScrolled.complete(),this.scrollDispatcher.deregister(this),this._destroyed.next(),this._destroyed.complete()}elementScrolled(){return this._elementScrolled}getElementRef(){return this.elementRef}scrollTo(i){let r=this.elementRef.nativeElement,s=this.dir&&this.dir.value=="rtl";i.left==null&&(i.left=s?i.end:i.start),i.right==null&&(i.right=s?i.start:i.end),i.bottom!=null&&(i.top=r.scrollHeight-r.clientHeight-i.bottom),s&&qp()!=Ea.NORMAL?(i.left!=null&&(i.right=r.scrollWidth-r.clientWidth-i.left),qp()==Ea.INVERTED?i.left=i.right:qp()==Ea.NEGATED&&(i.left=i.right?-i.right:i.right)):i.right!=null&&(i.left=r.scrollWidth-r.clientWidth-i.right),this._applyScrollToOptions(i)}_applyScrollToOptions(i){let r=this.elementRef.nativeElement;Uw()?r.scrollTo(i):(i.top!=null&&(r.scrollTop=i.top),i.left!=null&&(r.scrollLeft=i.left))}measureScrollOffset(i){let r="left",s="right",n=this.elementRef.nativeElement;if(i=="top")return n.scrollTop;if(i=="bottom")return n.scrollHeight-n.clientHeight-n.scrollTop;let o=this.dir&&this.dir.value=="rtl";return i=="start"?i=o?s:r:i=="end"&&(i=o?r:s),o&&qp()==Ea.INVERTED?i==r?n.scrollWidth-n.clientWidth-n.scrollLeft:n.scrollLeft:o&&qp()==Ea.NEGATED?i==r?n.scrollLeft+n.scrollWidth-n.clientWidth:-n.scrollLeft:i==r?n.scrollLeft:n.scrollWidth-n.clientWidth-n.scrollLeft}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,selectors:[["","cdk-scrollable",""],["","cdkScrollable",""]]})}return e})(),j7=20,uy=(()=>{class e{_platform=M(sr);_listeners;_viewportSize;_change=new $e;_document=M(bt,{optional:!0});constructor(){let i=M(vt),r=M(Ga).createRenderer(null,null);i.runOutsideAngular(()=>{if(this._platform.isBrowser){let s=n=>this._change.next(n);this._listeners=[r.listen("window","resize",s),r.listen("window","orientationchange",s)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(i=>i()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let i={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),i}getViewportRect(){let i=this.getViewportScrollPosition(),{width:r,height:s}=this.getViewportSize();return{top:i.top,left:i.left,bottom:i.top+s,right:i.left+r,height:s,width:r}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let i=this._document,r=this._getWindow(),s=i.documentElement,n=s.getBoundingClientRect(),o=-n.top||i.body.scrollTop||r.scrollY||s.scrollTop||0,a=-n.left||i.body.scrollLeft||r.scrollX||s.scrollLeft||0;return{top:o,left:a}}change(i=j7){return i>0?this._change.pipe(Q1(i)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let i=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:i.innerWidth,height:i.innerHeight}:{width:0,height:0}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var $R=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({})}return e})();var Gw=new WeakMap,Os=(()=>{class e{_appRef;_injector=M(wi);_environmentInjector=M(Kl);load(i){let r=this._appRef=this._appRef||this._injector.get(td),s=Gw.get(r);s||(s={loaders:new Set,refs:[]},Gw.set(r,s),r.onDestroy(()=>{Gw.get(r)?.refs.forEach(n=>n.destroy()),Gw.delete(r)})),s.loaders.has(i)||(s.loaders.add(i),s.refs.push(wb(i,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),my=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["ng-component"]],exportAs:["cdkVisuallyHidden"],decls:0,vars:0,template:function(r,s){},styles:[".cdk-visually-hidden{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;outline:0;-webkit-appearance:none;-moz-appearance:none;left:0}[dir=rtl] .cdk-visually-hidden{left:auto;right:0}"],encapsulation:2,changeDetection:0})}return e})();function Ld(e,...t){return t.length?t.some(i=>e[i]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}function G7(e){if(e.type==="characterData"&&e.target instanceof Comment)return!0;if(e.type==="childList"){for(let t=0;t<e.addedNodes.length;t++)if(!(e.addedNodes[t]instanceof Comment))return!1;for(let t=0;t<e.removedNodes.length;t++)if(!(e.removedNodes[t]instanceof Comment))return!1;return!0}return!1}var EU=(()=>{class e{create(i){return typeof MutationObserver>"u"?null:new MutationObserver(i)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),q7=(()=>{class e{_mutationObserverFactory=M(EU);_observedElements=new Map;_ngZone=M(vt);constructor(){}ngOnDestroy(){this._observedElements.forEach((i,r)=>this._cleanupObserver(r))}observe(i){let r=Ma(i);return new Bh(s=>{let o=this._observeElement(r).pipe(rt(a=>a.filter(l=>!G7(l))),zi(a=>!!a.length)).subscribe(a=>{this._ngZone.run(()=>{s.next(a)})});return()=>{o.unsubscribe(),this._unobserveElement(r)}})}_observeElement(i){return this._ngZone.runOutsideAngular(()=>{if(this._observedElements.has(i))this._observedElements.get(i).count++;else{let r=new $e,s=this._mutationObserverFactory.create(n=>r.next(n));s&&s.observe(i,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(i,{observer:s,stream:r,count:1})}return this._observedElements.get(i).stream})}_unobserveElement(i){this._observedElements.has(i)&&(this._observedElements.get(i).count--,this._observedElements.get(i).count||this._cleanupObserver(i))}_cleanupObserver(i){if(this._observedElements.has(i)){let{observer:r,stream:s}=this._observedElements.get(i);r&&r.disconnect(),s.complete(),this._observedElements.delete(i)}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),RU=(()=>{class e{_contentObserver=M(q7);_elementRef=M(Jt);event=new yi;get disabled(){return this._disabled}set disabled(i){this._disabled=i,this._disabled?this._unsubscribe():this._subscribe()}_disabled=!1;get debounce(){return this._debounce}set debounce(i){this._debounce=Hp(i),this._subscribe()}_debounce;_currentSubscription=null;constructor(){}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();let i=this._contentObserver.observe(this._elementRef);this._currentSubscription=(this.debounce?i.pipe(Xc(this.debounce)):i).subscribe(this.event)}_unsubscribe(){this._currentSubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,selectors:[["","cdkObserveContent",""]],inputs:{disabled:[2,"cdkObserveContentDisabled","disabled",It],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"],features:[Yr]})}return e})(),AU=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({providers:[EU]})}return e})();var IU=new Set,Su,W7=(()=>{class e{_platform=M(sr);_nonce=M(Hg,{optional:!0});_matchMedia;constructor(){this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Z7}matchMedia(i){return(this._platform.WEBKIT||this._platform.BLINK)&&$7(i,this._nonce),this._matchMedia(i)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function $7(e,t){if(!IU.has(e))try{Su||(Su=document.createElement("style"),t&&Su.setAttribute("nonce",t),Su.setAttribute("type","text/css"),document.head.appendChild(Su)),Su.sheet&&(Su.sheet.insertRule(`@media ${e} {body{ }}`,0),IU.add(e))}catch(i){console.error(i)}}function Z7(e){return{matches:e==="all"||e==="",media:e,addListener:()=>{},removeListener:()=>{}}}var qw=(()=>{class e{_mediaMatcher=M(W7);_zone=M(vt);_queries=new Map;_destroySubject=new $e;constructor(){}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(i){return DU(jp(i)).some(s=>this._registerQuery(s).mql.matches)}observe(i){let s=DU(jp(i)).map(o=>this._registerQuery(o).observable),n=Bg(s);return n=fb(n.pipe(Es(1)),n.pipe(gb(1),Xc(0))),n.pipe(rt(o=>{let a={matches:!1,breakpoints:{}};return o.forEach(({matches:l,query:d})=>{a.matches=a.matches||l,a.breakpoints[d]=l}),a}))}_registerQuery(i){if(this._queries.has(i))return this._queries.get(i);let r=this._mediaMatcher.matchMedia(i),n={observable:new Bh(o=>{let a=l=>this._zone.run(()=>o.next(l));return r.addListener(a),()=>{r.removeListener(a)}}).pipe(dn(r),rt(({matches:o})=>({query:i,matches:o})),ki(this._destroySubject)),mql:r};return this._queries.set(i,n),n}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function DU(e){return e.map(t=>t.split(",")).reduce((t,i)=>t.concat(i)).map(t=>t.trim())}var Tu={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var l9=200,KR=class{_letterKeyStream=new $e;_items=[];_selectedItemIndex=-1;_pressedLetters=[];_skipPredicateFn;_selectedItem=new $e;selectedItem=this._selectedItem;constructor(t,i){let r=typeof i?.debounceInterval=="number"?i.debounceInterval:l9;i?.skipPredicate&&(this._skipPredicateFn=i.skipPredicate),this.setItems(t),this._setupKeyHandler(r)}destroy(){this._pressedLetters=[],this._letterKeyStream.complete(),this._selectedItem.complete()}setCurrentSelectedItemIndex(t){this._selectedItemIndex=t}setItems(t){this._items=t}handleKey(t){let i=t.keyCode;t.key&&t.key.length===1?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(i>=65&&i<=90||i>=48&&i<=57)&&this._letterKeyStream.next(String.fromCharCode(i))}isTyping(){return this._pressedLetters.length>0}reset(){this._pressedLetters=[]}_setupKeyHandler(t){this._letterKeyStream.pipe(fr(i=>this._pressedLetters.push(i)),Xc(t),zi(()=>this._pressedLetters.length>0),rt(()=>this._pressedLetters.join("").toLocaleUpperCase())).subscribe(i=>{for(let r=1;r<this._items.length+1;r++){let s=(this._selectedItemIndex+r)%this._items.length,n=this._items[s];if(!this._skipPredicateFn?.(n)&&n.getLabel?.().toLocaleUpperCase().trim().indexOf(i)===0){this._selectedItem.next(n);break}}this._pressedLetters=[]})}},YR=class{_items;_activeItemIndex=-1;_activeItem=nM(null);_wrap=!1;_typeaheadSubscription=po.EMPTY;_itemChangesSubscription;_vertical=!0;_horizontal;_allowedModifierKeys=[];_homeAndEnd=!1;_pageUpAndDown={enabled:!1,delta:10};_effectRef;_typeahead;_skipPredicateFn=t=>t.disabled;constructor(t,i){this._items=t,t instanceof Wh?this._itemChangesSubscription=t.changes.subscribe(r=>this._itemsChanged(r.toArray())):yb(t)&&(this._effectRef=Mk(()=>this._itemsChanged(t()),{injector:i}))}tabOut=new $e;change=new $e;skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){this._typeaheadSubscription.unsubscribe();let i=this._getItemsArray();return this._typeahead=new KR(i,{debounceInterval:typeof t=="number"?t:void 0,skipPredicate:r=>this._skipPredicateFn(r)}),this._typeaheadSubscription=this._typeahead.selectedItem.subscribe(r=>{this.setActiveItem(r)}),this}cancelTypeahead(){return this._typeahead?.reset(),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}withPageUpDown(t=!0,i=10){return this._pageUpAndDown={enabled:t,delta:i},this}setActiveItem(t){let i=this._activeItem();this.updateActiveItem(t),this._activeItem()!==i&&this.change.next(this._activeItemIndex)}onKeydown(t){let i=t.keyCode,s=["altKey","ctrlKey","metaKey","shiftKey"].every(n=>!t[n]||this._allowedModifierKeys.indexOf(n)>-1);switch(i){case 9:this.tabOut.next();return;case 40:if(this._vertical&&s){this.setNextItemActive();break}else return;case 38:if(this._vertical&&s){this.setPreviousItemActive();break}else return;case 39:if(this._horizontal&&s){this._horizontal==="rtl"?this.setPreviousItemActive():this.setNextItemActive();break}else return;case 37:if(this._horizontal&&s){this._horizontal==="rtl"?this.setNextItemActive():this.setPreviousItemActive();break}else return;case 36:if(this._homeAndEnd&&s){this.setFirstItemActive();break}else return;case 35:if(this._homeAndEnd&&s){this.setLastItemActive();break}else return;case 33:if(this._pageUpAndDown.enabled&&s){let n=this._activeItemIndex-this._pageUpAndDown.delta;this._setActiveItemByIndex(n>0?n:0,1);break}else return;case 34:if(this._pageUpAndDown.enabled&&s){let n=this._activeItemIndex+this._pageUpAndDown.delta,o=this._getItemsArray().length;this._setActiveItemByIndex(n<o?n:o-1,-1);break}else return;default:(s||Ld(t,"shiftKey"))&&this._typeahead?.handleKey(t);return}this._typeahead?.reset(),t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem()}isTyping(){return!!this._typeahead&&this._typeahead.isTyping()}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._getItemsArray().length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){let i=this._getItemsArray(),r=typeof t=="number"?t:i.indexOf(t),s=i[r];this._activeItem.set(s??null),this._activeItemIndex=r,this._typeahead?.setCurrentSelectedItemIndex(r)}destroy(){this._typeaheadSubscription.unsubscribe(),this._itemChangesSubscription?.unsubscribe(),this._effectRef?.destroy(),this._typeahead?.destroy(),this.tabOut.complete(),this.change.complete()}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){let i=this._getItemsArray();for(let r=1;r<=i.length;r++){let s=(this._activeItemIndex+t*r+i.length)%i.length,n=i[s];if(!this._skipPredicateFn(n)){this.setActiveItem(s);return}}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,i){let r=this._getItemsArray();if(r[t]){for(;this._skipPredicateFn(r[t]);)if(t+=i,!r[t])return;this.setActiveItem(t)}}_getItemsArray(){return yb(this._items)?this._items():this._items instanceof Wh?this._items.toArray():this._items}_itemsChanged(t){this._typeahead?.setItems(t);let i=this._activeItem();if(i){let r=t.indexOf(i);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r,this._typeahead?.setCurrentSelectedItemIndex(r))}}};var Zw=class extends YR{_origin="program";setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}};var py=(()=>{class e{_platform=M(sr);constructor(){}isDisabled(i){return i.hasAttribute("disabled")}isVisible(i){return d9(i)&&getComputedStyle(i).visibility==="visible"}isTabbable(i){if(!this._platform.isBrowser)return!1;let r=c9(y9(i));if(r&&(PU(r)===-1||!this.isVisible(r)))return!1;let s=i.nodeName.toLowerCase(),n=PU(i);return i.hasAttribute("contenteditable")?n!==-1:s==="iframe"||s==="object"||this._platform.WEBKIT&&this._platform.IOS&&!g9(i)?!1:s==="audio"?i.hasAttribute("controls")?n!==-1:!1:s==="video"?n===-1?!1:n!==null?!0:this._platform.FIREFOX||i.hasAttribute("controls"):i.tabIndex>=0}isFocusable(i,r){return _9(i)&&!this.isDisabled(i)&&(r?.ignoreVisibility||this.isVisible(i))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function c9(e){try{return e.frameElement}catch{return null}}function d9(e){return!!(e.offsetWidth||e.offsetHeight||typeof e.getClientRects=="function"&&e.getClientRects().length)}function h9(e){let t=e.nodeName.toLowerCase();return t==="input"||t==="select"||t==="button"||t==="textarea"}function u9(e){return p9(e)&&e.type=="hidden"}function m9(e){return f9(e)&&e.hasAttribute("href")}function p9(e){return e.nodeName.toLowerCase()=="input"}function f9(e){return e.nodeName.toLowerCase()=="a"}function zU(e){if(!e.hasAttribute("tabindex")||e.tabIndex===void 0)return!1;let t=e.getAttribute("tabindex");return!!(t&&!isNaN(parseInt(t,10)))}function PU(e){if(!zU(e))return null;let t=parseInt(e.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}function g9(e){let t=e.nodeName.toLowerCase(),i=t==="input"&&e.type;return i==="text"||i==="password"||t==="select"||t==="textarea"}function _9(e){return u9(e)?!1:h9(e)||m9(e)||e.hasAttribute("contenteditable")||zU(e)}function y9(e){return e.ownerDocument&&e.ownerDocument.defaultView||window}var XR=class{_element;_checker;_ngZone;_document;_injector;_startAnchor;_endAnchor;_hasAttached=!1;startAnchorListener=()=>this.focusLastTabbableElement();endAnchorListener=()=>this.focusFirstTabbableElement();get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_enabled=!0;constructor(t,i,r,s,n=!1,o){this._element=t,this._checker=i,this._ngZone=r,this._document=s,this._injector=o,n||this.attachAnchors()}destroy(){let t=this._startAnchor,i=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),i&&(i.removeEventListener("focus",this.endAnchorListener),i.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(i=>{this._executeOnStable(()=>i(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(i=>{this._executeOnStable(()=>i(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(i=>{this._executeOnStable(()=>i(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){let i=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return t=="start"?i.length?i[0]:this._getFirstTabbableElement(this._element):i.length?i[i.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){let i=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(i){if(!this._checker.isFocusable(i)){let r=this._getFirstTabbableElement(i);return r?.focus(t),!!r}return i.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){let i=this._getRegionBoundary("start");return i&&i.focus(t),!!i}focusLastTabbableElement(t){let i=this._getRegionBoundary("end");return i&&i.focus(t),!!i}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;let i=t.children;for(let r=0;r<i.length;r++){let s=i[r].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(i[r]):null;if(s)return s}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;let i=t.children;for(let r=i.length-1;r>=0;r--){let s=i[r].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(i[r]):null;if(s)return s}return null}_createAnchor(){let t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,i){t?i.setAttribute("tabindex","0"):i.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._injector?_o(t,{injector:this._injector}):setTimeout(t)}},Qw=(()=>{class e{_checker=M(py);_ngZone=M(vt);_document=M(bt);_injector=M(wi);constructor(){M(Os).load(my)}create(i,r=!1){return new XR(i,this._checker,this._ngZone,this._document,r,this._injector)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function JR(e){return e.buttons===0||e.detail===0}function eA(e){let t=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!!t&&t.identifier===-1&&(t.radiusX==null||t.radiusX===1)&&(t.radiusY==null||t.radiusY===1)}var v9=new He("cdk-input-modality-detector-options"),b9={ignoreKeys:[18,17,224,91,16]},UU=650,$p=Gp({passive:!0,capture:!0}),w9=(()=>{class e{_platform=M(sr);modalityDetected;modalityChanged;get mostRecentModality(){return this._modality.value}_mostRecentTarget=null;_modality=new Pr(null);_options;_lastTouchMs=0;_onKeydown=i=>{this._options?.ignoreKeys?.some(r=>r===i.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Fo(i))};_onMousedown=i=>{Date.now()-this._lastTouchMs<UU||(this._modality.next(JR(i)?"keyboard":"mouse"),this._mostRecentTarget=Fo(i))};_onTouchstart=i=>{if(eA(i)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Fo(i)};constructor(){let i=M(vt),r=M(bt),s=M(v9,{optional:!0});this._options=I(I({},b9),s),this.modalityDetected=this._modality.pipe(gb(1)),this.modalityChanged=this.modalityDetected.pipe(X1()),this._platform.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,$p),r.addEventListener("mousedown",this._onMousedown,$p),r.addEventListener("touchstart",this._onTouchstart,$p)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,$p),document.removeEventListener("mousedown",this._onMousedown,$p),document.removeEventListener("touchstart",this._onTouchstart,$p))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var $w=function(e){return e[e.IMMEDIATE=0]="IMMEDIATE",e[e.EVENTUAL=1]="EVENTUAL",e}($w||{}),x9=new He("cdk-focus-monitor-default-options"),Ww=Gp({passive:!0,capture:!0}),yl=(()=>{class e{_ngZone=M(vt);_platform=M(sr);_inputModalityDetector=M(w9);_origin=null;_lastFocusOrigin;_windowFocused=!1;_windowFocusTimeoutId;_originTimeoutId;_originFromTouchInteraction=!1;_elementInfo=new Map;_monitoredElementCount=0;_rootNodeFocusListenerCount=new Map;_detectionMode;_windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)};_document=M(bt,{optional:!0});_stopInputModalityDetector=new $e;constructor(){let i=M(x9,{optional:!0});this._detectionMode=i?.detectionMode||$w.IMMEDIATE}_rootNodeFocusAndBlurListener=i=>{let r=Fo(i);for(let s=r;s;s=s.parentElement)i.type==="focus"?this._onFocus(i,s):this._onBlur(i,s)};monitor(i,r=!1){let s=Ma(i);if(!this._platform.isBrowser||s.nodeType!==1)return Ue();let n=MU(s)||this._getDocument(),o=this._elementInfo.get(s);if(o)return r&&(o.checkChildren=!0),o.subject;let a={checkChildren:r,subject:new $e,rootNode:n};return this._elementInfo.set(s,a),this._registerGlobalListeners(a),a.subject}stopMonitoring(i){let r=Ma(i),s=this._elementInfo.get(r);s&&(s.subject.complete(),this._setClasses(r),this._elementInfo.delete(r),this._removeGlobalListeners(s))}focusVia(i,r,s){let n=Ma(i),o=this._getDocument().activeElement;n===o?this._getClosestElementsInfo(n).forEach(([a,l])=>this._originChanged(a,r,l)):(this._setOrigin(r),typeof n.focus=="function"&&n.focus(s))}ngOnDestroy(){this._elementInfo.forEach((i,r)=>this.stopMonitoring(r))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(i){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(i)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:i&&this._isLastInteractionFromInputLabel(i)?"mouse":"program"}_shouldBeAttributedToTouch(i){return this._detectionMode===$w.EVENTUAL||!!i?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(i,r){i.classList.toggle("cdk-focused",!!r),i.classList.toggle("cdk-touch-focused",r==="touch"),i.classList.toggle("cdk-keyboard-focused",r==="keyboard"),i.classList.toggle("cdk-mouse-focused",r==="mouse"),i.classList.toggle("cdk-program-focused",r==="program")}_setOrigin(i,r=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=i,this._originFromTouchInteraction=i==="touch"&&r,this._detectionMode===$w.IMMEDIATE){clearTimeout(this._originTimeoutId);let s=this._originFromTouchInteraction?UU:1;this._originTimeoutId=setTimeout(()=>this._origin=null,s)}})}_onFocus(i,r){let s=this._elementInfo.get(r),n=Fo(i);!s||!s.checkChildren&&r!==n||this._originChanged(r,this._getFocusOrigin(n),s)}_onBlur(i,r){let s=this._elementInfo.get(r);!s||s.checkChildren&&i.relatedTarget instanceof Node&&r.contains(i.relatedTarget)||(this._setClasses(r),this._emitOrigin(s,null))}_emitOrigin(i,r){i.subject.observers.length&&this._ngZone.run(()=>i.subject.next(r))}_registerGlobalListeners(i){if(!this._platform.isBrowser)return;let r=i.rootNode,s=this._rootNodeFocusListenerCount.get(r)||0;s||this._ngZone.runOutsideAngular(()=>{r.addEventListener("focus",this._rootNodeFocusAndBlurListener,Ww),r.addEventListener("blur",this._rootNodeFocusAndBlurListener,Ww)}),this._rootNodeFocusListenerCount.set(r,s+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(ki(this._stopInputModalityDetector)).subscribe(n=>{this._setOrigin(n,!0)}))}_removeGlobalListeners(i){let r=i.rootNode;if(this._rootNodeFocusListenerCount.has(r)){let s=this._rootNodeFocusListenerCount.get(r);s>1?this._rootNodeFocusListenerCount.set(r,s-1):(r.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Ww),r.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Ww),this._rootNodeFocusListenerCount.delete(r))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(i,r,s){this._setClasses(i,r),this._emitOrigin(s,r),this._lastFocusOrigin=r}_getClosestElementsInfo(i){let r=[];return this._elementInfo.forEach((s,n)=>{(n===i||s.checkChildren&&n.contains(i))&&r.push([n,s])}),r}_isLastInteractionFromInputLabel(i){let{_mostRecentTarget:r,mostRecentModality:s}=this._inputModalityDetector;if(s!=="mouse"||!r||r===i||i.nodeName!=="INPUT"&&i.nodeName!=="TEXTAREA"||i.disabled)return!1;let n=i.labels;if(n){for(let o=0;o<n.length;o++)if(n[o].contains(r))return!0}return!1}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Mu=function(e){return e[e.NONE=0]="NONE",e[e.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",e[e.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",e}(Mu||{}),OU="cdk-high-contrast-black-on-white",kU="cdk-high-contrast-white-on-black",ZR="cdk-high-contrast-active",HU=(()=>{class e{_platform=M(sr);_hasCheckedHighContrastMode;_document=M(bt);_breakpointSubscription;constructor(){this._breakpointSubscription=M(qw).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return Mu.NONE;let i=this._document.createElement("div");i.style.backgroundColor="rgb(1,2,3)",i.style.position="absolute",this._document.body.appendChild(i);let r=this._document.defaultView||window,s=r&&r.getComputedStyle?r.getComputedStyle(i):null,n=(s&&s.backgroundColor||"").replace(/ /g,"");switch(i.remove(),n){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return Mu.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return Mu.BLACK_ON_WHITE}return Mu.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let i=this._document.body.classList;i.remove(ZR,OU,kU),this._hasCheckedHighContrastMode=!0;let r=this.getHighContrastMode();r===Mu.BLACK_ON_WHITE?i.add(ZR,OU):r===Mu.WHITE_ON_BLACK&&i.add(ZR,kU)}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var QR={},vl=(()=>{class e{_appId=M(Ug);getId(i){return this._appId!=="ng"&&(i+=this._appId),QR.hasOwnProperty(i)||(QR[i]=0),`${i}${QR[i]++}`}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var nA=(()=>{class e{static STANDARD_CURVE="cubic-bezier(0.4,0.0,0.2,1)";static DECELERATION_CURVE="cubic-bezier(0.0,0.0,0.2,1)";static ACCELERATION_CURVE="cubic-bezier(0.4,0.0,1,1)";static SHARP_CURVE="cubic-bezier(0.4,0.0,0.6,1)"}return e})(),oA=(()=>{class e{static COMPLEX="375ms";static ENTERING="225ms";static EXITING="195ms"}return e})();var ur=(()=>{class e{constructor(){M(HU)._applyBodyHighContrastModeCssClasses()}static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({imports:[dy,dy]})}return e})();var KU=(()=>{class e{isErrorState(i,r){return!!(i&&i.invalid&&(i.touched||r&&r.submitted))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),_c=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["structural-styles"]],decls:0,vars:0,template:function(r,s){},styles:['.mat-focus-indicator{position:relative}.mat-focus-indicator::before{top:0;left:0;right:0;bottom:0;position:absolute;box-sizing:border-box;pointer-events:none;display:var(--mat-focus-indicator-display, none);border-width:var(--mat-focus-indicator-border-width, 3px);border-style:var(--mat-focus-indicator-border-style, solid);border-color:var(--mat-focus-indicator-border-color, transparent);border-radius:var(--mat-focus-indicator-border-radius, 4px)}.mat-focus-indicator:focus::before{content:""}@media(forced-colors: active){html{--mat-focus-indicator-display: block}}'],encapsulation:2,changeDetection:0})}return e})();var No=function(e){return e[e.FADING_IN=0]="FADING_IN",e[e.VISIBLE=1]="VISIBLE",e[e.FADING_OUT=2]="FADING_OUT",e[e.HIDDEN=3]="HIDDEN",e}(No||{}),rA=class{_renderer;element;config;_animationForciblyDisabledThroughCss;state=No.HIDDEN;constructor(t,i,r,s=!1){this._renderer=t,this.element=i,this.config=r,this._animationForciblyDisabledThroughCss=s}fadeOut(){this._renderer.fadeOutRipple(this)}},jU=Gp({passive:!0,capture:!0}),sA=class{_events=new Map;addHandler(t,i,r,s){let n=this._events.get(i);if(n){let o=n.get(r);o?o.add(s):n.set(r,new Set([s]))}else this._events.set(i,new Map([[r,new Set([s])]])),t.runOutsideAngular(()=>{document.addEventListener(i,this._delegateEventHandler,jU)})}removeHandler(t,i,r){let s=this._events.get(t);if(!s)return;let n=s.get(i);n&&(n.delete(r),n.size===0&&s.delete(i),s.size===0&&(this._events.delete(t),document.removeEventListener(t,this._delegateEventHandler,jU)))}_delegateEventHandler=t=>{let i=Fo(t);i&&this._events.get(t.type)?.forEach((r,s)=>{(s===i||s.contains(i))&&r.forEach(n=>n.handleEvent(t))})}},Yw={enterDuration:225,exitDuration:150},C9=800,GU=Gp({passive:!0,capture:!0}),qU=["mousedown","touchstart"],WU=["mouseup","mouseleave","touchend","touchcancel"],S9=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["ng-component"]],hostAttrs:["mat-ripple-style-loader",""],decls:0,vars:0,template:function(r,s){},styles:[".mat-ripple{overflow:hidden;position:relative}.mat-ripple:not(:empty){transform:translateZ(0)}.mat-ripple.mat-ripple-unbounded{overflow:visible}.mat-ripple-element{position:absolute;border-radius:50%;pointer-events:none;transition:opacity,transform 0ms cubic-bezier(0, 0, 0.2, 1);transform:scale3d(0, 0, 0);background-color:var(--mat-ripple-color, color-mix(in srgb, var(--mat-sys-on-surface) 10%, transparent))}@media(forced-colors: active){.mat-ripple-element{display:none}}.cdk-drag-preview .mat-ripple-element,.cdk-drag-placeholder .mat-ripple-element{display:none}"],encapsulation:2,changeDetection:0})}return e})(),Zp=class e{_target;_ngZone;_platform;_containerElement;_triggerElement;_isPointerDown=!1;_activeRipples=new Map;_mostRecentTransientRipple;_lastTouchStartEvent;_pointerUpEventsRegistered=!1;_containerRect;static _eventManager=new sA;constructor(t,i,r,s,n){this._target=t,this._ngZone=i,this._platform=s,s.isBrowser&&(this._containerElement=Ma(r)),n&&n.get(Os).load(S9)}fadeInRipple(t,i,r={}){let s=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),n=I(I({},Yw),r.animation);r.centered&&(t=s.left+s.width/2,i=s.top+s.height/2);let o=r.radius||T9(t,i,s),a=t-s.left,l=i-s.top,d=n.enterDuration,u=document.createElement("div");u.classList.add("mat-ripple-element"),u.style.left=`${a-o}px`,u.style.top=`${l-o}px`,u.style.height=`${o*2}px`,u.style.width=`${o*2}px`,r.color!=null&&(u.style.backgroundColor=r.color),u.style.transitionDuration=`${d}ms`,this._containerElement.appendChild(u);let m=window.getComputedStyle(u),p=m.transitionProperty,f=m.transitionDuration,g=p==="none"||f==="0s"||f==="0s, 0s"||s.width===0&&s.height===0,_=new rA(this,u,r,g);u.style.transform="scale3d(1, 1, 1)",_.state=No.FADING_IN,r.persistent||(this._mostRecentTransientRipple=_);let y=null;return!g&&(d||n.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let v=()=>{y&&(y.fallbackTimer=null),clearTimeout(S),this._finishRippleTransition(_)},x=()=>this._destroyRipple(_),S=setTimeout(x,d+100);u.addEventListener("transitionend",v),u.addEventListener("transitioncancel",x),y={onTransitionEnd:v,onTransitionCancel:x,fallbackTimer:S}}),this._activeRipples.set(_,y),(g||!d)&&this._finishRippleTransition(_),_}fadeOutRipple(t){if(t.state===No.FADING_OUT||t.state===No.HIDDEN)return;let i=t.element,r=I(I({},Yw),t.config.animation);i.style.transitionDuration=`${r.exitDuration}ms`,i.style.opacity="0",t.state=No.FADING_OUT,(t._animationForciblyDisabledThroughCss||!r.exitDuration)&&this._finishRippleTransition(t)}fadeOutAll(){this._getActiveRipples().forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){let i=Ma(t);!this._platform.isBrowser||!i||i===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=i,qU.forEach(r=>{e._eventManager.addHandler(this._ngZone,r,i,this)}))}handleEvent(t){t.type==="mousedown"?this._onMousedown(t):t.type==="touchstart"?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{WU.forEach(i=>{this._triggerElement.addEventListener(i,this,GU)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(t){t.state===No.FADING_IN?this._startFadeOutTransition(t):t.state===No.FADING_OUT&&this._destroyRipple(t)}_startFadeOutTransition(t){let i=t===this._mostRecentTransientRipple,{persistent:r}=t.config;t.state=No.VISIBLE,!r&&(!i||!this._isPointerDown)&&t.fadeOut()}_destroyRipple(t){let i=this._activeRipples.get(t)??null;this._activeRipples.delete(t),this._activeRipples.size||(this._containerRect=null),t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),t.state=No.HIDDEN,i!==null&&(t.element.removeEventListener("transitionend",i.onTransitionEnd),t.element.removeEventListener("transitioncancel",i.onTransitionCancel),i.fallbackTimer!==null&&clearTimeout(i.fallbackTimer)),t.element.remove()}_onMousedown(t){let i=JR(t),r=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+C9;!this._target.rippleDisabled&&!i&&!r&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!eA(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let i=t.changedTouches;if(i)for(let r=0;r<i.length;r++)this.fadeInRipple(i[r].clientX,i[r].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(t=>{let i=t.state===No.VISIBLE||t.config.terminateOnPointerUp&&t.state===No.FADING_IN;!t.config.persistent&&i&&t.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let t=this._triggerElement;t&&(qU.forEach(i=>e._eventManager.removeHandler(i,t,this)),this._pointerUpEventsRegistered&&(WU.forEach(i=>t.removeEventListener(i,this,GU)),this._pointerUpEventsRegistered=!1))}};function T9(e,t,i){let r=Math.max(Math.abs(e-i.left),Math.abs(e-i.right)),s=Math.max(Math.abs(t-i.top),Math.abs(t-i.bottom));return Math.sqrt(r*r+s*s)}var Qp=new He("mat-ripple-global-options"),YU=(()=>{class e{_elementRef=M(Jt);_animationMode=M(bs,{optional:!0});color;unbounded;centered;radius=0;animation;get disabled(){return this._disabled}set disabled(i){i&&this.fadeOutAllNonPersistent(),this._disabled=i,this._setupTriggerEventsIfEnabled()}_disabled=!1;get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(i){this._trigger=i,this._setupTriggerEventsIfEnabled()}_trigger;_rippleRenderer;_globalOptions;_isInitialized=!1;constructor(){let i=M(vt),r=M(sr),s=M(Qp,{optional:!0}),n=M(wi);this._globalOptions=s||{},this._rippleRenderer=new Zp(this,i,this._elementRef,r,n)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:I(I(I({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(i,r=0,s){return typeof i=="number"?this._rippleRenderer.fadeInRipple(i,r,I(I({},this.rippleConfig),s)):this._rippleRenderer.fadeInRipple(0,0,I(I({},this.rippleConfig),i))}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(r,s){r&2&&Ui("mat-ripple-unbounded",s.unbounded)},inputs:{color:[0,"matRippleColor","color"],unbounded:[0,"matRippleUnbounded","unbounded"],centered:[0,"matRippleCentered","centered"],radius:[0,"matRippleRadius","radius"],animation:[0,"matRippleAnimation","animation"],disabled:[0,"matRippleDisabled","disabled"],trigger:[0,"matRippleTrigger","trigger"]},exportAs:["matRipple"]})}return e})(),Fd=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({imports:[ur,ur]})}return e})(),XU=(()=>{class e{_animationMode=M(bs,{optional:!0});state="unchecked";disabled=!1;appearance="full";constructor(){}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["mat-pseudo-checkbox"]],hostAttrs:[1,"mat-pseudo-checkbox"],hostVars:12,hostBindings:function(r,s){r&2&&Ui("mat-pseudo-checkbox-indeterminate",s.state==="indeterminate")("mat-pseudo-checkbox-checked",s.state==="checked")("mat-pseudo-checkbox-disabled",s.disabled)("mat-pseudo-checkbox-minimal",s.appearance==="minimal")("mat-pseudo-checkbox-full",s.appearance==="full")("_mat-animation-noopable",s._animationMode==="NoopAnimations")},inputs:{state:"state",disabled:"disabled",appearance:"appearance"},decls:0,vars:0,template:function(r,s){},styles:['.mat-pseudo-checkbox{border-radius:2px;cursor:pointer;display:inline-block;vertical-align:middle;box-sizing:border-box;position:relative;flex-shrink:0;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1),background-color 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox::after{position:absolute;opacity:0;content:"";border-bottom:2px solid currentColor;transition:opacity 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox._mat-animation-noopable{transition:none !important;animation:none !important}.mat-pseudo-checkbox._mat-animation-noopable::after{transition:none}.mat-pseudo-checkbox-disabled{cursor:default}.mat-pseudo-checkbox-indeterminate::after{left:1px;opacity:1;border-radius:2px}.mat-pseudo-checkbox-checked::after{left:1px;border-left:2px solid currentColor;transform:rotate(-45deg);opacity:1;box-sizing:content-box}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after,.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{color:var(--mat-minimal-pseudo-checkbox-selected-checkmark-color, var(--mat-sys-primary))}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled::after,.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled::after{color:var(--mat-minimal-pseudo-checkbox-disabled-selected-checkmark-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-pseudo-checkbox-full{border-color:var(--mat-full-pseudo-checkbox-unselected-icon-color, var(--mat-sys-on-surface-variant));border-width:2px;border-style:solid}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-disabled{border-color:var(--mat-full-pseudo-checkbox-disabled-unselected-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate{background-color:var(--mat-full-pseudo-checkbox-selected-icon-color, var(--mat-sys-primary));border-color:rgba(0,0,0,0)}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{color:var(--mat-full-pseudo-checkbox-selected-checkmark-color, var(--mat-sys-on-primary))}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled{background-color:var(--mat-full-pseudo-checkbox-disabled-selected-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled::after,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled::after{color:var(--mat-full-pseudo-checkbox-disabled-selected-checkmark-color, var(--mat-sys-surface))}.mat-pseudo-checkbox{width:18px;height:18px}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after{width:14px;height:6px;transform-origin:center;top:-4.2426406871px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{top:8px;width:16px}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after{width:10px;height:4px;transform-origin:center;top:-2.8284271247px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{top:6px;width:12px}'],encapsulation:2,changeDetection:0})}return e})(),JU=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({imports:[ur]})}return e})();var $U={capture:!0},ZU=["focus","mousedown","mouseenter","touchstart"],tA="mat-ripple-loader-uninitialized",iA="mat-ripple-loader-class-name",QU="mat-ripple-loader-centered",Kw="mat-ripple-loader-disabled",Xw=(()=>{class e{_document=M(bt,{optional:!0});_animationMode=M(bs,{optional:!0});_globalRippleOptions=M(Qp,{optional:!0});_platform=M(sr);_ngZone=M(vt);_injector=M(wi);_hosts=new Map;constructor(){this._ngZone.runOutsideAngular(()=>{for(let i of ZU)this._document?.addEventListener(i,this._onInteraction,$U)})}ngOnDestroy(){let i=this._hosts.keys();for(let r of i)this.destroyRipple(r);for(let r of ZU)this._document?.removeEventListener(r,this._onInteraction,$U)}configureRipple(i,r){i.setAttribute(tA,this._globalRippleOptions?.namespace??""),(r.className||!i.hasAttribute(iA))&&i.setAttribute(iA,r.className||""),r.centered&&i.setAttribute(QU,""),r.disabled&&i.setAttribute(Kw,"")}setDisabled(i,r){let s=this._hosts.get(i);s?(s.target.rippleDisabled=r,!r&&!s.hasSetUpEvents&&(s.hasSetUpEvents=!0,s.renderer.setupTriggerEvents(i))):r?i.setAttribute(Kw,""):i.removeAttribute(Kw)}_onInteraction=i=>{let r=Fo(i);if(r instanceof HTMLElement){let s=r.closest(`[${tA}="${this._globalRippleOptions?.namespace??""}"]`);s&&this._createRipple(s)}};_createRipple(i){if(!this._document||this._hosts.has(i))return;i.querySelector(".mat-ripple")?.remove();let r=this._document.createElement("span");r.classList.add("mat-ripple",i.getAttribute(iA)),i.append(r);let s=this._animationMode==="NoopAnimations",n=this._globalRippleOptions,o=s?0:n?.animation?.enterDuration??Yw.enterDuration,a=s?0:n?.animation?.exitDuration??Yw.exitDuration,l={rippleDisabled:s||n?.disabled||i.hasAttribute(Kw),rippleConfig:{centered:i.hasAttribute(QU),terminateOnPointerUp:n?.terminateOnPointerUp,animation:{enterDuration:o,exitDuration:a}}},d=new Zp(l,this._ngZone,r,this._platform,this._injector),u=!l.rippleDisabled;u&&d.setupTriggerEvents(i),this._hosts.set(i,{target:l,renderer:d,hasSetUpEvents:u}),i.removeAttribute(tA)}destroyRipple(i){let r=this._hosts.get(i);r&&(r.renderer._removeTriggerEvents(),this._hosts.delete(i))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var eH=["*"],M9=["content"],E9=[[["mat-drawer"]],[["mat-drawer-content"]],"*"],R9=["mat-drawer","mat-drawer-content","*"];function A9(e,t){if(e&1){let i=aa();De(0,"div",1),qi("click",function(){na(i);let s=hn();return oa(s._onBackdropClicked())}),Ze()}if(e&2){let i=hn();Ui("mat-drawer-shown",i._isShowingBackdrop())}}function I9(e,t){e&1&&(De(0,"mat-drawer-content"),Gt(1,2),Ze())}var D9=new He("MAT_DRAWER_DEFAULT_AUTOSIZE",{providedIn:"root",factory:P9}),tH=new He("MAT_DRAWER_CONTAINER");function P9(){return!1}var fy=(()=>{class e extends jw{_platform=M(sr);_changeDetectorRef=M(ls);_container=M(lA);constructor(){let i=M(Jt),r=M(hy),s=M(vt);super(i,r,s)}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}_shouldBeHidden(){if(this._platform.isBrowser)return!1;let{start:i,end:r}=this._container;return i!=null&&i.mode!=="over"&&i.opened||r!=null&&r.mode!=="over"&&r.opened}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["mat-drawer-content"]],hostAttrs:[1,"mat-drawer-content"],hostVars:6,hostBindings:function(r,s){r&2&&(vb("margin-left",s._container._contentMargins.left,"px")("margin-right",s._container._contentMargins.right,"px"),Ui("mat-drawer-content-hidden",s._shouldBeHidden()))},features:[Hs([{provide:jw,useExisting:e}]),Kr],ngContentSelectors:eH,decls:1,vars:0,template:function(r,s){r&1&&(gr(),Gt(0))},encapsulation:2,changeDetection:0})}return e})(),aA=(()=>{class e{_elementRef=M(Jt);_focusTrapFactory=M(Qw);_focusMonitor=M(yl);_platform=M(sr);_ngZone=M(vt);_renderer=M(Yl);_interactivityChecker=M(py);_doc=M(bt,{optional:!0});_container=M(tH,{optional:!0});_focusTrap=null;_elementFocusedBeforeDrawerWasOpened=null;_eventCleanups;_isAttached;_anchor;get position(){return this._position}set position(i){i=i==="end"?"end":"start",i!==this._position&&(this._isAttached&&this._updatePositionInParent(i),this._position=i,this.onPositionChanged.emit())}_position="start";get mode(){return this._mode}set mode(i){this._mode=i,this._updateFocusTrapState(),this._modeChanged.next()}_mode="over";get disableClose(){return this._disableClose}set disableClose(i){this._disableClose=Lo(i)}_disableClose=!1;get autoFocus(){let i=this._autoFocus;return i??(this.mode==="side"?"dialog":"first-tabbable")}set autoFocus(i){(i==="true"||i==="false"||i==null)&&(i=Lo(i)),this._autoFocus=i}_autoFocus;get opened(){return this._opened}set opened(i){this.toggle(Lo(i))}_opened=!1;_openedVia;_animationStarted=new $e;_animationEnd=new $e;openedChange=new yi(!0);_openedStream=this.openedChange.pipe(zi(i=>i),rt(()=>{}));openedStart=this._animationStarted.pipe(zi(()=>this.opened),Y1(void 0));_closedStream=this.openedChange.pipe(zi(i=>!i),rt(()=>{}));closedStart=this._animationStarted.pipe(zi(()=>!this.opened),Y1(void 0));_destroyed=new $e;onPositionChanged=new yi;_content;_modeChanged=new $e;_injector=M(wi);_changeDetectorRef=M(ls);constructor(){this.openedChange.pipe(ki(this._destroyed)).subscribe(i=>{i?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus(this._openedVia||"program")}),this._ngZone.runOutsideAngular(()=>{let i=this._elementRef.nativeElement;YO(i,"keydown").pipe(zi(r=>r.keyCode===27&&!this.disableClose&&!Ld(r)),ki(this._destroyed)).subscribe(r=>this._ngZone.run(()=>{this.close(),r.stopPropagation(),r.preventDefault()})),this._eventCleanups=[this._renderer.listen(i,"transitionrun",this._handleTransitionEvent),this._renderer.listen(i,"transitionend",this._handleTransitionEvent),this._renderer.listen(i,"transitioncancel",this._handleTransitionEvent)]}),this._animationEnd.subscribe(()=>{this.openedChange.emit(this._opened)})}_forceFocus(i,r){this._interactivityChecker.isFocusable(i)||(i.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let s=()=>{n(),o(),i.removeAttribute("tabindex")},n=this._renderer.listen(i,"blur",s),o=this._renderer.listen(i,"mousedown",s)})),i.focus(r)}_focusByCssSelector(i,r){let s=this._elementRef.nativeElement.querySelector(i);s&&this._forceFocus(s,r)}_takeFocus(){if(!this._focusTrap)return;let i=this._elementRef.nativeElement;switch(this.autoFocus){case!1:case"dialog":return;case!0:case"first-tabbable":_o(()=>{!this._focusTrap.focusInitialElement()&&typeof i.focus=="function"&&i.focus()},{injector:this._injector});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this.autoFocus);break}}_restoreFocus(i){this.autoFocus!=="dialog"&&(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,i):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null)}_isFocusWithinDrawer(){let i=this._doc.activeElement;return!!i&&this._elementRef.nativeElement.contains(i)}ngAfterViewInit(){this._isAttached=!0,this._position==="end"&&this._updatePositionInParent("end"),this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState())}ngOnDestroy(){this._eventCleanups.forEach(i=>i()),this._focusTrap?.destroy(),this._anchor?.remove(),this._anchor=null,this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(i){return this.toggle(!0,i)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0,"mouse")}toggle(i=!this.opened,r){i&&r&&(this._openedVia=r);let s=this._setOpen(i,!i&&this._isFocusWithinDrawer(),this._openedVia||"program");return i||(this._openedVia=null),s}_setOpen(i,r,s){return i===this._opened?Promise.resolve(i?"open":"close"):(this._opened=i,this._container?._transitionsEnabled?this._setIsAnimating(!0):setTimeout(()=>{this._animationStarted.next(),this._animationEnd.next()}),this._elementRef.nativeElement.classList.toggle("mat-drawer-opened",i),!i&&r&&this._restoreFocus(s),this._changeDetectorRef.markForCheck(),this._updateFocusTrapState(),new Promise(n=>{this.openedChange.pipe(Es(1)).subscribe(o=>n(o?"open":"close"))}))}_setIsAnimating(i){this._elementRef.nativeElement.classList.toggle("mat-drawer-animating",i)}_getWidth(){return this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=!!this._container?.hasBackdrop&&this.opened)}_updatePositionInParent(i){if(!this._platform.isBrowser)return;let r=this._elementRef.nativeElement,s=r.parentNode;i==="end"?(this._anchor||(this._anchor=this._doc.createComment("mat-drawer-anchor"),s.insertBefore(this._anchor,r)),s.appendChild(r)):this._anchor&&this._anchor.parentNode.insertBefore(r,this._anchor)}_handleTransitionEvent=i=>{let r=this._elementRef.nativeElement;i.target===r&&this._ngZone.run(()=>{i.type==="transitionrun"?this._animationStarted.next(i):(i.type==="transitionend"&&this._setIsAnimating(!1),this._animationEnd.next(i))})};static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["mat-drawer"]],viewQuery:function(r,s){if(r&1&&ws(M9,5),r&2){let n;Zt(n=Qt())&&(s._content=n.first)}},hostAttrs:["tabIndex","-1",1,"mat-drawer"],hostVars:11,hostBindings:function(r,s){r&2&&(Ri("align",null),vb("visibility",!s._container&&!s.opened?"hidden":null),Ui("mat-drawer-end",s.position==="end")("mat-drawer-over",s.mode==="over")("mat-drawer-push",s.mode==="push")("mat-drawer-side",s.mode==="side"))},inputs:{position:"position",mode:"mode",disableClose:"disableClose",autoFocus:"autoFocus",opened:"opened"},outputs:{openedChange:"openedChange",_openedStream:"opened",openedStart:"openedStart",_closedStream:"closed",closedStart:"closedStart",onPositionChanged:"positionChanged"},exportAs:["matDrawer"],ngContentSelectors:eH,decls:3,vars:0,consts:[["content",""],["cdkScrollable","",1,"mat-drawer-inner-container"]],template:function(r,s){r&1&&(gr(),De(0,"div",1,0),Gt(2),Ze())},dependencies:[jw],encapsulation:2,changeDetection:0})}return e})(),lA=(()=>{class e{_dir=M(Jn,{optional:!0});_element=M(Jt);_ngZone=M(vt);_changeDetectorRef=M(ls);_animationMode=M(bs,{optional:!0});_transitionsEnabled=!1;_allDrawers;_drawers=new Wh;_content;_userContent;get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(i){this._autosize=Lo(i)}_autosize=M(D9);get hasBackdrop(){return this._drawerHasBackdrop(this._start)||this._drawerHasBackdrop(this._end)}set hasBackdrop(i){this._backdropOverride=i==null?null:Lo(i)}_backdropOverride;backdropClick=new yi;_start;_end;_left;_right;_destroyed=new $e;_doCheckSubject=new $e;_contentMargins={left:null,right:null};_contentMarginChanges=new $e;get scrollable(){return this._userContent||this._content}_injector=M(wi);constructor(){let i=M(sr),r=M(uy);this._dir?.change.pipe(ki(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),r.change().pipe(ki(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._animationMode!=="NoopAnimations"&&i.isBrowser&&this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{this._element.nativeElement.classList.add("mat-drawer-transition"),this._transitionsEnabled=!0},200)})}ngAfterContentInit(){this._allDrawers.changes.pipe(dn(this._allDrawers),ki(this._destroyed)).subscribe(i=>{this._drawers.reset(i.filter(r=>!r._container||r._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe(dn(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(i=>{this._watchDrawerToggle(i),this._watchDrawerPosition(i),this._watchDrawerMode(i)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe(Xc(10),ki(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(i=>i.open())}close(){this._drawers.forEach(i=>i.close())}updateContentMargins(){let i=0,r=0;if(this._left&&this._left.opened){if(this._left.mode=="side")i+=this._left._getWidth();else if(this._left.mode=="push"){let s=this._left._getWidth();i+=s,r-=s}}if(this._right&&this._right.opened){if(this._right.mode=="side")r+=this._right._getWidth();else if(this._right.mode=="push"){let s=this._right._getWidth();r+=s,i-=s}}i=i||null,r=r||null,(i!==this._contentMargins.left||r!==this._contentMargins.right)&&(this._contentMargins={left:i,right:r},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(i){i._animationStarted.pipe(ki(this._drawers.changes)).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),i.mode!=="side"&&i.openedChange.pipe(ki(this._drawers.changes)).subscribe(()=>this._setContainerClass(i.opened))}_watchDrawerPosition(i){i.onPositionChanged.pipe(ki(this._drawers.changes)).subscribe(()=>{_o({read:()=>this._validateDrawers()},{injector:this._injector})})}_watchDrawerMode(i){i._modeChanged.pipe(ki(sa(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(i){let r=this._element.nativeElement.classList,s="mat-drawer-container-has-open";i?r.add(s):r.remove(s)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(i=>{i.position=="end"?(this._end!=null,this._end=i):(this._start!=null,this._start=i)}),this._right=this._left=null,this._dir&&this._dir.value==="rtl"?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&this._start.mode!="over"||this._isDrawerOpen(this._end)&&this._end.mode!="over"}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(i=>i&&!i.disableClose&&this._drawerHasBackdrop(i)).forEach(i=>i._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._drawerHasBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._drawerHasBackdrop(this._end)}_isDrawerOpen(i){return i!=null&&i.opened}_drawerHasBackdrop(i){return this._backdropOverride==null?!!i&&i.mode!=="side":this._backdropOverride}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["mat-drawer-container"]],contentQueries:function(r,s,n){if(r&1&&(Or(n,fy,5),Or(n,aA,5)),r&2){let o;Zt(o=Qt())&&(s._content=o.first),Zt(o=Qt())&&(s._allDrawers=o)}},viewQuery:function(r,s){if(r&1&&ws(fy,5),r&2){let n;Zt(n=Qt())&&(s._userContent=n.first)}},hostAttrs:[1,"mat-drawer-container"],hostVars:2,hostBindings:function(r,s){r&2&&Ui("mat-drawer-container-explicit-backdrop",s._backdropOverride)},inputs:{autosize:"autosize",hasBackdrop:"hasBackdrop"},outputs:{backdropClick:"backdropClick"},exportAs:["matDrawerContainer"],features:[Hs([{provide:tH,useExisting:e}])],ngContentSelectors:R9,decls:4,vars:2,consts:[[1,"mat-drawer-backdrop",3,"mat-drawer-shown"],[1,"mat-drawer-backdrop",3,"click"]],template:function(r,s){r&1&&(gr(E9),tr(0,A9,1,2,"div",0),Gt(1),Gt(2,1),tr(3,I9,2,0,"mat-drawer-content")),r&2&&(Mn(s.hasBackdrop?0:-1),Ft(3),Mn(s._content?-1:3))},dependencies:[fy],styles:[".mat-drawer-container{position:relative;z-index:1;color:var(--mat-sidenav-content-text-color, var(--mat-sys-on-background));background-color:var(--mat-sidenav-content-background-color, var(--mat-sys-background));box-sizing:border-box;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible;background-color:var(--mat-sidenav-scrim-color, color-mix(in srgb, var(--mat-sys-neutral-variant20) 40%, transparent))}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}@media(forced-colors: active){.mat-drawer-backdrop{opacity:.5}}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-content.mat-drawer-content-hidden{opacity:0}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;color:var(--mat-sidenav-container-text-color, var(--mat-sys-on-surface-variant));box-shadow:var(--mat-sidenav-container-elevation-shadow, none);background-color:var(--mat-sidenav-container-background-color, var(--mat-sys-surface));border-top-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));width:var(--mat-sidenav-container-width, 360px);display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}@media(forced-colors: active){.mat-drawer,[dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}}@media(forced-colors: active){[dir=rtl] .mat-drawer,.mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0);border-top-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-top-right-radius:0;border-bottom-right-radius:0}[dir=rtl] .mat-drawer{border-top-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-top-right-radius:0;border-bottom-right-radius:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{border-top-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-top-left-radius:0;border-bottom-left-radius:0;left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer-transition .mat-drawer{transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-drawer:not(.mat-drawer-opened):not(.mat-drawer-animating){visibility:hidden;box-shadow:none}.mat-drawer:not(.mat-drawer-opened):not(.mat-drawer-animating) .mat-drawer-inner-container{display:none}.mat-drawer.mat-drawer-opened{transform:none}.mat-drawer-side{box-shadow:none;border-right-color:var(--mat-sidenav-container-divider-color, transparent);border-right-width:1px;border-right-style:solid}.mat-drawer-side.mat-drawer-end{border-left-color:var(--mat-sidenav-container-divider-color, transparent);border-left-width:1px;border-left-style:solid;border-right:none}[dir=rtl] .mat-drawer-side{border-left-color:var(--mat-sidenav-container-divider-color, transparent);border-left-width:1px;border-left-style:solid;border-right:none}[dir=rtl] .mat-drawer-side.mat-drawer-end{border-right-color:var(--mat-sidenav-container-divider-color, transparent);border-right-width:1px;border-right-style:solid;border-left:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto}.mat-sidenav-fixed{position:fixed}"],encapsulation:2,changeDetection:0})}return e})();var iH=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({imports:[ur,$R,$R,ur]})}return e})();var k9=["mat-button",""],L9=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],F9=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var N9=new He("MAT_BUTTON_CONFIG");var V9=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],B9=(()=>{class e{_elementRef=M(Jt);_ngZone=M(vt);_animationMode=M(bs,{optional:!0});_focusMonitor=M(yl);_rippleLoader=M(Xw);_isFab=!1;color;get disableRipple(){return this._disableRipple}set disableRipple(i){this._disableRipple=i,this._updateRippleDisabled()}_disableRipple=!1;get disabled(){return this._disabled}set disabled(i){this._disabled=i,this._updateRippleDisabled()}_disabled=!1;ariaDisabled;disabledInteractive;constructor(){M(Os).load(_c);let i=M(N9,{optional:!0}),r=this._elementRef.nativeElement,s=r.classList;this.disabledInteractive=i?.disabledInteractive??!1,this.color=i?.color??null,this._rippleLoader?.configureRipple(r,{className:"mat-mdc-button-ripple"});for(let{attribute:n,mdcClasses:o}of V9)r.hasAttribute(n)&&s.add(...o)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(i="program",r){i?this._focusMonitor.focusVia(this._elementRef.nativeElement,i,r):this._elementRef.nativeElement.focus(r)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,inputs:{color:"color",disableRipple:[2,"disableRipple","disableRipple",It],disabled:[2,"disabled","disabled",It],ariaDisabled:[2,"aria-disabled","ariaDisabled",It],disabledInteractive:[2,"disabledInteractive","disabledInteractive",It]},features:[Yr]})}return e})();var rH=(()=>{class e extends B9{static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275cmp=it({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(r,s){r&2&&(Ri("disabled",s._getDisabledAttribute())("aria-disabled",s._getAriaDisabled()),Im(s.color?"mat-"+s.color:""),Ui("mat-mdc-button-disabled",s.disabled)("mat-mdc-button-disabled-interactive",s.disabledInteractive)("_mat-animation-noopable",s._animationMode==="NoopAnimations")("mat-unthemed",!s.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],features:[Kr],attrs:k9,ngContentSelectors:F9,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(r,s){r&1&&(gr(L9),pi(0,"span",0),Gt(1),De(2,"span",1),Gt(3,1),Ze(),Gt(4,2),pi(5,"span",2)(6,"span",3)),r&2&&Ui("mdc-button__ripple",!s._isFab)("mdc-fab__ripple",s._isFab)},styles:['.mat-mdc-button-base{text-decoration:none}.mdc-button{-webkit-user-select:none;user-select:none;position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0);padding:0 8px}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__label{position:relative}.mat-mdc-button{padding:0 var(--mat-text-button-horizontal-padding, 12px);height:var(--mdc-text-button-container-height, 40px);font-family:var(--mdc-text-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-text-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-text-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-text-button-label-text-transform);font-weight:var(--mdc-text-button-label-text-weight, var(--mat-sys-label-large-weight))}.mat-mdc-button,.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mat-sys-corner-full))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, var(--mat-sys-primary))}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 16px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, -4px);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, -4px);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, -4px)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color, var(--mat-sys-primary))}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display, block)}.mat-mdc-unelevated-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mdc-filled-button-container-height, 40px);font-family:var(--mdc-filled-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-filled-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-filled-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-filled-button-label-text-transform);font-weight:var(--mdc-filled-button-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-filled-button-horizontal-padding, 24px)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -8px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -8px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -8px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -8px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color, color-mix(in srgb, var(--mat-sys-on-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color, var(--mat-sys-on-primary))}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-unelevated-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-unelevated-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display, block)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, var(--mat-sys-on-primary));background-color:var(--mdc-filled-button-container-color, var(--mat-sys-primary))}.mat-mdc-unelevated-button,.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mat-sys-corner-full))}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mdc-filled-button-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);box-shadow:var(--mdc-protected-button-container-elevation-shadow, var(--mat-sys-level1));height:var(--mdc-protected-button-container-height, 40px);font-family:var(--mdc-protected-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-protected-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-protected-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-protected-button-label-text-transform);font-weight:var(--mdc-protected-button-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-protected-button-horizontal-padding, 24px)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -8px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -8px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -8px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -8px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color, var(--mat-sys-primary))}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-raised-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-raised-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display, block)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, var(--mat-sys-primary));background-color:var(--mdc-protected-button-container-color, var(--mat-sys-surface))}.mat-mdc-raised-button,.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mat-sys-corner-full))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow, var(--mat-sys-level2))}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mdc-protected-button-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow, var(--mat-sys-level0))}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mdc-outlined-button-container-height, 40px);font-family:var(--mdc-outlined-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-outlined-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-outlined-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-outlined-button-label-text-transform);font-weight:var(--mdc-outlined-button-label-text-weight, var(--mat-sys-label-large-weight));border-radius:var(--mdc-outlined-button-container-shape, var(--mat-sys-corner-full));border-width:var(--mdc-outlined-button-outline-width, 1px);padding:0 var(--mat-outlined-button-horizontal-padding, 24px)}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -8px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -8px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -8px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -8px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color, var(--mat-sys-primary))}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-outlined-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-outlined-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display, block)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, var(--mat-sys-primary));border-color:var(--mdc-outlined-button-outline-color, var(--mat-sys-outline))}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));border-color:var(--mdc-outlined-button-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button .mdc-button__ripple{border-width:var(--mdc-outlined-button-outline-width, 1px);border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-button .mat-icon,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-unelevated-button .mat-icon,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-raised-button .mat-icon,.mat-mdc-outlined-button .mdc-button__label,.mat-mdc-outlined-button .mat-icon{z-index:1;position:relative}.mat-mdc-button .mat-focus-indicator,.mat-mdc-unelevated-button .mat-focus-indicator,.mat-mdc-raised-button .mat-focus-indicator,.mat-mdc-outlined-button .mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus>.mat-focus-indicator::before,.mat-mdc-unelevated-button:focus>.mat-focus-indicator::before,.mat-mdc-raised-button:focus>.mat-focus-indicator::before,.mat-mdc-outlined-button:focus>.mat-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px}.mat-mdc-unelevated-button .mat-focus-indicator::before,.mat-mdc-raised-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}',"@media(forced-colors: active){.mat-mdc-button:not(.mdc-button--outlined),.mat-mdc-unelevated-button:not(.mdc-button--outlined),.mat-mdc-raised-button:not(.mdc-button--outlined),.mat-mdc-outlined-button:not(.mdc-button--outlined),.mat-mdc-icon-button.mat-mdc-icon-button{outline:solid 1px}}"],encapsulation:2,changeDetection:0})}return e})();var sH=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({imports:[ur,Fd,ur]})}return e})();var Jw=new He("");var U9={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Mae=se(I({},U9),{"[class.ng-submitted]":"isSubmitted"});var j9=["button"],G9=["*"];function q9(e,t){if(e&1&&(De(0,"div",2),pi(1,"mat-pseudo-checkbox",6),Ze()),e&2){let i=hn();Ft(),Mr("disabled",i.disabled)}}var nH=new He("MAT_BUTTON_TOGGLE_DEFAULT_OPTIONS",{providedIn:"root",factory:W9});function W9(){return{hideSingleSelectionIndicator:!1,hideMultipleSelectionIndicator:!1,disabledInteractive:!1}}var oH=new He("MatButtonToggleGroup"),$9={provide:Jw,useExisting:jh(()=>dA),multi:!0},ex=class{source;value;constructor(t,i){this.source=t,this.value=i}},dA=(()=>{class e{_changeDetector=M(ls);_dir=M(Jn,{optional:!0});_multiple=!1;_disabled=!1;_disabledInteractive=!1;_selectionModel;_rawValue;_controlValueAccessorChangeFn=()=>{};_onTouched=()=>{};_buttonToggles;appearance;get name(){return this._name}set name(i){this._name=i,this._markButtonsForCheck()}_name=M(vl).getId("mat-button-toggle-group-");vertical;get value(){let i=this._selectionModel?this._selectionModel.selected:[];return this.multiple?i.map(r=>r.value):i[0]?i[0].value:void 0}set value(i){this._setSelectionByValue(i),this.valueChange.emit(this.value)}valueChange=new yi;get selected(){let i=this._selectionModel?this._selectionModel.selected:[];return this.multiple?i:i[0]||null}get multiple(){return this._multiple}set multiple(i){this._multiple=i,this._markButtonsForCheck()}get disabled(){return this._disabled}set disabled(i){this._disabled=i,this._markButtonsForCheck()}get disabledInteractive(){return this._disabledInteractive}set disabledInteractive(i){this._disabledInteractive=i,this._markButtonsForCheck()}get dir(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}change=new yi;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(i){this._hideSingleSelectionIndicator=i,this._markButtonsForCheck()}_hideSingleSelectionIndicator;get hideMultipleSelectionIndicator(){return this._hideMultipleSelectionIndicator}set hideMultipleSelectionIndicator(i){this._hideMultipleSelectionIndicator=i,this._markButtonsForCheck()}_hideMultipleSelectionIndicator;constructor(){let i=M(nH,{optional:!0});this.appearance=i&&i.appearance?i.appearance:"standard",this.hideSingleSelectionIndicator=i?.hideSingleSelectionIndicator??!1,this.hideMultipleSelectionIndicator=i?.hideMultipleSelectionIndicator??!1}ngOnInit(){this._selectionModel=new Hw(this.multiple,void 0,!1)}ngAfterContentInit(){this._selectionModel.select(...this._buttonToggles.filter(i=>i.checked)),this.multiple||this._initializeTabIndex()}writeValue(i){this.value=i,this._changeDetector.markForCheck()}registerOnChange(i){this._controlValueAccessorChangeFn=i}registerOnTouched(i){this._onTouched=i}setDisabledState(i){this.disabled=i}_keydown(i){if(this.multiple||this.disabled)return;let s=i.target.id,n=this._buttonToggles.toArray().findIndex(a=>a.buttonId===s),o=null;switch(i.keyCode){case 32:case 13:o=this._buttonToggles.get(n)||null;break;case 38:o=this._getNextButton(n,-1);break;case 37:o=this._getNextButton(n,this.dir==="ltr"?-1:1);break;case 40:o=this._getNextButton(n,1);break;case 39:o=this._getNextButton(n,this.dir==="ltr"?1:-1);break;default:return}o&&(i.preventDefault(),o._onButtonClick(),o.focus())}_emitChangeEvent(i){let r=new ex(i,this.value);this._rawValue=r.value,this._controlValueAccessorChangeFn(r.value),this.change.emit(r)}_syncButtonToggle(i,r,s=!1,n=!1){!this.multiple&&this.selected&&!i.checked&&(this.selected.checked=!1),this._selectionModel?r?this._selectionModel.select(i):this._selectionModel.deselect(i):n=!0,n?Promise.resolve().then(()=>this._updateModelValue(i,s)):this._updateModelValue(i,s)}_isSelected(i){return this._selectionModel&&this._selectionModel.isSelected(i)}_isPrechecked(i){return typeof this._rawValue>"u"?!1:this.multiple&&Array.isArray(this._rawValue)?this._rawValue.some(r=>i.value!=null&&r===i.value):i.value===this._rawValue}_initializeTabIndex(){if(this._buttonToggles.forEach(i=>{i.tabIndex=-1}),this.selected)this.selected.tabIndex=0;else for(let i=0;i<this._buttonToggles.length;i++){let r=this._buttonToggles.get(i);if(!r.disabled){r.tabIndex=0;break}}this._markButtonsForCheck()}_getNextButton(i,r){let s=this._buttonToggles;for(let n=1;n<=s.length;n++){let o=(i+r*n+s.length)%s.length,a=s.get(o);if(a&&!a.disabled)return a}return null}_setSelectionByValue(i){if(this._rawValue=i,!this._buttonToggles)return;let r=this._buttonToggles.toArray();if(this.multiple&&i?(Array.isArray(i),this._clearSelection(),i.forEach(s=>this._selectValue(s,r))):(this._clearSelection(),this._selectValue(i,r)),!this.multiple&&r.every(s=>s.tabIndex===-1)){for(let s of r)if(!s.disabled){s.tabIndex=0;break}}}_clearSelection(){this._selectionModel.clear(),this._buttonToggles.forEach(i=>{i.checked=!1,this.multiple||(i.tabIndex=-1)})}_selectValue(i,r){for(let s of r)if(s.value!=null&&s.value===i){s.checked=!0,this._selectionModel.select(s),this.multiple||(s.tabIndex=0);break}}_updateModelValue(i,r){r&&this._emitChangeEvent(i),this.valueChange.emit(this.value)}_markButtonsForCheck(){this._buttonToggles?.forEach(i=>i._markForCheck())}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,selectors:[["mat-button-toggle-group"]],contentQueries:function(r,s,n){if(r&1&&Or(n,tx,5),r&2){let o;Zt(o=Qt())&&(s._buttonToggles=o)}},hostAttrs:[1,"mat-button-toggle-group"],hostVars:6,hostBindings:function(r,s){r&1&&qi("keydown",function(o){return s._keydown(o)}),r&2&&(Ri("role",s.multiple?"group":"radiogroup")("aria-disabled",s.disabled),Ui("mat-button-toggle-vertical",s.vertical)("mat-button-toggle-group-appearance-standard",s.appearance==="standard"))},inputs:{appearance:"appearance",name:"name",vertical:[2,"vertical","vertical",It],value:"value",multiple:[2,"multiple","multiple",It],disabled:[2,"disabled","disabled",It],disabledInteractive:[2,"disabledInteractive","disabledInteractive",It],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",It],hideMultipleSelectionIndicator:[2,"hideMultipleSelectionIndicator","hideMultipleSelectionIndicator",It]},outputs:{valueChange:"valueChange",change:"change"},exportAs:["matButtonToggleGroup"],features:[Hs([$9,{provide:oH,useExisting:e}]),Yr]})}return e})(),tx=(()=>{class e{_changeDetectorRef=M(ls);_elementRef=M(Jt);_focusMonitor=M(yl);_idGenerator=M(vl);_animationMode=M(bs,{optional:!0});_checked=!1;ariaLabel;ariaLabelledby=null;_buttonElement;buttonToggleGroup;get buttonId(){return`${this.id}-button`}id;name;value;get tabIndex(){return this._tabIndex}set tabIndex(i){i!==this._tabIndex&&(this._tabIndex=i,this._markForCheck())}_tabIndex;disableRipple;get appearance(){return this.buttonToggleGroup?this.buttonToggleGroup.appearance:this._appearance}set appearance(i){this._appearance=i}_appearance;get checked(){return this.buttonToggleGroup?this.buttonToggleGroup._isSelected(this):this._checked}set checked(i){i!==this._checked&&(this._checked=i,this.buttonToggleGroup&&this.buttonToggleGroup._syncButtonToggle(this,this._checked),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled||this.buttonToggleGroup&&this.buttonToggleGroup.disabled}set disabled(i){this._disabled=i}_disabled=!1;get disabledInteractive(){return this._disabledInteractive||this.buttonToggleGroup!==null&&this.buttonToggleGroup.disabledInteractive}set disabledInteractive(i){this._disabledInteractive=i}_disabledInteractive;change=new yi;constructor(){M(Os).load(_c);let i=M(oH,{optional:!0}),r=M(new _b("tabindex"),{optional:!0})||"",s=M(nH,{optional:!0});this._tabIndex=parseInt(r)||0,this.buttonToggleGroup=i,this.appearance=s&&s.appearance?s.appearance:"standard",this.disabledInteractive=s?.disabledInteractive??!1}ngOnInit(){let i=this.buttonToggleGroup;this.id=this.id||this._idGenerator.getId("mat-button-toggle-"),i&&(i._isPrechecked(this)?this.checked=!0:i._isSelected(this)!==this._checked&&i._syncButtonToggle(this,this._checked))}ngAfterViewInit(){this._animationMode!=="NoopAnimations"&&this._elementRef.nativeElement.classList.add("mat-button-toggle-animations-enabled"),this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){let i=this.buttonToggleGroup;this._focusMonitor.stopMonitoring(this._elementRef),i&&i._isSelected(this)&&i._syncButtonToggle(this,!1,!1,!0)}focus(i){this._buttonElement.nativeElement.focus(i)}_onButtonClick(){if(this.disabled)return;let i=this.isSingleSelector()?!0:!this._checked;if(i!==this._checked&&(this._checked=i,this.buttonToggleGroup&&(this.buttonToggleGroup._syncButtonToggle(this,this._checked,!0),this.buttonToggleGroup._onTouched())),this.isSingleSelector()){let r=this.buttonToggleGroup._buttonToggles.find(s=>s.tabIndex===0);r&&(r.tabIndex=-1),this.tabIndex=0}this.change.emit(new ex(this,this.value))}_markForCheck(){this._changeDetectorRef.markForCheck()}_getButtonName(){return this.isSingleSelector()?this.buttonToggleGroup.name:this.name||null}isSingleSelector(){return this.buttonToggleGroup&&!this.buttonToggleGroup.multiple}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["mat-button-toggle"]],viewQuery:function(r,s){if(r&1&&ws(j9,5),r&2){let n;Zt(n=Qt())&&(s._buttonElement=n.first)}},hostAttrs:["role","presentation",1,"mat-button-toggle"],hostVars:14,hostBindings:function(r,s){r&1&&qi("focus",function(){return s.focus()}),r&2&&(Ri("aria-label",null)("aria-labelledby",null)("id",s.id)("name",null),Ui("mat-button-toggle-standalone",!s.buttonToggleGroup)("mat-button-toggle-checked",s.checked)("mat-button-toggle-disabled",s.disabled)("mat-button-toggle-disabled-interactive",s.disabledInteractive)("mat-button-toggle-appearance-standard",s.appearance==="standard"))},inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],id:"id",name:"name",value:"value",tabIndex:"tabIndex",disableRipple:[2,"disableRipple","disableRipple",It],appearance:"appearance",checked:[2,"checked","checked",It],disabled:[2,"disabled","disabled",It],disabledInteractive:[2,"disabledInteractive","disabledInteractive",It]},outputs:{change:"change"},exportAs:["matButtonToggle"],features:[Yr],ngContentSelectors:G9,decls:7,vars:13,consts:[["button",""],["type","button",1,"mat-button-toggle-button","mat-focus-indicator",3,"click","id","disabled"],[1,"mat-button-toggle-checkbox-wrapper"],[1,"mat-button-toggle-label-content"],[1,"mat-button-toggle-focus-overlay"],["matRipple","",1,"mat-button-toggle-ripple",3,"matRippleTrigger","matRippleDisabled"],["state","checked","aria-hidden","true","appearance","minimal",3,"disabled"]],template:function(r,s){if(r&1){let n=aa();gr(),De(0,"button",1,0),qi("click",function(){return na(n),oa(s._onButtonClick())}),tr(2,q9,2,1,"div",2),De(3,"span",3),Gt(4),Ze()(),pi(5,"span",4)(6,"span",5)}if(r&2){let n=dM(1);Mr("id",s.buttonId)("disabled",s.disabled&&!s.disabledInteractive||null),Ri("role",s.isSingleSelector()?"radio":"button")("tabindex",s.disabled&&!s.disabledInteractive?-1:s.tabIndex)("aria-pressed",s.isSingleSelector()?null:s.checked)("aria-checked",s.isSingleSelector()?s.checked:null)("name",s._getButtonName())("aria-label",s.ariaLabel)("aria-labelledby",s.ariaLabelledby)("aria-disabled",s.disabled&&s.disabledInteractive?"true":null),Ft(2),Mn(s.buttonToggleGroup&&(!s.buttonToggleGroup.multiple&&!s.buttonToggleGroup.hideSingleSelectionIndicator||s.buttonToggleGroup.multiple&&!s.buttonToggleGroup.hideMultipleSelectionIndicator)?2:-1),Ft(4),Mr("matRippleTrigger",n)("matRippleDisabled",s.disableRipple||s.disabled)}},dependencies:[YU,XU],styles:[".mat-button-toggle-standalone,.mat-button-toggle-group{position:relative;display:inline-flex;flex-direction:row;white-space:nowrap;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0);transform:translateZ(0);border-radius:var(--mat-legacy-button-toggle-shape)}.mat-button-toggle-standalone:not([class*=mat-elevation-z]),.mat-button-toggle-group:not([class*=mat-elevation-z]){box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)}@media(forced-colors: active){.mat-button-toggle-standalone,.mat-button-toggle-group{outline:solid 1px}}.mat-button-toggle-standalone.mat-button-toggle-appearance-standard,.mat-button-toggle-group-appearance-standard{border-radius:var(--mat-standard-button-toggle-shape, var(--mat-sys-corner-full));border:solid 1px var(--mat-standard-button-toggle-divider-color, var(--mat-sys-outline))}.mat-button-toggle-standalone.mat-button-toggle-appearance-standard .mat-pseudo-checkbox,.mat-button-toggle-group-appearance-standard .mat-pseudo-checkbox{--mat-minimal-pseudo-checkbox-selected-checkmark-color: var(--mat-standard-button-toggle-selected-state-text-color, var(--mat-sys-on-secondary-container))}.mat-button-toggle-standalone.mat-button-toggle-appearance-standard:not([class*=mat-elevation-z]),.mat-button-toggle-group-appearance-standard:not([class*=mat-elevation-z]){box-shadow:none}@media(forced-colors: active){.mat-button-toggle-standalone.mat-button-toggle-appearance-standard,.mat-button-toggle-group-appearance-standard{outline:0}}.mat-button-toggle-vertical{flex-direction:column}.mat-button-toggle-vertical .mat-button-toggle-label-content{display:block}.mat-button-toggle{white-space:nowrap;position:relative;color:var(--mat-legacy-button-toggle-text-color);font-family:var(--mat-legacy-button-toggle-label-text-font);font-size:var(--mat-legacy-button-toggle-label-text-size);line-height:var(--mat-legacy-button-toggle-label-text-line-height);font-weight:var(--mat-legacy-button-toggle-label-text-weight);letter-spacing:var(--mat-legacy-button-toggle-label-text-tracking);--mat-minimal-pseudo-checkbox-selected-checkmark-color: var(--mat-legacy-button-toggle-selected-state-text-color)}.mat-button-toggle.cdk-keyboard-focused .mat-button-toggle-focus-overlay{opacity:var(--mat-legacy-button-toggle-focus-state-layer-opacity)}.mat-button-toggle .mat-icon svg{vertical-align:top}.mat-button-toggle-checkbox-wrapper{display:inline-block;justify-content:flex-start;align-items:center;width:0;height:18px;line-height:18px;overflow:hidden;box-sizing:border-box;position:absolute;top:50%;left:16px;transform:translate3d(0, -50%, 0)}[dir=rtl] .mat-button-toggle-checkbox-wrapper{left:auto;right:16px}.mat-button-toggle-appearance-standard .mat-button-toggle-checkbox-wrapper{left:12px}[dir=rtl] .mat-button-toggle-appearance-standard .mat-button-toggle-checkbox-wrapper{left:auto;right:12px}.mat-button-toggle-checked .mat-button-toggle-checkbox-wrapper{width:18px}.mat-button-toggle-animations-enabled .mat-button-toggle-checkbox-wrapper{transition:width 150ms 45ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-button-toggle-vertical .mat-button-toggle-checkbox-wrapper{transition:none}.mat-button-toggle-checked{color:var(--mat-legacy-button-toggle-selected-state-text-color);background-color:var(--mat-legacy-button-toggle-selected-state-background-color)}.mat-button-toggle-disabled{pointer-events:none;color:var(--mat-legacy-button-toggle-disabled-state-text-color);background-color:var(--mat-legacy-button-toggle-disabled-state-background-color);--mat-minimal-pseudo-checkbox-disabled-selected-checkmark-color: var(--mat-legacy-button-toggle-disabled-state-text-color)}.mat-button-toggle-disabled.mat-button-toggle-checked{background-color:var(--mat-legacy-button-toggle-disabled-selected-state-background-color)}.mat-button-toggle-disabled-interactive{pointer-events:auto}.mat-button-toggle-appearance-standard{color:var(--mat-standard-button-toggle-text-color, var(--mat-sys-on-surface));background-color:var(--mat-standard-button-toggle-background-color, transparent);font-family:var(--mat-standard-button-toggle-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-standard-button-toggle-label-text-size, var(--mat-sys-label-large-size));line-height:var(--mat-standard-button-toggle-label-text-line-height, var(--mat-sys-label-large-line-height));font-weight:var(--mat-standard-button-toggle-label-text-weight, var(--mat-sys-label-large-weight));letter-spacing:var(--mat-standard-button-toggle-label-text-tracking, var(--mat-sys-label-large-tracking))}.mat-button-toggle-group-appearance-standard .mat-button-toggle-appearance-standard+.mat-button-toggle-appearance-standard{border-left:solid 1px var(--mat-standard-button-toggle-divider-color, var(--mat-sys-outline))}[dir=rtl] .mat-button-toggle-group-appearance-standard .mat-button-toggle-appearance-standard+.mat-button-toggle-appearance-standard{border-left:none;border-right:solid 1px var(--mat-standard-button-toggle-divider-color, var(--mat-sys-outline))}.mat-button-toggle-group-appearance-standard.mat-button-toggle-vertical .mat-button-toggle-appearance-standard+.mat-button-toggle-appearance-standard{border-left:none;border-right:none;border-top:solid 1px var(--mat-standard-button-toggle-divider-color, var(--mat-sys-outline))}.mat-button-toggle-appearance-standard.mat-button-toggle-checked{color:var(--mat-standard-button-toggle-selected-state-text-color, var(--mat-sys-on-secondary-container));background-color:var(--mat-standard-button-toggle-selected-state-background-color, var(--mat-sys-secondary-container))}.mat-button-toggle-appearance-standard.mat-button-toggle-disabled{color:var(--mat-standard-button-toggle-disabled-state-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-standard-button-toggle-disabled-state-background-color, transparent)}.mat-button-toggle-appearance-standard.mat-button-toggle-disabled .mat-pseudo-checkbox{--mat-minimal-pseudo-checkbox-disabled-selected-checkmark-color: var(--mat-standard-button-toggle-disabled-selected-state-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-button-toggle-appearance-standard.mat-button-toggle-disabled.mat-button-toggle-checked{color:var(--mat-standard-button-toggle-disabled-selected-state-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-standard-button-toggle-disabled-selected-state-background-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-button-toggle-appearance-standard .mat-button-toggle-focus-overlay{background-color:var(--mat-standard-button-toggle-state-layer-color, var(--mat-sys-on-surface))}.mat-button-toggle-appearance-standard:hover .mat-button-toggle-focus-overlay{opacity:var(--mat-standard-button-toggle-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-button-toggle-appearance-standard.cdk-keyboard-focused .mat-button-toggle-focus-overlay{opacity:var(--mat-standard-button-toggle-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}@media(hover: none){.mat-button-toggle-appearance-standard:hover .mat-button-toggle-focus-overlay{display:none}}.mat-button-toggle-label-content{-webkit-user-select:none;user-select:none;display:inline-block;padding:0 16px;line-height:var(--mat-legacy-button-toggle-height);position:relative}.mat-button-toggle-appearance-standard .mat-button-toggle-label-content{padding:0 12px;line-height:var(--mat-standard-button-toggle-height, 40px)}.mat-button-toggle-label-content>*{vertical-align:middle}.mat-button-toggle-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:inherit;pointer-events:none;opacity:0;background-color:var(--mat-legacy-button-toggle-state-layer-color)}@media(forced-colors: active){.mat-button-toggle-checked .mat-button-toggle-focus-overlay{border-bottom:solid 500px;opacity:.5;height:0}.mat-button-toggle-checked:hover .mat-button-toggle-focus-overlay{opacity:.6}.mat-button-toggle-checked.mat-button-toggle-appearance-standard .mat-button-toggle-focus-overlay{border-bottom:solid 500px}}.mat-button-toggle .mat-button-toggle-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-button-toggle-button{border:0;background:none;color:inherit;padding:0;margin:0;font:inherit;outline:none;width:100%;cursor:pointer}.mat-button-toggle-animations-enabled .mat-button-toggle-button{transition:padding 150ms 45ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-button-toggle-vertical .mat-button-toggle-button{transition:none}.mat-button-toggle-disabled .mat-button-toggle-button{cursor:default}.mat-button-toggle-button::-moz-focus-inner{border:0}.mat-button-toggle-checked .mat-button-toggle-button:has(.mat-button-toggle-checkbox-wrapper){padding-left:30px}[dir=rtl] .mat-button-toggle-checked .mat-button-toggle-button:has(.mat-button-toggle-checkbox-wrapper){padding-left:0;padding-right:30px}.mat-button-toggle-standalone.mat-button-toggle-appearance-standard{--mat-focus-indicator-border-radius:var(--mat-standard-button-toggle-shape, var(--mat-sys-corner-full))}.mat-button-toggle-group-appearance-standard:not(.mat-button-toggle-vertical) .mat-button-toggle:last-of-type .mat-button-toggle-button::before{border-top-right-radius:var(--mat-standard-button-toggle-shape, var(--mat-sys-corner-full));border-bottom-right-radius:var(--mat-standard-button-toggle-shape, var(--mat-sys-corner-full))}.mat-button-toggle-group-appearance-standard:not(.mat-button-toggle-vertical) .mat-button-toggle:first-of-type .mat-button-toggle-button::before{border-top-left-radius:var(--mat-standard-button-toggle-shape, var(--mat-sys-corner-full));border-bottom-left-radius:var(--mat-standard-button-toggle-shape, var(--mat-sys-corner-full))}.mat-button-toggle-group-appearance-standard.mat-button-toggle-vertical .mat-button-toggle:last-of-type .mat-button-toggle-button::before{border-bottom-right-radius:var(--mat-standard-button-toggle-shape, var(--mat-sys-corner-full));border-bottom-left-radius:var(--mat-standard-button-toggle-shape, var(--mat-sys-corner-full))}.mat-button-toggle-group-appearance-standard.mat-button-toggle-vertical .mat-button-toggle:first-of-type .mat-button-toggle-button::before{border-top-right-radius:var(--mat-standard-button-toggle-shape, var(--mat-sys-corner-full));border-top-left-radius:var(--mat-standard-button-toggle-shape, var(--mat-sys-corner-full))}"],encapsulation:2,changeDetection:0})}return e})(),aH=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({imports:[ur,Fd,tx,ur]})}return e})();var hH=["*",[["mat-chip-avatar"],["","matChipAvatar",""]],[["mat-chip-trailing-icon"],["","matChipRemove",""],["","matChipTrailingIcon",""]]],uH=["*","mat-chip-avatar, [matChipAvatar]","mat-chip-trailing-icon,[matChipRemove],[matChipTrailingIcon]"];function Q9(e,t){e&1&&(De(0,"span",3),Gt(1,1),Ze())}function K9(e,t){e&1&&(De(0,"span",6),Gt(1,2),Ze())}function Y9(e,t){e&1&&(De(0,"span",3),Gt(1,1),De(2,"span",8),tM(),De(3,"svg",9),pi(4,"path",10),Ze()()())}function X9(e,t){e&1&&(De(0,"span",6),Gt(1,2),Ze())}var J9='.mdc-evolution-chip,.mdc-evolution-chip__cell,.mdc-evolution-chip__action{display:inline-flex;align-items:center}.mdc-evolution-chip{position:relative;max-width:100%}.mdc-evolution-chip__cell,.mdc-evolution-chip__action{height:100%}.mdc-evolution-chip__cell--primary{flex-basis:100%;overflow-x:hidden}.mdc-evolution-chip__cell--trailing{flex:1 0 auto}.mdc-evolution-chip__action{align-items:center;background:none;border:none;box-sizing:content-box;cursor:pointer;display:inline-flex;justify-content:center;outline:none;padding:0;text-decoration:none;color:inherit}.mdc-evolution-chip__action--presentational{cursor:auto}.mdc-evolution-chip--disabled,.mdc-evolution-chip__action:disabled{pointer-events:none}.mdc-evolution-chip__action--primary{font:inherit;letter-spacing:inherit;white-space:inherit;overflow-x:hidden}.mat-mdc-standard-chip .mdc-evolution-chip__action--primary::before{border-width:var(--mdc-chip-outline-width, 1px);border-radius:var(--mdc-chip-container-shape-radius, 8px);box-sizing:border-box;content:"";height:100%;left:0;position:absolute;pointer-events:none;top:0;width:100%;z-index:1;border-style:solid}.mat-mdc-standard-chip .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:12px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__action--primary::before{border-color:var(--mdc-chip-outline-color, var(--mat-sys-outline))}.mdc-evolution-chip__action--primary:not(.mdc-evolution-chip__action--presentational):not(.mdc-ripple-upgraded):focus::before{border-color:var(--mdc-chip-focus-outline-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__action--primary::before{border-color:var(--mdc-chip-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-standard-chip.mdc-evolution-chip--selected .mdc-evolution-chip__action--primary::before{border-width:var(--mdc-chip-flat-selected-outline-width, 0)}.mat-mdc-basic-chip .mdc-evolution-chip__action--primary{font:inherit}.mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}.mdc-evolution-chip__action--trailing{position:relative;overflow:visible}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__action--trailing{color:var(--mdc-chip-with-trailing-icon-trailing-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__action--trailing{color:var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-color, var(--mat-sys-on-surface))}.mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mdc-evolution-chip__text-label{-webkit-user-select:none;user-select:none;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.mat-mdc-standard-chip .mdc-evolution-chip__text-label{font-family:var(--mdc-chip-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mdc-chip-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mdc-chip-label-text-size, var(--mat-sys-label-large-size));font-weight:var(--mdc-chip-label-text-weight, var(--mat-sys-label-large-weight));letter-spacing:var(--mdc-chip-label-text-tracking, var(--mat-sys-label-large-tracking))}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__text-label{color:var(--mdc-chip-label-text-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--selected:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__text-label{color:var(--mdc-chip-selected-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__text-label,.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled .mdc-evolution-chip__text-label{color:var(--mdc-chip-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mdc-evolution-chip__graphic{align-items:center;display:inline-flex;justify-content:center;overflow:hidden;pointer-events:none;position:relative;flex:1 0 auto}.mat-mdc-standard-chip .mdc-evolution-chip__graphic{width:var(--mdc-chip-with-avatar-avatar-size, 24px);height:var(--mdc-chip-with-avatar-avatar-size, 24px);font-size:var(--mdc-chip-with-avatar-avatar-size, 24px)}.mdc-evolution-chip--selecting .mdc-evolution-chip__graphic{transition:width 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-evolution-chip--selectable:not(.mdc-evolution-chip--selected):not(.mdc-evolution-chip--with-primary-icon) .mdc-evolution-chip__graphic{width:0}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:6px;padding-right:6px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:4px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:8px;padding-right:4px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:6px;padding-right:6px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:4px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:8px;padding-right:4px}.mdc-evolution-chip__checkmark{position:absolute;opacity:0;top:50%;left:50%;height:20px;width:20px}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__checkmark{color:var(--mdc-chip-with-icon-selected-icon-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__checkmark{color:var(--mdc-chip-with-icon-disabled-icon-color, var(--mat-sys-on-surface))}.mdc-evolution-chip--selecting .mdc-evolution-chip__checkmark{transition:transform 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1);transform:translate(-75%, -50%)}.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark{transform:translate(-50%, -50%);opacity:1}.mdc-evolution-chip__checkmark-svg{display:block}.mdc-evolution-chip__checkmark-path{stroke-width:2px;stroke-dasharray:29.7833385;stroke-dashoffset:29.7833385;stroke:currentColor}.mdc-evolution-chip--selecting .mdc-evolution-chip__checkmark-path{transition:stroke-dashoffset 150ms 45ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark-path{stroke-dashoffset:0}@media(forced-colors: active){.mdc-evolution-chip__checkmark-path{stroke:CanvasText !important}}.mat-mdc-standard-chip .mdc-evolution-chip__icon--trailing{height:18px;width:18px;font-size:18px}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing.mat-mdc-chip-remove{opacity:calc(var(--mat-chip-trailing-action-opacity, 1)*var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38))}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing.mat-mdc-chip-remove:focus{opacity:calc(var(--mat-chip-trailing-action-focus-opacity, 1)*var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38))}.mat-mdc-standard-chip{border-radius:var(--mdc-chip-container-shape-radius, 8px);height:var(--mdc-chip-container-height, 32px)}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled){background-color:var(--mdc-chip-elevated-container-color, transparent)}.mat-mdc-standard-chip.mdc-evolution-chip--disabled{background-color:var(--mdc-chip-elevated-disabled-container-color)}.mat-mdc-standard-chip.mdc-evolution-chip--selected:not(.mdc-evolution-chip--disabled){background-color:var(--mdc-chip-elevated-selected-container-color, var(--mat-sys-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled{background-color:var(--mdc-chip-flat-disabled-selected-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}@media(forced-colors: active){.mat-mdc-standard-chip{outline:solid 1px}}.mat-mdc-standard-chip .mdc-evolution-chip__icon--primary{border-radius:var(--mdc-chip-with-avatar-avatar-shape-radius, 24px);width:var(--mdc-chip-with-icon-icon-size, 18px);height:var(--mdc-chip-with-icon-icon-size, 18px);font-size:var(--mdc-chip-with-icon-icon-size, 18px)}.mdc-evolution-chip--selected .mdc-evolution-chip__icon--primary{opacity:0}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__icon--primary{color:var(--mdc-chip-with-icon-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--primary{color:var(--mdc-chip-with-icon-disabled-icon-color, var(--mat-sys-on-surface))}.mat-mdc-chip-highlighted{--mdc-chip-with-icon-icon-color:var(--mdc-chip-with-icon-selected-icon-color, var(--mat-sys-on-secondary-container));--mdc-chip-elevated-container-color:var(--mdc-chip-elevated-selected-container-color, var(--mat-sys-secondary-container));--mdc-chip-label-text-color:var(--mdc-chip-selected-label-text-color, var(--mat-sys-on-secondary-container));--mdc-chip-outline-width:var(--mdc-chip-flat-selected-outline-width, 0)}.mat-mdc-chip-focus-overlay{background:var(--mdc-chip-focus-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-chip-selected .mat-mdc-chip-focus-overlay,.mat-mdc-chip-highlighted .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-focus-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-mdc-chip:hover .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-hover-state-layer-color, var(--mat-sys-on-surface-variant));opacity:var(--mdc-chip-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip-focus-overlay .mat-mdc-chip-selected:hover,.mat-mdc-chip-highlighted:hover .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-hover-state-layer-color, var(--mat-sys-on-secondary-container));opacity:var(--mdc-chip-selected-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip.cdk-focused .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-focus-state-layer-color, var(--mat-sys-on-surface-variant));opacity:var(--mdc-chip-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-chip-selected.cdk-focused .mat-mdc-chip-focus-overlay,.mat-mdc-chip-highlighted.cdk-focused .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-focus-state-layer-color, var(--mat-sys-on-secondary-container));opacity:var(--mdc-chip-selected-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mdc-evolution-chip--disabled:not(.mdc-evolution-chip--selected) .mat-mdc-chip-avatar{opacity:var(--mdc-chip-with-avatar-disabled-avatar-opacity, 0.38)}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing{opacity:var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38)}.mdc-evolution-chip--disabled.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark{opacity:var(--mdc-chip-with-icon-disabled-icon-opacity, 0.38)}.mat-mdc-standard-chip.mdc-evolution-chip--disabled{opacity:var(--mat-chip-disabled-container-opacity, 1)}.mat-mdc-standard-chip.mdc-evolution-chip--selected .mdc-evolution-chip__icon--trailing,.mat-mdc-standard-chip.mat-mdc-chip-highlighted .mdc-evolution-chip__icon--trailing{color:var(--mat-chip-selected-trailing-icon-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing,.mat-mdc-standard-chip.mat-mdc-chip-highlighted.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing{color:var(--mat-chip-selected-disabled-trailing-icon-color, var(--mat-sys-on-surface))}.mat-mdc-chip-remove{opacity:var(--mat-chip-trailing-action-opacity, 1)}.mat-mdc-chip-remove:focus{opacity:var(--mat-chip-trailing-action-focus-opacity, 1)}.mat-mdc-chip-remove::after{background-color:var(--mat-chip-trailing-action-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-chip-remove:hover::after{opacity:var(--mat-chip-trailing-action-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip-remove:focus::after{opacity:var(--mat-chip-trailing-action-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-chip-selected .mat-mdc-chip-remove::after,.mat-mdc-chip-highlighted .mat-mdc-chip-remove::after{background-color:var(--mat-chip-selected-trailing-action-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-standard-chip .mdc-evolution-chip__cell--primary,.mat-mdc-standard-chip .mdc-evolution-chip__action--primary,.mat-mdc-standard-chip .mat-mdc-chip-action-label{overflow:visible}.mat-mdc-standard-chip .mat-mdc-chip-graphic,.mat-mdc-standard-chip .mat-mdc-chip-trailing-icon{box-sizing:content-box}.mat-mdc-standard-chip._mat-animation-noopable,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__graphic,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__checkmark,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__checkmark-path{transition-duration:1ms;animation-duration:1ms}.mat-mdc-chip-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;opacity:0;border-radius:inherit;transition:opacity 150ms linear}._mat-animation-noopable .mat-mdc-chip-focus-overlay{transition:none}.mat-mdc-basic-chip .mat-mdc-chip-focus-overlay{display:none}.mat-mdc-chip .mat-ripple.mat-mdc-chip-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-chip-avatar{text-align:center;line-height:1;color:var(--mdc-chip-with-icon-icon-color, currentColor)}.mat-mdc-chip{position:relative;z-index:0}.mat-mdc-chip-action-label{text-align:left;z-index:1}[dir=rtl] .mat-mdc-chip-action-label{text-align:right}.mat-mdc-chip.mdc-evolution-chip--with-trailing-action .mat-mdc-chip-action-label{position:relative}.mat-mdc-chip-action-label .mat-mdc-chip-primary-focus-indicator{position:absolute;top:0;right:0;bottom:0;left:0;pointer-events:none}.mat-mdc-chip-action-label .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-chip-remove::before{margin:calc(var(--mat-focus-indicator-border-width, 3px)*-1);left:8px;right:8px}.mat-mdc-chip-remove::after{content:"";display:block;opacity:0;position:absolute;top:-3px;bottom:-3px;left:5px;right:5px;border-radius:50%;box-sizing:border-box;padding:12px;margin:-12px;background-clip:content-box}.mat-mdc-chip-remove .mat-icon{width:18px;height:18px;font-size:18px;box-sizing:content-box}.mat-chip-edit-input{cursor:text;display:inline-block;color:inherit;outline:0}@media(forced-colors: active){.mat-mdc-chip-selected:not(.mat-mdc-chip-multiple){outline-width:3px}}.mat-mdc-chip-action:focus .mat-focus-indicator::before{content:""}';var mH=["*"],eZ=".mat-mdc-chip-set{display:flex}.mat-mdc-chip-set:focus{outline:none}.mat-mdc-chip-set .mdc-evolution-chip-set__chips{min-width:100%;margin-left:-8px;margin-right:0}.mat-mdc-chip-set .mdc-evolution-chip{margin:4px 0 4px 8px}[dir=rtl] .mat-mdc-chip-set .mdc-evolution-chip-set__chips{margin-left:0;margin-right:-8px}[dir=rtl] .mat-mdc-chip-set .mdc-evolution-chip{margin-left:0;margin-right:8px}.mdc-evolution-chip-set__chips{display:flex;flex-flow:wrap;min-width:0}.mat-mdc-chip-set-stacked{flex-direction:column;align-items:flex-start}.mat-mdc-chip-set-stacked .mat-mdc-chip{width:100%}.mat-mdc-chip-set-stacked .mdc-evolution-chip__graphic{flex-grow:0}.mat-mdc-chip-set-stacked .mdc-evolution-chip__action--primary{flex-basis:100%;justify-content:start}input.mat-mdc-chip-input{flex:1 0 150px;margin-left:8px}[dir=rtl] input.mat-mdc-chip-input{margin-left:0;margin-right:8px}",pA=new He("mat-chips-default-options",{providedIn:"root",factory:()=>({separatorKeyCodes:[13]})}),lH=new He("MatChipAvatar"),cH=new He("MatChipTrailingIcon"),dH=new He("MatChipRemove"),fA=new He("MatChip"),hA=(()=>{class e{_elementRef=M(Jt);_parentChip=M(fA);isInteractive=!0;_isPrimary=!0;get disabled(){return this._disabled||this._parentChip?.disabled||!1}set disabled(i){this._disabled=i}_disabled=!1;tabIndex=-1;_allowFocusWhenDisabled=!1;_getDisabledAttribute(){return this.disabled&&!this._allowFocusWhenDisabled?"":null}_getTabindex(){return this.disabled&&!this._allowFocusWhenDisabled||!this.isInteractive?null:this.tabIndex.toString()}constructor(){M(Os).load(_c),this._elementRef.nativeElement.nodeName==="BUTTON"&&this._elementRef.nativeElement.setAttribute("type","button")}focus(){this._elementRef.nativeElement.focus()}_handleClick(i){!this.disabled&&this.isInteractive&&this._isPrimary&&(i.preventDefault(),this._parentChip._handlePrimaryActionInteraction())}_handleKeydown(i){(i.keyCode===13||i.keyCode===32)&&!this.disabled&&this.isInteractive&&this._isPrimary&&!this._parentChip._isEditing&&(i.preventDefault(),this._parentChip._handlePrimaryActionInteraction())}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,selectors:[["","matChipAction",""]],hostAttrs:[1,"mdc-evolution-chip__action","mat-mdc-chip-action"],hostVars:9,hostBindings:function(r,s){r&1&&qi("click",function(o){return s._handleClick(o)})("keydown",function(o){return s._handleKeydown(o)}),r&2&&(Ri("tabindex",s._getTabindex())("disabled",s._getDisabledAttribute())("aria-disabled",s.disabled),Ui("mdc-evolution-chip__action--primary",s._isPrimary)("mdc-evolution-chip__action--presentational",!s.isInteractive)("mdc-evolution-chip__action--trailing",!s._isPrimary))},inputs:{isInteractive:"isInteractive",disabled:[2,"disabled","disabled",It],tabIndex:[2,"tabIndex","tabIndex",i=>i==null?-1:bb(i)],_allowFocusWhenDisabled:"_allowFocusWhenDisabled"},features:[Yr]})}return e})();var uA=(()=>{class e{_changeDetectorRef=M(ls);_elementRef=M(Jt);_ngZone=M(vt);_focusMonitor=M(yl);_globalRippleOptions=M(Qp,{optional:!0});_document=M(bt);_onFocus=new $e;_onBlur=new $e;_isBasicChip;role=null;_hasFocusInternal=!1;_pendingFocus;_actionChanges;_animationsDisabled;_allLeadingIcons;_allTrailingIcons;_allRemoveIcons;_hasFocus(){return this._hasFocusInternal}id=M(vl).getId("mat-mdc-chip-");ariaLabel=null;ariaDescription=null;_ariaDescriptionId=`${this.id}-aria-description`;_chipListDisabled=!1;_textElement;get value(){return this._value!==void 0?this._value:this._textElement.textContent.trim()}set value(i){this._value=i}_value;color;removable=!0;highlighted=!1;disableRipple=!1;get disabled(){return this._disabled||this._chipListDisabled}set disabled(i){this._disabled=i}_disabled=!1;removed=new yi;destroyed=new yi;basicChipAttrName="mat-basic-chip";leadingIcon;trailingIcon;removeIcon;primaryAction;_rippleLoader=M(Xw);_injector=M(wi);constructor(){M(Os).load(_c),M(Os).load(my);let i=M(bs,{optional:!0});this._animationsDisabled=i==="NoopAnimations",this._monitorFocus(),this._rippleLoader?.configureRipple(this._elementRef.nativeElement,{className:"mat-mdc-chip-ripple",disabled:this._isRippleDisabled()})}ngOnInit(){let i=this._elementRef.nativeElement;this._isBasicChip=i.hasAttribute(this.basicChipAttrName)||i.tagName.toLowerCase()===this.basicChipAttrName}ngAfterViewInit(){this._textElement=this._elementRef.nativeElement.querySelector(".mat-mdc-chip-action-label"),this._pendingFocus&&(this._pendingFocus=!1,this.focus())}ngAfterContentInit(){this._actionChanges=sa(this._allLeadingIcons.changes,this._allTrailingIcons.changes,this._allRemoveIcons.changes).subscribe(()=>this._changeDetectorRef.markForCheck())}ngDoCheck(){this._rippleLoader.setDisabled(this._elementRef.nativeElement,this._isRippleDisabled())}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement),this._actionChanges?.unsubscribe(),this.destroyed.emit({chip:this}),this.destroyed.complete()}remove(){this.removable&&this.removed.emit({chip:this})}_isRippleDisabled(){return this.disabled||this.disableRipple||this._animationsDisabled||this._isBasicChip||!!this._globalRippleOptions?.disabled}_hasTrailingIcon(){return!!(this.trailingIcon||this.removeIcon)}_handleKeydown(i){(i.keyCode===8&&!i.repeat||i.keyCode===46)&&(i.preventDefault(),this.remove())}focus(){this.disabled||(this.primaryAction?this.primaryAction.focus():this._pendingFocus=!0)}_getSourceAction(i){return this._getActions().find(r=>{let s=r._elementRef.nativeElement;return s===i||s.contains(i)})}_getActions(){let i=[];return this.primaryAction&&i.push(this.primaryAction),this.removeIcon&&i.push(this.removeIcon),this.trailingIcon&&i.push(this.trailingIcon),i}_handlePrimaryActionInteraction(){}_monitorFocus(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(i=>{let r=i!==null;r!==this._hasFocusInternal&&(this._hasFocusInternal=r,r?this._onFocus.next({chip:this}):(this._changeDetectorRef.markForCheck(),setTimeout(()=>this._ngZone.run(()=>this._onBlur.next({chip:this})))))})}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["mat-basic-chip"],["","mat-basic-chip",""],["mat-chip"],["","mat-chip",""]],contentQueries:function(r,s,n){if(r&1&&(Or(n,lH,5),Or(n,cH,5),Or(n,dH,5),Or(n,lH,5),Or(n,cH,5),Or(n,dH,5)),r&2){let o;Zt(o=Qt())&&(s.leadingIcon=o.first),Zt(o=Qt())&&(s.trailingIcon=o.first),Zt(o=Qt())&&(s.removeIcon=o.first),Zt(o=Qt())&&(s._allLeadingIcons=o),Zt(o=Qt())&&(s._allTrailingIcons=o),Zt(o=Qt())&&(s._allRemoveIcons=o)}},viewQuery:function(r,s){if(r&1&&ws(hA,5),r&2){let n;Zt(n=Qt())&&(s.primaryAction=n.first)}},hostAttrs:[1,"mat-mdc-chip"],hostVars:31,hostBindings:function(r,s){r&1&&qi("keydown",function(o){return s._handleKeydown(o)}),r&2&&(Wg("id",s.id),Ri("role",s.role)("aria-label",s.ariaLabel),Im("mat-"+(s.color||"primary")),Ui("mdc-evolution-chip",!s._isBasicChip)("mdc-evolution-chip--disabled",s.disabled)("mdc-evolution-chip--with-trailing-action",s._hasTrailingIcon())("mdc-evolution-chip--with-primary-graphic",s.leadingIcon)("mdc-evolution-chip--with-primary-icon",s.leadingIcon)("mdc-evolution-chip--with-avatar",s.leadingIcon)("mat-mdc-chip-with-avatar",s.leadingIcon)("mat-mdc-chip-highlighted",s.highlighted)("mat-mdc-chip-disabled",s.disabled)("mat-mdc-basic-chip",s._isBasicChip)("mat-mdc-standard-chip",!s._isBasicChip)("mat-mdc-chip-with-trailing-icon",s._hasTrailingIcon())("_mat-animation-noopable",s._animationsDisabled))},inputs:{role:"role",id:"id",ariaLabel:[0,"aria-label","ariaLabel"],ariaDescription:[0,"aria-description","ariaDescription"],value:"value",color:"color",removable:[2,"removable","removable",It],highlighted:[2,"highlighted","highlighted",It],disableRipple:[2,"disableRipple","disableRipple",It],disabled:[2,"disabled","disabled",It]},outputs:{removed:"removed",destroyed:"destroyed"},exportAs:["matChip"],features:[Hs([{provide:fA,useExisting:e}]),Yr],ngContentSelectors:uH,decls:8,vars:3,consts:[[1,"mat-mdc-chip-focus-overlay"],[1,"mdc-evolution-chip__cell","mdc-evolution-chip__cell--primary"],["matChipAction","",3,"isInteractive"],[1,"mdc-evolution-chip__graphic","mat-mdc-chip-graphic"],[1,"mdc-evolution-chip__text-label","mat-mdc-chip-action-label"],[1,"mat-mdc-chip-primary-focus-indicator","mat-focus-indicator"],[1,"mdc-evolution-chip__cell","mdc-evolution-chip__cell--trailing"]],template:function(r,s){r&1&&(gr(hH),pi(0,"span",0),De(1,"span",1)(2,"span",2),tr(3,Q9,2,0,"span",3),De(4,"span",4),Gt(5),pi(6,"span",5),Ze()()(),tr(7,K9,2,0,"span",6)),r&2&&(Ft(2),Mr("isInteractive",!1),Ft(),Mn(s.leadingIcon?3:-1),Ft(4),Mn(s._hasTrailingIcon()?7:-1))},dependencies:[hA],styles:['.mdc-evolution-chip,.mdc-evolution-chip__cell,.mdc-evolution-chip__action{display:inline-flex;align-items:center}.mdc-evolution-chip{position:relative;max-width:100%}.mdc-evolution-chip__cell,.mdc-evolution-chip__action{height:100%}.mdc-evolution-chip__cell--primary{flex-basis:100%;overflow-x:hidden}.mdc-evolution-chip__cell--trailing{flex:1 0 auto}.mdc-evolution-chip__action{align-items:center;background:none;border:none;box-sizing:content-box;cursor:pointer;display:inline-flex;justify-content:center;outline:none;padding:0;text-decoration:none;color:inherit}.mdc-evolution-chip__action--presentational{cursor:auto}.mdc-evolution-chip--disabled,.mdc-evolution-chip__action:disabled{pointer-events:none}.mdc-evolution-chip__action--primary{font:inherit;letter-spacing:inherit;white-space:inherit;overflow-x:hidden}.mat-mdc-standard-chip .mdc-evolution-chip__action--primary::before{border-width:var(--mdc-chip-outline-width, 1px);border-radius:var(--mdc-chip-container-shape-radius, 8px);box-sizing:border-box;content:"";height:100%;left:0;position:absolute;pointer-events:none;top:0;width:100%;z-index:1;border-style:solid}.mat-mdc-standard-chip .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:12px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__action--primary::before{border-color:var(--mdc-chip-outline-color, var(--mat-sys-outline))}.mdc-evolution-chip__action--primary:not(.mdc-evolution-chip__action--presentational):not(.mdc-ripple-upgraded):focus::before{border-color:var(--mdc-chip-focus-outline-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__action--primary::before{border-color:var(--mdc-chip-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-standard-chip.mdc-evolution-chip--selected .mdc-evolution-chip__action--primary::before{border-width:var(--mdc-chip-flat-selected-outline-width, 0)}.mat-mdc-basic-chip .mdc-evolution-chip__action--primary{font:inherit}.mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}.mdc-evolution-chip__action--trailing{position:relative;overflow:visible}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__action--trailing{color:var(--mdc-chip-with-trailing-icon-trailing-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__action--trailing{color:var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-color, var(--mat-sys-on-surface))}.mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mdc-evolution-chip__text-label{-webkit-user-select:none;user-select:none;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.mat-mdc-standard-chip .mdc-evolution-chip__text-label{font-family:var(--mdc-chip-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mdc-chip-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mdc-chip-label-text-size, var(--mat-sys-label-large-size));font-weight:var(--mdc-chip-label-text-weight, var(--mat-sys-label-large-weight));letter-spacing:var(--mdc-chip-label-text-tracking, var(--mat-sys-label-large-tracking))}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__text-label{color:var(--mdc-chip-label-text-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--selected:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__text-label{color:var(--mdc-chip-selected-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__text-label,.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled .mdc-evolution-chip__text-label{color:var(--mdc-chip-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mdc-evolution-chip__graphic{align-items:center;display:inline-flex;justify-content:center;overflow:hidden;pointer-events:none;position:relative;flex:1 0 auto}.mat-mdc-standard-chip .mdc-evolution-chip__graphic{width:var(--mdc-chip-with-avatar-avatar-size, 24px);height:var(--mdc-chip-with-avatar-avatar-size, 24px);font-size:var(--mdc-chip-with-avatar-avatar-size, 24px)}.mdc-evolution-chip--selecting .mdc-evolution-chip__graphic{transition:width 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-evolution-chip--selectable:not(.mdc-evolution-chip--selected):not(.mdc-evolution-chip--with-primary-icon) .mdc-evolution-chip__graphic{width:0}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:6px;padding-right:6px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:4px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:8px;padding-right:4px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:6px;padding-right:6px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:4px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:8px;padding-right:4px}.mdc-evolution-chip__checkmark{position:absolute;opacity:0;top:50%;left:50%;height:20px;width:20px}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__checkmark{color:var(--mdc-chip-with-icon-selected-icon-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__checkmark{color:var(--mdc-chip-with-icon-disabled-icon-color, var(--mat-sys-on-surface))}.mdc-evolution-chip--selecting .mdc-evolution-chip__checkmark{transition:transform 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1);transform:translate(-75%, -50%)}.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark{transform:translate(-50%, -50%);opacity:1}.mdc-evolution-chip__checkmark-svg{display:block}.mdc-evolution-chip__checkmark-path{stroke-width:2px;stroke-dasharray:29.7833385;stroke-dashoffset:29.7833385;stroke:currentColor}.mdc-evolution-chip--selecting .mdc-evolution-chip__checkmark-path{transition:stroke-dashoffset 150ms 45ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark-path{stroke-dashoffset:0}@media(forced-colors: active){.mdc-evolution-chip__checkmark-path{stroke:CanvasText !important}}.mat-mdc-standard-chip .mdc-evolution-chip__icon--trailing{height:18px;width:18px;font-size:18px}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing.mat-mdc-chip-remove{opacity:calc(var(--mat-chip-trailing-action-opacity, 1)*var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38))}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing.mat-mdc-chip-remove:focus{opacity:calc(var(--mat-chip-trailing-action-focus-opacity, 1)*var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38))}.mat-mdc-standard-chip{border-radius:var(--mdc-chip-container-shape-radius, 8px);height:var(--mdc-chip-container-height, 32px)}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled){background-color:var(--mdc-chip-elevated-container-color, transparent)}.mat-mdc-standard-chip.mdc-evolution-chip--disabled{background-color:var(--mdc-chip-elevated-disabled-container-color)}.mat-mdc-standard-chip.mdc-evolution-chip--selected:not(.mdc-evolution-chip--disabled){background-color:var(--mdc-chip-elevated-selected-container-color, var(--mat-sys-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled{background-color:var(--mdc-chip-flat-disabled-selected-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}@media(forced-colors: active){.mat-mdc-standard-chip{outline:solid 1px}}.mat-mdc-standard-chip .mdc-evolution-chip__icon--primary{border-radius:var(--mdc-chip-with-avatar-avatar-shape-radius, 24px);width:var(--mdc-chip-with-icon-icon-size, 18px);height:var(--mdc-chip-with-icon-icon-size, 18px);font-size:var(--mdc-chip-with-icon-icon-size, 18px)}.mdc-evolution-chip--selected .mdc-evolution-chip__icon--primary{opacity:0}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__icon--primary{color:var(--mdc-chip-with-icon-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--primary{color:var(--mdc-chip-with-icon-disabled-icon-color, var(--mat-sys-on-surface))}.mat-mdc-chip-highlighted{--mdc-chip-with-icon-icon-color:var(--mdc-chip-with-icon-selected-icon-color, var(--mat-sys-on-secondary-container));--mdc-chip-elevated-container-color:var(--mdc-chip-elevated-selected-container-color, var(--mat-sys-secondary-container));--mdc-chip-label-text-color:var(--mdc-chip-selected-label-text-color, var(--mat-sys-on-secondary-container));--mdc-chip-outline-width:var(--mdc-chip-flat-selected-outline-width, 0)}.mat-mdc-chip-focus-overlay{background:var(--mdc-chip-focus-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-chip-selected .mat-mdc-chip-focus-overlay,.mat-mdc-chip-highlighted .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-focus-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-mdc-chip:hover .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-hover-state-layer-color, var(--mat-sys-on-surface-variant));opacity:var(--mdc-chip-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip-focus-overlay .mat-mdc-chip-selected:hover,.mat-mdc-chip-highlighted:hover .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-hover-state-layer-color, var(--mat-sys-on-secondary-container));opacity:var(--mdc-chip-selected-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip.cdk-focused .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-focus-state-layer-color, var(--mat-sys-on-surface-variant));opacity:var(--mdc-chip-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-chip-selected.cdk-focused .mat-mdc-chip-focus-overlay,.mat-mdc-chip-highlighted.cdk-focused .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-focus-state-layer-color, var(--mat-sys-on-secondary-container));opacity:var(--mdc-chip-selected-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mdc-evolution-chip--disabled:not(.mdc-evolution-chip--selected) .mat-mdc-chip-avatar{opacity:var(--mdc-chip-with-avatar-disabled-avatar-opacity, 0.38)}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing{opacity:var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38)}.mdc-evolution-chip--disabled.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark{opacity:var(--mdc-chip-with-icon-disabled-icon-opacity, 0.38)}.mat-mdc-standard-chip.mdc-evolution-chip--disabled{opacity:var(--mat-chip-disabled-container-opacity, 1)}.mat-mdc-standard-chip.mdc-evolution-chip--selected .mdc-evolution-chip__icon--trailing,.mat-mdc-standard-chip.mat-mdc-chip-highlighted .mdc-evolution-chip__icon--trailing{color:var(--mat-chip-selected-trailing-icon-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing,.mat-mdc-standard-chip.mat-mdc-chip-highlighted.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing{color:var(--mat-chip-selected-disabled-trailing-icon-color, var(--mat-sys-on-surface))}.mat-mdc-chip-remove{opacity:var(--mat-chip-trailing-action-opacity, 1)}.mat-mdc-chip-remove:focus{opacity:var(--mat-chip-trailing-action-focus-opacity, 1)}.mat-mdc-chip-remove::after{background-color:var(--mat-chip-trailing-action-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-chip-remove:hover::after{opacity:var(--mat-chip-trailing-action-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip-remove:focus::after{opacity:var(--mat-chip-trailing-action-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-chip-selected .mat-mdc-chip-remove::after,.mat-mdc-chip-highlighted .mat-mdc-chip-remove::after{background-color:var(--mat-chip-selected-trailing-action-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-standard-chip .mdc-evolution-chip__cell--primary,.mat-mdc-standard-chip .mdc-evolution-chip__action--primary,.mat-mdc-standard-chip .mat-mdc-chip-action-label{overflow:visible}.mat-mdc-standard-chip .mat-mdc-chip-graphic,.mat-mdc-standard-chip .mat-mdc-chip-trailing-icon{box-sizing:content-box}.mat-mdc-standard-chip._mat-animation-noopable,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__graphic,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__checkmark,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__checkmark-path{transition-duration:1ms;animation-duration:1ms}.mat-mdc-chip-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;opacity:0;border-radius:inherit;transition:opacity 150ms linear}._mat-animation-noopable .mat-mdc-chip-focus-overlay{transition:none}.mat-mdc-basic-chip .mat-mdc-chip-focus-overlay{display:none}.mat-mdc-chip .mat-ripple.mat-mdc-chip-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-chip-avatar{text-align:center;line-height:1;color:var(--mdc-chip-with-icon-icon-color, currentColor)}.mat-mdc-chip{position:relative;z-index:0}.mat-mdc-chip-action-label{text-align:left;z-index:1}[dir=rtl] .mat-mdc-chip-action-label{text-align:right}.mat-mdc-chip.mdc-evolution-chip--with-trailing-action .mat-mdc-chip-action-label{position:relative}.mat-mdc-chip-action-label .mat-mdc-chip-primary-focus-indicator{position:absolute;top:0;right:0;bottom:0;left:0;pointer-events:none}.mat-mdc-chip-action-label .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-chip-remove::before{margin:calc(var(--mat-focus-indicator-border-width, 3px)*-1);left:8px;right:8px}.mat-mdc-chip-remove::after{content:"";display:block;opacity:0;position:absolute;top:-3px;bottom:-3px;left:5px;right:5px;border-radius:50%;box-sizing:border-box;padding:12px;margin:-12px;background-clip:content-box}.mat-mdc-chip-remove .mat-icon{width:18px;height:18px;font-size:18px;box-sizing:content-box}.mat-chip-edit-input{cursor:text;display:inline-block;color:inherit;outline:0}@media(forced-colors: active){.mat-mdc-chip-selected:not(.mat-mdc-chip-multiple){outline-width:3px}}.mat-mdc-chip-action:focus .mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0})}return e})();var gA=(()=>{class e extends uA{_defaultOptions=M(pA,{optional:!0});chipListSelectable=!0;_chipListMultiple=!1;_chipListHideSingleSelectionIndicator=this._defaultOptions?.hideSingleSelectionIndicator??!1;get selectable(){return this._selectable&&this.chipListSelectable}set selectable(i){this._selectable=i,this._changeDetectorRef.markForCheck()}_selectable=!0;get selected(){return this._selected}set selected(i){this._setSelectedState(i,!1,!0)}_selected=!1;get ariaSelected(){return this.selectable?this.selected.toString():null}basicChipAttrName="mat-basic-chip-option";selectionChange=new yi;ngOnInit(){super.ngOnInit(),this.role="presentation"}select(){this._setSelectedState(!0,!1,!0)}deselect(){this._setSelectedState(!1,!1,!0)}selectViaInteraction(){this._setSelectedState(!0,!0,!0)}toggleSelected(i=!1){return this._setSelectedState(!this.selected,i,!0),this.selected}_handlePrimaryActionInteraction(){this.disabled||(this.focus(),this.selectable&&this.toggleSelected(!0))}_hasLeadingGraphic(){return this.leadingIcon?!0:!this._chipListHideSingleSelectionIndicator||this._chipListMultiple}_setSelectedState(i,r,s){i!==this.selected&&(this._selected=i,s&&this.selectionChange.emit({source:this,isUserInput:r,selected:this.selected}),this._changeDetectorRef.markForCheck())}static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275cmp=it({type:e,selectors:[["mat-basic-chip-option"],["","mat-basic-chip-option",""],["mat-chip-option"],["","mat-chip-option",""]],hostAttrs:[1,"mat-mdc-chip","mat-mdc-chip-option"],hostVars:37,hostBindings:function(r,s){r&2&&(Wg("id",s.id),Ri("tabindex",null)("aria-label",null)("aria-description",null)("role",s.role),Ui("mdc-evolution-chip",!s._isBasicChip)("mdc-evolution-chip--filter",!s._isBasicChip)("mdc-evolution-chip--selectable",!s._isBasicChip)("mat-mdc-chip-selected",s.selected)("mat-mdc-chip-multiple",s._chipListMultiple)("mat-mdc-chip-disabled",s.disabled)("mat-mdc-chip-with-avatar",s.leadingIcon)("mdc-evolution-chip--disabled",s.disabled)("mdc-evolution-chip--selected",s.selected)("mdc-evolution-chip--selecting",!s._animationsDisabled)("mdc-evolution-chip--with-trailing-action",s._hasTrailingIcon())("mdc-evolution-chip--with-primary-icon",s.leadingIcon)("mdc-evolution-chip--with-primary-graphic",s._hasLeadingGraphic())("mdc-evolution-chip--with-avatar",s.leadingIcon)("mat-mdc-chip-highlighted",s.highlighted)("mat-mdc-chip-with-trailing-icon",s._hasTrailingIcon()))},inputs:{selectable:[2,"selectable","selectable",It],selected:[2,"selected","selected",It]},outputs:{selectionChange:"selectionChange"},features:[Hs([{provide:uA,useExisting:e},{provide:fA,useExisting:e}]),Yr,Kr],ngContentSelectors:uH,decls:10,vars:8,consts:[[1,"mat-mdc-chip-focus-overlay"],[1,"mdc-evolution-chip__cell","mdc-evolution-chip__cell--primary"],["matChipAction","","role","option",3,"_allowFocusWhenDisabled"],[1,"mdc-evolution-chip__graphic","mat-mdc-chip-graphic"],[1,"mdc-evolution-chip__text-label","mat-mdc-chip-action-label"],[1,"mat-mdc-chip-primary-focus-indicator","mat-focus-indicator"],[1,"mdc-evolution-chip__cell","mdc-evolution-chip__cell--trailing"],[1,"cdk-visually-hidden",3,"id"],[1,"mdc-evolution-chip__checkmark"],["viewBox","-2 -3 30 30","focusable","false","aria-hidden","true",1,"mdc-evolution-chip__checkmark-svg"],["fill","none","stroke","currentColor","d","M1.73,12.91 8.1,19.28 22.79,4.59",1,"mdc-evolution-chip__checkmark-path"]],template:function(r,s){r&1&&(gr(hH),pi(0,"span",0),De(1,"span",1)(2,"button",2),tr(3,Y9,5,0,"span",3),De(4,"span",4),Gt(5),pi(6,"span",5),Ze()()(),tr(7,X9,2,0,"span",6),De(8,"span",7),or(9),Ze()),r&2&&(Ft(2),Mr("_allowFocusWhenDisabled",!0),Ri("aria-selected",s.ariaSelected)("aria-label",s.ariaLabel)("aria-describedby",s._ariaDescriptionId),Ft(),Mn(s._hasLeadingGraphic()?3:-1),Ft(4),Mn(s._hasTrailingIcon()?7:-1),Ft(),Mr("id",s._ariaDescriptionId),Ft(),wk(s.ariaDescription))},dependencies:[hA],styles:[J9],encapsulation:2,changeDetection:0})}return e})();var tZ=(()=>{class e{_elementRef=M(Jt);_changeDetectorRef=M(ls);_dir=M(Jn,{optional:!0});_lastDestroyedFocusedChipIndex=null;_keyManager;_destroyed=new $e;_defaultRole="presentation";get chipFocusChanges(){return this._getChipStream(i=>i._onFocus)}get chipDestroyedChanges(){return this._getChipStream(i=>i.destroyed)}get chipRemovedChanges(){return this._getChipStream(i=>i.removed)}get disabled(){return this._disabled}set disabled(i){this._disabled=i,this._syncChipsState()}_disabled=!1;get empty(){return!this._chips||this._chips.length===0}get role(){return this._explicitRole?this._explicitRole:this.empty?null:this._defaultRole}tabIndex=0;set role(i){this._explicitRole=i}_explicitRole=null;get focused(){return this._hasFocusedChip()}_chips;_chipActions=new Wh;constructor(){}ngAfterViewInit(){this._setUpFocusManagement(),this._trackChipSetChanges(),this._trackDestroyedFocusedChip()}ngOnDestroy(){this._keyManager?.destroy(),this._chipActions.destroy(),this._destroyed.next(),this._destroyed.complete()}_hasFocusedChip(){return this._chips&&this._chips.some(i=>i._hasFocus())}_syncChipsState(){this._chips?.forEach(i=>{i._chipListDisabled=this._disabled,i._changeDetectorRef.markForCheck()})}focus(){}_handleKeydown(i){this._originatesFromChip(i)&&this._keyManager.onKeydown(i)}_isValidIndex(i){return i>=0&&i<this._chips.length}_allowFocusEscape(){let i=this._elementRef.nativeElement.tabIndex;i!==-1&&(this._elementRef.nativeElement.tabIndex=-1,setTimeout(()=>this._elementRef.nativeElement.tabIndex=i))}_getChipStream(i){return this._chips.changes.pipe(dn(null),Tn(()=>sa(...this._chips.map(i))))}_originatesFromChip(i){let r=i.target;for(;r&&r!==this._elementRef.nativeElement;){if(r.classList.contains("mat-mdc-chip"))return!0;r=r.parentElement}return!1}_setUpFocusManagement(){this._chips.changes.pipe(dn(this._chips)).subscribe(i=>{let r=[];i.forEach(s=>s._getActions().forEach(n=>r.push(n))),this._chipActions.reset(r),this._chipActions.notifyOnChanges()}),this._keyManager=new Zw(this._chipActions).withVerticalOrientation().withHorizontalOrientation(this._dir?this._dir.value:"ltr").withHomeAndEnd().skipPredicate(i=>this._skipPredicate(i)),this.chipFocusChanges.pipe(ki(this._destroyed)).subscribe(({chip:i})=>{let r=i._getSourceAction(document.activeElement);r&&this._keyManager.updateActiveItem(r)}),this._dir?.change.pipe(ki(this._destroyed)).subscribe(i=>this._keyManager.withHorizontalOrientation(i))}_skipPredicate(i){return!i.isInteractive||i.disabled}_trackChipSetChanges(){this._chips.changes.pipe(dn(null),ki(this._destroyed)).subscribe(()=>{this.disabled&&Promise.resolve().then(()=>this._syncChipsState()),this._redirectDestroyedChipFocus()})}_trackDestroyedFocusedChip(){this.chipDestroyedChanges.pipe(ki(this._destroyed)).subscribe(i=>{let s=this._chips.toArray().indexOf(i.chip);this._isValidIndex(s)&&i.chip._hasFocus()&&(this._lastDestroyedFocusedChipIndex=s)})}_redirectDestroyedChipFocus(){if(this._lastDestroyedFocusedChipIndex!=null){if(this._chips.length){let i=Math.min(this._lastDestroyedFocusedChipIndex,this._chips.length-1),r=this._chips.toArray()[i];r.disabled?this._chips.length===1?this.focus():this._keyManager.setPreviousItemActive():r.focus()}else this.focus();this._lastDestroyedFocusedChipIndex=null}}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["mat-chip-set"]],contentQueries:function(r,s,n){if(r&1&&Or(n,uA,5),r&2){let o;Zt(o=Qt())&&(s._chips=o)}},hostAttrs:[1,"mat-mdc-chip-set","mdc-evolution-chip-set"],hostVars:1,hostBindings:function(r,s){r&1&&qi("keydown",function(o){return s._handleKeydown(o)}),r&2&&Ri("role",s.role)},inputs:{disabled:[2,"disabled","disabled",It],role:"role",tabIndex:[2,"tabIndex","tabIndex",i=>i==null?0:bb(i)]},features:[Yr],ngContentSelectors:mH,decls:2,vars:0,consts:[["role","presentation",1,"mdc-evolution-chip-set__chips"]],template:function(r,s){r&1&&(gr(),De(0,"div",0),Gt(1),Ze())},styles:[".mat-mdc-chip-set{display:flex}.mat-mdc-chip-set:focus{outline:none}.mat-mdc-chip-set .mdc-evolution-chip-set__chips{min-width:100%;margin-left:-8px;margin-right:0}.mat-mdc-chip-set .mdc-evolution-chip{margin:4px 0 4px 8px}[dir=rtl] .mat-mdc-chip-set .mdc-evolution-chip-set__chips{margin-left:0;margin-right:-8px}[dir=rtl] .mat-mdc-chip-set .mdc-evolution-chip{margin-left:0;margin-right:8px}.mdc-evolution-chip-set__chips{display:flex;flex-flow:wrap;min-width:0}.mat-mdc-chip-set-stacked{flex-direction:column;align-items:flex-start}.mat-mdc-chip-set-stacked .mat-mdc-chip{width:100%}.mat-mdc-chip-set-stacked .mdc-evolution-chip__graphic{flex-grow:0}.mat-mdc-chip-set-stacked .mdc-evolution-chip__action--primary{flex-basis:100%;justify-content:start}input.mat-mdc-chip-input{flex:1 0 150px;margin-left:8px}[dir=rtl] input.mat-mdc-chip-input{margin-left:0;margin-right:8px}"],encapsulation:2,changeDetection:0})}return e})(),mA=class{source;value;constructor(t,i){this.source=t,this.value=i}},iZ={provide:Jw,useExisting:jh(()=>_A),multi:!0},_A=(()=>{class e extends tZ{_onTouched=()=>{};_onChange=()=>{};_defaultRole="listbox";_pendingInitialValue;_defaultOptions=M(pA,{optional:!0});get multiple(){return this._multiple}set multiple(i){this._multiple=i,this._syncListboxProperties()}_multiple=!1;get selected(){let i=this._chips.toArray().filter(r=>r.selected);return this.multiple?i:i[0]}ariaOrientation="horizontal";get selectable(){return this._selectable}set selectable(i){this._selectable=i,this._syncListboxProperties()}_selectable=!0;compareWith=(i,r)=>i===r;required=!1;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(i){this._hideSingleSelectionIndicator=i,this._syncListboxProperties()}_hideSingleSelectionIndicator=this._defaultOptions?.hideSingleSelectionIndicator??!1;get chipSelectionChanges(){return this._getChipStream(i=>i.selectionChange)}get chipBlurChanges(){return this._getChipStream(i=>i._onBlur)}get value(){return this._value}set value(i){this.writeValue(i),this._value=i}_value;change=new yi;_chips=void 0;ngAfterContentInit(){this._pendingInitialValue!==void 0&&Promise.resolve().then(()=>{this._setSelectionByValue(this._pendingInitialValue,!1),this._pendingInitialValue=void 0}),this._chips.changes.pipe(dn(null),ki(this._destroyed)).subscribe(()=>{this._syncListboxProperties()}),this.chipBlurChanges.pipe(ki(this._destroyed)).subscribe(()=>this._blur()),this.chipSelectionChanges.pipe(ki(this._destroyed)).subscribe(i=>{this.multiple||this._chips.forEach(r=>{r!==i.source&&r._setSelectedState(!1,!1,!1)}),i.isUserInput&&this._propagateChanges()})}focus(){if(this.disabled)return;let i=this._getFirstSelectedChip();i&&!i.disabled?i.focus():this._chips.length>0?this._keyManager.setFirstItemActive():this._elementRef.nativeElement.focus()}writeValue(i){this._chips?this._setSelectionByValue(i,!1):i!=null&&(this._pendingInitialValue=i)}registerOnChange(i){this._onChange=i}registerOnTouched(i){this._onTouched=i}setDisabledState(i){this.disabled=i}_setSelectionByValue(i,r=!0){this._clearSelection(),Array.isArray(i)?i.forEach(s=>this._selectValue(s,r)):this._selectValue(i,r)}_blur(){this.disabled||setTimeout(()=>{this.focused||this._markAsTouched()})}_keydown(i){i.keyCode===9&&super._allowFocusEscape()}_markAsTouched(){this._onTouched(),this._changeDetectorRef.markForCheck()}_propagateChanges(){let i=null;Array.isArray(this.selected)?i=this.selected.map(r=>r.value):i=this.selected?this.selected.value:void 0,this._value=i,this.change.emit(new mA(this,i)),this._onChange(i),this._changeDetectorRef.markForCheck()}_clearSelection(i){this._chips.forEach(r=>{r!==i&&r.deselect()})}_selectValue(i,r){let s=this._chips.find(n=>n.value!=null&&this.compareWith(n.value,i));return s&&(r?s.selectViaInteraction():s.select()),s}_syncListboxProperties(){this._chips&&Promise.resolve().then(()=>{this._chips.forEach(i=>{i._chipListMultiple=this.multiple,i.chipListSelectable=this._selectable,i._chipListHideSingleSelectionIndicator=this.hideSingleSelectionIndicator,i._changeDetectorRef.markForCheck()})})}_getFirstSelectedChip(){return Array.isArray(this.selected)?this.selected.length?this.selected[0]:void 0:this.selected}_skipPredicate(i){return!i.isInteractive}static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275cmp=it({type:e,selectors:[["mat-chip-listbox"]],contentQueries:function(r,s,n){if(r&1&&Or(n,gA,5),r&2){let o;Zt(o=Qt())&&(s._chips=o)}},hostAttrs:[1,"mdc-evolution-chip-set","mat-mdc-chip-listbox"],hostVars:11,hostBindings:function(r,s){r&1&&qi("focus",function(){return s.focus()})("blur",function(){return s._blur()})("keydown",function(o){return s._keydown(o)}),r&2&&(Wg("tabIndex",s.disabled||s.empty?-1:s.tabIndex),Ri("role",s.role)("aria-describedby",s._ariaDescribedby||null)("aria-required",s.role?s.required:null)("aria-disabled",s.disabled.toString())("aria-multiselectable",s.multiple)("aria-orientation",s.ariaOrientation),Ui("mat-mdc-chip-list-disabled",s.disabled)("mat-mdc-chip-list-required",s.required))},inputs:{multiple:[2,"multiple","multiple",It],ariaOrientation:[0,"aria-orientation","ariaOrientation"],selectable:[2,"selectable","selectable",It],compareWith:"compareWith",required:[2,"required","required",It],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",It],value:"value"},outputs:{change:"change"},features:[Hs([iZ]),Yr,Kr],ngContentSelectors:mH,decls:2,vars:0,consts:[["role","presentation",1,"mdc-evolution-chip-set__chips"]],template:function(r,s){r&1&&(gr(),De(0,"div",0),Gt(1),Ze())},styles:[eZ],encapsulation:2,changeDetection:0})}return e})();var pH=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({providers:[KU,{provide:pA,useValue:{separatorKeyCodes:[13]}}],imports:[ur,Fd,ur]})}return e})();var Ra=function(e){return e.PUMPING_STATIONS="PUMPING_STATIONS",e.RESERVOIRS="RESERVOIRS",e.CANALS="CANALS",e}(Ra||{});var Nd=function(e){return e.MAP_VIEW="MAP_VIEW",e.SCENE_VIEW="SCENE_VIEW",e}(Nd||{});var fH=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({imports:[ur,ur]})}return e})();var gH=["*"],_H='.mdc-list{margin:0;padding:8px 0;list-style-type:none}.mdc-list:focus{outline:none}.mdc-list-item{display:flex;position:relative;justify-content:flex-start;overflow:hidden;padding:0;align-items:stretch;cursor:pointer;padding-left:16px;padding-right:16px;background-color:var(--mdc-list-list-item-container-color, transparent);border-radius:var(--mdc-list-list-item-container-shape, var(--mat-sys-corner-none))}.mdc-list-item.mdc-list-item--selected{background-color:var(--mdc-list-list-item-selected-container-color)}.mdc-list-item:focus{outline:0}.mdc-list-item.mdc-list-item--disabled{cursor:auto}.mdc-list-item.mdc-list-item--with-one-line{height:var(--mdc-list-list-item-one-line-container-height, 48px)}.mdc-list-item.mdc-list-item--with-one-line .mdc-list-item__start{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-one-line .mdc-list-item__end{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-two-lines{height:var(--mdc-list-list-item-two-line-container-height, 64px)}.mdc-list-item.mdc-list-item--with-two-lines .mdc-list-item__start{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--with-two-lines .mdc-list-item__end{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-three-lines{height:var(--mdc-list-list-item-three-line-container-height, 88px)}.mdc-list-item.mdc-list-item--with-three-lines .mdc-list-item__start{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--with-three-lines .mdc-list-item__end{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--selected::before,.mdc-list-item.mdc-list-item--selected:focus::before,.mdc-list-item:not(.mdc-list-item--selected):focus::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;content:"";pointer-events:none}a.mdc-list-item{color:inherit;text-decoration:none}.mdc-list-item__start{fill:currentColor;flex-shrink:0;pointer-events:none}.mdc-list-item--with-leading-icon .mdc-list-item__start{color:var(--mdc-list-list-item-leading-icon-color, var(--mat-sys-on-surface-variant));width:var(--mdc-list-list-item-leading-icon-size, 24px);height:var(--mdc-list-list-item-leading-icon-size, 24px);margin-left:16px;margin-right:32px}[dir=rtl] .mdc-list-item--with-leading-icon .mdc-list-item__start{margin-left:32px;margin-right:16px}.mdc-list-item--with-leading-icon:hover .mdc-list-item__start{color:var(--mdc-list-list-item-hover-leading-icon-color)}.mdc-list-item--with-leading-avatar .mdc-list-item__start{width:var(--mdc-list-list-item-leading-avatar-size, 40px);height:var(--mdc-list-list-item-leading-avatar-size, 40px);margin-left:16px;margin-right:16px;border-radius:50%}.mdc-list-item--with-leading-avatar .mdc-list-item__start,[dir=rtl] .mdc-list-item--with-leading-avatar .mdc-list-item__start{margin-left:16px;margin-right:16px;border-radius:50%}.mdc-list-item__end{flex-shrink:0;pointer-events:none}.mdc-list-item--with-trailing-meta .mdc-list-item__end{font-family:var(--mdc-list-list-item-trailing-supporting-text-font, var(--mat-sys-label-small-font));line-height:var(--mdc-list-list-item-trailing-supporting-text-line-height, var(--mat-sys-label-small-line-height));font-size:var(--mdc-list-list-item-trailing-supporting-text-size, var(--mat-sys-label-small-size));font-weight:var(--mdc-list-list-item-trailing-supporting-text-weight, var(--mat-sys-label-small-weight));letter-spacing:var(--mdc-list-list-item-trailing-supporting-text-tracking, var(--mat-sys-label-small-tracking))}.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-trailing-icon-color, var(--mat-sys-on-surface-variant));width:var(--mdc-list-list-item-trailing-icon-size, 24px);height:var(--mdc-list-list-item-trailing-icon-size, 24px)}.mdc-list-item--with-trailing-icon:hover .mdc-list-item__end{color:var(--mdc-list-list-item-hover-trailing-icon-color)}.mdc-list-item.mdc-list-item--with-trailing-meta .mdc-list-item__end{color:var(--mdc-list-list-item-trailing-supporting-text-color, var(--mat-sys-on-surface-variant))}.mdc-list-item--selected.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-selected-trailing-icon-color, var(--mat-sys-primary))}.mdc-list-item__content{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;align-self:center;flex:1;pointer-events:none}.mdc-list-item--with-two-lines .mdc-list-item__content,.mdc-list-item--with-three-lines .mdc-list-item__content{align-self:stretch}.mdc-list-item__primary-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;color:var(--mdc-list-list-item-label-text-color, var(--mat-sys-on-surface));font-family:var(--mdc-list-list-item-label-text-font, var(--mat-sys-body-large-font));line-height:var(--mdc-list-list-item-label-text-line-height, var(--mat-sys-body-large-line-height));font-size:var(--mdc-list-list-item-label-text-size, var(--mat-sys-body-large-size));font-weight:var(--mdc-list-list-item-label-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mdc-list-list-item-label-text-tracking, var(--mat-sys-body-large-tracking))}.mdc-list-item:hover .mdc-list-item__primary-text{color:var(--mdc-list-list-item-hover-label-text-color, var(--mat-sys-on-surface))}.mdc-list-item:focus .mdc-list-item__primary-text{color:var(--mdc-list-list-item-focus-label-text-color, var(--mat-sys-on-surface))}.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-three-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-three-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-three-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item__secondary-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:block;margin-top:0;color:var(--mdc-list-list-item-supporting-text-color, var(--mat-sys-on-surface-variant));font-family:var(--mdc-list-list-item-supporting-text-font, var(--mat-sys-body-medium-font));line-height:var(--mdc-list-list-item-supporting-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mdc-list-list-item-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mdc-list-list-item-supporting-text-weight, var(--mat-sys-body-medium-weight));letter-spacing:var(--mdc-list-list-item-supporting-text-tracking, var(--mat-sys-body-medium-tracking))}.mdc-list-item__secondary-text::before{display:inline-block;width:0;height:20px;content:"";vertical-align:0}.mdc-list-item--with-three-lines .mdc-list-item__secondary-text{white-space:normal;line-height:20px}.mdc-list-item--with-overline .mdc-list-item__secondary-text{white-space:nowrap;line-height:auto}.mdc-list-item--with-leading-radio.mdc-list-item,.mdc-list-item--with-leading-checkbox.mdc-list-item,.mdc-list-item--with-leading-icon.mdc-list-item,.mdc-list-item--with-leading-avatar.mdc-list-item{padding-left:0;padding-right:16px}[dir=rtl] .mdc-list-item--with-leading-radio.mdc-list-item,[dir=rtl] .mdc-list-item--with-leading-checkbox.mdc-list-item,[dir=rtl] .mdc-list-item--with-leading-icon.mdc-list-item,[dir=rtl] .mdc-list-item--with-leading-avatar.mdc-list-item{padding-left:16px;padding-right:0}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-trailing-icon.mdc-list-item,[dir=rtl] .mdc-list-item--with-trailing-icon.mdc-list-item{padding-left:0;padding-right:0}.mdc-list-item--with-trailing-icon .mdc-list-item__end{margin-left:16px;margin-right:16px}.mdc-list-item--with-trailing-meta.mdc-list-item{padding-left:16px;padding-right:0}[dir=rtl] .mdc-list-item--with-trailing-meta.mdc-list-item{padding-left:0;padding-right:16px}.mdc-list-item--with-trailing-meta .mdc-list-item__end{-webkit-user-select:none;user-select:none;margin-left:28px;margin-right:16px}[dir=rtl] .mdc-list-item--with-trailing-meta .mdc-list-item__end{margin-left:16px;margin-right:28px}.mdc-list-item--with-trailing-meta.mdc-list-item--with-three-lines .mdc-list-item__end,.mdc-list-item--with-trailing-meta.mdc-list-item--with-two-lines .mdc-list-item__end{display:block;line-height:normal;align-self:flex-start;margin-top:0}.mdc-list-item--with-trailing-meta.mdc-list-item--with-three-lines .mdc-list-item__end::before,.mdc-list-item--with-trailing-meta.mdc-list-item--with-two-lines .mdc-list-item__end::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-leading-radio .mdc-list-item__start,.mdc-list-item--with-leading-checkbox .mdc-list-item__start{margin-left:8px;margin-right:24px}[dir=rtl] .mdc-list-item--with-leading-radio .mdc-list-item__start,[dir=rtl] .mdc-list-item--with-leading-checkbox .mdc-list-item__start{margin-left:24px;margin-right:8px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__start,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__start{align-self:flex-start;margin-top:8px}.mdc-list-item--with-trailing-radio.mdc-list-item,.mdc-list-item--with-trailing-checkbox.mdc-list-item{padding-left:16px;padding-right:0}[dir=rtl] .mdc-list-item--with-trailing-radio.mdc-list-item,[dir=rtl] .mdc-list-item--with-trailing-checkbox.mdc-list-item{padding-left:0;padding-right:16px}.mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-icon,.mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-avatar,.mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-icon,.mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-avatar{padding-left:0}[dir=rtl] .mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-icon,[dir=rtl] .mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-avatar,[dir=rtl] .mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-icon,[dir=rtl] .mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-avatar{padding-right:0}.mdc-list-item--with-trailing-radio .mdc-list-item__end,.mdc-list-item--with-trailing-checkbox .mdc-list-item__end{margin-left:24px;margin-right:8px}[dir=rtl] .mdc-list-item--with-trailing-radio .mdc-list-item__end,[dir=rtl] .mdc-list-item--with-trailing-checkbox .mdc-list-item__end{margin-left:8px;margin-right:24px}.mdc-list-item--with-trailing-radio.mdc-list-item--with-three-lines .mdc-list-item__end,.mdc-list-item--with-trailing-checkbox.mdc-list-item--with-three-lines .mdc-list-item__end{align-self:flex-start;margin-top:8px}.mdc-list-group__subheader{margin:.75rem 16px}.mdc-list-item--disabled .mdc-list-item__start,.mdc-list-item--disabled .mdc-list-item__content,.mdc-list-item--disabled .mdc-list-item__end{opacity:1}.mdc-list-item--disabled .mdc-list-item__primary-text,.mdc-list-item--disabled .mdc-list-item__secondary-text{opacity:var(--mdc-list-list-item-disabled-label-text-opacity, 0.3)}.mdc-list-item--disabled.mdc-list-item--with-leading-icon .mdc-list-item__start{color:var(--mdc-list-list-item-disabled-leading-icon-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-disabled-leading-icon-opacity, 0.38)}.mdc-list-item--disabled.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-disabled-trailing-icon-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-disabled-trailing-icon-opacity, 0.38)}.mat-mdc-list-item.mat-mdc-list-item-both-leading-and-trailing,[dir=rtl] .mat-mdc-list-item.mat-mdc-list-item-both-leading-and-trailing{padding-left:0;padding-right:0}.mdc-list-item.mdc-list-item--disabled .mdc-list-item__primary-text{color:var(--mdc-list-list-item-disabled-label-text-color, var(--mat-sys-on-surface))}.mdc-list-item:hover::before{background-color:var(--mdc-list-list-item-hover-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mdc-list-item.mdc-list-item--disabled::before{background-color:var(--mdc-list-list-item-disabled-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-disabled-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mdc-list-item:focus::before{background-color:var(--mdc-list-list-item-focus-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mdc-list-item--disabled .mdc-radio,.mdc-list-item--disabled .mdc-checkbox{opacity:var(--mdc-list-list-item-disabled-label-text-opacity, 0.3)}.mdc-list-item--with-leading-avatar .mat-mdc-list-item-avatar{border-radius:var(--mdc-list-list-item-leading-avatar-shape, var(--mat-sys-corner-full));background-color:var(--mdc-list-list-item-leading-avatar-color, var(--mat-sys-primary-container))}.mat-mdc-list-item-icon{font-size:var(--mdc-list-list-item-leading-icon-size, 24px)}@media(forced-colors: active){a.mdc-list-item--activated::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}a.mdc-list-item--activated [dir=rtl]::after{right:auto;left:16px}}.mat-mdc-list-base{display:block}.mat-mdc-list-base .mdc-list-item__start,.mat-mdc-list-base .mdc-list-item__end,.mat-mdc-list-base .mdc-list-item__content{pointer-events:auto}.mat-mdc-list-item,.mat-mdc-list-option{width:100%;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-list-item:not(.mat-mdc-list-item-interactive),.mat-mdc-list-option:not(.mat-mdc-list-item-interactive){cursor:default}.mat-mdc-list-item .mat-divider-inset,.mat-mdc-list-option .mat-divider-inset{position:absolute;left:0;right:0;bottom:0}.mat-mdc-list-item .mat-mdc-list-item-avatar~.mat-divider-inset,.mat-mdc-list-option .mat-mdc-list-item-avatar~.mat-divider-inset{margin-left:72px}[dir=rtl] .mat-mdc-list-item .mat-mdc-list-item-avatar~.mat-divider-inset,[dir=rtl] .mat-mdc-list-option .mat-mdc-list-item-avatar~.mat-divider-inset{margin-right:72px}.mat-mdc-list-item-interactive::before{top:0;left:0;right:0;bottom:0;position:absolute;content:"";opacity:0;pointer-events:none;border-radius:inherit}.mat-mdc-list-item>.mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-list-item:focus>.mat-focus-indicator::before{content:""}.mat-mdc-list-item.mdc-list-item--with-three-lines .mat-mdc-list-item-line.mdc-list-item__secondary-text{white-space:nowrap;line-height:normal}.mat-mdc-list-item.mdc-list-item--with-three-lines .mat-mdc-list-item-unscoped-content.mdc-list-item__secondary-text{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}mat-action-list button{background:none;color:inherit;border:none;font:inherit;outline:inherit;-webkit-tap-highlight-color:rgba(0,0,0,0);text-align:start}mat-action-list button::-moz-focus-inner{border:0}.mdc-list-item--with-leading-icon .mdc-list-item__start{margin-inline-start:var(--mat-list-list-item-leading-icon-start-space, 16px);margin-inline-end:var(--mat-list-list-item-leading-icon-end-space, 16px)}.mat-mdc-nav-list .mat-mdc-list-item{border-radius:var(--mat-list-active-indicator-shape, var(--mat-sys-corner-full));--mat-focus-indicator-border-radius:var(--mat-list-active-indicator-shape, var(--mat-sys-corner-full))}.mat-mdc-nav-list .mat-mdc-list-item.mdc-list-item--activated{background-color:var(--mat-list-active-indicator-color, var(--mat-sys-secondary-container))}',sZ=["unscopedContent"],nZ=["text"],oZ=[[["","matListItemAvatar",""],["","matListItemIcon",""]],[["","matListItemTitle",""]],[["","matListItemLine",""]],"*",[["","matListItemMeta",""]],[["mat-divider"]]],aZ=["[matListItemAvatar],[matListItemIcon]","[matListItemTitle]","[matListItemLine]","*","[matListItemMeta]","mat-divider"];var lZ=new He("ListOption"),cZ=(()=>{class e{_elementRef=M(Jt);constructor(){}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,selectors:[["","matListItemTitle",""]],hostAttrs:[1,"mat-mdc-list-item-title","mdc-list-item__primary-text"]})}return e})(),dZ=(()=>{class e{_elementRef=M(Jt);constructor(){}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,selectors:[["","matListItemLine",""]],hostAttrs:[1,"mat-mdc-list-item-line","mdc-list-item__secondary-text"]})}return e})(),hZ=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,selectors:[["","matListItemMeta",""]],hostAttrs:[1,"mat-mdc-list-item-meta","mdc-list-item__end"]})}return e})(),yH=(()=>{class e{_listOption=M(lZ,{optional:!0});constructor(){}_isAlignedAtStart(){return!this._listOption||this._listOption?._getTogglePosition()==="after"}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,hostVars:4,hostBindings:function(r,s){r&2&&Ui("mdc-list-item__start",s._isAlignedAtStart())("mdc-list-item__end",!s._isAlignedAtStart())}})}return e})(),uZ=(()=>{class e extends yH{static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275dir=Li({type:e,selectors:[["","matListItemAvatar",""]],hostAttrs:[1,"mat-mdc-list-item-avatar"],features:[Kr]})}return e})(),mZ=(()=>{class e extends yH{static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275dir=Li({type:e,selectors:[["","matListItemIcon",""]],hostAttrs:[1,"mat-mdc-list-item-icon"],features:[Kr]})}return e})(),pZ=new He("MAT_LIST_CONFIG"),_y=(()=>{class e{_isNonInteractive=!0;get disableRipple(){return this._disableRipple}set disableRipple(i){this._disableRipple=Lo(i)}_disableRipple=!1;get disabled(){return this._disabled}set disabled(i){this._disabled=Lo(i)}_disabled=!1;_defaultOptions=M(pZ,{optional:!0});static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,hostVars:1,hostBindings:function(r,s){r&2&&Ri("aria-disabled",s.disabled)},inputs:{disableRipple:"disableRipple",disabled:"disabled"}})}return e})(),fZ=(()=>{class e{_elementRef=M(Jt);_ngZone=M(vt);_listBase=M(_y,{optional:!0});_platform=M(sr);_hostElement;_isButtonElement;_noopAnimations;_avatars;_icons;set lines(i){this._explicitLines=Hp(i,null),this._updateItemLines(!1)}_explicitLines=null;get disableRipple(){return this.disabled||this._disableRipple||this._noopAnimations||!!this._listBase?.disableRipple}set disableRipple(i){this._disableRipple=Lo(i)}_disableRipple=!1;get disabled(){return this._disabled||!!this._listBase?.disabled}set disabled(i){this._disabled=Lo(i)}_disabled=!1;_subscriptions=new po;_rippleRenderer=null;_hasUnscopedTextContent=!1;rippleConfig;get rippleDisabled(){return this.disableRipple||!!this.rippleConfig.disabled}constructor(){M(Os).load(_c);let i=M(Qp,{optional:!0}),r=M(bs,{optional:!0});this.rippleConfig=i||{},this._hostElement=this._elementRef.nativeElement,this._isButtonElement=this._hostElement.nodeName.toLowerCase()==="button",this._noopAnimations=r==="NoopAnimations",this._listBase&&!this._listBase._isNonInteractive&&this._initInteractiveListItem(),this._isButtonElement&&!this._hostElement.hasAttribute("type")&&this._hostElement.setAttribute("type","button")}ngAfterViewInit(){this._monitorProjectedLinesAndTitle(),this._updateItemLines(!0)}ngOnDestroy(){this._subscriptions.unsubscribe(),this._rippleRenderer!==null&&this._rippleRenderer._removeTriggerEvents()}_hasIconOrAvatar(){return!!(this._avatars.length||this._icons.length)}_initInteractiveListItem(){this._hostElement.classList.add("mat-mdc-list-item-interactive"),this._rippleRenderer=new Zp(this,this._ngZone,this._hostElement,this._platform,M(wi)),this._rippleRenderer.setupTriggerEvents(this._hostElement)}_monitorProjectedLinesAndTitle(){this._ngZone.runOutsideAngular(()=>{this._subscriptions.add(sa(this._lines.changes,this._titles.changes).subscribe(()=>this._updateItemLines(!1)))})}_updateItemLines(i){if(!this._lines||!this._titles||!this._unscopedContent)return;i&&this._checkDomForUnscopedTextContent();let r=this._explicitLines??this._inferLinesFromContent(),s=this._unscopedContent.nativeElement;if(this._hostElement.classList.toggle("mat-mdc-list-item-single-line",r<=1),this._hostElement.classList.toggle("mdc-list-item--with-one-line",r<=1),this._hostElement.classList.toggle("mdc-list-item--with-two-lines",r===2),this._hostElement.classList.toggle("mdc-list-item--with-three-lines",r===3),this._hasUnscopedTextContent){let n=this._titles.length===0&&r===1;s.classList.toggle("mdc-list-item__primary-text",n),s.classList.toggle("mdc-list-item__secondary-text",!n)}else s.classList.remove("mdc-list-item__primary-text"),s.classList.remove("mdc-list-item__secondary-text")}_inferLinesFromContent(){let i=this._titles.length+this._lines.length;return this._hasUnscopedTextContent&&(i+=1),i}_checkDomForUnscopedTextContent(){this._hasUnscopedTextContent=Array.from(this._unscopedContent.nativeElement.childNodes).filter(i=>i.nodeType!==i.COMMENT_NODE).some(i=>!!(i.textContent&&i.textContent.trim()))}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,contentQueries:function(r,s,n){if(r&1&&(Or(n,uZ,4),Or(n,mZ,4)),r&2){let o;Zt(o=Qt())&&(s._avatars=o),Zt(o=Qt())&&(s._icons=o)}},hostVars:4,hostBindings:function(r,s){r&2&&(Ri("aria-disabled",s.disabled)("disabled",s._isButtonElement&&s.disabled||null),Ui("mdc-list-item--disabled",s.disabled))},inputs:{lines:"lines",disableRipple:"disableRipple",disabled:"disabled"}})}return e})();var vH=(()=>{class e extends _y{static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275cmp=it({type:e,selectors:[["mat-list"]],hostAttrs:[1,"mat-mdc-list","mat-mdc-list-base","mdc-list"],exportAs:["matList"],features:[Hs([{provide:_y,useExisting:e}]),Kr],ngContentSelectors:gH,decls:1,vars:0,template:function(r,s){r&1&&(gr(),Gt(0))},styles:[_H],encapsulation:2,changeDetection:0})}return e})(),bH=(()=>{class e extends fZ{_lines;_titles;_meta;_unscopedContent;_itemText;get activated(){return this._activated}set activated(i){this._activated=Lo(i)}_activated=!1;_getAriaCurrent(){return this._hostElement.nodeName==="A"&&this._activated?"page":null}_hasBothLeadingAndTrailing(){return this._meta.length!==0&&(this._avatars.length!==0||this._icons.length!==0)}static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275cmp=it({type:e,selectors:[["mat-list-item"],["a","mat-list-item",""],["button","mat-list-item",""]],contentQueries:function(r,s,n){if(r&1&&(Or(n,dZ,5),Or(n,cZ,5),Or(n,hZ,5)),r&2){let o;Zt(o=Qt())&&(s._lines=o),Zt(o=Qt())&&(s._titles=o),Zt(o=Qt())&&(s._meta=o)}},viewQuery:function(r,s){if(r&1&&(ws(sZ,5),ws(nZ,5)),r&2){let n;Zt(n=Qt())&&(s._unscopedContent=n.first),Zt(n=Qt())&&(s._itemText=n.first)}},hostAttrs:[1,"mat-mdc-list-item","mdc-list-item"],hostVars:13,hostBindings:function(r,s){r&2&&(Ri("aria-current",s._getAriaCurrent()),Ui("mdc-list-item--activated",s.activated)("mdc-list-item--with-leading-avatar",s._avatars.length!==0)("mdc-list-item--with-leading-icon",s._icons.length!==0)("mdc-list-item--with-trailing-meta",s._meta.length!==0)("mat-mdc-list-item-both-leading-and-trailing",s._hasBothLeadingAndTrailing())("_mat-animation-noopable",s._noopAnimations))},inputs:{activated:"activated"},exportAs:["matListItem"],features:[Kr],ngContentSelectors:aZ,decls:10,vars:0,consts:[["unscopedContent",""],[1,"mdc-list-item__content"],[1,"mat-mdc-list-item-unscoped-content",3,"cdkObserveContent"],[1,"mat-focus-indicator"]],template:function(r,s){if(r&1){let n=aa();gr(oZ),Gt(0),De(1,"span",1),Gt(2,1),Gt(3,2),De(4,"span",2,0),qi("cdkObserveContent",function(){return na(n),oa(s._updateItemLines(!0))}),Gt(6,3),Ze()(),Gt(7,4),Gt(8,5),pi(9,"div",3)}},dependencies:[RU],encapsulation:2,changeDetection:0})}return e})();var wH=(()=>{class e extends _y{_isNonInteractive=!1;static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275cmp=it({type:e,selectors:[["mat-nav-list"]],hostAttrs:["role","navigation",1,"mat-mdc-nav-list","mat-mdc-list-base","mdc-list"],exportAs:["matNavList"],features:[Hs([{provide:_y,useExisting:e}]),Kr],ngContentSelectors:gH,decls:1,vars:0,template:function(r,s){r&1&&(gr(),Gt(0))},styles:[_H],encapsulation:2,changeDetection:0})}return e})();var xH=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({imports:[AU,ur,Fd,JU,fH]})}return e})();var _Z=["*"],ix;function yZ(){if(ix===void 0&&(ix=null,typeof window<"u")){let e=window;e.trustedTypes!==void 0&&(ix=e.trustedTypes.createPolicy("angular#components",{createHTML:t=>t}))}return ix}function yy(e){return yZ()?.createHTML(e)||e}function CH(e){return Error(`Unable to find icon with the name "${e}"`)}function vZ(){return Error("Could not find HttpClient for use with Angular Material icons. Please add provideHttpClient() to your providers.")}function SH(e){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${e}".`)}function TH(e){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${e}".`)}var yc=class{url;svgText;options;svgElement;constructor(t,i,r){this.url=t,this.svgText=i,this.options=r}},bZ=(()=>{class e{_httpClient;_sanitizer;_errorHandler;_document;_svgIconConfigs=new Map;_iconSetConfigs=new Map;_cachedIconsByUrl=new Map;_inProgressUrlFetches=new Map;_fontCssClassesByAlias=new Map;_resolvers=[];_defaultFontSetClass=["material-icons","mat-ligature-font"];constructor(i,r,s,n){this._httpClient=i,this._sanitizer=r,this._errorHandler=n,this._document=s}addSvgIcon(i,r,s){return this.addSvgIconInNamespace("",i,r,s)}addSvgIconLiteral(i,r,s){return this.addSvgIconLiteralInNamespace("",i,r,s)}addSvgIconInNamespace(i,r,s,n){return this._addSvgIconConfig(i,r,new yc(s,null,n))}addSvgIconResolver(i){return this._resolvers.push(i),this}addSvgIconLiteralInNamespace(i,r,s,n){let o=this._sanitizer.sanitize(Un.HTML,s);if(!o)throw TH(s);let a=yy(o);return this._addSvgIconConfig(i,r,new yc("",a,n))}addSvgIconSet(i,r){return this.addSvgIconSetInNamespace("",i,r)}addSvgIconSetLiteral(i,r){return this.addSvgIconSetLiteralInNamespace("",i,r)}addSvgIconSetInNamespace(i,r,s){return this._addSvgIconSetConfig(i,new yc(r,null,s))}addSvgIconSetLiteralInNamespace(i,r,s){let n=this._sanitizer.sanitize(Un.HTML,r);if(!n)throw TH(r);let o=yy(n);return this._addSvgIconSetConfig(i,new yc("",o,s))}registerFontClassAlias(i,r=i){return this._fontCssClassesByAlias.set(i,r),this}classNameForFontAlias(i){return this._fontCssClassesByAlias.get(i)||i}setDefaultFontSetClass(...i){return this._defaultFontSetClass=i,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(i){let r=this._sanitizer.sanitize(Un.RESOURCE_URL,i);if(!r)throw SH(i);let s=this._cachedIconsByUrl.get(r);return s?Ue(rx(s)):this._loadSvgIconFromConfig(new yc(i,null)).pipe(fr(n=>this._cachedIconsByUrl.set(r,n)),rt(n=>rx(n)))}getNamedSvgIcon(i,r=""){let s=MH(r,i),n=this._svgIconConfigs.get(s);if(n)return this._getSvgFromConfig(n);if(n=this._getIconConfigFromResolvers(r,i),n)return this._svgIconConfigs.set(s,n),this._getSvgFromConfig(n);let o=this._iconSetConfigs.get(r);return o?this._getSvgFromIconSetConfigs(i,o):zh(CH(s))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(i){return i.svgText?Ue(rx(this._svgElementFromConfig(i))):this._loadSvgIconFromConfig(i).pipe(rt(r=>rx(r)))}_getSvgFromIconSetConfigs(i,r){let s=this._extractIconWithNameFromAnySet(i,r);if(s)return Ue(s);let n=r.filter(o=>!o.svgText).map(o=>this._loadSvgIconSetFromConfig(o).pipe(Yc(a=>{let d=`Loading icon set URL: ${this._sanitizer.sanitize(Un.RESOURCE_URL,o.url)} failed: ${a.message}`;return this._errorHandler.handleError(new Error(d)),Ue(null)})));return KO(n).pipe(rt(()=>{let o=this._extractIconWithNameFromAnySet(i,r);if(!o)throw CH(i);return o}))}_extractIconWithNameFromAnySet(i,r){for(let s=r.length-1;s>=0;s--){let n=r[s];if(n.svgText&&n.svgText.toString().indexOf(i)>-1){let o=this._svgElementFromConfig(n),a=this._extractSvgIconFromSet(o,i,n.options);if(a)return a}}return null}_loadSvgIconFromConfig(i){return this._fetchIcon(i).pipe(fr(r=>i.svgText=r),rt(()=>this._svgElementFromConfig(i)))}_loadSvgIconSetFromConfig(i){return i.svgText?Ue(null):this._fetchIcon(i).pipe(fr(r=>i.svgText=r))}_extractSvgIconFromSet(i,r,s){let n=i.querySelector(`[id="${r}"]`);if(!n)return null;let o=n.cloneNode(!0);if(o.removeAttribute("id"),o.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(o,s);if(o.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(o),s);let a=this._svgElementFromString(yy("<svg></svg>"));return a.appendChild(o),this._setSvgAttributes(a,s)}_svgElementFromString(i){let r=this._document.createElement("DIV");r.innerHTML=i;let s=r.querySelector("svg");if(!s)throw Error("<svg> tag not found");return s}_toSvgElement(i){let r=this._svgElementFromString(yy("<svg></svg>")),s=i.attributes;for(let n=0;n<s.length;n++){let{name:o,value:a}=s[n];o!=="id"&&r.setAttribute(o,a)}for(let n=0;n<i.childNodes.length;n++)i.childNodes[n].nodeType===this._document.ELEMENT_NODE&&r.appendChild(i.childNodes[n].cloneNode(!0));return r}_setSvgAttributes(i,r){return i.setAttribute("fit",""),i.setAttribute("height","100%"),i.setAttribute("width","100%"),i.setAttribute("preserveAspectRatio","xMidYMid meet"),i.setAttribute("focusable","false"),r&&r.viewBox&&i.setAttribute("viewBox",r.viewBox),i}_fetchIcon(i){let{url:r,options:s}=i,n=s?.withCredentials??!1;if(!this._httpClient)throw vZ();if(r==null)throw Error(`Cannot fetch icon from URL "${r}".`);let o=this._sanitizer.sanitize(Un.RESOURCE_URL,r);if(!o)throw SH(r);let a=this._inProgressUrlFetches.get(o);if(a)return a;let l=this._httpClient.get(o,{responseType:"text",withCredentials:n}).pipe(rt(d=>yy(d)),Hh(()=>this._inProgressUrlFetches.delete(o)),ek());return this._inProgressUrlFetches.set(o,l),l}_addSvgIconConfig(i,r,s){return this._svgIconConfigs.set(MH(i,r),s),this}_addSvgIconSetConfig(i,r){let s=this._iconSetConfigs.get(i);return s?s.push(r):this._iconSetConfigs.set(i,[r]),this}_svgElementFromConfig(i){if(!i.svgElement){let r=this._svgElementFromString(i.svgText);this._setSvgAttributes(r,i.options),i.svgElement=r}return i.svgElement}_getIconConfigFromResolvers(i,r){for(let s=0;s<this._resolvers.length;s++){let n=this._resolvers[s](r,i);if(n)return wZ(n)?new yc(n.url,null,n.options):new yc(n,null)}}static \u0275fac=function(r){return new(r||e)(jt(D3,8),jt(nR),jt(bt,8),jt(qh))};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function rx(e){return e.cloneNode(!0)}function MH(e,t){return e+":"+t}function wZ(e){return!!(e.url&&e.options)}var xZ=new He("MAT_ICON_DEFAULT_OPTIONS"),CZ=new He("mat-icon-location",{providedIn:"root",factory:SZ});function SZ(){let e=M(bt),t=e?e.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}var EH=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],TZ=EH.map(e=>`[${e}]`).join(", "),MZ=/^url\(['"]?#(.*?)['"]?\)$/,sx=(()=>{class e{_elementRef=M(Jt);_iconRegistry=M(bZ);_location=M(CZ);_errorHandler=M(qh);_defaultColor;get color(){return this._color||this._defaultColor}set color(i){this._color=i}_color;inline=!1;get svgIcon(){return this._svgIcon}set svgIcon(i){i!==this._svgIcon&&(i?this._updateSvgIcon(i):this._svgIcon&&this._clearSvgElement(),this._svgIcon=i)}_svgIcon;get fontSet(){return this._fontSet}set fontSet(i){let r=this._cleanupFontValue(i);r!==this._fontSet&&(this._fontSet=r,this._updateFontIconClasses())}_fontSet;get fontIcon(){return this._fontIcon}set fontIcon(i){let r=this._cleanupFontValue(i);r!==this._fontIcon&&(this._fontIcon=r,this._updateFontIconClasses())}_fontIcon;_previousFontSetClass=[];_previousFontIconClass;_svgName;_svgNamespace;_previousPath;_elementsWithExternalReferences;_currentIconFetch=po.EMPTY;constructor(){let i=M(new _b("aria-hidden"),{optional:!0}),r=M(xZ,{optional:!0});r&&(r.color&&(this.color=this._defaultColor=r.color),r.fontSet&&(this.fontSet=r.fontSet)),i||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(i){if(!i)return["",""];let r=i.split(":");switch(r.length){case 1:return["",r[0]];case 2:return r;default:throw Error(`Invalid icon name: "${i}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let i=this._elementsWithExternalReferences;if(i&&i.size){let r=this._location.getPathname();r!==this._previousPath&&(this._previousPath=r,this._prependPathToReferences(r))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(i){this._clearSvgElement();let r=this._location.getPathname();this._previousPath=r,this._cacheChildrenWithExternalReferences(i),this._prependPathToReferences(r),this._elementRef.nativeElement.appendChild(i)}_clearSvgElement(){let i=this._elementRef.nativeElement,r=i.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();r--;){let s=i.childNodes[r];(s.nodeType!==1||s.nodeName.toLowerCase()==="svg")&&s.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let i=this._elementRef.nativeElement,r=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(s=>s.length>0);this._previousFontSetClass.forEach(s=>i.classList.remove(s)),r.forEach(s=>i.classList.add(s)),this._previousFontSetClass=r,this.fontIcon!==this._previousFontIconClass&&!r.includes("mat-ligature-font")&&(this._previousFontIconClass&&i.classList.remove(this._previousFontIconClass),this.fontIcon&&i.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(i){return typeof i=="string"?i.trim().split(" ")[0]:i}_prependPathToReferences(i){let r=this._elementsWithExternalReferences;r&&r.forEach((s,n)=>{s.forEach(o=>{n.setAttribute(o.name,`url('${i}#${o.value}')`)})})}_cacheChildrenWithExternalReferences(i){let r=i.querySelectorAll(TZ),s=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let n=0;n<r.length;n++)EH.forEach(o=>{let a=r[n],l=a.getAttribute(o),d=l?l.match(MZ):null;if(d){let u=s.get(a);u||(u=[],s.set(a,u)),u.push({name:o,value:d[1]})}})}_updateSvgIcon(i){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),i){let[r,s]=this._splitIconName(i);r&&(this._svgNamespace=r),s&&(this._svgName=s),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(s,r).pipe(Es(1)).subscribe(n=>this._setSvgElement(n),n=>{let o=`Error retrieving icon ${r}:${s}! ${n.message}`;this._errorHandler.handleError(new Error(o))})}}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(r,s){r&2&&(Ri("data-mat-icon-type",s._usingFontIcon()?"font":"svg")("data-mat-icon-name",s._svgName||s.fontIcon)("data-mat-icon-namespace",s._svgNamespace||s.fontSet)("fontIcon",s._usingFontIcon()?s.fontIcon:null),Im(s.color?"mat-"+s.color:""),Ui("mat-icon-inline",s.inline)("mat-icon-no-color",s.color!=="primary"&&s.color!=="accent"&&s.color!=="warn"))},inputs:{color:"color",inline:[2,"inline","inline",It],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[Yr],ngContentSelectors:_Z,decls:1,vars:0,template:function(r,s){r&1&&(gr(),Gt(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color, inherit)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0})}return e})(),nx=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ei({type:e});static \u0275inj=Xt({imports:[ur,ur]})}return e})();var EZ=["*"];function RZ(e,t){if(e&1){let i=aa();De(0,"button",5),qi("click",function(){na(i);let s=hn();return oa(s.close())}),De(1,"mat-icon",6),or(2," close "),Ze()()}}function AZ(e,t){if(e&1){let i=aa();De(0,"button",5),qi("click",function(){na(i);let s=hn();return oa(s.closeMarkerSheet())}),De(1,"mat-icon",6),or(2," close "),Ze()()}}var IH=(()=>{class e{constructor(i){this.bottomSheetService=i,this.title="",this.closeDefault=!0,this.closeMarker=!1}close(){this.bottomSheetService.closeActiveBottomSheet()}closeMarkerSheet(){this.bottomSheetService.closeActiveBottomSheet()}static{this.\u0275fac=function(r){return new(r||e)(Us(Vd))}}static{this.\u0275cmp=it({type:e,selectors:[["app-base-bottom-sheet"]],inputs:{title:"title",closeDefault:"closeDefault",closeMarker:"closeMarker"},ngContentSelectors:EZ,decls:9,vars:3,consts:[[1,"sticky","top-0","z-10","flex","flex-col","w-full"],[1,"w-full","h-2"],[1,"flex","justify-between","h-10"],[1,"flex","items-center","w-4/5","h-10","pl-4","text-lg","font-semibold","text-bgs-primary-earth"],["mat-flat-button","",3,"click",4,"ngIf"],["mat-flat-button","",3,"click"],["aria-hidden","false","aria-label","close button"]],template:function(r,s){r&1&&(gr(),De(0,"div",0),pi(1,"span",1),De(2,"div",2)(3,"span",3),or(4),Ze(),tr(5,RZ,3,0,"button",4)(6,AZ,3,0,"button",4),Ze()(),De(7,"div"),Gt(8),Ze()),r&2&&(Ft(4),$g(" ",s.title!==null?s.title:""," "),Ft(),Mr("ngIf",s.closeDefault),Ft(),Mr("ngIf",s.closeMarker))},dependencies:[nx,sx,$h,Pm],encapsulation:2})}}return e})();var DH=[Ro.fromId("satellite"),Ro.fromId("topo"),Ro.fromId("navigation-3d"),Ro.fromId("osm"),Ro.fromId("gray-vector"),Ro.fromId("streets-vector"),Ro.fromId("terrain")];function IZ(e,t){e&1&&or(0," Loading basemaps... ")}function DZ(e,t){if(e&1&&pi(0,"img",6),e&2){let i=hn().$implicit;la("src",i.thumbnailUrl,gk)}}function PZ(e,t){if(e&1){let i=aa();De(0,"mat-list-item",2),qi("click",function(){let s=na(i).$implicit,n=hn(2);return oa(n.setBasemap(s))}),De(1,"div",3)(2,"div",4)(3,"span"),or(4),Ze(),tr(5,DZ,1,1,"img",5),Ze()()()}if(e&2){let i=t.$implicit;Ft(4),$g(" ",i==null?null:i.title," "),Ft(),Mr("ngIf",i.thumbnailUrl!==null)}}function OZ(e,t){if(e&1&&tr(0,PZ,6,2,"mat-list-item",1),e&2){let i=hn();Mr("ngForOf",i.basemapCollection)}}var PH=(()=>{class e{constructor(i){this.bottomSheetService=i,this.BASEMAP_COLLECTION=DH,this.basemapCollection=[]}ngOnInit(){Promise.all(this.BASEMAP_COLLECTION.map(i=>i.load())).then(i=>{this.basemapCollection=i}).catch(i=>{console.error("Error loading basemaps:",i)})}setBasemap(i){this.bottomSheetService.setSelectedBasemap(i),this.bottomSheetService.closeActiveBottomSheet()}static{this.\u0275fac=function(r){return new(r||e)(Us(Vd))}}static{this.\u0275cmp=it({type:e,selectors:[["app-basemaps"]],decls:5,vars:2,consts:[[3,"title"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"cursor-pointer"],[1,"flex","items-center","justify-between","w-full"],["class","w-24 h-16","alt","",3,"src",4,"ngIf"],["alt","",1,"w-24","h-16",3,"src"]],template:function(r,s){r&1&&(De(0,"app-base-bottom-sheet",0)(1,"mat-nav-list")(2,"mat-list"),tr(3,IZ,1,0)(4,OZ,1,1,"mat-list-item"),Ze()()()),r&2&&(Mr("title","Basemaps"),Ft(3),Mn(s.basemapCollection.length===0?3:4))},dependencies:[IH,xH,vH,wH,bH,$h,Ik,Pm],encapsulation:2})}}return e})();var vc=function(e){return e.BASE_MAP="BASEMAP",e.ACTIVE_LAYERS="ACTIVE_LAYERS",e}(vc||{});var vy=class{_attachedHost;attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;t!=null&&(this._attachedHost=null,t.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(t){this._attachedHost=t}},Kp=class extends vy{component;viewContainerRef;injector;componentFactoryResolver;projectableNodes;constructor(t,i,r,s,n){super(),this.component=t,this.viewContainerRef=i,this.injector=r,this.projectableNodes=n}},Yp=class extends vy{templateRef;viewContainerRef;context;injector;constructor(t,i,r,s){super(),this.templateRef=t,this.viewContainerRef=i,this.context=r,this.injector=s}get origin(){return this.templateRef.elementRef}attach(t,i=this.context){return this.context=i,super.attach(t)}detach(){return this.context=void 0,super.detach()}},yA=class extends vy{element;constructor(t){super(),this.element=t instanceof Jt?t.nativeElement:t}},Xp=class{_attachedPortal;_disposeFn;_isDisposed=!1;hasAttached(){return!!this._attachedPortal}attach(t){if(t instanceof Kp)return this._attachedPortal=t,this.attachComponentPortal(t);if(t instanceof Yp)return this._attachedPortal=t,this.attachTemplatePortal(t);if(this.attachDomPortal&&t instanceof yA)return this._attachedPortal=t,this.attachDomPortal(t)}attachDomPortal=null;detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var ax=class extends Xp{outletElement;_appRef;_defaultInjector;_document;constructor(t,i,r,s,n){super(),this.outletElement=t,this._appRef=r,this._defaultInjector=s,this._document=n}attachComponentPortal(t){let i;if(t.viewContainerRef){let r=t.injector||t.viewContainerRef.injector,s=r.get(oM,null,{optional:!0})||void 0;i=t.viewContainerRef.createComponent(t.component,{index:t.viewContainerRef.length,injector:r,ngModuleRef:s,projectableNodes:t.projectableNodes||void 0}),this.setDisposeFn(()=>i.destroy())}else i=wb(t.component,{elementInjector:t.injector||this._defaultInjector||wi.NULL,environmentInjector:this._appRef.injector,projectableNodes:t.projectableNodes||void 0}),this._appRef.attachView(i.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(i.hostView),i.destroy()});return this.outletElement.appendChild(this._getComponentRootNode(i)),this._attachedPortal=t,i}attachTemplatePortal(t){let i=t.viewContainerRef,r=i.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return r.rootNodes.forEach(s=>this.outletElement.appendChild(s)),r.detectChanges(),this.setDisposeFn(()=>{let s=i.indexOf(r);s!==-1&&i.remove(s)}),this._attachedPortal=t,r}attachDomPortal=t=>{let i=t.element;i.parentNode;let r=this._document.createComment("dom-portal");i.parentNode.insertBefore(r,i),this.outletElement.appendChild(i),this._attachedPortal=t,super.setDisposeFn(()=>{r.parentNode&&r.parentNode.replaceChild(i,r)})};dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}};var by=(()=>{class e extends Xp{_moduleRef=M(oM,{optional:!0});_document=M(bt);_viewContainerRef=M(Am);_isInitialized=!1;_attachedRef;constructor(){super()}get portal(){return this._attachedPortal}set portal(i){this.hasAttached()&&!i&&!this._isInitialized||(this.hasAttached()&&super.detach(),i&&super.attach(i),this._attachedPortal=i||null)}attached=new yi;get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(i){i.setAttachedHost(this);let r=i.viewContainerRef!=null?i.viewContainerRef:this._viewContainerRef,s=r.createComponent(i.component,{index:r.length,injector:i.injector||r.injector,projectableNodes:i.projectableNodes||void 0,ngModuleRef:this._moduleRef||void 0});return r!==this._viewContainerRef&&this._getRootNode().appendChild(s.hostView.rootNodes[0]),super.setDisposeFn(()=>s.destroy()),this._attachedPortal=i,this._attachedRef=s,this.attached.emit(s),s}attachTemplatePortal(i){i.setAttachedHost(this);let r=this._viewContainerRef.createEmbeddedView(i.templateRef,i.context,{injector:i.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=i,this._attachedRef=r,this.attached.emit(r),r}attachDomPortal=i=>{let r=i.element;r.parentNode;let s=this._document.createComment("dom-portal");i.setAttachedHost(this),r.parentNode.insertBefore(s,r),this._getRootNode().appendChild(r),this._attachedPortal=i,super.setDisposeFn(()=>{s.parentNode&&s.parentNode.replaceChild(r,s)})};_getRootNode(){let i=this._viewContainerRef.element.nativeElement;return i.nodeType===i.ELEMENT_NODE?i:i.parentNode}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Li({type:e,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[0,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Kr]})}return e})();var OH=Uw(),vA=class{_viewportRuler;_previousHTMLStyles={top:"",left:""};_previousScrollPosition;_isEnabled=!1;_document;constructor(t,i){this._viewportRuler=t,this._document=i}attach(){}enable(){if(this._canBeEnabled()){let t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=Ur(-this._previousScrollPosition.left),t.style.top=Ur(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let t=this._document.documentElement,i=this._document.body,r=t.style,s=i.style,n=r.scrollBehavior||"",o=s.scrollBehavior||"";this._isEnabled=!1,r.left=this._previousHTMLStyles.left,r.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),OH&&(r.scrollBehavior=s.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),OH&&(r.scrollBehavior=n,s.scrollBehavior=o)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let i=this._document.body,r=this._viewportRuler.getViewportSize();return i.scrollHeight>r.height||i.scrollWidth>r.width}};var bA=class{_scrollDispatcher;_ngZone;_viewportRuler;_config;_scrollSubscription=null;_overlayRef;_initialScrollPosition;constructor(t,i,r,s){this._scrollDispatcher=t,this._ngZone=i,this._viewportRuler=r,this._config=s}attach(t){this._overlayRef,this._overlayRef=t}enable(){if(this._scrollSubscription)return;let t=this._scrollDispatcher.scrolled(0).pipe(zi(i=>!i||!this._overlayRef.overlayElement.contains(i.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{let i=this._viewportRuler.getViewportScrollPosition().top;Math.abs(i-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}_detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}},lx=class{enable(){}disable(){}attach(){}};function wA(e,t){return t.some(i=>{let r=e.bottom<i.top,s=e.top>i.bottom,n=e.right<i.left,o=e.left>i.right;return r||s||n||o})}function kH(e,t){return t.some(i=>{let r=e.top<i.top,s=e.bottom>i.bottom,n=e.left<i.left,o=e.right>i.right;return r||s||n||o})}var xA=class{_scrollDispatcher;_viewportRuler;_ngZone;_config;_scrollSubscription=null;_overlayRef;constructor(t,i,r,s){this._scrollDispatcher=t,this._viewportRuler=i,this._ngZone=r,this._config=s}attach(t){this._overlayRef,this._overlayRef=t}enable(){if(!this._scrollSubscription){let t=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(t).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let i=this._overlayRef.overlayElement.getBoundingClientRect(),{width:r,height:s}=this._viewportRuler.getViewportSize();wA(i,[{width:r,height:s,bottom:s,right:r,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},kZ=(()=>{class e{_scrollDispatcher=M(hy);_viewportRuler=M(uy);_ngZone=M(vt);_document=M(bt);constructor(){}noop=()=>new lx;close=i=>new bA(this._scrollDispatcher,this._ngZone,this._viewportRuler,i);block=()=>new vA(this._viewportRuler,this._document);reposition=i=>new xA(this._scrollDispatcher,this._viewportRuler,this._ngZone,i);static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),wy=class{positionStrategy;scrollStrategy=new lx;panelClass="";hasBackdrop=!1;backdropClass="cdk-overlay-dark-backdrop";width;height;minWidth;minHeight;maxWidth;maxHeight;direction;disposeOnNavigation=!1;constructor(t){if(t){let i=Object.keys(t);for(let r of i)t[r]!==void 0&&(this[r]=t[r])}}};var CA=class{connectionPair;scrollableViewProperties;constructor(t,i){this.connectionPair=t,this.scrollableViewProperties=i}};var UH=(()=>{class e{_attachedOverlays=[];_document=M(bt);_isAttached;constructor(){}ngOnDestroy(){this.detach()}add(i){this.remove(i),this._attachedOverlays.push(i)}remove(i){let r=this._attachedOverlays.indexOf(i);r>-1&&this._attachedOverlays.splice(r,1),this._attachedOverlays.length===0&&this.detach()}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),LZ=(()=>{class e extends UH{_ngZone=M(vt);_renderer=M(Ga).createRenderer(null,null);_cleanupKeydown;add(i){super.add(i),this._isAttached||(this._ngZone.runOutsideAngular(()=>{this._cleanupKeydown=this._renderer.listen("body","keydown",this._keydownListener)}),this._isAttached=!0)}detach(){this._isAttached&&(this._cleanupKeydown?.(),this._isAttached=!1)}_keydownListener=i=>{let r=this._attachedOverlays;for(let s=r.length-1;s>-1;s--)if(r[s]._keydownEvents.observers.length>0){this._ngZone.run(()=>r[s]._keydownEvents.next(i));break}};static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),FZ=(()=>{class e extends UH{_platform=M(sr);_ngZone=M(vt,{optional:!0});_cursorOriginalValue;_cursorStyleIsSet=!1;_pointerDownEventTarget;add(i){if(super.add(i),!this._isAttached){let r=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(r)):this._addEventListeners(r),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=r.style.cursor,r.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let i=this._document.body;i.removeEventListener("pointerdown",this._pointerDownListener,!0),i.removeEventListener("click",this._clickListener,!0),i.removeEventListener("auxclick",this._clickListener,!0),i.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(i.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(i){i.addEventListener("pointerdown",this._pointerDownListener,!0),i.addEventListener("click",this._clickListener,!0),i.addEventListener("auxclick",this._clickListener,!0),i.addEventListener("contextmenu",this._clickListener,!0)}_pointerDownListener=i=>{this._pointerDownEventTarget=Fo(i)};_clickListener=i=>{let r=Fo(i),s=i.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:r;this._pointerDownEventTarget=null;let n=this._attachedOverlays.slice();for(let o=n.length-1;o>-1;o--){let a=n[o];if(a._outsidePointerEvents.observers.length<1||!a.hasAttached())continue;if(LH(a.overlayElement,r)||LH(a.overlayElement,s))break;let l=a._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>l.next(i)):l.next(i)}};static \u0275fac=(()=>{let i;return function(s){return(i||(i=as(e)))(s||e)}})();static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function LH(e,t){let i=typeof ShadowRoot<"u"&&ShadowRoot,r=t;for(;r;){if(r===e)return!0;r=i&&r instanceof ShadowRoot?r.host:r.parentNode}return!1}var HH=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["ng-component"]],hostAttrs:["cdk-overlay-style-loader",""],decls:0,vars:0,template:function(r,s){},styles:[".cdk-overlay-container,.cdk-global-overlay-wrapper{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{position:fixed}@layer cdk-overlay{.cdk-overlay-container{z-index:1000}}.cdk-overlay-container:empty{display:none}.cdk-global-overlay-wrapper{display:flex;position:absolute}@layer cdk-overlay{.cdk-global-overlay-wrapper{z-index:1000}}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;display:flex;max-width:100%;max-height:100%}@layer cdk-overlay{.cdk-overlay-pane{z-index:1000}}.cdk-overlay-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:auto;-webkit-tap-highlight-color:rgba(0,0,0,0);opacity:0}@layer cdk-overlay{.cdk-overlay-backdrop{z-index:1000;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}}.cdk-overlay-backdrop-showing{opacity:1}@media(forced-colors: active){.cdk-overlay-backdrop-showing{opacity:.6}}@layer cdk-overlay{.cdk-overlay-dark-backdrop{background:rgba(0,0,0,.32)}}.cdk-overlay-transparent-backdrop{transition:visibility 1ms linear,opacity 1ms linear;visibility:hidden;opacity:1}.cdk-overlay-transparent-backdrop.cdk-overlay-backdrop-showing,.cdk-high-contrast-active .cdk-overlay-transparent-backdrop{opacity:0;visibility:visible}.cdk-overlay-backdrop-noop-animation{transition:none}.cdk-overlay-connected-position-bounding-box{position:absolute;display:flex;flex-direction:column;min-width:1px;min-height:1px}@layer cdk-overlay{.cdk-overlay-connected-position-bounding-box{z-index:1000}}.cdk-global-scrollblock{position:fixed;width:100%;overflow-y:scroll}"],encapsulation:2,changeDetection:0})}return e})(),cx=(()=>{class e{_platform=M(sr);_containerElement;_document=M(bt);_styleLoader=M(Os);constructor(){}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._loadStyles(),this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let i="cdk-overlay-container";if(this._platform.isBrowser||WR()){let s=this._document.querySelectorAll(`.${i}[platform="server"], .${i}[platform="test"]`);for(let n=0;n<s.length;n++)s[n].remove()}let r=this._document.createElement("div");r.classList.add(i),WR()?r.setAttribute("platform","test"):this._platform.isBrowser||r.setAttribute("platform","server"),this._document.body.appendChild(r),this._containerElement=r}_loadStyles(){this._styleLoader.load(HH)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Jp=class{_portalOutlet;_host;_pane;_config;_ngZone;_keyboardDispatcher;_document;_location;_outsideClickDispatcher;_animationsDisabled;_injector;_renderer;_backdropElement=null;_backdropTimeout;_backdropClick=new $e;_attachments=new $e;_detachments=new $e;_positionStrategy;_scrollStrategy;_locationChanges=po.EMPTY;_cleanupBackdropClick;_cleanupBackdropTransitionEnd;_previousHostParent;_keydownEvents=new $e;_outsidePointerEvents=new $e;_renders=new $e;_afterRenderRef;_afterNextRenderRef;constructor(t,i,r,s,n,o,a,l,d,u=!1,m,p){this._portalOutlet=t,this._host=i,this._pane=r,this._config=s,this._ngZone=n,this._keyboardDispatcher=o,this._document=a,this._location=l,this._outsideClickDispatcher=d,this._animationsDisabled=u,this._injector=m,this._renderer=p,s.scrollStrategy&&(this._scrollStrategy=s.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=s.positionStrategy,this._afterRenderRef=pM(()=>lk(()=>{this._renders.next()},{injector:this._injector}))}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let i=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=_o(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof i?.onDestroy=="function"&&i.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),i}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){let t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete(),this._afterRenderRef.destroy(),this._renders.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=I(I({},this._config),t),this._updateElementSize()}setDirection(t){this._config=se(I({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){let t=this._config.direction;return t?typeof t=="string"?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let t=this._pane.style;t.width=Ur(this._config.width),t.height=Ur(this._config.height),t.minWidth=Ur(this._config.minWidth),t.minHeight=Ur(this._config.minHeight),t.maxWidth=Ur(this._config.maxWidth),t.maxHeight=Ur(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){let t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._cleanupBackdropClick?.(),this._cleanupBackdropClick=this._renderer.listen(this._backdropElement,"click",i=>this._backdropClick.next(i)),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let t=this._backdropElement;if(t){if(this._animationsDisabled){this._disposeBackdrop(t);return}t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{this._cleanupBackdropTransitionEnd?.(),this._cleanupBackdropTransitionEnd=this._renderer.listen(t,"transitionend",i=>{this._disposeBackdrop(i.target)})}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,i,r){let s=jp(i||[]).filter(n=>!!n);s.length&&(r?t.classList.add(...s):t.classList.remove(...s))}_detachContentWhenEmpty(){this._ngZone.runOutsideAngular(()=>{let t=this._renders.pipe(ki(sa(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){let t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){this._cleanupBackdropClick?.(),this._cleanupBackdropTransitionEnd?.(),t&&(t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},FH="cdk-overlay-connected-position-bounding-box",NZ=/([A-Za-z%]+)$/,SA=class{_viewportRuler;_document;_platform;_overlayContainer;_overlayRef;_isInitialRender;_lastBoundingBoxSize={width:0,height:0};_isPushed=!1;_canPush=!0;_growAfterOpen=!1;_hasFlexibleDimensions=!0;_positionLocked=!1;_originRect;_overlayRect;_viewportRect;_containerRect;_viewportMargin=0;_scrollables=[];_preferredPositions=[];_origin;_pane;_isDisposed;_boundingBox;_lastPosition;_lastScrollVisibility;_positionChanges=new $e;_resizeSubscription=po.EMPTY;_offsetX=0;_offsetY=0;_transformOriginSelector;_appliedPanelClasses=[];_previousPushAmount;positionChanges=this._positionChanges;get positions(){return this._preferredPositions}constructor(t,i,r,s,n){this._viewportRuler=i,this._document=r,this._platform=s,this._overlayContainer=n,this.setOrigin(t)}attach(t){this._overlayRef&&this._overlayRef,this._validatePositions(),t.hostElement.classList.add(FH),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let t=this._originRect,i=this._overlayRect,r=this._viewportRect,s=this._containerRect,n=[],o;for(let a of this._preferredPositions){let l=this._getOriginPoint(t,s,a),d=this._getOverlayPoint(l,i,a),u=this._getOverlayFit(d,i,r,a);if(u.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(a,l);return}if(this._canFitWithFlexibleDimensions(u,d,r)){n.push({position:a,origin:l,overlayRect:i,boundingBoxRect:this._calculateBoundingBoxRect(l,a)});continue}(!o||o.overlayFit.visibleArea<u.visibleArea)&&(o={overlayFit:u,overlayPoint:d,originPoint:l,position:a,overlayRect:i})}if(n.length){let a=null,l=-1;for(let d of n){let u=d.boundingBoxRect.width*d.boundingBoxRect.height*(d.position.weight||1);u>l&&(l=u,a=d)}this._isPushed=!1,this._applyPosition(a.position,a.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(o.position,o.originPoint);return}this._applyPosition(o.position,o.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Eu(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(FH),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let i=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,i)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,t.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,i,r){let s;if(r.originX=="center")s=t.left+t.width/2;else{let o=this._isRtl()?t.right:t.left,a=this._isRtl()?t.left:t.right;s=r.originX=="start"?o:a}i.left<0&&(s-=i.left);let n;return r.originY=="center"?n=t.top+t.height/2:n=r.originY=="top"?t.top:t.bottom,i.top<0&&(n-=i.top),{x:s,y:n}}_getOverlayPoint(t,i,r){let s;r.overlayX=="center"?s=-i.width/2:r.overlayX==="start"?s=this._isRtl()?-i.width:0:s=this._isRtl()?0:-i.width;let n;return r.overlayY=="center"?n=-i.height/2:n=r.overlayY=="top"?0:-i.height,{x:t.x+s,y:t.y+n}}_getOverlayFit(t,i,r,s){let n=VH(i),{x:o,y:a}=t,l=this._getOffset(s,"x"),d=this._getOffset(s,"y");l&&(o+=l),d&&(a+=d);let u=0-o,m=o+n.width-r.width,p=0-a,f=a+n.height-r.height,g=this._subtractOverflows(n.width,u,m),_=this._subtractOverflows(n.height,p,f),y=g*_;return{visibleArea:y,isCompletelyWithinViewport:n.width*n.height===y,fitsInViewportVertically:_===n.height,fitsInViewportHorizontally:g==n.width}}_canFitWithFlexibleDimensions(t,i,r){if(this._hasFlexibleDimensions){let s=r.bottom-i.y,n=r.right-i.x,o=NH(this._overlayRef.getConfig().minHeight),a=NH(this._overlayRef.getConfig().minWidth),l=t.fitsInViewportVertically||o!=null&&o<=s,d=t.fitsInViewportHorizontally||a!=null&&a<=n;return l&&d}return!1}_pushOverlayOnScreen(t,i,r){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};let s=VH(i),n=this._viewportRect,o=Math.max(t.x+s.width-n.width,0),a=Math.max(t.y+s.height-n.height,0),l=Math.max(n.top-r.top-t.y,0),d=Math.max(n.left-r.left-t.x,0),u=0,m=0;return s.width<=n.width?u=d||-o:u=t.x<this._viewportMargin?n.left-r.left-t.x:0,s.height<=n.height?m=l||-a:m=t.y<this._viewportMargin?n.top-r.top-t.y:0,this._previousPushAmount={x:u,y:m},{x:t.x+u,y:t.y+m}}_applyPosition(t,i){if(this._setTransformOrigin(t),this._setOverlayElementStyles(i,t),this._setBoundingBoxStyles(i,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._positionChanges.observers.length){let r=this._getScrollVisibility();if(t!==this._lastPosition||!this._lastScrollVisibility||!VZ(this._lastScrollVisibility,r)){let s=new CA(t,r);this._positionChanges.next(s)}this._lastScrollVisibility=r}this._lastPosition=t,this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;let i=this._boundingBox.querySelectorAll(this._transformOriginSelector),r,s=t.overlayY;t.overlayX==="center"?r="center":this._isRtl()?r=t.overlayX==="start"?"right":"left":r=t.overlayX==="start"?"left":"right";for(let n=0;n<i.length;n++)i[n].style.transformOrigin=`${r} ${s}`}_calculateBoundingBoxRect(t,i){let r=this._viewportRect,s=this._isRtl(),n,o,a;if(i.overlayY==="top")o=t.y,n=r.height-o+this._viewportMargin;else if(i.overlayY==="bottom")a=r.height-t.y+this._viewportMargin*2,n=r.height-a+this._viewportMargin;else{let f=Math.min(r.bottom-t.y+r.top,t.y),g=this._lastBoundingBoxSize.height;n=f*2,o=t.y-f,n>g&&!this._isInitialRender&&!this._growAfterOpen&&(o=t.y-g/2)}let l=i.overlayX==="start"&&!s||i.overlayX==="end"&&s,d=i.overlayX==="end"&&!s||i.overlayX==="start"&&s,u,m,p;if(d)p=r.width-t.x+this._viewportMargin*2,u=t.x-this._viewportMargin;else if(l)m=t.x,u=r.right-t.x;else{let f=Math.min(r.right-t.x+r.left,t.x),g=this._lastBoundingBoxSize.width;u=f*2,m=t.x-f,u>g&&!this._isInitialRender&&!this._growAfterOpen&&(m=t.x-g/2)}return{top:o,left:m,bottom:a,right:p,width:u,height:n}}_setBoundingBoxStyles(t,i){let r=this._calculateBoundingBoxRect(t,i);!this._isInitialRender&&!this._growAfterOpen&&(r.height=Math.min(r.height,this._lastBoundingBoxSize.height),r.width=Math.min(r.width,this._lastBoundingBoxSize.width));let s={};if(this._hasExactPosition())s.top=s.left="0",s.bottom=s.right=s.maxHeight=s.maxWidth="",s.width=s.height="100%";else{let n=this._overlayRef.getConfig().maxHeight,o=this._overlayRef.getConfig().maxWidth;s.height=Ur(r.height),s.top=Ur(r.top),s.bottom=Ur(r.bottom),s.width=Ur(r.width),s.left=Ur(r.left),s.right=Ur(r.right),i.overlayX==="center"?s.alignItems="center":s.alignItems=i.overlayX==="end"?"flex-end":"flex-start",i.overlayY==="center"?s.justifyContent="center":s.justifyContent=i.overlayY==="bottom"?"flex-end":"flex-start",n&&(s.maxHeight=Ur(n)),o&&(s.maxWidth=Ur(o))}this._lastBoundingBoxSize=r,Eu(this._boundingBox.style,s)}_resetBoundingBoxStyles(){Eu(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Eu(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,i){let r={},s=this._hasExactPosition(),n=this._hasFlexibleDimensions,o=this._overlayRef.getConfig();if(s){let u=this._viewportRuler.getViewportScrollPosition();Eu(r,this._getExactOverlayY(i,t,u)),Eu(r,this._getExactOverlayX(i,t,u))}else r.position="static";let a="",l=this._getOffset(i,"x"),d=this._getOffset(i,"y");l&&(a+=`translateX(${l}px) `),d&&(a+=`translateY(${d}px)`),r.transform=a.trim(),o.maxHeight&&(s?r.maxHeight=Ur(o.maxHeight):n&&(r.maxHeight="")),o.maxWidth&&(s?r.maxWidth=Ur(o.maxWidth):n&&(r.maxWidth="")),Eu(this._pane.style,r)}_getExactOverlayY(t,i,r){let s={top:"",bottom:""},n=this._getOverlayPoint(i,this._overlayRect,t);if(this._isPushed&&(n=this._pushOverlayOnScreen(n,this._overlayRect,r)),t.overlayY==="bottom"){let o=this._document.documentElement.clientHeight;s.bottom=`${o-(n.y+this._overlayRect.height)}px`}else s.top=Ur(n.y);return s}_getExactOverlayX(t,i,r){let s={left:"",right:""},n=this._getOverlayPoint(i,this._overlayRect,t);this._isPushed&&(n=this._pushOverlayOnScreen(n,this._overlayRect,r));let o;if(this._isRtl()?o=t.overlayX==="end"?"left":"right":o=t.overlayX==="end"?"right":"left",o==="right"){let a=this._document.documentElement.clientWidth;s.right=`${a-(n.x+this._overlayRect.width)}px`}else s.left=Ur(n.x);return s}_getScrollVisibility(){let t=this._getOriginRect(),i=this._pane.getBoundingClientRect(),r=this._scrollables.map(s=>s.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:kH(t,r),isOriginOutsideView:wA(t,r),isOverlayClipped:kH(i,r),isOverlayOutsideView:wA(i,r)}}_subtractOverflows(t,...i){return i.reduce((r,s)=>r-Math.max(s,0),t)}_getNarrowedViewportRect(){let t=this._document.documentElement.clientWidth,i=this._document.documentElement.clientHeight,r=this._viewportRuler.getViewportScrollPosition();return{top:r.top+this._viewportMargin,left:r.left+this._viewportMargin,right:r.left+t-this._viewportMargin,bottom:r.top+i-this._viewportMargin,width:t-2*this._viewportMargin,height:i-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,i){return i==="x"?t.offsetX==null?this._offsetX:t.offsetX:t.offsetY==null?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&jp(t).forEach(i=>{i!==""&&this._appliedPanelClasses.indexOf(i)===-1&&(this._appliedPanelClasses.push(i),this._pane.classList.add(i))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){let t=this._origin;if(t instanceof Jt)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();let i=t.width||0,r=t.height||0;return{top:t.y,bottom:t.y+r,left:t.x,right:t.x+i,height:r,width:i}}};function Eu(e,t){for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function NH(e){if(typeof e!="number"&&e!=null){let[t,i]=e.split(NZ);return!i||i==="px"?parseFloat(t):null}return e||null}function VH(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}function VZ(e,t){return e===t?!0:e.isOriginClipped===t.isOriginClipped&&e.isOriginOutsideView===t.isOriginOutsideView&&e.isOverlayClipped===t.isOverlayClipped&&e.isOverlayOutsideView===t.isOverlayOutsideView}var BH="cdk-global-overlay-wrapper",TA=class{_overlayRef;_cssPosition="static";_topOffset="";_bottomOffset="";_alignItems="";_xPosition="";_xOffset="";_width="";_height="";_isDisposed=!1;attach(t){let i=t.getConfig();this._overlayRef=t,this._width&&!i.width&&t.updateSize({width:this._width}),this._height&&!i.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(BH),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let t=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement.style,r=this._overlayRef.getConfig(),{width:s,height:n,maxWidth:o,maxHeight:a}=r,l=(s==="100%"||s==="100vw")&&(!o||o==="100%"||o==="100vw"),d=(n==="100%"||n==="100vh")&&(!a||a==="100%"||a==="100vh"),u=this._xPosition,m=this._xOffset,p=this._overlayRef.getConfig().direction==="rtl",f="",g="",_="";l?_="flex-start":u==="center"?(_="center",p?g=m:f=m):p?u==="left"||u==="end"?(_="flex-end",f=m):(u==="right"||u==="start")&&(_="flex-start",g=m):u==="left"||u==="start"?(_="flex-start",f=m):(u==="right"||u==="end")&&(_="flex-end",g=m),t.position=this._cssPosition,t.marginLeft=l?"0":f,t.marginTop=d?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=l?"0":g,i.justifyContent=_,i.alignItems=d?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let t=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement,r=i.style;i.classList.remove(BH),r.justifyContent=r.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}},BZ=(()=>{class e{_viewportRuler=M(uy);_document=M(bt);_platform=M(sr);_overlayContainer=M(cx);constructor(){}global(){return new TA}flexibleConnectedTo(i){return new SA(i,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),xy=(()=>{class e{scrollStrategies=M(kZ);_overlayContainer=M(cx);_positionBuilder=M(BZ);_keyboardDispatcher=M(LZ);_injector=M(wi);_ngZone=M(vt);_document=M(bt);_directionality=M(Jn);_location=M(Dm);_outsideClickDispatcher=M(FZ);_animationsModuleType=M(bs,{optional:!0});_idGenerator=M(vl);_renderer=M(Ga).createRenderer(null,null);_appRef;_styleLoader=M(Os);constructor(){}create(i){this._styleLoader.load(HH);let r=this._createHostElement(),s=this._createPaneElement(r),n=this._createPortalOutlet(s),o=new wy(i);return o.direction=o.direction||this._directionality.value,new Jp(n,r,s,o,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations",this._injector.get(Kl),this._renderer)}position(){return this._positionBuilder}_createPaneElement(i){let r=this._document.createElement("div");return r.id=this._idGenerator.getId("cdk-overlay-"),r.classList.add("cdk-overlay-pane"),i.appendChild(r),r}_createHostElement(){let i=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(i),i}_createPortalOutlet(i){return this._appRef||(this._appRef=this._injector.get(td)),new ax(i,null,this._appRef,this._injector,this._document)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function zZ(e,t){}var ef=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;positionStrategy;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!1;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;closeOnNavigation=!0;closeOnDestroy=!0;closeOnOverlayDetachments=!0;componentFactoryResolver;providers;container;templateContext};var EA=(()=>{class e extends Xp{_elementRef=M(Jt);_focusTrapFactory=M(Qw);_config;_interactivityChecker=M(py);_ngZone=M(vt);_overlayRef=M(Jp);_focusMonitor=M(yl);_renderer=M(Yl);_platform=M(sr);_document=M(bt,{optional:!0});_portalOutlet;_focusTrap=null;_elementFocusedBeforeDialogWasOpened=null;_closeInteractionType=null;_ariaLabelledByQueue=[];_changeDetectorRef=M(ls);_injector=M(wi);_isDestroyed=!1;constructor(){super(),this._config=M(ef,{optional:!0})||new ef,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(i){this._ariaLabelledByQueue.push(i),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(i){let r=this._ariaLabelledByQueue.indexOf(i);r>-1&&(this._ariaLabelledByQueue.splice(r,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._isDestroyed=!0,this._restoreFocus()}attachComponentPortal(i){this._portalOutlet.hasAttached();let r=this._portalOutlet.attachComponentPortal(i);return this._contentAttached(),r}attachTemplatePortal(i){this._portalOutlet.hasAttached();let r=this._portalOutlet.attachTemplatePortal(i);return this._contentAttached(),r}attachDomPortal=i=>{this._portalOutlet.hasAttached();let r=this._portalOutlet.attachDomPortal(i);return this._contentAttached(),r};_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(i,r){this._interactivityChecker.isFocusable(i)||(i.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let s=()=>{n(),o(),i.removeAttribute("tabindex")},n=this._renderer.listen(i,"blur",s),o=this._renderer.listen(i,"mousedown",s)})),i.focus(r)}_focusByCssSelector(i,r){let s=this._elementRef.nativeElement.querySelector(i);s&&this._forceFocus(s,r)}_trapFocus(){this._isDestroyed||_o(()=>{let i=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||i.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElement()||this._focusDialogContainer();break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}},{injector:this._injector})}_restoreFocus(){let i=this._config.restoreFocus,r=null;if(typeof i=="string"?r=this._document.querySelector(i):typeof i=="boolean"?r=i?this._elementFocusedBeforeDialogWasOpened:null:i&&(r=i),this._config.restoreFocus&&r&&typeof r.focus=="function"){let s=Wp(),n=this._elementRef.nativeElement;(!s||s===this._document.body||s===n||n.contains(s))&&(this._focusMonitor?(this._focusMonitor.focusVia(r,this._closeInteractionType),this._closeInteractionType=null):r.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let i=this._elementRef.nativeElement,r=Wp();return i===r||i.contains(r)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Wp()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["cdk-dialog-container"]],viewQuery:function(r,s){if(r&1&&ws(by,7),r&2){let n;Zt(n=Qt())&&(s._portalOutlet=n.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(r,s){r&2&&Ri("id",s._config.id||null)("role",s._config.role)("aria-modal",s._config.ariaModal)("aria-labelledby",s._config.ariaLabel?null:s._ariaLabelledByQueue[0])("aria-label",s._config.ariaLabel)("aria-describedby",s._config.ariaDescribedBy||null)},features:[Kr],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(r,s){r&1&&tr(0,zZ,0,0,"ng-template",0)},dependencies:[by],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2})}return e})(),Cy=class{overlayRef;config;componentInstance;componentRef;containerInstance;disableClose;closed=new $e;backdropClick;keydownEvents;outsidePointerEvents;id;_detachSubscription;constructor(t,i){this.overlayRef=t,this.config=i,this.disableClose=i.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=i.id,this.keydownEvents.subscribe(r=>{r.keyCode===27&&!this.disableClose&&!Ld(r)&&(r.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=t.detachments().subscribe(()=>{i.closeOnOverlayDetachments!==!1&&this.close()})}close(t,i){if(this.containerInstance){let r=this.closed;this.containerInstance._closeInteractionType=i?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),r.next(t),r.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",i=""){return this.overlayRef.updateSize({width:t,height:i}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}},UZ=new He("DialogScrollStrategy",{providedIn:"root",factory:()=>{let e=M(xy);return()=>e.scrollStrategies.block()}}),HZ=new He("DialogData"),jZ=new He("DefaultDialogConfig");var jH=(()=>{class e{_overlay=M(xy);_injector=M(wi);_defaultOptions=M(jZ,{optional:!0});_parentDialog=M(e,{optional:!0,skipSelf:!0});_overlayContainer=M(cx);_idGenerator=M(vl);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new $e;_afterOpenedAtThisLevel=new $e;_ariaHiddenElements=new Map;_scrollStrategy=M(UZ);get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}afterAllClosed=zg(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(dn(void 0)));constructor(){}open(i,r){let s=this._defaultOptions||new ef;r=I(I({},s),r),r.id=r.id||this._idGenerator.getId("cdk-dialog-"),r.id&&this.getDialogById(r.id);let n=this._getOverlayConfig(r),o=this._overlay.create(n),a=new Cy(o,r),l=this._attachContainer(o,a,r);return a.containerInstance=l,this._attachDialogContent(i,a,l,r),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(a),a.closed.subscribe(()=>this._removeOpenDialog(a,!0)),this.afterOpened.next(a),a}closeAll(){MA(this.openDialogs,i=>i.close())}getDialogById(i){return this.openDialogs.find(r=>r.id===i)}ngOnDestroy(){MA(this._openDialogsAtThisLevel,i=>{i.config.closeOnDestroy===!1&&this._removeOpenDialog(i,!1)}),MA(this._openDialogsAtThisLevel,i=>i.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(i){let r=new wy({positionStrategy:i.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:i.scrollStrategy||this._scrollStrategy(),panelClass:i.panelClass,hasBackdrop:i.hasBackdrop,direction:i.direction,minWidth:i.minWidth,minHeight:i.minHeight,maxWidth:i.maxWidth,maxHeight:i.maxHeight,width:i.width,height:i.height,disposeOnNavigation:i.closeOnNavigation});return i.backdropClass&&(r.backdropClass=i.backdropClass),r}_attachContainer(i,r,s){let n=s.injector||s.viewContainerRef?.injector,o=[{provide:ef,useValue:s},{provide:Cy,useValue:r},{provide:Jp,useValue:i}],a;s.container?typeof s.container=="function"?a=s.container:(a=s.container.type,o.push(...s.container.providers(s))):a=EA;let l=new Kp(a,s.viewContainerRef,wi.create({parent:n||this._injector,providers:o}));return i.attach(l).instance}_attachDialogContent(i,r,s,n){if(i instanceof qg){let o=this._createInjector(n,r,s,void 0),a={$implicit:n.data,dialogRef:r};n.templateContext&&(a=I(I({},a),typeof n.templateContext=="function"?n.templateContext():n.templateContext)),s.attachTemplatePortal(new Yp(i,null,a,o))}else{let o=this._createInjector(n,r,s,this._injector),a=s.attachComponentPortal(new Kp(i,n.viewContainerRef,o));r.componentRef=a,r.componentInstance=a.instance}}_createInjector(i,r,s,n){let o=i.injector||i.viewContainerRef?.injector,a=[{provide:HZ,useValue:i.data},{provide:Cy,useValue:r}];return i.providers&&(typeof i.providers=="function"?a.push(...i.providers(r,i,s)):a.push(...i.providers)),i.direction&&(!o||!o.get(Jn,null,{optional:!0}))&&a.push({provide:Jn,useValue:{value:i.direction,change:Ue()}}),wi.create({parent:o||n,providers:a})}_removeOpenDialog(i,r){let s=this.openDialogs.indexOf(i);s>-1&&(this.openDialogs.splice(s,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((n,o)=>{n?o.setAttribute("aria-hidden",n):o.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),r&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let i=this._overlayContainer.getContainerElement();if(i.parentElement){let r=i.parentElement.children;for(let s=r.length-1;s>-1;s--){let n=r[s];n!==i&&n.nodeName!=="SCRIPT"&&n.nodeName!=="STYLE"&&!n.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(n,n.getAttribute("aria-hidden")),n.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let i=this._parentDialog;return i?i._getAfterAllClosed():this._afterAllClosedAtThisLevel}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function MA(e,t){let i=e.length;for(;i--;)t(e[i])}function GZ(e,t){}var qZ={bottomSheetState:Lk("state",[bM("void, hidden",vM({transform:"translateY(100%)"})),bM("visible",vM({transform:"translateY(0%)"})),wM("visible => void, visible => hidden",yM([_M(`${oA.COMPLEX} ${nA.ACCELERATION_CURVE}`),CM("@*",xM(),{optional:!0})])),wM("void => visible",yM([_M(`${oA.EXITING} ${nA.DECELERATION_CURVE}`),CM("@*",xM(),{optional:!0})]))])},WZ=(()=>{class e extends EA{_breakpointSubscription;_animationState="void";_animationStateChanged=new yi;_destroyed;constructor(){super();let i=M(qw);this._breakpointSubscription=i.observe([Tu.Medium,Tu.Large,Tu.XLarge]).subscribe(()=>{let r=this._elementRef.nativeElement.classList;r.toggle("mat-bottom-sheet-container-medium",i.isMatched(Tu.Medium)),r.toggle("mat-bottom-sheet-container-large",i.isMatched(Tu.Large)),r.toggle("mat-bottom-sheet-container-xlarge",i.isMatched(Tu.XLarge))})}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges())}exit(){this._destroyed||(this._animationState="hidden",this._changeDetectorRef.markForCheck())}ngOnDestroy(){super.ngOnDestroy(),this._breakpointSubscription.unsubscribe(),this._destroyed=!0}_onAnimationDone(i){i.toState==="visible"&&this._trapFocus(),this._animationStateChanged.emit(i)}_onAnimationStart(i){this._animationStateChanged.emit(i)}_captureInitialFocus(){}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=it({type:e,selectors:[["mat-bottom-sheet-container"]],hostAttrs:["tabindex","-1",1,"mat-bottom-sheet-container"],hostVars:4,hostBindings:function(r,s){r&1&&bk("@state.start",function(o){return s._onAnimationStart(o)})("@state.done",function(o){return s._onAnimationDone(o)}),r&2&&(vk("@state",s._animationState),Ri("role",s._config.role)("aria-modal",s._config.ariaModal)("aria-label",s._config.ariaLabel))},features:[Kr],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(r,s){r&1&&tr(0,GZ,0,0,"ng-template",0)},dependencies:[by],styles:[".mat-bottom-sheet-container{box-shadow:0px 8px 10px -5px rgba(0, 0, 0, 0.2), 0px 16px 24px 2px rgba(0, 0, 0, 0.14), 0px 6px 30px 5px rgba(0, 0, 0, 0.12);padding:8px 16px;min-width:100vw;box-sizing:border-box;display:block;outline:0;max-height:80vh;overflow:auto;background:var(--mat-bottom-sheet-container-background-color, var(--mat-sys-surface-container-low));color:var(--mat-bottom-sheet-container-text-color, var(--mat-sys-on-surface));font-family:var(--mat-bottom-sheet-container-text-font, var(--mat-sys-body-large-font));font-size:var(--mat-bottom-sheet-container-text-size, var(--mat-sys-body-large-size));line-height:var(--mat-bottom-sheet-container-text-line-height, var(--mat-sys-body-large-line-height));font-weight:var(--mat-bottom-sheet-container-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mat-bottom-sheet-container-text-tracking, var(--mat-sys-body-large-tracking))}@media(forced-colors: active){.mat-bottom-sheet-container{outline:1px solid}}.mat-bottom-sheet-container-xlarge,.mat-bottom-sheet-container-large,.mat-bottom-sheet-container-medium{border-top-left-radius:var(--mat-bottom-sheet-container-shape, 28px);border-top-right-radius:var(--mat-bottom-sheet-container-shape, 28px)}.mat-bottom-sheet-container-medium{min-width:384px;max-width:calc(100vw - 128px)}.mat-bottom-sheet-container-large{min-width:512px;max-width:calc(100vw - 256px)}.mat-bottom-sheet-container-xlarge{min-width:576px;max-width:calc(100vw - 384px)}"],encapsulation:2,data:{animation:[qZ.bottomSheetState]}})}return e})(),$Z=new He("MatBottomSheetData"),RA=class{viewContainerRef;panelClass;direction;data=null;hasBackdrop=!0;backdropClass;disableClose=!1;ariaLabel=null;ariaModal=!1;closeOnNavigation=!0;autoFocus="dialog";restoreFocus=!0;scrollStrategy;height="";minHeight;maxHeight},dx=class{_ref;get instance(){return this._ref.componentInstance}get componentRef(){return this._ref.componentRef}containerInstance;disableClose;_afterOpened=new $e;_result;_closeFallbackTimeout;constructor(t,i,r){this._ref=t,this.containerInstance=r,this.disableClose=i.disableClose,r._animationStateChanged.pipe(zi(s=>s.phaseName==="done"&&s.toState==="visible"),Es(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),r._animationStateChanged.pipe(zi(s=>s.phaseName==="done"&&s.toState==="hidden"),Es(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._ref.close(this._result)}),t.overlayRef.detachments().subscribe(()=>{this._ref.close(this._result)}),sa(this.backdropClick(),this.keydownEvents().pipe(zi(s=>s.keyCode===27))).subscribe(s=>{!this.disableClose&&(s.type!=="keydown"||!Ld(s))&&(s.preventDefault(),this.dismiss())})}dismiss(t){this.containerInstance&&(this.containerInstance._animationStateChanged.pipe(zi(i=>i.phaseName==="start"),Es(1)).subscribe(i=>{this._closeFallbackTimeout=setTimeout(()=>{this._ref.close(this._result)},i.totalTime+100),this._ref.overlayRef.detachBackdrop()}),this._result=t,this.containerInstance.exit(),this.containerInstance=null)}afterDismissed(){return this._ref.closed}afterOpened(){return this._afterOpened}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}},ZZ=new He("mat-bottom-sheet-default-options"),GH=(()=>{class e{_overlay=M(xy);_parentBottomSheet=M(e,{optional:!0,skipSelf:!0});_defaultOptions=M(ZZ,{optional:!0});_bottomSheetRefAtThisLevel=null;_dialog=M(jH);get _openedBottomSheetRef(){let i=this._parentBottomSheet;return i?i._openedBottomSheetRef:this._bottomSheetRefAtThisLevel}set _openedBottomSheetRef(i){this._parentBottomSheet?this._parentBottomSheet._openedBottomSheetRef=i:this._bottomSheetRefAtThisLevel=i}constructor(){}open(i,r){let s=I(I({},this._defaultOptions||new RA),r),n;return this._dialog.open(i,se(I({},s),{disableClose:!0,closeOnOverlayDetachments:!1,maxWidth:"100%",container:WZ,scrollStrategy:s.scrollStrategy||this._overlay.scrollStrategies.block(),positionStrategy:this._overlay.position().global().centerHorizontally().bottom("0"),templateContext:()=>({bottomSheetRef:n}),providers:(o,a,l)=>(n=new dx(o,s,l),[{provide:dx,useValue:n},{provide:$Z,useValue:s.data}])})),n.afterDismissed().subscribe(()=>{this._openedBottomSheetRef===n&&(this._openedBottomSheetRef=null)}),this._openedBottomSheetRef?(this._openedBottomSheetRef.afterDismissed().subscribe(()=>n.containerInstance?.enter()),this._openedBottomSheetRef.dismiss()):n.containerInstance.enter(),this._openedBottomSheetRef=n,n}dismiss(i){this._openedBottomSheetRef&&this._openedBottomSheetRef.dismiss(i)}ngOnDestroy(){this._bottomSheetRefAtThisLevel&&this._bottomSheetRefAtThisLevel.dismiss()}static \u0275fac=function(r){return new(r||e)};static \u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var hx=(()=>{class e{getValueFromStorage(i){return localStorage.getItem(i)}setValueInStorage(i,r){localStorage.setItem(i,r)}removeItemFromStorage(i){localStorage.removeItem(i)}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Vd=(()=>{class e{constructor(i,r){this.bottomSheet=i,this.localStorageService=r,this.defaultBasemap=this.getDefaultBasemapId(),this.selectedBasemapSrc=new Pr(Ro.fromId(this.defaultBasemap)),this.selectedBasemapObs=this.selectedBasemapSrc.asObservable()}openBasemapBottomSheet(){this.bottomSheet.open(PH)}closeActiveBottomSheet(){this.bottomSheet.dismiss()}setSelectedBasemap(i){this.localStorageService.setValueInStorage(vc.BASE_MAP,i.id),this.selectedBasemapSrc.next(i)}getSelectedBasemap(){return this.selectedBasemapSrc.getValue()}getDefaultBasemapId(){return this.localStorageService.getValueFromStorage(vc.BASE_MAP)?this.localStorageService.getValueFromStorage(vc.BASE_MAP):"satellite"}static{this.\u0275fac=function(r){return new(r||e)(jt(GH),jt(hx))}}static{this.\u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var ux=(()=>{class e{constructor(i){this.localStorageService=i,this.activeLayers=this.getSelectedLayers(),this.mapViewSrc=new Pr(Nd.MAP_VIEW),this.mapViewObs=this.mapViewSrc.asObservable(),this.toggleLayerSrc=new Pr(this.activeLayers),this.toggleLayerObs=this.toggleLayerSrc.asObservable()}setMapViewType(i){this.mapViewSrc.next(i)}getMapViewType(){return this.mapViewSrc.getValue()}toggleLayer(i){this.localStorageService.setValueInStorage(vc.ACTIVE_LAYERS,JSON.stringify(i)),this.toggleLayerSrc.next(i)}getSelectedLayers(){return this.localStorageService.getValueFromStorage(vc.ACTIVE_LAYERS)?JSON.parse(this.localStorageService.getValueFromStorage(vc.ACTIVE_LAYERS)):[Ra.RESERVOIRS,Ra.CANALS,Ra.PUMPING_STATIONS]}static{this.\u0275fac=function(r){return new(r||e)(jt(hx))}}static{this.\u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var $H=(()=>{class e{constructor(i,r){this.bottomSheetService=i,this.sideNavContentService=r,this.VIEW_TYPE=Nd,this.LAYER_TYPE=Ra,this.viewTypeToggle=this.sideNavContentService.getMapViewType(),this.activeLayers=this.sideNavContentService.getSelectedLayers()}toggleBottomSheet(){this.bottomSheetService.openBasemapBottomSheet()}toggleViewType(i){this.sideNavContentService.setMapViewType(i)}toggleLayer(i){this.sideNavContentService.toggleLayer(i)}static{this.\u0275fac=function(r){return new(r||e)(Us(Vd),Us(ux))}}static{this.\u0275cmp=it({type:e,selectors:[["app-drawer-content"]],decls:26,vars:9,consts:[[1,"flex","m-2"],[1,"text-lg","font-bold","text-bgs-primary-earth"],[1,"flex","justify-center","m-2"],["name","fontStyle","aria-label","Font Style",3,"valueChange","change","value"],[3,"value"],["multiple","true",1,"mat-mdc-chip-set-stacked",3,"change"],[3,"value","selected"],["mat-raised-button","",3,"click"]],template:function(r,s){r&1&&(De(0,"div",0)(1,"p",1),or(2,"View Type:"),Ze()(),De(3,"div",2)(4,"mat-button-toggle-group",3),Sk("valueChange",function(o){return Ck(s.viewTypeToggle,o)||(s.viewTypeToggle=o),o}),qi("change",function(o){return s.toggleViewType(o.value)}),De(5,"mat-button-toggle",4),or(6,"Map View"),Ze(),De(7,"mat-button-toggle",4),or(8,"Scene View"),Ze()()(),De(9,"div",0)(10,"p",1),or(11,"Layers:"),Ze()(),De(12,"div",2)(13,"mat-chip-listbox",5),qi("change",function(o){return s.toggleLayer(o.value)}),De(14,"mat-chip-option",6),or(15," Reservoirs "),Ze(),De(16,"mat-chip-option",6),or(17," Canals "),Ze(),De(18,"mat-chip-option",6),or(19," Pumping Stations "),Ze()()(),De(20,"div",0)(21,"p",1),or(22,"Select Basemap:"),Ze()(),De(23,"div",2)(24,"button",7),qi("click",function(){return s.toggleBottomSheet()}),or(25," Basemaps "),Ze()()),r&2&&(Ft(4),xk("value",s.viewTypeToggle),Ft(),la("value",s.VIEW_TYPE.MAP_VIEW),Ft(2),la("value",s.VIEW_TYPE.SCENE_VIEW),Ft(7),la("value",s.LAYER_TYPE.RESERVOIRS),la("selected",s.activeLayers.includes(s.LAYER_TYPE.RESERVOIRS)),Ft(2),la("value",s.LAYER_TYPE.CANALS),la("selected",s.activeLayers.includes(s.LAYER_TYPE.CANALS)),Ft(2),la("value",s.LAYER_TYPE.PUMPING_STATIONS),la("selected",s.activeLayers.includes(s.LAYER_TYPE.PUMPING_STATIONS)))},dependencies:[sH,rH,aH,dA,tx,pH,_A,gA],encapsulation:2})}}return e})();var mx=(()=>{class e{constructor(){this.sidenavState=new Pr(!1),this.sidenavStateObservable=this.sidenavState.asObservable()}setSidenav(i){this.sidenav=i}sideNavOpen(){return this.sidenav.opened}open(){return this.sidenavState.next(!0),this.sidenav.open()}close(){return this.sidenavState.next(!1),this.sidenav.close()}toggle(){this.sidenav.toggle(),this.sidenavState.next(this.sidenav.opened)}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function KZ(e,t){e&1&&(De(0,"mat-icon",7),or(1," menu "),Ze())}function YZ(e,t){e&1&&(De(0,"mat-icon",7),or(1," menu_open "),Ze())}var QH=(()=>{class e{constructor(i){this.sidenavService=i}toggleSideNav(){this.sidenavService.toggle()}static{this.\u0275fac=function(r){return new(r||e)(Us(mx))}}static{this.\u0275cmp=it({type:e,selectors:[["app-header"]],decls:12,vars:6,consts:[[1,"relative","top-0","left-0","flex","items-center","justify-around","w-full","h-20","px-16","bg-jurrasic"],["mat-icon-button","","aria-label","menu icon",1,"menu-button",3,"click"],["class","text-bgs-primary-stone",4,"ngIf"],[1,"w-40","left"],["src","/assets/images/esri-10GlobeLogo_sRGB_.png","alt","Logo"],[1,"flex","flex-col","items-center","justify-center","w-3/4","text-center","center"],[1,"!m-0","font-aileron-semibold","text-white","lg:text-1xl","md:text-xl"],[1,"text-bgs-primary-stone"]],template:function(r,s){r&1&&(De(0,"nav",0)(1,"div")(2,"button",1),qi("click",function(){return s.toggleSideNav()}),tr(3,KZ,2,0,"mat-icon",2),hM(4,"async"),tr(5,YZ,2,0,"mat-icon",2),hM(6,"async"),Ze()(),De(7,"div",3),pi(8,"img",4),Ze(),De(9,"div",5)(10,"p",6),or(11,"ArcGIS API for JavaScript Example"),Ze()()()),r&2&&(Ft(3),Mr("ngIf",uM(4,2,s.sidenavService.sidenavStateObservable)===!1),Ft(2),Mr("ngIf",uM(6,4,s.sidenavService.sidenavStateObservable)===!0))},dependencies:[nx,sx,$h,Pm,Dk],encapsulation:2})}}return e})();var AA,Sy=AA=class extends Wi{constructor(e){super(e),this.type="none"}clone(){return new AA({type:this.type})}};c([$b({none:"none",stayAbove:"stay-above"})],Sy.prototype,"type",void 0),Sy=AA=c([w("esri.ground.NavigationConstraint")],Sy);var IA,bc=IA=class extends iL(o_){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new qe;let t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&V.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(e=>{xs(e)||V.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){let e=this.layers.removeAll();for(let t of e)z(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=I({},e)).resourceInfo),e}set layers(e){this._set("layers",Lb(e,this._get("layers")))}writeLayers(e,t,i,r){let s=[];e&&(r=se(I({},r),{layerContainerType:"ground"}),e.forEach(n=>{if("write"in n){let o={};Y2(n)().write(o,r)&&s.push(o)}else r?.messages&&r.messages.push(new le("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return fL(this,e=>{e(this.layers)})}queryElevation(e,t){return P(this,null,function*(){yield this.load({signal:t?.signal});let{ElevationQuery:i}=yield import("./chunk-RHOVWFOE.js");Ut(t);let r=new i,s=this.layers.filter(KH).toArray();return r.queryAll(s,e,t)})}createElevationSampler(e,t){return P(this,null,function*(){yield this.load({signal:t?.signal});let{ElevationQuery:i}=yield import("./chunk-RHOVWFOE.js");Ut(t);let r=new i,s=this.layers.filter(KH).toArray();return r.createSamplerAll(s,e,t)})}clone(){let e={opacity:this.opacity,surfaceColor:Xr(this.surfaceColor),navigationConstraint:Xr(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new IA({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){let t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}_loadLayersFromJSON(e,t,i){return P(this,null,function*(){let r=t?.origin||"web-scene",s=t?.portal||null,n=t?.url||null,{populateOperationalLayers:o}=yield import("./chunk-SJVG5A75.js");Ut(i);let a=[];if(e.layers&&Array.isArray(e.layers)){let l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}yield Promise.allSettled(a)})}};function XZ(e){return e&&"createElevationSampler"in e}function KH(e){return e.type==="elevation"||XZ(e)}c([h({json:{read:!1}})],bc.prototype,"layers",null),c([Nm("layers")],bc.prototype,"writeLayers",null),c([h({readOnly:!0})],bc.prototype,"resourceInfo",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:RM,read:{reader:mF,source:"transparency"},write:{writer:(e,t)=>{t.transparency=uF(e)},target:"transparency"}}})],bc.prototype,"opacity",void 0),c([h({type:Ar,json:{type:[RM],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],bc.prototype,"surfaceColor",void 0),c([h({type:Sy,json:{write:!0}})],bc.prototype,"navigationConstraint",void 0),bc=IA=c([w("esri.Ground")],bc);var tf=bc;var px=new WeakMap;function DA(e){return!e.destroyed&&(px.has(e)||e.addHandles([T(()=>{let t=e.parent;return!(!t||!("type"in t))&&(t.type==="catalog-dynamic-group"||DA(t))},t=>px.set(e,t),Ce),kr(()=>px.delete(e))]),px.get(e))}function JZ(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function YH(e){return!(!JZ(e)||!BL(e)?.operations?.supportsEditing||"editingEnabled"in e&&!zL(e)||DA(e))}var XH={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function JH(e){let t=null;if(typeof e=="string")if(e in XH){let i=XH[e];t=new tf({resourceInfo:{data:{layers:[i]}}})}else V.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=Qa(tf,e);return t}var Aa=class extends IN(AN(ti.EventedMixin(k))){constructor(e){super(e),this.allLayers=new dc({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=RN(this),this.basemap=null,this.editableLayers=new dc({getCollections:()=>[this.allLayers],itemFilterFunction:YH}),this.ground=new tf,this._basemapCache=x2()}destroy(){C2(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=z(this.basemap),z(this.ground),this._set("ground",null)}castBasemap(e){return S2(e,this._basemapCache)}castGround(e){return JH(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};c([h({readOnly:!0,dependsOn:[]})],Aa.prototype,"allLayers",void 0),c([h({readOnly:!0})],Aa.prototype,"allTables",void 0),c([h({type:Ro,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Aa.prototype,"basemap",void 0),c([Lr("basemap")],Aa.prototype,"castBasemap",null),c([h({readOnly:!0})],Aa.prototype,"editableLayers",void 0),c([h({type:tf,nonNullable:!0})],Aa.prototype,"ground",void 0),c([Lr("ground")],Aa.prototype,"castGround",null),c([h()],Aa.prototype,"undoRedo",void 0),Aa=c([w("esri.Map")],Aa);var fx=Aa;var gx={widthBreakpoint:{getValue(e){let t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){let t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){let t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},PA={xsmall:544,small:768,medium:992,large:1200};function eQ(e){let t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function OA(e,t){return t?gx[e].valueToClassName[t].split(" "):[]}var _x=e=>{let t=class extends e{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=PA}initialize(){this.addHandles(T(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),ie))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!eQ(i)){let r=JSON.stringify(PA,null,2);console.warn("provided breakpoints are not valid, using defaults:"+r),i=PA}this._set("breakpoints",I({},i))}}_updateClassNames(){if(!this.container)return;let i=Yg.acquire(),r=Yg.acquire(),s,n=!1;for(s in gx){let o=this[s],a=gx[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,OA(s,o).forEach(l=>r.push(l)),OA(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),Yg.release(i),Yg.release(r))}_applyClassNameChanges(i,r){let s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){let i=this.container;if(!i)return;let r;for(r in gx)OA(r,this[r]).forEach(s=>i.classList.remove(s))}};return c([h()],t.prototype,"breakpoints",null),c([h()],t.prototype,"orientation",void 0),c([h()],t.prototype,"widthBreakpoint",void 0),c([h()],t.prototype,"heightBreakpoint",void 0),t=c([w("esri.views.BreakpointsOwner")],t),t};var Bd=class extends k{constructor(){super(...arguments),this.items=new qe,this._watchUpdatingTracking=new il,this._callbacks=new Map,this._projector=n_(),this._hiddenProjector=n_()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){let e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(let i of t.added){let r=()=>i.render();this._callbacks.set(i,r),this._projector.append(this.surface,r)}for(let i of t.removed){let r=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(r.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){let t=this._hiddenSurface,i=this._hiddenProjector,r,s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();let n={left:0,top:0,right:0,bottom:0};if(r?.domNode){let o=r.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){let i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}prepare(){return P(this,null,function*(){yield document.fonts.load(this._fontString()).catch(()=>{})})}renderCanvas(e,t){let i=!!t?.disableDecorations;if(!this.items.some(s=>s.visible&&!(i&&s.isDecoration)))return;let r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(s=>{i&&s.isDecoration||(r.save(),s.renderCanvas(r),r.restore())}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};c([h({readOnly:!0})],Bd.prototype,"surface",void 0),c([h({readOnly:!0})],Bd.prototype,"items",void 0),c([h({readOnly:!0})],Bd.prototype,"needsRender",null),c([h({readOnly:!0})],Bd.prototype,"_watchUpdatingTracking",void 0),c([h({readOnly:!0})],Bd.prototype,"updating",null),Bd=c([w("esri.views.overlay.ViewOverlay")],Bd);var kA=Bd;var LA=[0,0];function tQ(e){let t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return LA[0]=i.left+(t?.pageXOffset??0),LA[1]=i.top+(t?.pageYOffset??0),LA}function e5(e){e&&(e.textContent="",e.parentNode&&e.parentNode.removeChild(e))}function iQ(e){let t=document.createElement("div");return e.appendChild(t),t}var Ty=16,yx=750,rQ=512,sQ=2,vx=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:Ty,time:yx},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([T(()=>this.cursor,r=>{let{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),T(()=>this.navigating,r=>{let{surface:s}=this;s&&s.setAttribute("data-navigating",r.toString())})])}initialize(){this.addHandles([T(()=>this.ui,(i,r)=>this._handleUIChange(i,r),ie),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=z(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){let r=this._get("container"),s=Lm(i);if(s||typeof i!="string"||V.getLogger(this).error("#container",`element with id '${i}' not found`),r===s)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(e5(this.root),this._set("root",null)),this.userContent&&(DM(this.userContent,r),e5(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");let n=document.createElement("div");n.className="esri-view-user-storage",DM(s,n),s.appendChild(n),this._set("userContent",n);let o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);let a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);let l=new kA;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(T(()=>l.needsRender,d=>{d&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=As({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=Nt(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){let i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(i,r,s){let n=this.position;return i-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){let n=this.position;return i+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(T(()=>this.root,s=>{i.container=s?iQ(s):null},ie),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){let i=this._freqInfo;i.freq=Ty,i.time=yx,this.addHandles([Sb(window,"resize",()=>{i.freq=Ty,i.time=yx}),As({prepare:r=>{let s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=Ty,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;let o=this._position();n.freq=o||s?Ty:Math.min(yx,n.freq*sQ),!s&&n.freq>=rQ&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){let i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;let n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){let i=this.container,r=this.position,s=i&&tQ(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return c([h()],t.prototype,"container",null),c([h({readOnly:!0})],t.prototype,"focused",null),c([h({readOnly:!0})],t.prototype,"height",void 0),c([h()],t.prototype,"messagesCommon",void 0),c([h({type:kA})],t.prototype,"overlay",void 0),c([h({readOnly:!0})],t.prototype,"position",void 0),c([h({readOnly:!0})],t.prototype,"resizing",void 0),c([h({readOnly:!0})],t.prototype,"root",void 0),c([h({value:null,readOnly:!0})],t.prototype,"size",null),c([h({readOnly:!0})],t.prototype,"surface",void 0),c([h({readOnly:!0})],t.prototype,"suspended",void 0),c([h()],t.prototype,"ui",void 0),c([h({readOnly:!0})],t.prototype,"userContent",void 0),c([h({readOnly:!0})],t.prototype,"width",void 0),c([h()],t.prototype,"widthBreakpoint",void 0),t=c([w("esri.views.DOMContainer")],t),t};function zd(e){return e!=null&&"open"in e&&"declaredClass"in e}function t5(e){return e!=null&&"declaredClass"in e&&"dockOptions"in e}var bx=e=>{let t=class extends e{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([T(()=>[this.ui,this.popup],([i,r],s)=>{let n="popup",o="manual";if(s){let[a,l]=s;a&&zd(l)&&(l.view=null,t5(l)&&a.remove(l,n))}i&&zd(r)&&(r.view=this,t5(r)&&i.add(r,{key:n,position:o,internal:!0}))},ie),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(zd(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(()=>P(this,null,function*(){yield this.setupPopup(),zd(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)})))},ul.WIDGET)]),Gs(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{import("./chunk-Z2T6BLSE.js")})}destroy(){this.destroyed||this.closePopup()}openPopup(i){return P(this,null,function*(){if(zd(this.popup))return this.popup.open(i);try{if(yield this.setupPopup(),!this.popup)return void V.getLogger(this).error(new le("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}})}closePopup(){this._popupSetupTask?.abort(),zd(this.popup)&&this.popup.close()}fetchPopupFeatures(i,r){return P(this,null,function*(){return yield this.when(),this._popupHitsToFeatures(yield this._getPopupHits(i,r),r)})}setupPopup(){return P(this,null,function*(){if(this._popupSetupTask?.abort(),this.popup&&!zd(this.popup))return this._popupSetupTask=js(i=>P(this,null,function*(){let{default:r}=yield import("./chunk-Z2T6BLSE.js");if(Ut(i),!this.popup||zd(this.popup))return;let s=this.popup;delete s.open,delete s.close,this.popup=new r(s)})),this._popupSetupTask.promise})}_popupHitsToFeatures(n,o){return P(this,arguments,function*({location:i,hits:r},s){let a=[],l=[],d=!1,u=Wk(s,Qe("popup-view-fetch-timeout")??nQ),m=g=>{let _=new FA(g);return l.push(_),a.push(_.promise),_},p=g=>{let _=l.at(-1);return _&&_.layerView===g&&!d?_:m(g)};for(let g of r)"graphic"in g?(p(g.layerView).graphics.push(g.graphic),d=!1):(a.push(g.layerView.fetchPopupFeaturesAtLocation(g.mapPoint,u)),d=!0);l.map(g=>g.resolve(u));let f=qk(a).then(g=>g.filter(_=>!!_).flat());return{pendingFeatures:a,allGraphicsPromise:f,location:i}})}_getPopupHits(i,r){return P(this,null,function*(){let{hits:s,location:n}=yield this.popupHitTest(i);Ut(r);let o=[];for(let a of s)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,r)){let l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:n}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return c([h()],t.prototype,"popup",void 0),c([h()],t.prototype,"popupEnabled",void 0),t=c([w("esri.views.PopupView")],t),t},FA=class{constructor(t){this.layerView=t,this._resolver=Hn(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(t){let{layerView:i,graphics:r,_resolver:s}=this;if(!i)return s.resolve(r),s.promise;let n;return i.fetchPopupFeaturesFromGraphics(r,t).catch(o=>(n=o,null)).then(o=>{o?s.resolve(o):s.reject(n)}),s.promise}},nQ=5e3;var Ud=class extends kN{constructor(e){super(e),this.addHandles(this.on("before-add",t=>{t.item!=null&&t.item.parent===this.owner&&(V.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};Ud=c([w("esri.support.AnalysesCollection")],Ud);var Hd=class extends k{constructor(e){super(e),this.view=null,this.baseLayerViews=new qe,this.referenceLayerViews=new qe,this._loadingHandle=T(()=>this.view?.map?.basemap,t=>{t&&t.load().catch(()=>{})},ie)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(let e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(let e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view?.suspended)return!1;let e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(t=>t.updating)||this.referenceLayerViews.some(t=>t.updating))}};c([h({constructOnly:!0})],Hd.prototype,"view",void 0),c([h({readOnly:!0})],Hd.prototype,"baseLayerViews",void 0),c([h({readOnly:!0})],Hd.prototype,"referenceLayerViews",void 0),c([h({readOnly:!0})],Hd.prototype,"suspended",null),c([h({type:Boolean,readOnly:!0})],Hd.prototype,"updating",null),Hd=c([w("esri.views.BasemapView")],Hd);var i5=Hd;function oQ(e){return"tryRecycleWith"in e}function aQ(e){return e!=null&&typeof e=="object"&&"layerViews"in e}var NA=class{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=Hn(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,$a(this._controller.signal,()=>{let s=new le("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}tryRecycle(t){if(!this.done||!this.layerView||!oQ(this.layerView))return null;let i=this.layer.type,r=this._controller.signal;for(let s=0;s<t.length;s++){let n=t[s];if(n.type!==i)continue;let o=this.layerView.tryRecycleWith(n,{signal:r});if(o){t.splice(s,1),this.layer=n;let a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Ut(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((d,u)=>$a(this._controller.signal,()=>u(cs())))]),this.promise}}return null}destroy(){this._controller.abort();let{layerView:t}=this;if(t){let{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}start(){return P(this,null,function*(){if(this._started)return;this._started=!0;let{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{let s,n;if(yield i.load({signal:t}),i.prefetchResources&&(yield i.prefetchResources({signal:t})),lQ(i))s=yield i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new le("layer:view-not-supported","No layerview implementation was found");let l=yield this.layerViewImporter.importLayerView(i);Ut(t),s="default"in l?new l.default({layer:i,view:r}):new l({layer:i,view:r})}let o=()=>{n=Nt(n),s.destroyed||s.destroy(),s.layer=null,s.parent=null,s.view=null,this.done=!0};n=$a(t,o),Ut(t);try{yield s.when()}catch(l){throw o(),l}if(!this._map?.allLayers?.includes(i))return o(),void this._deferred.reject(new le("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=s,i.emit("layerview-create",{view:r,layerView:s}),r.emit("layerview-create",{layer:i,layerView:s}),this.done=!0,this._deferred.resolve(s)}catch(s){i.emit("layerview-create-error",{view:r,error:s}),r.emit("layerview-create-error",{layer:i,error:s}),this.done=!0,this._deferred.reject(new le("layerview:create-error","layerview creation failed",{layer:i,error:s}))}})}},Vo=class extends k{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new il,this.supportsGround=!0,this._preloadLayerViewModules=()=>{let t=this.view.map?.allLayers;if(t)for(let i of t)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Hn(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(Ab(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;let t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");let i=new Set,r=[],s=this.view.ready,n=a=>{if(a!=null){for(let l of a)if(l){i.add(l);let d=this._layerLayerViewInfoMap.get(l);d&&s?d.start():d||this._recyclingInfoMap.has(l)||r.push(l),"layers"in l&&l.layers&&n(l.layers)}}};for(let a of this._rootCollectionNames)n(Om(this,a));for(let[a,l]of this._layerLayerViewInfoMap)if(!i.has(a)){this._layerLayerViewInfoMap.delete(l.layer);let d=l.tryRecycle(r);d?(this.notifyChange("updating"),this._recyclingInfoMap.set(l.layer,l),d.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(l.layer),this._layerLayerViewInfoMap.set(l.layer,l),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(l.layer),l.destroy(),this._reschedule()})):l.destroy()}for(let[a,l]of this._recyclingInfoMap)i.has(a)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(l.layer),l.destroy());for(let a of r)this._createLayerView(a);this._refreshCollections();let o=[t?.ground?.layers,t?.basemap?.baseLayers,t?.basemap?.referenceLayers,t?.layers].filter(a=>!!a);i.forEach(a=>"layers"in a&&o.push(a.layers)),this.addHandles(o.map(a=>this._watchUpdatingTracking.addOnCollectionChange(()=>a,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([xi(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),T(()=>{let e=this.view,t=e?.map;return[t?.basemap,t?.ground,t?.layers,e?.ready]},()=>this._reschedule(),Ce)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),O0(this._recyclingInfoMap),O0(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(cs()),this._workPromise=null)}get _layersToLayerViews(){let e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Ib(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(let t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){this.destroyed||(O0(this._layerLayerViewInfoMap),this._refreshCollections())}whenLayerView(e){return P(this,null,function*(){if(yield this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new le("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise})}isCreatingLayerViewsForLayer(e,t){this.commitProperty("updatingRemaining");let i=this._layerLayerViewInfoMap.get(e);if(!i?.done)return!0;let r=i.layerView;return!(!r||!t||r.parent===t)||!!(i.done&&r&&"layers"in e&&e.layers?.length)&&e.layers.some(s=>this.isCreatingLayerViewsForLayer(s,r))}_refreshCollections(){for(let[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(Om(this,e),Om(this,t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(let s of e){let n=this._layerLayerViewInfoMap.get(s);if(!n?.layerView)continue;let o=n.layerView;o.layer=s,o.parent=i,t.at(r)!==o&&t.splice(r,0,o),"layers"in s&&aQ(o)&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);let t=new NA(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{i&&(xs(i)||i.name==="cancelled:layerview-create")||V.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};c([h()],Vo.prototype,"_workPromise",void 0),c([h({readOnly:!0})],Vo.prototype,"_watchUpdatingTracking",void 0),c([h({readOnly:!0})],Vo.prototype,"_layersToLayerViews",null),c([h({readOnly:!0})],Vo.prototype,"_rootCollectionNames",null),c([h()],Vo.prototype,"layerViewImporter",void 0),c([h()],Vo.prototype,"supportsGround",void 0),c([h({readOnly:!0})],Vo.prototype,"updating",null),c([h({readOnly:!0})],Vo.prototype,"updatingRemaining",null),c([h({constructOnly:!0})],Vo.prototype,"view",void 0),Vo=c([w("esri.views.LayerViewManager")],Vo);var r5=Vo;function lQ(e){return"createLayerView"in e&&e.createLayerView!=null}var eo=class extends k{constructor(e){super(e),this.factor=1.5,this.offset=vr(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};c([h({type:Number})],eo.prototype,"factor",void 0),c([h({nonNullable:!0})],eo.prototype,"offset",void 0),c([h()],eo.prototype,"position",void 0),c([h({type:Number,range:{min:0}})],eo.prototype,"size",void 0),c([h()],eo.prototype,"maskUrl",void 0),c([h()],eo.prototype,"maskEnabled",void 0),c([h()],eo.prototype,"overlayUrl",void 0),c([h()],eo.prototype,"overlayEnabled",void 0),c([h({readOnly:!0})],eo.prototype,"version",null),c([h({type:Boolean})],eo.prototype,"visible",void 0),eo=c([w("esri.views.Magnifier")],eo);var VA=eo;function My(e){return!!(e!=null&&typeof e=="object"&&"createQuery"in e&&e.createQuery&&"on"in e&&e.on)}var wc=class extends ti.EventedAccessor{constructor(e){super(e),this._selectionMap=new eF,this._sources=new qe,this._trashCan=[],this._layerEditHandles=new qe,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([T(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),xi(()=>this.sources,"change",t=>{let i=this._selectionMap;for(let r of t.removed)i.delete(r);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);let e=new qe;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(t=>"sublayers"in t&&t.sublayers?t.sublayers:null).forEach(t=>{(My(t)&&!NL(t)||rd(t))&&e.add(t)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(Nt)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{let[t,i]=e;return{layer:t,selection:[...i.selection]}})}get count(){let e=0;for(let t of this._selectionMap.values())e+=t.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){Lb(e,this._sources)}getSelectedFeatures(r){return P(this,arguments,function*(e,t={},i="layerView"){let{view:s,selections:n}=this,o=(e!==void 0?n.filter(a=>e.includes(a.layer)):n).filter(a=>a.selection.length>0).map(a=>P(this,null,function*(){let{layer:l,selection:d}=a,u=rd(l)?l.parent:l;if(u==null||!n5(u))return null;if(i==="layer")return o5(u,d,t);if(s5(u))return null;let m=yield s.whenLayerView(u).catch(()=>null);return m?o5(m,d,t):null}));return(yield Promise.all(o)).filter(a=>a!=null)})}updateSelection(e){let t=new Map;for(let[s,n]of this._selectionMap)t.set(s,[...n.selection]);let i=!1,r=e.current.concat(e.added);for(let s of r){let n=s.sourceLayer,o=s.getObjectId();if(this.sources.includes(n)&&(My(n)||rd(n))&&o!==null){let a=eL(t,n,()=>[]);a.includes(o)||(a.push(o),i=!0)}}for(let s of e.removed){let n=s.sourceLayer,o=s.getObjectId();if(this.sources.includes(n)&&(My(n)||rd(n))&&o!==null){let a=t.get(n),l=a?.indexOf(o);l!==void 0&&l>=0&&(a?.splice(l,1),i=!0)}}if(i){let{_selectionMap:s,_trashCan:n}=this,o=[];for(let[a,l]of t){let d=s.get(a);d!==void 0&&n.push(d),s.set(a,{selection:l}),o.push(I({layer:a,selection:l},Zg(d!==void 0?d.selection:[],l)))}this._onSelectionChange(o)}}setSelection(e,t){this._setSelection(e,t)}getSelection(e){return this._selectionMap.get(e)?.selection}appendToSelection(e,t){let i=this._selectionMap.get(e),r=i!==void 0?[...i.selection]:[];for(let s of t)r.includes(s)||r.push(s);this._setSelection(e,r)}removeFromSelection(e,t){let i=this._selectionMap.get(e);if(!i)return;let r=[];for(let s of i.selection)t.includes(s)||r.push(s);this._setSelection(e,r)}toggleInSelection(e,t){let i=this._selectionMap.get(e);if(!i||i.selection.length===0)return void this._setSelection(e,t);let r=new Set(i.selection),s=new Set(t),n=Kk(r,s);this._setSelection(e,Array.from(n))}clear(){let e=this._selectionMap.values();this._trashCan.push(...e);let t=[];for(let[i,r]of this._selectionMap.entries())t.push({layer:i,added:[],removed:[...r.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(t)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;)this._trashCan.pop()?.highlightHandle?.remove();let{sources:e,view:t,_selectionMap:i,showHighlight:r}=this,s=this._vizTaskId;for(let n of e){let o=i.get(n),a=rd(n)?n.parent:n;if(a!=null&&n5(a)){if(s5(a))continue;t.whenLayerView(a).then(l=>{o?.highlightHandle?.remove(),o!=null&&r&&s===this._vizTaskId&&"highlight"in l&&typeof l.highlight=="function"&&o.selection.length>0&&(o.highlightHandle=l.highlight(o.selection,"selection"))}).catch(()=>{o?.highlightHandle?.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(Nt);for(let e of this.sources){let t=rd(e)?e.parent:e;if(t!=null&&My(t)){let i=t.on("edits",r=>{this._handleEditChanges(r,e)});this._layerEditHandles.push(i)}}}_handleEditChanges(e,t){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(t)){let i=e.deletedFeatures.filter(r=>r.error==null).map(r=>r.objectId).filter(Rs);this.removeFromSelection(t,i)}}_setSelection(e,t){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);let i=this._selectionMap.get(e);if(i===void 0||!dQ(i,{selection:t})){i!==void 0&&this._trashCan.push(i),this._selectionMap.set(e,{selection:[...t]});let r=I({layer:e,selection:[...t]},Zg(i!==void 0?i.selection:[],t));this._onSelectionChange([r])}}};c([h({readOnly:!0,nonNullable:!0})],wc.prototype,"selections",null),c([h({readOnly:!0,nonNullable:!0})],wc.prototype,"count",null),c([h({constructOnly:!0,nonNullable:!0})],wc.prototype,"view",void 0),c([h({readOnly:!0,nonNullable:!0})],wc.prototype,"hasSelection",null),c([h()],wc.prototype,"showHighlight",void 0),c([h()],wc.prototype,"sources",null),wc=c([w("esri.views.SelectionManager")],wc);var s5=e=>rd(e)?e.parent?.isTable===!0:e.isTable,cQ=e=>e.layer!==void 0,n5=e=>e?.when!==void 0,dQ=(e,t)=>{if(e==null&&t==null)return!0;if(e!=null&&t==null||e==null&&t!=null)return!1;if(e!=null&&t!=null&&e.selection!=null&&t.selection!=null){let i=[...e.selection],r=[...t.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1}return!0},o5=(r,s,...n)=>P(void 0,[r,s,...n],function*(e,t,i={}){let o;if(cQ(e)){let a=e;o=a===void 0?null:yield a.queryFeatures(new jM(se(I({},i),{objectIds:t}))).then(l=>({data:l,layer:e.layer}))}else{let a=e;o=a===void 0?null:yield a.queryFeatures(new jM(se(I({},i),{objectIds:t}))).then(l=>({data:l,layer:a}))}return o}),a5=wc;var Ey=class extends n2(k){constructor(e){super(e),this.accentColor=new Ar([255,127,0]),this.textColor=new Ar([255,255,255])}};c([h({type:Ar,nonNullable:!0})],Ey.prototype,"accentColor",void 0),c([h({type:Ar,nonNullable:!0})],Ey.prototype,"textColor",void 0),Ey=c([w("esri.views.Theme")],Ey);var wx=Ey;function l5(e){return[e.on("before-add",t=>{let i=t.item;if(i==null||e.includes(i))return V.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{let i=t.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function Ry(e){return e.visible&&e.getEditableFlag!=null&&e.getEditableFlag(A_.USER)&&e.getEditableFlag(A_.MANAGER)}var xx=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._externallyDragging=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(t,i){let r=()=>t.stopPropagation();switch(t.type){case"pointer-move":d5(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0?this._stopDrag=!0:t.action==="start"?this._externallyDragging=!0:t.action==="end"&&(this._externallyDragging=!1),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!h5(t))break;let s=ml(t),n=rf(s,t.pointerType,i.forEachTool);if(n==null)break;let o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(t)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,t,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(t)&&!o.grabbing&&(this._grabbedManipulators.set(t.pointerId,{manipulator:o,tool:a,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(t.pointerId)||this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!h5(t))break;let s=this._grabbedManipulators.get(t.pointerId),n=s?.manipulator,o=s?.tool;if(n==null||o==null)break;let a=ml(t);a.x=U(a.x,0,i.view.width),a.y=U(a.y,0,i.view.height);let l=s.start,d=this._draggedManipulators.get(t.pointerId);switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,d?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,d&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{let s=ml(t),n=rf(s,t.pointerType,i.forEachTool);if(hQ(t)||i.forEachTool(d=>{if((n==null||n.tool!==d||d.automaticManipulatorSelection)&&d.manipulators){let u=!1;d.manipulators.forEach(({manipulator:m})=>{m.selected&&(m.selected=!1,u=!0)}),u&&d.onManipulatorSelectionChanged&&d.onManipulatorSelectionChanged()}}),n==null)break;let{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());let l=t.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:l,stopPropagation:r}),BA(o,r);break}case"click":{let s=ml(t),n=rf(s,t.pointerType,i.forEachTool),o=n?.manipulator;if(o==null||!o.interactive)break;let a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),r();break}case"double-click":{let s=ml(t),n=rf(s,t.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;let a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r}),BA(o,r);break}case"immediate-double-click":{let s=ml(t),n=rf(s,t.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;let a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r}),t.pointerType==="mouse"&&BA(o,r);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:ml(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===t&&this._grabbedManipulators.delete(n)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(t,i){let r=this._grabbedManipulators.get(t.pointerId)?.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:ml(t)}),this._grabbedManipulators.delete(t.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(t){this._updateCursor(),this._updateFocusedManipulatorTools(t)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=c5(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=c5(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){let i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),t(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);let n=this._grabbedManipulators.values(),o=Uk(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(t,{forEachTool:i,setActiveTool:r},s=!0,n){let o=(a,l)=>a===t&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:d},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:d}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},d)=>{o(a,l)&&(this._draggedManipulators.delete(d),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},d)=>{o(a,l)&&(this._hoveredManipulators.delete(d),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(vr(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){let r=t.type;r!=="pointer-up"&&r!=="immediate-click"&&r!=="pointer-move"||!d5(t.pointerType)||(r!=="pointer-up"&&this._externallyDragging?this._clearHoveredManipulatorStates(t.pointerId):this._updateHoveredStateForPointerAtScreenPosition(ml(t),t.pointerId,t.pointerType,i))}_updateHoveredStateForPointerAtScreenPosition(t,i,r,s){let n=rf(t,r,s),o=this._hoveredManipulators.get(i)?.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(t){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(t(null),this._revertToNullActiveTool=!1)}_clearHoveredManipulatorStates(t){this._hoveredManipulators.forEach(({manipulator:i},r)=>{t===r&&(this._hoveredManipulators.delete(t),i.hovering=!1)})}};function c5(e){for(let{manipulator:t}of e.values())if(t!=null&&t.interactive){if(t.grabbing&&t.grabCursor)return t.grabCursor;if(t.cursor)return t.cursor}return null}function rf(e,t,i){let r=null;return i(s=>{if(s.manipulators==null||!Ry(s))return!1;let n=s.manipulators.intersect(e,t);return n!=null&&(r={tool:s,manipulator:n},!0)}),r}function d5(e){return e==="mouse"}function h5(e){return e.pointerType!=="mouse"||e.button===0}function hQ(e){return!!e.native.shiftKey}function BA(e,t){e?.consumesClicks&&t()}var u5="attached",zA="tools",uQ=1e3,Ia=class extends k{constructor(e){super(e),this._updatingHandles=new il,this._clock=Wa,this._manipulatorState=new xx,this.tools=new qe,this.cursor=null,this._interacting=!1,this._interactingTimeout=uQ,this._interactingTimeoutHandle=null,this._forEachTool=t=>{for(let i of this.tools.items)if(t(i))return}}initialize(){this.addHandles([this.view.on(mV,e=>{this._handleInputEvent(e)},ul.TOOL),...l5(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void V.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;let t=this.activeTool;this._set("activeTool",e),t?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(let i of this.tools){this._updateToolEditableFlag(i);let r=Ry(i);this.activeTool!=null&&r||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!r)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=Nt(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([T(()=>{let{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(t=>t.onElevationChange(e)))],u5):this.addHandles(T(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(u5),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1,i=se(I({},e),{stopPropagation:()=>{t=!0,e.stopPropagation()}});this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(r=>{!t&&r.visible&&r.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),t||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(zA),this._forEachTool(e=>{if(e instanceof k){let t=T(()=>[e.cursor,e.visible,e.editable],()=>{Ry(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(t,zA)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],zA)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(A_.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(t=>!(t.cursor==null||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(e==null||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}get test(){}};c([h({constructOnly:!0,nonNullable:!0})],Ia.prototype,"view",void 0),c([h({value:null})],Ia.prototype,"activeTool",null),c([h({readOnly:!0,type:qe})],Ia.prototype,"tools",void 0),c([h({readOnly:!0})],Ia.prototype,"cursor",void 0),c([h({readOnly:!0})],Ia.prototype,"updating",null),c([h()],Ia.prototype,"_interacting",void 0),c([h({readOnly:!0})],Ia.prototype,"interacting",null),Ia=c([w("esri.views.ToolViewManager")],Ia);var sf=class extends k{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":mQ.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){let e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return pQ[this.deviceType]}};c([h({nonNullable:!0,readOnly:!0})],sf.prototype,"nativeIndex",void 0),c([h({type:String,readOnly:!0})],sf.prototype,"deviceType",null),c([h({type:Number,readOnly:!0})],sf.prototype,"axisThreshold",null),sf=c([w("esri.views.input.gamepad.GamepadInputDevice")],sf);var nf=sf,mQ=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),pQ={standard:.15,spacemouse:.025,unknown:0};var Ay=class extends k{constructor(...e){super(...e),this.devices=new qe,this.enabledFocusMode="document"}};c([h({type:qe.ofType(nf),readOnly:!0})],Ay.prototype,"devices",void 0),c([h({type:["document","view","none"]})],Ay.prototype,"enabledFocusMode",void 0),Ay=c([w("esri.views.input.gamepad.GamepadSettings")],Ay);var m5=Ay;var Cx=class extends k{constructor(){super(...arguments),this.gamepad=new m5}};c([h({readOnly:!0})],Cx.prototype,"gamepad",void 0),Cx=c([w("esri.views.input.Input")],Cx);var p5=Cx;var jd=class extends k{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};c([h({type:Boolean,nonNullable:!0})],jd.prototype,"enabled",void 0),c([h({type:nf})],jd.prototype,"device",void 0),c([h({type:["pan","zoom"],nonNullable:!0})],jd.prototype,"mode",void 0),c([h({type:["forward-down","forward-up"],nonNullable:!0})],jd.prototype,"tiltDirection",void 0),c([h({type:Number,nonNullable:!0})],jd.prototype,"velocityFactor",void 0),jd=c([w("esri.views.navigation.gamepad.GamepadSettings")],jd);var UA=jd;var Ru=class extends k{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new UA,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!L0()}};c([h({type:Boolean})],Ru.prototype,"browserTouchPanEnabled",void 0),c([h({type:UA,nonNullable:!0})],Ru.prototype,"gamepad",void 0),c([h({type:Boolean})],Ru.prototype,"momentumEnabled",void 0),c([h({type:Boolean})],Ru.prototype,"mouseWheelZoomEnabled",void 0),Ru=c([w("esri.views.navigation.Navigation")],Ru);var HA=Ru;var GA,jA=null;function fQ(e){return P(this,null,function*(){jA||(jA=import("./chunk-GXMHG4I7.js").then(t=>GA=t)),yield jA,Ut(e)})}function qA(e,t,i,r){return P(this,null,function*(){if(!e)return null;let s=e.spatialReference;return A2()||Kb(s,t)?sc(e,t):GA?GA.projectGeometry(e,t,i,r):(yield Promise.race([fQ(r),D2(r)]),qA(e,t,i,r))})}var Pi=class extends k{constructor(e){super(e),this.required={extent:!1,heightModelInfo:!1,tileInfo:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Er(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){let e=this.map?.(),t=[];return this.priorityCollection!=null&&t.push(this.priorityCollection),t.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),t}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let e;if(this._collectLayers(this.mapCollections,i=>{let r=this._getSupportedSpatialReferences(i);if(r.length>0){let s=this._narrowDownSpatialReferenceCandidates(e,r);s!=null&&(e=s)}return e?.length===1})&&e?.length!==1)return{updating:!0};let t=this._pickSpatialReferenceCandidate(e);return{spatialReference:t?.spatialReference??null,viewingMode:t?.viewingMode??null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};let e=this.map?.(),t=this.spatialReference;if(!t)return{updating:this._spatialReferenceTask.updating};let i,r=this._collectLayers([{parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers}],s=>!(!("tileInfo"in s)||!s.tileInfo?.spatialReference.equals(t))&&(i=s,!0),s=>"tileInfo"in s);return i?{tileInfo:i.tileInfo,updating:!1}:{updating:r}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};let e={},t=this._collectLayers(this.mapCollections,i=>{let r=gV(i);return!!r&&(e={heightModelInfo:r,vcsWkid:i.spatialReference?.vcsWkid,latestVcsWkid:i.spatialReference?.latestVcsWkid},!0)},i=>_V(i));return se(I({},e),{updating:t})}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};let e=[],t=this._collectLayers(this.mapCollections,i=>{let r="fullExtents"in i&&i.fullExtents||(i.fullExtent!=null?[i.fullExtent]:[]),s=this.requiresExtentInSpatialReference?null:r[0],n=r.find(o=>o.spatialReference.equals(this.spatialReference))??s;if(n)return e.push({extent:n,layer:i}),!0;if(this._getSupportedSpatialReferences(i).length>0)for(let o of r)e.push({extent:o,layer:i});return!1});return{candidates:e,updating:t}}get _extentTask(){let{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};let i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Er(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:js(s=>P(this,null,function*(){try{let n=yield qA(i.extent,r,"portalItem"in i.layer?i.layer.portalItem:void 0,s);this._projectExtentTask=se(I({},this._projectExtentTask),{task:null,output:n})}catch{if(Jl(s))return;this._projectExtentTask=se(I({},this._projectExtentTask),{task:null})}}))},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(e==null)return t;let i=new Array;for(let r of e)for(let s of t){if(!r.spatialReference.equals(s.spatialReference))continue;let n=gQ(r.viewingMode,s.viewingMode);if(n!==!1){i.push({spatialReference:r.spatialReference,viewingMode:n});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){let t=this.defaultSpatialReference;return e==null||e.length<1?t?{spatialReference:t,viewingMode:null}:null:(t!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==we.Local)&&(e=e.filter(({viewingMode:i})=>i!==we.Local)),e[0])}_getSupportedSpatialReferences(e){let t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];let i=[];for(let r of t){let s=this.getSpatialReferenceSupport(r,e);if(s!=null){let n=s.constraints??[{spatialReference:r,viewingMode:null}];for(let{spatialReference:o,viewingMode:a}of n)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!o.equals(this.userSpatialReference)||i.push({spatialReference:o,viewingMode:a})}}return i}_pickExtentCandidate(e){let t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e,t,i=()=>!0){if(this._loadMaybe(this.map?.())!=="loaded")return!0;let r=new WA(i,t);for(let s of e)if(this._collectCollection(s,r),r.done||r.preloading===this.sourcePreloadCount)break;return r.updating}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(let i of e.layers)if(t.layerFilter(i)){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":if(t.updating||(t.done=t.pushLayer(i)),t.done||t.preloading===this.sourcePreloadCount)break;"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.done||t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(t=>{xs(t)}),"loading"):e.loadStatus:"loaded"}};c([h()],Pi.prototype,"required",void 0),c([h({constructOnly:!0})],Pi.prototype,"map",void 0),c([h({constructOnly:!0})],Pi.prototype,"getSpatialReferenceSupport",void 0),c([h()],Pi.prototype,"defaultSpatialReference",void 0),c([h()],Pi.prototype,"userSpatialReference",void 0),c([h()],Pi.prototype,"sourcePreloadCount",void 0),c([h()],Pi.prototype,"priorityCollection",void 0),c([h()],Pi.prototype,"requiresExtentInSpatialReference",void 0),c([h()],Pi.prototype,"suspended",void 0),c([h({readOnly:!0})],Pi.prototype,"ready",null),c([h({readOnly:!0})],Pi.prototype,"heightModelInfoReady",null),c([h({readOnly:!0})],Pi.prototype,"spatialReference",null),c([h({readOnly:!0})],Pi.prototype,"extent",null),c([h({readOnly:!0})],Pi.prototype,"heightModelInfo",null),c([h({readOnly:!0})],Pi.prototype,"vcsWkid",null),c([h({readOnly:!0})],Pi.prototype,"latestVcsWkid",null),c([h({readOnly:!0})],Pi.prototype,"viewingMode",null),c([h({readOnly:!0})],Pi.prototype,"tileInfo",null),c([h({readOnly:!0})],Pi.prototype,"mapCollections",null),c([h({readOnly:!0})],Pi.prototype,"_spatialReferenceTask",null),c([h({readOnly:!0})],Pi.prototype,"_tileInfoTask",null),c([h({readOnly:!0})],Pi.prototype,"_heightModelInfoTask",null),c([h({readOnly:!0})],Pi.prototype,"_extentCandidatesTask",null),c([h()],Pi.prototype,"_extentTask",null),c([h()],Pi.prototype,"_projectExtentTask",void 0),Pi=c([w("esri.views.support.DefaultsFromMap")],Pi);var WA=class{constructor(t,i){this.layerFilter=t,this.pushLayer=i,this.preloading=-1,this.updating=!1,this.done=!1}};function gQ(e,t){return e!=null?t!=null?e===t&&e:e:t}var Iy,Ae=Iy=class extends ti.EventedMixin(dL(k)){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.handles=new qa,this.updatingHandles=new il,this.allLayerViews=new dc({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:_Q}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new pE,this.analyses=new Ud,this.typeSpecificPreconditionsReady=!0,this.layerViews=new qe,this.magnifier=new VA,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new p5,this.navigation=new HA,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new pV(this),this.persistableViewModels=new qe,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this._userTimeExtent=null,this._lockedTimeExtent=null,this.theme=null,this.handles.add(T(()=>this.preconditionsReady,t=>{let i=this.ready;if(t?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,this._lockedTimeExtent=this.timeExtent,Iy.views.add(this)):(this._lockedSpatialReference=null,Iy.views.remove(this)),this.notifyChange("spatialReference"),!t&&i)this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown();else if(t&&!i){try{this._startup()}catch(r){return void queueMicrotask(()=>{this.fatalError=new le("startup-error",null,r)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},Re))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,Gs(()=>this.ready)))),this.basemapView=new i5({view:this}),this.layerViewManager=new r5({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Ia({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new a5({view:this}),this.addHandles([T(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required=se(I({},this.defaultsFromMap.required),{extent:e}),Ce),T(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},Re),T(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},Ce)])}_setupSpatialReferenceLogger(){let e=null;this.addHandles([T(()=>this.defaultsFromMap?.ready,t=>{let i=this.map?.allLayers.length>0;if(t&&!this.spatialReference&&i){if(e!=null)return;let r=kr(()=>e=Er(e));e=js(s=>P(this,null,function*(){try{yield Mb(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{e=null}V.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})),this.addHandles(r,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){this.destroyed||(Iy.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=z(this.graphics),this.analyses=z(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),z(this.analysisViewManager),this.toolViewManager=z(this.toolViewManager),this.layerViewManager=z(this.layerViewManager),this.selectionManager=z(this.selectionManager),this.basemapView=z(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(e=>e.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=z(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return V.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Pi(I({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(e,t)=>this.getSpatialReferenceSupport(e,t)},this.defaultsFromMapSettings))}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||o_.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e?.destroyed&&(V.getLogger(this).warn("#map","The provided map is already destroyed",{map:e}),e=null),o_.isLoadable(e)&&e.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(e&&this.defaultsFromMap?.required?.heightModelInfo){let t=e.clone();return t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,t}return e}set spatialReference(e){let t=!Ka(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeExtent(){return this._userTimeExtent??this._lockedTimeExtent??this.getDefaultTimeExtent()??null}set timeExtent(e){this._userTimeExtent=e}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??aL}set timeZone(e){this._userTimeZone=e,lL(e)||V.getLogger(this).warn("#timeZone",`the parsed value '${e}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new wx}whenLayerView(e){return this.layerViewManager?.whenLayerView(e)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}getDefaultTimeExtent(){return null}importLayerView(e){throw new le("importLayerView() not implemented")}hasLayerViewModule(e){return!1}validate(){return P(this,null,function*(){})}loadAsyncDependencies(){return P(this,null,function*(){})}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return this.getSpatialReferenceSupport(e)!=null}when(e,t){return this.isResolved()&&!this.ready&&V.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(_r(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};Ae.views=new qe,c([h()],Ae.prototype,"_userSpatialReference",void 0),c([h()],Ae.prototype,"activeTool",null),c([h({readOnly:!0})],Ae.prototype,"allLayerViews",void 0),c([h()],Ae.prototype,"groundView",void 0),c([h()],Ae.prototype,"animation",null),c([h()],Ae.prototype,"basemapView",void 0),c([h()],Ae.prototype,"center",null),c([h()],Ae.prototype,"defaultsFromMapSettings",null),c([h()],Ae.prototype,"defaultsFromMap",null),c([h()],Ae.prototype,"fatalError",void 0),c([h({type:vi})],Ae.prototype,"extent",null),c([h(T_(pE,"graphics"))],Ae.prototype,"graphics",void 0),c([h(T_(Ud,"analyses"))],Ae.prototype,"analyses",void 0),c([h({readOnly:!0,type:Ub})],Ae.prototype,"heightModelInfo",null),c([h({readOnly:!0})],Ae.prototype,"interacting",null),c([h({readOnly:!0})],Ae.prototype,"navigating",null),c([h({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Ae.prototype,"preconditionsReady",null),c([h({readOnly:!0})],Ae.prototype,"typeSpecificPreconditionsReady",void 0),c([h({type:qe,readOnly:!0})],Ae.prototype,"layerViews",void 0),c([h()],Ae.prototype,"resolution",null),c([h({type:VA})],Ae.prototype,"magnifier",void 0),c([h({value:null,type:fx})],Ae.prototype,"map",null),c([h()],Ae.prototype,"padding",void 0),c([h({readOnly:!0})],Ae.prototype,"ready",void 0),c([h({type:gt})],Ae.prototype,"spatialReference",null),c([h()],Ae.prototype,"spatialReferenceWarningDelay",void 0),c([h()],Ae.prototype,"stationary",null),c([h({readOnly:!0})],Ae.prototype,"supportsGround",void 0),c([h({type:a2})],Ae.prototype,"timeExtent",null),c([h({type:String,nonNullable:!0})],Ae.prototype,"timeZone",null),c([h()],Ae.prototype,"tools",null),c([h()],Ae.prototype,"toolViewManager",void 0),c([h({readOnly:!0})],Ae.prototype,"type",void 0),c([h({type:Number})],Ae.prototype,"scale",void 0),c([h({readOnly:!0})],Ae.prototype,"updating",void 0),c([h({readOnly:!0})],Ae.prototype,"initialExtentRequired",void 0),c([h({readOnly:!0})],Ae.prototype,"initialExtent",null),c([h()],Ae.prototype,"cursor",null),c([h({readOnly:!0})],Ae.prototype,"input",void 0),c([h({type:HA,nonNullable:!0})],Ae.prototype,"navigation",void 0),c([h()],Ae.prototype,"layerViewManager",void 0),c([h()],Ae.prototype,"analysisViewManager",void 0),c([h()],Ae.prototype,"selectionManager",void 0),c([h()],Ae.prototype,"width",void 0),c([h()],Ae.prototype,"height",void 0),c([h({readOnly:!0})],Ae.prototype,"resizing",void 0),c([h({value:null,readOnly:!0})],Ae.prototype,"size",null),c([h({readOnly:!0})],Ae.prototype,"suspended",void 0),c([h({readOnly:!0})],Ae.prototype,"viewEvents",void 0),c([h({readOnly:!0})],Ae.prototype,"persistableViewModels",void 0),c([h()],Ae.prototype,"_isValid",void 0),c([h()],Ae.prototype,"_readyCycleForced",void 0),c([h()],Ae.prototype,"_lockedSpatialReference",void 0),c([h()],Ae.prototype,"_userTimeZone",void 0),c([h()],Ae.prototype,"_lockedTimeZone",void 0),c([h()],Ae.prototype,"_userTimeExtent",void 0),c([h()],Ae.prototype,"_lockedTimeExtent",void 0),c([h({type:wx})],Ae.prototype,"theme",void 0),c([h({readOnly:!0,type:wx})],Ae.prototype,"effectiveTheme",null),Ae=Iy=c([w("esri.views.View")],Ae);var $A=globalThis.$arcgis;$A&&!$A.views&&Object.defineProperty($A,"views",{configurable:!1,enumerable:!0,writable:!1,value:Ae.views});var Sx=Ae;function _Q(e){return e.layerViews}var Gd=class extends hL{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Hn(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new le("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,t){t||(t=Za(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};c([h({readOnly:!0})],Gd.prototype,"done",null),c([h({readOnly:!0,type:String})],Gd.prototype,"state",void 0),c([h()],Gd.prototype,"target",void 0),Gd=c([w("esri.views.ViewAnimation")],Gd),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Gd||(Gd={}));var Xs=Gd;function yQ(e){return e instanceof Float32Array&&e.length>=2}function vQ(e){return Array.isArray(e)&&e.length>=2}function Tx(e){return yQ(e)||vQ(e)}var ZA,xc=[0,0],Cc=ZA=class extends Wi{constructor(e){super(e),this._viewpoint2D={center:ir(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new vi,this.id=0,this.inverseTransform=V0(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=V0(),this.transformNoRotation=V0(),this.displayMat3=fp(),this.displayViewMat3=fp(),this.viewMat3=fp(),this.viewMat2d=cF(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){let t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}get visibleArea(){let[e,t]=this.size;return[this.toMap([0,0],0,0),this.toMap([0,0],0,t),this.toMap([0,0],e,t),this.toMap([0,0],e,0)]}copy(e){let t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=Ao(i,e.viewpoint),this._set("size",wr(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new ZA({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return Tx(t)?tu(e,t,this.inverseTransform):(xc[0]=t,xc[1]=i,tu(e,xc,this.inverseTransform))}toScreen(e,t,i){return Tx(t)?tu(e,t,this.transform):(xc[0]=t,xc[1]=i,tu(e,xc,this.transform))}toScreenNoRotation(e,t,i){return Tx(t)?tu(e,t,this.transformNoRotation):(xc[0]=t,xc[1]=i,tu(e,xc,this.transformNoRotation))}wrapMapCoordinate(e,t){wr(e,t);let[i]=t,[r]=this.center,{extent:s,spatialReference:n}=this,{xmin:o,xmax:a}=s;if(n.isWrappable){let l=MV(n)/2;o=Math.max(o,r-l),a=Math.min(a,r+l)}return(i<o||i>a)&&(e[0]=O2(i,r,n)),e}getScreenTransform(e,t){let{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return CV(e,i,s,t,0,r),e}_update(){let{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new rr({targetGeometry:new je(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=wV(o),this.rotation=r,this.scale=i,this.spatialReference=t,wr(this.center,e);let a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;s0(this.displayMat3,a,0,0,0,l,0,-1,1,1);let d=Qm(this.viewMat3),u=YM(n[0]/2,n[1]/2),m=YM(-n[0]/2,-n[1]/2),p=Um(r);oc(d,d,u),Km(d,d,p),oc(d,d,m),o0(this.displayViewMat3,this.displayMat3,d);let f=lF(this.viewMat2d,u);return oF(f,f,p),aF(f,f,m),vV(this.extent,o,n),SV(this.transform,o,n,s),nF(this.inverseTransform,this.transform),TV(this.transformNoRotation,o,n,s),this.worldScreenWidth=EV(this.spatialReference,this.resolution),this._set("id",this.id+1),this.notifyChange("visibleArea"),this}};c([h({readOnly:!0})],Cc.prototype,"id",void 0),c([h({value:1,json:{write:!0}})],Cc.prototype,"pixelRatio",null),c([h({json:{write:!0}})],Cc.prototype,"size",null),c([h()],Cc.prototype,"spatialReference",void 0),c([h({type:rr,json:{write:!0}})],Cc.prototype,"viewpoint",null),c([h({readOnly:!0})],Cc.prototype,"visibleArea",null),Cc=ZA=c([w("esri.views.2d.ViewState")],Cc);var QA=Cc;var KA,YA,Sc=KA=class extends k{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new KA({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};c([h()],Sc.prototype,"left",void 0),c([h()],Sc.prototype,"top",void 0),c([h()],Sc.prototype,"right",void 0),c([h()],Sc.prototype,"bottom",void 0),Sc=KA=c([w("esri.views.2d.PaddedViewState.Padding")],Sc);var of=YA=class extends QA{constructor(...e){super(...e),this.paddedViewState=new QA,this._updateContent=(()=>{let t=ir();return()=>{let i=this._get("size"),r=this._get("padding");if(!i||!r)return;let s=this.paddedViewState;En(t,r.left+r.right,r.top+r.bottom),Xb(t,i,t),wr(s.size,t);let n=s.viewpoint;n&&(this.viewpoint=n)}})(),this.addHandles(T(()=>[this.size,this.padding],()=>this._updateContent(),Re)),this.padding=new Sc,this.size=[0,0]}set padding(e){this._set("padding",e||new Sc)}set viewpoint(e){if(e){this.paddedViewState.viewpoint=e;let t=e,i=this._get("padding");i&&(t=AV(e.clone(),e,this._get("size"),i));let{targetGeometry:r,rotation:s,scale:n}=t,{x:o,y:a,spatialReference:l}=r,d=this._viewpoint2D;d.center[0]=o,d.center[1]=a,d.rotation=s,d.scale=n,d.spatialReference=l,this._update()}}clone(){return new YA({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};c([h()],of.prototype,"paddedViewState",void 0),c([h({type:Sc})],of.prototype,"padding",null),c([h()],of.prototype,"viewpoint",null),of=YA=c([w("esri.views.2d.PaddedViewState")],of);var af=of;var Dy=class{constructor(t){this._view=t,this.viewpoint=new rr({targetGeometry:new je,scale:0,rotation:0})}get view(){return this._view}get size(){let[t,i]=this._view.size;return Math.sqrt(t*t+i*i)}get scale(){return this.viewpoint.scale}get rotation(){return this.viewpoint.rotation}get center(){return this.viewpoint.targetGeometry}get scaleToResolutionFactor(){return xV(this.center.spatialReference)}pixelsPerPanAtZoom(t){return 1/(t*this.scaleToResolutionFactor)}zoomAtPixelsPerPan(t){return 1/(t*this.scaleToResolutionFactor)}pixelsPerRotate(){return this.size/2}compareTo(t,i){i.pan=CL(this.center,t.center);let r=Math.abs(t.rotation-this.rotation);r=r>=180?360-r:r,i.rotate=Vt(r),i.sourceZoom=this.scale,i.targetZoom=t.scale}interpolate(t,i,r){let{pan:s,rotate:n,zoom:o,zoomOffset:a}=r,{center:l}=this;l.spatialReference=t.center.spatialReference,l.x=Ke(t.center.x,i.center.x,s),l.y=Ke(t.center.y,i.center.y,s),this.viewpoint.scale=Ke(t.scale,i.scale+a,o);let d=t.rotation,u=i.rotation;Math.abs(u-d)>=180&&(d+=360*(d<u?1:-1)),this.viewpoint.rotation=Ke(d,u,n)}copyFrom(t){Ao(this.viewpoint,t.viewpoint),this._view=t.view}};var bQ=e=>e,Py=e=>e*e,Mx=e=>1-Py(1-e),wQ=e=>e<.5?Py(2*e)/2:(Mx(2*(e-.5))+1)/2,XA=e=>e*e*e,f5=e=>1-XA(1-e),JA=e=>e<.5?XA(2*e)/2:(f5(2*(e-.5))+1)/2,eI=e=>e*e*e*e,g5=e=>1-eI(1-e),xQ=e=>e<.5?eI(2*e)/2:(g5(2*(e-.5))+1)/2,tI=e=>e*e*e*e*e,_5=e=>1-tI(1-e),CQ=e=>e<.5?tI(2*e)/2:(_5(2*(e-.5))+1)/2,iI=e=>1-Math.cos(e*Math.PI/2),y5=e=>1-iI(1-e),SQ=e=>e<.5?iI(2*e)/2:(y5(2*(e-.5))+1)/2,rI=e=>2**(10*(e-1)),qd=e=>1-rI(1-e),TQ=e=>e<.5?rI(2*e)/2:(qd(2*(e-.5))+1)/2,sI=e=>-(Math.sqrt(1-e*e)-1),v5=e=>1-sI(1-e),MQ=e=>e<.5?sI(2*e)/2:(v5(2*(e-.5))+1)/2;function Bo(e){let t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function zo(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}var EQ=zo(Bo(1),1),RQ=zo(Bo(1),0),Ex=zo(Bo(1),.5),AQ=zo(Bo(2),1),IQ=zo(Bo(2),0),DQ=zo(Bo(2),.5),PQ=zo(Bo(3),1),OQ=zo(Bo(3),0),kQ=zo(Bo(3),.5),LQ=zo(Bo(4),1),FQ=zo(Bo(4),0),NQ=zo(Bo(4),.5),b5={linear:bQ,"in-quad":Py,"out-quad":Mx,"in-out-quad":wQ,"in-coast-quad":EQ,"out-coast-quad":RQ,"in-out-coast-quad":Ex,"in-cubic":XA,"out-cubic":f5,"in-out-cubic":JA,"in-coast-cubic":AQ,"out-coast-cubic":IQ,"in-out-coast-cubic":DQ,"in-quart":eI,"out-quart":g5,"in-out-quart":xQ,"in-coast-quart":PQ,"out-coast-quart":OQ,"in-out-coast-quart":kQ,"in-quint":tI,"out-quint":_5,"in-out-quint":CQ,"in-coast-quint":LQ,"out-coast-quint":FQ,"in-out-coast-quint":NQ,"in-sine":iI,"out-sine":y5,"in-out-sine":SQ,"in-expo":rI,"out-expo":qd,"in-out-expo":TQ,"in-circ":sI,"out-circ":v5,"in-out-circ":MQ};var Rx=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};var Au={desiredScreenFlow:2,minDuration:500,maxDuration:8e3},nI=se(I({},Au),{maxDuration:4e3});var Ax=class e{constructor(t){this._createCamera=t,this.compared=new Rx,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:Au.desiredScreenFlow},this.source=t(),this.target=t()}clone(){let t=new e(this._createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,r){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow??Au.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){let i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>Wb()}get hasFov(){return Math.abs(this.compared.fov)>Wb()}get hasRotate(){return this.compared.rotate>Wb()}};var Ix=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}};var x5=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,t)=>e+t.time,0)}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,r=0,s=this.definition,n=this.segments.reduce((o,a)=>o||a.definition.hasZoom,!1);for(let o=0;o<this.segments.length;o++){let a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,t),s.hasPan&&!isNaN(t.pan)&&isFinite(s.compared.pan)?t.pan=(i+l.compared.pan*t.pan)/s.compared.pan:t.pan=1,s.hasRotate&&!isNaN(t.rotate)&&isFinite(s.compared.rotate)?t.rotate=(r+l.compared.rotate*t.rotate)/s.compared.rotate:t.rotate=1,n&&!isNaN(t.zoom)&&isFinite(l.compared.targetZoom)){let{sourceZoom:d,targetZoom:u}=l.compared,m=t.zoom*(u-d)+d,p=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,g=Math.abs(u-p)>Math.abs(d-p)?u:d;t.zoomOffset=g-f,t.zoom=(m-p)/(g-p)}else t.zoom=1;return t}e-=a.time,i+=l.compared.pan,r+=l.compared.rotate}}segmentInterpolateComponentsAt(e,t,i){e.interpolateComponentsAt(t,i)}};var lf=class{get time(){return this._time}constructor(t){t&&this.update(t)}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){let t=this.definition,i=t.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(r);let n=(t.source.pixelsPerRotate()+t.target.pixelsPerRotate())/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){let t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition,o=0,a=0;r&&(s&&(o=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;let l=this.definition.desiredPixelFlow;if(r&&s&&n){let d=o+a+o*a;this._zoomPixelFlow=o*a/d*l,this._panPixelFlow=a/d*l,this._rotatePixelFlow=o/d*l}else if(r&&s){let d=1+o;this._zoomPixelFlow=o/d*l,this._panPixelFlow=1/d*l}else if(r&&n){let d=1+a;this._zoomPixelFlow=a/d*l,this._rotatePixelFlow=1/d*l}else if(s&&n){let d=this._panPixelsAtSource/this._rotatePixels,u=1+d;this._panPixelFlow=d/u*l,this._rotatePixelFlow=1/u*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);if(this._time=Math.max(this.rotateTime,this.zoomTime,this.panTime),this.fovTime>this._time){let d=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=d,this._panPixelFlow/=d,this._rotatePixelFlow/=d}}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/VQ:0}get panTime(){if(!this.definition.hasPan)return 0;if(this.definition.hasZoom){let t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){let i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-t-i)/(r-i)}return t}_interpolateComponentsFov(t){if(t===0)return this.definition.segmentStart;if(t===1)return this.definition.segmentEnd;if(this.definition.hasFov){let{segmentStart:i,segmentEnd:r}=this.definition;return i+t*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){let i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),i.zoom=this._interpolateComponentsZoom(t),i.pan=this._interpolateComponentsPan(t),i.rotate=this._interpolateComponentsRotate(t),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(t)}},VQ=Vt(45);function C5(e,t,i){let r=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function S5(e,t,i){let r=1/t,s=Math.log(e.compared.sourceZoom*r),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,d=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*n*o*l*d-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*d/(a*a)}function T5(e,t,i){let r=t-e.compared.sourceZoom,s=1/r,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function M5(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function E5(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function R5(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function A5(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function I5(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function D5(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function P5(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function O5(e,t,i){let r=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*s*n*a+e.halfWindowSize*r*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function k5(e,t,i){let r=t-e.compared.targetZoom,s=1/r,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function L5(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function F5(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function N5(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function V5(e){let t=e.compared.sourceZoom-e.compared.targetZoom;if(t===0)return e.compared.pan*e.halfWindowSize/(e.desiredPixelFlow*e.halfWindowPanAtZoom(e.compared.sourceZoom));let i=Math.LN2*e.compared.pan,r=t,s=e.halfWindowPanAtZoom(r),n=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*s);return e.compared.sourceZoom<=e.compared.targetZoom?n*(i-s):n*(i+s)}function B5(e,t){let i=BQ(e,t),r={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?M5:C5,a=s?E5:S5,l=s?R5:T5,d=n?L5:P5,u=n?F5:O5,m=n?N5:k5,p=C=>o(e,C,r)+A5(e,C,r)+d(e,C,r),f=C=>a(e,C,r)+I5(e,C,r)+u(e,C,r),g=C=>l(e,C,r)+D5(e,C,r)+m(e,C,r),_=p(i),y=V5(e),v,x=t.maximumIterations||20,S=t.maximumDistance!=null?t.maximumDistance:1/0;for(v=0;v<x;v++){let C=t.desiredSlope??1e-6,E=f(i);Math.abs(E)>C&&(E+=C);let R=E/g(i);if(isNaN(R)||i>=S&&R<0){if(!isFinite(S))return null;i=S,_=p(i);break}if(i-=R,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;let D=p(i);if(Math.abs(D-_)/_<=.005)break;_=D}return _>y*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function BQ(e,t){let i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}var Dx=class extends x5{constructor(t,i){super(),this._preallocSegments=[new lf,new lf,new lf],this._ascensionSegment=null,this._descensionSegment=null,this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let r=i?.apex?B5(t,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(t,i,r){t.interpolateComponentsAt(i,r),t===this._ascensionSegment?r.zoom=Mx(r.zoom):t===this._descensionSegment&&(r.zoom=Py(r.zoom))}_updateWithApex(t,i){let[r,s,n]=this._preallocSegments,o=i?.ascensionFactor??.5,a=Math.min(1-o,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=t,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.definition.segmentEnd=o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.definition.segmentStart=r.definition.segmentEnd,s.definition.segmentEnd=r.definition.segmentEnd+l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.definition.segmentStart=o+l,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){let[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}};var zQ=new Ix,Px=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=Ex,this.definition=new Ax(e),this.path=new Dx}update(e,t,i){this.definition.update(e,t,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(Eb(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?Ex:qd)}cameraAt(e,t){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);let i=this.path.interpolateComponentsAt(e,zQ);t.interpolate(this.definition.source,this.definition.target,i)}_normalizedEasing(e){let t=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(i-t)}_applyTimeSettings(e,t){let i=t.speedFactor!=null?t.speedFactor:1,r=t.minDuration??Au.minDuration/i,s=t.maxDuration??Au.maxDuration/i;return e=t.duration!=null?t.duration:Math.min(Math.max(e/i,r),s)}};var z5=2e3,UQ=64,oI=class{constructor(t){this._view=t,this._animation=new Px(()=>new Dy(this._view)),this._current=new Dy(this._view)}get _source(){return this._animation.definition.source}get _target(){return this._animation.definition.target}get duration(){return this._animation.time}get animation(){return this._animation}update(t,i,r={}){Ao(this._current.viewpoint,t),Ao(this._source.viewpoint,t),Ao(this._target.viewpoint,i),this._animation.update(this._source,this._target,r)}applyRatio(t,i){this._animation.cameraAt(i,this._current),Ao(t,this._current.viewpoint)}},cf=class extends k{constructor(e){super(e),this._animation=null,this._destinationViewState=new af,this.updateFunction=null,this.easing=jF.ease,this.viewpoint=new rr({targetGeometry:new je,scale:0,rotation:0}),this._updateTask=As({postRender:this._postRender.bind(this)}),this._updateTask.pause(),this._transition=new oI(e.view)}destroy(){this._updateTask=Nt(this._updateTask)}get animation(){return this._animation}set animation(e){this._animation=e,this.view.animation=e}animate(e,t,i){this.stop();let r=this.viewpoint;Ao(r,t);let s=(typeof i?.easing=="string"?GF(i.easing):i?.easing)||this.easing,n=e.target;this._transition.update(this.viewpoint,n,{apex:{maximumDistance:Math.min(Math.min(t.scale,n.scale)*UQ,this.view.constraints.effectiveMinScale),desiredSlope:5e-8},duration:i?.duration,maxDuration:i?.animationMode==="auto"?1/0:i?.maxDuration??nI.maxDuration,speedFactor:i?.speedFactor,easing:typeof s=="function"?a=>s(a):void 0}),i?.animationMode==="auto"&&(this._destinationViewState.copy(this.view.state),this._destinationViewState.viewpoint=n,HQ(this._transition.animation,i,this.view.state,this._destinationViewState)||this._transition.update(this.viewpoint,n,{duration:0}));let o=()=>{this.animation===e&&this._updateTask&&(e.state==="finished"&&(this._transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(o,o),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinuous(e,t){this.stop(),this.updateFunction=t,this.viewpoint=e;let i=new Xs({target:e.clone()}),r=()=>{this.animation===i&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return i.when(r,r),this._startTime=performance.now(),this._updateTask.resume(),this.animation=i,i}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){let t=this.animation;if(t&&t.state!==Xs.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime),this.animation?.update(this.viewpoint);else{let i=performance.now()-this._startTime,r=this._transition.duration,s=r>0?i/r:1,n=s>=1;this._transition.applyRatio(this.viewpoint,s),n&&this.animation?.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};function HQ(e,t,i,r){if(t?.duration!=null)return!0;let{time:s,isLinear:n}=e,o=t?.speedFactor||1,a=t?.maxDuration??nI.maxDuration/o;if(Qe("esri-goto-debug")&&(console.log("speed factor:",o),console.log("adjusted duration:		",s),console.log("adjusted max duration:	",a),console.log("is linear:",n)),s>a)return Qe("esri-goto-debug")&&console.warn(`failed "auto" heuristic: animations must be shorter than ${a/1e3}s`),!1;if(n){let d=ir(),u=vr(...r.toScreen(d,...i.center)),m=vr(...i.toScreen(d,...r.center)),p=m!=null&&m.x>-(1.5-.5)*i.size[0]&&m.x<(1.5+.5)*i.size[0]&&m.y>-(1.5-.5)*i.size[1]&&m.y<(1.5+.5)*i.size[1],f=u!=null&&u.x>-(1.5-.5)*r.size[0]&&u.x<(1.5+.5)*r.size[0]&&u.y>-(1.5-.5)*r.size[1]&&u.y<(1.5+.5)*r.size[1];if(Qe("esri-goto-debug")&&(console.log(`dest is within ${1.5} screens at start view:`,p),console.log(`start is within ${1.5} screens at dest view:`,f)),s>z5/o&&!p&&!f)return Qe("esri-goto-debug")&&console.warn(`failed "auto" heuristic: linear animations must be...
  - shorter than ${z5/1e3/o}s, or
  - shorter than ${a/1e3}s and the destination is close enough to the starting screen, or
  - shorter than ${a/1e3}s and the start point is close enough to the destination screen`),!1}return!0}c([h()],cf.prototype,"easing",void 0),c([h()],cf.prototype,"view",void 0),c([h()],cf.prototype,"viewpoint",void 0),cf=c([w("esri.views.2d.AnimationManager")],cf);var U5=cf;var Ox=class{constructor(t){this.view=t,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this._scheduler=Yb(),this.stationary=!0,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions,this._updateParameters.targetState.copy(this.view.state),this.view.animation?.target==null||Za(this.view.animation.target)||(this._updateParameters.targetState.viewpoint=this.view.animation.target))},this.update=i=>{if(this._updateRequested=!1,this.view?.destroyed)return;let{allLayerViews:r,graphicsView:s,labelManager:n,state:{id:o}}=this.view;r.forEach(this._updateLayerView,this),n!=null&&(n.lastUpdateId!==o&&(n.viewChange(),n.lastUpdateId=o),n.updateRequested&&n.processUpdate(this._updateParameters)),s!=null&&(s.lastUpdateId!==o&&(s.viewChange(),s.lastUpdateId=o),s.updateRequested&&s.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.view.animation?this._scheduler.state=Fi.ANIMATING:this.view.interacting?this._scheduler.state=Fi.INTERACTING:this._scheduler.state=Fi.IDLE,this._scheduler.updateBudget(i)&&this._scheduler.frame()}}destroy(){this.stop(),this._scheduler.destroy()}get scheduler(){return this._scheduler}start(){if(this._frameTaskHandle)return;let t=this.view;this.stationary=t.stationary,this._updateParameters={state:t.state,targetState:new af,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:t.renderingOptions},this._stationaryHandle=T(()=>t.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=As(this),this.requestUpdate()}stop(){this._frameTaskHandle&&(this._updateRequested=!1,this._stationaryHandle?.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(t){if(!t.attached)return void this.requestUpdate();let i=this.view.state,r=t.lastUpdateId;r!=null&&(this.stationary||t.moving)||(t.moving=!0),r!==i.id&&t.viewChange(),this.stationary&&t.moving&&(t.moving=!1,t.moveEnd()),t.lastUpdateId=i.id,t.updateRequested&&t.processUpdate(this._updateParameters),"layerViews"in t&&t.layerViews?.forEach(this._updateLayerView,this)}};var Oy=class extends k{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}goTo(e,t){return P(this,null,function*(){if(!e)return void V.getLogger(this).error("#goTo()","target cannot be null or undefined");let i=new Xs;this.view.animation=i,yield Gs(()=>this.view.ready,t);let r=se(I({},t),{animate:t?.animate??!L0(),animationMode:t?.animationMode??"auto"}),{extent:s,spatialReference:n,size:o,viewpoint:a,constraints:l,padding:d,allLayerViews:u}=this.view,m=yV(e,{extent:s,spatialReference:n,size:o,viewpoint:a,constraints:l,padding:d,allLayerViews:u,pickClosestTarget:t?.pickClosestTarget??!0});return i?.update(m),this._gotoTask={},r.animate?this._gotoAnimated(m,r):this._gotoImmediate(m,r)})}_gotoImmediate(e,t){let i=this._gotoTask,r=this.view.animation,s=e.then(n=>{if(Ut(t),i!==this._gotoTask)throw new le("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=r.target=n,r.finish()});return this._cancellableGoTo(i,r,s,t)}_gotoAnimated(e,t){let i=this._gotoTask,r=this.view.animation;if(!r)return Promise.resolve();let s=e.then(n=>{if(Ut(t),i!==this._gotoTask)throw new le("view:goto-interrupted","Goto was interrupted");return r.update(n),this.view.animationManager.animate(r,this.view.viewpoint,t),r.when().then(()=>{},()=>{})});return this._cancellableGoTo(i,r,s,t)}_cancellableGoTo(e,t,i,r){let s=()=>e===this._gotoTask;return Tb(i,r).finally(()=>{s()&&(t.done||t.stop())})}};c([h({constructOnly:!0})],Oy.prototype,"view",void 0),Oy=c([w("esri.views.2d.GoToManager")],Oy);function $i(){return Promise.all([import("./chunk-3737YILK.js"),import("./chunk-3X2YWR7C.js")])}var ky=()=>$i().then(()=>import("./chunk-6LWFBTHG.js")),Iu=()=>$i().then(()=>import("./chunk-NOSYJFNQ.js")),H5={"base-dynamic":()=>$i().then(()=>import("./chunk-GGVOU56V.js")),"base-tile":ky,"bing-maps":ky,catalog:()=>$i().then(()=>import("./chunk-DGK2LAST.js")),"catalog-dynamic-group":()=>$i().then(()=>import("./chunk-AH3YEARY.js")),"catalog-footprint":()=>$i().then(()=>import("./chunk-AB4CMSBX.js")),csv:Iu,"geo-rss":()=>$i().then(()=>import("./chunk-XOGCQIKG.js")),feature:Iu,geojson:Iu,parquet:Iu,graphics:()=>$i().then(()=>import("./chunk-WPCU5I2F.js")),group:()=>$i().then(()=>import("./chunk-DUH77GS2.js")),imagery:()=>$i().then(()=>import("./chunk-WRWUGNG7.js")),"imagery-tile":()=>$i().then(()=>import("./chunk-MKX5CQZ7.js")),kml:()=>$i().then(()=>import("./chunk-FYEZ7HEY.js")),"knowledge-graph":()=>$i().then(()=>import("./chunk-HAIGAC3P.js")),"link-chart":()=>$i().then(()=>import("./chunk-HAIGAC3P.js")),"knowledge-graph-sublayer":Iu,"map-image":()=>$i().then(()=>import("./chunk-6WLCXBNG.js")),"map-notes":()=>$i().then(()=>import("./chunk-MVMI25HG.js")),media:()=>$i().then(()=>import("./chunk-A4TKJ2RF.js")),"ogc-feature":()=>$i().then(()=>import("./chunk-VVE6ROVT.js")),"open-street-map":ky,"oriented-imagery":Iu,route:()=>$i().then(()=>import("./chunk-D6A2CFL5.js")),stream:()=>$i().then(()=>import("./chunk-NYKX7EZ3.js")),"subtype-group":()=>$i().then(()=>import("./chunk-YXVYQOBA.js")),tile:ky,"vector-tile":()=>$i().then(()=>import("./chunk-ZL2PQRNY.js")),video:()=>$i().then(()=>import("./chunk-5UW3L4ZU.js")),wcs:()=>$i().then(()=>import("./chunk-MKX5CQZ7.js")),"web-tile":ky,wfs:Iu,wms:()=>$i().then(()=>import("./chunk-EUUWMJOG.js")),wmts:()=>$i().then(()=>import("./chunk-OF33ZF5X.js")),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,focusArea:null,"integrated-mesh":null,"integrated-mesh-3dtiles":null,"point-cloud":null,viewshed:null,voxel:null,scene:null,unknown:null,unsupported:null};function jQ(e){let t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new le(`${i}:view-not-supported`,`${t} is not supported in 2D`)}var aI={hasLayerViewModule:e=>H5[e.type]!=null,importLayerView:e=>{let t=H5[e.type];if(t==null)throw jQ(e);return t(e)}};function j5(e,t){let{spatialReference:i}=t,r=[t.x,t.y],s=Number.POSITIVE_INFINITY,n=0,o=0,a=[0,0],l=e.type==="extent"?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:e.rings;for(let d of l)for(let u=0;u<d.length-1;u++){EL(a,r,d,u);let m=ma(r,a);m<s&&(s=m,n=a[0],o=a[1])}return{coordinate:new je({x:n,y:o,spatialReference:i}),distance:s}}var lI,Wd=lI=class extends Bm(k){constructor(e){super(e),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(this.geometry==null||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return sc(this.geometry,this.spatialReference)}catch(e){return V.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:e}),null}return this.geometry}constrain(e,t){if(this.normalizedGeometry==null)return e;let i=e.targetGeometry;if(this.normalizedGeometry.type==="extent"?zb(this.normalizedGeometry,i):TL(this.normalizedGeometry,i))return e;let{coordinate:r}=j5(this.normalizedGeometry,i);return r&&(e.targetGeometry=r),e}clone(){return new lI({geometry:this.geometry?.clone(),spatialReference:this.spatialReference?.clone()})}};c([h({constructOnly:!0})],Wd.prototype,"geometry",void 0),c([h({readOnly:!0})],Wd.prototype,"normalizedGeometry",null),c([h({constructOnly:!0})],Wd.prototype,"spatialReference",void 0),Wd=lI=c([w("esri.views.2d.constraints.GeometryConstraint")],Wd);var cI,Ly=cI=class extends Bm(k){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(e,t){return this.enabled&&t&&(this.rotationEnabled||(e.rotation=t.rotation)),e}clone(){return new cI({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};c([h()],Ly.prototype,"enabled",void 0),c([h()],Ly.prototype,"rotationEnabled",void 0),Ly=cI=c([w("esri.views.2d.constraints.RotationConstraint")],Ly);var dI=Ly;var hI,kn=hI=class extends Bm(k){constructor(e){super(e),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let e,{lods:t,minScale:i,maxScale:r,minZoom:s,maxZoom:n}=this,o=-1,a=-1,l=!1,d=!1;if(i!==0&&r!==0&&i<r&&([i,r]=[r,i]),!t?.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",r);t=t.map(u=>u.clone()),t.sort((u,m)=>m.scale-u.scale),t.forEach((u,m)=>u.level=m);for(let u of t)!l&&i>0&&i>=u.scale&&(o=u.level,l=!0),!d&&r>0&&r>=u.scale&&(a=e?e.level:-1,d=!0),e=u;s===-1&&(s=i===0?0:o),n===-1&&(n=r===0?t.length-1:a),s=Math.max(s,0),s=Math.min(s,t.length-1),n=Math.max(n,0),n=Math.min(n,t.length-1),s>n&&([s,n]=[n,s]),i=t[s].scale,r=t[n].scale,t.splice(0,s),t.splice(n-s+1,t.length),t.forEach((u,m)=>{this._lodByScale[u.scale]=u,this._scales[m]=u.scale}),this._set("effectiveLODs",t),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",n),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",r)}constrain(e,t){if(t&&e.scale===t.scale)return e;let i=this.effectiveMinScale,r=this.effectiveMaxScale,s=e.targetGeometry,n=t&&t.targetGeometry,o=r!==0&&e.scale<r,a=i!==0&&e.scale>i;if(o||a){let l=a?i:r;if(t&&n){let d=(l-t.scale)/(e.scale-t.scale);s.x=n.x+(s.x-n.x)*d,s.y=n.y+(s.y-n.y)*d}e.scale=l}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}fit(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);let t=this.scaleToZoom(e.scale),i=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(i>.99?Math.round(t):Math.floor(t)),e}zoomToScale(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);let t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];let i=Math.floor(e),r=Math.ceil(e);return t[i]+(e-i)*(t[r]-t[i])}scaleToZoom(e){if(!this.effectiveLODs)return-1;let t=this._scales,i,r;if(e>=t[0])return this.effectiveMinZoom;if(e<=t[t.length-1])return this.effectiveMaxZoom;for(let s=0;s<t.length-1;s++){if(i=t[s],r=t[s+1],r===e)return s+this.effectiveMinZoom+1;if(i>e&&r<e)return s+this.effectiveMinZoom+1-(e-r)/(i-r)}return-1}snapToClosestScale(e){if(!this.effectiveLODs)return e;let t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}snapToNextScale(e,t=.5){if(!this.effectiveLODs)return e*t;let i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i+1)}snapToPreviousScale(e,t=2){if(!this.effectiveLODs)return e*t;let i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i-1)}clone(){return new hI({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(e){return this._lodByScale[e]||(e=this._scales.reduce((t,i)=>Math.abs(i-e)<=Math.abs(t-e)?i:t,this._scales[0])),this._lodByScale[e].scale}};c([h({readOnly:!0})],kn.prototype,"effectiveLODs",void 0),c([h({readOnly:!0})],kn.prototype,"effectiveMinZoom",void 0),c([h({readOnly:!0})],kn.prototype,"effectiveMaxZoom",void 0),c([h({readOnly:!0})],kn.prototype,"effectiveMinScale",void 0),c([h({readOnly:!0})],kn.prototype,"effectiveMaxScale",void 0),c([h()],kn.prototype,"lods",void 0),c([h()],kn.prototype,"minZoom",void 0),c([h()],kn.prototype,"maxZoom",void 0),c([h()],kn.prototype,"minScale",void 0),c([h()],kn.prototype,"maxScale",void 0),c([h()],kn.prototype,"snapToZoom",void 0),kn=hI=c([w("esri.views.2d.constraints.ZoomConstraint")],kn);var uI=kn;var GQ={base:null,key:"type",typeMap:{extent:vi,polygon:Xa}},Ir=class extends k{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new qe}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){return`${this._zoom?.uid}/${this._rotation?.uid}/${this._geometry?.uid}`}get _geometry(){let e=this._get("_geometry");return e&&this.geometry===e.geometry&&this.view?.constraintsInfo.spatialReference===e.spatialReference?e:new Wd({geometry:this.geometry,spatialReference:this.view?.constraintsInfo.spatialReference})}get _rotation(){return new dI({rotationEnabled:this.rotationEnabled})}get _zoom(){let e=this._get("_zoom"),t=this.lods||this.view?.constraintsInfo.lods,i=this.minZoom,r=this.maxZoom,s=this.minScale,n=this.maxScale,o=this.snapToZoom;return e&&e.lods===t&&e.minZoom===i&&e.maxZoom===r&&e.minScale===s&&e.maxScale===n&&e.snapToZoom===o?e:new uI({lods:t,minZoom:i,maxZoom:r,minScale:s,maxScale:n,snapToZoom:o})}canZoomInTo(e){let t=this.effectiveMaxScale;return t===0||e>=t}canZoomOutTo(e){let t=this.effectiveMinScale;return t===0||e<=t}constrain(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),this._geometry.constrain(e,t),this.customConstraints.forEach(i=>i.constrain(e,t)),e}constrainByGeometry(e){return this._geometry.constrain(e),this.customConstraints.forEach(t=>t.applyPanConstraint?.(e)),e}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};c([h({readOnly:!0})],Ir.prototype,"effectiveLODs",null),c([h({readOnly:!0})],Ir.prototype,"effectiveMinScale",null),c([h({readOnly:!0})],Ir.prototype,"effectiveMaxScale",null),c([h({readOnly:!0})],Ir.prototype,"effectiveMinZoom",null),c([h({readOnly:!0})],Ir.prototype,"effectiveMaxZoom",null),c([h({types:GQ,value:null})],Ir.prototype,"geometry",null),c([h({type:[i2]})],Ir.prototype,"lods",void 0),c([h()],Ir.prototype,"minScale",void 0),c([h()],Ir.prototype,"maxScale",void 0),c([h()],Ir.prototype,"minZoom",void 0),c([h()],Ir.prototype,"maxZoom",void 0),c([h()],Ir.prototype,"rotationEnabled",void 0),c([h()],Ir.prototype,"snapToZoom",void 0),c([h({type:qe})],Ir.prototype,"customConstraints",void 0),c([h()],Ir.prototype,"view",void 0),c([h({readOnly:!0})],Ir.prototype,"version",null),c([h({type:Wd,readOnly:!0})],Ir.prototype,"_geometry",null),c([h({type:dI})],Ir.prototype,"_rotation",null),c([h({readOnly:!0,type:uI})],Ir.prototype,"_zoom",null),Ir=c([w("esri.views.2d.MapViewConstraints")],Ir);var mI=Ir;var ks=class extends k{constructor(e){super(e),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([T(()=>this.constraints?.version,t=>{this.constraints&&t&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))},Re)])}get center(){if(!this.ready)return this._get("center");let{center:e,spatialReference:t}=this.state.paddedViewState;return this.state.commitProperty("id"),new je({x:e[0],y:e[1],spatialReference:t})}set center(e){if(e==null)return;if(!this.ready)return void this._set("center",e);let t;try{t=this._project(e,this.state.spatialReference)}catch(r){return void V.getLogger(this).error(new le("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:r}))}let i=this.viewpoint;vE(i,i,t),this.viewpoint=i}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void V.getLogger(this).error(new le("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let t;try{t=this._project(e,this.state.spatialReference)}catch(r){return void V.getLogger(this).error(new le("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:r}))}let i=this.viewpoint;bV(i,i,t,this.state.size,{constraints:this.constraints}),this.viewpoint=i}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);let t=this.viewpoint;DV(t,t,e),this.viewpoint=t}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",void 0);let i=this._get("extent");return void(i&&(this._set("extent",void 0),this._set("center",i.center)))}let t=this.viewpoint;bE(t,t,e),this.viewpoint=t}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(e){if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let t,i;try{t=this._project(e,this.state.spatialReference),!e.scale||isNaN(e.scale)?i=new le("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):e.targetGeometry==null&&(i=new le("mapview:invalid-viewpoint","geometry not defined"))}catch(s){i=new le("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:s})}if(i)return void V.getLogger(this).error(i);this._scaleBeforeChangingSpatialReference=null;let r=new rr({targetGeometry:new je,scale:0,rotation:0});Ao(r,t),this.constraints?.constrain(r,this.state.paddedViewState.viewpoint),this.state.viewpoint=r,this._set("viewpoint",r)}get visibleArea(){return this.ready?this.state.visibleArea:null}get zoom(){return this.ready?this.constraints?.scaleToZoom(this.scale)??-1:this._get("zoom")}set zoom(e){if(!(e>=0))return;if(!this.ready){this._set("zoom",e),this._set("scale",void 0);let r=this._get("extent");return void(r&&(this._set("extent",void 0),this._set("center",r.center)))}let t=this.constraints?.zoomToScale(e)??0;if(!t)return void this._set("zoom",-1);let i=this.viewpoint;bE(i,i,t),this.viewpoint=i,this._set("zoom",this.constraints?.scaleToZoom(this.scale)??-1)}getUserStartupOptions(e){if(!e[0]&&!e[1])return{center:void 0,rotation:void 0,scale:void 0};let{padding:t,constraints:i}=this,r=this._get("center"),s=this._get("extent"),n=this._get("scale"),o=this._get("rotation"),a=this._get("viewpoint"),l=this._get("zoom"),d=l!=null&&i!=null&&i.zoomToScale(l)||void 0,u,m,p,f=a?.rotation,g=a?.targetGeometry;g?.type==="extent"?u=g:g?.type==="point"&&(m=g,p=a?.scale);let _=s??u;return{center:r??m??_?.center,rotation:o??f,scale:(n??d??p??(_&&B0(_,[e[0]-t.left-t.right,e[1]-t.top-t.bottom])))||void 0}}startup(e,t,i,r){let s=e.targetGeometry;try{this._project(e,i)}catch(n){V.getLogger(this).warn(new AM("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:s.toJSON(),spatialReference:i,error:n})),e.targetGeometry=r||new je({x:0,y:0,spatialReference:i})}this.constraints?.fit(e),this._set("state",new af({padding:this.padding,size:t,viewpoint:e})),this._set("ready",!0)}teardown(){this._set("ready",!1);let{center:[e,t],spatialReference:i,rotation:r,scale:s}=this.state.paddedViewState,n=new je({x:e,y:t,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",n),this._set("zoom",-1),this._set("rotation",r),this._set("scale",s),this._set("state",null)}changeSpatialReference(e){let t=this.state.paddedViewState.clone();if(this._scaleBeforeChangingSpatialReference==null)this._scaleBeforeChangingSpatialReference=t.scale;else{let a=t.viewpoint.clone();a.scale=this._scaleBeforeChangingSpatialReference,t.viewpoint=a}let i=t.clone(),[r,s]=t.center,n=null;try{n=this._project(new je({x:r,y:s,spatialReference:t.spatialReference}),e)}catch(a){gL()||V.getLogger(this).warn(new AM("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:n?.toJSON(),spatialReference:e,error:a}))}n||(n=new je({x:0,y:0,spatialReference:e}));let o=vE(new rr({targetGeometry:new je,scale:0,rotation:0}),t.viewpoint,n);i.viewpoint=o;try{let l=[t.size[0]/2,t.size[1]/2],d=[l[0]+20,l[1]],u=t.toMap([0,0],d),{x:m,y:p}=this._project(new je({x:u[0],y:u[1],spatialReference:t.spatialReference}),e);u[0]=m,u[1]=p,i.toScreen(u,u);let f=RV(l,u,d),g=Math.hypot(u[0]-l[0],u[1]-l[1])/20;!Number.isFinite(g)||Math.abs(g)>4?(o.rotation=0,o.targetGeometry=new je({x:0,y:0,spatialReference:e})):(o.scale*=g,o.scale>Qe("mapview-srswitch-adjust-rotation-scale-threshold")?o.rotation=0:o.rotation+=Number.isFinite(f)?f:0)}catch{}this._get("constraints")?.constrain(o,void 0),this._get("state").viewpoint=o}resize(e,t){if(!this.ready)return;let i=this.state,r=this.state.paddedViewState.viewpoint,s=this.state.paddedViewState.size.slice();i.size=[e,t],IV(r,r,s,this.state.paddedViewState.size,this.resizeAlign),r=this.constraints?.constrain(r,void 0)??r,this.state.viewpoint=r}toMap(e){if(!this.ready)return null;let t=[0,0],[i,r]=this.state.toMap(t,[e.x,e.y]),s=this.state.spatialReference;return new je({x:i,y:r,spatialReference:s})}toScreen(e,t){if(!this.ready)return null;let i=this._project(e,this.state.spatialReference),r=[i.x,i.y];return t?.pickClosestTarget===!1||this.state.paddedViewState.wrapMapCoordinate(r,r),this.state.toScreen(r,r),vr(r[0],r[1])}_project(e,t){let i=e?.targetGeometry||e;if(!t)return e;if(!i)return null;if(t.imageCoordinateSystem||i.spatialReference?.imageCoordinateSystem||Ka(t,i.spatialReference))return e;let r=sc(i,t);if(!r)throw new le("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:i,spatialReference:t});return qQ(e)?(e.targetGeometry=r,e):r}};function qQ(e){return e?.declaredClass==="esri.Viewpoint"}c([h({type:je})],ks.prototype,"center",null),c([h()],ks.prototype,"constraints",void 0),c([h({type:vi})],ks.prototype,"extent",null),c([h({value:{top:0,right:0,bottom:0,left:0},cast:e=>I({top:0,right:0,bottom:0,left:0},e)})],ks.prototype,"padding",null),c([h()],ks.prototype,"ready",void 0),c([h()],ks.prototype,"resizeAlign",void 0),c([h({readOnly:!0})],ks.prototype,"resolution",null),c([h({type:Number})],ks.prototype,"rotation",null),c([h({type:Number})],ks.prototype,"scale",null),c([h({readOnly:!0})],ks.prototype,"state",void 0),c([h({type:rr})],ks.prototype,"viewpoint",null),c([h({readOnly:!0})],ks.prototype,"visibleArea",null),c([h()],ks.prototype,"zoom",null),ks=c([w("esri.views.2d.ViewStateManager")],ks);function $d(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function df(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}var Fy=class extends Ge{constructor(t,i){super(!0),this._view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r,i))}_handleDoubleClick(t,i){$d(t.data,"primary")&&(t.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([t.data.x,t.data.y]):this._view.mapViewNavigation.zoomIn([t.data.x,t.data.y]))}};var kx=class extends Ge{constructor(t,i,r){super(!0),this.view=t,this.pointerType=i,this.registerIncoming("double-tap-drag",r,s=>this._handleDoubleTapDrag(s))}_handleDoubleTapDrag(t){let{data:i}=t,{pointerType:r}=i;if(r!==this.pointerType)return;t.stopPropagation();let{action:s,delta:n}=i,{view:o}=this,{mapViewNavigation:a}=o;switch(s){case"begin":{let{scale:l}=o;this._startScale=l,this._currentScale=l,this._previousDelta=n,a.begin();break}case"update":{if(this._previousDelta.y===n.y)return;this._previousDelta=n;let l=1.015**n.y,d=this._startScale*l,u=d/this._currentScale;a.setViewpointImmediate(u),this._currentScale=d;break}case"end":{let{constraints:l}=o,{effectiveLODs:d,snapToZoom:u}=l;if(!u||!d)return void a.end();let m=l.snapScale(this._currentScale),p=(n.y>0?Math.max(m,l.snapToPreviousScale(this._startScale)):Math.min(m,l.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(p).then(()=>{a.end()});break}}}};var Ho=class{constructor(t){this._callbacks=t,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(t){let i=t.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this._currentCount=0}this._previousEvent=t}_emitStart(t){this._startEvent=t,this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.start(this._currentCount,t,this._startEvent)}_emitUpdate(t){this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.update(this._currentCount,t,this._startEvent)}_emitEnd(t){this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.end(this._currentCount,t,this._startEvent),this._startEvent=null}};var Lx=class extends Ge{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(t){super.onInstall(t),this._dragEventSeparator=new Ho({start:(i,r)=>{this.view.mapViewNavigation.pan.begin(this.view,r.data),r.stopPropagation()},update:(i,r)=>{this.view.mapViewNavigation.pan.update(this.view,r.data),r.stopPropagation()},end:(i,r)=>{this.view.mapViewNavigation.pan.end(this.view,r.data),r.stopPropagation()},condition:(i,r)=>i===1&&$d(r.data,this.pointerAction)})}_handleDrag(t){let i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(t)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}};var Fx=class extends Ge{constructor(t,i,r){super(!0),this._view=t,this.pointerAction=i;let s=this._view.mapViewNavigation;this._dragEventSeparator=new Ho({start:(n,o)=>{s.rotate.begin(this._view,o.data),o.stopPropagation()},update:(n,o)=>{s.rotate.update(this._view,o.data),o.stopPropagation()},end:(n,o)=>{s.rotate.end(),o.stopPropagation()},condition:(n,o)=>n===1&&$d(o.data,this.pointerAction)}),this.registerIncoming("drag",r,n=>this._dragEventSeparator.handle(n))}};function Da(e){let t=e*e;return e<0&&(t*=-1),t}function G5(e){return e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0,e}function Ny(e,t,i){let r=i,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=Da(s.axes[0]),r.translation[1]=Da(s.axes[1]),r.translation[2]=Da(s.buttons[7])-Da(s.buttons[6]),r.heading=Da(s.axes[2]),r.tilt=Da(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*Da(s.axes[0]),r.translation[1]=1.2*Da(s.axes[1]),r.translation[2]=2*-Da(s.axes[2]),r.heading=1.2*Da(s.axes[5]),r.tilt=1.2*Da(s.axes[3])),r.tilt*=o,q(r.translation,r.translation,a),r}function pI(e,t){let i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function hf(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}var Nx=class extends Ge{constructor(t){super(!0),this._view=t,this._frameTask=null,this._watchHandles=new qa,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([T(()=>this._view.navigation.gamepad?.enabled,i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=As({update:r=>this._frameUpdate(r.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},ie)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(t){let i=this._view.navigation.gamepad.device;i&&t.data.device!==i||this._currentDevice&&this._currentDevice!==t.data.device||(t.data.action==="end"?(this._currentDevice=null,G5(this._transformation)):(this._currentDevice=t.data.device,Ny(t.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(t){let i=this._transformation;if(hf(i))return;let r=this._view.viewpoint.clone(),s=this._view.navigation.gamepad.velocityFactor,n=$Q*s*t;OV(r,r,[i.translation[0]*n,-i.translation[1]*n]);let o=1+i.translation[2]*ZQ*t,a=this._view.constraints.rotationEnabled?-i.heading*WQ*t:0,l=this._view.size,d=[l[0]/2,l[1]];PV(r,r,o,a,d,l);let u=this._view.constraints.constrain(r,this._view.viewpoint);this._view.viewpoint=u}},WQ=.06,$Q=.7,ZQ=6e-4;function uf(e){let t=()=>e(document.visibilityState==="visible");return document.addEventListener("visibilitychange",t),kr(()=>document.removeEventListener("visibilitychange",t))}var Vx=class extends Ge{constructor(t,i,r){super(!0),this.view=t,this.keys=i,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=s=>{let n=this._keyMap[s.data.key];if(s.modifiers.has("Meta")||s.modifiers.has("Control"))return void this._stopMovement();if(n==null)return;s.stopPropagation(),s.preventDefault();let o=s.type==="key-down";if(this._pressedKeys[o?"add":"delete"](n),o){if(this._direction===n)return;this._direction=n,this._isSticky=!1,this._setTimeout(()=>{this._isSticky&&this._handlePopKey()})}else{let a=this._timeout===void 0,l=this._pressedKeys.size>0;a||l?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),this._direction==null&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",r,this._handleKey),this.registerIncoming("key-up",r,this._handleKey),this.registerIncoming("blur",r,this._stopMovement),this._visibilityHandle=uf(s=>s?null:this._stopMovement())}onUninstall(){this._stopMovement(),this._visibilityHandle?.remove()}get _direction(){return this._currentDirection}set _direction(t){let i=this._currentDirection!=null;if(t!=null){if(i||this.view.mapViewNavigation.begin(),this._currentDirection!==t)switch(t){case"left":this.view.mapViewNavigation.continuousPanLeft();break;case"right":this.view.mapViewNavigation.continuousPanRight();break;case"up":this.view.mapViewNavigation.continuousPanUp();break;case"down":this.view.mapViewNavigation.continuousPanDown()}}else i&&this.view.mapViewNavigation.stop();this._currentDirection=t}_setTimeout(t){clearTimeout(this._timeout),this._timeout=t===void 0?void 0:setTimeout(()=>{this._timeout=void 0,t()},this._stickyKeyDuration)}};var Bx=class extends Ge{constructor(t,i,r){super(!0),this.view=t,this.keys=i,this._pressed=!1,this._keyToDirection={[i.clockwiseOption1]:"clockwise",[i.clockwiseOption2]:"clockwise",[i.counterClockwiseOption1]:"counterClockwise",[i.counterClockwiseOption2]:"counterClockwise",[i.resetOption1]:"reset",[i.resetOption2]:"reset"},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),this.registerIncoming("key-up",r,s=>this._handleKeyUp(s)),this.registerIncoming("blur",r,()=>this._handleStop()),this._visibilityHandle=uf(s=>s?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_handleKeyDown(t){t.data.repeat||this._handleKey(t,!0)}_handleKeyUp(t){this._handleKey(t,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(t,i){let r=t.modifiers;if(r.size>0&&!r.has("Shift")||!this.view.constraints.rotationEnabled)return;let s=this._keyToDirection[t.data.key];if(this._pressed=s!=null,this._pressed){if(t.preventDefault(),i)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continuousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continuousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();t.stopPropagation()}}};var mf;(function(e){e[e.IN=0]="IN",e[e.OUT=1]="OUT"})(mf||(mf={}));var zx=class extends Ge{constructor(t,i,r){super(!0),this.view=t,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),i.zoomIn.forEach(s=>this._keysToZoomAction[s]=mf.IN),i.zoomOut.forEach(s=>this._keysToZoomAction[s]=mf.OUT)}_handleKeyDown(t){this._handleKey(t)}_handleKey(t){let i=t.modifiers;if(i.size>0&&!i.has("Shift"))return;let{key:r}=t.data;if(!(r in this._keysToZoomAction))return;let s=this._keysToZoomAction[r],{mapViewNavigation:n}=this.view,o=null;switch(s){case mf.IN:o=n.zoomIn();break;case mf.OUT:o=n.zoomOut();break;default:return}n.begin(),o.then(()=>n.end()),t.stopPropagation()}};var QQ=.6,Ux=class extends Ge{constructor(t,i){super(!0),this._view=t,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(!this._view.navigation.mouseWheelZoomEnabled||(t.preventDefault(),t.stopPropagation(),!this._canZoom))return;let i=this._view.mapViewNavigation,{x:r,y:s,deltaY:n}=t.data,o=1/QQ**(1/60*n),a=i.zoom(o,[r,s]);a&&(this._canZoom=!1,a.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()}))}};var Hx=class extends Ge{constructor(t){super(!0),this.view=t,this.registerIncoming("drag",r=>this._handleDrag(r)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());let i=this.view.mapViewNavigation;this._dragEventSeparator=new Ho({start:(r,s)=>{i.pinch.begin(this.view,s.data),s.stopPropagation()},update:(r,s)=>{i.pinch.update(this.view,s.data),s.stopPropagation()},end:(r,s)=>{i.pinch.end(this.view),s.stopPropagation()},condition:r=>r>=2})}_handleDrag(t){this._dragEventSeparator.handle(t)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function fI(e){let t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value||1:0),axes:t.axes.map(i=>KQ(i,e.axisThreshold))}:{buttons:[],axes:[]}}function q5(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function W5(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function KQ(e,t){let i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}var jx=class{constructor(t,i){this._element=t,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{let o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,fI(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;let r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&($5(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this._callback=t}_connectGamepad(t){let i=new nf(t);i.deviceType!=="unknown"&&(this._inputDevices[t.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=As({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){let t=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!t||this._input.gamepad.enabledFocusMode==="view"&&!i;$5(s=>{let n=this._inputDevices[s.index];if(!n)return;let o=this._latestUpdate[s.index],a=fI(n),l=r||W5(a);o&&(o.timestamp===s.timestamp||!o.active&&l||q5(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_emitGamepadEvent(t,i,r){let s=this._latestUpdate[t.index],n=s&&s.active;if(!n&&!r)return;let o=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[t.index],state:i,action:o})}};function YQ(e){if(!e||!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}function $5(e){for(let t of navigator.getGamepads())YQ(t)&&e(t)}var Z5=Qe("edge"),XQ=Qe("chrome"),JQ=Qe("ff"),eK=Qe("safari"),Q5="esri-view-surface",pf={touchNone:`${Q5}--touch-none`,touchPan:`${Q5}--touch-pan`},Gx=(()=>{class e{constructor(i,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=i,i.getAttribute("tabindex")||i.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new jx(i,this._input),this._gamepadSource.onEvent=s=>this._callback("gamepad",s)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(i=>{this._releasePointerCaptureSafe(i)}),this._gamepadSource=z(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(i){this._browserTouchPanningEnabled=i,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(i){this._callback=i}set activeEvents(i){for(let r in this._active)if(!i||!i.has(r)){let s=this._active[r];this._element.removeEventListener(gI[r],s),delete this._active[r]}i&&i.forEach(r=>{if(!this._active[r]&&gI[r]){let s=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(gI[r],s),this._active[r]=s}}),this._gamepadSource.hasEventListeners=i?.has("gamepad")??!1}setPointerCapture(i,r){r?this._setPointerCatpureSafe(i.pointerId):(this._releasePointerCaptureSafe(i.pointerId),this._activePointerCaptures.delete(i.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?pf.touchNone:pf.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?pf.touchPan:pf.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(pf.touchNone),this._element.classList.remove(pf.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(i){try{this._element.setPointerCapture(i),this._activePointerCaptures.add(i)}catch{}}_releasePointerCaptureSafe(i){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(i))return;this._element.releasePointerCapture(i)}catch{}}_updateNormalizedPointerLikeEvent(i,r){let s=fV(this._element,i);return e.test.disableSubpixelCoordinates&&(s.x=Math.round(s.x),s.y=Math.round(s.y)),r.x=s.x,r.y=s.y,r}_handleKey(i,r){let{key:s}=r;s&&i==="key-up"&&this._keyDownState.delete(s);let n={native:r,key:s,repeat:!!s&&this._keyDownState.has(s)};s&&i==="key-down"&&this._keyDownState.add(n.key),this._callback(i,n)}_handlePointer(i,r){let s=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(i,s)}_handlePointerPreventDefault(i,r){let s=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(i,s)}_getDeltaFromTrackpadOrMouseWheel(i){return i.shiftKey&&Qe("mac")&&i.deltaY===0?i.deltaX:i.deltaY}_handleMouseWheel(i,r){let s=this._getDeltaFromTrackpadOrMouseWheel(r);switch(r.deltaMode){case 0:Z5&&(s=s/document.documentElement.clientHeight*600);break;case 1:s*=30;break;case 2:s*=900}Z5?s*=.7:XQ||eK?s*=.6:JQ&&(s*=1.375);let n=100,o=Math.abs(s);o>n&&(s=s/o*200/(1+Math.exp(-.02*(o-n))));let a=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:s});this._callback(i,a)}_handlePointerCaptureLost(i,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(i,r)}_handleDefault(i,r){let s={native:r};r.preventDefault(),this._callback(i,s)}_preventAltKeyDefault(i){i.key==="Alt"&&i.preventDefault()}_preventMultiTouchPanning(i){i.touches.length>1&&i.preventDefault()}}return e.test={disableSubpixelCoordinates:!1},e})(),gI={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};var ff=class extends Ge{constructor(){super(!0),this.registerIncoming("context-menu",t=>t.data.native.preventDefault())}};var Hr={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function Du(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function K5(e,t){let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function Y5(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:vr()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){let[S,C]=e,[E,R]=[C.x-S.x,C.y-S.y];return t.radius=Math.sqrt(E*E+R*R)/2,t.center.x=(S.x+C.x)/2,t.center.y=(S.y+C.y)/2,t}let i=0,r=0;for(let S=0;S<e.length;S++)i+=e[S].x,r+=e[S].y;i/=e.length,r/=e.length;let s=e.map(S=>S.x-i),n=e.map(S=>S.y-r),o=0,a=0,l=0,d=0,u=0,m=0,p=0;for(let S=0;S<s.length;S++){let C=s[S],E=n[S],R=C*C,D=E*E;o+=R,a+=D,l+=C*E,d+=R*C,u+=D*E,m+=C*D,p+=E*R}let f=.5*(d+m),g=.5*(u+p),_=o*a-l*l,y=(f*a-g*l)/_,v=(o*g-l*f)/_,x=vr(y+i,v+r);return{radius:Math.sqrt(y*y+v*v+(o+a)/e.length),center:x}}function bl(e){let{native:t}=e,{pointerId:i,button:r,pointerType:s}=t;return s==="mouse"?`${i}:${r}`:`${s}`}var qx=class extends Ge{constructor(t=Hr.maximumDoubleClickDelay,i=Hr.maximumDoubleClickDistance,r=Hr.maximumDoubleTouchDelay,s=Hr.maximumDoubleTouchDistance,n=Wa){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=vr(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new Ho({start:(o,a)=>this._dragStart(o,a),update:(o,a)=>this._dragUpdate(a),end:(o,a)=>this._dragEnd(a)}),this.registerIncoming("drag",o=>this._dragEventSeparator.handle(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(t=>{t.doubleTapTimeout=Nt(t.doubleTapTimeout)})}get hasPendingInputs(){for(let t of this._pointerState.values())if(t.doubleTapTimeout!=null)return!0;return!1}_clearPointerDown(t){let i=this._pointerState.get(t);i&&(i.doubleTapTimeout=Nt(i.doubleTapTimeout),this._pointerState.delete(t),this.refreshHasPendingInputs())}_dragStart(t,i){if(!this._doubleTapDragReady||t!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;let{data:r,modifiers:s}=i,{center:n}=r;this._dragStartCenter=n;let o=_I("begin",vr(0,0),r);this._doubleTapDrag.emit(o,void 0,s),i.stopPropagation()}_dragUpdate(t){if(!this._doubleTapDragActive)return;let{data:i,modifiers:r}=t,{center:s}=i,n=_I("update",vr(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(n,void 0,r),t.stopPropagation()}_dragEnd(t){if(!this._doubleTapDragActive)return;let{data:i,modifiers:r}=t,{center:s}=i,n=_I("end",vr(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(n,void 0,r),this._doubleTapDragActive=!1,t.stopPropagation()}_handlePointerDown(t){let{data:i}=t,r=bl(i),s=this._pointerState.get(r),{pointerType:n}=i.native;if(s){let o=n==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(r),Du(s.event.data,i)>o?this._storePointerDown(t):this._doubleTapDragReady=!0}else this._storePointerDown(t)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(t){let{data:i}=t,{pointerType:r}=i.native,s=bl(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._clearPointerDown(s),n);this._pointerState.set(s,{event:t,doubleTapTimeout:o}),this.refreshHasPendingInputs()}};function _I(e,t,i){let{button:r,buttons:s,pointer:n,pointers:o,pointerType:a,timestamp:l}=i;return{action:e,delta:t,button:r,buttons:s,pointer:n,pointers:o,pointerType:a,timestamp:l}}var gf=class extends Ge{constructor(t){super(!1),this._navigationTouch=t,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,s){return{action:t,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:tK(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){let i=t.native.pointerId,r=Wx(this._activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);let n=$x(s,J5(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;let i=t.native.pointerId,r=this._activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){let i=Wx(this._activePointerMap).angle;this._activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){let i=Wx(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=$x(r,i)-t,r.lastAngle=$x(r,i)-t})}_emitEvent(t,i,r){let s=Wx(this._activePointerMap);this._drag.emit(this._createPayload(t,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(t){let i=t.data.native.pointerId,r=t.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(t.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){let i=t.data,r=i.currentEvent,s=t.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=t.data.startEvent.pointerType,this._mouseButton=t.data.startEvent.button,this._startStateModifiers=t.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function J5(e){let t=[];return e.forEach(i=>{t.push(vr(i.event.x,i.event.y))}),Y5(t)}function Wx(e){let t=J5(e),i=0;return e.forEach(r=>{let s=$x(r,t),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;let o=s-r.initialAngle;i+=o}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function tK(e){let t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function $x(e,t){let i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var X5;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(X5||(X5={}));var _f=class extends Ge{constructor(t=Hr.maximumDoubleClickDelay,i=Hr.maximumDoubleClickDistance,r=Hr.maximumDoubleTouchDelay,s=Hr.maximumDoubleTouchDistance,n=Wa){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){let i=t.data,r=bl(i);if(!this._pointerState.has(r)){let s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(t){let i=t.data,r=bl(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){let n=s.immediateDoubleClick,o=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),Du(n,t.data)>o?this._startImmediateDoubleClick(t,s):(this._immediateDoubleClick.emit(t.data,void 0,n.modifiers),this._removeState(i))):Du(s,t.data)>o?this._removeState(i):this._startImmediateDoubleClick(t,s)}}_startImmediateDoubleClick(t,i){let r=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_removeState(t){let i=bl(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}};var yf=class extends Ge{constructor(t=Hr.maximumClickDelay,i=Hr.movementUntilMouseDrag,r=Hr.movementUntilPenDrag,s=Hr.movementUntilTouchDrag,n=Hr.holdDelay,o=Wa){super(!1),this._maximumClickDelay=t,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",a=>this._handlePointerDown(a)),this.registerIncoming("pointer-up",a=>this._handlePointerLoss(a,"pointer-up")),this.registerIncoming("pointer-capture-lost",a=>this._handlePointerLoss(a,"pointer-capture-lost")),this.registerIncoming("pointer-cancel",a=>this._handlePointerLoss(a,"pointer-cancel")),this._moveHandle=this.registerIncoming("pointer-move",a=>this._handlePointerMove(a)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout=Nt(t.holdTimeout)}),super.onUninstall()}_handlePointerDown(t){let i=t.data,r=i.native.pointerId,s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{let o=this._pointerState.get(r);if(o){if(!o.isDragging){let a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));let n={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_handlePointerMove(t){let i=t.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(Zx("update",s,i),void 0,s.modifiers):K5(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),s.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(t){let i=t.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(Zx("start",s,i)):this._pointerDrag.emit(Zx("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){let r=t.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(Zx("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&t.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function Zx(e,t,i){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:i}}var vf=class extends Ge{constructor(t=Hr.maximumDoubleClickDelay,i=Hr.maximumDoubleClickDistance,r=Hr.maximumDoubleTouchDelay,s=Hr.maximumDoubleTouchDistance,n=Wa){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",o=>this._handleImmediateClick(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimer=Nt(t.doubleClickTimer))}get hasPendingInputs(){for(let t of this._pointerState.values())if(t.doubleClickTimer!=null)return!0;return!1}_clearDoubleClickTimer(t,i){let r=this._pointerState.get(t);r&&(r.doubleClickTimer=Nt(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){let i=this._pointerState.get(t);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}_handleImmediateClick(t){let i=t.data,{pointerType:r}=i.native,s=iK(i);if(!this._pointerState.has(s))return void this._startClick(t);let n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Du(o,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(t)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(t){let i=bl(t.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(t){let{data:i}=t,{native:{pointerType:r}}=i,s=bl(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n);this._pointerState.set(s,{event:t,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}};function iK(e){let{pointerId:t,pointerType:i,button:r}=e.native;return i==="mouse"?`${t}:${r}`:`${i}`}var Qx={counter:"Control",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"}},Pu=class extends k{initialize(){let e=()=>this.view?.ready;this.addHandles([_r(()=>!e(),()=>this._disconnect()),_r(e,()=>this._connect())])}destroy(){this._disconnect()}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_disconnect(){this.view.viewEvents.disconnect(),this._inputManager=z(this._inputManager)}_connect(){let e=this.view.surface,t=new Gx(e,this.view.input),i=[new _f,new yf,new vf,new gf(this.view.navigation),new qx],r=new k0({eventSource:t,recognizers:i});r.installHandlers("prevent-context-menu",[new ff],ul.INTERNAL),r.installHandlers("navigation",[new Hx(this.view),new Nx(this.view),new Ux(this.view),new Fy(this.view),new Fy(this.view,[Qx.counter]),new Lx(this.view,"primary"),new Vx(this.view,Qx.pan),new zx(this.view,Qx.zoom),new Bx(this.view,Qx.rotate),new Fx(this.view,"secondary"),new kx(this.view,"touch")],ul.INTERNAL),this.view.viewEvents.connect(r),this._source=t,this._inputManager=r,T(()=>this.view?.navigation?.browserTouchPanEnabled,s=>{this._source&&(this._source.browserTouchPanningEnabled=!s)},ie)}get test(){}};c([h()],Pu.prototype,"view",void 0),c([h()],Pu.prototype,"latestPointerType",null),c([h()],Pu.prototype,"latestPointerLocation",null),c([h()],Pu.prototype,"multiTouchActive",null),Pu=c([w("esri.views.2d.input.MapViewInputManager")],Pu);var ej=Pu;var Ou={added:[],removed:[]},yI=new Set,rK=new c0(0,0,0,0);function sK(e,t){let i=_L(t);if(!i)return null;let[r,s]=i.valid;return e[2]>s?[ii([e[0],e[1],s,e[3]]),ii([r,e[1],r+e[2]-s,e[3]])]:e[0]<r?[ii([r,e[1],e[2],e[3]]),ii([s-(r-e[0]),e[1],s,e[3]])]:null}var Kx=class extends ti{constructor(t){super(),this._tiles=new Map,this._index=hF(9,Qe("esri-csp-restrictions")?i=>({minX:i.bounds[0],minY:i.bounds[1],maxX:i.bounds[2],maxY:i.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=t}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(t){return this._tiles.has(t)}get(t){return this._tiles.get(t)}getIntersectingTiles(t){if(!t||bo(t)===0||ic(t)===0)return[];let i=sK(t,this.tileScheme.spatialReference);return i!=null?[...new Set([...this.boundsIntersections(i[0]),...this.boundsIntersections(i[1])])]:this.boundsIntersections(t)}boundsIntersections(t){return this._index.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]})}updateTiles(t){let i={added:[],removed:[]};for(let r of t.added)if(!this.has(r)){let s=new tE(this.tileScheme,r);this._tiles.set(r,s),this._index.insert(s),i.added.push(s)}for(let r of t.removed)if(this.has(r)){let s=this.get(r);this._tiles.delete(r),this._index.remove(s),i.removed.push(s)}this.tiles.length=0,this._tiles.forEach(r=>this.tiles.push(r)),(i.added.length||i.removed.length)&&this.emit("update",i)}setViewState(t){let i=this.tileScheme.getTileCoverage(t,0);if(!i)return;let{spans:r,lodInfo:s}=i,{level:n}=s;if(r.length>0)for(let{row:o,colFrom:a,colTo:l}of r)for(let d=a;d<=l;d++){let u=rK.set(n,o,s.normalizeCol(d),s.getWorldForColumn(d)).id;if(yI.add(u),!this.has(u)){let m=new tE(this.tileScheme,u);this._tiles.set(u,m),this._index.insert(m),this.tiles.push(m),Ou.added.push(m)}}for(let o=this.tiles.length-1;o>=0;o--){let a=this.tiles[o];yI.has(a.id)||(this._tiles.delete(a.id),this.tiles.splice(o,1),this._index.remove(a),Ou.removed.push(a))}(Ou.added.length||Ou.removed.length)&&this.emit("update",Ou),X2.pool.release(i),yI.clear(),Ou.added.length=0,Ou.removed.length=0}};function rj(e,t,i){return P(this,null,function*(){let r=hu(t)?du(e,t):t;if(!e.ready||isNaN(r.x)||isNaN(r.y))return{screenPoint:r,results:[]};let s=new Set,n=new Set,o=!1,a=null,l=null;i?.include?ij(i.include,tj(e,p=>{s.add(p),vI(p,f=>n.add(f))},(p,f)=>{n.add(p),s.add(f)},p=>{a||(a=new Set),a.add(p)},p=>s.add(p),()=>o=!0)):(o=!0,s=new Set(e.allLayerViews),s.forEach(p=>{vI(p,f=>n.add(f))})),i?.exclude&&ij(i.exclude,tj(e,p=>{s.delete(p),vI(p,f=>n.delete(f))},p=>n.delete(p),p=>{l||(l=new Set),l.add(p)}));let d=e.toMap(r),u=e.allLayerViews.filter(p=>!p.suspended&&s.has(p)&&p.clips.every(f=>z0(e,f,r,d))).reverse(),m=[...o?e.graphicsView.hitTest(d).map(p=>({type:"graphic",graphic:p,layer:null,mapPoint:d})):[],...yield Promise.all(u.map(p=>p.hitTest(d,r)).toArray())].filter(Rs).flat().filter(Rs);return m=m.filter(p=>p.type!=="graphic"||p.layer?.type!=="subtype-group"||n.has(p.graphic.layer)),a&&(m=m.filter(p=>!("graphic"in p)||!p.graphic||a?.has(bI(p.graphic)))),l&&(m=m.filter(p=>!("graphic"in p)||!p.graphic||!l?.has(bI(p.graphic)))),{screenPoint:r,results:m}})}function tj(e,t,i,r,s,n){return o=>{if(o instanceof ga){if(o.layer===e)n?.();else{let a=e.allLayerViews.find(l=>l.layer===o.layer);a&&s?.(a)}r(bI(o))}else if(!("layer"in o&&"element"in o))if(o.type==="subtype-sublayer"){let a=e.allLayerViews.find(l=>l.layer===o.parent);a&&i(o,a)}else{let a=e.allLayerViews.find(l=>l.layer===o);a&&t(a)}}}function ij(e,t){if(e)if(SM(e))for(let i of e)if(SM(i))for(let r of i)t(r);else t(i);else t(e)}function bI(e){let t=e.getObjectId();return t?`${e.layer?.uid??e.sourceLayer?.uid??"MapView"}/${t}`:`"MapView/${e.uid}`}function vI({layer:e},t){e?.type==="subtype-group"&&e.sublayers.forEach(i=>{t(i)})}var sj={flipY:!0,premultipliedAlpha:!0};function nj(e,t){return P(this,null,function*(){let i=yield aj(e,t),{format:r,quality:s}=HV(t?.format,t?.quality);return zV(i,{format:r,quality:s},sj)})}function oj(e,t){return P(this,null,function*(){let i=yield aj(e,t);return UV(i,sj)})}function aj(e,t){let i=aK(t||{},oK(e.stage,e.size),e.size,e.padding),r=nK(t,e.allLayerViews);return e.stage.takeScreenshot(i,r,e.backgroundColor,t?.rotation)}function nK(e={},t){if(!e.layers)return;let i=[];return e.layers.forEach(r=>{let s=t.find(n=>n.layer.id===r.id);s?.container&&i.push(s.container)}),i}function oK(e,t){return Math.min(4,jV(t,Math.min(4096,e.context.parameters.maxTextureSize)))}function aK(e,t,i,r){e.ignorePadding&&(r={left:0,right:0,top:0,bottom:0});let s=null;e.width!=null&&e.height!=null?s=[e.width,e.height]:e.width==null&&e.height!=null?s=[e.height,e.height]:e.width!=null&&e.height==null?s=[e.width,e.width]:e.width==null&&e.height==null&&(s=null);let n=i[0]-(r.left+r.right),o=i[1]-(r.top+r.bottom),a,l,d=e.area||{x:0,y:0,width:n,height:o};if(s){let u=n/o,m=s[0]/s[1];if(m>u){let p=d.width/m;d={x:d.x,y:Math.round(d.y+(d.height-p)/2),width:d.width,height:Math.round(p)}}else{let p=d.height*m;d={x:Math.round(d.x+(d.width-p)/2),y:d.y,width:Math.round(p),height:d.height}}}else s=[d.width,d.height];return s[0]>d.width?(a=Math.min(s[0]/d.width,t),l=s[0]/d.width/a):(a=1,l=s[0]/d.width),{cropArea:{x:Math.round((d.x+r.left)*a),y:Math.round((d.y+r.top)*a),width:Math.round(d.width*a),height:Math.round(d.height*a)},outputScale:l,resolutionScale:a}}var lj=160,bf=class extends k{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),this._timer==null&&(this._timer=setInterval(()=>{performance.now()-this._timestamp>=lj&&this.clear()},lj))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};c([h()],bf.prototype,"_timer",void 0),c([h()],bf.prototype,"stationary",null),bf=c([w("esri.views.2d.support.StationaryManager")],bf);function Yx(e){let t=VN();return t.available?e==="3d"&&t.majorPerformanceCaveat?new le("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?null:new le("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new le("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new le("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function lK(e){return e&&"nodeType"in e}function cK(e){return e&&typeof e.render=="function"}var cj={component:"esri-component"},ku=class extends k{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){let t=this._get("node");e!==t&&(e&&e.classList.add(cj.component),t&&t.classList.remove(cj.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||lK(e)?(this._set("widget",null),Lm(e)):(cK(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};c([h()],ku.prototype,"id",null),c([h()],ku.prototype,"node",null),c([Lr("node")],ku.prototype,"castNode",null),c([h({readOnly:!0})],ku.prototype,"widget",void 0),ku=c([w("esri.views.ui.Component")],ku);var Zd=ku;var dK={left:0,top:0,bottom:0,right:0},dj={bottom:30,top:15,right:15,left:15},Tc="esri-ui",Ln={ui:Tc,corner:`${Tc}-corner`,innerContainer:`${Tc}-inner-container`,manualContainer:`${Tc}-manual-container`,cornerContainer:`${Tc}-corner-container`,topLeft:`${Tc}-top-left`,topRight:`${Tc}-top-right`,bottomLeft:`${Tc}-bottom-left`,bottomRight:`${Tc}-bottom-right`};function hK(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function Xx(e){return e===0?"0":`${e}px`}function wI(e){let t=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(t===null||t===Object.prototype)&&("component"in e||"index"in e||"position"in e)?e:null}function xI(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}var wl=class extends ti.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=oL(),this.view=null,this._applyViewPadding=()=>{let t=this.container;t&&xI(t,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{let t=this._innerContainer;t&&xI(t,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([T(()=>[this.view?.padding,this.container],this._applyViewPadding,ie),T(()=>this.padding,this._applyUIPadding,ie),T(()=>[this.container,this._locale],([e,t])=>{e&&e.setAttribute("lang",t)},ie),km(e=>{this._locale=e})])}destroy(){this.container=null;for(let e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){let t=this._get("container");e!==t&&(e&&(e.classList.add(Ln.ui),pL(e),this._attachContainers(e)),t&&(t.classList.remove(Ln.ui),xI(t,{top:"",bottom:"",left:"",right:""}),t.textContent=""),this._set("container",e))}get height(){let e=this.view?.height??0;if(e===0)return e;let t=this._getViewPadding(),{top:i,bottom:r}=t;return Math.max(e-i-r,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:I(I({},dj),e)}get width(){let e=this.view?.width??0;if(e===0)return e;let t=this._getViewPadding(),{left:i,right:r}=t;return Math.max(e-i-r,0)}add(e,t){let i,r,s;if(Array.isArray(e))return void e.forEach(o=>this.add(o,t));let n=wI(e);n&&({index:i,position:t,component:e,key:r}=n),t&&typeof t=="object"&&({index:i,key:r,position:t,internal:s}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r,s)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(r=>this.remove(r,t));let i=this._find(e);if(i){if(this._componentMap.has(i)&&this._componentMap.get(i)?.key!==t)return;let r=this._components.indexOf(i);return i.node.parentNode?.removeChild(i.node),this._componentMap.delete(i),i.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(r,1)[0]}}empty(e,t={removeInternal:!1}){if(Array.isArray(e)){for(let s of e)this.empty(s,t);return}let i=this._positionNameToContainerLookup[e??"manual"],r=Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(s=>s==null?!1:!(this._componentMap.get(s)?.internal??!1)||t.removeInternal);for(let s of r)this.remove(s)}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let i,r=wI(e)||wI(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;let s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;let t=this._findById(e);return t&&(t.widget||t.node)}getComponents(e,t={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(i=>this._getComponentsAtPosition(i,t)):this._getComponentsAtPosition(e,t):this._components.filter(i=>t.includeInternal||!this._componentMap.get(i)?.internal).map(({widget:i,node:r})=>i??r)}getPosition(e){for(let t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r,s){e instanceof Zd||(e=new Zd({node:e}));let{widget:n}=e;n!=null&&n instanceof k&&n.addHandles(kr(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:t,index:i}),this._components.push(e),this._componentMap.set(e,{key:r,internal:s})}_find(e){return e?e instanceof Zd?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??dK}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){let e=document.createElement("div");e.classList.add(Ln.innerContainer,Ln.cornerContainer);let t=document.createElement("div");t.classList.add(Ln.innerContainer,Ln.manualContainer);let i=document.createElement("div");i.classList.add(Ln.topLeft,Ln.corner),e.appendChild(i);let r=document.createElement("div");r.classList.add(Ln.topRight,Ln.corner),e.appendChild(r);let s=document.createElement("div");s.classList.add(Ln.bottomLeft,Ln.corner),e.appendChild(s);let n=document.createElement("div");n.classList.add(Ln.bottomRight,Ln.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;let o=r_();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup=I({manual:t},this._cornerNameToContainerLookup)}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){let t=e.position??"manual",{component:i,index:r}=e,s=this._positionNameToContainerLookup[t],n=r!=null&&r>-1;if(hK(i.widget)&&i.widget.startup(),!n)return void s.appendChild(i.node);let o=Array.from(s.children);if(r===0){let{firstChild:l}=s;return void(l?l.parentNode?.insertBefore(i.node,l):s.appendChild(i.node))}if(r>=o.length)return void s.appendChild(i.node);let a=o[r];a.parentNode?.insertBefore(i.node,a)}_toPixelPosition(e){return{top:Xx(e.top),left:Xx(e.left),right:Xx(e.right),bottom:Xx(e.bottom)}}_findByComponent(e){return this._components.find(t=>t===e)??null}_findById(e){return this._components.find(({id:t})=>t===e)??null}_findByNode(e){return this._components.find(({node:t})=>t===e)??null}_getComponentsAtPosition(e,t){let i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(r=>this._findByNode(r)).filter(Rs).filter(r=>t.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:s})=>r??s)}};c([h()],wl.prototype,"_locale",void 0),c([h()],wl.prototype,"container",null),c([h()],wl.prototype,"height",null),c([h({value:dj})],wl.prototype,"padding",null),c([Lr("padding")],wl.prototype,"castPadding",null),c([h()],wl.prototype,"view",void 0),c([h()],wl.prototype,"width",null),wl=c([w("esri.views.ui.UI")],wl);var hj=wl;function uj(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function uK(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function Vy(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function mK(e){return e.type==="bing-maps"}var Mc=[],wf=class extends k{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new qe,this.view=null,this._allLayerViewsChange=t=>{this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");let i=this.view?.allLayerViews;i&&(this.addHandles(i.map(r=>T(()=>[r.suspended,r.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),i.forEach(r=>{r.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(r.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),t?.removed&&t.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.addHandles([xi(()=>this.view?.allLayerViews,"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),_r(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){let e=this.view,t=e?.allLayerViews;if(Mc.length=0,!e||!t)return void this._clear();t.forEach(r=>{if(r.suspended||!r.layer?.attributionVisible)return;let s=r.layer;if(uj(s,"user"))return void Vy(Mc,r,s.copyright);if(s.hasAttributionData){if(this._fetchedAttributionData.has(r)){let o=this._fetchedAttributionData.get(r);return void(o?Vy(Mc,r,this._getDynamicAttribution(o,e,s)):uj(s)&&Vy(Mc,r,s.copyright))}return void this._fetchAttributionData(r)}let n="portalItem"in s?s.portalItem?.accessInformation:void 0;Vy(Mc,r,n||s.copyright)});let i=t.find(r=>r.layer?.type==="integrated-mesh-3dtiles");if(this.view&&i){let r=dB(this.view);if(r){let s=r.getAttributionText();for(let n=0;n<s.length;++n)Vy(Mc,i,s[n])}}uK(this.items,Mc)&&(this.items.removeAll(),this.items.addMany(Mc)),Mc.length=0,this.notifyChange("state")}_fetchAttributionData(e){return P(this,null,function*(){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);let t=yield i_(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){let i=t.ok?this._createContributionIndex(t.value,mK(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()})}_createContributionIndex(e,t){let i=e.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){let n=i[s],o=n.coverageAreas;if(!o)return;for(let a of o){let l=a.bbox,d=a.zoomMin-(t&&a.zoomMin?1:0),u=a.zoomMax-(t&&a.zoomMax?1:0),m=new vi({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:gt.WGS84}),p={extent:Bb(m),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let f=d;f<=u;f++)r[f]??=[],r[f].push(p)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){let{extent:r,scale:s}=t,n=i.tileInfo?.scaleToZoom(s)??0;if(n=Math.min(e.maxKey??0,Math.round(n)),!r||n==null||n<=-1)return"";let o=e[n],a=xL(r.center.clone().normalize(),gt.WebMercator),l=new Set;return o?o.filter(d=>{let u=d.id,m=!l.has(u)&&a&&d.extent&&zb(d.extent,a);return m&&l.add(u),m}).sort((d,u)=>u.score-d.score||d.objectId-u.objectId).map(d=>d.attribution).join(", "):""}};c([h({readOnly:!0,type:qe})],wf.prototype,"items",void 0),c([h({readOnly:!0})],wf.prototype,"state",null),c([h()],wf.prototype,"view",void 0),wf=c([w("esri.widgets.Attribution.AttributionViewModel")],wf);var CI=wf;var xf="esri-attribution",Cf={base:xf,poweredBy:`${xf}__powered-by`,sources:`${xf}__sources`,open:`${xf}--open`,sourcesOpen:`${xf}__sources--open`,link:`${xf}__link`},yn=class extends Jr{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:r})=>this._checkSourceTextOverflow(r))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new CI}initialize(){this.addHandles(xi(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){let e={[Cf.open]:this._isOpen};return A("div",{bind:this,class:this.classes(Cf.base,st.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return A("div",{class:Cf.poweredBy},"Powered by"," ",A("a",{class:Cf.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){let e=this._isOpen,t=this._isInteractive,i=t?0:void 0,{attributionText:r}=this,s={[Cf.sourcesOpen]:e,[st.interactive]:t};return A("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Cf.sources,s),innerHTML:r,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1,{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>r,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){let a=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};c([h()],yn.prototype,"_isOpen",void 0),c([h()],yn.prototype,"_isInteractive",null),c([h()],yn.prototype,"_attributionTextOverflowed",void 0),c([h()],yn.prototype,"_prevSourceNodeHeight",void 0),c([h({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],yn.prototype,"attributionText",null),c([h()],yn.prototype,"icon",null),c([h()],yn.prototype,"itemDelimiter",void 0),c([h()],yn.prototype,"label",null),c([h(),yr("esri/widgets/Attribution/t9n/Attribution")],yn.prototype,"messages",void 0),c([h()],yn.prototype,"view",null),c([h({type:CI})],yn.prototype,"viewModel",void 0),c([cu()],yn.prototype,"_toggleState",null),yn=c([w("esri.widgets.Attribution")],yn);var mj=yn;function pj(e){return e?.spatialReference?.isWebMercator||e?.spatialReference?.isGeographic||!1}var Lu=class extends N0(k){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(T(()=>this.view,this._updateRotationWatcher,ie))}destroy(){this.view=null}get canShowNorth(){return pj(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&(this.view?.type==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:KV()}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;let t=-e.heading;this._set("orientation",{x:0,y:0,z:t})}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?T(()=>e?.rotation,this._updateForRotation,ie):T(()=>e?.camera,this._updateForCamera,ie))}};c([h({readOnly:!0})],Lu.prototype,"canShowNorth",null),c([h({readOnly:!0})],Lu.prototype,"orientation",void 0),c([h({readOnly:!0})],Lu.prototype,"state",null),c([h()],Lu.prototype,"view",void 0),Lu=c([w("esri.widgets.Compass.CompassViewModel")],Lu);var SI=Lu;var fj="esri-compass",TI={base:fj,iconContainer:`${fj}__icon-container`};var Ec=class extends Jr{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new SI,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=i=>({transform:`rotateZ(${i.z}deg)`})}loadDependencies(){return Fm({button:()=>import("./chunk-DNI5Y472.js"),icon:()=>import("./chunk-7ENH7JJJ.js")})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){let{orientation:e,state:t}=this.viewModel,{messages:i}=this;return A("div",{class:this.classes(TI.base,st.widget)},A("calcite-button",{class:st.widgetButton,disabled:t==="disabled",kind:"neutral",label:i.reset,onclick:this._reset,round:!0,scale:"s",title:i.reset},A("div",{"aria-hidden":"true",class:TI.iconContainer,title:i.reset},A("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};c([h()],Ec.prototype,"goToOverride",null),c([h()],Ec.prototype,"icon",null),c([h()],Ec.prototype,"label",null),c([h(),yr("esri/widgets/Compass/t9n/Compass")],Ec.prototype,"messages",void 0),c([h()],Ec.prototype,"view",null),c([h({type:SI})],Ec.prototype,"viewModel",void 0),Ec=c([w("esri.widgets.Compass")],Ec);var Jx=Ec;var gj="esri-navigation-toggle",MI={base:gj,isLayoutHorizontal:`${gj}--horizontal`};var Sf=class extends k{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(_r(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._setNavigationMode()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_setNavigationMode(){let e=this.view?.inputManager;e&&(e.primaryDragAction=this._navigationMode==="pan"?"pan":"rotate")}};c([h({readOnly:!0})],Sf.prototype,"state",null),c([h()],Sf.prototype,"_navigationMode",void 0),c([h()],Sf.prototype,"view",void 0),Sf=c([w("esri.widgets.NavigationToggle.NavigationToggleViewModel")],Sf);var EI=Sf;var Rc=class extends Jr{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new EI,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{let i=this.viewModel?.navigationMode==="pan"?this._rotateButton:this._panButton;mL(i),this.toggle()}}loadDependencies(){return Fm({button:()=>import("./chunk-DNI5Y472.js")})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){let e=this.viewModel?.state==="disabled",t=this.viewModel?.navigationMode==="pan",i=this.messages.toggle;return A("div",{class:this.classes(MI.base,st.widget,{[MI.isLayoutHorizontal]:this.layout==="horizontal"})},A("calcite-button",{afterCreate:r=>{this._panButton=r},appearance:t?"outline-fill":"solid",class:st.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:i,onclick:this._toggle,tabIndex:t?void 0:-1,title:i}),A("calcite-button",{afterCreate:r=>{this._rotateButton=r},appearance:t?"solid":"outline-fill",class:st.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:i,onclick:this._toggle,tabIndex:t?-1:void 0,title:i}))}};c([h()],Rc.prototype,"icon",null),c([h()],Rc.prototype,"label",null),c([h({value:"vertical"})],Rc.prototype,"layout",null),c([h(),yr("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Rc.prototype,"messages",void 0),c([h()],Rc.prototype,"view",null),c([h({type:EI})],Rc.prototype,"viewModel",void 0),Rc=c([w("esri.widgets.NavigationToggle")],Rc);var _j=Rc;var Fu=class extends k{get canZoomIn(){if(!this.view?.ready)return!1;let t=this.view?.constraints?.effectiveMaxScale;return t===0||this._scale>t}get canZoomOut(){let{view:e}=this;if(!e?.ready)return!1;let i=e.constraints?.effectiveMinScale;return i===0||this._scale<i}get _scale(){let e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};c([h({readOnly:!0})],Fu.prototype,"canZoomIn",null),c([h({readOnly:!0})],Fu.prototype,"canZoomOut",null),c([h()],Fu.prototype,"view",void 0),c([h()],Fu.prototype,"_scale",null),Fu=c([w("esri.widgets.Zoom.ZoomConditions2D")],Fu);var yj=Fu;var Tf=class extends k{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};c([h({readOnly:!0})],Tf.prototype,"canZoomIn",null),c([h({readOnly:!0})],Tf.prototype,"canZoomOut",null),c([h()],Tf.prototype,"view",void 0),Tf=c([w("esri.widgets.Zoom.ZoomConditions3D")],Tf);var vj=Tf;var Qd=class extends k{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new yj({view:e}):e.type==="3d"&&(this._zoomConditions=new vj({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;let e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():Jg(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;let e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():Jg(e.goTo({zoomFactor:.5}))}};c([h()],Qd.prototype,"_zoomConditions",void 0),c([h()],Qd.prototype,"canZoomIn",null),c([h()],Qd.prototype,"canZoomOut",null),c([h({readOnly:!0})],Qd.prototype,"state",null),c([h()],Qd.prototype,"view",null),Qd=c([w("esri.widgets.Zoom.ZoomViewModel")],Qd);var RI=Qd;var bj={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"},Ac=class extends Jr{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new RI,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return Fm({button:()=>import("./chunk-DNI5Y472.js")})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){let e={[bj.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:t,canZoomOut:i}=this.viewModel,{zoomIn:r,zoomOut:s}=this.messages;return A("div",{class:this.classes(bj.base,st.widget,e)},A("calcite-button",{class:st.widgetButton,disabled:!t,iconStart:"plus",kind:"neutral",label:r,onclick:this.zoomIn,title:r}),A("calcite-button",{class:st.widgetButton,disabled:!i,iconStart:"minus",kind:"neutral",label:s,onclick:this.zoomOut,title:s}))}};c([h()],Ac.prototype,"icon",null),c([h()],Ac.prototype,"label",null),c([h({value:"vertical"})],Ac.prototype,"layout",null),c([h(),yr("esri/widgets/Zoom/t9n/Zoom")],Ac.prototype,"messages",void 0),c([h()],Ac.prototype,"view",null),c([h({type:RI})],Ac.prototype,"viewModel",void 0),Ac=c([w("esri.widgets.Zoom")],Ac);var wj=Ac;function pK(e){return e?.view!==void 0}var eC=class extends hj{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=t=>{this.components.forEach(i=>{let r=this._find(i),s=r?.widget;pK(s)&&(s.view=t)})},this._componentsWatcher=(t,i)=>{this._removeComponents(i),this._addComponents(t),this._adjustPadding(t)}}initialize(){this.addHandles([T(()=>this.components,this._componentsWatcher,ie),T(()=>this.view,this._updateViewAwareWidgets,ie)])}_add(e,t,i,r,s){let n=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;n=this._createComponent(e)}super._add(n,t,i,r,s)}_removeComponents(e){e.forEach(t=>{let i=this._find(t);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){let{top:t}=this.padding;this.padding=t}}_addComponents(e){this.constructed&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){let t=this._createWidget(e);return new Zd({id:e,node:t})}_createWidget(e){let t=this.view;switch(e){case"attribution":return new mj({view:t});case"compass":return new Jx({view:t});case"navigation-toggle":return new _j({view:t});case"zoom":return new wj({view:t})}}};c([h()],eC.prototype,"components",void 0),eC=c([w("esri.views.ui.DefaultUI")],eC);var Kd=eC;var tC=class extends Kd{constructor(e){super(e),this.components=["attribution","zoom"]}};c([h()],tC.prototype,"components",void 0),tC=c([w("esri.views.ui.2d.DefaultUI2D")],tC);var AI=tC;var II,iC=II=class extends Wi{constructor(e){super(e),this.color=new Ar([0,0,0,1])}clone(){return new II(Xr({color:this.color}))}};c([h({type:Ar,json:{write:!0}})],iC.prototype,"color",void 0),iC=II=c([w("esri.webmap.background.ColorBackground")],iC);var xj=iC;var Cj,Sj,Tj,Mj,Ej,Rj,Aj;function fK(){return P(this,null,function*(){let[,{GraphicsView2D:e,GraphicContainer:t,LabelManager:i,MapViewNavigation:r,MagnifierView2D:s,GridView2D:n,Stage:o}]=yield Promise.all([import("./chunk-3737YILK.js"),import("./chunk-3X2YWR7C.js")]);Sj=e,Tj=t,Mj=i,Ej=r,Rj=s,Aj=n,Cj=o})}var We=class extends _x(bx(vx(Sx))){constructor(e){super(e),this._magnifierView=null,this._gridView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new dc({getCollections:()=>[this.basemapView?.baseLayerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.fullOpacity=1,this.goToManager=new Oy({view:this}),this.graphicsView=null,this.stateManager=new ks({constraints:new mI({view:this})}),this.stationaryManager=new bf,this.labelManager=null,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.frameTask=new Ox(this),this.floors=new qe,this.grid=null,this.highlights=eB(),this.inputManager=new ej({view:this}),this.map=null,this.spatialReferenceLocked=!1,this.timeline=new wE,this.type="2d",this.view2dType=null,this.ui=new AI,this.test={takeScreenshot:t=>P(this,null,function*(){return oj(this._getScreenshotView(t),t)})},this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([T(()=>this.viewpoint,()=>this.stationaryManager.flip(),Re),this.on("resize",t=>this.stateManager.resize(t.width,t.height))]),D0()}destroy(){this.layerViewManager.clear(),this._set("preconditionsReady",!1),this.frameTask=z(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new Kx(this.featuresTilingScheme)}get constraintsInfo(){let e=this.defaultsFromMap?.tileInfo,t=this.spatialReference;return{lods:e?.spatialReference?.equals(t)?e.lods:null,spatialReference:t}}get state(){return this.stateManager.state}get initialExtentRequired(){if(!this.stateManager)return!1;let{scale:e,constraints:t,center:i,viewpoint:r,extent:s}=this,n=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.viewpoint)&&!s&&(t?.effectiveLODs||(n=-1),(!i||e===0&&n===-1)&&(r?.targetGeometry==null||r.targetGeometry.type!=="extent"&&!r.scale))}get defaultsFromMapSettings(){return{required:{extent:!1,heightModelInfo:!1,tileInfo:!0},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get scheduler(){return this.frameTask.scheduler}get typeSpecificPreconditionsReady(){let e=this._getDefaultViewpoint();if(!e)return!1;let t=e.targetGeometry,i=this.spatialReference;return el(t.spatialReference,i)}set animation(e){let t=this._get("animation");if(e===t)return;if(t&&t.stop(),e!==this.animationManager.animation&&this.animationManager.stop(),!e||e.isFulfilled())return void this._set("animation",null);this._set("animation",e);let i=()=>{this.destroyed||e===this._get("animation")&&(this._set("animation",null),this.frameTask?.requestFrame())};e.when(i,i)}get background(){return Z0(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){return this.stateManager?.center??null}set center(e){this.stateManager.center=e}get constraints(){return this.stateManager?.constraints}set constraints(e){e.view=this;let t=this.stateManager.constraints;this.stateManager.constraints=e,t?.destroy()}get extent(){return this.stateManager?.extent??null}set extent(e){this.stateManager.extent=e}get highlightOptions(){return tB(this)}set highlightOptions(e){iB(this,e)}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get rendering(){return this.stage?.renderRequested??!1}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(e){this.stateManager.resizeAlign=e}get resolution(){return this.stateManager.resolution??0}get rotation(){return this.stateManager.rotation??0}set rotation(e){let{rotationEnabled:t}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=e,this.constraints.rotationEnabled=t}get scale(){return this.stateManager?.scale??0}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}get tileInfo(){return this.featuresTilingScheme?.tileInfo}get updating(){let e=!(!this.magnifier.visible||this.magnifier.position===null||!this._magnifierView?.updatingHandles.updating),t=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(i=>!i.destroyed&&!("layerViews"in i)&&i.updating===!0)||e);if(Qe("esri-2d-log-updating")){let i=this.allLayerViews.reduce((r,s)=>se(I({},r),{[`${s.layer.id}(${s.layer.type})`]:!s.destroyed&&!("layerViews"in s)&&s.updating}),{});console.log(`Updating MapView: ${t}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${this.layerViewManager?.updating}
-> labelManager.updating: ${this.labelManager?.updating}
-> graphicsView.updating: ${this.graphicsView?.updating}
-> allLayerViews: ${JSON.stringify(i)}
-> updatingMagnifier: ${e}
`)}return t}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(e){this.stateManager.viewpoint=e,this.frameTask.requestFrame()}get visibleArea(){let e=this.stateManager.visibleArea;return e&&new Xa({rings:[e.map(t=>[t[0],t[1]])],spatialReference:this.spatialReference})}get zoom(){return this.stateManager.zoom??-1}set zoom(e){this.stateManager.zoom=e}get navigating(){return this.mapViewNavigation?.interacting??!1}goTo(e,t){return this.goToManager.goTo(e,t)}hitTest(e,t){return P(this,null,function*(){return rj(this,e,t)})}takeScreenshot(e){return P(this,null,function*(){return nj(this._getScreenshotView(e),e)})}toMap(e){if(!this.ready)return null;let t=hu(e)?du(this,e):e;return this.stateManager.toMap(t)}toScreen(e,t){return this.stateManager.toScreen(e,t)}on(e,t,i,r){return this.inputManager&&this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties.spatialReference||this.defaultsFromMap?.spatialReference||null}getDefaultTimeZone(){return Z0(this.map)?this.map.initialViewProperties.timeZone:null}getDefaultTimeExtent(){return Z0(this.map)?this.map.initialViewProperties.timeExtent:null}hasLayerViewModule(e){return aI.hasLayerViewModule(e)}importLayerView(e){return aI.importLayerView(e)}pixelSizeAt(){return this.ready?this.resolution:(V.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}popupHitTest(e){return P(this,null,function*(){let t=this.toMap(e),i=yield this.hitTest(e),r=this.allLayerViews.toArray().filter(l=>l.clips.every(d=>z0(this,d,e,t))).reverse(),s=new globalThis.Map(r.map(l=>[l.layer.uid,l])),n=[],o=0,a=0;for(;o<i.results.length||a<r.length;){let l=i.results.at(o);if(l&&l.type!=="graphic"){++o;continue}let d=s.get((l?.layer??l?.graphic.layer)?.uid);if((!l||d)&&a<r.length&&r.at(a)!==d){let u=r.at(a);"fetchPopupFeaturesAtLocation"in u&&n.push({mapPoint:t,layerView:u}),++a}else l&&(n.push({graphic:l.graphic,layerView:d}),++o)}return{hits:n,location:t}})}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}validate(){return P(this,null,function*(){let e=Yx(this.type);if(Qe("safari")&&Qe("safari")<9&&(e=new le("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:Qe("safari")})),e!=null)throw V.getLogger(this).warn("#validate()",e.message),e})}loadAsyncDependencies(){return fK()}_getDefaultViewpoint(){let{constraints:e,initialExtent:t,map:i,padding:r,size:s}=this;if(!e)return null;let n=i&&"initialViewProperties"in i?i.initialViewProperties:void 0,o=this.stateManager.getUserStartupOptions(this.size),a=n?.viewpoint,l=a?.targetGeometry?.extent??t,d=l?.center,u=a?.rotation??0,m=a?.scale||l&&B0(l,[s[0]-r.left-r.right,s[1]-r.top-r.bottom]),p=o.center??d,f=o.rotation??u,g=o.scale??m;return p&&g?new rr({targetGeometry:p,scale:g,rotation:f}):null}_startup(){this.timeline.begin("MapView Startup");let e=this._getDefaultViewpoint();this.stateManager.startup(e,this.size,this.spatialReference,this.defaultsFromMap.extent?.center),this.graphics.owner=this;let t=new Cj(this.surface,{canvas:this.renderCanvas,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this.stage=t,this._magnifierView=new Rj,this._magnifierView.magnifier=this.magnifier,this._gridView=new Aj;let i=new Mj({view:this});this._set("labelManager",i);let r=new U5({view:this});this._set("animationManager",r);let s=new Ej({view:this,animationManager:r});this._set("mapViewNavigation",s),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",()=>this._updateStageChildren()),t.on("webgl-error",o=>this.fatalError=o.error),T(()=>this.stationary,o=>t.stationary=o,Ce),T(()=>this.background,o=>{t.backgroundColor=o?.color,this._magnifierView.backgroundColor=o?.color},Ce),T(()=>this.magnifier,o=>this._magnifierView.magnifier=o,Ce),T(()=>this.grid,o=>this._gridView.grid=o,Ce),T(()=>this.renderingOptions,o=>t.renderingOptions=o,Ce),T(()=>this.highlights.items.map(o=>({name:o.name,options:{fillColor:o.options.color,haloColor:o.options.haloColor,fillOpacity:o.options.fillOpacity,haloOpacity:o.options.haloOpacity,haloWidth:o.options.haloWidth,haloBlur:o.options.haloBlur}})),()=>{t.highlightGradient=QV(t.highlightGradient,this.highlights.items)},Ce),T(()=>this.state.id,()=>t.state=this.state,Ce)],"map-view"),this._updateStageChildren();let n=this._resolveWhenReady;this._resolveWhenReady=[],n.forEach(o=>o(this)),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._gridView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._gridView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach(t=>{this.stage.addChild(t.container)});let e=this.graphicsView;this.stage.addChild(e.container),this.stage.addChild(this._magnifierView),this.stage.addChild(this._gridView)}_setupSpatialReferenceDependentProperties(){let e=new J2(r2.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);let t=new Sj({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new Tj(e)});this._set("graphicsView",t)}_destroySpatialReferenceDependentProperties(){let e=this.graphicsView;this._set("graphicsView",null),e.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(e){let{allLayerViews:t,padding:i,size:r,stage:s}=this;return{allLayerViews:t,backgroundColor:e?.ignoreBackground?null:this.background?.color,padding:i,size:r,stage:s}}_spatialReferenceChanged(e){if(this.ready){this.frameTask.stop();for(let t of this.allLayerViews)t.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(e),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(let t of this.allLayerViews)t.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}};We.type="2d",c([h({readOnly:!0})],We.prototype,"animationManager",void 0),c([h({constructOnly:!0})],We.prototype,"deactivatedWebGLExtensions",void 0),c([h({constructOnly:!0})],We.prototype,"debugWebGLExtensions",void 0),c([h({readOnly:!0})],We.prototype,"featuresTilingScheme",void 0),c([h({readOnly:!0})],We.prototype,"fullOpacity",void 0),c([h()],We.prototype,"goToManager",void 0),c([h({readOnly:!0})],We.prototype,"graphicsTileStore",null),c([h()],We.prototype,"graphicsView",void 0),c([h()],We.prototype,"stateManager",void 0),c([h()],We.prototype,"constraintsInfo",null),c([h({readOnly:!0})],We.prototype,"state",null),c([h()],We.prototype,"initialExtentRequired",null),c([h()],We.prototype,"labelManager",void 0),c([h({readOnly:!0})],We.prototype,"mapViewNavigation",void 0),c([h({constructOnly:!0})],We.prototype,"renderCanvas",void 0),c([h()],We.prototype,"renderingOptions",void 0),c([h({constructOnly:!0})],We.prototype,"supersampleScreenshotsEnabled",void 0),c([h({readOnly:!0})],We.prototype,"supportsGround",void 0),c([h()],We.prototype,"defaultsFromMapSettings",null),c([h({readOnly:!0})],We.prototype,"typeSpecificPreconditionsReady",null),c([h()],We.prototype,"animation",null),c([h({type:xj})],We.prototype,"background",null),c([h()],We.prototype,"center",null),c([h({type:mI})],We.prototype,"constraints",null),c([h()],We.prototype,"extent",null),c([h()],We.prototype,"floors",void 0),c([h()],We.prototype,"grid",void 0),c([h({type:ZV})],We.prototype,"highlightOptions",null),c([h({type:qe.ofType(JV)})],We.prototype,"highlights",void 0),c([h({readOnly:!0})],We.prototype,"inputManager",void 0),c([h()],We.prototype,"map",void 0),c([h()],We.prototype,"padding",null),c([h({readOnly:!0})],We.prototype,"rendering",null),c([h()],We.prototype,"resizeAlign",null),c([h({readOnly:!0})],We.prototype,"resolution",null),c([h()],We.prototype,"rotation",null),c([h()],We.prototype,"scale",null),c([h({constructOnly:!0})],We.prototype,"spatialReferenceLocked",void 0),c([h()],We.prototype,"stationary",null),c([h({readOnly:!0})],We.prototype,"tileInfo",null),c([h({type:wE,readOnly:!0})],We.prototype,"timeline",void 0),c([h({readOnly:!0})],We.prototype,"type",void 0),c([h({readOnly:!0})],We.prototype,"updating",null),c([h({readOnly:!0})],We.prototype,"view2dType",void 0),c([h()],We.prototype,"viewpoint",null),c([h({readOnly:!0})],We.prototype,"visibleArea",null),c([h()],We.prototype,"zoom",null),c([h({readOnly:!0})],We.prototype,"navigating",null),c([h(),Lr(e=>e instanceof Kd?e:Db(AI,e))],We.prototype,"ui",void 0),We=c([w("esri.views.View2D")],We);var Ij=We;var rC=class extends Ij{constructor(e){super(e),this.view2dType="map"}};c([h({readOnly:!0})],rC.prototype,"view2dType",void 0),rC=c([w("esri.views.MapView")],rC);var Dj=rC;function DI(e,t){let i=EM(e),r=EM(t),s=i.store,n=r.store,o=r.metadata;for(let a in o){let l=o[a],d=s.originOf(a),u=n.originOf(a);if(!l.readOnly&&u!==Xl.DEFAULTS)if(d===Xl.DEFAULTS)e.set(a,n.get(a));else{let m=s.get(a),p=n.get(a);m&&p&&p instanceof k&&m instanceof k&&m instanceof p.constructor&&DI(m,p)}}}var Yd=class extends ti.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=P_}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){let e=this.view.basemapTerrain;if(e?.extent==null||e.spatialReference==null)return null;let t=Hb(e.extent,e.spatialReference);return t.zmin=e.visibleElevationBounds.min,t.zmax=e.visibleElevationBounds.max,t}get spatialReference(){return this.view.basemapTerrain?.spatialReference??gt.WGS84}elevationAt(e,t){if(this.extent==null||!SL(this.extent,e,t)){let i=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return V.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,t,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return BN(e.clone(),this)}};c([h({readOnly:!0})],Yd.prototype,"demResolution",void 0),c([h({readOnly:!0})],Yd.prototype,"extent",null),c([h({readOnly:!0})],Yd.prototype,"noDataValue",void 0),c([h()],Yd.prototype,"spatialReference",null),c([h({constructOnly:!0})],Yd.prototype,"view",void 0),Yd=c([w("esri.views.support.GroundViewElevationSampler")],Yd);var Pj=Yd;var Ic=class extends k{constructor(e){super(e),this.view=null,this.layerViews=new qe}initialize(){this.addHandles(_r(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(let e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Pj({view:this.view}):null:null}get extent(){let e=this.view;return e&&e.type!=="2d"&&e.ready?J0(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>T(()=>e.updating,()=>this._updateUpdating(),Re)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};c([h({readOnly:!0})],Ic.prototype,"elevationSampler",null),c([h({readOnly:!0})],Ic.prototype,"extent",null),c([h({type:Boolean,readOnly:!0})],Ic.prototype,"updating",null),c([h({constructOnly:!0})],Ic.prototype,"view",void 0),c([h({type:qe,readOnly:!0})],Ic.prototype,"layerViews",void 0),c([h({readOnly:!0})],Ic.prototype,"suspended",null),Ic=c([w("esri.views.GroundView")],Ic);var Oj=Ic;var By=()=>import("./chunk-NOIK73A3.js"),kj=()=>import("./chunk-CY77HIPE.js"),Lj={"base-dynamic":()=>import("./chunk-MMEYT5BH.js"),"base-elevation":kj,"base-tile":By,"bing-maps":By,"building-scene":()=>import("./chunk-LEFKMJ5Y.js"),catalog:()=>import("./chunk-ENJ7UIVT.js"),"catalog-dynamic-group":()=>import("./chunk-GT7T6DY3.js"),"catalog-footprint":()=>import("./chunk-ULHLGMXR.js"),csv:()=>import("./chunk-MUG53WUW.js"),dimension:()=>import("./chunk-XQRVSORB.js"),elevation:kj,feature:()=>import("./chunk-KWCGZKGK.js"),focusArea:()=>import("./chunk-LR2KGG2T.js"),geojson:()=>import("./chunk-5YTD3SCT.js"),graphics:()=>import("./chunk-H2JI4RYM.js"),group:()=>import("./chunk-EASDJAC5.js"),imagery:()=>import("./chunk-B6KA2ITC.js"),"integrated-mesh":()=>import("./chunk-XXHQ7OF3.js"),"integrated-mesh-3dtiles":()=>import("./chunk-4VKYBJY5.js"),"line-of-sight":()=>import("./chunk-GFALFYMO.js"),"map-image":()=>import("./chunk-5SO7I3ET.js"),media:()=>import("./chunk-XPAIJP5H.js"),"ogc-feature":()=>import("./chunk-LKYT2A7J.js"),"open-street-map":By,"oriented-imagery":()=>import("./chunk-KWCGZKGK.js"),"point-cloud":()=>import("./chunk-L2QJMRBP.js"),viewshed:()=>import("./chunk-TJBFZYQJ.js"),voxel:()=>import("./chunk-QFQWBE6K.js"),route:()=>import("./chunk-M5CVELL6.js"),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?import("./chunk-L3MHJ7EO.js"):import("./chunk-FL46CAS6.js"),stream:()=>import("./chunk-JLFAWQZM.js"),tile:By,"imagery-tile":()=>import("./chunk-TFMPR3VO.js"),"vector-tile":()=>import("./chunk-EUIRBNKY.js"),wcs:()=>import("./chunk-TFMPR3VO.js"),"web-tile":By,wfs:()=>import("./chunk-QQODIWOU.js"),wms:()=>import("./chunk-OXH7W6O7.js"),wmts:()=>import("./chunk-LINKZEAP.js"),parquet:null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function gK(e){let t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new le(`${i}:view-not-supported`,`${t} is not supported in 3D`)}var PI={hasLayerViewModule:e=>Lj[e.type]!=null,importLayerView:e=>{let t=Lj[e.type];if(t==null)throw gK(e);return t(e)}};var Fj="analyses-owner-handles",Mf,Vu;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(Mf||(Mf={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(Vu||(Vu={}));var Nu=class extends k{constructor(e){super(e),this._allAnalysisViews=new qe,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=Nj(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(cs("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(cs()),this._attachedToViewResolver=Nj()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}whenAnalysisView(e){return P(this,null,function*(){yield this._attachedToViewResolver.promise;let t=this._items.get(e);if(t==null||t.state.list===Vu.REMOVED)throw new le("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise})}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),Fj)}_disconnectOwners(){this.removeHandles(Fj),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(let r of e)this._addAnalysis(r);let t=e.on("after-add",r=>this._addAnalysis(r.item)),i=e.on("after-remove",r=>this._removeAnalysis(r.item));return kr(()=>{t.remove(),i.remove();for(let r of e)this._removeAnalysis(r)})}_addAnalysis(e){let t=this._items.get(e);if(t==null){let i={state:{view:Mf.PENDING,list:Vu.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=js(r=>this._createAnalysisViewPromise(i,r))}else t.state.list=Vu.ADDED}_removeAnalysis(e){let t=this._items.get(e);t!=null?(t.state.list=Vu.REMOVED,this._scheduleUpdate()):V.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=Ab(()=>this._update()))}_update(){this._scheduledUpdateHandle=Nt(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Vu.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case Mf.PENDING:e.createAnalysisViewTask=Er(e.createAnalysisViewTask);break;case Mf.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=z(e.view),e.createAnalysisViewTask=null)}})}_createAnalysisViewPromise(e,t){return P(this,null,function*(){let i=e.analysis,r=i.type,s=this._analysisModules[r];if(this._creatingViewCount+=1,s.module==null)try{s.module=yield this._loadAnalysisModule(r)}catch(o){throw this._creatingViewCount-=1,o}if(Jl(t))throw this._creatingViewCount-=1,cs("AnalysisView creation aborted");let n=new s.module.default({analysis:i,view:this.view});try{yield n.when()}catch(o){throw this._creatingViewCount-=1,o}if(Jl(t))throw this._creatingViewCount-=1,n.destroy(),cs("AnalysisView creation aborted");return e.view=n,e.state.view=Mf.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n})}_loadAnalysisModule(e){switch(e){case"area-measurement":return import("./chunk-6ASTD7CN.js");case"dimension":return import("./chunk-AGD3IXHI.js");case"direct-line-measurement":return import("./chunk-T6MK54EE.js");case"line-of-sight":return import("./chunk-VQSO65D2.js");case"slice":return import("./chunk-WSEZS3PN.js");case"viewshed":return import("./chunk-KJ3NY7ZU.js")}}};function Nj(){let e=Hn();return e.promise.catch(()=>{}),e}c([h()],Nu.prototype,"updating",null),c([h({constructOnly:!0})],Nu.prototype,"view",void 0),c([h()],Nu.prototype,"_allAnalysisViews",void 0),c([h()],Nu.prototype,"_creatingViewCount",void 0),Nu=c([w("esri.views.3d.analysis.AnalysisViewManager3D")],Nu);var Vj=Nu;var xl=class extends k{constructor(e){super(e),this.collision=new zy,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===we.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==we.Local?this._set("altitude",e):V.getLogger(this).warn("Altitude constraint is ignored in local scenes")}get mode(){return this.state.viewingMode}clampAltitude(e){return this.altitude?U(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;let i=this.tilt(e);return U(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===we.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=OI)=>(i.min=jr.min,i.max=e,i)}_createDefaultTiltLocal(){let e=this.collision.enabled?ep([[4e3,jr.max],[1e4,Vt(88)],[6e6,Vt(88)]]):()=>jr.max;return(t,i=OI)=>(i.min=jr.min,i.max=e(t),i)}_createDefaultTiltGlobal(){let e=this.collision.enabled?ep([[4e3,jr.max],[5e4,Vt(88)],[6e6,Vt(88)],[2e7,jr.min]]):ep([[3e5,jr.max],[3e6,Vt(88)],[6e6,Vt(88)],[2e7,jr.min]]);return(t,i=OI)=>(i.min=jr.min,i.max=e(t),i)}};function _K(e){return{min:-2e5,max:4*e.radius}}c([h()],xl.prototype,"altitude",null),c([h({readOnly:!0})],xl.prototype,"collision",void 0),c([h()],xl.prototype,"distance",void 0),c([h({readOnly:!0})],xl.prototype,"minimumPoiDistance",void 0),c([h()],xl.prototype,"tilt",void 0),c([h({constructOnly:!0})],xl.prototype,"state",void 0),xl=c([w("esri.views.3d.state.Constraints")],xl);var kI=_K(qs),jr={min:Vt(.5),max:Vt(179.5)},OI={min:0,max:0},zy=class extends k{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};c([h({type:Boolean})],zy.prototype,"enabled",void 0),c([h({type:Number})],zy.prototype,"elevationMargin",void 0),zy=c([w("esri.views.3d.state.Constraints.CollisionConstraint")],zy);var Bu=class extends ad{constructor(){super(...arguments),this.min=kI.min,this.max=kI.max}};c([h({type:Number})],Bu.prototype,"min",void 0),c([h({type:Number})],Bu.prototype,"max",void 0),Bu=c([w("esri.views.3d.constraints.AltitudeConstraint")],Bu);var Cl=class extends ad{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};c([h({type:Number,value:1e-8})],Cl.prototype,"near",null),c([Lr("near")],Cl.prototype,"castNear",null),c([h({type:Number,value:1e-8})],Cl.prototype,"far",null),c([Lr("far")],Cl.prototype,"castFar",null),c([h({type:["auto","manual"]})],Cl.prototype,"mode",void 0),Cl=c([w("esri.views.3d.constraints.ClipDistanceConstraint")],Cl);var LI={min:ec(jr.min),max:ec(jr.max)},Xd=class extends ad{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return U(e,LI.min,LI.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};c([h({type:["auto","manual"]})],Xd.prototype,"mode",void 0),c([h({type:Number,value:LI.max})],Xd.prototype,"max",null),c([Lr("max")],Xd.prototype,"castMax",null),Xd=c([w("esri.views.3d.constraints.TiltConstraint")],Xd);var Jd=class extends ad{constructor(e){super(e),this.tilt=new Xd,this.altitude=new Bu,this.clipDistance=new Cl}};c([h({type:Xd})],Jd.prototype,"tilt",void 0),c([h({type:Bu})],Jd.prototype,"altitude",void 0),c([h({type:Cl})],Jd.prototype,"clipDistance",void 0),Jd=c([w("esri.views.3d.constraints.Constraints")],Jd);function FI(e){return Ka(e,q2)||Nb(e)?{wkid:OM.GCSMARS2000}:Ka(e,W2)||Vb(e)?{wkid:OM.GCSMOON2000}:gt.WGS84}var zu=class{constructor(t,i,r,s,n,o,a,l,d=.5){this.coverage=t,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=d}},is={sunny:new zu([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Sa.SIXTEEN),cloudy:new zu([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Sa.TWOHUNDRED,.6),rainy:new zu([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Sa.TWOHUNDRED,.4),snowy:new zu([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Sa.HUNDRED,.65),foggy:new zu([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Sa.SIXTEEN)};is.default=is.sunny;var Ef=class extends at{constructor(t,i,r){super(t,i,new ot(Hz,()=>import("./chunk-JOMNZG4B.js")),r)}initializePipeline(t){return mt({blending:ap(oi.CONSTANT_COLOR,oi.ONE_MINUS_CONSTANT_COLOR,z2.ADD,t.writeTextureChannels===F_.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Vi.LEQUAL},colorWrite:wt})}};var Rf=class extends at{constructor(t,i,r){super(t,i,new ot(qz,()=>import("./chunk-NDMPMT7T.js")),r)}initializePipeline(t){return mt({blending:t.mode===yu.Full?lp:cl(oi.ZERO,oi.ONE,oi.ONE,oi.ZERO),depthTest:{func:Vi.ALWAYS},colorWrite:wt})}};var Uy=class extends k{constructor(e){super(e),this._needsRender=!0,this._passParameters=new Gz,this._configuration=new jz,this._fbo=new rl(e.context.renderContext.rctx,new Di(pw)),this._configuration.mode=yu.Full,e.context.techniques.precompile(Rf,this._configuration),this._configuration.mode=yu.WeatherMap,e.context.techniques.precompile(Rf,this._configuration)}get textureAtlas(){if(this._texture&&!this._needsRender)return this._texture;this._configuration.mode=this._texture?yu.WeatherMap:yu.Full;let e=this.context.techniques.acquire(Rf,this._configuration);return e.compiled&&(this._texture=this._render(e)),e.release(),this._texture}updateWeatherMap(e){Jb(this._passParameters.weatherTile,e)||(wr(this._passParameters.weatherTile,e),this._needsRender=!0)}destroy(){this._weatherMapTechniqueCached=Hi(this._weatherMapTechniqueCached),this._fbo=Ne(this._fbo)}_render(e){if(!this._fbo)return null;let t=this.context.renderContext.rctx,i=t.getViewport();return t.setViewport(0,0,pw,pw),t.bindFramebuffer(this._fbo),t.bindTechnique(e,this.context.renderContext.bind,this._passParameters),t.screen.draw(),t.setViewport(i.x,i.y,i.width,i.height),this._needsRender=!1,this._fbo.colorTexture}};c([h({constructOnly:!0})],Uy.prototype,"context",void 0),Uy=c([w("esri.views.3d.environment.NoiseTextureAtlas")],Uy);var Js=class extends k{constructor(e){super(e),this._state=To(gu.Idle),this._passParameters=new Uz,this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this._tilesPerFace=1,this.coverage=Ke(is.default.coverage[0],is.default.coverage[1],.5),this.density=Ke(is.default.density[0],is.default.density[1],.5),this.absorption=Ke(is.default.absorption[0],is.default.absorption[1],.5),this.cloudSize=Ke(is.default.cloudSize[0],is.default.cloudSize[1],.5),this.detailSize=Ke(is.default.detailSize[0],is.default.detailSize[1],.5),this.smoothness=Ke(is.default.smoothness[0],is.default.smoothness[1],.5),this.cloudHeight=Ke(is.default.cloudHeight[0],is.default.cloudHeight[1],.5),this.raymarchingSteps=is.default.raymarchingSteps,this._viewMatrix=Ht(),this._dirty=!0,this.running=!0,this._configuration=new zz}initialize(){let e=ht(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius;let t=()=>this.setDirty();this.addHandles([this.view.resourceController.scheduler.registerTask(si.CLOUDS_GENERATOR,this),T(()=>this.coverage,t,ie),T(()=>this.density,t,ie),T(()=>this.absorption,t,ie),T(()=>this.cloudSize,t,ie),T(()=>this.detailSize,t,ie),T(()=>this.smoothness,t,ie),T(()=>this.cloudHeight,t,ie),T(()=>this.raymarchingSteps,t,ie)]);let i=V2(this._computeWeatherTile()),r=0;this.addHandles(T(()=>{let s=this._computeWeatherTile();return Jb(i,s)||(++r,wr(i,s)),r},t))}destroy(){this.destroyCubeMap(),this._passParameters.noiseTexture=z(this._passParameters.noiseTexture)}_precompileTechniques(){this._configuration.steps=this.raymarchingSteps,this._configuration.writeTextureChannels=F_.RG,this.context.techniques.precompile(Ef,this._configuration),this._configuration.writeTextureChannels=F_.BA,this.context.techniques.precompile(Ef,this._configuration)}_acquireTechnique(){switch(this.raymarchingSteps){case Sa.SIXTEEN:this._tilesPerFace=1;break;case Sa.HUNDRED:this._tilesPerFace=4;break;case Sa.COUNT:case Sa.TWOHUNDRED:this._tilesPerFace=8;break;default:this.raymarchingSteps}return this._configuration.writeTextureChannels=1-this.parameters.readChannels,this._configuration.steps=this.raymarchingSteps,this.context.techniques.acquire(Ef,this._configuration)}_computeWeatherTile(){let{camera:e,environment:t}=this.view,{latitude:i,longitude:r}=e.position;if(i==null||r==null)return iu;En(Pa,(i+90)/180,(r+180)/360);let s=Math.floor(this._weatherTileCount*Math.abs(2*Pa[0]-1));Pa[0]=Math.floor(2*this._weatherTileCount*Pa[0]),Pa[1]=Math.floor(4*(this._weatherTileCount-s)*Pa[1]);let n=0,o=0;if(t?.lighting?.type!=="virtual"&&t?.lighting?.date!=null){let a=new Date(t.lighting.date);a.setUTCHours(t.lighting.date.getUTCHours()+(t.lighting.displayUTCOffset??0)),n=31*a.getUTCMonth()+a.getUTCDate(),o=a.getUTCFullYear()}return Pa[0]=(Pa[0]+n)%(2*this._weatherTileCount),Pa[1]=(Pa[1]+o%100)%(4*this._weatherTileCount),Pa}get state(){return this._state.value}set state(e){this._state.value=e}get usedMemory(){return(this._fbo?.usedMemory??0)+(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){return this._passParameters.noiseTexture??=new Uy({context:this.context}),this._passParameters.noiseTexture}_ensureFrameBufferCube(e){let t=this.context.renderContext.rctx;if(this._fbo==null){let i=new Di(e);i.target=p_.TEXTURE_CUBE_MAP,i.wrapMode=lr.CLAMP_TO_EDGE,this._fbo=new rl(t,i),this.parameters.data=this}return t.unbindTexture(this._fbo.colorTexture),this._fbo}get cubeMap(){return this._fbo}get parameters(){return this.context.renderContext.bind.clouds}destroyCubeMap(){this._fbo=Ne(this._fbo),this.parameters.data=null}applyPreset(e,t){let i=e.median,r=s=>{let n=Ke(s[0],s[1],i);return t<.5?Ke(s[0],n,2*t):Ke(n,s[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps,this._precompileTechniques()}setDirty(){this._dirty=this.running=!0}runTask(e){if(this.state===gu.Fading)return ar;this._dirty&&(this._faceIndex=this._tileIndex=0,this.state=gu.Rendering,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._ensureNoiseTexture().updateWeatherMap(this._computeWeatherTile()),this._dirty=!1);let t=this._acquireTechnique();if(!this._ensureNoiseTexture().textureAtlas||!t.compiled)return t.release(),ar;let i=yK[this._faceIndex],r=vK[this._faceIndex];XL(this._viewMatrix,bK,i,r),Zm(this._passParameters.viewMatrix,this._viewMatrix);let s=this.context.renderContext.rctx,n=s.getViewport(),o=fw/this._tilesPerFace,a=this._tileIndex*o;s.setViewport(0,a,fw,o);let l=this._ensureFrameBufferCube(fw);s.bindFramebuffer(l),s.bindTechnique(t,this.context.renderContext.bind,this._passParameters);let d=p_.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return l.setColorTextureTarget(d),s.screen.draw(),t.release(),s.gl.flush(),s.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this._faceIndex=this._tileIndex=0,this.state=gu.Ready,this.running=!1):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),ar}};c([h({constructOnly:!0})],Js.prototype,"context",void 0),c([h({constructOnly:!0})],Js.prototype,"view",void 0),c([h({constructOnly:!0})],Js.prototype,"requestRender",void 0),c([h()],Js.prototype,"coverage",void 0),c([h()],Js.prototype,"density",void 0),c([h()],Js.prototype,"absorption",void 0),c([h()],Js.prototype,"cloudSize",void 0),c([h()],Js.prototype,"detailSize",void 0),c([h()],Js.prototype,"smoothness",void 0),c([h()],Js.prototype,"cloudHeight",void 0),c([h()],Js.prototype,"raymarchingSteps",void 0),c([h()],Js.prototype,"running",void 0),Js=c([w("esri.views.3d.environment.CloudsRenderer")],Js);var yK=[_a(1,0,0),_a(-1,0,0),_a(0,1,0),_a(0,-1,0),_a(0,0,1)],vK=[_a(0,1,0),_a(0,1,0),_a(0,0,-1),_a(0,0,1),_a(0,1,0)],bK=GL(),Pa=B2();var sC=class extends nl{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=0}},Hy=class extends at{constructor(t,i,r){super(t,i,new ot($z,()=>import("./chunk-FYXVHNN7.js")),r,new Map([[Ii.POSITION,0],[Ii.INSTANCEFEATUREATTRIBUTE,1]]))}initializePipeline(){return mt({blending:cp,depthTest:{func:Vi.LEQUAL},colorWrite:wt})}};var eh=class extends Pn{constructor(e){super(e),this.consumes={required:[Fe.TRANSPARENT_ENVIRONMENT]},this.produces=Fe.TRANSPARENT_ENVIRONMENT,this._rainSpeed=.1,this._snowSpeed=.01,this._numParticles=0,this._passParameters=new sC,this._configuration=new Wz;let{view:t,type:i,techniques:r}=e;this._configuration.type=i==="rainy"?jE.Rain:jE.Snow,r.precompile(Hy,this._configuration),this._passParameters.time=0,this._passParameters.radius=ht(t.spatialReference).radius,this.addHandles(T(()=>t.environment.weather,s=>{s.type===i&&this.addHandles(T(()=>s.precipitation,n=>this._adjustParticles(n),Ce))},Ce)),this.addHandles(T(()=>t._stage?.renderer.renderContext.bind.clouds.fadeFactor??1,s=>{this._passParameters.opacity=s,s===1&&(this.removeHandles("opacity"),this.addHandles(T(()=>t._stage?.renderer.renderContext.bind.clouds.opacity??1,n=>this._passParameters.opacity=n,Ce),"opacity"))},Re),"opacity")}_adjustParticles(e){let i=e<.5?Ke(0,.35,2*e):Ke(.35,1,2*(e-.5));this._numParticles=Bj*i}destroy(){this._numParticles=0,this._vao=Ne(this._vao),this._instanceIdBuffer=Ne(this._instanceIdBuffer)}fadeOut(e){this.removeAllHandles(),this.addHandles(T(()=>this.renderContext?.bind.clouds.fadeFactor??1,t=>{this._passParameters.opacity=1-t,t===1&&(this.removeAllHandles(),e())}),"opacity")}updateAnimation(e){let t=(this.type==="rainy"?this._rainSpeed:this._snowSpeed)*Rb(e.time)%1e5;return this._passParameters.time!==t&&(this._passParameters.time=t,!0)}render(e){let t=this.renderingContext;this._instanceIdBuffer??=this._createInstanceIndices(t);let i=Math.round(this._numParticles*this._passParameters.opacity),r=e.find(({name:o})=>o===Fe.TRANSPARENT_ENVIRONMENT);if(i<1)return r;let s=this.techniques.acquire(Hy,this._configuration);if(!s.compiled)return s.release(),this.requestRender(Te.UPDATE),r;let n=t.bindTechnique(s,this.bindParameters,this._passParameters);return this._vao??=wK(t,s.locations),t.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),iF(t,s.locations,this._instanceIdBuffer,zj,0),t.drawArraysInstanced(ni.TRIANGLES,0,3,i),rF(t,s.locations,this._instanceIdBuffer,zj),s.release(),r}_createInstanceIndices(e){let t=[];for(let i=0;i<Bj;i++)t.push(i);return es.createVertex(e,Is.STATIC_DRAW,new Float32Array(t))}};function wK(e,t){let i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Dn(e,t,new Map([["geometry",In(xK)]]),new Map([["geometry",es.createVertex(e,Is.STATIC_DRAW,i)]]))}c([h()],eh.prototype,"consumes",void 0),c([h()],eh.prototype,"produces",void 0),c([h({constructOnly:!0})],eh.prototype,"type",void 0),c([h({constructOnly:!0})],eh.prototype,"techniques",void 0),eh=c([w("esri.views.3d.environment.Precipitation")],eh);var Bj=25e4,xK=$n().vec3f(Ii.POSITION),zj=In($n().f32(Ii.INSTANCEFEATUREATTRIBUTE),1);var th=class extends sp{constructor(e){super(e),this.produces=new Map([]),this._clouds=To(null),this._incarnation=0,this._precipitation=null}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage?.removeRenderPlugin(this),this._set("view",null)}get updating(){return!!this._clouds.value?.running}get weatherVisible(){return be(this.view.state.camera.eye)-ht(this.view.spatialReference).radius<=N_}get usedMemory(){return this._clouds.value?.usedMemory??0}_fadeOutPrecipitation(){this._precipitation&&(this._precipitationOutgoing?.destroy(),this._precipitationOutgoing=this._precipitation,this._precipitationOutgoing.fadeOut(()=>{this._precipitationOutgoing=z(this._precipitationOutgoing)}),this._precipitation=null,++this._incarnation)}get weather(){return this.view?.environmentManager?.weatherEnabled?this.view.environment.weather:null}initializeRenderContext(e){this._context=e;let t=this.view,i=()=>this._requestRender();this.addHandles([T(()=>this._precipitation,i,Re),T(()=>this._clouds.value?.state,i,Re),T(()=>t.state.mode,i,Re),T(()=>this._updateClouds(),i,Re),T(()=>this._updatePrecipitation(),i,Re),T(()=>this.weather,r=>this._initWeather(r))])}uninitializeRenderContext(){this._context=null,this._clouds.value=z(this._clouds.value),this._precipitation=z(this._precipitation),this._precipitationOutgoing=z(this._precipitationOutgoing)}prepareRender(e){let{bind:t,time:i}=e;if(this.view.viewingMode!=="local"&&t.clouds.data){t.clouds.fade(t.camera,i,this.view.qualitySettings.fadeDuration);let r=this._clouds.value;r&&r.state===gu.Idle&&r.coverage===0&&!r.running&&r.destroyCubeMap()}}acquireTechniques(){return[]}render(){}_requestRender(){this._context?.requestRender()}_initWeather(e){let t=this._context;if(!e||!t)return void(this._clouds.value=z(this._clouds.value));if(this._clouds.value)return;let i=this.view;this._clouds.value=new Js({context:t,view:i,requestRender:()=>this._requestRender()})}_updateClouds(){let e=this.view.environment.weather;return e==null||this._clouds.value==null||this._clouds.value.applyPreset(is[e.type],CK(e)),++this._incarnation}_updatePrecipitation(){let e=this.view.environment.weather;if(e.type===this._precipitation?.type)return this._incarnation;this._fadeOutPrecipitation();let t=e.type==="rainy"||e.type==="snowy",i=this._context;return t&&i&&(this._precipitation=new eh({view:this.view,techniques:i.techniques,type:e.type}),++this._incarnation),this._incarnation}get test(){}};function CK(e){switch(e.type){case"rainy":case"snowy":case"cloudy":case"sunny":return e.cloudCover;case"foggy":return e.fogStrength}}c([h({constructOnly:!0})],th.prototype,"view",void 0),c([h({type:Boolean,readOnly:!0})],th.prototype,"updating",null),c([h({readOnly:!0})],th.prototype,"weatherVisible",null),c([h()],th.prototype,"_context",void 0),th=c([w("esri.views.3d.environment.EnvironmentRenderer")],th);var cC=Math.PI,nr=Math.sin,ps=Math.cos,VI=Math.tan,Gj=Math.asin,BI=Math.atan2,qj=Math.acos,Gr=cC/180,Wj=864e5,$j=2440588,Zj=2451545,SK={dec:0,ra:0};function TK(e){return e.valueOf()/Wj-.5+$j}function nC(e){return new Date((e+.5-$j)*Wj)}function oC(e){return TK(e)-Zj}var lC=23.4397*Gr;function Qj(e,t){return BI(nr(e)*ps(lC)-VI(t)*nr(lC),ps(e))}function zI(e,t){return Gj(nr(t)*ps(lC)+ps(t)*nr(lC)*nr(e))}function Kj(e,t,i){return BI(nr(e),ps(e)*nr(t)-VI(i)*ps(t))}function Yj(e,t,i){return Gj(nr(t)*nr(i)+ps(t)*ps(i)*ps(e))}function Xj(e,t){return Gr*(280.16+360.9856235*e)-t}function Jj(e){return Gr*(357.5291+.98560028*e)}function eG(e){return Gr*(1.9148*nr(e)+.02*nr(2*e)+3e-4*nr(3*e))}function tG(e,t){return e+t+102.9372*Gr+cC}function iG(e,t){var i=Jj(e),r=tG(i,eG(i));return t||(t={dec:0,ra:0}),t.dec=zI(r,0),t.ra=Qj(r,0),t}var en={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(e,t,i,r){var s=Gr*-i,n=Gr*t,o=oC(e),a=iG(o,SK),l=Xj(o,s)-a.ra;return r||(r={azimuth:0,altitude:0}),r.azimuth=Kj(l,n,a.dec),r.altitude=Yj(l,n,a.dec),r}},aC=[[-.83,"sunrise","sunset"]];en.addTime=function(e,t,i){aC.push([e,t,i])};var rG=9e-4;function MK(e,t){return Math.round(e-rG-t/(2*cC))}function Uj(e,t,i){return rG+(e+t)/(2*cC)+i}function Hj(e,t,i){return Zj+e+.0053*nr(t)-.0069*nr(2*i)}function EK(e,t,i){return qj((nr(e)-nr(t)*nr(i))/(ps(t)*ps(i)))}function jj(e){var t=Gr*(134.963+13.064993*e),i=Gr*(93.272+13.22935*e),r=Gr*(218.316+13.176396*e)+6.289*Gr*nr(t),s=5.128*Gr*nr(i),n=385001-20905*ps(t);return{ra:Qj(r,s),dec:zI(r,s),dist:n}}en.getTimes=function(e,t,i){var r=Gr*-i,s=Gr*t,n=MK(oC(e),r),o=Uj(0,r,n),a=Jj(o),l=eG(a),d=tG(a,l),u=zI(d,0),m=Hj(o,a,d);function p(C){return Hj(Uj(EK(C,s,u),r,n),a,d)}function f(C){var E=(nr(C)-nr(s)*nr(u))/(ps(s)*ps(u));return E<-1?en.PolarException.MIDNIGHT_SUN:E>1?en.PolarException.POLAR_NIGHT:en.PolarException.NORMAL}var g,_,y,v,x,S={solarNoon:nC(m),nadir:nC(m-.5),polarException:en.PolarException.NORMAL};for(g=0,_=aC.length;g<_;g+=1)x=m-((v=p((y=aC[g])[0]*Gr))-m),S[y[1]]=nC(x),S[y[2]]=nC(v);return S.polarException=f(aC[0][0]*Gr),S},en.getMoonPosition=function(e,t,i){var r=Gr*-i,s=Gr*t,n=oC(e),o=jj(n),a=Xj(n,r)-o.ra,l=Yj(a,s,o.dec);return l+=.017*Gr/VI(l+10.26*Gr/(l+5.1*Gr)),{azimuth:Kj(a,s,o.dec),altitude:l,distance:o.dist}},en.getMoonFraction=function(e){var t=oC(e),i=iG(t),r=jj(t),s=149598e3,n=qj(nr(i.dec)*nr(r.dec)+ps(i.dec)*ps(r.dec)*ps(i.ra-r.ra)),o=BI(s*nr(n),r.dist-s*ps(n));return(1+ps(o))/2};var tn={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},Af=class{constructor(t,i){this.direct=t,this.ambient=i}};function fG(e,t,i,r,s,n){ve(n.ambient.color,1,1,1),n.ambient.intensity=tn.global.ambient,ve(n.direct.color,1,1,1),n.direct.intensity=tn.global.direct;let o=t[2],a=U((Math.abs(o)-tn.local.altitude)/(tn.global.altitude-tn.local.altitude),0,1),l;if(n.globalFactor=a,e!=null&&(l=en.getTimes(e,t[1],t[0])),a<1){let d;if(e!=null)d=OK(e,l,r);else{let u=_G(r);d={direct:{intensity:tn.local.directAtNoon*u.direct,color:dt(1,1,1)},ambient:{intensity:tn.local.ambientAtNoon*u.ambient,color:dt(1,1,1)},timeOfDay:"early afternoon"}}di(n.ambient.color,d.ambient.color,n.ambient.color,a),n.ambient.intensity=Ke(d.ambient.intensity,n.ambient.intensity,a),di(n.direct.color,d.direct.color,n.direct.color,a),n.direct.intensity=Ke(d.direct.intensity,n.direct.intensity,a),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=e!=null?PK(e,l):1,e!=null?RK(e,t,i,n.direct.directionToLightSource):JI(s,i,n.direct.directionToLightSource)}function JI(e,t,i){t===we.Global?Z(GI,e.eye):ve(GI,0,0,1),q(qI,e.viewForward,-1);let r=Jm(qI,GI),s=Math.max(r-2*WI,0),n=.85*s/(s+1),o=Math.max(WI,r-WI-n);Co(pG,-o,e.viewRight),fi(i,qI,pG),te(i,i,q(kK,e.viewRight,LK)),Z(i,i)}function RK(e,t,i,r){let s=DK,n=Yh(IK);if(i===we.Global)en.getPosition(e,0,0,s),ve(r,0,0,-1),HM(n,n,-s.azimuth),KL(n,n,-s.altitude),fi(r,r,n);else{let o=tn.planarDirection,a=o.globalAngles,l=t[2],d=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);d=U(d,0,1),d<1?(en.getPosition(e,t[1],t[0],s),s.azimuth=(1-d)*s.azimuth+d*a.azimuth,s.altitude=(1-d)*s.altitude+d*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),ve(r,0,-1,0),d_(n,n,-s.azimuth),HM(n,n,-s.altitude),fi(r,r,n)}}function gG(e,t){if(t===we.Global)return!0;let i=tn.planarDirection;return Math.abs(e)<i.localAltitude}var AK=dt(.5773502691896258,-.5773502691896258,.5773502691896258),jy=class{constructor(){this.ambient={color:dt(1,1,1),intensity:.55},this.direct={color:dt(1,1,1),intensity:.55,directionToLightSource:Ws(AK)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}},IK=Ht(),DK={azimuth:0,altitude:0};function PK(e,t){let i=e.valueOf(),r,s;t.polarException===en.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=r+432e6):t.polarException===en.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=t.sunrise.valueOf(),s=t.sunset.valueOf());let n=r+(s-r)/2;return 1-U(Math.abs(i-n)/432e5,0,1)}function _G(e){switch(e){case"disabled":case"sunny":case"cloudy":return new Af(1,1);case"rainy":return new Af(.4,1.2);case"snowy":return new Af(.5,1.3);case"foggy":return new Af(.2,1.6)}}function sG(e,t){let i=(e[0]+e[1]+e[2])/3;e[0]+=(i-e[0])*t,e[1]+=(i-e[1])*t,e[2]+=(i-e[2])*t}var UI=dt(.01,.01,.01),$I=dt(1,.6,.5),ZI=dt(1,.98,.98),nG=dt(1,1,1),HI=dt(.8,.8,1),QI=dt(.8,.8,1),KI=dt(.98,.98,1),oG=dt(1,1,1),jI=m_(.01,tn.local.ambientAtNight),YI=m_(tn.local.directAtTwilight,tn.local.ambientAtTwilight),XI=m_(.9*tn.local.directAtNoon,tn.local.ambientAtNoon),aG=m_(tn.local.directAtNoon,tn.local.ambientAtNoon),lG=XI,cG=ZI,dG=KI,hG=YI,uG=$I,mG=QI;function OK(e,t,i){let r=e.valueOf(),s,n;t.polarException===en.PolarException.MIDNIGHT_SUN?(s=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===en.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());let o=n-s,a=s+o/2,l=o/4,d=a-l,u=a+l,m=.06*o,p=s-m/2,f=s+m/2,g=n-m/2,_=n+m/2,y=ir(),v=b(),x=b(),S="";if(r<p||r>_)wr(y,jI),G(v,UI),G(x,HI),S="night";else if(r<f){let R=(r-p)/(f-p);eu(y,jI,YI,R),di(v,UI,$I,R),di(x,HI,QI,R),S="sun rising"}else if(r<d){let R=(r-f)/(d-f);eu(y,YI,XI,R),di(v,$I,ZI,R),di(x,QI,KI,R),S="early morning"}else if(r<a){let R=(r-d)/(a-d);eu(y,XI,aG,R),di(v,ZI,nG,R),di(x,KI,oG,R),S="late morning"}else if(r<u){let R=(r-a)/(u-a);eu(y,aG,lG,R),di(v,nG,cG,R),di(x,oG,dG,R),S="early afternoon"}else if(r<g){let R=(r-u)/(g-u);eu(y,lG,hG,R),di(v,cG,uG,R),di(x,dG,mG,R),S="late afternoon"}else if(r<_){let R=(r-g)/(_-g);eu(y,hG,jI,R),di(v,uG,UI,R),di(x,mG,HI,R),S="sun setting"}let C=0;switch(i){case"rainy":case"foggy":C=.8;break;case"snowy":C=.5}C>0&&(sG(v,C),sG(x,C));let E=_G(i);return{direct:{intensity:y[0]*E.direct,color:v},ambient:{intensity:y[1]*E.ambient,color:x},timeOfDay:S}}var pG=Ht(),GI=b(),qI=b(),kK=b(),WI=.25,LK=.2;var to=class extends ti.EventedAccessor{constructor(){super(),this._tmpLightParameters=new jy,this._defaultLightParameters=new jy,this._tmpDate=new Date,this._tmpTz={hours:0,minutes:0,seconds:0},this._viewHandlesKey="viewHandles",this._trackingEnabled=!1,this._mainLight=new uN,this._ambientLight=new dN,this._moonLight=new hN,this._disableProjectionEngineAutoLoad=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!!this._renderer?.updating||!this._canProjectCameraPosition}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===we.Global&&yL(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionGeographic(){return this._referencePositionGeographic}get _canProjectCameraPosition(){let e=this._view?.stateManager?.camera?.position?.spatialReference??gt.WGS84,t=FI(e);return this._disableProjectionEngineAutoLoad||el(e,t)}connectView(e){if(this._renderer)return;this._renderer=new th({view:e});let t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this.addHandles([T(()=>e.environment.lighting,r=>this._updateLightingHandler(r),Re),T(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,r=>this._lightingDateHandler(r),Re),T(()=>e.environment.lighting.directShadowsEnabled,t,Re),T(()=>e.qualitySettings.ambientOcclusion,t,Re),T(()=>e.qualitySettings.reflections,t,Re),T(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Re),T(()=>e.environment.weather.type,()=>this._updateLighting(null,ow.FadeWithWeather),Re),T(()=>this.weatherEnabled,()=>this._updateLighting(null,ow.FadeWithWeather),Re),T(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Ce),T(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,r=>this._updateCameraTracking(r),Ce),T(()=>e.state.camera,i,Ce),_r(()=>this._canProjectCameraPosition,i,Re)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=z(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{let t=this._view.environment.lighting;t?.type!=="virtual"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){let t=this._view.environment.lighting;if(t?.type!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated&&(this._preupdateTracking(e),this._referencePositionGeographic!=null)){let i=CE(this._referencePositionGeographic,this._tmpTz);i!=null&&(t.autoUpdate(null,i),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){let t=this._view;if(!t.ready)return;let i=t.stateManager.camera;if(!i)return;let{position:r}=i,s=r.spatialReference??gt.WGS84,n=FI(s),o=this._referencePositionGeographic??b();if(!md(r,o,n))return this._referencePositionGeographic=null,void this._updateLighting();this._referencePositionGeographic=o,this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(o,e)||this._updateLighting(e)}_updateLighting(e,t=ow.Immediate){let i=this._view,{lighting:r}=i.environment,s=r.type==="virtual",n=this._referencePositionGeographic,o=n!=null?this._tmpLightParameters:this._defaultLightParameters;if(n){e??=s?null:r.date;let p=this.weatherVisible?i.environment.weather.type:"disabled";fG(e,n,i.state.viewingMode,p,i.state.camera,o)}else s&&JI(i.state.camera,i.state.viewingMode,o.direct.directionToLightSource);let a=this._mainLight,l=o.direct;q(a.intensity,l.color,l.intensity*Math.PI),G(a.direction,l.directionToLightSource),a.specularStrength=o.specularStrength,a.environmentStrength=o.environmentStrength;let d=this._ambientLight;q(d.intensity,o.ambient.color,o.ambient.intensity);let u=this._moonLight;di(u.intensity,FK,NK,o.globalFactor);let m=(1-.5*o.globalFactor)*(1-.4*o.noonFactor*(1-o.globalFactor));q(u.intensity,u.intensity,m),G(u.direction,l.directionToLightSource),this._view._stage.renderer.updateLighting([a,d,u],o.noonFactor,o.globalFactor,t),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;let i=this._tmpDate;i.setTime((t||this._view.environment.lighting.date).getTime());let r=CE(e,this._tmpTz);if(r==null)return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===r.hours&&s.minutes===r.minutes&&s.seconds===r.seconds)return!1}else s=r;let n=i.getUTCHours()-(r.hours-s.hours),o=i.getUTCMinutes()-(r.minutes-s.minutes),a=i.getUTCSeconds()-(r.seconds-s.seconds);return i.setUTCHours(n),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){let e=this._view._stage;if(!e)return;let t=this._referencePositionGeographic==null||gG(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._referencePositionGeographic=null,e&&this._cameraHandler()}get test(){}};c([h({type:Boolean,readOnly:!0})],to.prototype,"updating",null),c([h()],to.prototype,"_disableProjectionEngineAutoLoad",void 0),c([h()],to.prototype,"_disableWeather",void 0),c([h()],to.prototype,"weatherEnabled",null),c([h()],to.prototype,"weatherVisible",null),c([h()],to.prototype,"referencePositionGeographic",null),c([h()],to.prototype,"_renderer",void 0),c([h()],to.prototype,"_referencePositionGeographic",void 0),c([h()],to.prototype,"_canProjectCameraPosition",null),to=c([w("esri.views.3d.environment.EnvironmentManager")],to);var FK=dt(.22,.22,.33),NK=dt(.22,.22,.22);var eD,jo=eD=class extends Wi{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new eD(this.cloneConstructProperties())}cloneConstructProperties(){let e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};c([h({readOnly:!0,type:["sun"],json:{write:!0}})],jo.prototype,"type",void 0),c([h({type:Date,json:{type:Number,write:{target:"datetime"}}})],jo.prototype,"date",void 0),c([kM("date",["datetime"])],jo.prototype,"readDate",null),c([Nm("date")],jo.prototype,"writeDate",null),c([h({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],jo.prototype,"directShadowsEnabled",void 0),c([kM("directShadowsEnabled",["directShadows"])],jo.prototype,"readDirectShadowsEnabled",null),c([Nm("directShadowsEnabled")],jo.prototype,"writedirectShadowsEnabled",null),c([h({type:Number,json:{write:!0}})],jo.prototype,"displayUTCOffset",void 0),c([Nm("displayUTCOffset")],jo.prototype,"writeDisplayUTCOffset",null),jo=eD=c([w("esri.webscene.SunLighting")],jo);var Dc=jo;var If,ih=If=class extends ti.EventedMixin(Dc){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};let t=new Date().getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new If(e.cloneConstructProperties())}set defaultDate(e){let t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){let i=If.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(e.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime()))));let s=If.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(dC.target=this,dC.timezoneOffset=s,this.emit("timezone-will-change",dC),dC.target=null),e!=null)return isNaN(e.getTime())||r!==e.getTime()}clone(){let e=this._get("date")===this._get("defaultDate"),t=new If(se(I({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled}));return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){let t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};c([h({type:Boolean})],ih.prototype,"cameraTrackingEnabled",void 0),c([h({type:Date})],ih.prototype,"defaultDate",null),c([h({type:Date})],ih.prototype,"date",null),ih=If=c([w("esri.views.3d.environment.SunLighting")],ih),function(e){function t({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}e.calculateTimezoneOffset=t}(ih||(ih={}));var dC={target:null,timezoneOffset:0},Pc=ih;var tD,Gy=tD=class extends Wi{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new tD(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};c([h({readOnly:!0,type:["virtual"],json:{write:!0}})],Gy.prototype,"type",void 0),c([h({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],Gy.prototype,"directShadowsEnabled",void 0),Gy=tD=c([w("esri.webscene.VirtualLighting")],Gy);var rh=Gy;var hC,uC=hC=class extends ti.EventedMixin(rh){constructor(e){super(e),this.cameraTrackingEnabled=!0}clone(){return new hC(se(I({},this.cloneConstructProperties()),{cameraTrackingEnabled:this.cameraTrackingEnabled}))}static fromWebsceneLighting(e){return new hC(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){let t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};c([h({type:Boolean})],uC.prototype,"cameraTrackingEnabled",void 0),uC=hC=c([w("esri.views.3d.environment.VirtualLighting")],uC);var Uu=uC;var yG={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Pc,virtual:Uu}};var vG={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Dc,virtual:rh}};var mC=class extends Wi{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};c([h({readOnly:!0,json:{read:!1}})],mC.prototype,"type",void 0),mC=c([w("esri.webscene.background.Background")],mC);var pC=mC;var iD,VK=se(I({},pF),{nonNullable:!0}),qy=iD=class extends pC{constructor(e){super(e),this.type="color",this.color=new Ar([0,0,0,1])}clone(){return new iD(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};c([$b({color:"color"},{readOnly:!0})],qy.prototype,"type",void 0),c([h(VK)],qy.prototype,"color",void 0),qy=iD=c([w("esri.webscene.background.ColorBackground")],qy);var fC=qy;var bG={base:pC,key:"type",typeMap:{color:fC}};function BK(e){return(t,i,r)=>{if(!t)return t;for(let s in e.typeMap)if(t.type===s){let n=new e.typeMap[s];return n.read(t,r),n}}}var wG={types:bG,json:{read:BK(bG),write:{overridePolicy:(e,t,i)=>({enabled:!i?.isPresentation})}}};var rD,xG=(e,t,i)=>({enabled:!i?.isPresentation}),sh=rD=class extends Wi{constructor(e){super(e),this.lighting=new Dc,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){ez(e?.type,V.getLogger(this))&&this._set("weather",e)}clone(){return new rD(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?rh.prototype.clone.call(this.lighting):Dc.prototype.clone.call(this.lighting),background:Xr(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};c([h({types:vG,nonNullable:!0,json:{write:!0}})],sh.prototype,"lighting",void 0),c([h(wG)],sh.prototype,"background",void 0),c([h({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:xG}}})],sh.prototype,"atmosphereEnabled",void 0),c([h({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:xG}}})],sh.prototype,"starsEnabled",void 0),c([h({types:JB,nonNullable:!0,json:{write:!0},value:new XB})],sh.prototype,"weather",null),sh=rD=c([w("esri.webscene.Environment")],sh);var gC=sh;var Wy,$y=Wy=class extends gC{constructor(e){super(e),this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(e){let t=e.cloneConstructProperties();return new Wy(se(I({},t),{lighting:t.lighting?t.lighting.type==="virtual"?Uu.fromWebsceneLighting(t.lighting):Pc.fromWebsceneLighting(t.lighting):void 0}))}castLighting(e){return this._convertLightingWithDestroy(e)}applyLighting(e){this.lighting=this._convertLightingWithDestroy(e)}_convertLightingWithDestroy(e){let t=this._convertLighting(e);return t!==e&&this.addHandles(jk(t)),t}_convertLighting(e){return e?e instanceof Pc||e instanceof Uu?e:e instanceof Dc?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(e):new Pc(I(I({},e.cloneConstructProperties()),this.lighting?.cloneNonPersistentConstructProperties())):e instanceof rh?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new Uu(I(I({},e.cloneConstructProperties()),this.lighting?.cloneNonPersistentConstructProperties())):tL(yG,e):new Pc}clone(){return new Wy({lighting:this.lighting.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Xr(this.background)})}cloneWithWebsceneEnvironment(e){return new Wy(se(I({weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Xr(this.background)},e.cloneConstructProperties()),{lighting:this._getLighting(e)}))}_getLighting(e){switch(e.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):Pc.fromWebsceneLighting(e.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):Uu.fromWebsceneLighting(e.lighting);default:return e.lighting,Pc.fromWebsceneLighting(e.lighting)}}};c([h({nonNullable:!0})],$y.prototype,"lighting",void 0),c([Lr("lighting")],$y.prototype,"castLighting",null),$y=Wy=c([w("esri.views.3d.environment.SceneViewEnvironment")],$y);var Hu=$y;var nt;(function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(nt||(nt={}));var Se;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(Se||(Se={}));var Fn;(function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"})(Fn||(Fn={}));var Bi=class{constructor(t=nt.ALL,i=Se.NONE,r=0,s=null,n=null,o=Fn.TUMBLE){this.selection=t,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=s,this.interactionDirection=n,this.tiltMode=o}};function nh(e,t){return!!(e&t)}function ju(e,t,i,r,s,n){e!==0&&(i?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):r!=null?(n.min-=Math.max(0,(t-n.min)*(1-r)),n.max+=Math.max(0,(t-n.max)*(1-r))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}var Sl=new Bi(nt.NONE);function _C(e,t,i,r){return t=t||e.viewForward,G(r,t),q(r,r,Math.sign(X(t,i))),r}function CG(e,t,i=Sl){let r=yC(e,t,i);if(r===0)return!1;let s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+r,o=_C(t,i.interactionDirection,HK(e,t,Math.sign(r),WK),qK),a=G($K,t.viewForward),l=s.intersectInfiniteManifold(ya(t.eye,o),n,sD);return t.eye=l??s.setAltitude(sD,n,t.eye),t.center=Mz(sD,t.eye,a,t.center),!0}function yC(e,t,i=Sl){if(!zK(e,i)||!e.state.constraints.altitude)return 0;let r=jK(e.state.constraints.altitude,GK);UK(e,i,r);let s=e.renderCoordsHelper.getAltitude(t.eye),n=U(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function zK(e,t){let i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(t.interactionType!==Se.TUMBLE||!nh(t.selection,nt.TILT))}function UK(e,t,i){let r=t.interactionType;if(r===Se.NONE)return;let{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;let l=r===Se.TUMBLE||r===Se.ZOOM,d=yC(e,o),u=d===0?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,ju(d,u,l,a,.05*u,i)}function HK(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),q(r,r,i),r}function jK(e,t){return t.min=e.min,t.max=e.max,t}var GK={min:0,max:0},qK=b(),WK=b(),$K=b(),sD=b();function wC(e,t,i=Sl){if(!e.state.isLocal)return 0;let r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;vC.min=0,vC.max=r,ZK(e,i,vC);let s=nD(e,t),n=vC.max-s;return n>=-1e-6?0:n}function SG(e,t,i=Sl){let r=wC(e,t,i);if(r===0)return!1;let s=e.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;let n=nD(e,t)+r,o=G(KK,t.eye),a=_C(t,i.interactionDirection,QK(t,s.renderLocation,JK),XK);if(!fd(PF(s.renderLocation,n),ya(t.eye,a),bC))return!1;t.eye=bC;let l=ge(YK,t.eye,o);t.center=te(bC,t.center,l);let d=e.renderCoordsHelper.getAltitude(t.center),u=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,d,bC);return u!=null&&(t.center=u),!0}function ZK(e,t,i){let r=t.interactionType;if(r===Se.NONE)return;let{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;let l=r===Se.ZOOM||r===Se.PAN,d=wC(e,o),u=d===0?0:nD(e,o);i.min=s,i.max=n,ju(d,u,l,a,.05*u,i)}function nD(e,t){let i=e.pointsOfInterest.surfaceOrigin;return i.renderLocation?Ai(t.eye,i.renderLocation):0}function QK(e,t,i){return $m(i,e.eye,t)}var vC={min:0,max:0},KK=b(),YK=b(),XK=b(),JK=b(),bC=b();function Go(e,t,i=rn.EYE){let r=e.state.constraints;if(!r.collision.enabled)return!1;let s=_p(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;let a=be(t.eye);if(ge(xC,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(eY,o,t.eye),i===rn.EYE_AND_CENTER)t.center=te(xC,t.eye,xC);else if(i===rn.EYE_AND_CENTER_SCALE){let l=(a-n+o)/a;t.center=q(xC,t.center,l)}return!0}var rn;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(rn||(rn={}));var xC=b(),eY=b();function aD(e,t,i,r=!0){Zy.eyeCenterDistance=0,Zy.requiresTwoSteps=!1;let s=SC(e,t,i,Sl,Zy);if(s===0)return!1;switch(Co(CC,-s,t.viewRight),i.tiltMode){case Fn.LOOK_AROUND:fi(oh,t.viewForward,CC),q(oh,oh,Zy.eyeCenterDistance),t.center=te(ah,t.eye,oh);break;case Fn.TUMBLE:ge(oh,t.center,t.eye),fi(oh,oh,CC),t.eye=ge(ah,t.center,oh);break;default:i.tiltMode}return t.up=fi(ah,t.up,CC),!Zy.requiresTwoSteps||!r||aD(e,t,i,!1)}function SC(e,t,i,r=Sl,s){if(!e.state.constraints.tilt)return 0;let n=t.distance,o=e.state.constraints.tilt(n,dY);return cY(e,i,o),r.interactionType===Se.TUMBLE&&nh(r.selection,nt.ALTITUDE)&&MG(e,r.interactionStartCamera,o),i.tiltMode===Fn.LOOK_AROUND||r.tiltMode===Fn.LOOK_AROUND?iY(e,t,o,s):tY(e,t,o)}function tY(e,t,i){let r=wa(e.renderCoordsHelper,t.center,t.eye),s=r-U(r,i.min,i.max);return Qy(s)?s:0}function iY(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return sY(e,t,i,r);case"local":return rY(e,t,i,r)}}function rY(e,t,i,r){let s=wa(e.renderCoordsHelper,t.center,t.eye),n=U(s,i.min,i.max),o=s-n;if(!Qy(o))return 0;if(r){let a=Math.abs(e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude),l=e.renderCoordsHelper.getAltitude(t.eye)-a,d=Math.max(Math.cos(n),1e-4);Math.abs(d)>1e-4?r.eyeCenterDistance=l/d:r.eyeCenterDistance=t.distance}return o}function sY(e,t,i,r){let s=nY(e,t,hY),n=U(s.tiltAtCenter,i.min,i.max);if(!Qy(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=oY(s),a=aY(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=lY(s,o)),r&&(r.eyeCenterDistance=oD(s,o)),a}function nY(e,t,i){let r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+ht(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,r,ah);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,n!=null?(i.eyeCenterDistance=Ai(t.eye,n),i.tiltAtCenter=wa(e.renderCoordsHelper,n,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=wa(e.renderCoordsHelper,t.center,t.eye):(gd(tp(ip,s),t.ray,ah),i.eyeCenterDistance=Ai(t.eye,ah),i.tiltAtCenter=vo(-X(t.viewForward,Z(ah,ah)))),i.radius=s,i.eyeRadius=be(t.eye),i.constraints=e.state.constraints,i}function Qy(e){return Math.abs(e)>1e-9}function oY(e){let{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e,s=r,n=t.clampTilt(i,r),o=oD(e,n);if(t.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&Qy(n-s);){let l=(s+n)/2,d=oD(e,l);Qy(t.clampTilt(d,l)-l)?s=l:n=l,a++}return n}function oD(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;let i=Math.PI-U(t,0,Math.PI),r=Vm(e.radius/e.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(e.eyeRadius<e.radius&&n>1){let o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*e.eyeRadius}return n*e.eyeRadius}function aY(e,t){let i=Vm(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=Vm(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function lY(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function cY(e,t,i){if(t.interactionType===Se.NONE)return;let{interactionStartCamera:r,interactionFactor:s}=t;if(!r)return;let{min:n,max:o}=i,a=SC(e,r,Sl,t),l=a===0?0:wa(e.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,t.interactionType===Se.TUMBLE?(nh(t.selection,nt.ALTITUDE)&&MG(e,r,i),ju(a,l,!0,s,TG,i)):ju(a,l,!1,s,TG,i)}function MG(e,t,i){let r=e.state.constraints;if(e.state.isLocal||!r.altitude||!t)return;let s=ds(t.center),n=Math.sqrt(s),o=t.distance,a=ht(e.spatialReference).radius,l=r.altitude.min+a,d=r.altitude.max+a,u=(l*l-o*o-s)/(-2*n*o),m=(d*d-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-vo(m),i.max)),i.max=Math.min(i.max,Math.PI-vo(u))}var oh=b(),CC=Ht(),ah=b(),TG=Vt(5),dY={min:0,max:0},hY={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},Zy={eyeCenterDistance:0,requiresTwoSteps:!1};function Tt(e,t,i=fY,r=t){r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);let s=!1;for(let a=0;a<gY;a++){let l=0;for(let d of pY)if(nh(i.selection,d.type)){let u=Math.abs(d.error(e,r,i));d.apply(e,r,i)&&(s=!0,l+=u)}if(l===0)break}let n=nh(i.selection,nt.COLLISION),o=uY(i.interactionType,e);return n&&Go(e,r,o)&&(s=!0),s&&r.computeUp(e.state.viewingMode),s}function uY(e,t){switch(e){case Se.PAN:return rn.EYE_AND_CENTER;case Se.ASCEND:return t.state.isGlobal?rn.EYE_AND_CENTER_SCALE:rn.EYE_AND_CENTER;default:return rn.EYE}}function Ls(e){let t=Math.min(1,e/150);return JA(t)}function mY(e,t,i){return SC(e,t,i)*t.distance}var pY=[{type:nt.TILT,error:mY,apply:aD},{type:nt.ALTITUDE,error:yC,apply:CG},{type:nt.DISTANCE,error:wC,apply:SG}],fY=new Bi,gY=5;var Ky=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(t){this.viewingMode=t,this.center=b(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=Ws(EG),this._fov=55,this._size=1}pixelsPerPanAtZoom(t){return this._size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this._size/2/(this._zoomToPanScale*t)}pixelsPerRotate(){let t=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/t}compareTo(t,i){if(this.viewingMode===we.Global){let n=(be(this.center)+be(t.center))/2;i.pan=Jm(this.center,t.center)*n}else i.pan=Ai(this.center,t.center);let r=Math.abs(t._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);let s=Math.abs(t._pitch-this._pitch);i.rotate=Math.max(r,s),i.fov=t.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=t._distance}interpolate(t,i,r){this.viewingMode===we.Global?TF(t.center,i.center,r.pan,this.center):di(this.center,t.center,i.center,r.pan),this._distance=isFinite(i.distance)?Ke(t.distance,i.distance+r.zoomOffset,r.zoom):t.distance,this._pitch=Ke(t.pitch,i.pitch,r.rotate);let s=t._yaw,n=i._yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this._yaw=Ke(s,n,r.rotate),this._fov=Ke(t.fov,i.fov,r.fov)}copyFrom(t){G(this.center,t.center),this._pitch=t.pitch,this._yaw=t.yaw,this._distance=t.distance,G(this.direction,t.direction),this._size=t.size,this._fov=t.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){let i=this._lookAtOrientation(t.center,RG);G(this.center,t.center),ge(Cs,t.center,t.eye),Rn(Cs,Cs,i),Rn(ch,t.up,i),this._distance=be(Cs),this._distance!==0&&(Cs[0]/=this._distance,Cs[1]/=this._distance,Cs[2]/=this._distance),this._pitch=_Y(Cs),this._yaw=yY(Cs,ch),this._size=Math.sqrt(t.width*t.width+t.height*t.height),this._fov=t.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(t){let i=this._lookAtOrientation(this.center,RG);hd(i,i),this._axisAngleVec3(TC,this._pitch-Math.PI/2,EG,Cs),this._axisAngleVec3(Gu,this._yaw,Cs,Cs),this._axisAngleVec3(TC,this._pitch-Math.PI/2,Gu,ch),this._axisAngleVec3(Gu,this._yaw,ch,ch),q(Cs,Cs,this._distance),Rn(Cs,Cs,i),Rn(ch,ch,i),t.center=this.center,t.eye=ge(Cs,this.center,Cs),t.up=ch,t.fov=this._fov}_axisAngleVec3(t,i,r,s){let n=Math.cos(i),o=Math.sin(i);return q(io,r,n),Ct(Nn,t,r),q(Nn,Nn,o),q(lh,t,(1-n)*X(t,r)),te(s,te(s,io,Nn),lh)}_lookAtOrientation(t,i=un()){return this._upAtLookAt(t,lh),Ct(io,this.direction,lh),Z(io,io),io[0]===0&&io[1]===0&&io[2]===0&&G(io,TC),Ct(Nn,lh,io),Z(Nn,Nn),i[0]=io[0],i[1]=Nn[0],i[2]=lh[0],i[3]=io[1],i[4]=Nn[1],i[5]=lh[1],i[6]=io[2],i[7]=Nn[2],i[8]=lh[2],i}_upAtLookAt(t,i){return this.viewingMode===we.Local?G(i,Gu):Z(i,t)}};function _Y(e){return Math.PI-Jm(Gu,e)}function yY(e,t){let i=vY;return Math.abs(t[2])<.5?(G(i,t),e[2]>0&&q(i,i,-1)):G(i,e),Ct(Nn,i,Gu),Z(Nn,Nn),Jm(TC,Nn,Gu)}var io=b(),Nn=b(),lh=b(),Cs=b(),ch=b(),vY=b(),Gu=ZL,EG=$L,TC=WL,RG=un();var MC=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(t){this.currentTime=0,this._animation=new Px(()=>new Ky(t)),this._current=new Ky(t)}update(t,i,r){let{source:s,target:n}=this._animation.definition,o=ge(bY,i.center,t.center),a=be(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),G(s.direction,o),G(n.direction,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,t.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(t,i){this._animation.cameraAt(t,this._current),this._current.copyToRenderCamera(i)}step(t,i){this.finished||(this.currentTime=this.currentTime+Eb(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}},bY=b();var Bt;(function(e){e[e.Ready=0]="Ready",e[e.Rejected=1]="Rejected",e[e.Running=2]="Running",e[e.Stopped=3]="Stopped",e[e.Finished=4]="Finished"})(Bt||(Bt={}));var qo=class extends k{constructor(e){super(e),this.state=Bt.Ready}get running(){return this.state===Bt.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Bt.Stopped,!0)}finishController(){this.state=Bt.Finished}get steppingFinished(){return!1}};c([h({constructOnly:!0})],qo.prototype,"view",void 0),c([h({readOnly:!0})],qo.prototype,"running",null),c([h()],qo.prototype,"state",void 0),c([h({readOnly:!0})],qo.prototype,"isInteractive",null),qo=c([w("esri.views.3d.state.controllers.CameraController")],qo);var dh=class extends qo{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(cs()),this._asyncResult=null),this.state===Bt.Finished||this.state===Bt.Stopped?(Hk(e),this.state===Bt.Finished?e.resolve():e.reject(cs())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Bt.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!this.viewAnimation||this.state!==Bt.Ready&&this.state!==Bt.Running||(this.viewAnimation.state===Xs.State.FINISHED?this.finish():this.viewAnimation.state===Xs.State.STOPPED&&(this.state=Bt.Stopped))}onControllerEnd(e){this.viewAnimation==null||this.viewAnimation.done||(this.state===Bt.Finished?this.viewAnimation.finish():this.state===Bt.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Bt.Finished?this._asyncResult.resolve():this._asyncResult.reject(cs()))}finish(){this.finishController()}};dh=c([w("esri.views.3d.state.controllers.AnimationController")],dh);var Tl=class extends dh{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.type="point-to-point",this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new MC(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new Xs}get isInteractive(){return this.mode==="interaction"}begin(e,t){this._hasTarget=!0;let i=this.animationSettings(t);EC.copyFrom(this.view.state.camera);let r=mn(this.view.state.viewingMode);this._intersectionHelper.intersectRay(EC.ray,r,AG)&&(EC.center=AG),this.animation.update(EC,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,t){this._hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return se(I({apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0}},e),{easing:typeof e.easing=="string"?b5[e.easing]:e.easing})}};c([h({constructOnly:!0})],Tl.prototype,"mode",void 0),c([h({readOnly:!0})],Tl.prototype,"isInteractive",null),Tl=c([w("esri.views.3d.state.controllers.PointToPointAnimationController")],Tl);var EC=new St,AG=b();function lD(e){return e!=null&&"type"in e&&e.type==="point-to-point"}function qu(e=xY){return[e[0],e[1],e[2],e[3]]}function Oc(e,t){return wY(e[0],e[1],e[2],t,CF.get())}function wY(e,t,i,r,s=qu()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Df(e,t,i){return Ct(i,e,t),Z(i,i),i[3]=p0(e,t),i}var xY=[0,0,1,0],TLe=g_(),MLe=g_();function Yy(e,t,i,r){let s=gl(t,i,CY);return fd(e,s,r)}var CY=Zn();var uh;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(uh||(uh={}));var VC=30,kf=[1,3e8],Ml=80,BC=8,zC=200,UC=1508e5,HC=5,jC=50,BG=5,zG=10,GC=90,Vn={exclude:new Set([cc])};function El(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function Jy(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function ro(e,t,i){let r=Co(SF.get(),i[3],i);r==null||JL(r,ud)||(ge(qt,e.eye,t),fi(qt,qt,r),e.eye=te(qt,qt,t),ge(qt,e.center,t),fi(qt,qt,r),e.center=te(qt,qt,t),e.up=fi(qt,e.up,r))}function UG(e,t,i,r){return y0(e,hw(t,i,_D),r)}function ev(e,t,i,r){return y0(e,gl(t,i,_D),r)}function Lf(e,t,i,r){let s=Si.get(),n=1-i;ge(s,t,e.eye);let o=be(s),a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(q(s,s,n),e.eye=te(qt,e.eye,s),e.center=di(qt,e.center,t,n))}function qC(e,t,i){t.getScreenCenter(IG),Yy(e,t,IG,qt)&&(t.center=qt);let r=t.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;let n=q(Si.get(),t.viewForward,s);t.eye=ge(qt,t.center,n)}var IG=ri();function WC(e,t){ve(t,0,0,0);for(let i of e)te(t,t,i);q(t,t,1/e.length)}function tv(e,t,i,r){return Math.sin(e/be(t))*(i+r.radius)}function hD(e,t,i,r){return tv(Math.PI/2,t,i,r)+(e-Math.PI/2)}var Sr;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(Sr||(Sr={}));var DG={Elevation:3e4,Angle:Vt(16)},RC={Pole:.95,Angle:Vt(18),Tilt:45},HG=Vt(80);function $C(e,t,i,r,s,n){let o=b(),a=Nr(),l=!0,d=!0;return e.intersectScreen(i,o,n)?a[3]=be(o):(d=!1,t.aboveGround&&s!==uh.Ellipsoid?a[3]=Math.max(be(t.center),.9*r.radius):a[3]=be(t.eye)-t.relativeElevation,s===uh.Silhouette?mh(a,t,i,o):l=Yy(a,t,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:d}}function Rl(e,t,i,r){let s=e.relativeElevation;if(s>DG.Elevation&&r==="global")return Sr.Horizontal;gl(e,t,dD);let n=Math.sign(s),o=i.worldUpAtPosition(e.eye,qt);return-n*X(o,dD.direction)<Math.sin(DG.Angle)*be(dD.direction)?Sr.Vertical:Sr.Horizontal}function ZC(e,t,i){ge(cD,i,t),e.eye=ge(qt,e.eye,cD),e.center=ge(qt,e.center,cD)}var cD=b();function mh(e,t,i,r){let s=gl(t,i,_D);return s!=null&&(gd(e,s,AC),fd(e,s,r)?!(Mo(AC,s.origin)<Mo(r,s.origin))||(G(r,AC),!1):(ge(Pf,t.eye,t.center),Z(Pf,Pf),g0(Pf,-X(Z(Pf,Pf),AC),PG),y0(PG,s,r),!1))}var AC=b(),Pf=b(),PG=ac();function uD(e,t,i,r,s,n){let o=0;if(Ct(NC,e,t),ge(OC,e,t),be(e)<=s||!r.aboveGround){Ct(i,OC,r.eye);let a=X(e,t)/(be(e)*be(t));if(a<.9999)o=vo(a);else{let d=be(Ct(b(),e,t))/(be(e)*be(t));o=Vm(d)}let l=Math.cos(U(ba.normalize(Vt(n)),0,HG));o=-o-Math.max(0,be(t)-s)/(l*s)}else ge(OG,r.eye,r.center),Ct(i,OC,OG),o=-be(OC)/s;return Z(i,i),q(i,i,be(NC)),o}var OG=b();function kG(e,t,i,r){let s,n,o=Math.cos(U(ba.normalize(Vt(r)),0,HG));return s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):vo(t/i),n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):vo(e/i),(n-s)*i}function SY(e,t,i,r,s,n,o,a,l,d){let u=kG(e[2],t[2],n[3],a),m=l?kG(e[0],t[0],n[3],180):t[0]-e[0],p=Math.sin(o)*m-Math.cos(o)*u,f=Math.cos(o)*m+Math.sin(o)*u;Z(qt,s);let g=l?p/Math.sqrt(Math.abs(n[3]**2-X(i,qt)**2)):p/n[3],_=f/Math.sqrt(Math.abs(n[3]**2-X(i,r)**2));En(d,g,_)}function mD(e,t,i,r,s,n,o,a,l,d){Ct(NC,e,t),I0(n.up,n.eye,IC,DC,PC),I0([0,0,1],n.eye,kc,hh,qG),G(i,hh),G(r,kc),Z(i,i),q(i,i,be(NC)),dE(e,Z(DC,DC),Z(PC,PC),Z(IC,IC),LG),dE(t,DC,PC,IC,FG),SY(LG,FG,e,kc,hh,o,a,l,d,s)}function TY(e,t,i,r,s,n,o){Co(LC,s,r),Co(FC,o,n),Gn(Of,LC,FC),ge(t,e,i),fi(t,t,Of),te(t,t,i)}function pD(e,t,i,r,s,n){Co(LC,r,i),Co(FC,n,s),Gn(Of,LC,FC),ge(qt,e.eye,t),fi(qt,qt,Of),e.eye=te(qt,qt,t),ge(qt,e.center,t),fi(qt,qt,Of),e.center=te(qt,qt,t),ge(qt,e.up,t),fi(qt,qt,Of),e.up=te(qt,qt,t)}function QC(e,t,i,r,s,n){return(Math.abs(r)>Math.PI-RC.Angle||Math.abs(r)<RC.Angle)&&(Math.abs(e[2])<i*RC.Pole||Math.abs(t)>i)&&n.aboveGround&&s<RC.Tilt}function fD(e,t,i,r,s,n){if(n)Df(i,r,NG),ro(t,e,NG);else{let o=uD(i,r,VG,t,e[3],s);ro(t,e,Oc(VG,o))}}function gD(e,t,i,r,s,n,o){let a=o?20:1,l=1e-12,d,u;G(Wu,r),kC.copyFrom(t);for(let m=0;m<a&&Mo(i,Wu)>l&&(d=Mo(i,Wu),mD(i,Wu,hh,kc,Xy,kC,e,s,n,o),pD(kC,e,kc,Xy[1],hh,Xy[0]),TY(Wu,Wu,e,kc,Xy[1],hh,Xy[0]),u=Mo(i,Wu),u<d||m===0);m++)t.copyFrom(kC)}function jG(e,t,i,r,s,n,o){QC(i,X(t.up,i),e[3],-ba.normalize(Vt(s)),n,t)?gD(e,t,i,r,-ba.normalize(Vt(s)),n,o):fD(e,t,i,r,n,o)}function MY(e,t,i,r,s,n){let{eye:o}=e;I0([0,0,1],o,kc,hh,qG);let a=t.translation[0]*i.pan,l=s.mode==="zoom"?0:t.translation[1]*i.pan,d=Math.max(Math.sqrt(Math.abs(1-X(e.center,kc)**2/be(e.center)**2)),.5),u=(Math.sin(n)*l+Math.cos(n)*a)/d,m=-Math.cos(n)*l+Math.sin(n)*a;switch(xo(r.pan.matrix,r.pan.matrix,u,kc),r.pan.enabled=!0,s.mode){case"pan":xo(r.pan.matrix,r.pan.matrix,m,hh),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function EY(e,t,i,r,s){let{eye:n,viewRight:o}=e,a=Ct(Si.get(),o,n),l=t.translation[0]*i.pan;switch(l!==0&&(xo(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{let d=t.translation[1]*i.pan;d!==0&&(xo(r.pan.matrix,r.pan.matrix,d,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function GG(e,t,i,r,s,n,o,a,l){QC(e.center,X(e.up,e.center),be(e.center),-ba.normalize(Vt(n)),o,t)?MY(t,i,r,a,l,-ba.normalize(Vt(s))):EY(t,i,r,a,l)}var kc=b(),hh=b(),qG=b(),IC=b(),DC=b(),PC=b(),LG=b(),FG=b(),Xy=ir(),NG=qu(),LC=Ht(),FC=Ht(),Of=Ht(),Wu=b(),qt=b(),OC=b(),kC=new St,NC=b(),VG=b(),_D={origin:b(),direction:b()},dD={origin:b(),direction:b()};var WG=.6,yD=4,RY=60,Ff=class extends Tl{constructor(){super(...arguments),this._zoomLocation=b(),this._tmpCamera=new St,this._tmpViewDir=b(),this._tmpRayDir=Zn(),this._targetOnSphere=b(),this._tmpCenter=b(),this._beginCamera=new St,this._constraintOptions=new Bi(nt.ALL_EXCEPT_COLLISION,Se.ZOOM,null,this._beginCamera),this._sphere=Nr()}initialize(){this._intersector=mn(this.view.state.viewingMode)}step(e,t){if(!this.running)return;let i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera);let r=!1,s=!1;this._intersectionHelper.intersectScreen(t,this._zoomLocation,this.view.map.ground.opacity===0?Vn:{})&&(r=e>0,s=!0),this._tmpCamera.copyFrom(i.camera),r?this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:G(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,t,s),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:qd}}_updateCamera(e,t,i,r){let s=Rl(e,i,this.view.renderCoordsHelper,this.view.viewingMode),n=Math.abs(this.view.camera.position.z),o=this._zoomLocation;Z(YC,e.eye),q(YC,YC,-1),gl(e,i,this._tmpRayDir),Z(this._tmpRayDir.direction,this._tmpRayDir.direction);let a=U(Math.min(BC,1/Math.abs(X(YC,this._tmpRayDir.direction)))*n,zC,UC);if(s===Sr.Horizontal){let l=WG**t;this._sphere[3]=be(o),ge(this._tmpViewDir,e.center,e.eye);let d=Math.min(be(this._tmpViewDir),a),u=d*l;if(l<=1&&u<yD&&(u=yD,l=u/d),Math.abs(d-u)<1e-6)return;let m=be(e.center);if(this._sphere[3]!==m){let p=this._sphere[3]+l*(m-this._sphere[3]);e.center=q(KC,e.center,p/m)}q(this._tmpViewDir,this._tmpViewDir,-l),e.eye=te(KC,e.center,this._tmpViewDir),Tt(this.view,e,this._constraintOptions),Mo(o,e.center)>1e-12&&Yy(this._sphere,e,i,this._targetOnSphere)&&jG(this._sphere,e,o,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let l=WG**Math.abs(t),d=t>0?1:-1;ge(this._tmpViewDir,o,e.eye);let u=be(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,i[0],i[1],this.view.state.camera,RY),p=m??a;p=r&&t>0?Math.min(p,u):p,q(this._tmpRayDir.direction,this._tmpRayDir.direction,p),te(o,this._tmpRayDir.origin,this._tmpRayDir.direction);let f=p*l,g=Math.max(yD,1.01*e.nearFar[0]);if(t>0&&f<g&&(f=g,l=f/p),Math.abs(p-f)<1e-6)return;q(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-l)),e.eye=te(KC,e.eye,this._tmpRayDir.direction),e.center=te(KC,e.center,this._tmpRayDir.direction)}Go(this.view,e)}};Ff=c([w("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],Ff);var KC=b(),YC=b();var AY=.6,IY=4,DY=60,Nf=class extends Tl{constructor(){super(...arguments),this._zoomLocation=b(),this._tmpCamera=new St,this._tmpRayDir=b(),this._tmpCenter=b(),this._beginCamera=new St,this._constraintOptions=new Bi(nt.ALL,Se.ZOOM,null,this._beginCamera)}step(e,t){if(!this.running)return;let i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(i.camera);let r=mn(this.view.state.viewingMode),s=!1;e>0?(s=this._intersectionHelper.intersectScreenFreePointFallback(t,this._zoomLocation,this.view.map.ground.opacity===0?Vn:{}),this._intersectionHelper.intersectRay(this._tmpCamera.ray,r,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this._intersectionHelper.intersectRay(this._tmpCamera.ray,r,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:G(this._zoomLocation,this._tmpCamera.center);let n=AY**e,o=this.view._stage.renderView.getMinimalDepthForArea(pc(this.view),t[0],t[1],this.view.state.camera,DY);ge(XC,this._tmpCamera.eye,this._zoomLocation),Z(XC,XC);let a=U(Math.min(BC,1/Math.abs(X(PY,XC)))*Math.abs(this.view.camera.position.z),zC,UC);if(o=o??a,o){let l=b();ge(l,this._zoomLocation,this._tmpCamera.eye),(o<be(l)||!s)&&(Z(l,l),te(this._zoomLocation,this._tmpCamera.eye,q(l,l,o)))}this._updateCamera(this._tmpCamera,n,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:qd}}_updateCamera(e,t,i){ge(this._tmpRayDir,i,e.eye);let r=be(this._tmpRayDir),s=r*t,n=t<=1,o=Math.max(IY,1.01*e.nearFar[0]);s!==0&&(n&&s<o&&(s=o,t=s/r),Math.abs(r-s)<1e-6||(q(this._tmpRayDir,this._tmpRayDir,t),e.eye=ge($G,i,this._tmpRayDir),e.center=di($G,e.center,i,1-t),Tt(this.view,e,this._constraintOptions)))}};Nf=c([w("esri.views.3d.state.controllers.ZoomStepControllerLocal")],Nf);var $G=b(),PY=dt(0,0,1),XC=b();var JC=class extends Ge{constructor(t,i){super(!0),this._view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(t){let i=t.data;if($d(i,"primary")){let r=this._view.state.isGlobal?new Ff({view:this._view,mode:"animation"}):new Nf({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.step(Math.log(.5)/Math.log(.6),ri(i.x,i.y)),t.stopPropagation()}}};function ZG(e,t,i){return e===we.Global?new bD(i):new vD(t,i)}var vD=class{constructor(t,i){this._elevationProvider=t,this._referenceEllipsoid=ht(i),this._unitInMeters=Zh(i,this._referenceEllipsoid.metersPerDegree)}compute(t,i,r,s,n){n||(n={near:0,far:0});let o=t[2]*this._unitInMeters,a=o,l=o-s,d=this._elevationProvider?.visibleElevationBounds;d&&(o=l>=0?a-this._unitInMeters*d.min:this._unitInMeters*d.max-a);let u={x:(r=r??new vi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},m=Math.max(u.x,u.y,u.z);ge($u,i,t),Vf[0]=$u[0]>0?r.xmax:r.xmin,Vf[1]=$u[1]>0?r.ymax:r.ymin,Vf[2]=$u[2]>0?m/2:-m/2,ge(Vf,Vf,t),Z($u,$u);let p=1.1*X(Vf,$u)*this._unitInMeters,f=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),_=g*LY*this._unitInMeters,y=g*FY*this._unitInMeters,v=U((o-y)/(_-y),0,1)**3,x=Math.min(Ke(f,p,v),f)*Math.max(Math.log(Math.abs(l)),1);return QG(Math.min(x,Math.max(34064e4,m))/this._unitInMeters,OY,this._unitInMeters,n)}},bD=class{constructor(t){this._referenceEllipsoid=ht(t)}compute(t,i,r,s,n){n||(n={near:0,far:0});let o=be(t),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),d=Math.abs(a-s),u=Math.max(d,Math.abs(a)),m=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return QG(1.2*Ke(m,p,Ap(u)),U(2e4-(Math.log(u)-7.983)/9.011*19900,100,2e4),1,n)}};function QG(e,t,i,r){let s=kY/i;return e/t>s?(r.far=e,r.near=r.far/t):(r.near=s,r.far=r.near*t),r}var OY=2e4,kY=2,LY=.001,FY=1e-4,Vf=b(),$u=b();var iv=class extends k{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;let t=this.view.state.camera;e.spatialReference!=null&&K0(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>Go(this.view,e,rn.EYE_AND_CENTER))}};c([h({constructOnly:!0})],iv.prototype,"view",void 0),iv=c([w("esri.views.3d.state.SurfaceCollisionConstraint")],iv);var Bf=class extends k{constructor(e){super(e),this.nearFarHeuristic=ZG(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([T(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),T(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),T(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Re),T(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),Re),T(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),Re),T(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),Re),T(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),Re),T(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),Re)]),this.view.state.isLocal&&this.addHandles(T(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),ie)),this._updateNearFar(),this.view.state.viewingMode!==we.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new iv({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){let e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(t=>KG(t,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){let t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?KG(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,_p(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCollision(){let e=this.view.map?.ground?.navigationConstraint?.type,t=!e||e==="stay-above",i=this.view.state.constraints.collision;if(t!==i.enabled){i.enabled=t,t&&this._reapplyConstraints(nt.COLLISION);let r=this.view.constraints&&this.view.constraints.tilt;r&&r.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){let e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==we.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){let e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){let e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){let t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Vt(e.max))}_updateTiltAuto(){let e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){let e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;let t=this.view.state.constraints;if(t.tilt){let i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(ec(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let t=Math.max(e.width,e.height);if(t<=0)return;e.zmax!=null&&e.zmin!=null&&(t=Math.max(t,e.zmax-e.zmin));let i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=nt.ALL){this.view.state.updateCamera(t=>Tt(this.view,t,new Bi(e,Se.NONE,null)))}};function KG(e,t){t&&(e.near=t.near,e.far=t.far)}c([h({constructOnly:!0})],Bf.prototype,"view",void 0),c([h({readOnly:!0})],Bf.prototype,"surfaceCollisionConstraint",void 0),Bf=c([w("esri.views.3d.state.ConstraintsManager")],Bf);var Zu=class extends qo{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Bt.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||K0(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),Go(this.view,e,rn.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Bt.Stopped)})}};c([h({constructOnly:!0})],Zu.prototype,"desiredCamera",null),Zu=c([w("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],Zu);var NY=.66;function XG(e){return 360-uE.normalize(e)}function sS(e){return uE.normalize(360-e)}function JG(e,t,i){let r=t.camera;if(r!=null)return BY(r,TE(e));let{targetGeometry:s}=t;if(s==null)return null;let{camera:n,mode:o}=e4(e,t.rotation,i);if(s.type==="point")return UY(e,t,s,n,o);let a=s.extent;return a==null?null:yp(e,a,n.heading,n.tilt,o)}function VY(e,t,i,r){return P(this,null,function*(){let s=t.camera;if(s!=null)return zY(s,TE(e),r);let{targetGeometry:n}=t;if(n==null)throw new Error("Viewpoint has no targetGeometry!");let{camera:o,mode:a}=e4(e,t.rotation,i);if(n.type==="point")return HY(e,t,n,o,a,r);let l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return RE(e,l,o.heading,o.tilt,a,r)})}function BY(e,t){let i=e.position,r;try{r=qM(i,t)}catch{return null}if(!r)return null;let s=e.clone();return s.position=r.clone(),s}function zY(e,t,i){return P(this,null,function*(){let r=e.position,s=yield Xh(r,t,{signal:i});Ut(i);let n=e.clone();return n.position=s.clone(),n})}function e4(e,t,i){let r=Cd(e,e.state.camera),s=On.ADJUST;return t!=null&&(r.heading=XG(t),s=On.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:s}}function UY(e,t,i,r,s){let n=e.spatialReference,o;try{o=qM(i.clone(),n)}catch{return null}if(!o)return null;let a=t.scale!=null?ME(e,t.scale):e.state.camera.distance;return gB(e,o,a,r,s)}function HY(e,t,i,r,s,n){return P(this,null,function*(){let o=e.spatialReference,a=yield Xh(i.clone(),o,{signal:n});Ut(n);let l=t.scale!=null?ME(e,t.scale):e.state.camera.distance;return X0(e,a,l,r,s,n)})}function t4(e,t,i=null){return i==null&&(i=new rr),MD(e,null,t.clone(),i)}function i4(e,t,i){return P(this,null,function*(){let r=XY(e,t);if(!r)throw new le("viewpointutils-create:no-target","Missing target for creating viewpoint");let s=new pn({fov:e.camera.fov}),n=new rr({camera:s});if(r.target instanceof rr)return Qu(yield qY(e,r.target,r,i,n));if(r.target instanceof pn)return Qu(yield s4(e,r.target,i,n));let o=r.scale!=null||r.zoom!=null;if(r.target instanceof vi){let d=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return Qu(o||d?yield CD(e,r,r.target.center,s,i,n):yield QY(e,r,r.target,s,i,n))}let a=new SD,l=o?jY(e,r):void 0;if(yield r4(e,r.target,l,a,i),isFinite(a.boundingBox[0])){let d;if(m2(a.boundingBox,Zi),so.x=Zi[0],so.y=Zi[1],so.z=Zi[2],so.spatialReference=e.spatialReference,isFinite(so.z)&&a.hasZ?d=g2(a.boundingBox):(so.z=void 0,d=OL(f2(a.boundingBox,eX))),o||d)return Qu(yield CD(e,r,so,s,i,n));let u=JY(e,a.screenSpaceObjects);return Qu(yield YY(e,r,so,a.boundingBox,u,s,i,n))}return r.position?Qu(yield $Y(e,r,s,n,i)):Qu(yield ZY(e,r,s,i,n))})}function TD(e,t){return t.scale==null&&t.zoom!=null?ew(e,t.zoom):t.scale}function jY(e,t){let i=TD(e,t);return i?FN(i):void 0}function nS(e,t){let i=!1;return t.heading!=null?(e.heading=t.heading,i=!0):t.rotation!=null&&(e.heading=XG(t.rotation),i=!0),t.tilt!=null&&(e.tilt=t.tilt,i=!0),t.fov!=null&&(e.fov=t.fov),i}function MD(e,t,i,r){let s=e.spatialReference||gt.WGS84;if(t??=Io(e,i),t==null)return r;let n=new je({spatialReference:s});return cE(t.center,e.renderSpatialReference,n)&&(r.targetGeometry=n,r.scale=Sd(e,t.distance),r.rotation=sS(i.heading),r.camera=i),r}function iS(e,t,i,r){return P(this,null,function*(){let s=()=>new le("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!t)throw s();t.type==="mesh"&&(t=t.extent);let n=e.basemapTerrain.spatialReference;if(!t.hasZ&&e.basemapTerrain){let m;switch(t.type){case"point":m=t;break;case"multipoint":case"polyline":m=t.extent?.center;break;case"extent":m=t.center;break;case"polygon":m=t.centroid}m!=null&&n&&e.elevationProvider?(m=yield Xh(m,n,{signal:r}),Zi[2]=I_(e.elevationProvider,m)??0):Zi[2]=0}let o=tX[t.type],a=new Array;if(o(t,t.hasZ?m=>{a.push([m[0],m[1],m[2]])}:m=>{a.push([m[0],m[1]])},Zi),a.length===0)throw s();let l=t.spatialReference,d=e.spatialReference,u=yield Xh(new ML({spatialReference:l,hasZ:t.hasZ,hasM:!1,points:a}),d,{signal:r});if(t.hasZ&&(i.hasZ=!0),t.hasZ)for(let[m,p,f]of u.points)Zi[0]=m,Zi[1]=p,Zi[2]=f,Zb(i.boundingBox,Zi);else for(let[m,p]of u.points)Zi[0]=m,Zi[1]=p,Zb(i.boundingBox,Zi)})}function GY(e,t,i,r,s){return P(this,null,function*(){let n=yield i_(e.whenViewForGraphic(t));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void(yield iS(e,t.geometry,r,s));let o=n.value,a=yield i_(o.whenGraphicBounds(t,{minDemResolution:i}));if(a.ok===!1||!a.value)return void(yield iS(e,t.geometry,r,s));let{screenSpaceObjects:l,boundingBox:d}=a.value;c2(r.boundingBox,d),l&&l.forEach(u=>{r.screenSpaceObjects.push(u)}),isFinite(d[2])&&(r.hasZ=!0)})}function r4(e,t,i,r,s){return P(this,null,function*(){if(Array.isArray(t)&&t.length===2){let n=t[0],o=t[1];if(typeof n=="number"&&typeof o=="number")return so.x=n,so.y=o,so.z=void 0,so.spatialReference=e.spatialReference?.isGeographic?e.spatialReference:gt.WGS84,void(yield iS(e,so,r,s))}t&&"map"in t&&typeof t.map=="function"?yield Promise.allSettled(t.map(n=>r4(e,n,i,r,s))):t instanceof bL?yield iS(e,t,r,s):t instanceof ga&&(yield GY(e,t,i,r,s))})}function qY(e,t,i,r,s){return P(this,null,function*(){if(t.camera)return s4(e,t.camera,r,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=t.targetGeometry!=null?t.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=sS(i.heading):i.rotation!=null&&(s.rotation=i.rotation);let n=TD(e,i);return n!=null&&(s.scale=n),s.camera=yield VY(e,s,i.tilt,r),s})}function s4(e,t,i,r){return P(this,null,function*(){let s=e.spatialReference,n=yield Xh(t.position,s,{signal:i}),o=t.clone();return o.position=n,MD(e,null,o,r)})}function WY(e,t,i,r,s,n,o){return P(this,null,function*(){let a=e.renderSpatialReference;return yield l0(t,wD,a,0,{signal:o}),yield l0(i,tS,a,0,{signal:o}),n.targetGeometry=new je(t),s.position=new je(i),ge(rS,wD,tS),EE(e,tS,rS,r.up,s),n.scale=Sd(e,Ai(tS,wD)),n.rotation=sS(s.heading),n.camera=s,n})}function CD(e,t,i,r,s,n){return P(this,null,function*(){n.targetGeometry=i.clone();let o=xd(e);if(t.position)return WY(e,n.targetGeometry,t.position,o,r,n,s);if(t.zoomFactor){let l=o.distance/t.zoomFactor,d=q(Zi,o.viewForward,-l);o.eye=te(Zi,o.center,d),n.scale=Sd(e,l)}Cd(e,o,r);let a=nS(r,t)?On.LOCKED:On.ADJUST;if(!t.zoomFactor){let l=TD(e,t);if(l==null){yield l0(n.targetGeometry,Zi,e.renderSpatialReference,0,{signal:s});let d=x_(o.frustum,Zi)?Ai(o.eye,Zi):o.distance;n.camera=yield X0(e,n.targetGeometry,d,r,a),n.scale=Sd(e,d)}else n.scale=l,n.camera=yield fB(e,n.targetGeometry,n.scale,r,a,s)}return n})}function $Y(e,t,i,r,s){return P(this,null,function*(){let n=xd(e);G(rS,n.viewForward),EE(e,n.eye,rS,n.up,xD);let o=e.spatialReference,{position:a}=t;if(a){let l=yield Xh(a,o,{signal:s});i.position=l}else i.position=new je;return i.heading=t.heading!=null?t.heading:xD.heading,i.tilt=t.tilt!=null?t.tilt:xD.tilt,MD(e,null,i,r)})}function ZY(e,t,i,r,s){return P(this,null,function*(){if(t.heading!=null||t.rotation!=null||t.scale!=null||t.tilt!=null||t.zoom!=null||t.zoomFactor!=null){let n=xd(e),{spatialReference:o,renderSpatialReference:a}=e,l=new je({spatialReference:o});return cE(n.center,a,l)?CD(e,t,l,i,r,s):s}return s.scale=e.scale,s.camera=e.camera.clone(),nS(s.camera,t),s})}function QY(e,t,i,r,s,n){return P(this,null,function*(){n.targetGeometry=i.clone();let o=xd(e);Cd(e,o,r);let a=nS(r,t)?On.LOCKED:On.ADJUST;return n.camera=yield RE(e,i,r.heading,r.tilt,a,s),n})}function KY(e,t,i,r,s){let n=0;i.z!=null?n=i.z:e.basemapTerrain&&e.elevationProvider&&(n=I_(e.elevationProvider,i)),ve(Zi,i.x,i.y,n),Z2(e.spatialReference,Zi,YG,e.renderSpatialReference),Zm(eS,YG),hd(eS,eS),rc(rv);let o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){let _=o[g],y=r[_[2]];isFinite(y)||(y=n),ve(Zi,r[_[0]],r[_[1]],y),sl(Zi,e.spatialReference,Zi,e.renderSpatialReference),Zb(rv,Rn(Zi,Zi,eS))}let a=d2(rv),l=u2(rv),d=h2(rv),u=1/Math.tan(t.fovX/2),m=1/Math.tan(t.fovY/2),p=.5*Math.sqrt(a*a+d*d)*Math.max(m,u)+.5*l,f=.5*l*m+.5*Math.max(a,d);return Math.max(p,f)/s}function YY(e,t,i,r,s,n,o,a){return P(this,null,function*(){a.targetGeometry=i.clone();let l=xd(e),d=KY(e,l,i,r,s);Cd(e,l,n);let u=nS(n,t)?On.LOCKED:On.ADJUST;return a.camera=yield X0(e,a.targetGeometry,d,n,u,o),a.scale=Sd(e,d),a})}function XY(e,t){if(!t||!e.spatialReference)return null;let i={target:void 0};return"declaredClass"in t||Array.isArray(t)?i.target=t:(Object.assign(i,t),!i.target&&"center"in t&&t.center&&(i.target=t.center)),i}function Qu(e){return e?.camera!=null&&(e.rotation=sS(e.camera.heading)),e}function JY(e,t){let i=NY;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){let n=t[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(e.width,e.height)*2}var SD=class{constructor(){this.hasZ=!1,this.boundingBox=rc(),this.screenSpaceObjects=new Array}},Zi=b(),YG=Ht(),eS=un(),rv=ld(),eX=ii(),rS=b(),tS=b(),wD=b(),xD={heading:0,tilt:0},so=new je,tX={point(e,t,i){i[0]=e.x,i[1]=e.y,e.z!=null&&(i[2]=e.z),t(i)},polygon(e,t,i){let r=e.hasZ;for(let s=0;s<e.rings.length;s++){let n=e.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},polyline(e,t,i){let r=e.hasZ;for(let s=0;s<e.paths.length;s++){let n=e.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},multipoint(e,t,i){let r=e.points,s=e.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),t(i)},extent(e,t,i){e.zmin!=null&&e.zmax!=null?(t(ve(i,e.xmin,e.ymin,e.zmin)),t(ve(i,e.xmax,e.ymin,e.zmin)),t(ve(i,e.xmin,e.ymax,e.zmin)),t(ve(i,e.xmax,e.ymax,e.zmin)),t(ve(i,e.xmin,e.ymin,e.zmax)),t(ve(i,e.xmax,e.ymin,e.zmax)),t(ve(i,e.xmin,e.ymax,e.zmax)),t(ve(i,e.xmax,e.ymax,e.zmax))):(t(ve(i,e.xmin,e.ymin,i[2])),t(ve(i,e.xmax,e.ymin,i[2])),t(ve(i,e.xmin,e.ymax,i[2])),t(ve(i,e.xmax,e.ymax,i[2])))}};var oS=class{constructor(t,i,r){this._target=t,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;let o=new AbortController;this._options.signal!=null&&$a(this._options.signal,()=>this.abort()),this._abortController=o,this._waitForReady()})}_resolve(t){if(this.state!=="finished")return this.state="finished",this._resolveCallback(t)}_reject(t){if(this.state!=="finished")return this.state="finished",this._rejectCallback(t)}abort(t=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!t&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.running&&this._animationController.stopController(),this._reject(cs())}_waitForReady(){return P(this,null,function*(){if(this.state="wait-for-ready",!this.view.ready)try{yield Gs(()=>this.view.ready,this._abortController.signal)}catch(t){return this._reject(t)}this._createViewPoint()})}_createViewPoint(){return P(this,null,function*(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{let t=yield i4(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;let i=t?this._getCameraFromViewpoint(t):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(t){this._reject(t)}}})}_getCameraFromViewpoint(t){let i=!!(this._target instanceof rr&&this._target.camera||this._target instanceof pn),r=t.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){let n=r.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference?.wkid;return this._reject(new le("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}let s=Io(this.view,r);return s==null?(this._reject(new le("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:i}}_startAnimation(t,i){this.state="wait-for-animation-finish";let r=i.viewAnimation;if(r==null)return void this._reject(new le("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(t.viewpoint,"running"),!i.running||i.viewAnimation==null||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;t.isFullySpecified?(s=new Zu({view:this.view,desiredCamera:t.camera}),Go(this.view,t.camera,rn.EYE_AND_CENTER)):Tt(this.view,t.camera),i.begin(t.camera,this._options);let n=()=>{let a=this.view.state.cameraController;s&&(a&&a.running?lD(a)&&a.viewAnimation!=null&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):i.viewAnimation!=null&&i.viewAnimation.target===t.viewpoint&&i.state===Bt.Finished&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(i.state){case Bt.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case Bt.Ready:case Bt.Rejected:case Bt.Running:case Bt.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t=null,i=null,r=this.view.state.cameraController;return lD(r)&&(r.updateStateFromViewAnimation(),r.running&&(t=r,i=t.viewAnimation)),t==null&&(t=new Tl({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t),t.state===Bt.Rejected)?(i?.stop(),this._reject(new le("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null):t}};var Qi=class extends k{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=n4,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(t){this.viewStateManager._idleTimeout=t?n4:0}},this._propertiesPool=new fn({frustum:Y0},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new AD}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([xi(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),T(()=>this.view.state?.camera,(e,t)=>this._cameraChangedHandler(e,t),Re)]),_r(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([As({prepare:()=>this._prepareFrame()}),T(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(lS)}),xi(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=z(this._propertiesPool)}get camera(){let e=this._get("camera");if(!this.ready)return e;let t=Cd(this.view,this.view.state.camera,ED);return t&&e&&t.equals(e)?e:t.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableCache(!0),this.setStateCamera(Io(this.view,e),{applyConstraints:!1})||V.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableCache(!1))}get contentCamera(){let e=this._get("contentCamera");if(!this.ready)return e;let t=Cd(this.view,this.view.state.contentCamera,ED);return t&&e&&t.equals(e)?e:t.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;let t=Io(this.view,e);t!=null?(this._updateElevation(t),this.view.state.contentCamera=t):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(RD),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;let t=this.zoom,i=this.view.state.camera.distance**2,r=jL(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([T(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(RD),this.test.contentCameraResetState.clear())}),T(()=>this.zoom,n=>{n!==void 0&&t!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),T(()=>this.view.state.camera,n=>{let o=Mo(r,n.center);this.test.contentCameraResetState.set("camera.center",o/i),o>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],RD),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():V.getLogger(this).error("#center=","Invalid center",e):V.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):V.getLogger(this).error("#center=","Center may not be null or undefined"))}get visibleArea(){if(!this.ready){let e=this._get("extent");return e?Xa.fromExtent(e):null}return yB(this.view,this.view.pointsOfInterest.focus.renderLocation)}get extent(){if(!this.ready)return this._get("extent");let e=this.view,t=J0(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return t??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||V.getLogger(this).error("#extent=","Invalid extent",e):V.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):V.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){let e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){let e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(!this.ready)return this._get("scale");let e=this.view.basemapTerrain.tilingScheme,t=this.view.pointsOfInterest.cameraOnSurface.scale;return e&&t?mB(this.view,t,this.view.state.contentCamera,e):this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||V.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");let e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),s=Math.round(t[Ds.TOP]/i),n=Math.round(t[Ds.RIGHT]/i),o=Math.round(t[Ds.BOTTOM]/i),a=Math.round(t[Ds.LEFT]/i);return r!=null&&r.top===s&&r.right===n&&r.bottom===o&&r.left===a?r:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,aS),this.view.state.updateCamera(t=>t.padding=aS))}_paddingToArray(e,t,i){e?So(i,e.top||0,e.right||0,e.bottom||0,e.left||0):So(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){let e=this.padding;return vr((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?t4(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||V.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{let t=e.camera!=null?e.camera.position:e.targetGeometry,i=t!=null&&t.spatialReference;V.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else V.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?vB(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||V.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;let e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),t=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*t),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*t);let i=this.view._stage.renderView.renderingContext?.parameters.maxTextureSize;return i&&Ym(this._tmpCanvasSize,i),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:t,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(Oo.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){let e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(Oo.PhysicalPixelRendering,Fi.IDLE)||e.isFeatureEnabled(Oo.PhysicalPixelRendering,Fi.INTERACTING)||e.isFeatureEnabled(Oo.PhysicalPixelRendering,Fi.ANIMATING))}preinit(e){return!(this._isOverridden("center")&&!el(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!el(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!el(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||el(this.viewpoint.targetGeometry?.spatialReference,e)&&el(this.viewpoint.camera?.position?.spatialReference,e))}init(){this._constraintsManager=new Bf({view:this.view}),this._prepareFrame();let e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(let t of e)this.set(t.name,t.value);if(!this._cameraSetByUser){let t=this._initialViewpoint||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===we.Local&&this.addHandles(_r(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(lS),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),lS)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(lS),this._constraintsManager=z(this._constraintsManager))}goTo(e,t){return P(this,null,function*(){return t=I({animate:!0},t),this._gotoOperation!=null&&this._gotoOperation.abort(t.animate),this._gotoOperation=new oS(e,t,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise})}debugSetCameraOnContent(){this.setStateCamera(xd(this.view),{applyConstraints:!1})}step(e){let t=this.view.state,i=t?.cameraController;i&&(t.updateCamera(r=>i.stepController(e,r)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){let e=new Set,t=[];for(let{propertyName:i,overrides:r}of rX){let s=e.has(i),n=this._isOverridden(i);!s&&n&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||n)&&r.forEach(o=>e.add(o))}return t}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof pn)return void this.setStateCamera(Io(this.view,e),{applyConstraints:!1});if(e instanceof rr){if(e.targetGeometry instanceof vi){let s=yp(this.view,e.targetGeometry,0,.5,On.LOCKED);return void(s!=null&&this.setStateCamera(Io(this.view,s),{applyConstraints:!0}))}let i={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,i)}let t=yp(this.view,e,0,.5,On.LOCKED);t!=null&&this.setStateCamera(Io(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&iX.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof rr?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof pn?this.isCompatible(e.position):e.spatialReference&&!I2(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=sX){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=ph){let{heading:r,tilt:s}=this._getPreservingHeadingTilt(),n=_B(this.view,r,s,e,t,On.ADJUST);return n==null?null:(i.copyFrom(this.view.state.camera),i.eye=n.eye,i.center=n.center,i.up=n.up,i)}_centerToCamera(e){let t;if(e.hasZ)t=this.view.state.camera.distance;else{let{centerOnContent:i}=this.view.pointsOfInterest;i.runTask(),t=i.distance}return this._centerPointAtDistanceToCamera(e,t)}_extentToCamera(e){let{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=yp(this.view,e,t,i,On.ADJUST,ED);return r?Io(this.view,r):null}_scaleToCamera(e){if(e==null)return null;let t=this.view,i=t.pointsOfInterest.centerOnContent;i.runTask();let r=i.renderLocation,s=t.pointsOfInterest.cameraOnSurface.renderLocation,n=pB(t,e,t.state.contentCamera,r,s);return this._centerPointAtDistanceToCamera(r,n)}_zoomToCamera(e){return this._scaleToCamera(ew(this.view,e))}_viewpointToCamera(e){return Io(this.view,JG(this.view,e))}setStateCamera(e,t){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up,i.fov=e.fov):i.copyFrom(e),t.applyConstraints&&Tt(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new Zu({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){let{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;let i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(t.width===i.width&&t.height===i.height||(t.width=i.width,t.height=i.height),this.view.state)){let r=this.view.state.camera;r.fullWidth===i.width&&r.fullHeight===i.height&&r.pixelRatio===i.pixelRatio||(ph.copyFrom(r),ph.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,aS),ph.padding=aS),ph.fullWidth=i.width,ph.fullHeight=i.height,ph.pixelRatio=i.pixelRatio,this.view.state.camera=ph),this._updateViewState()}}_updateElevation(e){let t=this.view.basemapTerrain?.spatialReference,i=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,r=t?_p(this.view,e.eye):0;e.relativeElevation=i-r}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Fi.ANIMATING:this.view.interacting?this.view.state.mode=Fi.INTERACTING:(this.view.state.mode===Fi.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=Fi.INTERACTING:this.view.state.mode=Fi.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};c([h({type:pn,dependsOn:["view.state.camera","ready"]})],Qi.prototype,"camera",null),c([h({type:pn,dependsOn:["view.state.contentCamera","ready"]})],Qi.prototype,"contentCamera",null),c([h({type:je})],Qi.prototype,"center",null),c([h()],Qi.prototype,"visibleArea",null),c([h({type:vi})],Qi.prototype,"extent",null),c([h({readOnly:!0})],Qi.prototype,"frustum",null),c([h()],Qi.prototype,"_constraintsManager",void 0),c([h({readOnly:!0})],Qi.prototype,"constraintsManager",null),c([h()],Qi.prototype,"_initialViewpoint",null),c([h({readOnly:!0})],Qi.prototype,"hasInitialView",null),c([h({readOnly:!0,type:Boolean})],Qi.prototype,"ready",void 0),c([h({type:Number})],Qi.prototype,"scale",null),c([h()],Qi.prototype,"padding",null),c([h({readOnly:!0})],Qi.prototype,"screenCenter",null),c([h({constructOnly:!0})],Qi.prototype,"view",void 0),c([h({type:rr})],Qi.prototype,"viewpoint",null),c([h({type:Number})],Qi.prototype,"zoom",null),c([h({readOnly:!0})],Qi.prototype,"_rasterPixelRatio",null),c([h({readOnly:!0})],Qi.prototype,"_usePhysicalPixelRendering",null),c([h({readOnly:!0})],Qi.prototype,"_usePhysicalPixelRenderingAny",null),c([h()],Qi.prototype,"_windowDevicePixelRatio",void 0),c([h()],Qi.prototype,"_devicePixelRatioOverride",void 0),Qi=c([w("esri.views.3d.state.ViewStateManager")],Qi);var AD=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}},iX=new Set(["camera","viewpoint","extent","scale","center","zoom"]),rX=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],sX={heading:0,tilt:0},ED=new pn,ph=new St,aS=br(),lS="pending-initial-view",RD="content-camera-reset",n4=300,ID=100;var Ss=class extends qo{constructor(){super(...arguments),this.startCamera=new St,this.currentCamera=new St,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<ID}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=Bt.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),ID),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};c([h({readOnly:!0})],Ss.prototype,"isInteractive",null),c([h()],Ss.prototype,"_lastInteraction",void 0),Ss=c([w("esri.views.3d.state.controllers.InteractiveController")],Ss);var Fs;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(Fs||(Fs={}));var Ku=class extends Ss{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Fs.CENTER,this._rotScale=0,this._lastPoint=ir(),this._tmpWorldUp=b(),this._tmpViewDir=b(),this._tmpRotCurPoint=ir(),this._tmpTransf=Ht(),this._tmpAxis=b(),this._tmpPivotPoint=b(),this._pivotPos=b(),this._constraintOptions=new Bi(nt.ALL,Se.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===Fs.CENTER?3:1.5}begin(e){if(this.running){switch(this.pivot){case Fs.EYE:G(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Se.LOOK_AROUND,this._constraintOptions.tiltMode=Fn.LOOK_AROUND,this._constraintOptions.selection=nt.NONE;break;case Fs.CENTER:{let t=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Vn:{});t||G(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Se.TUMBLE,this._constraintOptions.tiltMode=Fn.TUMBLE,this._constraintOptions.selection=nt.ALL&~nt.DISTANCE;break}}El(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,t){let i=this.startCamera,r=b();ge(r,this._pivotPos,i.eye);let s=be(r),n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,o4);let o=Math.max(Math.min(BG,1/Math.abs(X(o4,i.viewForward)))*n,zG);t&&(o=Math.min(s,o));let a=ri(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),l=Rl(this.startCamera,a,this.view.renderCoordsHelper,this.view.viewingMode),d=this.view._stage.renderView.getMinimalDepthForArea(pc(this.view),i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*GC,GC),u=this.view._stage.renderView.getMinimalDepthForArea(pc(this.view),e[0],e[1],i,GC);d==null&&u==null||(d=d??u??0,u=u==null||l===Sr.Horizontal?d:u,o=d>u?u:d,o=t?Math.min(o,s):o),Z(r,r),G(this._pivotPos,te(this._tmpPivotPoint,i.eye,q(this._tmpPivotPoint,r,o)))}update(e){if(this.running){switch(this.pivot){case Fs.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Fs.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Tt(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.running&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this._tmpWorldUp),El(e,t,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,n=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ge(this._tmpViewDir,i,r);let o=be(this._tmpViewDir),a=vo(X(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===Fs.EYE){s*=-.5;let l=.5*Math.PI-a,d=.5*Math.PI*.99;s=l-Math.max(-d,Math.min(d,l+s))}return s=U(s+a,jr.min,jr.max)-a,Ct(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Fs.CENTER&&(n=-n),Co(this._tmpTransf,n,this._tmpWorldUp),xo(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),fi(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=fi(DD,e.up,this._tmpTransf),te(DD,r,this._tmpViewDir),wr(this._lastPoint,this._tmpRotCurPoint),DD}};c([h()],Ku.prototype,"pivot",void 0),Ku=c([w("esri.views.3d.state.controllers.RotateController")],Ku);var DD=b(),o4=b();var zf=class extends Ge{constructor(t,i,r,s){super(!0),this._view=t,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){let i=t.data;if(i.pointers.size>1||!df(t.data,this.pointerAction))return;let r=ri(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new Ku({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}t.stopPropagation()}};var cS="esri-fov-overlay",dS={base:cS,outer:`${cS}-outer`,reset:`${cS}-reset`,text:`${cS}-text`},Al=class extends Jr{constructor(e){super(e),this.onReset=()=>{},this._messagesCommon=null,this._messagesUnits=null,this.fov=null}render(){return A("div",{class:dS.outer},A("div",{class:dS.base},A("p",{class:dS.text},this._overlay),A("p",{class:dS.reset,onclick:this.onReset,title:this._messagesCommon.reset},this._reset)))}get _overlay(){let{fov:e,_messagesUnits:t}=this;if(!t||e==null)return"";let i=jN(ec(e),"degrees","arithmetic","arithmetic",0),r=nX/(2*Math.tan(e/2));return`${i} | ${HN(t,r,"millimeters",0,"abbr")} |`}get _reset(){return this._messagesUnits&&this.fov!=null?"\u21BA":""}};c([h()],Al.prototype,"onReset",void 0),c([h(),yr("esri/t9n/common")],Al.prototype,"_messagesCommon",void 0),c([h(),yr("esri/core/t9n/Units")],Al.prototype,"_messagesUnits",void 0),c([h()],Al.prototype,"fov",void 0),c([h()],Al.prototype,"_overlay",null),c([h()],Al.prototype,"_reset",null),Al=c([w("esri.widgets.FovOverlay")],Al);var nX=Math.sqrt(1872);var fh=class extends Ss{constructor(e){super(e),this.onStop=null,this._timeOutId=void 0,this._onReset=()=>{this._startSize=this._lastDrag=null,this._setFov(oX),this.updateTimeout()},this._center=b(),this._viewForward=b(),this._constraints=new Bi(nt.ALL,Se.ZOOM)}begin(e){cX(e)?this._showOverlay().fov=e.fov:(this._lastDrag=e[1],this._startSize=null,this._ensureStartSize(this.view.state.camera))}updateTimeout(){clearTimeout(this._timeOutId),this._timeOutId=setTimeout(this.onStop,1500)}update(e){if(this._lastDrag==null)return this._lastDrag=e[1],this._startSize=null,void this._ensureStartSize(this.view.state.camera);let t=-(this._lastDrag-e[1])/2;this._lastDrag=e[1],this.step(t)}step(e){if(!this.running)return void(this._startSize=this._lastDrag=null);let t=this.view.state,i=this.currentCamera.copyFrom(t.camera),r=ec(i.fov)+e,s=Vt(U(r,aX,lX));s!==i.fov?this._setFov(s):this._showOverlay().fov=i.fov}finish(){this.running&&(this._startSize=this._lastDrag=null,this.finishController())}destroy(){this.hideOverlay()}onControllerEnd(e){super.onControllerEnd(e),this._startSize=this._lastDrag=null,this.hideOverlay()}_showOverlay(){return this._overlay||(this._overlay=new Zd({id:"esri.FovOverlay",node:new Al({onReset:this._onReset})}),this.view.ui.add(this._overlay)),this._overlay.widget}hideOverlay(){this._overlay&&(this.view.ui.remove(this._overlay),this._overlay=z(this._overlay))}_setFov(e){let t=this.view.state,i=this.currentCamera.copyFrom(t.camera),r=this._ensureStartSize(i)/Math.tan(e/2),s=te(PD,this._center,q(PD,this._viewForward,-r));i.eye=s,i.fov=e,this._constraints.interactionStartCamera=t.camera,this._constraints.interactionFactor=Ls(this.currentCamera.height-t.camera.height),Tt(this.view,this.currentCamera,this._constraints),this.begin(i),this.commitCamera()}_ensureStartSize(e){if(this._startSize==null){G(this._viewForward,e.viewForward);let t=this.view._stage.renderView.getMinimalDepthForArea(null,e.fullWidth/e.pixelRatio*.5,e.fullHeight/e.pixelRatio*.5,e,Ml),i=Ai(e.eye,this.view.pointsOfInterest.centerOnContent.renderLocation),r=t??i;te(this._center,e.eye,q(PD,this._viewForward,r)),this._startSize=r*Math.tan(e.fov/2)}return this._startSize}};c([h()],fh.prototype,"onStop",void 0),fh=c([w("esri.views.3d.state.controllers.FovController")],fh);var oX=Vt(new pn().fov),aX=10,lX=150,PD=b();function cX(e){return!Array.isArray(e)}var uS=class extends Ss{constructor(){super(...arguments),this._pickPoint=b(),this._tmpP0=ir(),this._panAxisAngle=qu(),this._tmpRayDir=b(),this._tmpRayDirPick=b(),this._targetOnSphere=b(),this._navMode=Sr.Horizontal,this._tmpRay={origin:b(),direction:b()},this.dragBeginPoint=ri(),this._normalizedAnchorPoint=ir(),this._constraintOptions=new Bi(nt.ALL_EXCEPT_COLLISION,Se.ZOOM,0,this.startCamera),this._sphere=Nr(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;wr(this.dragBeginPoint,e),El(this.startCamera,e,this._normalizedAnchorPoint);let t=ht(this.view.spatialReference),i=$C(this._intersectionHelper,this.startCamera,e,t,uh.Ellipsoid,this.view.map.ground.opacity===0?Vn:{});if(this._navMode=Rl(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===Sr.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let r;gl(this.startCamera,e,this._tmpRay),Z(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(ge(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),r=be(this._tmpRayDirPick));let s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,a4);let n=U(Math.min(VC,1/Math.abs(X(a4,this._tmpRay.direction)))*s,kf[0],kf[1]),o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,Ml);n=o??n,n=r!=null?Math.min(n,r):n,this._hasPickPoint=!0,q(this._tmpRay.direction,this._tmpRay.direction,n),te(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.running){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Sr.Horizontal){ge(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);let t=be(this._tmpRayDir);El(this.currentCamera,e,this._tmpP0);let i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),r=t*2**i,s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;if(this._hasPickPoint&&r<t){let n=1-(1-r/t)*(1-this._sphere[3]/be(this.currentCamera.center));this.currentCamera.center=q(hS,this.currentCamera.center,n)}q(this._tmpRayDir,this._tmpRayDir,-r/t),this.currentCamera.eye=te(hS,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Ls(ma(this.dragBeginPoint,e)),Tt(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(mh(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Df(this._pickPoint,this._targetOnSphere,this._panAxisAngle),ro(this.currentCamera,this._sphere,this._panAxisAngle))}else{let t=be(this._tmpRay.direction);El(this.currentCamera,e,this._tmpP0);let i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),r=t*2**i,s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;q(this._tmpRayDir,this._tmpRay.direction,1-r/t),this.currentCamera.eye=te(hS,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=te(hS,this.currentCamera.center,this._tmpRayDir)}Go(this.view,this.currentCamera),this.commitCamera()}}finish(){this.running&&this.finishController()}};uS=c([w("esri.views.3d.state.controllers.ZoomControllerGlobal")],uS);var hS=b(),a4=b();var mS=class extends Ss{constructor(){super(...arguments),this._tmpP=b(),this._tmpDir=b(),this._tmpN=b(),this._tmpP0=ir(),this._tmpPoi=b(),this._tmpRayDir=b(),this.dragBeginPoint=ri(),this._normalizedAnchorPoint=ir(),this._constraintOptions=new Bi(nt.ALL,Se.ZOOM,0,this.startCamera,b()),this._plane=ac()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;wr(this.dragBeginPoint,e),El(this.startCamera,e,this._normalizedAnchorPoint);let t=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Vn:{});ge(this._tmpDir,this._tmpP,this.startCamera.eye);let i=be(this._tmpDir);Z(this._tmpDir,this._tmpDir);let r=Math.abs(this.view.camera.position.z),s=U(Math.min(VC,1/Math.abs(X(dX,this._tmpDir)))*r,kf[0],kf[1]),n=this.view._stage.renderView.getMinimalDepthForArea(pc(this.view),e[0],e[1],this.view.state.camera,Ml);s=n??s,s=t?Math.min(s,i):s,q(this._tmpDir,this._tmpDir,s),te(this._tmpP,this.startCamera.eye,this._tmpDir),ge(this._tmpN,this.startCamera.eye,this.startCamera.center),Z(this._tmpN,this._tmpN),this._tmpN[1]<0&&Wn(this._tmpN,this._tmpN),_0(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.running)return;UG(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||G(this._tmpPoi,this.currentCamera.center),El(this.currentCamera,e,this._tmpP0);let t=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);wr(this._normalizedAnchorPoint,this._tmpP0),ge(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);let i=be(this._tmpRayDir),r=i*(1-t);this._constraintOptions.interactionDirection&&(G(this._constraintOptions.interactionDirection,this._tmpRayDir),q(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(t)/i));let s=this.view.state.constraints.minimumPoiDistance;t>=0&&r<s&&(r=s,t=-(r-i)/i),Math.abs(i-r)<1e-6||(q(this._tmpRayDir,this._tmpRayDir,t),this.currentCamera.eye=te(Yu,this.currentCamera.eye,this._tmpRayDir),di(Yu,this.currentCamera.center,this._tmpPoi,t),this._tmpPoi[2]>this.startCamera.center[2]?Yu[2]=Math.max(this.startCamera.center[2],Yu[2]):Yu[2]=Math.min(this.startCamera.center[2],Yu[2]),this.currentCamera.center=Yu,this._constraintOptions.interactionFactor=Ls(ma(this.dragBeginPoint,e)),Tt(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}finish(){this.running&&this.finishController()}};mS=c([w("esri.views.3d.state.controllers.ZoomControllerLocal")],mS);var Yu=b(),dX=dt(0,0,1);var pS=class extends Ge{constructor(t,i,r){super(!0),this._view=t,this.pointerAction=i,this._fovModifier=r,this.registerIncoming("drag",[r],s=>this._handleZoom(s)),this.registerIncoming("drag",s=>this._handleZoom(s))}_handleZoom(t){let i=t.data;if(i.pointers.size>1||!df(t.data,this.pointerAction))return;let r=ri(i.center.x,i.center.y);switch(i.action){case"start":{this._cameraController?.finish();let s=this._view,n=t.modifiers.has(this._fovModifier);this._cameraController=n?new fh({view:s,onStop:()=>this._stopController()}):s.state.isGlobal?new uS({view:s}):new mS({view:s}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break}case"update":this._cameraController?.update(r);break;case"end":this._cameraController instanceof fh?this._cameraController.updateTimeout():this._stopController()}t.stopPropagation()}_stopController(){this._cameraController?.finish(),this._cameraController=null}};var Fc=class extends Ss{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new St,this._headingStart=0,this._constraintOptions=new Bi(nt.ALL,Se.NONE,0,new St,null,Fn.LOOK_AROUND)}handleEventGamepad(e){let t=Ny(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||hf(t))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,pI(this._keysButtonState,this._transformation)}directionActive(e){return this._keysButtonState[e]===1}countActiveDirections(){return this._keysButtonState.reduce((e,t)=>t>0?e+1:e,0)}deactivateDirection(e){this._keysButtonState[e]=0;let t=pI(this._keysButtonState,this._transformation);hf(t)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){let t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(t-this._filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Xu),this._applyDisabledMovementTypes(Xu),this._applyPan(Xu.pan),this._applyRotate(Xu.rotate),this._applyZoom(Xu.zoom),this._applyAscend(Xu.ascend),this._constraintOptions.interactionType=Se.NONE,this._constraintOptions.selection=nt.COLLISION,Tt(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,t)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;let t=this.currentCamera;ge(vn,t.center,t.eye),fi(vn,vn,e.matrix),t.center=te(vn,vn,t.eye),t.up=fi(vn,t.up,e.matrix),this._constraintOptions.interactionType=Se.LOOK_AROUND,this._constraintOptions.selection=nt.ALL_EXCEPT_COLLISION,Tt(this.view,t,this._constraintOptions)}_applyPan(e,t=this.currentCamera){e.enabled&&(t.eye=fi(vn,t.eye,e.matrix),t.center=fi(vn,t.center,e.matrix),this.view.state.isGlobal&&(t.up=fi(vn,t.up,e.matrix)),this._constraintOptions.interactionType=Se.PAN,this._constraintOptions.selection=nt.ALL,Tt(this.view,t,this._constraintOptions))}_applyZoom(e){if(!e)return;let t=this.currentCamera.viewForward;this.currentCamera.eye=te(vn,this.currentCamera.eye,q(Si.get(),t,e)),G(sv,t),Wn(sv,sv),this._constraintOptions.interactionDirection=sv,this._constraintOptions.interactionType=Se.ZOOM,this._constraintOptions.selection=nt.ALL_EXCEPT_COLLISION,Tt(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;let t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Si.get());if(this._constraintOptions.interactionDirection=G(sv,t),this.view.state.isGlobal){let i=be(this.currentCamera.eye),r=(i+e)/i;this.currentCamera.eye=q(vn,this.currentCamera.eye,r),this.currentCamera.center=q(vn,this.currentCamera.center,r)}else{let i=q(Si.get(),t,e);this.currentCamera.eye=te(vn,this.currentCamera.eye,i),this.currentCamera.center=te(vn,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=Se.ASCEND,this._constraintOptions.selection=nt.COLLISION,Tt(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=nt.ALL_EXCEPT_COLLISION,Tt(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){_X(i);let r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){let e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,vn)}_calculateControlTransformationLocal(e,t,i){let{viewRight:r,viewForward:s}=t,n=this._transformation,o=this.view.navigation.gamepad,a=ve(Si.get(),s[0],s[1],0);Z(a,a);let l=n.translation[0]*e.pan;if(l!==0){let g=q(Si.get(),r,l);UM(i.pan.matrix,i.pan.matrix,g),i.pan.enabled=!0}switch(o.mode){case"pan":{let g=-n.translation[1]*e.pan;if(g!==0){let _=q(Si.get(),a,g);UM(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}i.zoom=n.zoom*e.zoom;break}case"zoom":i.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}let d=n.translation[2]*e.ascend;i.ascend=d;let u=-n.heading*e.rotate;u!==0&&(xo(i.rotate.matrix,i.rotate.matrix,u,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Si.get())),i.rotate.enabled=!0);let m=n.tilt*e.rotate,p=wa(this.view.renderCoordsHelper,t.center,t.eye),f=U(p+m,jr.min,jr.max)-p;f&&(xo(i.rotate.matrix,i.rotate.matrix,f,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){let{eye:r,viewRight:s}=t,n=this._transformation,o=this.view.navigation.gamepad,a=Ct(Si.get(),s,r);Z(a,a),Wn(a,a),GG(this.startCamera,t,n,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Xu.pan,this._tmpCamera);let l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,d=n.translation[2]*e.ascend;i.ascend=d;let u=-n.heading*e.rotate;u!==0&&(xo(i.rotate.matrix,i.rotate.matrix,u,this._tmpCamera.eye),i.rotate.enabled=!0);let m=n.tilt*e.rotate,p=this._clampTiltDeltaGlobalToValidRange(m,t.ray,l);p!==0&&(xo(i.rotate.matrix,i.rotate.matrix,p,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){let r=ht(this.view.spatialReference),s=tv(jr.min,t.origin,i,r),n=0,o=0,a=Si.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,a)){let l=wa(this.view.renderCoordsHelper,a,t.origin);n=tv(l,t.origin,i,r),o=tv(jr.max,t.origin,i,r)}else{gd(tp(ip,i+r.radius),t,a);let l=Math.PI+p0(t.direction,a);n=hD(l,t.origin,i,r),o=hD(jr.max,t.origin,i,r)}return U(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,i){let{renderCoordsHelper:r}=this.view,s=r.getAltitude(e),n=t+Math.abs(s-t);return r.setAltitude(i,n,e),n}_clampedDistanceToSurface(e,t){let{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:s}=uB(this.view,t,0,c4,gX),n=i.intersectManifoldClosestSilhouette(ya(t,s),e,Si.get()),o=Ai(t,n),a=i.intersectManifoldClosestSilhouette(ya(t,$m(Si.get(),t,r.center)),e,Si.get()),l=Ai(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){let{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:s}=i,n=t.intersectManifoldClosestSilhouette(r.ray,this._filteredSurfaceElevation,Si.get());if(s){let o=ge(Si.get(),e,n),a=be(o);q(o,o,1/a);let l=Z(Si.get(),e),d=vo(X(l,o));return a*Math.sin(Math.min(uX,d))}{let o=G(Si.get(),e);return t.setAltitude(o,this._filteredSurfaceElevation),Ai(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:mX}_computeVelocities(e){let t=this._filteredSurfaceElevation,i=t+ht(this.view.spatialReference).radius,{camera:r,isGlobal:s}=this.view.state,n=Si.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=r.width/2,d=l4*r.width,u=l4*r.width,m=a*Math.tan(.5*r.fovX)/l,p=m/i,f=m/this._computeHeadingRotateRadius(n),g=o-t;return{pan:(s?p:m)*d*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(d*e/l)*g-g),zoom:2**(d*e/l)*a-a,rotate:U(f*u,pX,fX)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Yh(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Yh(e.rotate.matrix))}static activatesFor(e,t){let i=Ny(t,e.navigation.gamepad,hX);return!(t.action==="end"||hf(i))}};c([h({constructOnly:!0})],Fc.prototype,"gamepadDevice",void 0),c([h({constructOnly:!0})],Fc.prototype,"disableMovements",void 0),Fc=c([w("esri.views.3d.state.controllers.GamepadKeyboardController")],Fc);var hX={translation:[0,0,0],heading:0,tilt:0,zoom:0},c4=80,uX=Vt(c4),l4=.75,mX=5,pX=Vt(30),fX=Vt(80),Xu={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ht()},rotate:{enabled:!1,matrix:Ht()}},vn=b(),sv=b(),gX=hB();function _X(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,Yh(e.pan.matrix),e.rotate.enabled=!1,Yh(e.rotate.matrix)}var fS=class extends Ge{constructor(t){super(!0),this._view=t,this._watchHandles=new qa,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([T(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},ie),T(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){let i=this._view.navigation.gamepad.device;if(i&&t.data.device!==i)return;let r=this._cameraControllerGamepad?.running;if(r||Fc.activatesFor(this._view,t.data)){if(!r){let s=new Fc({view:this._view,gamepadDevice:t.data.device});this._view.state.switchCameraController(s),s.state!==Bt.Rejected&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.running&&this._cameraControllerGamepad.gamepadDevice===t.data.device&&this._cameraControllerGamepad.handleEventGamepad(t.data)}}};var Bn;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(Bn||(Bn={}));var gS=class extends Ge{constructor(t,i){super(!0),this._view=t,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:we.Local},this._stickyKeyTimeoutHandle=void 0,this._stickyKeyDuration=200,this._keyToNumber={[i.left]:Bn.LEFT,[i.right]:Bn.RIGHT,[i.forward]:Bn.FORWARD,[i.backward]:Bn.BACKWARD,[i.up]:Bn.UP,[i.down]:Bn.DOWN,[i.headingLeft]:Bn.HEADINGLEFT,[i.headingRight]:Bn.HEADINGRIGHT,[i.tiltUp]:Bn.TILTUP,[i.tiltDown]:Bn.TILTDOWN,[i.zoomIn]:Bn.ZOOMIN,[i.zoomOut]:Bn.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=uf(r=>r?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}setStickyKeyDuration(t){this._stickyKeyDuration=t}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;let i=this._keyToNumber[t.data.key];if(i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.running||(this._cameraControllerKeyboard=new Fc({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.running)){if(t.stopPropagation(),this._cameraControllerKeyboard.directionActive(i)||(this._cameraControllerKeyboard.activateDirection(i),this._cameraControllerKeyboard.countActiveDirections()>1||!this._isPanning(i)))return;this._stickyKeyDuration>0&&(this._stickyKeyTimeoutHandle=setTimeout(()=>{this._stickyKeyTimeoutHandle=void 0,this._stickyDirection!=null&&this._stickyDirection!==void 0&&(this._cameraControllerKeyboard?.deactivateDirection(this._stickyDirection),this._stickyDirection=void 0)},this._stickyKeyDuration))}}_handleStop(){this._cameraControllerKeyboard?.running&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;let i=this._keyToNumber[t.data.key];if(i!=null&&this._cameraControllerKeyboard?.running){t.stopPropagation();let r=this._stickyKeyTimeoutHandle===void 0;if(this._stickyKeyTimeoutHandle!==void 0&&this._cameraControllerKeyboard?.countActiveDirections()===1)return void(this._stickyDirection=i);this._cameraControllerKeyboard?.deactivateDirection(i),r&&(this._stickyDirection=void 0)}}_isPanning(t){return t<=3}};var _S=class extends Ge{constructor(t,i){super(!0),this._view=t,this.registerIncoming("mouse-wheel",[i],r=>this._handleFov(r)),this.registerIncoming("mouse-wheel",r=>this._handleZoom(r))}_handleZoom(t){if(!this._view.navigation.mouseWheelZoomEnabled)return;let i=t.data;this._zoomController?.running||(this._stopFovController(),this._zoomController=this._view.state.isGlobal?new Ff({view:this._view,mode:"interaction"}):new Nf({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._zoomController)),this._zoomController.step(-i.deltaY/60,ri(i.x,i.y)),t.preventDefault(),t.stopPropagation()}_handleFov(t){this._view.navigation.mouseWheelZoomEnabled&&(this._fovController?.running||(this._zoomController?.finish(),this._fovController?.hideOverlay(),this._fovController=new fh({view:this._view,onStop:()=>this._stopFovController()}),this._view.state.switchCameraController(this._fovController),this._fovController.state!==Bt.Rejected)?(this._fovController.updateTimeout(),this._fovController.step(t.data.deltaY/20),t.preventDefault(),t.stopPropagation()):this._stopFovController())}_stopFovController(){this._fovController?.finish(),this._fovController=null}};var gh=class{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}};var Wo=class extends dh{constructor(){super(...arguments),this._beginCamera=new St,this._elapsedTimeSec=0,this.constraintOptions=new Bi(nt.ALL,Se.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new Xs}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,t),Tt(this.view,t,this.constraintOptions)}};Wo=c([w("esri.views.3d.state.controllers.momentum.MomentumController")],Wo);var Ju=class extends Wo{constructor(e){super(e),this.interactionType=Se.PAN,this._tmpPan=b()}momentumStep(e,t){let i=this.momentum.value(e);q(this._tmpPan,this.momentum.direction,i),t.eye=ge(d4,t.eye,this._tmpPan),t.center=ge(d4,t.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};c([h({constructOnly:!0})],Ju.prototype,"momentum",void 0),Ju=c([w("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],Ju);var d4=b();var yX=b(),yS=b(),nv=class extends Wo{constructor(e){super(e),this.interactionType=Se.PAN}momentumStep(e,t){let i=this.momentum.value1(e),r=this.momentum.value2(e);G(yS,t.eye),Z(yS,yS),Ct(this.momentum.axis2,yS,this.momentum.axis1),pD(t,yX,this.momentum.axis1,i,this.momentum.axis2,r)}};c([h({constructOnly:!0})],nv.prototype,"momentum",void 0),nv=c([w("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],nv);var Nc=class extends Wo{set center(e){this._set("center",Ws(e))}set axis(e){this._set("axis",Ws(e))}constructor(e){super(e),this.interactionType=Se.TUMBLE}momentumStep(e,t){let i=this.momentum.value(e);ro(t,this.center,Oc(this.axis,i))}};c([h({constructOnly:!0})],Nc.prototype,"momentum",void 0),c([h({constructOnly:!0})],Nc.prototype,"center",null),c([h({constructOnly:!0})],Nc.prototype,"axis",null),Nc=c([w("esri.views.3d.state.controllers.momentum.RotationMomentumController")],Nc);var _h=class extends Wo{set zoomCenter(e){this._set("zoomCenter",Ws(e))}constructor(e){super(e),this.interactionType=Se.ZOOM,this.constraintOptions.interactionDirection=b()}momentumStep(e,t){let{interactionDirection:i}=this.constraintOptions;if(!i)return;G(i,t.eye);let r=this.momentum.valueDelta(0,e);Lf(t,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),$m(i,t.eye,i)}};c([h({constructOnly:!0})],_h.prototype,"momentum",void 0),c([h({constructOnly:!0})],_h.prototype,"zoomCenter",null),_h=c([w("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],_h);var yh=class extends Wo{set screenCenter(e){this._set("screenCenter",ri(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Ws(e))}constructor(e){super(e),this.interactionType=Se.ZOOM,this.radius=0,this._tmpSceneCenter=b(),this._tmpZoomAxisAngle=qu(),this._sphere=Nr()}initialize(){this._sphere[3]=this.radius}momentumStep(e,t){let i=this.momentum.valueDelta(0,e);qC(this._sphere,t,i),this.constraintOptions.interactionType=Se.ZOOM,Tt(this.view,t,this.constraintOptions),mh(this._sphere,t,this.screenCenter,this._tmpSceneCenter),Df(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),ro(t,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Se.PAN}};c([h({constructOnly:!0})],yh.prototype,"momentum",void 0),c([h({constructOnly:!0})],yh.prototype,"screenCenter",null),c([h({constructOnly:!0})],yh.prototype,"sceneCenter",null),c([h({constructOnly:!0})],yh.prototype,"radius",void 0),yh=c([w("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],yh);var ov=class{constructor(t){this._gain=t}update(t){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};var h4=1e-5,OD=class extends YV{constructor(t,i,r,s,n,o=0,a){super(t,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this._angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}},vS=class{constructor(t=300,i=12,r=.84){this._minimumInitialVelocity=t,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=b(),this._tmpAxis2=b(),this._tmpAngles=ir(),this._time=new G0(.3),this._screen=[new G0(.4),new G0(.4)],this._angle1=new ov(.6),this._angle2=new ov(.6),this._axis1=b(),this._axis2=b(),this._lastScene=b()}addMomentumDirectRotation(t,i,r,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=uD(this._lastScene,i,this._tmpAxis2,s,n,o);this._angle2.update(0),ds(this._tmpAxis2)<h4?a=0:Z(this._axis1,this._tmpAxis2),this._angle1.update(a),G(this._lastScene,i)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(r)}}addMomentumPreserveHeading(t,i,r,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;mD(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),ds(this._tmpAxis2)<h4?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Z(this._axis1,this._tmpAxis1),Z(this._axis2,this._tmpAxis2)),G(this._lastScene,i)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;let t=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=t==null||i==null?null:Math.sqrt(t*t+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,i,r){let s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new OD(t,i,r,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}};var bS=class extends Ss{constructor(){super(...arguments),this._smoothRotation=new gh(.05),this._rotationAxis=b(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=ac(),this._beginRadius=0,this._smoothScaling=new gh(.05),this._zoomCenterScreen=ri(),this._zoomMomentumEstimator=new $0,this._rotationMomentumEstimator=new W0,this._panSphericalMomentumEstimator=new vS,this._panPlanarMomentumEstimator=new q0,this._adjustedSphere=Nr(),this._tmp3d=b(),this._tmpScreenPointArray=ri(),this._beginScreenPoint=ri(),this._beginScenePoint=b(),this._screenPickPoint=ri(),this._scenePickPoint=b(),this._navMode=Sr.Horizontal,this._sphere=Nr(),this._pointerCount=0,this._tmpInteractionDirection=b(),this._beginCamera=new St,this._constraintOptions=new Bi(nt.ALL,Se.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-ba.normalize(Vt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),ua(e.center,this._screenPickPoint),wr(this._beginScreenPoint,this._screenPickPoint);let t=ht(this.view.spatialReference),i=$C(this._intersectionHelper,this.startCamera,this._screenPickPoint,t,uh.Silhouette,this.view.map.ground.opacity===0?Vn:{});i.scenePickPoint!=null&&(this._scenePickPoint=i.scenePickPoint,this._sphere=i.sphere,G(this._beginScenePoint,this._scenePickPoint),this._navMode=Rl(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===Sr.Vertical&&this._preparePlanarPanMode(e,i.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);let t=e.pointers.size>1;this._navMode===Sr.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();let t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return this._navMode===Sr.Horizontal?new yh({view:this.view,momentum:t,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new _h({view:this.view,momentum:t,zoomCenter:this._beginScenePoint});let i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Nc({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._navMode===Sr.Horizontal){let r=this._panSphericalMomentumEstimator.evaluateMomentum();if(r)return new nv({view:this.view,momentum:r})}else{let r=this._panPlanarMomentumEstimator.evaluateMomentum();if(r)return new Ju({view:this.view,momentum:r})}return null}_preparePlanarPanMode(e,t){let i=Wn(this._tmp3d,this.startCamera.viewForward);_0(this._scenePickPoint,i,this._panningPlane);let r=ri(this._screenPickPoint[0],0),s=b(),n=be(this.startCamera.eye);this._adjustedSphere[3]=n<this._sphere[3]?n-100:this._sphere[3],mh(this._adjustedSphere,this.startCamera,r,s);let o=Kh();this.startCamera.projectToRenderScreen(s,o);let a=b(),l=b(),d=b();ge(a,this._scenePickPoint,this.currentCamera.eye);let u=be(a);Z(a,a);let m=HC*Math.max(Math.abs(this.view.camera.position.z),jC),p=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,Ml),f=p??m;f=t?Math.min(f,u):f,G(d,te(l,this.currentCamera.eye,q(l,a,f))),this._panningPlane[3]=-X(this._panningPlane,d),this.startCamera.center=te(l,this.startCamera.eye,q(l,this.startCamera.viewForward,f));let g=ua(e.center,this._tmpScreenPointArray);ev(this._panningPlane,this.startCamera,g,this._beginScenePoint)}_zoomSpherical(e){let t=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(t),qC(this._sphere,this.currentCamera,this._smoothScaling.value),ua(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Se.ZOOM,this._constraintOptions.interactionFactor=Ls(e.radius-this._beginRadius),Tt(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){let t=ua(e.center,this._tmpScreenPointArray);mh(this._sphere,this.currentCamera,t,this._tmp3d),QC(this._beginScenePoint,X(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(gD(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(fD(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Se.PAN,this._constraintOptions.interactionFactor=Ls(ma(this._screenPickPoint,t)),Tt(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Z(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Wn(this._rotationAxis,this._rotationAxis);let t=this._smoothRotation.value,i=t+Jy(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=r,this._smoothRotation.update(i);let s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),ro(this.currentCamera,this._sphere,Oc(this._rotationAxis,s)),this._constraintOptions.interactionType=Se.TUMBLE,this._constraintOptions.interactionFactor=Ls(e.radius*i),Tt(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){let t=ua(e.center,this._tmpScreenPointArray);ev(this._panningPlane,this.currentCamera,t,this._tmp3d)&&(ZC(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(t,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Se.PAN,this._constraintOptions.interactionFactor=Ls(ma(this._beginScreenPoint,t)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Tt(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){let t=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(t),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Lf(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Se.ZOOM,this._constraintOptions.interactionFactor=Ls(e.radius-this._beginRadius),Tt(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){G(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Wn(this._rotationAxis,this._rotationAxis);let t=this._smoothRotation.value,i=e.angle-t;i=Jy(i);let r=t+i,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);let n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),ro(this.currentCamera,this._sphere,Oc(this._rotationAxis,n)),this._constraintOptions.interactionType=Se.TUMBLE,this._constraintOptions.interactionFactor=Ls(e.radius*n),Tt(this.view,this.currentCamera,this._constraintOptions)}};bS=c([w("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],bS);var u4=dt(0,0,1),wS=class extends Ss{constructor(){super(...arguments),this._rotationValueSmooth=new gh(.05),this._scalingValueSmooth=new gh(.05),this._planeHorizontal=ac(),this._planeVertical=ac(),this._rotationMomentumEstimator=new W0,this._panMomentumEstimator=new q0(300,12,.9),this._zoomMomentumEstimator=new $0,this._beginRadius=0,this._beginCenter=b(),this._beginAngle=0,this._tmpPoints=[],this._navMode=Sr.Horizontal,this._beginCenterScreen=ri(),this._tmpCentroid3d=b(),this._tmpCentroid2d=ri(),this._tmp2d=ri(),this._pointerCount=0,this._beginCamera=new St,this._constraintOptions=new Bi(nt.ALL,Se.NONE,0,this._beginCamera)}begin(e){if(!this.running)return;let t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panMomentumEstimator.enabled=t,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),ua(e.center,this._beginCenterScreen),g0(u4,0,this._planeHorizontal);let i=b(),r=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?Vn:{}),s=b();Wn(s,this.startCamera.viewForward);let n=b();G(n,u4);let o=X(s,n);this._navMode=Rl(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);let a=Math.min(HC,1/Math.abs(X(n,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),jC);JM(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||MF(this._planeHorizontal,this._planeHorizontal);let l=b(),d=b(),u=b();ge(l,i,this.currentCamera.eye);let m=be(l);if(Z(l,l),this._navMode===Sr.Vertical){q(n,n,o),ge(this._planeVertical,s,n),Z(this._planeVertical,this._planeVertical),JM(this._planeVertical,this._planeVertical,i);let p=this.view._stage.renderView.getMinimalDepthForArea(pc(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,Ml),f=p??a;f=r?Math.min(f,m):f,G(u,te(d,this.currentCamera.eye,q(d,l,f))),this._planeVertical[3]=-X(this._planeVertical,u),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),WC(this._tmpPoints,this._beginCenter)}else{let p=r?m:a;G(u,te(d,this.currentCamera.eye,q(d,l,p))),this._planeHorizontal[3]=-X(this._planeHorizontal,u),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),WC(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);let t=e.pointers.size>1,i=this._navMode===Sr.Horizontal?this._planeHorizontal:this._planeVertical,r=this._beginCenter;if(t){let s=this._beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=n,this._scalingValueSmooth.update(s),Lf(this.currentCamera,r,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Se.ZOOM,this._constraintOptions.interactionFactor=Ls(Math.abs(e.radius-this._beginRadius)),Tt(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),WC(this._tmpPoints,this._tmpCentroid3d),ua(e.center,this._tmpCentroid2d),ZC(this.currentCamera,r,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Se.PAN,this._constraintOptions.interactionFactor=Ls(ma(this._beginCenterScreen,this._tmpCentroid2d)),Tt(this.view,this.currentCamera,this._constraintOptions),t){let s=r,n=this._rotationValueSmooth.value,o=n+Jy(e.angle-n),a=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=a,this._rotationValueSmooth.update(o);let l=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(l,.001*e.timestamp);let d=this._planeHorizontal;ro(this.currentCamera,s,Oc(d,l)),this._constraintOptions.interactionType=Se.TUMBLE,this._constraintOptions.interactionFactor=Ls(Math.abs(e.radius*l)),Tt(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();let t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return new _h({view:this.view,momentum:t,zoomCenter:this._beginCenter});let i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Nc({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});let r=this._panMomentumEstimator.evaluateMomentum();return r?new Ju({view:this.view,momentum:r}):null}_computePlanePoints(e,t,i,r){r.length=e.size;let s=this._tmp2d,n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,r[n]===void 0&&(r[n]=b()),ev(t,i,s,r[n]),n+=1}),r}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};wS=c([w("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],wS);var av=class extends Ge{constructor(t,i,r){super(!0),this._view=t,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!df(t.data,this.pointerAction))return;let i=t.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.running&&i<r;switch(t.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.running?t.data.timestamp-this._lastTimestamp>2&&(this._controller.update(t.data),this._lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,i){if(this._controller?.running){this._lastEndTimestamp=t.timestamp;let r=this._controller.end(t.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(t){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(t.data),this._lastTimestamp=t.timestamp}_createController(){return this._view.state.isGlobal?new bS({view:this._view}):new wS({view:this._view})}};var xS=class extends Ge{constructor(t,i){super(!0),this.view=t,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}};var Uf=class extends Ge{constructor(t,i){super(!0),this.key=t,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}};var CS=class extends Uf{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}};var SS=class extends Uf{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}};var TS=class extends Ge{constructor(t,i=!1){super(!0),this._view=t,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(t){let i=this._invert?-1:1,r=ri(0,t.data.delta*i);switch(t.data.action){case"begin":this._cameraController?.end(),this._cameraController=new Ku({view:this._view,pivot:Fs.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController?.update(r);break;case"end":this._cameraController?.end(),this._cameraController=null}}};var MS=class extends Ge{constructor(t=20,i=40){super(!1),this._threshold=t,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Ho({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(t,i){t===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=t===2?"ready":"failed"}_observeUpdate(t,i,r){if(this._state!=="failed"&&t===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(t){this._state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;for(let{x:_,y}of i.pointers.values())r=Math.max(r,_),s=Math.min(s,_),n=Math.max(n,y),o=Math.min(o,y);let a=-1/0,l=1/0,d=-1/0,u=1/0;for(let{x:_,y}of t.pointers.values())a=Math.max(a,_),l=Math.min(l,_),d=Math.max(d,y),u=Math.min(u,y);let m=r-s,p=n-o,f=a-l,g=d-u;return Math.abs(t.center.x-i.center.x)<this._threshold&&Math.abs(f-m)<=this._maxDelta&&Math.abs(g-p)<=this._maxDelta}_checkVerticalThresholdReached(t,i){let r=Math.abs(t.center.y-i.center.y);return t.pointers.forEach((s,n)=>{let o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}};var Oa=class extends k{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=z(this._inputManager)}connect(){let e=this.view;this._source=new Gx(this.view.surface,e.input);let t=[new _f,new yf,new vf,new gf(this.view.navigation),new MS],i=new k0({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new ff],ul.INTERNAL);let r={fov:"Shift",lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};this._modeDragPan=new av(e,"primary"),this._modeDragRotate=new zf(e,"secondary",Fs.CENTER),this._modeDragZoom=new pS(e,"tertiary",r.fov),this._modeKeyboardNavigation=new gS(e,r.pan),i.installHandlers("navigation",[new xS(e),new JC(e),new fS(e),new _S(e,r.fov),new SS(e,r.resetTilt),new CS(e,r.resetHeading),new zf(e,"primary",Fs.EYE,[r.lookAround]),new zf(e,"secondary",Fs.CENTER,[r.lookAround]),new av(e,"tertiary",[r.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,this._modeKeyboardNavigation,new TS(e)],ul.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this.addHandles(T(()=>this.view.navigation?.browserTouchPanEnabled,s=>{this._source.browserTouchPanningEnabled=!s},ie))}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_updateMode(){let e=this.mode,t=this.primaryDragAction,i=FD.get(e)?.get(t);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){}};c([h()],Oa.prototype,"view",void 0),c([h({value:"pan"})],Oa.prototype,"primaryDragAction",null),c([h({value:"default"})],Oa.prototype,"mode",null),c([h({readOnly:!0})],Oa.prototype,"updating",null),c([h()],Oa.prototype,"latestPointerType",null),c([h()],Oa.prototype,"latestPointerLocation",null),c([h()],Oa.prototype,"multiTouchActive",null),c([h()],Oa.prototype,"_inputManager",void 0),Oa=c([w("esri.views.3d.input.SceneInputManager")],Oa);var FD=new Map,kD=new Map,LD=new Map;kD.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),kD.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),LD.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),LD.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),FD.set("default",kD),FD.set("pro",LD);var m4=Oa;var no,Hf,ND=!1,VD=!1,BD=!1,zD=!1,lv=null;function p4(e,t){if(!VD||!Hf)return;g4();let i=Hf,r=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){let o=e.accBins[s][e.accBinsNumY-1-n];r+=o.length;let a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,d=n*e.accBinsSizeY,u=(n+1)*e.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,d+15),_4(a,l,d,u,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function f4(e){BD=Vr.DECONFLICTOR_SHOW_VISIBLE,zD=Vr.DECONFLICTOR_SHOW_INVISIBLE,ND=BD||zD,VD=Vr.DECONFLICTOR_SHOW_GRID,lv=null,ND||VD?lv=()=>bX(e):no&&(no.parentElement.removeChild(no),no=null)}function g4(){lv&&(lv(),lv=null)}function bX(e){no==null&&(no=document.createElement("canvas"),no.setAttribute("id","debugCanvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(no));let{state:t}=e,{camera:i,pixelRatio:r}=t,{width:s,height:n}=i,o=s*r,a=n*r;no.setAttribute("width",`${o}px`),no.setAttribute("height",`${a}px`),no.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),Hf=no.getContext("2d"),Hf.clearRect(0,0,s,n),Hf.font="12px Arial"}function _4(e,t,i,r,s){g4();let n=no.height,o=Hf;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-i),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.closePath()}function y4(e,t){ND&&(t&&BD||!t&&zD)&&_4(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var Il=b(),jf=br(),cv=br(),UD=b(),wX=Ht(),xX=Nr(),HD=Zn(),CX=b(),SX=ii(),jD=class{constructor(){this.aabr=ii(),this.distance=0,this.culled=!1,this.visible=!1}},ES=class{constructor(t,i){this.graphics3DGraphic=t,this.slicePlaneEnabled=i,this.info={}}},bn;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(bn||(bn={}));var GD=class{constructor(){this.camera=new St,this.slicePlane=S_(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),np(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}},vh=class extends k{get dirty(){return this._dirty}get state(){return this._state}constructor(e){super(e),this._dirty=!1,this._viewState=new GD,this._state=bn.Idle,this._active=new Map,this._visible=new Map,this._iterators=new WD,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==bn.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;let e=this._state/bn.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case bn.Idle:this._startUpdate(),e.madeProgress();case bn.Process:if(this._state=bn.Process,!this._processActiveGraphics(e))return;case bn.Sort:if(this._state=bn.Sort,!this._sortVisibleGraphics(e))return;case bn.Deconflict:if(this._state=bn.Deconflict,!this._deconflictVisibleGraphics(e))return;default:p4(this,this._visible),this._state=bn.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(i=>this.addToActiveGraphics(i)):e.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(e){if(e==null||e.type!=="object3d")return!1;let t=e.stageObject;return(t?.geometries.length??0)!==1?!1:t?.geometries[0]?.material instanceof A0}_startUpdate(){f4(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);let{fullWidth:e,fullHeight:t}=this._viewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new jD,this._active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._visible.delete(e.graphics3DGraphic.graphic.uid),TX(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this._active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(e){let t=this._ensureActiveGraphicsIterator(),i=QL(wX,this._viewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0?xX:null,s=0;for(r!=null&&(fi(r,wo,this._viewState.camera.viewMatrix),r[3]=ht(this.view.spatialReference).radius,s=OF(r,wo));!e.done;){e.madeProgress();let n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;let o=n.value,a=o?.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(e){let t=this._ensureSortGraphicsIterator();for(;!e.done;){let i=t.next();if(e.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){let t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===fl.LABEL;for(;!e.done;){e.madeProgress();let r=t.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;let s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled){this._setGraphicVisibility(s,!1);continue}let o=s.graphics3DGraphic,a=!i||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),y4(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=v4(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=v4(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=MX(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r){let s=e.graphics3DGraphic;if(s.destroyed)return;let n=e.info[this.visibilityGroup];if(!s.isVisible(fl.GRAPHIC,Ed.DECONFLICTION))return void(n.culled=!0);let o=this.getGraphicsLayers(s);da(n.aabr);let a=null;for(let l of o){if(!this.layerSupportsDeconfliction(l))continue;let d=l.stageObject.geometries[0].material;if(a==null&&(a=AX,this._getProjectionInfo(l,t,a),a.isOutsideScreen||this._isCulledBySlice(e,Il)||i!=null&&RX(a,i,r)))return void(n.culled=!0);this._expandBoundingRect(n,l,d,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,i){let r=this._viewState.camera,s=e.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;fi(Il,a,r.viewMatrix);let l=n.attributes,d=l.get(Ii.NORMAL).data,u=l.get(Ii.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(Il,d,s.transformation,u,r,i.scaleInfo,Il),So(jf,Il[0],Il[1],Il[2],1),h_(cv,jf,r.projectionMatrix),q(i.positionNDC,cv,1/cv[3]),o.applyShaderOffsetsNDC(i.positionNDC,u,r,i.positionNDC,UD),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(UD[2]),i.distance=UD[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),So(cv,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),h_(jf,cv,t),Qb(jf,jf,1/jf[3]),ve(i.positionView,Il[0],Il[1],Il[2])}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&YF(this._viewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:s}){let n=this._viewState.camera,o=t.getScreenSize(EX);sN(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;let a=Gb(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,SX),Ke(0,n.fullWidth,.5+.5*r[0]),Ke(0,n.fullHeight,.5+.5*r[1])),l=this.marginFactor;if(l!==0){let d=l*Math.min(bo(a),ic(a));a[0]-=d,a[1]-=d,a[2]+=d,a[3]+=d}Ya(e.aabr,a,e.aabr)}_isConflicted(e){let t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup],r=!0;for(let s=Math.floor(i.aabr[0]/this._accBinsSizeX);s<=Math.floor(i.aabr[2]/this._accBinsSizeX);s++)if(!(s<0||s>=this._accBinsNumX))for(let n=Math.floor(i.aabr[1]/this._accBinsSizeY);n<=Math.floor(i.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;r=!1;let o=this._accBins[s][n];for(let a=0;a<o.length;a++){let l=o.data[a],d=l.info[this.visibilityGroup];if(d&&d.visible&&l.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,id(d.aabr,i.aabr)))return!0}}return r}_initBins(e,t){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);let r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new Dt)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=e/this._accBinsNumX,this._accBinsSizeY=t/this._accBinsNumY,this.accNumTests=0}_addToBins(e){let t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this._accBinsSizeX),r=Math.floor(t.aabr[2]/this._accBinsSizeX),s=Math.floor(t.aabr[1]/this._accBinsSizeY),n=Math.floor(t.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(e)}_setGraphicVisibility(e,t){let i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,Ed.DECONFLICTION,t),this.visibilityGroup===fl.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function TX(e,t){let i=e.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(t,Ed.DECONFLICTION,!0)}function*v4(e){if(Map.prototype.entries){let t=e.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1]}else yield*$O(e.values())}function*MX(e,t,i){t.clear(),e.forEach((s,n)=>{let o=t.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(i,Ed.DECONFLICTION);let a=s.info?.[i];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;let r=t.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;t.forAll(s=>{let n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}c([h({constructOnly:!0})],vh.prototype,"view",void 0),c([h({type:Boolean,readOnly:!0})],vh.prototype,"updating",null),vh=c([w("esri.views.3d.layers.graphics.Deconflictor")],vh);var qD=class{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}},WD=class{constructor(t=null,i=null,r=null){this.active=t,this.visible=i,this.sort=r,this.sortArray=new Dt({allocator:s=>s||new qD})}},EX=ir(),$D=class{constructor(){this.positionView=b(),this.positionNDC=b(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new vN}get isOutsideScreen(){let t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}};function RX(e,t,i){return G(HD.direction,e.positionView),ve(HD.origin,0,0,0),!!fd(t,HD,CX)&&e.distanceWithoutPolygonOffset>i}var AX=new $D;var IX=2e3,dv=class extends vh{constructor(e){super(e),this.visibilityGroup=fl.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return ar;let t=performance.now();if(e.state!==Fi.IDLE&&t-this._lastDeconfliction<IX)return ar;super.runTask(e),this.state===bn.Idle&&(this._lastDeconfliction=t)}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};c([h({constructOnly:!0})],dv.prototype,"parent",void 0),dv=c([w("esri.views.3d.layers.graphics.LabelDeconflictor")],dv);var RS=class extends vh{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=fl.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([T(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),T(()=>this.view?.map?.ground?.opacity,(e,t)=>{e!==1&&t!==1||this.setDirty()}),T(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},ie)]),this._frameTask=this.view.resourceController.scheduler.registerTask(si.GRAPHICS_DECONFLICTOR,this),this._labels=new dv({view:this.view,parent:this})}destroy(){this._labels=z(this._labels),this._frameTask=Nt(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){let e=this.view?this.view.slicePlane:null;e!=null&&XF(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){for(let e of this._contexts.keys())if(e.symbolCreationContext.slicePlaneEnabled)return void this.setDirty()}addGraphicsOwner(e){let t=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:i=>this._removeGraphic(t,i),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){let t=this._contexts.get(e);t&&(t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){let r=i.graphic.uid,s=new ES(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,s),ZD(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s);let n=!this._graphicSupportsDeconfliction(i)||!ZD(e);i.setVisibilityFlag(fl.GRAPHIC,Ed.DECONFLICTION,n)}_removeGraphic(e,t){let i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){let i=ZD(e);i||DX(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){let i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(r=>r.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;let t=e.layers;if(!t?.length)return!1;for(let i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){let t=this._contexts.get(e);if(t)return t;let i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function ZD(e){let t=e.layer;return!(!t?.featureReduction||t.featureReduction.type!=="selection")}function DX(e){let t=e.graphics3DGraphics;t&&t.forEach(i=>i.setVisibilityFlag(fl.GRAPHIC,Ed.DECONFLICTION,!0))}RS=c([w("esri.views.3d.layers.graphics.GraphicsDeconflictor")],RS);function b4(e,t,i,r,s,n,o=1){let a=u_(t,s,E2);if(a==null)return!1;if(a===T2){if(e===r&&i===n)return!0;let d=i+o;for(let u=i,m=n;u<d;++u,++m)G(r[m],e[u]);return!0}let l=i+o;for(let d=i,u=n;d<l;++d,++u)a(e[d],0,r[u],0);return!0}var AS=class{constructor(t,i){this._renderCoordsHelper=t,this._getIsGroundOpaque=i,this._isGroundOpaque=!1,this._cache=new Map,this._cameraForward=b(),this._cameraEye=b(),this._cameraFovY=55*Math.PI/180,this._frustumBoundingSphereCenter=b(),this._frustumBoundingSphereRadius=0,this._frustum=new Y0(t),this._renderSR=t.spatialReference;let r=$2(this._renderSR);this._renderSREllipsoidRadius=ht(r).radius}begin(t){this._aboveGround=t.aboveGround,this._isGroundOpaque=this._getIsGroundOpaque(),this._frustum.update(t),Z(this._cameraForward,t.viewForward),G(this._cameraEye,t.eye),this._cameraFovY=t.fovY,this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(t){return this._getOrCalculateSingleTileVisibility(t)}_getOrCalculateSingleTileVisibility(t){let i=this._cache.get(t.id);if(i!=null)return i;let r=this._calculateSingleTileVisibility(t);return this._cache.set(t.id,r),r}_calculateSingleTileVisibility(t){return this._calculateSingleTileVisibilitySided(t)}_isTileVisibleInFrustum(t){return this._renderCoordsHelper.viewingMode===we.Local?this._isTileVisibleInFrustumLocal(t):this._isTileVisibleInFrustumGlobal(t)}_updateFrustumBoundingSphere(){let t=this._frustum,i=t.origin,r=zX;Z(r,t.direction);let s=t.points,n=UX;gi(n,s[4],i);let o=.5*X(n,n)/X(r,n),a=this._frustumBoundingSphereCenter;nc(a,i,r,o);let l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(t){let i=t.tilingScheme.spatialReference,r=t.extent,s=this._renderSR,n=LX;if(n[0]=r[0],n[1]=r[1],n[2]=0,n[3]=r[2],n[4]=r[3],n[5]=0,!R2(n,i,0,n,s,0))return!1;let o=C4;ve(o[0],n[0],n[1],0),ve(o[1],n[3],n[1],0),ve(o[2],n[3],n[4],0),ve(o[3],n[0],n[4],0);let a=S4;ve(a,.5*(n[0]+n[3]),.5*(n[1]+n[4]),.5*(n[2]+n[5]));let l=E4,d=.5*hs(o[0],o[2]),u=this._frustum,m=this._frustumBoundingSphereRadius,p=this._frustumBoundingSphereCenter,f=jX;gi(f,p,a);let g=X(l,f),_=HX;if(nc(_,a,l,g),hs(_,p)>d+m)return!1;let y=this._cameraForward,v=X(y,E4),x=this._cameraFovY,S=this._cameraEye;if(Math.abs(v)<Math.abs(Math.cos(.5*x))){let O=!0,H=ve(gJ,y[0],y[1],0),B=X(S,H);for(let j=0;j<4;++j){let Y=o[j];if(X(Y,H)-B>0){O=!1;break}}if(O)return!1}{let O=o[0],H=o[2];if(O[0]<=S[0]&&S[0]<=H[0]&&O[1]<=S[1]&&S[1]<=H[1])return!0}let C=kX,E=this._isGroundOpaque&&this._aboveGround,R=this._isGroundOpaque&&!this._aboveGround,D=Math.min(R?uv:1/0,g+m),L=Math.max(E?-uv:-1/0,g-m);for(let O=0;O<4;++O)nc(C[O],o[O],l,D),nc(C[O+4],o[O],l,L);if(x4(u.planes,C,8))return!1;if(QD(u.planes,C,8))return!0;for(let O=0;O<4;++O){let H=C[O],B=C[O+4];if(XD(u.planes,H,B))return!0;let j=C[(O+1)%4];if(XD(u.planes,H,j))return!0;let Y=C[4+(O+1)%4];if(XD(u.planes,B,Y))return!0}if(Dl[0][3]=+o[0][0],Dl[1][3]=-o[2][0],Dl[2][3]=+o[0][1],Dl[3][3]=-o[2][1],Dl[4][3]=+L,Dl[5][3]=-D,QD(Dl,u.points)||QD(Dl,u.points))return!0;for(let O=0;O<4;++O){let H=S,B=u.points[O+4];if(R4(Dl,H,B))return!0;let j=u.points[4+(O+1)%4];if(R4(Dl,B,j))return!0}return!1}_isTileVisibleInFrustumGlobal(t){if(t.lij[0]<JD)return!0;let i=t.tilingScheme.spatialReference,r=t.extent,s=this._isGroundOpaque&&this._aboveGround,n=this._isGroundOpaque&&!this._aboveGround,o=C4,a=.5*(r[0]+r[2]);if(ve(o[0],r[0],r[1],0),ve(o[1],r[2],r[1],0),ve(o[2],r[2],r[3],0),ve(o[3],r[0],r[3],0),ve(o[4],a,r[1],0),ve(o[5],a,r[3],0),!b4(o,i,0,o,this._renderSR,0,6))return!1;let l=o[0][2]>0,d=o[3][2]<0,u=l||d,m=this._renderSREllipsoidRadius;if(u){let pe=dt(0,0,1),xe=FX;bh(xe,pe,o[0]);let he=NX;if(bh(he,pe,o[1]),l){let oe=T4,Ve=o[4],et=M4;bh(et,Ve,pe),bh(oe,et,Ve);let ye=o[0];Ct(ye,xe,oe),hv(ye,m);let Ee=o[1];Ct(Ee,he,oe),hv(Ee,m)}else if(d){let oe=T4,Ve=o[5],et=M4;bh(et,Ve,pe),bh(oe,Ve,et);let ye=o[3];Ct(ye,oe,xe),hv(ye,m);let Ee=o[2];Ct(Ee,oe,he),hv(Ee,m)}}let p=S4;{let pe=gi($X,o[3],o[0]);Z(pe,pe);let xe=te(ZX,o[0],o[3]);q(xe,xe,.5);let he=-X(xe,pe),oe=te(QX,o[0],o[1]);q(oe,oe,.5);let Ve=te(KX,o[2],o[3]);q(Ve,Ve,.5);let et=gi(YX,Ve,oe);Z(et,et);let ye=-(he+X(pe,oe))/X(pe,et);nc(p,oe,et,ye),hv(p,m)}let f=this._frustumBoundingSphereRadius,g=this._frustumBoundingSphereCenter,_=this._frustum,y=_.planes,v=VX;Z(v,p);let x=X(o[0],v)/Fr(o[0]),S=_.origin,C=_.points,E=!1;if(s){{E=!0;let xe=Z(b(),S);for(let he=0;he<4;++he){let oe=C[4+he],Ve=gi(b(),oe,S);Z(Ve,Ve);let et=Ct(b(),xe,Ve);Z(et,et);let ye=Ct(b(),Ve,et);if(Z(ye,ye),X(S,ye)>m){E=!1;break}}}if(E&&X(S,v)<m*x-uv)return!1;let pe=Z(mJ,_.origin);if(X(pe,v)<0)return!1;{let xe=Z(pJ,_.direction);if(X(xe,v)>fJ)return!1}}let R=Math.sqrt(1-x*x);if(R>.9)return!0;let D=!1;{let pe=X(v,g),xe=Fr(g);if(xe<=f&&!y.some(Ve=>lc(Ve,KD)>0)){if(!s)return!0;D=!0}let he=pe/xe;if(!D&&pe<=0&&-pe>f)return!1;let oe=f/xe;if(Math.sqrt(1-he*he)*Math.sqrt(1-oe*oe)-oe*he>R)return!1}if(!E&&(o.some(pe=>_.intersectsPoint(pe))||_.intersectsPoint(p)))return!0;let L=GX;gi(L,g,KD);let O=X(L,v),H=BX;q(H,v,O);let B=hs(H,g),j=i.isWGS84,Y=t.lij,N=j&&Y[2]===2**Y[0]-1,F=j&&Y[2]===0,me=F?aJ:N?nJ:rJ,$=F?lJ:N?oJ:sJ;if(!D){let pe=o,xe=cJ,he=XX,oe=JX,Ve=KD;for(let et of me){let ye=pe[et];if(w4(he,pe[(et+1)%4],ye),w4(oe,Ve,ye),bh(xe,oe,he),OX(xe,C,1))return!1}}let Q=null;if(!s&&O<1.01*f){let pe=2.5*f;if(B>x*pe+f)return!1;let xe=WX,he=pe/x;for(let oe=0;oe<4;++oe)q(xe[oe],o[oe],he/m);ve(xe[4],0,0,0),Q=xe}else{let pe=(n?m+uv:O+f)/x,xe=s?m-uv:(O-f)/x,he=qX;for(let oe=0;oe<4;++oe){let Ve=o[oe];q(he[oe],Ve,xe/m),q(he[oe+4],Ve,pe/m)}Q=he}if(x4(y,Q,Q.length))return!1;let Ie=_.lines,de=eJ,ke=tJ;for(let pe of Ie){Z(ke,pe.direction);for(let xe of $){let he=Q[xe];if(Z(de,he),YD(ke,de,Q,C))return!1;let oe=(xe+1)%4;if(s){let Ve=Q[oe];if(gi(de,Ve,he),Z(de,de),YD(ke,de,Q,C))return!1}if(n){let Ve=Q[4+xe],et=Q[4+oe];if(gi(de,et,Ve),Z(de,de),YD(ke,de,Q,C))return!1}}}return!0}_calculateSingleTileVisibilitySided(t){return this._isTileVisibleInFrustum(t)?_u.VISIBLE:_u.INVISIBLE}};function bh(e,t,i){return Ct(e,t,i),Z(e,e),e}function w4(e,t,i){return gi(e,t,i),Z(e,e),e}function hv(e,t){return q(e,e,t/Fr(e)),e}var A4=[_d.LEFT,_d.RIGHT,_d.BOTTOM,_d.TOP,_d.FAR];function PX(e,t,i){for(let r=0;r<i;++r)if(lc(e,t[r])<=0)return!1;return!0}function x4(e,t,i){for(let r of A4)if(PX(e[r],t,i))return!0;return!1}function QD(e,t,i=t.length){for(let r=0;r<i;++r){let s=t[r],n=!0;for(let o of e)if(lc(o,s)>0){n=!1;break}if(n)return!0}return!1}var JD=2;function OX(e,t,i){for(let r of t)if(X(r,e)<i)return!1;return!0}var kX=[b(),b(),b(),b(),b(),b(),b(),b()],LX=[0,0,0,0,0,0],C4=[b(),b(),b(),b(),b(),b()],S4=b(),T4=b(),FX=b(),NX=b(),M4=b(),VX=b(),BX=b(),zX=b(),UX=b(),HX=b(),jX=b(),KD=qb(0,0,0),GX=b(),qX=[b(),b(),b(),b(),b(),b(),b(),b()],WX=[b(),b(),b(),b(),b()],$X=b(),ZX=b(),QX=b(),KX=b(),YX=b(),XX=b(),JX=b(),eJ=b(),tJ=b(),iJ=b(),rJ=[0,1,2,3],sJ=[0,1,2,3],nJ=[0,1,3],oJ=[0,1,3],aJ=[1,2,3],lJ=[1,2,3],cJ=b();function dJ(e,t,i){let r=1/0,s=-1/0;for(let n of i){let o=X(t,n);r=Math.min(r,o),s=Math.max(s,o)}e[0]=r,e[1]=s}function hJ(e,t,i,r){let s=1/0,n=-1/0;for(let o of r){let a=X(i,o);if(s=Math.min(s,a),n=Math.max(n,a),s<=t&&n>=e)return!1}return!0}var uJ=[0,0];function YD(e,t,i,r){if(i.length===0||r.length===0)return!0;let s=iJ;bh(s,e,t);let n=r[0]<i[0],o=n?i:r,a=uJ;return dJ(a,s,n?r:i),hJ(a[0],a[1],s,o)}var uv=430,mJ=b(),pJ=b(),fJ=Math.cos(.25*Math.PI),E4=dt(0,0,1),gJ=b();function XD(e,t,i){let r={t0:0,t1:1};for(let s of A4)if(!I4(e[s],t,i,r))return!1;return r.t0<r.t1}function R4(e,t,i){let r={t0:0,t1:1};for(let s of e)if(!I4(s,t,i,r))return!1;return r.t0<r.t1}function I4(e,t,i,r){let{t0:s,t1:n}=r,o=lc(e,t),a=lc(e,i);if(o>=0&&a>=0)return!1;if(o<0&&a>=0){let l=-o/(a-o);if(l<s)return!1;l<n&&(n=l)}else if(o>=0&&a<0){let l=o/(o-a);if(l>n)return!1;l>s&&(s=l)}return r.t0=s,r.t1=n,!0}var Dl=[au(-1,0,0,1),au(1,0,0,-1),au(0,-1,0,1),au(0,1,0,-1),au(0,0,-1,1),au(0,0,1,-1)];var IS=class{constructor(t){this._camera=new St,this._focusOnMap=[0,0],this._renderCoordsHelper=t.renderCoordsHelper,this._tilingScheme=t.tilingScheme,this._visibility=new AS(t.renderCoordsHelper,t.getIsGroundOpaque)}begin(t,i,r){this._camera.copyFrom(t),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,this._visibility.begin(this._camera)}end(){this._visibility.end()}updateTile(t){let{measures:i}=t;i.visibility=this._visibility.calculate(t),i.distance=PL(t.extent,this._focusOnMap),i.visibility!==_u.INVISIBLE&&this._updateSplitDecisionAndLod(t)}_calculateTileShouldSplitGlobal(t){let i=this._camera,{eye:r}=i,s=Fr(r),n=this._renderCoordsHelper,o=n.referenceEllipsoid.radius;if(s>2*o)return t.measures.effectiveLevelForLod=0,!1;let a=t.lij[0];if(a<=JD)return t.measures.effectiveLevelForLod=a,!0;let l=D4,{extent:d}=t,{_surfaceElevation:u}=this;ve(l[0],d[0],d[1],u),ve(l[1],d[2],d[1],u),ve(l[2],d[2],d[3],u),ve(l[3],d[0],d[3],u);let m=ve(P4,.5*(d[0]+d[2]),.5*(d[1]+d[3]),u),p=this._tilingScheme.spatialReference;for(let v=0;v<4;++v)n.toRenderCoords(l[v],p,l[v]);n.toRenderCoords(m,p,m);let f=Z(O4,m),g=X(r,f),_=q(k4,f,g),y=Fr(r)-o;return G(Gf.origin,yJ),G(Gf.direction,f),this._calculateTileShouldSplitCommon(t,l,m,Gf,y,_)}_calculateTileShouldSplitLocal(t){let i=D4,{extent:r}=t,{_surfaceElevation:s}=this;ve(i[0],r[0],r[1],s),ve(i[1],r[2],r[1],s),ve(i[2],r[2],r[3],s),ve(i[3],r[0],r[3],s);let n=this._tilingScheme.spatialReference;for(let f=0;f<4;++f)this._renderCoordsHelper.toRenderCoords(i[f],n,i[f]);let o=ve(P4,.5*(i[0][0]+i[2][0]),.5*(i[0][1]+i[2][1]),.25*(i[0][2]+i[1][2]+i[2][2]+i[3][2])),a=ve(O4,o[0],o[1],0),{eye:l,far:d}=this._camera,u=ve(k4,a[0],a[1],l[2]),m=l[2];ve(Gf.origin,a[0],a[1],l[2]-2*d),G(Gf.direction,qf);let p=l[2]-2*d;return this._calculateTileShouldSplitCommon(t,i,o,Gf,m,u,_J,p)}_calculateTileShouldSplitCommon(t,i,r,s,n,o,a,l){let d=Math.max(hs(i[0],i[2]),hs(i[1],i[3]),hs(i[0],r)+hs(r,i[2])),u=this._camera,{eye:m,near:p,far:f,fovY:g,viewForward:_}=u,y=U(X(s.direction,_),.1,1),v=X(m,_),x=X(r,_)-v,S=2*Math.tan(.5*g),C=ye=>ye<=p?1:1/(ye*S),E=Math.abs(n)/d,R=C(x),D=t.lij[0],L=hs(m,r),O=0,H=1/0;for(let ye of i){let Ee=hs(m,ye);H=Math.min(H,Ee),O=Math.max(O,Ee)}let{perScreenPixelRatio:B}=u,j=ye=>Math.max(0,D-2,D+Math.ceil(Math.log2(.002*ye/B))),Y=1,N=300*U(y,.1,1),F=.8,me=.7,$=hs(o,m)>me*d,Q=x<p,Ie=ye=>Y*d/ye,de=j($?Ie(L):Q?N*d/Math.abs(n):F*R*d),ke=de+(H-p>.33*(f-p)?-1:0);if(t.measures.effectiveLevelForLod=ke,D+2<ke)return!0;if(D>=ke)return!1;let{frustum:pe}=u,xe=E<vJ;if(hs(o,m)<p)return xe;let he=sE(pe,s);if($){let ye=j(Ie(H)),Ee=j(Ie(O));if(Math.abs(ye-Ee)>2||Math.abs(de-Ee)>2||Math.abs(de-ye)>2)return!0}else{let ye=hs(m,r),Ee=.5*d/Math.SQRT2;if(D<=ke+3||ye/Ee>.6)return!0}if(!this.isGlobalMode&&$&&a&&l!==void 0){let ye=0;for(let Ee=0;Ee<4;++Ee){let Pt=a[Ee],Ot=l,kt=b();nc(kt,i[Ee],Pt,Ot);let Lt=rE(kt,Pt);sE(pe,Lt)&&++ye}if(ye>=3||ye>=2&&he)return!1;if(ye<=2&&!he&&D<de+1)return!0}let oe=x_(pe,r),Ve=0;for(let ye=0;ye<4;++ye){let Ee=i[ye];Ve+=x_(pe,Ee)?1:0}if(oe&&Ve>=2)return!1;if(!oe&&!he&&Ve<=1&&D<ke)return xe;let et=x;for(let ye=0;ye<4;++ye){let Ee=i[ye],Pt=X(Ee,_)-v;et=Math.min(et,Pt)}return et<=p?xe:!(C(et)*d<.3)&&D<ke&&R*d>bJ&&Ve<=2&&!oe&&!he}_updateSplitDecisionAndLod(t){t.measures.shouldSplit=this.isGlobalMode?this._calculateTileShouldSplitGlobal(t):this._calculateTileShouldSplitLocal(t),t.updateResolution()}get isGlobalMode(){return this._renderCoordsHelper.viewingMode===we.Global}},D4=[b(),b(),b(),b()],P4=b(),O4=b(),k4=b(),qf=qb(0,0,1),_J=[qf,qf,qf,qf],yJ=wo,Gf=rE(wo,qf),vJ=1,bJ=.9;var rs=class extends k{constructor(e){super(e),this.tiles=new qe,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Dt,this.tileBudget=100}initialize(){let e=()=>this._setDirty(),t=()=>this._reset();this.addHandles([T(()=>this.tilingScheme,t,Ce),T(()=>this.tileSize,t,Ce),T(()=>this.cameraOnSurface?.location,e,Ce),T(()=>this.viewState?.contentCamera,e,Ce),T(()=>this.focus?.location,e,Ce),T(()=>this.terrain?.baseOpacity??1,e)]),this._frameWorker=this.scheduler?.registerTask(si.FEATURE_TILE_TREE,this)}destroy(){this._frameWorker=Nt(this._frameWorker)}get tilingScheme(){let e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void V.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");let t=this._get("filterExtent");if(t===e||t!=null&&e&&t.equals(e))return;let i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;let e=ii();return sw(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){let{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}addClient(){let e=Xk();return this._clients.add(e),this._clients.size===1&&this._setDirty(),kr(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(qn))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=si.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=si.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new IS({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,getIsGroundOpaque:()=>(this.terrain?.baseOpacity??1)===1}));let e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){let e=this.tilingScheme;return this._rootTileIds.map(t=>new yz(t[0],t[1],t[2],e))}_subdivideTilesForView(e){if(!this._pendingTiles)return;let{tilingScheme:t}=this;for(;this._pendingTiles.length>0&&!e.done;){let i=this._pendingTiles.shift();if(e.madeProgress(),this._filterExtentRect&&!id(this._filterExtentRect,i.extent))continue;this._tileMeasurements.updateTile(i);let{measures:r}=i;if(r.visibility===_u.INVISIBLE)continue;let s=this._newTiles.length+this._pendingTiles.length+1;r.shouldSplit&&s<this.tileBudget?(t.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)}this._pendingTiles.length===0&&(this._updateTiles(this._newTiles.toArray()),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(let r of this.tiles.items)r.used=!1;let t=e.filter(r=>{let s=this._idToTile.get(r.id);return s?(s.copyMeasurementsFrom(r),s.used=!0):this._idToTile.set(r.id,r),!s}),i=this.tiles.items.filter(r=>!r.used&&(this._idToTile.delete(r.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles(),this.tiles.emit("change")}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};c([h({constructOnly:!0})],rs.prototype,"scheduler",void 0),c([h({constructOnly:!0})],rs.prototype,"renderCoordsHelper",void 0),c([h({constructOnly:!0})],rs.prototype,"tilingSchemeOwner",void 0),c([h({constructOnly:!0})],rs.prototype,"cameraOnSurface",void 0),c([h({constructOnly:!0})],rs.prototype,"focus",void 0),c([h({constructOnly:!0})],rs.prototype,"viewState",void 0),c([h({constructOnly:!0})],rs.prototype,"terrain",void 0),c([h()],rs.prototype,"tiles",void 0),c([h()],rs.prototype,"tileSize",void 0),c([h({readOnly:!0})],rs.prototype,"tilingScheme",null),c([h()],rs.prototype,"filterExtent",null),c([h({readOnly:!0})],rs.prototype,"_filterExtentRect",null),c([h({readOnly:!0})],rs.prototype,"_rootTileIds",null),c([h({value:!1})],rs.prototype,"suspended",null),c([h({readOnly:!0})],rs.prototype,"updating",null),rs=c([w("esri.views.3d.layers.support.FeatureTileTree3D")],rs);var Ki=class extends k{constructor(e){super(e),this._propertiesPool=new fn({camera:St},this),this._lastSeenCameraProjectionValues=new St,this.mode=Fi.ANIMATING,this._cssCamera=new St,this._camera=new St,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.constraints=new xl({state:this}),this.events=new ti,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}reset(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new fn({camera:St},this)}destroy(){this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===we.Global){let e=ht(this.spatialReference).radius;this.camera=new St({eye:dt(4*e,0,0),center:dt(e,0,0),up:dt(0,0,1)})}else this.camera=new St({eye:dt(0,0,100),center:dt(0,0,0),up:dt(0,1,0)})}get animation(){return this.cameraController instanceof dh&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){let e=this._cssCamera.copyFrom(this.camera),{height:t,width:i,pixelRatio:r}=this.camera;return e.pixelRatio=1,e.height=Math.round(t/r),e.width=Math.round(i/r),e}get camera(){return this._camera}set camera(e){e!==$o&&$o.copyFrom(e),$o.computeUp(this.viewingMode),this.events.emit("before-camera-change",$o);let t=this._camera;if(wJ(this._lastSeenCameraProjectionValues,$o)&&(this._lastSeenCameraProjectionValues.copyFrom($o),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!t.equals($o)&&(this._camera=this._propertiesPool.get("camera").copyFrom($o),this._cameraChanged=!t.almostEquals($o),this._cameraChanged)){let i=Jk(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Fi.IDLE}get updating(){return this.mode!==Fi.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===we.Global}get isLocal(){return this.viewingMode===we.Local}get viewingMode(){return y_(this.view.viewingMode)}get spatialReference(){return this.view.spatialReference}get navigating(){return!!this.cameraController?.isInteractive}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(L4),this.addHandles(_r(()=>e.state===Bt.Finished||e.state===Bt.Stopped,()=>{this._set("cameraController",null),this.updateCamera(t=>e.onControllerEnd(t))},{sync:!0,once:!0}),L4),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Bt.Rejected)}switchCameraController(e){this.cameraController=e}stopActiveCameraController(){return!this.cameraController||this.cameraController.stopController()}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;let e=this._updateQueue.shift();$o.copyFrom(this._get("camera")),e($o),this.camera=$o,this._processingUpdates=!1,this._processUpdateQueue()}};c([h({constructOnly:!0})],Ki.prototype,"view",void 0),c([h()],Ki.prototype,"mode",void 0),c([h({readOnly:!0,type:Xs})],Ki.prototype,"animation",null),c([h({type:St})],Ki.prototype,"cssCamera",null),c([h()],Ki.prototype,"_cssCamera",void 0),c([h({type:St})],Ki.prototype,"camera",null),c([h()],Ki.prototype,"_camera",void 0),c([h({readOnly:!0})],Ki.prototype,"pixelRatio",null),c([h()],Ki.prototype,"rasterPixelRatio",void 0),c([h()],Ki.prototype,"contentPixelRatio",void 0),c([h({readOnly:!0})],Ki.prototype,"alignPixelEnabled",null),c([h({readOnly:!0})],Ki.prototype,"updating",null),c([h({})],Ki.prototype,"_contentCamera",void 0),c([h({type:St})],Ki.prototype,"contentCamera",null),c([h({readOnly:!0})],Ki.prototype,"fixedContentCamera",null),c([h({readOnly:!0})],Ki.prototype,"events",void 0),c([h({readOnly:!0})],Ki.prototype,"isGlobal",null),c([h({readOnly:!0})],Ki.prototype,"isLocal",null),c([h({readOnly:!0})],Ki.prototype,"viewingMode",null),c([h()],Ki.prototype,"navigating",null),c([h()],Ki.prototype,"stationary",null),c([h()],Ki.prototype,"_cameraChanged",void 0),c([h()],Ki.prototype,"cameraController",null),Ki=c([w("esri.views.3d.state.ViewState")],Ki);var F4=Ki;function wJ(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[Ds.TOP]!==t.padding[Ds.TOP]||e.padding[Ds.RIGHT]!==t.padding[Ds.RIGHT]||e.padding[Ds.BOTTOM]!==t.padding[Ds.BOTTOM]||e.padding[Ds.LEFT]!==t.padding[Ds.LEFT]}var $o=new St,L4="ViewStateHandles";var OS=class{constructor(t,i,r){this.viewingMode=t,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new Dt,this._tolerance=op,this._tmpRay=Zn(),this._tmpRegion=ii(),this._validateHUDIntersector=mn(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(t,i,r){return this.intersectRay(this._getPickRay(t,this._tmpRay),N4(this.viewingMode),i,r)}intersectScreenFreePointFallback(t,i,r){return this.intersectRayFreePointFallback(this._getPickRay(t,this._tmpRay),i,r)}intersectRayFreePointFallback(t,i,r){return this.intersectRay(t,N4(this.viewingMode),i,r)||this._intersectRayFreePointLocal(t,i)}intersectRay(t,i,r,s){return i.options.selectionMode=!1,i.options.store=ll.MIN,this.computeIntersection(t,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(t,i,r=.5,s=.5){return t.getRenderCenter(PS,r,s),PS[0]+=.0466,PS[1]-=.0123,uw(t,PS,i)}intersectIntersectorScreen(t,i,r){this.computeIntersection(this._getPickRay(t,this._tmpRay),i,r)}intersectToolIntersectorScreen(t,i,r){let s=this._getPickRay(t,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(t,i,r){i.options.selectionMode=!0,this.computeIntersection(t,i,r);let s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||JF(s)&&s.intersector!==va.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(t,i,r))}setTolerance(t=op){this._tolerance=t}addIntersectionHandler(t){this._externalIntersectionHandlers.push(t),this._externalIntersectionHandlers.sort((i,r)=>i.type===va.TERRAIN?1:r.type===va.TERRAIN?-1:0)}removeIntersectionHandler(t){this._externalIntersectionHandlers.removeUnordered(t)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===va.TERRAIN?1:r.type===va.TERRAIN?-1:0)}_getPickRay(t,i){let r=this._view.state.camera;return hw(r,t,i)}_intersectRayFreePointLocal(t,i){return this.viewingMode!==we.Local||t==null||te(i,t.origin,Z(Si.get(),t.direction)),!1}intersectElevationFromScreen(t,i,r=0,s=null){return this._intersectElevation(this._getPickRay(t,this._tmpRay),i,r,s)}_intersectElevation(t,i,r=0,s=null){if(t==null)return null;let n=this._view,{renderCoordsHelper:o}=n,a=vL(n.spatialReference),l=i!=null?i.mode:"absolute-height",d=EN(i)/a,u=(l!=="on-the-ground"?d+r:0)*a/o.unitInMeters,{camera:m}=n.state;if(l==="absolute-height"){let C=o?.getAltitude(m.eye),E=X(Z(mv,t.direction),o.worldUpAtPosition(m.eye,CJ));if(C<u&&E<0||C>=u&&E>0)return null;if(o.intersectInfiniteManifold(t,u,mv)){let R=zE(n,mv);return R.z??=0,R.z-=d,R}return null}let p=Si.get();m.projectToRenderScreen(t.origin,p);let f=new kS(null,this._forEachLayer),{slicePlane:g}=n,_=g!=null?aE(g):null,y=mn(this.viewingMode);y.options.store=ll.MIN,y.options.verticalOffset=u,y.options.normalRequired=!1;let v=t.origin,x=te(Si.get(),v,t.direction);y.reset(v,x,m),y.point=p;let S=s?"type"in s&&s.type==="graphics"?C=>C.layerUid!==s.uid:C=>C.graphicUid!==s.uid:null;switch(l){case"relative-to-scene":{let C=E=>(!S||S(E))&&!!E.lastValidElevationBB;y.intersect(f.layers,p,this._tolerance,null,C),this._externalIntersectionHandlers.forAll(E=>{if(E.type===va.I3S||E.type===va.TERRAIN||E.type===va.TILES3D){let R=E.slicePlaneEnabled?_:null;E.intersect(y,R,y.rayBegin,y.rayEnd,p)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(C=>{if(C.isGround){let E=C.slicePlaneEnabled?_:null;C.intersect(y,E,y.rayBegin,y.rayEnd,p)}})}if(y.results.min.getIntersectionPoint(mv)){let C=zE(n,mv);return C.z=r,C}return null}computeIntersection(t,i,r,s){if(t==null)return;let n=this._view.state.camera,o=Si.get();n.projectToRenderScreen(t.origin,o);let a=new kS(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);let l=t.origin,d=te(Si.get(),t.origin,t.direction);i.reset(l,d,n),i.intersect(a.layers,o,this._tolerance);let u=this._view.slicePlane,m=u!=null?aE(u):null;i.intersect(a.sliceableLayers,o,this._tolerance,m);let p=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(_=>{let y=_.layerUid,v=Array.isArray(y),x=v?y:[y];v&&(i.options.filteredLayerUids=[]);let S=!1;for(let C of x)a.filterLayerUid(C)?S=!0:v&&i.options.filteredLayerUids.push(C);if(i.options.isFiltered=!S,_.isGround&&p||!i.options.isFiltered){let C=_.slicePlaneEnabled?m:null;_.intersect(i,C,l,d,o,s)}});let f=Si.get(),g=this._view.basemapTerrain;if(r&&r.enableDraped&&g.spatialReference!=null&&i.results.ground.getIntersectionPoint(f)){let _=g.overlayManager.renderer,y=this._view.renderCoordsHelper.spatialReference,v=Si.get();this._view.renderCoordsHelper.fromRenderCoords(f,v,g.spatialReference),v[2]=this._view.elevationProvider?.getElevation(f[0],f[1],f[2],y,"ground")??0,_.intersect(i,v,i.results.ground,x=>a.filterRenderGeometry(x))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(t){let i=t.results.hud;a_(this._tmpRegion,kL);let r=this._view.state.camera,s=[],n=this._tmpRegion,o=v=>{let x=new eP(v),S=x.result.target.object.geometries.every(C=>C.material instanceof A0&&C.material.parameters.occlusionTest);s.push({item:x,occlusionTest:S}),S&&(r.projectToRenderScreen(v.target.center,x.screenPoint),x.screenPoint[0]=Math.floor(x.screenPoint[0]),x.screenPoint[1]=Math.floor(x.screenPoint[1]),IL(n,x.screenPoint))};t.sortResults(i.all),i.min.dist!=null&&o(i.min);for(let v of i.all)i.min.target.object!==v.target.object&&i.max.target.object!==v.target.object&&o(v);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);let a=r.fullWidth,l=r.fullHeight,d=Math.max(0,n[0]-pv),u=Math.max(0,n[1]-pv),m=Math.min(bo(n)+2*pv,a-d),p=Math.min(ic(n)+2*pv,l-u),f=m>0&&p>0?new Uint8Array(m*p*4):null;f&&this._view._stage.renderer.readHUDVisibility(d,u,m,p,f);let g=!0,_=t.results.max.dist==null,y=0;for(let{item:v,occlusionTest:x}of s){let S=!x;if(x&&f)for(let C of xJ){let E=4*(Math.min(v.screenPoint[0]+C[0],a)-n[0]+(Math.min(v.screenPoint[1]+C[1],l)-n[1])*m);if(E>=0&&E<f.length&&f[E]){S=!0;break}}S&&(g&&(t.results.min.copy(v.result),g=!1),_&&t.results.max.copy(v.result),t.options.store===ll.ALL&&t.results.all.splice(y++,0,v.result))}}},pv=1,xJ=(()=>{let e=[],t=pv;for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)e.push([r+t,i+t]);return e})(),eP=class{constructor(t){this.result=t,this.screenPoint=Kh()}},DS;function N4(e){return DS&&DS.viewingMode===e||(DS=mn(e)),DS}var kS=class{constructor(t,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=t?.include,this.exclude=t?.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(t){let{include:i,exclude:r}=this;return t==null?i==null&&r==null:(i==null||i.has(t))&&(r==null||!r.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}};function tP(e){return typeof e=="object"&&"intersect"in e}var mv=b(),CJ=b(),PS=Kh();var Wf=class extends ti.EventedMixin(k){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=z(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,t,i,r,s){if(this._cacheEnabled&&this.lastElevationQuery!=null){let o=this.lastElevationQuery;if(e===o.x&&t===o.y&&i===o.z&&Ka(r,o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=LS(n,this._im,e,t,i,r,s),n==null&&(n=LS(n,this._ground,e,t,i,r,s)),s==="scene"&&(n=LS(n,this._scene,e,t,i,r,s)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:s,result:n}),n}getSphereElevationBounds(e,t,i){let r=new rp;function s(n){for(let o of n)if(o.getSphereElevationBounds){let a=o.getSphereElevationBounds(e,t,i);a!=null&&r.expandElevationRangeValues(a.elevationRangeMin,a.elevationRangeMax)}}return s(this._ground),s(this._im),i==="scene"&&s(this._scene),r}getRootElevationBounds(){let e=new rp;for(let t of[this._im,this._ground,this._scene])t.forEach(i=>{if(i.getRootElevationBounds){let r=i.getRootElevationBounds();r!=null&&e.expandElevationRangeValues(r.elevationRangeMin,r.elevationRangeMax)}});return e}queryElevation(e,t,i,r,s,n=null,o=0){return P(this,null,function*(){let a=this._getElevationQuery(r);try{let l=yield a.queryElevation(e,t,n,o);return s==="scene"?LS(l,this._scene,e,t,i,r,s):l}catch(l){return Gk(l),this.getElevation(e,t,i,r,s)}})}register(e,t){this.addHandles(t.on("elevation-change",i=>this.emit("elevation-change",i)),t),this._providersFromContext(e).push(t)}unregister(e){this.removeHandles(e);for(let t of[this._im,this._ground,this._scene]){let i=t.indexOf(e);i>-1&&t.splice(i,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){let t=this._cachedQuery;if(t!=null&&Ka(e,t.spatialReference))return t;t?.destroy({completeTasks:!0});let{wkid:i,wkt:r,wkt2:s,latestWkid:n}=e,o=new WB(this.view.resourceController.scheduler,new gt({wkid:i,wkt:r,wkt2:s,latestWkid:n}),()=>this.view.map?.ground,{maximumAutoTileRequests:4});return this._cachedQuery=o,o}};function LS(e,t,i,r,s,n,o){for(let a of t){let l=a.getElevation(i,r,s,n,o);l!=null&&(e=e!=null?Math.max(l,e):l)}return e}c([h({constructOnly:!0})],Wf.prototype,"view",void 0),c([h()],Wf.prototype,"spatialReference",null),Wf=c([w("esri.views.3d.support.CombinedElevationProvider")],Wf);var iP=(()=>{class e{static isValidProfile(i){return i in e.profiles}static getDefaultProfile(){return Qe("esri-iPhone")?"low":"medium"}static apply(i,r){let s=e.profiles[i];r.graphics3D.maxTotalNumberOfFeatures=s.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxNumberOfDrawCalls=s.graphics3D.maxNumberOfDrawCalls,r.graphics3D.maxTotalNumberOfVertices=s.graphics3D.maxTotalNumberOfVertices,r.graphics3D.polygonLodFactor=s.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=s.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=s.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=s.graphics3D.skipHighSymbolLods,r.graphics3D.uncompressedTextureDownsamplingEnabled=s.graphics3D.uncompressedTextureDownsamplingEnabled;let n=r.sceneService.object,o=s.sceneService.object;n.lodFactor=o.lodFactor,r.sceneService.point.lodFactor=s.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=s.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=s.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=s.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=s.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=s.tiledSurface.angledSplitBias,r.tiledSurface.vtlContentZoom=s.tiledSurface.vtlContentZoom,r.tiledSurface.elevationLevelDelta=s.tiledSurface.elevationLevelDelta,r.tiledSurface.reduceTileLevelDifferences=s.tiledSurface.reduceTileLevelDifferences,r.heatmap.pixelRatio=s.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=s.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=s.fadeDuration,r.antialiasingEnabled=s.antialiasingEnabled,r.physicallyBasedRenderingEnabled=s.physicalBasedRenderingEnabled,r.highQualityTransparency=s.highQualityTransparency,r.highResolutionAtmosphere=s.highResolutionAtmosphere,r.reflections=s.reflections,r.ambientOcclusion=s.ambientOcclusion,r.memoryLimit=s.memoryLimit,r.additionalCacheMemory=s.additionalCacheMemory,r.frameRate=s.frameRate,r.maximumPixelRatio=s.maximumPixelRatio}}return e.test={reset(){let t=V4();for(let i of Object.keys(t))e.profiles[i]=t[i]}},e})(),fv={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function V4(){let e=!!Qe("esri-mobile"),t=!!Qe("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+fv.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:e},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!Qe("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:e?600+fv.GalaxyS20:750+fv.FullHD,additionalCacheMemory:e?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!Qe("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:e?900+fv.SurfacePro7:1500+fv.FullHDRetina,additionalCacheMemory:e?-150:0,frameRate:0,maximumPixelRatio:e?1:1/0}}}(function(e){e.profiles=V4()})(iP||(iP={}));var gv=iP;var rP,$f=rP=class extends $V{constructor(e){super(e),this.shadowColor=U0.clone(),this.shadowOpacity=H0,this.shadowDifference=j0}equals(e){return this===e||super.equals(e)&&this.shadowColor.equals(e.shadowColor)&&this.shadowOpacity===e.shadowOpacity&&this.shadowDifference===e.shadowDifference}clone(){return new rP(se(I({},this),{color:this.color.clone(),haloColor:this.haloColor?.clone(),shadowColor:this.shadowColor.clone()}))}};c([h({type:Ar})],$f.prototype,"shadowColor",void 0),c([h()],$f.prototype,"shadowOpacity",void 0),c([h()],$f.prototype,"shadowDifference",void 0),$f=rP=c([w("esri.views.3d.support.HighlightOptions")],$f);var wh=$f;var sP,Pl=sP=class extends k{constructor(e){super(e)}clone(){return new sP({name:this.name,options:this.options.clone()})}};c([h({type:String,constructOnly:!0})],Pl.prototype,"name",void 0),c([h({type:wh})],Pl.prototype,"options",void 0),Pl=sP=c([w("esri.views.3d.support.HighlightGroup")],Pl);var B4=qe.ofType(Pl);function z4(){return Qe("enable-feature:multiple-highlights")?new B4([new Pl({name:gp,options:new wh}),new Pl({name:qV,options:new wh({color:WV})})]):new B4([new Pl({name:gp,options:new wh})])}var Pe;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(Pe||(Pe={}));var xh=[Pe.ELEVATION,Pe.MAP];function U4(e,t){return P(this,null,function*(){let{results:i,ground:r}=yield rB(e,t),s=(!r.layer||!c_(r.layer.type))&&r.mapPoint,n=[],o=MJ(e),a=s?SJ(e,o):TJ,l=0,d=0,u=()=>{let p=a.layerViews[d];s&&p&&"fetchPopupFeaturesAtLocation"in p&&n.push({mapPoint:r.mapPoint,layerView:p}),++d},m=null;for(;l<i.length||d<a.layerViews.length;){let p=i[l];if(p&&p.type!=="graphic")++l;else if(p?.layer?.type!=="scene"||p?.layer?.parent!==e?.map?.basemap)if(p){let f=p.layer?.uid,g=a.layerUids.has(f)&&p.distance===r.distance,_=o.get(p.layer?.uid);if(m??=p.mapPoint,d<a.layerViews.length&&(g||(p.distance??0)>r.distance)&&a.layerViews[d]!==_){u();continue}n.push({graphic:p.graphic,layerView:_}),++l}else u();else++l}return m??=r.mapPoint,{hits:n,location:m}})}function SJ(e,t){let i=new Set,r=[];for(let n=e.basemapTerrain.numLayers(Pe.MAP)-1;n>=0;n--){let o=e.basemapTerrain.layerViewByIndex(n,Pe.MAP);i.add(o.layer.uid),r.push(o)}let s=e.basemapTerrain.overlayManager.renderer.layers;for(let{uid:n}of s){let o=t.get(n);o&&(i.add(n),r.push(o))}return r.reverse(),{layerUids:i,layerViews:r}}var TJ={layerUids:new Set,layerViews:[]};function MJ(e){let t=new Map;for(let i of e.allLayerViews){let r=i.layer.uid;t.set(r,i)}return t}var oo=class extends k{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};c([h()],oo.prototype,"minTotalNumberOfFeatures",void 0),c([h()],oo.prototype,"maxTotalNumberOfFeatures",void 0),c([h()],oo.prototype,"maxNumberOfDrawCalls",void 0),c([h()],oo.prototype,"maxTotalNumberOfVertices",void 0),c([h()],oo.prototype,"snapshotAvailable",void 0),c([h()],oo.prototype,"polygonLodFactor",void 0),c([h()],oo.prototype,"polylineLodFactor",void 0),c([h()],oo.prototype,"skipHighSymbolLods",void 0),c([h()],oo.prototype,"uncompressedTextureDownsamplingEnabled",void 0),oo=c([w("esri.views.3d.support.QualitySettings.Graphics3DSettings")],oo);var ka=class extends k{constructor(){super(...arguments),this.lodFactor=1}};c([h()],ka.prototype,"lodFactor",void 0),ka=c([w("esri.views.3d.support.QualitySettings.LoDFactorSettings")],ka);var Vc=class extends k{constructor(){super(...arguments),this.object=new ka,this.point=new ka,this.integratedMesh=new ka,this.pointCloud=new ka,this.uncompressedTextureDownsamplingEnabled=!1}};c([h({type:ka})],Vc.prototype,"object",void 0),c([h({type:ka})],Vc.prototype,"point",void 0),c([h({type:ka})],Vc.prototype,"integratedMesh",void 0),c([h({type:ka})],Vc.prototype,"pointCloud",void 0),c([h()],Vc.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Vc=c([w("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Vc);var Bc=class extends k{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};c([h()],Bc.prototype,"lodBias",void 0),c([h()],Bc.prototype,"angledSplitBias",void 0),c([h()],Bc.prototype,"vtlContentZoom",void 0),c([h()],Bc.prototype,"elevationLevelDelta",void 0),c([h()],Bc.prototype,"reduceTileLevelDifferences",void 0),Bc=c([w("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Bc);var Zf=class extends k{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};c([h()],Zf.prototype,"pixelRatio",void 0),c([h()],Zf.prototype,"maxTotalNumberOfFeatures",void 0),Zf=c([w("esri.views.3d.support.QualitySettings.HeatmapSettings")],Zf);var Ts=class extends k{constructor(){super(...arguments),this.graphics3D=new oo,this.sceneService=new Vc,this.tiledSurface=new Bc,this.heatmap=new Zf,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};c([h({type:oo})],Ts.prototype,"graphics3D",void 0),c([h({type:Vc})],Ts.prototype,"sceneService",void 0),c([h({type:Bc})],Ts.prototype,"tiledSurface",void 0),c([h({type:Zf})],Ts.prototype,"heatmap",void 0),c([h()],Ts.prototype,"fadeDuration",void 0),c([h()],Ts.prototype,"antialiasingEnabled",void 0),c([h()],Ts.prototype,"physicallyBasedRenderingEnabled",void 0),c([h()],Ts.prototype,"highQualityTransparency",void 0),c([h()],Ts.prototype,"highResolutionAtmosphere",void 0),c([h()],Ts.prototype,"reflections",void 0),c([h()],Ts.prototype,"ambientOcclusion",void 0),c([h()],Ts.prototype,"memoryLimit",void 0),c([h()],Ts.prototype,"additionalCacheMemory",void 0),c([h()],Ts.prototype,"frameRate",void 0),c([h()],Ts.prototype,"maximumPixelRatio",void 0),Ts=c([w("esri.views.3d.support.QualitySettings")],Ts);var nP=Ts;var FS=class{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}},oP=class{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new aP}},aP=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},NS=class{constructor(t,i,r,s){this._workerFunc=t,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new oP(n))}destroy(){this._clients.length=0}hasQuota(t){let i=this._clients[t];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(t){let i=this._clients[t.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(r,s)=>this._taskCallback(r,s))):i.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}_taskFinished(t){let i=this._clients[t.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=t.size||0,i.statistics.duration+=t.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,us(i.numWorkers>=0)),this._next()}_next(){for(let t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(let t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,i){t._cancelled||(this._callbackFunc(t,i),this._taskFinished(t))}getStatsForType(t){let i=this._clients[t];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}};var VS=class{constructor(t,i){this.element=t,this.type="image+type",this.isOpaque=i==="image/jpeg"}};var _v=class extends k{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new NS((r,s)=>this._startLoading(r,s),(r,s)=>this._doneLoadingCB(r,s),e,t),i&&(this._frameTask=i.registerTask(si.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Nt(this._frameTask),this._tasks.forEach(e=>Er(e.abortController)),this._loadQueue=z(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){let s=Hn();s.__signal=r!=null?r.signal:null;let n=this._createOrUpdateTask(e,t,i,r,s);return $a(r,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,i,r,s,n){let o=new lP(e,t,i,r,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){Cb(e.resolvers,t),t.reject(cs()),e.resolvers.length===0&&(e.status===Zo.DOWNLOADING&&(e.status=Zo.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=Zo.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,s){let n=AJ(r?.uid||e,t,i),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,r,t,i,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(us(e.status===Zo.DOWNLOADING),e.status=Zo.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){let t=this._onLoadQueue.shift();Ut(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){let t=this._doneQueue.shift();t.task.status!==Zo.DOWNLOADED&&(t.err=t.err||cs()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!xs(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=bp(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(let r of e.resolvers)if(t)xs(t)?r.reject(t):r.reject(new le("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;let s=i>0?Xr(e.result):e.result;r.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===Zo.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=Zo.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;let s=e.abortController.signal;e.request=jn(e.url,se(I({},e.options),{responseType:r,timeout:i,signal:s}));let n=a=>{e.duration=performance.now()-e.startTime,e.size=a instanceof ArrayBuffer?a.byteLength:e.size||0,e.result=a,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},o=a=>{e.status===Zo.DOWNLOADING&&t(e,a)};return e.docType!=="image+type"?(e.request.then(a=>n(a.data),o),!0):(e.request.then(a=>{let l=a.data,d=RJ(l);if(r="image",e.size=l.byteLength,d==="unknown")return e.request=jn(e.url,{responseType:r,timeout:i,signal:s}),void e.request.then(p=>n(p.data),o);let u=new Blob([l],{type:d}),m=window.URL.createObjectURL(u);e.request=jn(m,{responseType:r,timeout:i,signal:s}),e.request.then(p=>n(new VS(p.data,d)),o).finally(()=>window.URL.revokeObjectURL(m))},o),!0)}get test(){}};c([h({readOnly:!0})],_v.prototype,"updating",void 0),_v=c([w("esri.views.3d.support.StreamDataLoader")],_v);var EJ={numRetries:0};function RJ(e){if(e.byteLength<2)return"unknown";let t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}var lP=class extends FS{constructor(t,i,r,s,n){super(s),this.url=t,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=Zo.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=EJ.numRetries}};function AJ(e,t,i){return`${e}:${t}:${i}`}var Zo;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(Zo||(Zo={}));var BS=class extends k{constructor(){super(...arguments),this.updating=!1}};function H4(e){return new La({view:e})}c([h({readOnly:!0})],BS.prototype,"updating",void 0),BS=c([w("esri.views.3d.support.ResourceController.ResourceControllerMain")],BS);var La=class extends BS{constructor(){super(...arguments),this._immediateTask=Jh,this._normalTask=Jh,this._updatingObjects=To([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=Yb(),this._memoryController=GB(this.view),this._streamDataLoader=new _v,this._streamDataLoader.setup(jB,HB,this._scheduler),this.addHandles([T(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},Re),T(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=As({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(si.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(si.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Nt(this._frameTask),this._streamDataLoader=z(this._streamDataLoader),this._memoryController=z(this._memoryController),this._scheduler=z(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){let t=this._streamDataLoader;return{request:(i,r,s)=>t.request(i,r,e,s),get busy(){return!t.hasDownloadSlots(e)}}}addUpdatingObject(e){let t=this._updatingObjects;return t.value=[...t.value,e],kr(()=>{t.value=t.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(Rb(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};c([h()],La.prototype,"view",void 0),c([h()],La.prototype,"_scheduler",void 0),c([h()],La.prototype,"_memoryController",void 0),c([h()],La.prototype,"_streamDataLoader",void 0),c([h()],La.prototype,"_immediateTask",void 0),c([h()],La.prototype,"_normalTask",void 0),c([h()],La.prototype,"_updatingObjects",void 0),c([h({readOnly:!0})],La.prototype,"updating",null),La=c([w("esri.views.3d.support.ResourceController")],La);var zS=class{constructor(t){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer;let i=t.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}};var US=class{constructor(t){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,t.resourceController!=null){let i=t.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*K2.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=t.quality,this.load=t.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=t.basemapTerrain?.usedMemory??0,this.edgesMemory=t._stage?.renderer.usedMemory.edges??0,this.fboMemory=t._stage?.renderer.usedMemory.fbos??0,t.allLayerViews?.items.forEach(i=>{TB(i)&&this.layerPerformanceInfos.push(new zS(i))}),this.layerPerformanceInfos.sort((i,r)=>r.memory-i.memory)}};var HS=class{constructor(t){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=t("gltf-resources",()=>{}),this._wosrMemCache=t("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(t=>t.abortController.abort()),this._wosrLoading.forEach(t=>t.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(t,i,r){let s=r?`gltfPBR:${t}`:`gltf:${t}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):j4(this._gltfLoading,this._gltfMemCache,s,o=>P(this,null,function*(){let{loadGLTF:a}=yield import("./chunk-7AS3D7PT.js");return a(new RF(o.streamDataRequester),t,o,r)}),i)}loadWOSR(t,i){let r=`wosr:${t}:${i.disableTextures}`,s=this._wosrMemCache.get(r);return s!=null?Promise.resolve(s):j4(this._wosrLoading,this._wosrMemCache,r,n=>PN(t,n),i)}};function j4(e,t,i,r,s){return P(this,null,function*(){Ut(s);let n=$a(s,()=>IJ(e,i)),o=e.get(i);if(o)o.refCount++;else{let a=new AbortController;o={refCount:1,abortController:a,promise:r(se(I({},s),{signal:a.signal}))},e.set(i,o)}try{let a=yield o.promise;return t.put(i,a,a.size),e.delete(i),Ut(s),a}finally{Nt(n)}})}function IJ(e,t){let i=e.get(t);i!=null&&--i.refCount>0||(e.delete(t),i?.abortController.abort())}var Ch=class extends k{constructor(e,t){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=t?.registerTask(si.TEXTURE_UNLOAD)??Jh}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,t){let i=this.makeUid(e),r=this._textureRequests.get(i);if(!r){let s=new vv;s.texture=t(),this._stage&&(s.texture.load(this._stage.renderView.renderingContext),this._stage.add(s.texture)),this._textureRequests.set(i,s),r=s}return r.referenceCount++,new yv(i,r.texture,()=>this._release(i))}_release(e){let t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){if(!this._textureRequests)return;let t=this._textureRequests.get(e);!t||t.referenceCount>0||(t.texture?.unload(),this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return t!=null?`${e}.${t}px`:e}};c([h()],Ch.prototype,"_frameTask",void 0),c([h()],Ch.prototype,"updating",null),Ch=c([w("esri.views.3d.support.TextureCollection")],Ch);var yv=class{constructor(t,i,r){this.uid=t,this.texture=i,this.release=r}},vv=class{constructor(){this.referenceCount=0}};var jS=class extends Ch{constructor(t,i,r){super(i,r),this._streamDataRequester=t}fromUrl(t,i,r){return P(this,null,function*(){Ut(r);let s=r?.signal,n=this.makeUid(t,i),o=this._textureRequests.get(n);if(!o){let a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o=new vv,o.abortController=a;let d=o;this._textureRequests.set(n,o),o.textureAsync=l.then(u=>P(this,null,function*(){let m=this._createTexture(t,u,i);return d.texture=m,d.abortController=null,yield m.load(this._stage.renderView.renderingContext),this._stage.add(m),new yv(n,m,()=>this._release(n))}),u=>{throw d.abortController=null,u})}o.referenceCount++;try{return yield Tb(o.textureAsync,s)}catch(a){throw this._release(n),a}})}_createTexture(t,i,r){let s={width:i.width,height:i.height,wrap:{s:lr.CLAMP_TO_EDGE,t:lr.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(Pb(t)){if(r||i.width===0&&i.height===0){let n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new mN(i,s)}};var qS=class{constructor(t){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=t.viewState,this._view=t.view,this._pointsOfInterest=t.pointsOfInterest,this.streamDataRequester=t.resourceController.createStreamDataRequester(L_.SYMBOLOGY),this.objectResourceCache=new HS((r,s)=>t.resourceController.memoryController.newCache(r,s)),this.textures=new jS(this.streamDataRequester,t.view._stage,t.resourceController.scheduler);let i=ht(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=C0(t.viewingMode,i),this.screenSizePerspectiveSettingsLabels=rN(t.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return kr();this._graphicsOwners.push(t);let i=T(()=>t.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),kr(()=>{i.remove(),Cb(this._graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){let t=this._graphicsOwners.some(i=>i.layer?.screenSizePerspectiveEnabled===!0);if(t&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new qa;let i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([T(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Re),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else t||(this._screenSizePerspectiveHandles=z(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){let t=this._pointsOfInterest;GS.distance=t.centerOnSurfaceInfrequent.distance,GS.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(GS),this.screenSizePerspectiveSettingsLabels.update(GS),this._view._stage.renderView.requestRender()}get test(){}},GS={distance:0,fovY:0};var Ol=class{constructor(t,i,r=""){this.graphics=t,this._symbol=new yF({symbolLayers:new qe([new fF({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new gF({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(t,i){if(i==null)return;this.hide();let r=new je({x:t[0],y:t[1],z:t[2],spatialReference:i});this._graphic=new ga({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}};var Fa=class extends k{constructor(e){super(e)}};c([h({constructOnly:!0})],Fa.prototype,"renderCoordsHelper",void 0),c([h({constructOnly:!0})],Fa.prototype,"surface",void 0),c([h({constructOnly:!0})],Fa.prototype,"state",void 0),Fa=c([w("esri.views.3d.support.pointsOfInterest.PointOfInterest")],Fa);var DJ=Array,Qo=class extends Fa{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new fn({location:je,renderLocation:DJ},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=b(),this._tmpPoint=new je}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){let e=()=>this._setDirty();this.addHandles(xi(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=z(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){let e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){let e=this._camera,t=Ai(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Sd(i,t)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){let e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),ar;let e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);let t=(this._tmpPoint.z??0)>PJ&&this.renderCoordsHelper.viewingMode===we.Global&&(e.isWGS84||e.isWebMercator),i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:t?OJ:0}).then(r=>this._updateSurfaceAltitude(r.geometry.z??0)).catch(r=>{xs(r)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,ar}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(cP,this._estimatedSurfaceAltitude,this._camera.eye),Wm(this._get("renderLocation"),cP)||(this._set("renderLocation",G(this._propertiesPool.get("renderLocation"),cP)),this.notifyChange("renderLocation"))}};c([h({constructOnly:!0})],Qo.prototype,"scheduler",void 0),c([h({constructOnly:!0})],Qo.prototype,"cache",void 0),c([h({constructOnly:!0})],Qo.prototype,"task",void 0),c([h()],Qo.prototype,"location",null),c([h({constructOnly:!0})],Qo.prototype,"map",void 0),c([h()],Qo.prototype,"renderLocation",void 0),c([h()],Qo.prototype,"scale",null),c([h()],Qo.prototype,"updating",null),Qo=c([w("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],Qo);var cP=b(),PJ=1e5,OJ=1e6;var kJ=Array,ao=class extends Fa{constructor(e){super(e),this._propertiesPool=new fn({location:je,renderLocation:kJ},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=b(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Nt(this._frameWorker),this._propertiesPool=z(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){let e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,ar}_updateRenderLocation(){let e=FJ,t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e),i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));let r=NJ;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(G(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=Ai(this._camera.eye,e):(q(e,this._camera.viewForward,this._get("distance")),te(e,e,this._camera.eye)),Wm(this._get("renderLocation"),e)||this._set("renderLocation",G(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){let i=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(i.ray,e,t))return!1;if(this.state.isGlobal){let r=ht(this.renderCoordsHelper.spatialReference).radius,s=r+e,n=ds(i.eye),o=n<s*s,a=Ai(i.eye,t);if(o&&a>r/4){let l=s-Math.sqrt(n);return q(t,i.viewForward,l),te(t,t,i.eye),!0}}else{let r=this.surface?.ready?this.surface.extent:null;r!=null&&Q0(r,this.surface?.spatialReference,bv,this.renderCoordsHelper.spatialReference)&&(t[0]=U(t[0],bv[0],bv[2]),t[1]=U(t[1],bv[1],bv[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(Vr.TESTS_DISABLE_OPTIMIZATIONS)return!0;let i=this._camera.eye,r=Ai(i,e),s=Ai(i,t);if(Math.abs(s-r)/r>LJ)return!0}return!1}};c([h({constructOnly:!0})],ao.prototype,"scheduler",void 0),c([h({constructOnly:!0})],ao.prototype,"task",void 0),c([h()],ao.prototype,"distance",void 0),c([h({constructOnly:!0})],ao.prototype,"estimateSurfaceAltitudeAtCenter",void 0),c([h({readOnly:!0})],ao.prototype,"location",null),c([h({readOnly:!0})],ao.prototype,"renderLocation",void 0),c([h()],ao.prototype,"updating",void 0),ao=c([w("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],ao);var LJ=.05,FJ=b(),NJ=b(),bv=ii();var WS=class{constructor(t){this._handles=new qa,this.events=new ti,this._contentLayerViews=t.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=z(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(t){t.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),t.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",VJ)}},VJ={};var BJ=Array,Ko=class extends Fa{constructor(e){super(e),this._propertiesPool=new fn({location:je,renderLocation:BJ},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([T(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),T(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(si.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=z(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){let e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){let{camera:e,contentPixelRatio:t}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/t)}get running(){return this._dirty}runTask(){let e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,G4);let s=Math.max(0,(Math.acos(X(G4,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!cd(e,t)){let l=this._propertiesPool.get("renderLocation");G(l,t),this._set("renderLocation",l)}return ar}let n=1-U(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(q4);let a=this._propertiesPool.get("renderLocation");return di(a,t,q4,o),e&&cd(e,a)||this._set("renderLocation",a),ar}_calculateScreenHorizontalEdgeOnSurface(e){let t=this.state.contentCamera,i=t.getRenderCenter(Kh());if(i[1]=t.aboveGround?t.padding[Ds.BOTTOM]:t.fullHeight-t.padding[Ds.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;let r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,wv)){ge(wv,wv,t.eye);let s=Z(wv,wv);if(this.renderCoordsHelper.intersectInfiniteManifold(ya(t.eye,s),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};c([h()],Ko.prototype,"_dirty",void 0),c([h({constructOnly:!0})],Ko.prototype,"scheduler",void 0),c([h({constructOnly:!0})],Ko.prototype,"centerOnSurface",void 0),c([h({constructOnly:!0})],Ko.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),c([h()],Ko.prototype,"updating",null),c([h()],Ko.prototype,"location",null),c([h()],Ko.prototype,"renderLocation",void 0),c([h()],Ko.prototype,"worldUnitsPerContentPixel",null),Ko=c([w("esri.views.3d.support.pointsOfInterest.Focus")],Ko);var G4=b(),wv=b(),q4=b();var kl=class extends k{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;let e=b();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([T(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),xi(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),this.surfaceView?.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);let e=jb(this.surfaceView.extent),t=new je({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{})):this._set("location",t)}};c([h({constructOnly:!0})],kl.prototype,"view",void 0),c([h({constructOnly:!0})],kl.prototype,"cache",void 0),c([h()],kl.prototype,"surface",null),c([h()],kl.prototype,"surfaceView",null),c([h({readOnly:!0})],kl.prototype,"location",void 0),c([h({readOnly:!0})],kl.prototype,"renderLocation",null),kl=c([w("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],kl);var Ll=class extends k{constructor(e){super(e),this._tileGeometryUpdateExtent=da(),this._tileGeometryUpdateSpatialReference=null,this.events=new ti,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(si.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating?(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",zJ),da(this._tileGeometryUpdateExtent),this._set("updating",!1),ar):ar}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Ya(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){let i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){let i=this.state.contentCamera.eye,r=UJ,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,em,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,tm,t),em[0]<tm[0]?(r[0]=em[0],r[2]=tm[0]):(r[0]=tm[0],r[2]=em[0]),em[1]<tm[1]?(r[1]=em[1],r[3]=tm[1]):(r[1]=tm[1],r[3]=em[1]),id(r,e)}};c([h({constructOnly:!0})],Ll.prototype,"state",void 0),c([h({constructOnly:!0})],Ll.prototype,"centerOnSurfaces",void 0),c([h({constructOnly:!0})],Ll.prototype,"renderCoordsHelper",void 0),c([h({constructOnly:!0})],Ll.prototype,"scheduler",void 0),c([h({constructOnly:!0})],Ll.prototype,"surface",void 0),c([h({readOnly:!0})],Ll.prototype,"updating",void 0),Ll=c([w("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],Ll);var zJ={},em=b(),tm=b(),UJ=da();var sn=class extends k{constructor(e){super(e),this.renderPointOfView=b(),this._pois=new Array,this._debugCenters=null,this._tmpRay=Zn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new fn({renderPointOfView:HJ},this)}initialize(){let{state:e,basemapTerrain:t,renderCoordsHelper:i,map:r}=this.view;this._surfaceIntersector=mn(e.viewingMode),this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=ll.MIN,this._contentIntersector=mn(e.viewingMode);let s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=this.view.basemapTerrain?.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new ao(se(I({},a),{task:si.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("centerOnSurfaceFrequent",new ao(se(I({},a),{task:si.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("centerOnContent",new ao(se(I({},a),{task:si.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}))),this._set("cameraOnSurface",new Qo(se(I({},a),{cache:o,task:si.POINT_OF_INTEREST_INFREQUENT,map:r}))),this._set("surfaceGeometryUpdates",new Ll(se(I({},a),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}))),this._set("contentGeometryUpdates",new WS({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new kl({cache:o,view:this.view})),this._set("focus",new Ko({state:e,scheduler:n,surface:t,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(l,d)=>this._estimateSurfaceIntersectionAtRenderPoint(l,this.view.state.contentCamera,d)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus),this.addHandles([T(()=>e.contentCamera,l=>this._cameraChanged(l),Re),T(()=>t.extent,()=>this._updateCenterPointsOfInterest()),T(()=>this.view.map?.ground?.navigationConstraint?.type,l=>{this._surfaceIntersector.options.backfacesTerrain=l==="none"},ie),_r(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),Re),xi(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),xi(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),T(()=>Vr.SHOW_POI,l=>this._setDebug(l),ie)]),this._cameraChanged(this.view.state.contentCamera);for(let l of this._pois)l.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(let e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;let e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Qf,GJ)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Qf):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;let e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;let t=e.origin,i=te(Qf,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(Qf)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Qf)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){let r=uw(t,e,jJ);if(r==null)return null;let s=r.origin,n=te(Qf,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();let t=e.eye;Wm(this.renderPointOfView,t)||this._set("renderPointOfView",G(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(let e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters?.forEach(t=>t.hide()),void this.removeHandles("debug");if(!this._debugCenters){this._debugCenters=new Map;let t=this.view.graphics;this._debugCenters.set(this.centerOnContent,new Ol(t,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new Ol(t,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new Ol(t,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new Ol(t,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new Ol(t,"green","Focus"))}for(let t of this._pois)this.addHandles(T(()=>t.renderLocation,i=>this._debugCenters?.get(t)?.show(i,t.renderCoordsHelper.spatialReference),ie),"debug")}get test(){}};c([h()],sn.prototype,"centerOnContent",void 0),c([h()],sn.prototype,"centerOnSurfaceFrequent",void 0),c([h()],sn.prototype,"centerOnSurfaceInfrequent",void 0),c([h()],sn.prototype,"cameraOnSurface",void 0),c([h()],sn.prototype,"focus",void 0),c([h()],sn.prototype,"renderPointOfView",void 0),c([h()],sn.prototype,"surfaceOrigin",void 0),c([h()],sn.prototype,"contentGeometryUpdates",void 0),c([h()],sn.prototype,"surfaceGeometryUpdates",void 0),c([h({constructOnly:!0})],sn.prototype,"view",void 0),c([h()],sn.prototype,"updating",null),sn=c([w("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],sn);var HJ=Array,Qf=b(),jJ=Zn(),GJ={exclude:new Set([cc])};var Yo=class{constructor(t,i){this._cache=t(i,(r,s,n)=>{switch(s){case WM.ALL:return r.forEach(o=>o.dispose()),0;case WM.SOME:{let o=r.shift();return o&&(n-=Math.round(o.usedMemory),o.dispose()),n}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(t){return this._cache.getSize(t)}pop(t){let i=this._cache.peek(t);if(!i)return;let r=i.pop();if(i.length>0){if(r){let s=this._cache.getSize(t)-Math.round(r.usedMemory);this._cache.updateSize(t,i,s)}}else this._cache.pop(t);return r}put(t,i,r=k2){let s=this._cache.peek(t);if(!s)return void this._cache.put(t,[i],i.usedMemory,r);s.push(i);let n=this._cache.getSize(t)+Math.round(i.usedMemory);this._cache.updateSize(t,s,n)}};var $S=class{constructor(t){this._store=t}destroy(){this._store.destroy()}get(t){return this._store.get(t)}put(t,i){this._store.put(t,i,i.values.byteLength+256)}};var Fl=class{constructor(t=0,i=0){this.min=t,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}};var ZS=class{constructor(t,i,r){this.type="elevation",this.level=t[0],this.i=t[1],this.j=t[2],this.extent=i,this.samplerData=new zN(r,i)}computeMinMaxValue(t,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;let n=t-this.level;if(n<=0)return s;let o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0,d=this.samplerData.data.width,u=this.samplerData.data.values,m=.5*P_,p=(d-1)/o,f=(r-this.j*o)*p,g=(i-this.i*o)*p;if(p<1){let _=Math.floor(f),y=Math.floor(g),v=_+y*d,x=u[v],S=u[v+1],C=u[v+d],E=u[v+d+1];if(x+S+C+E<m){let R=f-_,D=g-y,L=__(x,S,C,E,R,D),O=__(x,S,C,E,R+p,D),H=__(x,S,C,E,R,D+p),B=__(x,S,C,E,R+p,D+p);return s.min=Math.min(L,O,H,B),s.max=Math.max(L,O,H,B),s}f=_,g=y,p=1}else f=Math.floor(f),g=Math.floor(g),p=Math.ceil(p);for(let _=f;_<=f+p;_++)for(let y=g;y<=g+p;y++){let v=u[_+y*d];v<m?(a=Math.min(a,v),l=Math.max(l,v)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}},qJ=.5*P_;function Mi(e,t,i){if(i==null)return null;for(let r of i){if(!r)continue;let s=r.safeWidth,n=U(r.dy*(r.y1-t),0,s),o=U(r.dx*(e-r.x0),0,s),a=Math.floor(n),l=Math.floor(o),d=r.data.width,u=a*d+l,m=r.data.values,p=m[u],f=m[u+1],g=u+d,_=m[g],y=m[g+1];if(p+_+f+y<qJ){n-=a,o-=l;let v=p+(f-p)*o;return v+(_+(y-_)*o-v)*n}}return null}var Xo=class extends k{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){let e=[];return this.layerViews.forEach(t=>{let i=t.layer;if("operationalLayerType"in i&&VL(i.operationalLayerType)&&this.viewSpatialReference!=null){let r=$4(i.fullExtent,this.viewSpatialReference);r!=null&&e.push(AL(r))}}),e}};function W4(e,t){return e===we.Global?new dP(t):new hP(t)}c([h({readOnly:!0})],Xo.prototype,"layerViewsExtent",null),c([h({readOnly:!0})],Xo.prototype,"tiledLayersExtent",null),c([h({readOnly:!0})],Xo.prototype,"stencilEnabledExtents",null),c([h()],Xo.prototype,"viewSpatialReference",void 0),c([h()],Xo.prototype,"tilingScheme",void 0),c([h()],Xo.prototype,"defaultTiledLayersExtent",void 0),c([h({constructOnly:!0})],Xo.prototype,"layers",void 0),c([h({constructOnly:!0})],Xo.prototype,"layerViews",void 0),Xo=c([w("esri.views.3d.terrain.ExtentHelper")],Xo);var dP=class extends Xo{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?wB:xB}};dP=c([w("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],dP);var hP=class extends Xo{_computeLayerViewsExtent(){let e=da(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{let n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){let o=$4("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);Ya(e,o,e)}});let i=LM(e)?e:null,r=this._get("layerViewsExtent");return ha(i,r)?r:i}_computeTiledLayersExtent(){let e=this.tilingScheme;if(!e)return null;let t=this.viewSpatialReference,i=da();this.layers.forEach(n=>{if(n.loaded&&sd(n)){let o=pu(n,t,we.Local);if(o==null)return;let{tileInfo:a,fullExtent:l}=o,d="tilemapCache"in n?n.tilemapCache?.effectiveMaxLOD:void 0;a!=null&&l!=null&&(iw(n)||e.compatibleWith(a,d)&&l.spatialReference.equals(e.spatialReference))&&Ya(i,l,i)}}),Ya(i,this.defaultTiledLayersExtent,i);let r=LM(i)?i:null,s=this._get("tiledLayersExtent");return ha(r,s)?s:r}};function $4(e,t){return e==null||e.spatialReference.equals(t)?e:P2(e,e.spatialReference,t)}hP=c([w("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],hP);function QS(){let e=globalThis.require?.modules;if(e){let t=Object.keys(e);for(let i of t)i.includes(".glsl")&&delete e[i]}}var xv=class{constructor(t,i){this.screen=t,this.olid=i}};var Z4=1.3,WJ=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],Sh,nn=class extends k{constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=Qe("esri-mobile")?2048:4096}initialize(){let e=this.view;this.renderer=new pz({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.plugins.add(this.renderer);let t=()=>this.setDrawTexturesDirty();this._groundIntersector=mn(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([T(()=>this.renderer.hasHighlights,t),this.renderer.events.on("has-water",()=>e._stage?.renderer.updateHasFlags()),this.renderer.events.on("content-changed",t),T(()=>e.state.camera.pixelRatio,t),T(()=>e.state.alignPixelEnabled,t),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),T(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),T(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),Re),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(si.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",i=>{this._updateOverlays(qn,i.camera,Te.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(Te.BACKGROUND,i)})]),e._stage.renderer.overlay=this}destroy(){this.view?._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.overlay=null),Sh&&(Sh.hide(),Sh=null),this.renderer=z(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Vr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?ht(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return Z4/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}render(){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._precompileShaders()?this._drawOverlays(Te.UPDATE):null}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;let t=this.view.renderSpatialReference;e!=null&&t!=null?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new hE(-20037508342787e-6,20037508342787e-6):new hE(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);let r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,hz)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,Te.UPDATE)}_updateOverlays(e,t,i){if(!this._spatialReference)return ar;let r=this._computeOverlayResolution(t);this._computeOverlayExtents(t,r,Nl),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Nl.stretch);let s=this._updateOverlay(Kn.INNER,Nl.inner,r,1*Nl.pixelRatioAdjustment,Nl.mapUnitsPerPixel),n=bo(Nl.inner)/bo(Nl.outer),o=this._updateOverlay(Kn.OUTER,Nl.outer,r,n*Nl.pixelRatioAdjustment,Nl.mapUnitsPerPixel);s!==Vl.EXTENT&&o!==Vl.EXTENT||(this._drapeSources.forEach(a=>this._updateDrapeSourceExtent(a)),this.surface.updateTileOverlayParams(i)),s===Vl.NONE&&o===Vl.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){let t=this.view.state.contentPixelRatio*this.view.resolutionScale,i=e.fullWidth/e.pixelRatio*t,r=e.fullHeight/e.pixelRatio*t,s=Math.ceil(1.5*Math.max(i,r));return Math.min(wd(s),this._maxResolution)}_updateOverlay(e,t,i,r,s){if(this.renderer.overlays.length===0)return Vl.NONE;let n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=r,$J(t,n.extent)&&i===n.resolution)return o===s?Vl.NONE:Vl.RERENDER_ONLY;a_(n.extent,t),n.resolution=i;let a=jb(n.extent);return n.renderLocalOrigin=$B(a[0],a[1],0,"OV_"+this._latestOriginId++),Vl.EXTENT}setTileParameters(e){let t=e.renderData.overlay;if(this.renderer.overlays.length>0){let i=this.renderer.overlays[Kn.INNER],r=this.renderer.overlays[Kn.OUTER],s=e.extent;this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,r.extent)?(this._setTileOverlayData(s,Kn.INNER,t),this._setTileOverlayData(s,Kn.OUTER,t)):(this._clearTileOverlayData(Kn.INNER,t),this._clearTileOverlayData(Kn.OUTER,t))}else this._clearTileOverlayData(Kn.INNER,t),this._clearTileOverlayData(Kn.OUTER,t)}overlayPixelSizeInMapUnits(e,t){if(this.renderer.overlays.length===0)return t();let i=this.renderer.overlays[Kn.INNER],r=this.renderer.overlays[Kn.OUTER],s=this._pointIsInExtent(e,i.extent)?i:r;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,t,i){if(this.renderer.overlays.length===0)return;let r=this.renderer.overlays[t].extent,s=bo(r),n=ic(r),o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);let a=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}i.setScale(t,bo(e)/s,ic(e)/n),i.setOffset(t,(o-r[0])/s,(e[1]-r[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}reloadShaders(){QS(),this.setDrawTexturesDirty(),this.runTask(qn)}updateAnimation(e){return this.renderer.updateAnimation(e)&&(this._drawTexturesAnimateDirty=!0),this._drawTexturesAnimateDirty}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){let s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,KJ,t,i);if(s==null)return!1;let n=s.origin,o=te(KS,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5,r=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=U(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){let d=KS;gd(tp(ip,ht(this.view.spatialReference).radius+a),ya(e.eye,e.viewForward),d),ge(d,d,e.eye);let u=ba.normalize(xF(e.viewForward,d,e.viewRight))/e.fovY+.5,m=u<=0||u>=1?.5:r;i=l?m*u:u+m*(1-u)}else{let d=.5*Math.PI-Math.acos(-e.viewForward[2]),u=Math.tan(d),m=$s(0,u,1,0),p=h_(m,m,e.projectionMatrix)[1],f=U(.5+.5*p,0,1);i=f===1||f===0?.5:l?f*r:1-(1-f)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&F2(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,i){let r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=b();this._findHorizonBasedPointOfInterest(e,s)||G(s,r),Vr.OVERLAY_SHOW_CENTER?(Sh==null&&(Sh=new Ol(this.view.graphics,"red")),Sh.show(s,this._renderSR)):Sh?.hide();let n=Math.max(.1,Ai(e.eye,s)),o=wa(this.view.renderCoordsHelper,r,e.eye);this._overlaySREqualsRenderSR||sl(s,this._renderSR,s,this._spatialReference);let a=this.surface.extent,l=!this._isSpherical&&this._spatialReference?.isGeographic,d=l&&this._spatialReference?1/ht(this._spatialReference).metersPerDegree:1,u=this.view.state.contentPixelRatio,m=e.perScreenPixelRatio/u*n*d;i.mapUnitsPerPixel=m/this._worldToPCSRatio,i.stretch=this._overlayStretch;let p=t*m/2*i.stretch,f=!1,g=l?90:1/0;this._isSpherical&&a&&this._spatialReference&&(this._spatialReference.isWebMercator?(p/=Math.cos(wL(s[1])),g=a[3]):(f=!0,p/=ht(this._spatialReference).metersPerDegree,g=90),p>=g&&(p=g,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let _=1;f&&(_=1/Math.max(.2,Math.cos(Math.abs(Vt(s[1])))),p*_>180&&(_=180/p),i.mapUnitsPerPixel*=_);let y=Math.log(2)/12;p=Math.exp(Math.round(Math.log(p)/y)*y);let v=p*_,x=32,S=.5*t/(x*v),C=.5*t/(x*p);s[0]=Math.round(s[0]*S)/S,s[1]=Math.round(s[1]*C)/C;let E=i.inner;E[0]=s[0]-v,E[1]=s[1]-p,E[2]=s[0]+v,E[3]=s[1]+p,this._isSpherical&&this._shiftExtentToFitBounds(E,1/0,g);let R=i.outer;if(6*v>bo(a))a_(R,a);else if(Math.PI/2-Math.abs(o-Math.PI/2)<=.25*Math.PI)R[0]=E[0]-v,R[1]=E[1]-p,R[2]=E[2]+v,R[3]=E[3]+p;else{sl(e.eye,this._renderSR,KS,this._spatialReference),Xb(im,s,KS);let L=-Math.atan2(im[1],im[0])+.125*Math.PI;L<0&&(L+=2*Math.PI);let O=Math.floor(L/(.25*Math.PI));Qb(im,WJ[O],2*p),im[0]*=_,im[2]*=_,y2(R,E,im)}if(this._isSpherical)R[0]=this._longitudeCyclical.clamp(R[0]),R[2]=this._longitudeCyclical.clamp(R[2]),R[1]=Math.max(R[1],-g),R[3]=Math.min(R[3],g);else{let L=l_(E,a,ZJ),O=l_(R,a,QJ);NM(L,O)&&(R[2]=R[0],R[3]=R[1])}let D=Math.abs(E[2]-E[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,D),i.pixelRatioAdjustment=i.mapUnitsPerPixel/D}_precompileShaders(){return!!this.renderer.hasOverlays&&(this.renderer.precompileShaders(this.view.state),!0)}_drawOverlays(e,t=this.view.state){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;let i=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;let r=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(t),r!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(Te.UPDATE),i?(this.surface.requestRender(e),e===Te.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Te.BACKGROUND),this.renderer}_rectanglesOverlap(e,t){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):id(e,t))}_rectInsideRect(e,t){return t!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:NM(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];let i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,s=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),Gb(e,r,s)}get test(){}};function $J(e,t){let r=Vr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}c([h()],nn.prototype,"_spatialReference",void 0),c([h({readOnly:!0})],nn.prototype,"running",null),c([h()],nn.prototype,"_placementDirty",void 0),c([h()],nn.prototype,"_contentUpdated",void 0),c([h()],nn.prototype,"_isSpherical",null),c([h()],nn.prototype,"_worldToPCSRatio",null),c([h()],nn.prototype,"renderer",void 0),c([h({constructOnly:!0})],nn.prototype,"view",void 0),c([h({constructOnly:!0})],nn.prototype,"surface",void 0),c([h()],nn.prototype,"suspended",null),c([h()],nn.prototype,"updating",null),c([h({type:Boolean})],nn.prototype,"rendersOccludedDraped",null),nn=c([w("esri.views.3d.terrain.OverlayManager")],nn);var uP=class{constructor(){this.inner=ii(),this.outer=ii(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=Z4}},im=br(),KS=b(),Nl=new uP,ZJ=ii(),QJ=ii(),KJ=Zn(),Vl;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(Vl||(Vl={}));var YS=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=rc(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=Hi(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,rc(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(t){return this.outerEdgesOffsetAndLength[2*t]}getEdgeCount(t){return this.outerEdgesOffsetAndLength[2*t+1]}getEdgeVertexIndex(t,i){return this.getEdgeAttributeIndex(t,i)}getEdgeVertexPosition(t,i,r,s){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(t,s),i),te(i,i,r)}getEdgeNormal(t,i,r){let{typedBuffer:s,typedBufferStride:n}=this.vertexAttributes.normalCompressed;j2(i,s,this.getEdgeAttributeIndex(t,r),n)}setEdgeNormalFromValues(t,i,r,s,n){this._setNormal(this.getEdgeAttributeIndex(t,i),r,s,n)}setEdgeVertexFromValuesRawPositionUV(t,i,r,s,n,o,a){let l=this.getEdgeAttributeIndex(t,i);this.vertexAttributes.position.setValues(l,r,s,n),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(t,i,r,s,n,o,a,l,d,u){let m=this.getEdgeAttributeIndex(t,i);this.vertexAttributes.position.setValues(m,r,s,n),this._setUV(m,o,a),this._setNormal(m,l,d,u)}_getEdgeVertexRaw(t,i){this.vertexAttributes.position.getVec(t,i)}_setNormal(t,i,r,s){let{typedBuffer:n,typedBufferStride:o}=this.vertexAttributes.normalCompressed;nu(n,t,i,r,s,o)}_setUV(t,i,r){Jo(this.vertexAttributes.uv0,t,i,r)}getEdgeAttributeIndex(t,i){return W(0<=i&&i<this.getEdgeCount(t)),this.getEdgeFirstVertexIndex(t)+i}},Q4=16384;function Jo(e,t,i,r){e.setValues(t,i*Q4,r*Q4)}var XS=class{constructor(){this.sinLonLUT=new Array(mu+1),this.cosLonLUT=new Array(mu+1),this.sinLatLUT=new Array(mu+1),this.cosLatLUT=new Array(mu+1)}update(t,i,r){let s=i[0],n=i[2];for(let o=0;o<=t;o++){let a=o/t,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);let d=r(a);this.sinLatLUT[o]=Math.sin(d),this.cosLatLUT[o]=Math.cos(d)}}};var JS=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}};var Cv=class e{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=z(this._current),this._next=z(this._next),this._waiting=z(this._waiting),this._delayed=z(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){let i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let t=e.test.fadeMoment;if(this._delayed!=null&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,Bl.Immediate),this._delayed=null)),this._next!=null){t=t||performance.now();let i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==bi.FADING,n=t-this._fadeStart>=i;(r||s||n)&&(z(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;let t=e.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(t,i=Bl.Immediate){this._delayed=z(this._delayed),this._push(t,i)}_push(t,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=t);let r=e.test.fadeMoment||performance.now();return i!==Bl.Immediate?(this._delayed=t,void(this._delayedTime=r+i)):this._next==null?(this._next=t,void(this._fadeStart=this._alignFadeStart(r))):void(t!=null&&(z(this._waiting),this._waiting=t))}get _fadeDuration(){let t=this._getFadeDuration();return this._waiting?.5*t:t}_alignFadeStart(t){let i=this._getFadeDuration();return t+i-t%i}get _isFadingEnabled(){return this._getFadeDuration()>0}},Bl;Cv.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(Bl||(Bl={}));var Th=class{constructor(t,i,r,s,n,o){this.texture=t,this.type=i,this.offsetAndScale=r,t.retain(),this.opacities=dt(s,n,o)}destroy(){this.texture.release()}};var eT=class{constructor(){this._scales=$s(-1,-1,-1,-1),this._offsets=$s(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,i,r){this._scales[2*t]=i,this._scales[2*t+1]=r}setOffset(t,i,r){this._offsets[2*t]=i,this._offsets[2*t+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};var tT=class extends at{constructor(t,i,r){super(t,i,new ot(Qz,()=>import("./chunk-JN67XIE5.js")),r,mP),this.type="TerrainTechnique",this.useStencil=!1}initializePipeline(t){return this._stencilPipelineState=this._createPipeline(t,!0),this._createPipeline(t,!1)}_createPipeline(t,i){let{renderOccluded:r,output:s}=t,n=t.backfaceCullingEnabled&&!r;return mt({blending:r?cp:null,culling:n?S0:null,depthTest:r?null:{func:Vi.LESS},depthWrite:r?null:oN,colorWrite:wt,stencilTest:i?aN(v0.IntegratedMeshMaskExcluded):null,drawBuffers:s===K.Depth?{buffers:[U2.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}},mP=new Map([[Ii.POSITION,0],[Ii.UV0,1],[Ii.NORMALCOMPRESSED,2]]);var iT=class{constructor(){this.geometry=new YS,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureOpacity=1,this._textureRef=new Cv(()=>this._tile.surface.fadeDuration),this.overlay=new eT,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(t,i){this.clear(),this._tile=t,this.geometry.reset(),this.intersectionData=null,this.geometryState=new JS,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(t){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(t),this._geometryStateChangedSinceLastUpdate=!1),Cr&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)W(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(t,i){let r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){let l=r.surface.extent;if(l!=null&&(t===0&&r.extent[3]>l[3]||t===1&&r.extent[2]>l[2]||t===2&&r.extent[1]<l[1]||t===3&&r.extent[0]<l[0]))return s}let n=r.level,o=_n[t];if(!i)return W(r.surface?.rootTiles==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),s;if(i.loaded){let l=i,d=l.renderData.geometryState,u=n-l.level;if(W(u>=0),u===0){let f=d.numVerticesPerSide-1;return Math.max(f,s)}let m=2**u,p=d.edgeResolutions[(t+2)%4]/m;return Math.max(1,p)}W(!i.leaf);let a=s;return i.forAllSubtreeOnSide(Sp(o),l=>l===r||(l.loaded?(a=Math.max(a,2**(l.level-n)),!0):(W(!l.leaf),!1))),a}updateNeighborData(){let t=this.tile;if(!t.intersectsClippingArea)return;let i=t.renderData.geometryState,r=o=>(o.loaded||o.level===t.level)&&o?.intersectsClippingArea,s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let o=0;o<4;++o){let a=t.findNeighborTile(_n[o],r),l=Mh(t,a),d=l?.renderData?.geometryState.samplerDataVersion??-1,u=s[o],m=l!==Mh(t,u),p=n[o]!==d;Cr&&a&&(W(t.level>=a.level),W(t.level-a.level<=hr)),s[o]=a,(m||p)&&(n[o]=d,this._markEdgeDirty(o));let f=i.edgeResolutions[o],g=this._calculateEdgeResolution(o,a);W(Qh(g)),W(g>=1),i.edgeResolutions[o]=g,f!==g&&this._markEdgeResolutionDirty(o)}for(let o=0;o<4;++o){let a=t.findNeighborTile(fu[o],r);i.cornerPeerNeighbors[o]=a;let l=Mh(t,s[o]),d=Mh(t,s[(o+1)%4]),u=Mh(t,a);Na[o]=u,Na[(o+1)%4]=d,Na[(o+2)%4]=t,Na[(o+3)%4]=l,W(Na.some(g=>g?.loaded||g===t));let m=Na.reduce((g,_)=>Math.min(g,_?.level??1/0),1/0);Na.forEach((g,_)=>{g&&g?.level>m&&(Na[_]=null)}),W(Na.some(g=>g?.loaded||g===t));let p=i.cornerNeighborCornerTiles,f=i.cornerNeighborCornerTileSamplerVersions;for(let g=0;g<4;++g){let _=Na[g],y=_?.renderData.geometryState.samplerDataVersion??-1,v=4*o+g,x=p[v]!==_,S=!x&&f[v]!==y;(x||S)&&(p[v]=_,f[v]=y,this._markCornerDirty(o))}Cr&&W(rT.some(g=>p[4*o+g]?.loaded||p[4*o+g]===t))}Cr&&W(this.geometryState.edgeResolutions.every(o=>o>0));for(let o=0;o<4;++o)Na[o]=null}_updateGeometry(t){if(!this.tile.intersectsClippingArea)return;Cr&&W(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(f=>f>0)),this.intersectionData=null;let{tile:i,_vao:r,geometry:s,geometryState:n}=this,o=!r||!1||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=n.edgeResolutions.reduce((f,g)=>f+g+1,0),d=o||a&&l>(s?.maxEdgeVertexCount??0),u=!d&&a,m=!u&&(this.dirtyEdges!==0||a),p=!m&&this.dirtyCorners!==0;d?(this.releaseGeometry(),this._createGeometry(t)):u?i.updateEdgeElevationsAndResolutions():m||p?i.updateEdgeElevations():p?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=Ne(this._vao),this.geometry.release(),!0)}ensureTexture(t,i,r,s){let n=i?Ci.RGBA:Ci.RGB;return this._texture!=null&&(r===bi.FADING&&this._tile.surface.fadeDuration>0&&this._isTextureVisible(this._texture)||this._texture.descriptor.width!==t||this._texture.descriptor.pixelFormat!==n)&&this.releaseTexture(),this._texture==null&&(this._texture=s(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}reuseTexture(t,i){return!(!t||!this._texture)&&(t.setTextureReference(new Th(this._texture,bi.FADING,i,this._textureOpacity,0,1)),!0)}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&XJ)}get samplerDataChanged(){return!!(this._modifiedFlags&JJ)}get clippingAreaChanged(){return!!(this._modifiedFlags&eee)}get wireframeChanged(){return!!(this._modifiedFlags&tee)}get dirtyEdges(){return this._modifiedFlags>>pP&15}get dirtyCorners(){return this._modifiedFlags>>fP&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>gP&15}_markCornerDirty(t){let i=1<<t<<fP;this._modifiedFlags|=i}_markEdgeDirty(t){let i=1<<t<<pP;this._modifiedFlags|=i,this._markCornerDirty((t+0)%4),this._markCornerDirty((t+3)%4)}_markEdgeResolutionDirty(t){let i=1<<t<<gP;this._modifiedFlags|=i,this._markEdgeDirty(t)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<fP|15<<pP|15<<gP}updateGeometryState(){let t=this._elevationInfo,i=this.tile,r=t.samplerData?i.getElevationVerticesPerSide(t.maxTileLevel):i.minimumVerticesPerSide,s=Math.max(r,5),n=i.clippingArea;i.intersectsClippingArea&&!i.withinClippingArea||(n=null);let o=this.geometryState,a=!1;o.numVerticesPerSide!==s&&(this._modifiedFlags|=1,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),t.changed&&(this._modifiedFlags|=2,o.samplerData=t.samplerData,o.samplerDataVersion++,a=!0),xb(o.clippingArea,n)||(this._modifiedFlags=4,o.clippingArea=n,a=!0);let l=i.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||=a,a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(t){this.tile.createGeometry();let i=this.geometry.vertexAttributes,r=this.geometry.indices,s=t.gl;this._vao=new Dn(t,mP,new Map([["geometry",In(i.layout)]]),new Map([["geometry",es.createVertex(t,s.STATIC_DRAW,i.buffer)]]),es.createIndex(t,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(t,i=Bl.Immediate){t?.texture===this._texture?this._textureOpacity=t.opacities[0]:this.releaseTexture(),this._textureRef.push(t,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_isTextureVisible(t){return this._textureRef.current?.texture===t||this._textureRef.next?.texture===t&&this._textureRef.fadeFactor<1}get _elevationInfo(){let t=this.geometryState.samplerData,i=this.tile.layerInfo[Pe.ELEVATION],r=i.length,s=new Array(r),n=0,o=0,a=!1;for(let u=0;u<r;u++){let m=i[u],p=m.upsampleInfo?.tile;if(p){let f=p.layerInfo[Pe.ELEVATION][u].data,g=f&&f.samplerData;t&&t[n]===g||(a=!0),s[n++]=g,o=Math.max(o,p.lij[0])}else if(m.data){let f=this.tile.surface.layerViewByIndex(u,Pe.ELEVATION);if(xa(this.tile,f)){let g=m.data;t&&t[n]===g.samplerData||(a=!0),s[n++]=g.samplerData,o=this.tile.level}}}t!=null&&t.length!==n&&(a=!0);let l=n>0,d=l?s:null;return l&&(s.length=n),{changed:a,samplerData:d,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){let t=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+t}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!Cr)return;let t=this.tile;if(!t.loaded||!t.intersectsClippingArea||t.level===0)return void W(t?.loaded);let i=t.surface.extent;if(i!=null&&!t.intersectsExtent(i))return;let r=_n.map((a,l)=>i!=null&&(l<2?-1:1)*(t.extent[3-l]-i[3-l])<0),s=t.level;W(this.dirtyCorners===0),W(this.dirtyEdges===0),W(this.dirtyEdgeResolutions===0),W(!this.numVerticesPerSideChanged),W(!this.samplerDataChanged),W(!this.clippingAreaChanged),W(!this.wireframeChanged);let n=fu.map(a=>t.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.loaded||l.level===t.level)??null).map(a=>a?.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){let l=o.cornerPeerNeighbors[a],d=n[a];W(d===l,`Tile[${t.lij}].corner[${a}] out of date: cur=[${l?.lij}] exp=[${d?.lij}]`)}_n.forEach((a,l)=>{if(r[l])return;let d=t.findNeighborTile(a,ke=>(ke.level===s||ke?.loaded)&&ke?.intersectsClippingArea);if(!d){let ke=!t.surface.updatingRootTiles&&t.surface.rootTiles!=null&&t.surface.rootTiles.length>0&&t.shouldHaveNeighbor(a);return void W(!ke)}W(d.loaded||d.level===t.level),W(d===this.geometryState.edgePeerNeighbors[l]);let u=s-d.level;if(!d.loaded)return W(!d.leaf),void W(u===0);let m=d.renderData;W(t.isEdgeNeighbor(d,a)),W(u>=0);let p=2**u;if(u<0)return void W(!1);let f=t.renderData,g=f.geometry,_=f.localOrigin,y=g.getEdgeCount(l),v=g.numVerticesPerSide-1,x=m.geometry;if(!x)return void W(!1);let S=m.localOrigin,C=this.geometryState.edgePeerNeighbors[l];if(C?.loaded){let ke=C.renderData;W(f.geometryState.edgePeerNeighborSamplerVersions[l]===ke.geometryState.samplerDataVersion),W(this.geometryState.edgePeerNeighborSamplerVersions[l]===ke.geometryState.samplerDataVersion)}let E=(l+2)%4,R=x.getEdgeCount(E),D=y-1,L=R-1;W(D*p===L,`Tile[${t.lij}]:e${l},res=${D} edgeRes mismatch with Neighbor[${d.lij}]:e${E},res=${L} (expected:${D*p})`);let O=t.extent,H=a===li.NORTH||a===li.SOUTH,B=R-1,j=B>>u,Y=y-1;if(j<1)return void W(Y===1);W(j===Y),W(Qh(j));let N=x.numVerticesPerSide-1;W(u>0||j===Math.max(N,v));let F=t.getNeighborEdgeStartVertexIndex(l,d);W(0<=F&&F<p);let me=F*j;W(0<=me&&me<=B-j);let $=0,Q=me;g.getEdgeVertexPosition(l,zl,_,0),g.getEdgeVertexPosition(l,Ul,_,y-1);let Ie=Ai(zl,Ul),de=Math.max(YJ,1e-4*Ie);for(let ke=0;ke<=j;++ke){g.getEdgeVertexPosition(l,zl,_,$),x.getEdgeVertexPosition(E,Ul,S,Q);let pe=ke/j,xe=H?O[0]+pe*(O[2]-O[0]):a===li.WEST?O[0]:O[2],he=H?a===li.SOUTH?O[1]:O[3]:O[1]+pe*(O[3]-O[1]),oe=t.surface.extent;if(oe==null||DL(oe,xe,he)){let Ve=hs(zl,Ul),et=Fr(zl)-qs.radius,ye=Fr(Ul)-qs.radius,Ee=Ve<de;if(!Ee){console.warn(`Tile edge vertex position mismatch: between [${t.lij}].edge${l}[${$}/${y}] and [${d.lij}].edge${E}[${Q}/${R}]`),oe!=null&&console.warn("  surface extent= ",oe," x,y=",xe,",",he);let kt=b();ge(kt,f.localOrigin,m.localOrigin),Fr(kt)>0&&console.warn(`   localOrigins: ${f.localOrigin} vs ${m.localOrigin} d=${Fr(kt)} [${kt}]`),(()=>{let ft=Ws(zl),ee=Ws(Ul);t.updateEdgeElevations(),d.updateEdgeElevations(),g.getEdgeVertexPosition(l,zl,_,$),x.getEdgeVertexPosition(E,Ul,S,Q);let J=b();gi(J,zl,ft),Fr(J)>0&&console.warn(`  XXX Tile[${t.lij}] edge out of date: ${ft} vs ${zl} d=${Fr(J)} [${J}]`),gi(J,Ul,ee),Fr(J)>0&&console.warn(`  XXX Neighbor[${d.lij}] edge out of date: ${ee} vs ${Ul} d=${Fr(J)} [${J}]`)})();let Lt=g.getEdgeCount(l),ae=x.getEdgeCount(R);W(Ee,`Mismatch in tile [${t.lij}].edge[${l}][${$}/${Lt}] vs neighbor [${d.lij}].edge[${E}][${Q}/${ae}] ${pl(zl)} vs ${pl(Ul)}  dist=${Ve} h(t|n|d)=${et}|${ye}|${ye-et}`)}g.getEdgeNormal(l,Kf,$),x.getEdgeNormal(E,Yf,Q),Z(K4,Kf),Z(Y4,Yf);let Pt=X(K4,Y4),Ot=1-Pt<.01||!1||t===d;if(!Ot){let kt=b();gi(kt,Kf,Yf);let Lt=()=>`Mismatch in tile edge normal ${DE(t.lij)} (${$}/${y-1}) edge ${l} vs neighbor ${DE(d.lij)}  (${Q}/${R-1}) nedge ${E} :${pl(Kf)} vs ${pl(Yf)}  dot = ${Pt} : ${pl(kt)}`;console.warn("Mismatch in tile edge normal: ",Lt());{t.updateEdgeElevations(),d.updateEdgeElevations();let ae=b(),ft=b();g.getEdgeNormal(l,ae,$),x.getEdgeNormal(E,ft,Q),cd(Kf,ae)||console.warn("Missing update in tile normal: ",pl(Kf)," => ",pl(ae)),cd(Yf,ft)||console.warn("Missing update in neighbor normal: ",pl(Yf)," => ",pl(ft))}W(Ot,Lt())}}$+=1,Q+=1}})}},zl=b(),Ul=b(),Kf=b(),Yf=b(),K4=b(),Y4=b(),YJ=1,Na=[null,null,null,null];function Mh(e,t){return t?.loaded||t===e?t:null}var XJ=1,JJ=2,eee=4,tee=8,pP=4,fP=8,gP=12,rT=[0,1,2,3];var rm=class{get updating(){return!!this._tileRequested}init(t,i,r,s){this.tile=t,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(i,r),this._tileRequested=null;let n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){let t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t,i){this._setUpsampleTile(t,i),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,bi.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;let t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return t!=null?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){let t=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(t,i),{minLevel:s,maxLevel:n}=r.dataLevelRange,o=this._desiredMinLevelDelta,a=this._progressiveLevelModulo+o,l=this._scaleRangeEnabled?xa:()=>!0,d=this.tile,u=d.level,m,p=this._tileLayerInfo.upsampleInfo,f=p?.tile?.level??-1,g=p!=null&&f-u>=o,_=bz(r),y=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;d&&l(d,r)&&d.level>=s;){let v=d.level,x=u-v,S=d.layerInfo[i][t];if(S.data&&x>=o){(!g||v>f)&&this._setUpsampleTile(d),S.dataInvalidated&&(m=d);break}let C=y?.getLevelRowColumn(d.lij)??d.lij;if(_?.getAvailability(C[0],C[1],C[2])!=="unavailable"&&v<=n&&!S.data&&!S.dataMissing&&((!m||d.level===s||v%tw==0||u-m.level<o)&&(m=d),x>=a))break;d=d.parent}if(m!=null&&u-m.level<o)if(p)m=null;else{let v=this._findAncestorWithData();v!=null&&(this._setUpsampleTile(v),m=v.layerInfo[i][t].dataInvalidated?v:null)}return m}_findAncestorWithData(){let t=this.tile.elevationLevel,i=this._desiredMinLevelDelta,r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=i)return s;r=s}return r}_setUpsampleTile(t,i){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,bi.FADING,i)}get test(){}},_P=class extends rm{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw X4}get _progressiveLevelModulo(){throw X4}dispose(){}},X4=new Error("Abstract method called on TileAgent"),wn=new _P;var sT=class extends rm{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function J4(e){return e.type==="elevation"}var nT=class extends rm{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return tw}};function eq(e){return e.type==="map"}var ss;(function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"})(ss||(ss={}));var sm=class{constructor(){this.waitingAgents=new Dt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}get upsampleInfo(){return this._upsampleInfo}static acquire(t){let i=yP.acquire();return i._init(t),i}release(){this.dispose(),oT.delete(this),yP.release(this)}dispose(){this.loadingAgent=Ne(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=Md(this._data)}static prune(){yP.prune(0)}_init(t){this.waitingAgents.clear(),this._data=Md(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Er(this.requestAbort),this.requestPromise=null}_unsetUpsampleInfo(){this._upsampleInfo&&(this._upsampleInfo.tile?.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,i){if(t!==i&&i!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile?.unrefMapData()}i.refMapData(),Sz(t,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(t){Md(this._data),this._data=t}},yP=new yo(sm,null,()=>{}),oT=new Map;function tq(){oT.size>0&&(console.log(`${oT.size} live TilePerLayerInfo allocations:`),oT.forEach(e=>console.log(e,`
`)))}var _e;(function(e){e[e.NONE=0]="NONE",e[e.SPLIT=1]="SPLIT",e[e.ELEVATION=2]="ELEVATION",e[e.MERGE=4]="MERGE",e[e.GEOMETRY=8]="GEOMETRY",e[e.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=32]="TEXTURE_FADING"})(_e||(_e={}));var iee=.1,Eh=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=ii(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=ii(),this.centerAtSeaLevel=b(),this._center=[b(),Nr(),b()],this.up=qL(),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=0,this._rasterTileMemory=0,this._vectorTileMemory=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=b(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){wP.prune(0),xP.prune(0),sm.prune()}get _cached(){return!this.leaf&&this._mapDataRefCount<=0}get withinClippingArea(){return this._withinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Yi.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;let t=this.parent,i=t?.frustumVisibility??ss.INTERSECTS;this._frustumVisibility=i===ss.INSIDE?ss.INSIDE:i===ss.OUTSIDE?ss.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);let r=this._frustumVisibility!==ss.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){let t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setDirty()),t}init(t,i,r,s,n){this._lij[0]=t,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=ht(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(t,i,r,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Yi.MIDDLE][3]=0,this.elevationLevel=t,s&&!Number.isNaN(s.elevationBoundsMin)?(this._elevationBoundsMin=s.elevationBoundsMin,this._elevationBoundsMax=s.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.clearChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(let o of xh){let a=n.numLayers(o),l=this.layerInfo[o];for(let d of l)d.release();l.length=a;for(let d=0;d<a;d++)l[d]=sm.acquire(this._surface.upsampleInfoPool),o===Pe.ELEVATION&&this.findElevationBoundsForLayer(d,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,mu)}dispose(){xr(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key),this.layerInfo.forEach(t=>{t.forEach(i=>i.release()),t.length=0}),this._parent=null,this.clearChildren(),this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._cached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._cached){let t=this._cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=0}get usedMemory(){return this._ensureUsedMemory()+(this._cached?0:this._mapTileMemory)}get _cachedMemory(){return this._ensureUsedMemory(),this._cached?this._mapTileMemory:0}get _mapTileMemory(){return this._rasterTileMemory+this._vectorTileMemory}get _cpuImageMemorySize(){let i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(this._usedMemory>0)return this._vectorTileMemory=this.layerInfo[Pe.MAP].reduce((i,{data:r})=>i+(vp(r)?r.usedMemoryPerReference:0),0),this._usedMemory;this._usedMemory=this._baseUsedMemory,this._rasterTileMemory=0,this._vectorTileMemory=0;for(let{data:i}of this.layerInfo[Pe.MAP])vp(i)?this._vectorTileMemory+=i.usedMemoryPerReference:this._rasterTileMemory+=this._getTerrainDataMemory(i);let t=this._cpuImageMemorySize;for(let i of this.layerInfo[Pe.ELEVATION])this._usedMemory+=i.data?t:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._rasterTileMemory+=this.renderData.texture?.usedMemory??0),this._cached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory),this._usedMemory}getUsedMemoryForLayer(t,i){let r=this.layerInfo[t][i];return r?.data?t===Pe.MAP?this._cached?0:this._getTerrainDataMemory(r.data):t===Pe.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return RB(t)?t.texture.usedMemory:EB(t)?t.memoryUsage:vp(t)?t.usedMemoryPerReference:bp(t)||t instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(t){let i=this._center[Yi.MIDDLE],r=t,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(t,i,r){if(!this.visible)return _e.NONE;if(t.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(t.frustum)===ss.OUTSIDE))return _e.NONE;let s=this.level;ge(lT,this._center[Yi.MIDDLE],i);let n=ds(lT),o=lT,a=this._center[Yi.MIDDLE];ge(vP,this._center[Yi.TOP],i);let l=ds(vP);l<n&&(n=l,o=vP,a=this._center[Yi.TOP]),ge(bP,this._center[Yi.BOTTOM],i);let d=ds(bP);if(d<n&&(n=d,o=bP,a=this._center[Yi.BOTTOM]),this._edgeLen2>n&&s<t.maxLod)return _e.SPLIT;let u=Math.sqrt(n),m=t.fovX*u*2,p=this._edgeLen/m,f=()=>{if(s<t.maxLod)return this.elevationLevel=s,_e.NONE;let D=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return D!==this.elevationLevel?(this.elevationLevel=D,_e.ELEVATION):_e.NONE},g=r!=null?r-s:1/0;if(g<=.5)return f();let _=X(this.up,lT),y=this._elevationBoundsMax-this._elevationBoundsMin,v=y/this.edgeLen;if(t.aboveGround&&_>0&&v<.001&&_/u-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-v>0)return _e.NONE;let x=r!=null?3-Math.min(g,2):1;if(p*x<t.relativeWidthLimit||s>=t.maxLod)return f();if(s<7)return _e.SPLIT;q(fs,this.up,_),ge(fs,fs,o);let S=ds(fs);if(S<=this.radius*this.radius)return _e.SPLIT;q(fs,fs,this.radius/Math.sqrt(S)),te(fs,fs,a),ge(fs,i,fs);let C=Math.min(1,(Math.abs(X(fs,this.up))+.5*y+this._curvatureHeight)/be(fs)),E=iee/t.angledSplitBias,R=t.fovY*u*2;return C*(this._edgeLen/R*x)<E*t.relativeHeightLimit?_e.NONE:_e.SPLIT}createChildren(){let t=this._children,i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return t[0]=this.surface.createTile(i,r,s,this),t[1]=this.surface.createTile(i,r,s+1,this),t[2]=this.surface.createTile(i,r+1,s,this),t[3]=this.surface.createTile(i,r+1,s+1,this),t}clearChildren(){this._children[0]=this._children[1]=this._children[2]=this._children[3]=null}get loaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(let t of xh)this._createOrUpdateAgents(0,t);this.surface.renderer.loadTile(this)}unload(t){this.renderData&&this.unrefMapData(),t.unloadTile(this);for(let i of xh){let r=this.layerInfo[i];for(let s of r)s.loadingAgent&&s.loadingAgent!==wn&&(aT(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(_e.GEOMETRY),this.resetPendingUpdate(_e.TEXTURE_NOFADING),this.resetPendingUpdate(_e.TEXTURE_FADING)}unloadMapData(){let t=this.layerInfo[Pe.MAP];for(let i of t)i.loadingAgent&&i.loadingAgent!==wn&&(aT(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0,i.invalidateSourceData();this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(ha(t,this._clippingArea))return!1;let i=this._intersectsClippingArea,r=this._withinClippingArea;t!=null?(this._intersectsClippingArea=this.intersectsExtent(t),this._withinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._withinClippingArea=!0),this._clippingArea=t,this.updateVisibility();let s=r&&this._withinClippingArea,n=!(r||i||this._withinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(_e.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,i){return this.layerInfo[i][t]}hasLayerData(t,i){let r=this.layerInfo[i][t];return!(!r?.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(let t of xh){let i=this.layerInfo[t];for(let r of i)if(r.loadingAgent&&r.loadingAgent!==wn&&r.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(_e.SPLIT)||t!==Pe.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){let i=this._pendingUpdates;return this._pendingUpdates|=t,t===_e.SPLIT||t===_e.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,i,r){let s=this.layerInfo[i][t];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,t),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,t);let a=vp(s.data);return r.dataArrived(this,a),!0}if(s.requestPromise)return!0;Er(s.requestAbort),s.requestAbort=new AbortController;let n=this._surface.requestTileData(this,t,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;let o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get leaf(){return this._children[0]==null}hasLij(t){return this._lij[0]===t[0]&&this._lij[1]===t[1]&&this._lij[2]===t[2]}findByLij(t){if(this.hasLij(t))return this;let i=this._children;return i[0]?i[0].findByLij(t)||i[1].findByLij(t)||i[2].findByLij(t)||i[3].findByLij(t):null}distanceToSquared(t){return ds(ge(fs,this._center[Yi.MIDDLE],t))}containsPoint(t){let i=this.extent;return t[0]>=i[0]&&t[1]>=i[1]&&t[0]<=i[2]&&t[1]<=i[3]}containsPointXY(t,i){let r=this.extent;return t>=r[0]&&i>=r[1]&&t<=r[2]&&i<=r[3]}unrequestLayerData(t,i,r){let s=this.layerInfo[i][t],n=s.waitingAgents,o=n.removeUnordered(r)!=null;xr(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,i,r){let s=vp(r),n=this.layerInfo[i][t];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,i){let r=this.layerInfo[i][t];r.dataMissing=!0,r.waitingAgents.forAll(s=>s.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,i,r){switch(r&&this.forEachLoadedNeighbor(s=>s.updateRenderData(t,i)),t){case Pe.MAP:return this._updateTexture(i);case Pe.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===bi.FADING?_e.TEXTURE_NOFADING:_e.TEXTURE_FADING),this.setPendingUpdate(t===bi.FADING?_e.TEXTURE_FADING:_e.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(_e.GEOMETRY);for(let t of this.layerInfo[Pe.ELEVATION])t.pendingUpdates|=_e.GEOMETRY}invalidateLayerData(t,i){this.layerInfo[i][t].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){let t=this._elevationBoundsMin,i=this._elevationBoundsMax,r=1/0,s=-1/0,n=this.layerInfo[Pe.ELEVATION],o=!0;for(let a of n)a.elevationBounds!=null&&(r=Math.min(r,a.elevationBounds.min),s=Math.max(s,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(r=Math.min(r,0),s=Math.max(s,0)),t===r&&i===s||(this._elevationBoundsMin=r,this._elevationBoundsMax=s,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){let t=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(t+i),s=this._center;q(fs,this.up,r),te(s[Yi.MIDDLE],this.centerAtSeaLevel,fs),q(fs,this.up,t),te(s[Yi.TOP],this.centerAtSeaLevel,fs),q(fs,this.up,i),te(s[Yi.BOTTOM],this.centerAtSeaLevel,fs)}findElevationBoundsForLayer(t,i){let r=this.layerInfo[Pe.ELEVATION][t],s=this.elevationLevelDelta,n=Math.max(this.elevationLevel-s,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=n)return;let a=this._surface.layerViewByIndex(t,Pe.ELEVATION);if(!xa(this,a))return;let l=see,d=!1,u=r.data;if(u&&u.level<=n){let m=r.data;l.min=m.samplerData.data.minValue,l.max=m.samplerData.data.maxValue,l.hasNoDataValues=m.samplerData.data.hasNoDataValues,l.level=this.level,d=!0}else{let m,p,f=0;for(let g=this._parent;g&&(!p||f<s)&&(f=this.elevationLevel-g.level,m=p||m,p=g.layerInfo[Pe.ELEVATION][t].data,!(!p&&m&&g.level<=n));g=g.parent);p=p||m,p&&(p.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],l),l.min!==1/0&&(l.level=p.level,d=!0))}d&&(r.elevationBounds==null&&(r.elevationBounds=new Fl),r.elevationBounds.copyFrom(l))}modifyLayers(t,i,r){let s=this.layerInfo[r];for(let a of s)a.loadingAgent&&a.loadingAgent!==wn&&(aT(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();let n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){let l=i[a];s[a]=l>-1?n[l]:sm.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,bi.FADING))}updateAgents(t){if(this.renderData){let i=this.layerInfo[t];for(let r of i)r.loadingAgent===wn&&(r.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(let t of xh){let i=this._isSuspended(t);for(let r of this.layerInfo[t])r.loadingAgent&&r.loadingAgent!==wn&&(r.loadingAgent.setSuspension(i),r.loadingAgent===wn&&this.updateRenderData(t,bi.FADING))}}removeLayerAgent(t,i){let r=this.layerInfo[i][t];r.loadingAgent&&r.loadingAgent!==wn&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(t,i){let r=this.layerInfo[i][t];r.loadingAgent=wn,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(t+1,i)}_hasBlendableAncestor(t){return t.blendMode!=="normal"||nd(t.parent)&&this._hasBlendableAncestor(t.parent)}_hasBlendModes(t,i,r){for(let s=t;s<i;++s){let n=this._surface.layerViewByIndex(s,r);if(Td(n)&&n?.layer?.blendMode!=="normal"||nd(n?.layer?.parent)&&this._hasBlendableAncestor(n?.layer?.parent))return!0}return!1}_createOrUpdateAgents(t,i){let r=this.layerInfo[i];if(r.length===0)return;let s=this._isSuspended(i);for(let n=t;n<r.length;++n){let o=r[n],a=this._surface.layerViewByIndex(n,i),l=!1;if(o.loadingAgent?xa(this,a)?(o.loadingAgent!==wn&&o.loadingAgent.setSuspension(s),o.loadingAgent!==wn&&(l=o.loadingAgent.update())):o.dispose():xa(this,a)&&(o.loadingAgent=ree(this,n,i,s),l=o.loadingAgent.startLoading(),l?o.loadingAgent===wn&&this.setPendingUpdate(_e.GEOMETRY):(aT(o.loadingAgent),o.loadingAgent=wn)),o.loadingAgent===wn&&this.updateRenderData(i,bi.FADING),!this._hasBlendModes(t,r.length,i)&&l&&a.isOpaque)return}}_isWithinExtent(t){let i=this.extent;return i[0]>=t[0]&&t[2]>=i[2]&&i[1]>=t[1]&&t[3]>=i[3]}intersectsExtent(t){let i=this.extent;return i[2]>=t[0]&&t[2]>=i[0]&&i[3]>=t[1]&&t[3]>=i[1]}getElevationVerticesPerSide(t){let i=this.elevationLevel-this.level,r=Math.max(this.level-t,this.elevationLevelDelta-i),s=U(1+(this._maxTesselation>>r),2,this._maxTesselation+1),n=this.minimumVerticesPerSide;return Math.max(s,n)}_findLIJ(t,i){if(!t)return null;let r=this.surface.rootTiles;if(r!=null){for(let s of r)if(nee(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.leaf&&!i(n);){let a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(t,i){let r=this._lij,s=this._getNeighborLIJ(r,t);return s?Sv(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(t,i){let r=t===li.NORTH_EAST?1:t===li.NORTH_WEST?0:t===li.SOUTH_WEST?2:3,s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(t,i){return this.findNeighborTile(t,r=>i(r)||r.level===this.level)?.findCorner(Cp(t),i)||null}forAllSubtreeOnSide(t,i){let r=t===li.NORTH?[0,1]:t===li.NORTH_EAST?[1]:t===li.EAST?[1,3]:t===li.SOUTH_EAST?[3]:t===li.SOUTH?[2,3]:t===li.SOUTH_WEST?[2]:t===li.WEST?[0,2]:[0],s=n=>{let o=n.children;!i(n)&&o[0]&&r.forEach(a=>s(o[a]))};s(this)}getNeighborEdgeStartVertexIndex(t,i){if(!i)return 0;let r=this.level-i.level;if(W(!Cr||r>=0),r===0)return 0;let s=2**r,n=!(1&~t),o=n?0:1,a=i.lij[o+1]*s,l=this._lij[o+1],d=l-a,u=n?s-1-d:d;return Cr&&(W(a<=l&&l<a+s),W(0<=u&&u<s)),u}forEachLoadedNeighbor(t){let i=this.level,r=s=>s.level===i||s.loaded;_n.forEach(s=>{let n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(Sp(s),o=>!!o.loaded&&(t(o,s),!0))}),fu.forEach(s=>{let n=this.findNeighborTile(s,r)?.findCorner(Cp(s),o=>o.loaded);W(!n||cT(this,n,s)),n?.loaded&&t(n,s)})}_getNeighborLIJ(t,i){let r=LE(i)?-1:kE(i)?1:0,s=PE(i)?-1:OE(i)?1:0,n=[t[0],t[1]+r,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this._wrapLIJ(n):n[2]<0?null:n}_wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}isEdgeNeighbor(t,i){if(t==null)return!1;if(this.level===0&&t.level===0&&(this._eastEnd&&t._westEnd&&i===li.EAST||this._westEnd&&t._eastEnd&&i===li.WEST))return!0;let r=Math.max(1e-6*(this.extent[2]-this.extent[0]),1);switch(i){case li.NORTH:return gn(this.extent[3],t.extent[1],r);case li.SOUTH:return gn(this.extent[1],t.extent[3],r);case li.EAST:return gn(this.extent[2],t.extent[0],r)||gn(this.extent[2],-t.extent[0],r);case li.WEST:return gn(this.extent[0],t.extent[2],r)||gn(this.extent[0],-t.extent[2],r)}}get _eastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get _westEnd(){return this._lij[2]===0}checkGeometryWaterproofness(){O_&&(W(this.loaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(t){let i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(LE(t)&&i[3]+s>=r[3]||kE(t)&&i[1]-s<=r[1])return!1;let n=this.surface.isGlobal;return!(!n&&PE(t)&&i[0]-s<=r[0])&&!(!n&&OE(t)&&i[2]+s>=r[2])}updateDistanceToPOI(t){let i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2])return;G(this._lastPOI,t);let r=this._center[Yi.MIDDLE],s=t[0]-r[0],n=t[1]-r[1],o=t[2]-r[2];this.distanceToPOI=s*s+n*n+o*o}};function ree(e,t,i,r){let s=i===Pe.ELEVATION?xP.acquire():wP.acquire();return s.init(e,t,i,r),s}function aT(e){e.dispose(),J4(e)?xP.release(e):eq(e)&&wP.release(e)}var wP=new yo(nT),xP=new yo(sT),see=new Fl,Yi;function nee(e,t){let i=e.lij,r=t[0]-i[0];return!(r<0)&&t[1]>>r===i[1]&&t[2]>>r===i[2]}function Sv(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function cT(e,t,i){return e!=null&&t!=null&&t!==e&&(e.level>=t.level?iq(e,t,i):iq(t,e,Cp(i)))}function iq(e,t,i){W(e.level>=t.level);let r=BB(i),s=zB(i),n=e.extent,o=t.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],d=1e-5*(n[2]-n[0]),u=gn(a[0],l[0],d)||e.surface.isGlobal&&gn(a[0],-l[0],d),m=gn(a[1],l[1],d);if(u&&m)return!0;if(e.level===t.level)return W(!1),!1;if(!u&&!m)return W(!1),!1;let p=u?rq(o[1],o[3],n[1],n[3],d):rq(o[0],o[2],n[0],n[2],d);return W(p),p}function rq(e,t,i,r,s){return e-s<=i&&i<=r&&r<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Yi||(Yi={}));var lT=b(),vP=b(),bP=b(),fs=b();var oee=65536;function sq(e,t){let{tile:i,geometry:r,geometryState:s}=e,{extentInRadians:n,surface:o}=i,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:d,wireframe:u}=s,m=d-1,p=(d-2)**2,f=a&&(t===Do.HAS_SOUTH_POLE||t===Do.HAS_BOTH_POLES),g=a&&(t===Do.HAS_NORTH_POLE||t===Do.HAS_BOTH_POLES),_=((f?1:0)+(g?1:0))*dT*d,y=Mq(s),v=p+_+4*y,x=l.tileGeometryCache.acquire(v);r.numVerticesPerSide=d,r.vertexAttributes=x,r.maxEdgeVertexCount=y;let{boundingBox:S}=r;rc(S);let C=MP(e);gs.update(m,n,C),lee(e),r.poleVerticesStartIndex=p;let E=aee(e,f,g);r.edgeVerticesStartIndex=p+_,RP(e),TP(e),yq(r,E,u),e.intersectionData=null}function aee(e,t,i){let{tile:r,localOrigin:s,geometry:n}=e,{extent:o,ellipsoid:a}=r,{boundingBox:l,numVerticesPerSide:d,vertexAttributes:u,poleVerticesStartIndex:m}=n,p=d-1,f=s[0],g=s[1],_=s[2],y=a.radius,v=o[1],x=o[3],S=[],C=m,E=(R,D)=>{let L=D*d;ea(-f,-g,R*y-_,l),S.push(new SP(R===1,L,R===1?0:2,C,dT));let O=dq(R===-1?v:x,y),H=R*Math.PI/2-O,B=.99*(R===1?1:-1),j=y+0,{position:Y,uv0:N}=u,{typedBuffer:F,typedBufferStride:me}=u.normalCompressed;for(let $=1;$<=dT;++$){let Q=O+H*($/dT),Ie=Math.cos(Q),de=Math.sin(Q);for(let ke=0;ke<=p;ke++){let pe=ke/p,xe=gs.sinLonLUT[ke],he=gs.cosLonLUT[ke]*Ie,oe=xe*Ie,Ve=de,et=he*j-f,ye=oe*j-g,Ee=Ve*j-_;ea(et,ye,Ee,l),Y.setValues(C,et,ye,Ee),Jo(N,C,pe,B),nu(F,C,he,oe,Ve,me),++C}}};return t&&E(-1,0),i&&E(1,p),S}function lee(e){let{tile:t}=e;if(!t.intersectsClippingArea)return;let{geometry:i,geometryState:r,localOrigin:s}=e,{numVerticesPerSide:n,samplerData:o}=r,a=n-2,l=n-1,{vertexAttributes:d,boundingBox:u}=i,m=d.position,p=d.uv0,{typedBuffer:f,typedBufferStride:g}=d.normalCompressed,{extent:_}=t,y=_[0],v=_[2],x=_[1],S=_[3],C=t.ellipsoid.radius,E=s[0],R=s[1],D=s[2],L=m.typedBuffer,O=m.typedBufferStride,H=1/l,B=0;if(1<=a){let j=H,Y=x*(1-j)+S*j,N=gs.sinLatLUT[1],F=gs.cosLatLUT[1];for(let me=1;me<=a;me++){let $=me*H,Q=y*(1-$)+v*$,Ie=gs.sinLonLUT[me],de=gs.cosLonLUT[me],ke=C+Mi(Q,Y,o),pe=ke*de*F-E,xe=ke*Ie*F-R,he=ke*N-D;ea(pe,xe,he,u);let oe=(me-1)*O;L[oe]=pe,L[oe+1]=xe,L[oe+2]=he,Jo(p,me-1,$,j)}}for(let j=1;j<=a;j++){let Y=j*H,N=x*(1-Y)+S*Y,F=gs.sinLatLUT[j],me=gs.cosLatLUT[j],$=j+1,Q=$*H,Ie=x*(1-Q)+S*Q,de=gs.sinLatLUT[$],ke=gs.cosLatLUT[$],pe=gs.sinLonLUT[0],xe=gs.cosLonLUT[0],he=C+Mi(y,N,o),oe=xe*me*he-E,Ve=pe*me*he-R,et=F*he-D,ye=B*O,Ee=L[ye],Pt=L[ye+1],Ot=L[ye+2];for(let kt=1;kt<=a;kt++){let Lt=kt*H,ae=y*(1-Lt)+v*Lt,ft=gs.sinLonLUT[kt],ee=gs.cosLonLUT[kt],J=0,Le=0,Be=0;if(kt<a){let Yt=(B+1)*O;J=L[Yt],Le=L[Yt+1],Be=L[Yt+2]}else{let Yt=gs.sinLonLUT[l],Ji=gs.cosLonLUT[l],mr=C+Mi(v,N,o);J=Ji*me*mr-E,Le=Yt*me*mr-R,Be=F*mr-D}let Xe=oe,Me=Ve,re=et;oe=Ee,Ve=Pt,et=Ot,Ee=J,Pt=Le,Ot=Be;let ue=J-Xe,ze=Le-Me,lt=Be-re,mi=0,_i=0,Mt=0;if(j>1){let Yt=(B-a)*O;mi=L[Yt],_i=L[Yt+1],Mt=L[Yt+2]}else{let Yt=gs.sinLatLUT[0],Ji=gs.cosLatLUT[0],mr=C+Mi(ae,x,o);mi=ee*Ji*mr-E,_i=ft*Ji*mr-R,Mt=Yt*mr-D}let Wt=C+Mi(ae,Ie,o),Kt=ee*ke*Wt-E,Et=ft*ke*Wt-R,Rt=de*Wt-D;if(j<a){let Yt=B+a,Ji=Yt*O;L[Ji]=Kt,L[Ji+1]=Et,L[Ji+2]=Rt,ea(Kt,Et,Rt,u),Jo(p,Yt,Lt,Q)}let yt=mi-Kt,tt=_i-Et,ct=Mt-Rt,At=ee*me,zt=ft*me,Oi=F;Oi*Oi<.999&&(At=lt*tt-ze*ct,zt=ue*ct-lt*yt,Oi=ze*yt-ue*tt);let $t=1/Math.sqrt(At*At+zt*zt+Oi*Oi);nu(f,B,At*$t,zt*$t,Oi*$t,g),++B}}}function nq(e){e.tile.intersectsClippingArea&&(TP(e),eg(e),e.intersectionData=null)}function oq(e){e.tile.intersectsClippingArea&&(wq(e),TP(e),eg(e),Sq(e),e.intersectionData=null)}function aq(e){e.tile.intersectsClippingArea&&(cq(e),lq(e,!0),eg(e),e.intersectionData=null)}function TP(e){e.tile.intersectsClippingArea&&(cq(e),lq(e))}function lq(e,t=!1){let{geometry:i,geometryState:r,tile:s,localOrigin:n}=e,{level:o,extent:a,extentInRadians:l,ellipsoid:d}=s,u=d.radius,m=l[0],p=l[2],f=l[1],g=l[3],{samplerData:_}=r,y=a[0],v=a[2],x=a[1],S=a[3],C=MP(e),{boundingBox:E,vertexAttributes:R}=i,D=n[0],L=n[1],O=n[2],H=R.position,B=H.typedBuffer,j=H.typedBufferStride,Y=R.uv0;for(let N=0;N<4;++N){let F=N===1||N===3,me=r.edgeResolutions[N];W(Qh(me));let $=me+1,Q=Mh(s,r.edgePeerNeighbors[N]);if(Tq(s,Q,N)){xq(e,N,Q);continue}let Ie=Q!=null;W(!Ie||Q.level===s.level),W(!Ie||Po(s,Q)<=0);let de=Q?.renderData,ke=de?.geometryState;if(Cr){let ue=s.surface;if(!Q&&ue&&!ue.updatingRootTiles){let ze=_n[N],lt=s.findNeighborTile(ze,mi=>mi.loaded||mi.leaf||mi.level===s.level);lt?lt.intersectsClippingArea&&(W(!lt.loaded),W(!lt.leaf),W(lt.level===o)):W(ue?.rootTiles==null||!s.shouldHaveNeighbor(ze))}}let pe=N===1?a[2]:a[0],xe=Q?.extent,he=xe&&F?N===1?xe[0]:xe[2]:pe,oe=N===0?a[3]:a[1],Ve=N===1?1:0,et=N===0?1:0,ye=N===1?p:m,Ee=N===0?g:f,Pt=Math.sin(ye),Ot=Math.cos(ye),kt=Math.sin(Ee),Lt=Math.cos(Ee),ae=ke?.samplerData,ft=Ie?(ue,ze,lt)=>.5*(Mi(ue,ze,_)+Mi(lt,ze,ae)):(ue,ze,lt)=>Mi(ue,ze,_),ee=i.outerEdgesOffsetAndLength[2*N+0],J=t&&$>3?$-3:1,Le=_!=null&&_.some(ue=>ue!=null),Be=ae!=null&&ae.some(ue=>ue!=null),Xe=Le||Be,Me=1/me,re=ee;W(!xe||gn(xe[2]-xe[0],a[2]-a[0])),(()=>{let ue=N===1?-1:N===3?1:0,ze=N===0?-1:N===2?1:0,lt=(a[2]-a[0])*Me,mi=ue*lt,_i=ze*lt,Mt=F?ue*((p-m)*Me):0,Wt=F?0:ze*Me,Kt=et,Et=F?ye+Mt:ye,Rt=F?Math.sin(Et):Pt,yt=F?Math.cos(Et):Ot,tt=F?ye-Mt:ye,ct=F?Math.sin(tt):Pt,At=F?Math.cos(tt):Ot,zt=F?Ee:C(Kt+Wt),Oi=F?kt:Math.sin(zt),$t=F?Lt:Math.cos(zt),Yt=F?Ee:C(Kt-Wt),Ji=F?kt:Math.sin(Yt),mr=F?Lt:Math.cos(Yt),Ms=0,zn=0,os=0;{let ut=0*Me,Tr=F?pe:y*(1-ut)+v*ut,Qr=F?he:Tr,Dr=F?x*(1-ut)+S*ut:oe,pr=F?ye:m*(1-ut)+p*ut,ym=F?Pt:Math.sin(pr),vm=F?Ot:Math.cos(pr),$l=F?C(ut):Ee,Nh=F?Math.sin($l):kt,Zl=F?Math.cos($l):Lt,Ql=u+ft(Tr,Dr,Qr);Ms=vm*Zl*Ql,zn=ym*Zl*Ql,os=Nh*Ql}let vs=0,Zr=0,er=0;{let ut=1*Me,Tr=F?pe:y*(1-ut)+v*ut,Qr=F?he:Tr,Dr=F?x*(1-ut)+S*ut:oe,pr=F?ye:m*(1-ut)+p*ut,ym=F?Pt:Math.sin(pr),vm=F?Ot:Math.cos(pr),$l=F?C(ut):Ee,Nh=F?Math.sin($l):kt,Zl=F?Math.cos($l):Lt,Ql=u+ft(Tr,Dr,Qr);vs=vm*Zl*Ql,Zr=ym*Zl*Ql,er=Nh*Ql}for(let ut=1;ut<$-1;ut+=J){let Tr=0,Qr=0,Dr=0;{let Sn=(ut+1)*Me,Ha=F?pe:y*(1-Sn)+v*Sn,Zc=F?he:Ha,zs=F?x*(1-Sn)+S*Sn:oe,Qc=F?ye:m*(1-Sn)+p*Sn,Sm=F?Pt:Math.sin(Qc),ub=F?Ot:Math.cos(Qc),Lg=F?C(Sn):Ee,mb=F?Math.sin(Lg):kt,Fg=F?Math.cos(Lg):Lt,Tm=u+ft(Ha,zs,Zc);Tr=ub*Fg*Tm,Qr=Sm*Fg*Tm,Dr=mb*Tm}let pr=Tr,ym=Qr,vm=Dr,$l=vs,Nh=Zr,Zl=er;vs=pr,Zr=ym,er=vm;{let Sn=re+ut,Ha=Sn*j,Zc=$l-D,zs=Nh-L,Qc=Zl-O;B[Ha]=Zc,B[Ha+1]=zs,B[Ha+2]=Qc,ea(Zc,zs,Qc,E);let Sm=ut*Me;Jo(Y,Sn,F?Ve:Sm,F?Sm:et)}let Ql=Ms,h6=zn,u6=os;Ms=$l,zn=Nh,os=Zl;let Og=$l,kg=Nh,bm=Zl,hb=1/Math.sqrt(Og*Og+kg*kg+bm*bm),VO=bm*hb,wm=0,xm=0,Cm=0;if(Xe&&VO*VO<.999){let Sn=0,Ha=0,Zc=0;{let zs=N===0?-1:1;Sn=zs*(pr-Ql),Ha=zs*(ym-h6),Zc=zs*(vm-u6)}{let zs=ut*Me,Qc=F?pe:y*(1-zs)+v*zs,Sm=F?he:Qc,ub=F?x*(1-zs)+S*zs:oe,Lg=F?ye:m*(1-zs)+p*zs,mb=F?Pt:Math.sin(Lg),Fg=F?Ot:Math.cos(Lg),Tm=F?C(zs):Ee,BO=F?Math.sin(Tm):kt,zO=F?Math.cos(Tm):Lt,H1=Og,j1=kg,G1=bm;if(Ie){let Vh=u+Mi(Sm-mi,ub-_i,ae),Ng=F?zO:mr;H1=(F?At:Fg)*Ng*Vh,j1=(F?ct:mb)*Ng*Vh,G1=(F?BO:Ji)*Vh}{let Vh=u+Mi(Qc+mi,ub+_i,_),Ng=F?zO:$t,UO=(F?yt:Fg)*Ng*Vh,HO=(F?Rt:mb)*Ng*Vh,jO=(F?BO:Oi)*Vh;Ie||(H1=2*Og-UO,j1=2*kg-HO,G1=2*bm-jO);let q1=N===3?-1:1,GO=q1*(H1-UO),qO=q1*(j1-HO),WO=q1*(G1-jO);wm=Zc*qO-Ha*WO,xm=Sn*WO-Zc*GO,Cm=Ha*GO-Sn*qO;let W1=1/Math.sqrt(wm*wm+xm*xm+Cm*Cm);wm*=W1,xm*=W1,Cm*=W1}}}else wm=Og*hb,xm=kg*hb,Cm=bm*hb;i.setEdgeNormalFromValues(N,ut,wm,xm,Cm)}})()}}function cq(e){Cq(e)}function dq(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function cee(e,t,i,r){return dq(e*(1-r)+t*r,i)}function dee(e,t,i){return e*(1-i)+t*i}function MP(e){let{tile:t}=e;if(t.surface.isWebMercator){let r=t.extent,s=t.ellipsoid.radius;return n=>cee(r[1],r[3],s,n)}let i=t.extentInRadians;return r=>dee(i[1],i[3],r)}function hq(e,t){let{tile:i,geometryState:r,geometry:s}=e,{extent:n,surface:o}=i,{wireframe:a}=r,l=n[0],d=n[1],u=n[2]-l,m=n[3]-d,{numVerticesPerSide:p,clippingArea:f}=r,g=f!=null?Math.max(0,(f[0]-l)/u):0,_=f!=null?Math.max(0,(f[1]-d)/m):0,y=f!=null?Math.min(1,(f[2]-l)/u):1,v=f!=null?Math.min(1,(f[3]-d)/m):1,x=(p-2)**2,S=Mq(r),C=x+4*S,E=o.renderer.tileGeometryCache.acquire(C),{boundingBox:R}=s;rc(R),s.numVerticesPerSide=p,s.vertexAttributes=E,s.maxEdgeVertexCount=S,s.minu=g,s.minv=_,s.maxu=y,s.maxv=v,hee(e),s.edgeVerticesStartIndex=x,RP(e),EP(e),yq(s,[],a),e.intersectionData=null}function hee(e){let t=e.tile;if(!t.intersectsClippingArea)return;let{geometry:i,geometryState:r,localOrigin:s}=e,{samplerData:n,clippingArea:o,numVerticesPerSide:a}=r,{surface:l,extent:d,ellipsoid:u}=t,{isWebMercatorOnPlateCarree:m}=l,p=o??AP,f=d[0],g=d[1],_=d[2],y=d[3],v=Math.max(f,p[0]),x=Math.min(_,p[2]),S=Math.max(g,p[1]),C=Math.min(y,p[3]),E=u.radius,R=t.horizontalScale,D=a-1,L=a-2,{minu:O,minv:H,maxu:B,maxv:j,boundingBox:Y,vertexAttributes:N}=i,F=N.position,me=N.uv0,{typedBuffer:$,typedBufferStride:Q}=N.normalCompressed,Ie=s[0],de=s[1],ke=s[2],pe=F.typedBuffer,xe=F.typedBufferStride,he=0,oe=U(g,S,C),Ve=m?(Math.PI/2-2*Math.atan(Math.exp(-oe/E)))*E:oe*R,et=1/D,ye=U(g*(1-et)+y*et,S,C),Ee=Ve,Pt=m?(Math.PI/2-2*Math.atan(Math.exp(-ye/E)))*E:ye*R;for(let Ot=1;Ot<=L;Ot++){let kt=Ot/D,Lt=U(g*(1-kt)+y*kt,S,C),ae=U(kt,H,j),ft=Pt,ee=(Ot-1)/D,J=U(g*(1-ee)+y*ee,S,C),Le=Ee,Be=(Ot+1)/D,Xe=U(g*(1-Be)+y*Be,S,C),Me=m?(Math.PI/2-2*Math.atan(Math.exp(-Xe/E)))*E:Xe*R,re=U(Be,H,j);Ee=Pt,Pt=Me;let ue=U(f,v,x),ze=ue*R,lt=Mi(ue,Lt,n),mi=1/D,_i=U(mi,O,B),Mt=U(f*(1-_i)+_*_i,v,x),Wt=_i,Kt=Mt,Et=Mt*R,Rt=Mi(Mt,Lt,n);if(Ot===1){let yt=Et-Ie,tt=Ee-de,ct=Rt-ke,At=0*xe;pe[At]=yt,pe[At+1]=tt,pe[At+2]=ct,ea(yt,tt,ct,Y);let zt=U(mi,O,B);Jo(me,he,zt,ae)}for(let yt=1;yt<=L;yt++){let tt=Et,ct=Rt,At=(yt+1)/D,zt=U(At,O,B),Oi=U(f*(1-At)+_*At,v,x),$t=Kt;Kt=Oi;{let Zr=he+1,er=Zr*xe;if(Ot===1||yt===L){let ut=Oi*R,Tr=Mi(Oi,Lt,n);if(Ot===1&&yt<L){let Qr=ut-Ie,Dr=ft-de,pr=Tr-ke;pe[er]=Qr,pe[er+1]=Dr,pe[er+2]=pr,ea(Qr,Dr,pr,Y),Jo(me,Zr,zt,ae)}Et=ut,Rt=Tr}else Et=pe[er]+Ie,Rt=pe[er+2]+ke}let Yt=Et,Ji=Rt,mr=ze,Ms=lt;ze=tt,lt=ct;let zn=(he-L)*xe,os=Ot===1?Mi($t,J,n):pe[zn+2]+ke,vs=Mi($t,Xe,n);if(Ot<L){let Zr=he+L,er=Zr*xe,ut=tt-Ie,Tr=Me-de,Qr=vs-ke;pe[er]=ut,pe[er+1]=Tr,pe[er+2]=Qr,ea(ut,Tr,Qr,Y);let Dr=Wt;Wt=zt,Jo(me,Zr,Dr,re)}{let Zr=Yt-mr,er=Le-Me,ut=er*(Ji-Ms),Tr=Zr*(os-vs),Qr=-er*Zr,Dr=ut*ut+Tr*Tr+Qr*Qr;if(Dr===0)nu($,he,0,0,1,Q);else{let pr=1/Math.sqrt(Dr);nu($,he,ut*pr,Tr*pr,Qr*pr,Q)}}++he}}}function uq(e,t){e.tile.intersectsClippingArea&&(gq(e),fq(e,!0),eg(e),e.intersectionData=null)}function mq(e,t){e.tile.intersectsClippingArea&&(wq(e),EP(e),eg(e),Sq(e),e.intersectionData=null)}function pq(e,t){e.tile.intersectsClippingArea&&(EP(e),eg(e),e.intersectionData=null)}function EP(e,t){e.tile.intersectsClippingArea&&(gq(e),fq(e,!1))}function fq(e,t){let{geometry:i,geometryState:r,localOrigin:s}=e,n=e.tile,{surface:o,extent:a}=n,{clippingArea:l,samplerData:d}=r,u=l??AP,m=a[0],p=a[2],f=a[1],g=a[3],_=[g>u[3],p>u[2],f<u[1],m<u[0]],y=n.horizontalScale,v=_q(o.isWebMercatorOnPlateCarree,n.ellipsoid.radius,y),{minu:x,minv:S,maxu:C,maxv:E,boundingBox:R}=i,D=Math.max(m,u[0]),L=Math.min(p,u[2]),O=Math.max(f,u[1]),H=Math.min(g,u[3]),B=s[0],j=s[1],Y=s[2];for(let N=0;N<4;++N){let F=N===1||N===3,me=r.edgeResolutions[N];W(Qh(me));let $=me+1,Q=_[N],Ie=Mh(n,r.edgePeerNeighbors[N]);if(!Q&&Tq(n,Ie,N)){xq(e,N,Ie);continue}let de=Ie!=null&&!Q,ke=Ie?.renderData,pe=ke?.geometryState;if(Cr&&(W(!de||Ie.level===n.level),W(!de||Po(n,Ie)<=0),n&&!Ie&&!o.updatingRootTiles)){let Me=_n[N],re=n.findNeighborTile(Me,ue=>ue.loaded||ue.leaf||ue.level===n.level);o.updatingRootTiles||(re?re.intersectsClippingArea&&(W(!re.loaded),W(!re.leaf),W(re.level===n.level)):W(o?.rootTiles==null||!n.shouldHaveNeighbor(Me)))}let xe=U(N===1?p:m,D,L),he=U(N===0?g:f,O,H),oe=pe?.samplerData,Ve=t&&$>3?$-3:1,et=U(N===1?1:0,x,C),ye=U(N===0?1:0,S,E),Ee=de?(Me,re)=>.5*(Mi(Me,re,oe)+Mi(Me,re,d)):(Me,re)=>Mi(Me,re,d),Pt=(p-m)/me,Ot=F?N===1?Pt:-Pt:0,kt=F?0:N===0?Pt:-Pt,Lt=-Ot,ae=-kt,ft=0,ee=0,J=0;{let Me=0/me,re=F?xe:U(m*(1-Me)+p*Me,D,L),ue=F?U(f*(1-Me)+g*Me,O,H):he,ze=Ee(re,ue);ft=re*y,ee=v(ue),J=ze}let Le=0,Be=0,Xe=0;{let Me=1/me,re=F?xe:U(m*(1-Me)+p*Me,D,L),ue=F?U(f*(1-Me)+g*Me,O,H):he,ze=Ee(re,ue);Le=re*y,Be=v(ue),Xe=ze}for(let Me=1;Me<$-1;Me+=Ve){let re=Me/me,ue=Le,ze=Be,lt=Xe;{let ct=F?et:U(re,x,C),At=F?U(re,S,E):ye,zt=ue-B,Oi=ze-j,$t=lt-Y;ea(ue,Oi,$t,R),i.setEdgeVertexFromValuesRawPositionUV(N,Me,zt,Oi,$t,ct,At)}{let ct=(Me+1)/me,At=F?xe:U(m*(1-ct)+p*ct,D,L),zt=F?U(f*(1-ct)+g*ct,O,H):he,Oi=Ee(At,zt);Le=At*y,Be=v(zt),Xe=Oi}let mi=Le,_i=Xe,Mt=ft,Wt=ee,Kt=J;ft=ue,ee=ze,J=lt;let Et=0,Rt=0,yt=0;if(F){let ct=Be-ze,At=_i-lt,zt=Wt-ze,Oi=Kt-lt,$t=U(f*(1-re)+g*re,O,H),Yt=xe+Lt,Ji=Yt*y-ue,mr=Mi(Yt,$t,d)-lt,Ms=N===3?-1:1;if(Et=Ms*(-zt+ct)*mr,Rt=Ms*Ji*(-Oi+At),yt=-Ms*Ji*(-zt+ct),de){let zn=xe+Ot,os=zn*y-ue;Et=(-zt+ct)*(mr-(Mi(zn,$t,oe)-lt)),Rt=(Ji-os)*(-Oi+At),yt=-(Ji-os)*(-zt+ct)}}else{let ct=mi-ue,At=_i-lt,zt=Mt-ue,Oi=Kt-lt,$t=U(m*(1-re)+p*re,D,L),Yt=he+ae,Ji=Mi($t,Yt,d)-lt,mr=v(Yt)-ze,Ms=N===2?-1:1;if(Et=Ms*mr*(-Oi+At),Rt=Ms*(-zt+ct)*Ji,yt=-Ms*mr*(-zt+ct),de){let zn=$t,os=he+kt,vs=v(os)-ze;Et=(-mr+vs)*(-Oi+At),Rt=(-zt+ct)*(-Ji+(Mi(zn,os,oe)-lt)),yt=-(-mr+vs)*(-zt+ct)}}let tt=1/Math.sqrt(Et*Et+Rt*Rt+yt*yt);i.setEdgeNormalFromValues(N,Me,Et*tt,Rt*tt,yt*tt)}}}function gq(e,t){Cq(e)}function uee(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function mee(e,t){return e*t}function _q(e,t,i){return e?r=>uee(r,t):r=>mee(r,i)}function yq(e,t,i){let{numVerticesPerSide:r,vertexAttributes:s,maxEdgeVertexCount:n}=e,o=r-1,a=s.count,l=2*(r-3)*(r-3),d=4*(o+n-3),u=rT.reduce((_,y)=>_+(o+e.getEdgeCount(y)-3),0),m=t.reduce((_,y)=>_+o*(2*(y.latitudeResolution-1)+1),0),p=3*(i?2:1),f=(l+d+m)*p,g=a>=oee?new Uint32Array(f):new Uint16Array(f);for(let _=0;_<f;++_)g[_]=0;e.indices=g,e.indexCount=(l+u+m)*p,e.poleIndicesStartIndex=l*p,e.edgeIndicesStartIndex=(l+m)*p,i?(gee(e),_ee(e,t),bq(e)):(pee(e),fee(e,t),vq(e))}function pee(e){let{numVerticesPerSide:t,indices:i,vertexAttributes:r}=e,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=t-2,l=t-3,d=0,u=t-3,m=0;for(let p=0;p<l;++p){let f=p*a;for(let g=d;g<u;++g){let _=f+g,y=_+1,v=y+a,x=v-1;Eq(_,y,v,x,o,n)?(i[m]=_,i[m+1]=y,i[m+2]=v,i[m+3]=v,i[m+4]=x,i[m+5]=_):(i[m]=_,i[m+1]=y,i[m+2]=x,i[m+3]=x,i[m+4]=y,i[m+5]=v),m+=6}}}function fee(e,t){let{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:s}=e,n=i-1,o=s;for(let a of t){let l=a.isNorth?1:2,d=a.isNorth?2:1,u=a.isNorth?3:4,m=a.isNorth?4:3,p=e.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),f=1;for(let g=0;g<a.latitudeResolution;++g){let _=g===0?a.rowOffset:p+i;for(let y=0;y<n;y++){let v=_+y;r[o]=p,r[o+l]=p+1,r[o+d]=v,g<a.latitudeResolution-1?(r[o+u]=p+1,r[o+m]=v+1,r[o+5]=v,o+=6):o+=3,p+=f}p=_,f=1}}}function vq(e){let{indices:t,numVerticesPerSide:i,edgeIndicesStartIndex:r}=e,s=i-1,n=s-2,o=r;for(let a=0;a<4;++a){let l=IP[a],d=0,u=0,m=e.getEdgeCount(a),p=l.count;W(p===s-1);let f=a===1||a===2,g=f?1:2,_=f?2:1,y=e.getEdgeFirstVertexIndex(a),v=1,x=l.vertex0Index,S=l.stride;for(;d<m-1||u<p-1;){let C=x+u*S,E=y+d*v,R=d<m-1,D=u<p-1,L=R&&(!D||(R?0+s*(d+.5)/(m-1):0)<=(D?1+n*(u+.5)/(p-1):0));L?++d:++u;let O=L?E+v:C+S;t[o]=C,t[o+g]=E,t[o+_]=O,o+=3}}e.indexCount=o}function gee(e){let{indices:t,numVerticesPerSide:i,vertexAttributes:r}=e,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=i-2,l=0;for(let d=0;d<i-3;++d){let u=d*a;for(let m=0;m<i-3;++m){let p=d*a+m,f=p+1,g=f+a,_=g-1,y=u+m,v=y+1,x=v+a;Eq(y,v,x,x-1,o,n)?(Jf(t,l,p,f,g),l+=6,Jf(t,l,g,_,p)):(Jf(t,l,p,f,_),l+=6,Jf(t,l,_,g,f)),l+=6}}}function _ee(e,t){let{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:s}=e,n=r-1,o=s;for(let a of t){let l=a.connectedOuterEdgeOffset,d=e.getEdgeVertexIndex(l,0),u=1;for(let m=0;m<a.latitudeResolution;++m){let p=m===0?a.rowOffset:d+r;for(let f=0;f<n;f++)Jf(i,o,d,d+1,p+f),o+=6,m<a.latitudeResolution-1&&(Jf(i,o,d+1,p+f+1,p+f),o+=6),d+=u;d=p,u=1}}}function bq(e){let{indices:t,numVerticesPerSide:i,edgeIndicesStartIndex:r}=e,s=i-1,n=s-2,o=r;for(let a=0;a<4;++a){let l=IP[a],d=0,u=0,m=e.getEdgeCount(a),p=l.count;W(p===s-1);let f=a===1||a===2,g=f?1:3,_=f?3:1,y=e.getEdgeFirstVertexIndex(a),v=1,x=l.vertex0Index,S=l.stride;for(;d<m-1||u<p-1;){let C=x+u*S,E=y+d*v,R=d<m-1,D=u<p-1,L=R&&(!D||(R?0+s*(d+.5)/(m-1):0)<=(D?1+n*(u+.5)/(p-1):0));L?++d:++u;let O=L?E+v:C+S;t[o]=C,t[o+g]=E,t[o+g+1]=E,t[o+_]=O,t[o+_+1]=O,t[o+5]=C,o+=6}}e.indexCount=o}function RP(e){let{geometry:t,geometryState:i}=e,{edgeResolutions:r}=i,{numVerticesPerSide:s,edgeVerticesStartIndex:n}=t,o=s-2,a=n;for(let l=0;l<4;++l){{let d=l===0||l===2,u=(l===0?o-1:0)*o+(l===1?o-1:0),m=(d?0:1)*o+(d?1:0),p=IP[l];p.vertex0Index=u,p.stride=m,p.count=o}{let d=r[l]+1;t.outerEdgesOffsetAndLength[2*l+0]=a,t.outerEdgesOffsetAndLength[2*l+1]=d,a+=d}}}function wq(e){RP(e),e.geometryState.wireframe?bq(e.geometry):vq(e.geometry)}function xq(e,t,i){let{geometryState:r,geometry:s,tile:n,localOrigin:o}=e,a=t===1||t===3,l=r.edgeResolutions[t];W(Qh(l));let d=l+1,{boundingBox:u,minu:m,minv:p,maxu:f,maxv:g,vertexAttributes:_}=s,y=U(t===1?1:0,m,f),v=U(t===0?1:0,p,g),x=i.renderData,S=x.geometryState,C=x.geometry,E=(t+2)%4,R=C.getEdgeCount(E),D=n.getNeighborEdgeStartVertexIndex(t,i)*l,L=l*2**(n.level-i.level);W(S.edgeResolutions[E]===L),W(R-1===L);let O=x.localOrigin[0]-o[0],H=x.localOrigin[1]-o[1],B=x.localOrigin[2]-o[2],j=s.getEdgeFirstVertexIndex(t),Y=_.position,N=Y.typedBuffer,F=Y.typedBufferStride,me=_.normalCompressed,$=me.typedBuffer,Q=me.typedBufferStride,Ie=_.uv0,de=C.vertexAttributes,ke=C.getEdgeFirstVertexIndex(E),pe=de.position.typedBuffer,xe=de.position.typedBufferStride,he=de.normalCompressed.typedBuffer,oe=de.normalCompressed.typedBufferStride;for(let Ve=1;Ve<d-1;++Ve){let et=j+Ve,ye=ke+(D+Ve),Ee=et*F,Pt=ye*xe,Ot=pe[Pt]+O,kt=pe[Pt+1]+H,Lt=pe[Pt+2]+B;N[Ee]=Ot,N[Ee+1]=kt,N[Ee+2]=Lt,ea(Ot,kt,Lt,u);let ae=et*Q,ft=ye*oe;$[ae]=he[ft],$[ae+1]=he[ft+1];let ee=Ve/l,J=a?y:U(ee,m,f),Le=a?U(ee,p,g):v;Jo(Ie,et,J,Le)}}function Cq(e){let{geometry:t,geometryState:i,localOrigin:r}=e,{clippingArea:s,samplerData:n}=i,{minu:o,minv:a,maxu:l,maxv:d,boundingBox:u,vertexAttributes:m}=t,p=e.tile,{surface:f,ellipsoid:g,extent:_,extentInRadians:y,horizontalScale:v}=p,x=f.view?.viewingMode==="local",S=g.radius,C=0,E=0,R=0,D=(ae,ft,ee)=>{let J=y[ft===0?1:3],Le=y[ae===0?0:2],Be=Math.cos(J),Xe=Math.sin(J),Me=Math.sin(Le),re=Math.cos(Le),ue=S+ee;C=re*Be*ue,E=Me*Be*ue,R=Xe*ue},L=x?(()=>{let ae=s,ft=ae!=null&&(_[3]>ae[3]||_[2]>ae[2]||_[1]<ae[1]||_[0]<ae[0]),ee=_q(f.isWebMercatorOnPlateCarree,S,v);return(J,Le,Be)=>{let Xe=J===0?_[0]:_[2],Me=Le===0?_[1]:_[3],re=ft?U(Xe,ae[0],ae[2]):Xe,ue=ft?U(Me,ae[1],ae[3]):Me,ze=Be;C=re*v,E=ee(ue),R=ze}})():D,O=0,H=0,B=0,j=0,Y=0,N=0,F=0,me=0,$=0,Q=x&&f.isWebMercatorOnPlateCarree,Ie=(ae,ft,ee,J,Le)=>{let Be=0,Xe=0,Me=0;if(x){let re=ft*v,ue=Q?(Math.PI/2-2*Math.atan(Math.exp(-ee/S)))*S:ee*v;Be=re-C,Xe=ue-E,Me=J-R}else{let re=MP(ae),ue=ae.tile,ze=ue.extent,lt=ue.extentInRadians,mi=(ft-ze[0])/(ze[2]-ze[0]),_i=(ee-ze[1])/(ze[3]-ze[1]),Mt=lt[0]*(1-mi)+lt[2]*mi,Wt=re(_i),Kt=Math.cos(Wt),Et=Math.sin(Wt),Rt=Math.sin(Mt),yt=Math.cos(Mt),tt=S+J;Be=yt*Kt*tt-C,Xe=Rt*Kt*tt-E,Me=Et*tt-R}switch(Le){case 0:F+=Be,me+=Xe,$+=Me;break;case 1:j-=Be,Y-=Xe,N-=Me;break;case 2:F-=Be,me-=Xe,$-=Me;break;case 3:j+=Be,Y+=Xe,N+=Me}},de=s??AP,ke=_[0],pe=_[2],xe=_[1],he=_[3],oe=[he>de[3],pe>de[2],xe<de[1],ke<de[0]],Ve=Math.max(ke,de[0]),et=Math.min(pe,de[2]),ye=Math.max(xe,de[1]),Ee=Math.min(he,de[3]),Pt=ae=>Math.max(de[0],Math.min(de[2],ae)),Ot=ae=>Math.max(de[1],Math.min(de[3],ae)),kt=ae=>{let ft=i.cornerNeighborCornerTiles;O=0,H=0,B=1,j=0,Y=0,N=0,F=0,me=0,$=0;let ee=1/0;for(let re=0;re<4;++re){let ue=ft[4*ae+re];ee=Math.min(ee,ue?.level??1/0)}for(let re=0;re<4;++re){let ue=ft[4*ae+re];Tv[re]=ue?.level===ee?ue:null}let J=1,Le=0;for(let re=0;re<4;++re){let ue=Tv[re];ue&&(J=Math.max(J,ue?.renderData.geometryState.numVerticesPerSide),Le=ue.extent[2]-ue.extent[0])}let Be=Le,Xe=J;W(Xe>1);let Me=Be/Xe;for(let re=0;re<4;++re){let ue=Tv[(re+3)%4],ze=Tv[re%4];if(!ue&&!ze)continue;let lt=re===0?1:re===1?2:re===2?3:0,mi=re===0?2:re===1?3:re===2?0:1;if(ue&&ze){let _i=CP[re][0]*Me,Mt=CP[re][1]*Me,Wt=ue.extent,Kt=Pt(Wt[lt===0||lt===1?2:0]+_i),Et=Ot(Wt[lt===0||lt===3?3:1]+Mt),Rt=ze.extent,yt=Pt(Rt[mi===0||mi===1?2:0]+_i),tt=Ot(Rt[mi===0||mi===3?3:1]+Mt),ct=ue.renderData,At=ze.renderData,zt=Mi(Kt,Et,ct.geometryState.samplerData),Oi=Mi(yt,tt,At.geometryState.samplerData);Ie(ct,Kt,Et,.5*(zt+Oi),re)}else{let _i=ue??ze,Mt=ue?lt:mi,Wt=_i.extent,Kt=CP[re],Et=Pt(Wt[Mt===0||Mt===1?2:0]+Kt[0]*Me),Rt=Ot(Wt[Mt===0||Mt===3?3:1]+Kt[1]*Me),yt=_i.renderData,tt=Mi(Et,Rt,yt.geometryState.samplerData);Ie(yt,Et,Rt,tt,re)}}if(!x){let re=Math.sqrt(C*C+E*E+R*R);O=C/re,H=E/re,B=R/re}if(x||B*B<.999){let re=Math.sqrt(j*j+Y*Y+N*N);j/=re,Y/=re,N/=re;let ue=Math.sqrt(F*F+me*me+$*$);F/=ue,me/=ue,$/=ue,O=N*me-Y*$,H=j*$-N*F,B=Y*F-j*me;let ze=1/Math.sqrt(O*O+H*H+B*B);O*=ze,H*=ze,B*=ze}},Lt=i.cornerNeighborCornerTiles;for(let ae=0;ae<4;++ae){let ft=ae,ee=(ae+1)%4,J=ae===0||ae===1?1:0,Le=ae===0||ae===3?1:0,Be=U(J,o,l),Xe=U(Le,a,d),Me=t.getEdgeFirstVertexIndex(ft),re=t.getEdgeCount(ft),ue=ae===0||ae===3?re-1:0,ze=t.getEdgeFirstVertexIndex(ee),lt=t.getEdgeCount(ee),mi=ae===0||ae===1?lt-1:0,_i=-1;for(let Kt=0;Kt<4;++Kt){let Et=Lt[4*ae+Kt],Rt=Lt[4*ae+_i];Et&&(_i===-1||Po(Rt,Et)>0)&&(_i=Kt)}let Mt=_i,Wt=Lt[4*ae+Mt];if(Wt!==p){let Kt=p.level-Wt.level,Et=2**Kt,Rt=[Wt.lij[0]+Kt,Wt.lij[1]*Et,Wt.lij[2]*Et],yt=[Rt[1]+Et===p.lij[1],ae===0&&(Mt===1||Mt===0&&Wt!==Lt[4*ae+3])||ae===1&&(Mt===0||Mt===1&&Wt!==Lt[4*ae+2]),Rt[1]===p.lij[1]+1,ae===2&&(Mt===3||Mt===2&&Wt!==Lt[4*ae+1])||ae===3&&(Mt===2||Mt===3&&Wt!==Lt[4*ae+0])],tt=yt.reduce(($t,Yt)=>$t+(Yt?1:0),0);W(tt===1||tt===2);let ct=-1,At=-1,zt=Wt.renderData;if(tt===1){let $t=yt.findIndex(Ji=>Ji);W(0<=$t&&$t<=3),ct=($t+2)%4;let Yt=i.edgeResolutions[$t];At=p.getNeighborEdgeStartVertexIndex($t,Wt)*Yt+Yt*($t===0&&ae===0||$t===1&&ae===0||$t===2&&ae===1||$t===3&&ae===3?1:0)}else{W(yt[1]||yt[3]),ct=yt[1]?3:1;let $t=zt.geometryState.edgeResolutions[ct];At=ae===0||ae===3?0:$t}let Oi=zt.geometry;{let $t=Me+ue,Yt=ze+mi,Ji=Oi.getEdgeFirstVertexIndex(ct)+At,mr=Oi.vertexAttributes,Ms=zt.localOrigin;{let os=mr.position,vs=os.typedBuffer,Zr=Ji*os.typedBufferStride,er=vs[Zr]+Ms[0]-r[0],ut=vs[Zr+1]+Ms[1]-r[1],Tr=vs[Zr+2]+Ms[2]-r[2];ea(er,ut,Tr,u);let Qr=m.position,Dr=Qr.typedBuffer;{let pr=$t*Qr.typedBufferStride;Dr[pr]=er,Dr[pr+1]=ut,Dr[pr+2]=Tr}{let pr=Yt*Qr.typedBufferStride;Dr[pr]=er,Dr[pr+1]=ut,Dr[pr+2]=Tr}}let zn=m.uv0;Jo(zn,$t,Be,Xe),Jo(zn,Yt,Be,Xe);{let os=mr.normalCompressed.typedBuffer,vs=Ji*mr.normalCompressed.typedBufferStride,Zr=m.normalCompressed,er=Zr.typedBuffer;{let ut=$t*Zr.typedBufferStride;er[ut]=os[vs],er[ut+1]=os[vs+1]}{let ut=Yt*Zr.typedBufferStride;er[ut]=os[vs],er[ut+1]=os[vs+1]}}}}else{let Kt=oe[ft],Et=oe[ee],Rt;if(Kt||Et){let At=U(ke*(1-J)+pe*J,Ve,et),zt=U(xe*(1-Le)+he*Le,ye,Ee);Rt=Mi(At,zt,n)}else Rt=yee(Lt,ae);L(J,Le,Rt),kt(ae);let yt=C-r[0],tt=E-r[1],ct=R-r[2];ea(yt,tt,ct,u),t.setEdgeVertexFromValuesRawPositionUVNormal(ft,ue,yt,tt,ct,Be,Xe,O,H,B),t.setEdgeVertexFromValuesRawPositionUVNormal(ee,mi,yt,tt,ct,Be,Xe,O,H,B)}}for(let ae=0;ae<4;++ae)Tv[ae]=null}function yee(e,t){let i=4*t,r=rT.reduce((a,l)=>Math.min(a,e[i+l]?.level??1/0),1/0);Cr&&(W(!e[i+0]||!e[i+2]||cT(e[i+0],e[i+2],li.SOUTH_WEST)),W(!e[i+1]||!e[i+3]||cT(e[i+1],e[i+3],li.NORTH_WEST)));let s=0,n=0;for(let a=0;a<4;++a){let l=e[i+a];if(l&&l.level===r){let d=a===0||a===1,u=a===0||a===3,m=l.extent,p=m[d?0:2],f=m[u?1:3],g=l.renderData?.geometryState?.samplerData;n+=Mi(p,f,g),s++}}let o=s?n/s:0;return W(o!=null),o}function eg(e){let{vao:t,geometry:i}=e,{vertexAttributes:r,edgeVerticesStartIndex:s}=i,n=r.position.typedBuffer;t.vertexBuffers.get("geometry").setSubData(n,s,s,n.length)}function Sq(e){let{vao:t,geometry:i}=e,{indices:r,indexCount:s,edgeIndicesStartIndex:n}=i;t.indexBuffer.setSubData(r,n,n,s)}var SP=class{constructor(t,i,r,s,n){this.isNorth=t,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=s,this.latitudeResolution=n}},CP=[[0,1],[1,0],[0,-1],[-1,0]],gs=new XS,AP=RL(-1/0,-1/0,1/0,1/0),Tv=[null,null,null,null];function Tq(e,t,i){if(!t)return!1;let r=Po(e,t);return r>0||r===0&&i>=2}var Xf=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(t){return W(0<=t&&t<this.count),this.vertex0Index+this.stride*t}},IP=[new Xf,new Xf,new Xf,new Xf];function ea(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function Mq(e){let{edgeResolutions:t,numVerticesPerSide:i}=e,r=1+Math.max(...t);return Math.max(i,r)}function Eq(e,t,i,r,s,n){let o=e*s,a=n[o],l=n[o+1],d=n[o+2],u=t*s,m=n[u],p=n[u+1],f=n[u+2],g=i*s,_=n[g],y=n[g+1],v=n[g+2],x=r*s,S=n[x],C=n[x+1],E=n[x+2];return(m-S)*(m-S)+(p-C)*(p-C)+(f-E)*(f-E)>(a-_)*(a-_)+(l-y)*(l-y)+(d-v)*(d-v)}function Jf(e,t,i,r,s){e[t]=i,e[t+1]=r,e[t+2]=r,e[t+3]=s,e[t+4]=s,e[t+5]=i}var dT=6;var uT=class extends Eh{constructor(t,i,r,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=ii(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(t,i,r,s,n)}init(t,i,r,s,n){super.init(t,i,r,s,n);let o=n.view.renderSpatialReference,a=n.spatialReference,l=o!=null&&Fb(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;let{isWebMercatorOnPlateCarree:d}=n,u=this._extentInRenderSR,m=this.extent;if(d){let p=dt(m[0],m[1],0);sl(p,gt.WebMercator,p,gt.PlateCarree);let f=dt(m[2],m[3],0);sl(f,gt.WebMercator,f,gt.PlateCarree),u[0]=p[0],u[1]=p[1],u[2]=f[0],u[3]=f[1]}else for(let p=0;p<4;++p)u[p]=m[p]*l;this.centerAtSeaLevel[0]=.5*(u[0]+u[2]),this.centerAtSeaLevel[1]=.5*(u[1]+u[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(u[2]-u[0],u[3]-u[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();let t=this._extentInRenderSR,i=.5*(t[2]-t[0]),r=.5*(t[3]-t[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(s,n);this._center[Yi.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(t){let i=this._aabb(),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5],d=!0;for(let u=0;u<6;u++){let m=t[u],p=m[0],f=m[1],g=m[2],_=m[3];if(p*(p>0?r:o)+f*(f>0?s:a)+g*(g>0?n:l)+_>=0)return ss.OUTSIDE;d=d&&p*(p<0?r:o)+f*(f<0?s:a)+g*(g<0?n:l)+_<=0}return d?ss.INSIDE:ss.INTERSECTS}_aabb(){let t=this._extentInRenderSR;return _2(t[0],t[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),t[2],t[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(t,i,r,s){return hT[0]=1/i[0],hT[1]=1/i[1],hT[2]=1/i[2],R0(this._aabb(),t,hT,r,s)}createGeometry(){hq(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){let t=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData,s=t,n=i;if(r){let o=r.geometry.boundingBox;s=o[2],n=o[5]}else if(!this.leaf){s=1/0,n=-1/0;for(let o of this.children){let a=o;s=Math.min(s,a._subtreeGeometryElevationBoundMin),n=Math.max(n,a._subtreeGeometryElevationBoundMax)}}(s!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax)&&(this._subtreeGeometryElevationBoundMin=s,this._subtreeGeometryElevationBoundMax=n,this.parent?._updateSubtreeGeometryElevationsBounds())}get minimumVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){uq(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){pq(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){mq(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}},hT=b();var DP=class{constructor(){this.extent=br(),this.minLevel=0,this.maxLevel=0,this.callback=null}},Mv=class extends k{constructor(){super(...arguments),this._queries=new Dt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Dt({initialSize:30}),this._queryPool=new yo(DP)}queryVisibleLevelRange(e,t,i,r){let s=this._queryPool.acquire();Hm(s.extent,e),s.minLevel=t??-Number.MAX_VALUE,s.maxLevel=i??Number.MAX_VALUE,s.callback=r,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){let e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){let t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){let t=e.level,i=0;for(;i<this._queriesInvPtr;){let r=this._queries.data[i],s=r.extent;t>=r.minLevel&&t<=r.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};c([h()],Mv.prototype,"updating",null),Mv=c([w("esri.views.3d.terrain.ScaleRangeQueries")],Mv);function Rq(e,t,i,r){let s=Math.cos(i);e[0]=Math.cos(t)*s*r,e[1]=Math.sin(t)*s*r,e[2]=Math.sin(i)*r}var mT=class extends Eh{constructor(t,i,r,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=Nr(),this._baseUsedMemory=1816,this.init(t,i,r,s,n)}init(t,i,r,s,n){super.init(t,i,r,s,n);let o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],d=this.extentInRadians[2],u=this.extentInRadians[3],m=Ke(l,u,.5),p=Ke(a,d,.5),f=t===0?0:Math.min(Math.abs(l),Math.abs(u));this._edgeLen=(d-a)*Math.cos(f)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),Rq(this.centerAtSeaLevel,p,m,this.ellipsoid.radius),Z(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();let t=this._center;if(this.lij[0]===0)ve(t[Yi.MIDDLE],0,0,0),ve(t[Yi.TOP],0,0,0),ve(t[Yi.BOTTOM],0,0,0),t[Yi.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();let i=t[Yi.MIDDLE],r=this.convexHull,s=0;for(let n=0;n<8;++n)s=Math.max(s,vee(i,r,3*n));t[Yi.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(t){if(!w_(t,this._boundingSphere))return ss.OUTSIDE;if(this.lij[0]<10)return ss.INTERSECTS;let i=this.convexHull,r=this.surface.view.state.camera.near,s=!0;for(let n=0;n<kF;n++){let o=n===_d.NEAR,a=t[n],l=a[0],d=a[1],u=a[2],m=a[3]-(o?r:0),p=!1;for(let f=0;f<8;++f){let g=3*f;if(l*i[g]+d*i[g+1]+u*i[g+2]+m<0){if(p=!0,!s)break}else s=!1}if(!p)return ss.OUTSIDE}return s?ss.INSIDE:ss.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){sq(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Cr&&this._checkBVs()}_updateBoundingSphere(){let t=this._boundingSphere,i=t,r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this.ellipsoid.radius,o=s;if(this.level===0)ve(i,0,0,0),t[3]=n+o;else{let a=this.extentInRadians,l=.5*(a[0]+a[2]),d=a[1],u=a[3];nm(Dq,l,d,n),nm(Pq,l,u,n),te(i,Dq,Pq),q(i,i,(n+.5*(r+s))/Fr(i));let m=this.convexHull,p=0,f=(_,y)=>{let v=_[0]-m[3*y],x=_[1]-m[3*y+1],S=_[2]-m[3*y+2];return Math.sqrt(v*v+x*x+S*S)};for(let _=0;_<8;++_){let y=f(i,_);p=Math.max(p,y)}let g=p;t[3]=g+2}}_updateConvexHull(){let t=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;let r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this._getPatchType(),o=this.surface.isWebMercator,a=o&&n===Do.HAS_NORTH_POLE,l=o&&n===Do.HAS_SOUTH_POLE,d=l||a,u=Math.PI/2,m=t[0],p=t[2],f=l?-u:t[1],g=a?u:t[3],_=.5*(m+p),y=r,v=i+(d?Math.min(0,y-1):y),x=($,Q,Ie)=>nm($,Q,Ie,v),S=b(),C=b(),E=b(),R=b();x(S,m,f),x(C,m,g),x(E,p,g),x(R,p,f);let D=($,Q)=>{for(let Ie=0;Ie<3;++Ie)this._convexHull[3*Q+Ie]=$[Ie]};D(S,0),D(C,1),D(E,2),D(R,3);let L=s,O=i+(d?Math.max(0,L+1):L),H=b(),B=b(),j=b();nm(B,_,g,v),nm(j,_,f,v),te(H,B,j),Z(H,H);let Y=b(),N=b(),F=($,Q)=>{gi(N,$,Q),Z(N,N);let Ie=-X($,Y)/X(N,Y);W(Ie>=0),q(N,N,Ie),te($,$,N)};if(2**this.lij[0]>2*this.lij[1]){let $=j,Q=b();Ct(Q,Iq,$),Z(Q,Q),Ct(Y,$,Q),Z(Y,Y),W(gn(X(Y,$)/Fr($),0)),F(S,C),F(R,E),D(S,0),D(R,3)}else if(2**this.lij[0]!==2*this.lij[1]){let $=B,Q=b();Ct(Q,Iq,$),Z(Q,Q),Ct(Y,Q,$),Z(Y,Y),F(C,S),F(E,R),D(C,1),D(E,2)}let me=($,Q)=>{let Ie=O/X(Q,H);for(let de=0;de<3;++de)this._convexHull[3*$+de]=Q[de]*Ie};me(4,S),me(5,C),me(6,E),me(7,R)}_getPatchType(){let t=this.lij[1],i=t===0,r=t===(1<<this.level)-1;return i?r?Do.HAS_BOTH_POLES:Do.HAS_NORTH_POLE:r?Do.HAS_SOUTH_POLE:Do.REGULAR}intersectsRay(t,i,r,s){let n=this._boundingSphere,o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-t[0],d=n[1]-t[1],u=n[2]-t[2],m=(l*i[0]+d*i[1]+u*i[2])/a,p=i[0]*m-l,f=i[1]*m-d,g=i[2]*m-u;return p*p+f*f+g*g<o*o}get minimumVerticesPerSide(){return this.level<Aq.length?Aq[this.level]+1:2}updateCornerElevations(){aq(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){nq(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){oq(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!Cr||this.level<=2)return;let t=this._boundingSphere,i=t[3],r=t,s=b(),n=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=n+o,d=1,u=0,m=this._center[Yi.MIDDLE][3],p=this.convexHull,f=(ee,J)=>{for(let Le=0;Le<3;++Le)ee[Le]=p[3*J+Le]};{let ee=b(),J=b(),Le=b(),Be=b(),Xe=b(),Me=(re,ue,ze,lt)=>{f(J,re),f(Le,ue),f(Be,ze),gi(J,J,Le),gi(Be,Be,Le),Ct(ee,J,Be),Z(ee,ee);let mi=X(ee,Le);f(Xe,lt);let _i=X(ee,Xe),Mt=Math.abs(_i-mi);W(gn(Mt,0),`Non coplanar ${re},${ue},${ze},${lt} diff = ${Mt}`)};Me(0,1,2,3),Me(4,5,6,7),Me(0,1,4,5),Me(1,2,5,6),Me(2,3,6,7),Me(3,0,7,4)}let g=l2(24),_=(ee,J,Le)=>{let Be=4*ee;for(let Xe=0;Xe<3;++Xe)g[Be+Xe]=J[Xe];g[Be+3]=Le},y=b(),v=b(),x=b(),S=b(),C=(ee,J,Le,Be)=>{f(y,J),f(v,Le),f(x,Be),gi(y,y,v),Z(y,y),gi(x,x,v),Z(x,x),Ct(S,y,x),Z(S,S);let Xe=X(S,v);_(ee,S,Xe)};C(0,0,1,2),C(1,1,0,4),C(2,1,5,2),C(3,3,2,6),C(4,4,0,3),C(5,4,6,5);let E=1,R=(ee,J,Le,Be)=>{let Xe=4*ee;return g[Xe]*J+g[Xe+1]*Le+g[Xe+2]*Be-g[Xe+3]},D=(ee,J,Le,Be)=>R(ee,J,Le,Be)>=-E,L=(ee,J)=>D(ee,J[0],J[1],J[2]),O=2**this.lij[0]>2*this.lij[1],H=(ee,J,Le)=>Math.sqrt(Oq(ee,J,Le,r[0],r[1],r[2]))<i,B=ee=>H(ee[0],ee[1],ee[2]),j=(ee,J)=>H(ee[J],ee[J+1],ee[J+2]),Y=this.extentInRadians,N=.5*(Y[0]+Y[2]),F=Y[1],me=Y[3],$=b(),Q=b();nm($,N,me,l),nm(Q,N,F,l);let Ie=O?"Upper":"Lower",de=!0;for(let ee=0;ee<6;++ee){for(let J=0;J<8;++J){let Le=3*J,Be=D(ee,p[Le],p[Le+1],p[Le+2]);de&&=Be,W(Be,`Tile[${this.lij}] Convex hull point ${J} outside of plane ${ee}`)}W(L(ee,Q),`Tile[${this.lij}] (${Ie}) bottom mid outside of plane ${ee}`),W(L(ee,$),`Tile[${this.lij}] (${Ie}) top mid outside of plane ${ee}`)}W(de,"Not all convex hull points are inside  convex hull polyhedron"),W(B(Q),`Tile[${this.lij}] (${Ie}) bottom mid outside of bounding sphere`),W(B($),`Tile[${this.lij}] (${Ie}) top mid outside of bounding sphere`);for(let ee=0;ee<8;++ee){let J=j(p,3*ee);W(J,`Tile[${this.lij}] Convex hull point ${ee} outside of bounding sphere`)}for(let ee=0;ee<6;++ee)for(let J=0;J<8;++J){let Le=3*J;D(ee,p[Le],p[Le+1],p[Le+2])||console.error(`Tile[${this.lij}] Convex hull point ${J} outside of plane ${ee}`)}let{extentInRadians:ke}=this,pe=Math.max(ke[2]-ke[0],ke[3]-ke[1]),xe=Math.round(pe*n),{renderData:he}=this;if(!he)return;let{geometry:oe,geometryState:Ve,localOrigin:et}=he,ye=oe.vertexAttributes?.position;if(!ye)return;let Ee=b(),Pt=oe.numVerticesPerSide-2,{indices:Ot,indexCount:kt,edgeVerticesStartIndex:Lt,poleVerticesStartIndex:ae}=oe;if(!Ot)return;let ft=new Set;for(let ee=0;ee<kt;++ee){let J=Ot[ee];if(ft.has(J))continue;ft.add(J);let Le=J<ae,Be=J>=Lt,Xe=!1,Me=-1;if(Be){let tt=Lt;for(let ct=0;ct<4;++ct){let At=Ve.edgeResolutions[ct];if(J===tt||J===tt+At-1){Xe=!0;break}if(tt+=At,J<tt){Me=ct;break}}}let re=Be?Ve.edgePeerNeighbors[Me]:null,ue=Be&&re&&Po(this,re)>0;ye.getVec(J,s),te(Ee,s,et);let ze=Fr(Ee)-n,lt=0,mi=!1,_i=o-ze,Mt=ze-a,Wt=_i>d,Kt=Mt>d,Et=Wt||Kt,Rt=()=>{let tt=Le?"internal":Be&&!Xe?"edge":Xe?"corner":"pole";return`Tile[${this.lij}].vertex[${J}]:${tt}`+(Wt?"(below)":Kt?"(above)":"")+(ue?"(Neighbor)":"")},yt=hs(Ee,r);if(yt>=i+u){let tt=yt-i;Et||(console.error(`${Rt()} is out of the bounding sphere by ${tt.toFixed(0)} / ${i.toFixed(0)}[tol=${u}] h=${ze.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(tt/i).toFixed(0)})`),mi=!0)}for(let tt=0;tt<6;++tt)if(!D(tt,Ee[0],Ee[1],Ee[2])){let ct=R(tt,Ee[0],Ee[1],Ee[2]),At=J%Pt,zt=(J-At)/Pt;tt===0&&_i||tt===5&&Mt||(console.error(`${Rt()} (${At},${zt})|${Pt}] is out of the bounding trapezoid plane ${tt} h=${Math.round(ze)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(ct)} radii = ${Math.round(i)}/${Math.round(m)}} : maxL = ${xe}`),++lt)}if(mi||lt>0)break}}get convexHull(){return this._convexHull}},Aq=[128,64,64,32,16,8,8,4];function vee(e,t,i){return Oq(e[0],e[1],e[2],t[i],t[i+1],t[i+2])}function Oq(e,t,i,r,s,n){let o=r-e,a=s-t,l=n-i;return o*o+a*a+l*l}var nm=(e,t,i,r)=>{let s=Math.cos(t),n=Math.sin(t),o=Math.cos(i),a=Math.sin(i);e[0]=r*o*s,e[1]=r*o*n,e[2]=r*a},Iq=[0,0,1],Dq=b(),Pq=b();var ta=class extends k{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};c([h()],ta.prototype,"fovX",void 0),c([h()],ta.prototype,"fovY",void 0),c([h()],ta.prototype,"relativeWidthLimit",void 0),c([h()],ta.prototype,"relativeHeightLimit",void 0),c([h()],ta.prototype,"maxLod",void 0),c([h()],ta.prototype,"angledSplitBias",void 0),c([h()],ta.prototype,"aboveGround",void 0),c([h()],ta.prototype,"frustum",void 0),ta=c([w("esri.views.3d.terrain.SplitLimits")],ta);var kq=$n().vec3f(Ii.POSITION).vec2i16(Ii.UV0).vec2i16(Ii.NORMALCOMPRESSED,{glNormalized:!0});var pT=class{constructor(t){this._storage=new Yo((i,r)=>t.newCache(i,r),"TileGeometry")}acquire(t){let r=Math.ceil(t/4)*4,s=this._storage,n=bee(r),o=s.pop(n);if(o)return o;let a=kq.createBuffer(r);return a.release=()=>s.put(n,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function bee(e){return e.toString()}var fT=class extends Nz{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=wo}},Ev=class extends at{constructor(t,i,r){super(t,i,new ot(Kz,()=>import("./chunk-ZUULAOCT.js")),r)}};function Lq(e,t){let i=e.transforms.tileUnitsToPixels,r=Um(t),s=Math.cos(r),n=Math.sin(r),o=Math.ceil(512*(Math.abs(n)+Math.abs(s)));Qm(Hl),oc(Hl,Hl,[o/2,o/2]),Km(Hl,Hl,r),oc(Hl,Hl,[-256,-256]),a0(Hl,Hl,[1/8,1/8,1]),e.transforms.tileUnitsToPixels=Hl;let a=[],l=new lB(4096,a,()=>new sB),d=new aB(a,l,(u,m,p)=>new oB(u,m,p,e.styleRepository,e.key.level,t),(u,m)=>{nB(u,m,!1)},()=>0,u=>{let m=e.styleRepository.getStyleLayerByUID(u).getLayoutProperty("visibility");return!m||m.getValue()!==HF.NONE});a.push(e),l.add(e),d.setScreenSize(o,o),d.continue(1/0),l.removeTile(e),e.transforms.tileUnitsToPixels=i}var Hl=fp();var wee=.125,gT=class{constructor(){this._renderParams={reshuffleManager:new NV,context:null,drawPhase:1,state:new PP,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new cB(new c0(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(t,i,r,s,n,o,a,l,d,u){let m=this._backgroundTile;this._updateRenderParameters(t,i,m,r,n,o,a,l,d,u),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,m,s)}renderContent(t,i,r,s,n,o,a,l,d,u,m,p){this._declutter(r),s.forAll(({sourceLayerInfo:{data:_}})=>this._declutter(_));let f=s.length>0;f&&this._stencilSymbols(t,i,r,s,n,o,a,l,d,u,m,p);let g=1;r.stencilRef=f?g:0,t.setStencilFunction(Vi.EQUAL,r.stencilRef,255),this._render(t,i,r,n,o,a,l,d,u,m,p),s.forAll(({sourceLod:_,offset:y,sourceLayerInfo:{data:v}})=>{v.stencilRef=++g,this._renderSymbols(t,_,v,n,o,a,l,y,u,m,p)})}_stencilSymbols(t,i,r,s,n,o,a,l,d,u,m,p){let f=1;r.stencilRef=f,t.setDepthTestEnabled(!1),t.setDepthWriteEnabled(!1),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setStencilOp(e0.KEEP,e0.KEEP,e0.REPLACE),t.setStencilWriteMask(255),t.setStencilFunction(Vi.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(t,i,r,n,o,a,l,d,u,m,p),s.forAll(({sourceLod:g,offset:_,sourceLayerInfo:{data:y}})=>{y.stencilRef=++f,t.setStencilFunction(Vi.ALWAYS,y.stencilRef,255),this._stencilTileSymbols(t,g,y,n,o,a,l,_,u,m,p)}),t.setStencilWriteMask(0),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!0),t.setColorMask(!0,!0,!0,!0)}_renderSymbols(t,i,r,s,n,o,a,l,d,u,m){t.setStencilFunction(Vi.EQUAL,r.stencilRef,255),this._render(t,i,r,s,n,o,a,l,d,u,m,UF.SYMBOL)}_render(t,i,r,s,n,o,a,l,d,u,m,p){this._updateRenderParameters(t,i,r,s,o,a,l,d,u,m),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,r,n,p)}_stencilTileSymbols(t,i,r,s,n,o,a,l,d,u,m){this._updateRenderParameters(t,i,r,s,o,a,l,d,u,m),this._renderParams.stencilSymbols=!0,r.triangleCount=0,s.drawSymbols(this._renderParams,r,n)}_updateRenderParameters(t,i,r,s,n,o,a,l,d,u){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(t);let m=i[0]-n.getLevelShift(i[0]),p=this._renderParams;p.context=t,p.painter=s,p.glyphMosaic=s.glyphMosaic,p.spriteMosaic=s.spriteMosaic,p.pixelRatio=d*u,p.displayLevel=m,p.requiredLevel=m;let f=n.getScale(i[0]),[g,_]=n.getOffset(i,o*f),y=wee*o*f/l,v=r.transforms.displayViewScreenMat3;v[0]=y,v[4]=-y,v[6]=-1-g-a[0]*o*2,v[7]=1+_+(1-a[1])*o*2-2;let x=p.state,S=l/u;x.size[0]=S,x.size[1]=S,x.pixelRatio=u,x.rotation=(360-this._heading)%360;let C=2/S;s0(x.displayViewMat3,C,0,0,0,-C,0,-1,1,1);let E=Qm(x.displayMat3),R=Um(this._heading);oc(E,E,[S/2,S/2]),Km(E,E,R),oc(E,E,[-S/2,-S/2]),o0(E,x.displayViewMat3,E)}updateHeading(t){this._heading=t}_declutter(t){this._declutteredForHeading.get(t)!==this._heading&&(Lq(t,(360-this._heading)%360),this._declutteredForHeading.set(t,this._heading))}},PP=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=un(),this.displayViewMat3=un(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}};var Rv=class extends up{constructor(){super(...arguments),this.blendMode=Id.Normal}};c([ai({count:Id.COUNT})],Rv.prototype,"blendMode",void 0);var zc=class extends Rv{constructor(){super(...arguments),this.output=ms.Composite,this.baseOpacityMode=Ks.NotRequired,this.premultipliedSource=Ca.Off}};c([ai({count:ms.COUNT})],zc.prototype,"output",void 0),c([ai({count:Ks.COUNT})],zc.prototype,"baseOpacityMode",void 0),c([ai({count:Ca.COUNT})],zc.prototype,"premultipliedSource",void 0);var Av=class extends zc{constructor(){super(...arguments),this.background=Ip.BelowLayer}};c([ai({count:Ip.COUNT})],Av.prototype,"background",void 0);var Iv=class extends at{constructor(t,i,r){super(t,i,new ot(Bz,()=>import("./chunk-AY27A3H7.js")),r)}};var Rh=class extends zc{constructor(){super(...arguments),this.colorizerType=HE.Stretch,this.stretchType=Rp.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};c([ai({count:HE.COUNT})],Rh.prototype,"colorizerType",void 0),c([ai({count:Rp.COUNT})],Rh.prototype,"stretchType",void 0),c([ai()],Rh.prototype,"applyColormap",void 0),c([ai()],Rh.prototype,"requireBilinearWithNN",void 0);var Dv=class{constructor(t){this._rctx=t,this._fbos=new Map}get(t){return this._getPool(t)}dispose(){this._fbos.forEach(t=>t.dispose()),this._fbos.clear()}_getPool(t){let i=this._fbos.get(t);if(i)return i;let r=new rl(this._rctx,new Di(t),new d0(t0.DEPTH24_STENCIL8,t));return this._fbos.set(t,r),r}};var xee=()=>V.getLogger("esri.views.3d.terrain"),_T=class{constructor(t,i){this._rctx=t,this._techniques=i,this._fbos=[],this._vectorTileHelper=new gT,this._bindParameters=new aw(null),this._blendLayersTechniqueConfig=new Av,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Qs(this._rctx,Ad.Pos2Tex)}dispose(){this._fbos.forEach(Ne),this._fbos=null,this._vtFBO=Ne(this._vtFBO),this._vaoQuad=Ne(this._vaoQuad),this._vectorTileHelper=Ne(this._vectorTileHelper)}updateHeading(t){this._vectorTileHelper?.updateHeading(t)}_acquireBlendLayersTechnique(t,i,r,s=Ca.Off,n=Ip.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._techniques.precompile(Ev,this._blendLayersTechniqueConfig),this._techniques.acquire(Ev,this._blendLayersTechniqueConfig)}drawBackground(t,i){let r=this._acquireBlendLayersTechnique(Id.Normal,i?ms.ColorComposite:ms.GridComposite,Ks.NotRequired,Ca.Off,Ip.Only),s=this._rctx.bindTechnique(r,this._bindParameters,t);this._render(s),r.release()}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(ni.TRIANGLE_STRIP,0,fa(this._vaoQuad,"geometry"))}drawGroup(t,i,r,s,n=Ca.On){i===ms.Composite&&(t.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),t.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);let o=t.baseOpacity<1?Ks.Required:Ks.NotRequired,a=this._acquireBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,t);this._render(l),a.release()}drawImageData(t,i,r,s,n=Ca.Off){if(t.texture==null)return;let o=t.baseOpacity<1?Ks.Required:Ks.NotRequired;t.fboTexture=i===ms.GroupBackgroundComposite||s===Id.Normal&&o===Ks.NotRequired&&n===Ca.Off?null:this.switch(r).colorTexture;let a=this._acquireBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,t);this._render(l),a.release()}drawRasterData(t,i,r,s,n){let o=n.sourceLayerInfo.data;if(!o.source||(n.tile.surface.layerViewByIndex(n.layerIndex,Pe.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;let a=t.baseOpacity<1?Ks.Required:Ks.NotRequired;t.fboTexture=s===Id.Normal&&a===Ks.NotRequired?null:this.switch(r).colorTexture;let l=this._acquireRasterColorizerTechnique(o,i,s,a);o.opacity=t.opacity;let d=o.getUniforms();d.scale=n.scale,d.offset=n.offset,d.backgroundColor=t.backgroundColor,d.fboTexture=t.fboTexture,d.baseOpacity=t.baseOpacity;let u=this._rctx.bindTechnique(l,this._bindParameters,d);this._render(u),l.release()}_acquireRasterColorizerTechnique(t,i,r,s){let n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new Rh,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=t.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?Rp.Noop:Rp.PerBand,this._techniques.precompile(Iv,this._rasterColorizerConfig),this._techniques.acquire(Iv,this._rasterColorizerConfig)}drawVectorData(t,i,r,s,n,o,a,l){let d=this._rctx,u=n.sourceLayerInfo.data,m=n.tile.surface.layerViewByIndex(n.layerIndex,Pe.MAP),p=t.baseOpacity<1?Ks.Required:Ks.NotRequired,f=p===Ks.Required||t.opacity<1||s!==Id.Normal||i!==ms.Composite,g=f?Ca.On:Ca.Off,_=this._acquireBlendLayersTechnique(s,i,p,g);d.setPipelineState(_.getPipeline());let y=null,v=null;f?(v=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new Dv(this._rctx)),y=this._vtFBO.get(r),d.bindFramebuffer(y),this._clearCurrentFBO()):l&&d.clear(Ni.DEPTH);try{this._vectorTileHelper.renderBackground(d,n.sourceLod,m.painter,m.layer.styleRepository,m.schemaHelper,Math.round(1/n.scale),n.offset,a,o,m.contentZoom),u&&this._vectorTileHelper.renderContent(d,n.sourceLod,u,n.vtlNeighborInfos,m.painter,m.layer.styleRepository,m.schemaHelper,Math.round(1/n.scale),n.offset,a,o,m.contentZoom)}catch(x){xee().warnOnce("A render call containing vector tiles did not resolve correctly.",x)}return _.release(),!y||(d.bindFramebuffer(v),t.texture=y.colorTexture,t.offset=iu,t.scale=1,this.drawImageData(t,i,r,s,g),l)}copyFBOToTexture(t){let i=this._rctx,r=i.bindTexture(t.texture,Rr.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;i.gl.copyTexImage2D(p_.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),i.bindTexture(r,Rr.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(Ni.COLOR|Ni.DEPTH|Ni.STENCIL)}_initFBO(t,i,r){this._rctx.bindFramebuffer(t),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(t){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(t)}bind(t,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new Dv(this._rctx));this._initFBO(this._fbos[i].get(t),t,r)}_bindNextFreeBuffer(t){this._lastUsedIds.length>0?this.bind(t,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(t,this._lastCreatedBufferId))}openGroup(t){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(t)}switch(t){let i=this.currentFBO(t),r=this._current;return this._bindNextFreeBuffer(t),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(t){let i=this._current;this._bindNextFreeBuffer(t),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(t){return this._fbos[this._current].get(t)}};var yT=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new Dt({allocator:t=>t||new OP})}},OP=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}};var Pv=class{constructor(t,i){this._texture=t,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){let t=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(t,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}};var LP=class{constructor(t,i,r,s,n,o){this.start=t,this.end=i,this.blendMode=r,this.opacity=s,this.output=n,this.baseOpacity=o}},vT=class{constructor(t,i,r,s){this._rctx=t,this.tileSize=i,this._techniques=r,this._cache=s,this._passParameters=new fT,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._compositor=new _T(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._compositor=Ne(this._compositor),this._backgroundTexture=Hi(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(t){this._compositor?.updateHeading(t)}updateTileTexture(t,i){if(!t.renderData)return;let r=t.surface,s=r.baseOpacity,n=0,o=0,a=this.tileSize,l=!1,d=!1,u=r.view.state.contentPixelRatio,m=!1;bT.clear(),tg.length=0;let p=t.layerInfo[Pe.MAP],f=0,g=null;for(;f<p.length;f++){let v=r.layerViewByIndex(f,Pe.MAP),x=v.layer,S=!xa(t,v),C=x.opacity,E=v.fullOpacity;if(d=d||zm(x),Td(v)){let L=v.layer.blendMode!=="normal";if(nd(x.parent)){let O=x.parent.uid;O!=null&&O!==""&&(L=Fq(x.parent)||L)}L&&(m=L,l=!1)}if((S||C===0)&&!m){p[f].pendingUpdates&=~(_e.TEXTURE_NOFADING&_e.TEXTURE_FADING);continue}++o;let R=wp(v),D=kP(t,f,R);if(D){if(p[f].pendingUpdates&=~(_e.TEXTURE_NOFADING&_e.TEXTURE_FADING),nd(x.parent)){let L=x.parent.uid;L!=null&&L!==""&&Nq(x.parent,f)}R?a=Math.max(a,this.tileSize*u):s===1&&E===1&&(v.isOpaque||this._dataToTexture(D)&&D.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,g===null&&(g=f)}}let _=a/this.tileSize,y=this._ensureBackgroundTexture(this.tileSize);n!==0&&g!==null?n===1&&!m&&this._useLayerTexture(t,g)||this._composeLayers(t,i,f-1,d,a,_,!l||m,bT,m):See(t,o,y,i!==bi.FADING)}_ensureBackgroundTexture(t){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(t,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(t),this._passParameters.offset=iu,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(t,i){let r=t.surface.layerViewByIndex(i,Pe.MAP),s=zm(r.layer),n=s?t.surface.baseOpacity:1,o=s?1:t.surface.baseOpacity,a=r.fullOpacity,l=kP(t,i,!1);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new Th(l.sourceLayerInfo.data,bi.FADING,$s(l.offset[0],l.offset[1],l.scale,l.scale),n,o,a)),!0)}_composeLayers(t,i,r,s,n,o,a,l,d){this._compositor.ensureBuffer(n);let u=t.surface.baseOpacity,m=!1,p=An.LINEAR_MIPMAP_LINEAR,f=!1,g=0;for(let x=r;x>=0;x--){let S=t.surface.layerViewByIndex(x,Pe.MAP),C=S.layer,E=wp(S),R=kP(t,x,E),D=C.opacity,L=!xa(t,S);if(!R||(D===0||L)&&!d)continue;let O=!zm(C)&&!m;O&&(m=!0);let H=!1;l.forEach(N=>{N.start===x&&(N.output=s?ms.Composite:a&&O?this.backgroundIsGrid?ms.GridComposite:ms.ColorComposite:ms.Composite,N.baseOpacity=O?u:1,tg.push(N),this._compositor.openGroup(n),H=!0)});let B=g===0,j=H?ms.GroupBackgroundComposite:a&&B?this.backgroundIsGrid?ms.GridComposite:ms.ColorComposite:ms.Composite,Y=B_[Td(S)?S.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=O&&!H&&u<1?u:1,this._passParameters.opacity=D,kB(R)?f=this._compositor.drawVectorData(this._passParameters,j,n,Y,R,o,this.tileSize,f):OB(R)?(this._compositor.drawRasterData(this._passParameters,j,n,Y,R),Cee(R)&&(p=An.NEAREST)):this._dataToTexture(R)&&(this._passParameters.texture=R.sourceLayerInfo.data.texture,this._passParameters.offset=R.offset,this._passParameters.scale=R.scale,this._compositor.drawImageData(this._passParameters,j,n,Y));tg.length>0&&tg[tg.length-1].end===x;){let N=tg.pop();this._passParameters.baseOpacity=N.baseOpacity,this._passParameters.opacity=N.opacity,this._passParameters.offset=iu,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,N.output,n,B_[N.blendMode])}g++}let _=t.renderData,y=d||m&&u<1,v=_.ensureTexture(n,y,i,()=>this._buildTexture(n,y,p));this._compositor.copyFBOToTexture(v),this._compositor.unbind(),_.setTextureReference(new Th(v,i,Vq,m?1:u,0,1))}_dataToTexture(t){if(FB(t)){let i=t.sourceLayerInfo;i.data=this._buildTexture(i.data,!0),t.tile.setMemoryDirty()}return LB(t)}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,i,r=An.LINEAR_MIPMAP_LINEAR){if(t==null)return null;let s=new Di;s.wrapMode=lr.CLAMP_TO_EDGE,s.samplingMode=r,s.maxAnisotropy=this._maxAnisotropy,s.preMultiplyAlpha=!0,s.flipped=!0,s.hasMipmap=!0,i||(s.pixelFormat=Ci.RGB);let n=this._rctx,o;if(typeof t=="number")s.width=s.height=t,o=this._buildTileTexture(s,t);else if(bp(t))s.isOpaque=t.isOpaque,s.isOpaque&&(s.pixelFormat=Ci.RGB),o=this._buildTileTexture(s,t.element.width,t.element);else try{s.width=t.width,s.height=t.height,o=this._buildTileTexture(s,t.width,t)}catch{o=new Pv(dw(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}let a=n.bindTexture(o.texture,Rr.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),n.bindTexture(a,Rr.TEXTURE_UNIT_FOR_UPDATES),o}_buildTileTexture(t,i,r){let s=`${i} ${t.pixelFormat}`,n=this._cache.pop(s);return n?(n.retain(),n.texture.setData(r),n):new Pv(new Rr(this._rctx,t,r),this._cache)}get test(){}};function kP(e,t,i){Ns.layerIndex=t,Ns.vtlNeighborInfos.clear();let r=e.layerInfo[Pe.MAP][t];if(En(Ns.offset,0,0),Ns.tile=e,Ns.scale=1,Ns.sourceLod=e.lij,Ns.sourceLayerInfo=r,Ns.isVTLBackground=i,r.data)return i&&e.forEachLoadedNeighbor((o,a)=>{if(o.level!==e.level)return;let l=o.layerInfo[Pe.MAP][t];if(!NB(l)||r.data===l.data)return;let d=Ns.vtlNeighborInfos.pushNew();d.offset=Uc[a],d.sourceLod=o.lij,d.sourceLayerInfo=l}),Ns;let s=r.upsampleInfo,n=s?.tile?.layerInfo[Pe.MAP][t];return n?(Ns.tile=s.tile,wr(Ns.offset,s.offset),Ns.scale=s.scale,Ns.sourceLod=s.tile.lij,Ns.sourceLayerInfo=n,Ns):i?Ns:null}function Cee(e){let t=e.sourceLayerInfo.data;return!!t.source&&t.interpolation==="nearest"}function Fq(e){let t=e.blendMode!=="normal";return nd(e.parent)&&(t=Fq(e.parent)||t),t}function Nq(e,t){nd(e.parent)&&Nq(e.parent,t);let i=e.uid;if(i!=null&&i!==""){let r=bT.get(i);r?r.start=t:bT.set(i,new LP(t,t,e.blendMode,e.opacity,ms.Composite,1))}}function See(e,t,i,r){let s=e.renderData,n=!r&&s.textureReference!=null&&(e.surface.view.layerViewManager.updating||t>0)?Bl.Delayed:Bl.Immediate;s.setTextureReference(new Th(i,bi.FADING,Vq,e.surface.baseOpacity,0,1),n)}var bT=new Map,tg=new Array,Ns=new yT,Vq=$s(0,0,1,1),Uc=new Array;Uc[li.NORTH]=[0,-1],Uc[li.NORTH_EAST]=[-1,-1],Uc[li.EAST]=[-1,0],Uc[li.SOUTH_EAST]=[-1,1],Uc[li.SOUTH]=[0,1],Uc[li.SOUTH_WEST]=[1,1],Uc[li.WEST]=[1,0],Uc[li.NORTH_WEST]=[1,-1];var Uq=200,FP=40,Tee=.8,Mee=10,Ov=1e-6;function Eee(e,t,i){let r=t,s=i,n=0,o=1/0;for(let a=0;a<3;++a){{let l=e[a];if(r[a]<l){if(s[a]<=Ov)return!1;let d=(l-r[a])/s[a];n=Math.max(n,d)}else if(s[a]<=-Ov){let d=(l-r[a])/s[a];o=Math.min(o,d)}if(n>o)return!1}{let l=e[a+3];if(r[a]>l){if(s[a]>=-Ov)return!1;let d=(l-r[a])/s[a];n=Math.max(n,d)}else if(s[a]>=Ov){let d=(l-r[a])/s[a];o=Math.min(o,d)}if(n>o)return!1}}return!0}var wT=class{constructor(t,i,r,s,n){this.aabb=t,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}},Hq=(()=>{class e{constructor(i,r,s,n){this.globalTriangleVertexIndices=i,this.firstTriangleIndex=r,this.positions=n,this._rayDirection=b(),this._callback=zq,this._intersectionOptions=Bq,this.bspNodeTree=new Array;let o=s-r,a=new(o<Pee?Uint8Array:o<Oee?Uint16Array:Uint32Array)(o);this.triangleIndexMap=a;for(let l=0;l<o;++l)a[l]=l;{let l=Dee(i,r,s,n.data,n.stride),d=U(Math.log2(o/FP),2,Mee),u=(m,p,f)=>{let g=Aee(a,l,m,p),_=p-m;if(_<=FP){let E=new wT(g,void 0,0,m,p);return this.bspNodeTree.push(E),E}let{axis:y,midValue:v}=Iee(g),x=Ree(a,l,m,p,y,v),S=(E,R)=>{if(f>d)return;let D=R-E;return D<FP||D>=Tee*_?void 0:u(E,R,f+1)},C=new wT(g,y,v,x.next,x.mid);return this.bspNodeTree.push(C),C.leftNode=S(m,x.next),C.rightNode=S(x.mid,p),C};u(0,o,0)}}intersectRayTriangleRange(i,r){if(i>=r)return;let s=this.positions;E0(this._rayFrom,this._rayDirection,i,r,this.globalTriangleVertexIndices,s.data,s.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),e.numFacesTested+=r-i}intersectRay(i,r,s,n){e.numFacesTested=0;let o=i,a=r,l=a[0]-o[0],d=a[1]-o[1],u=a[2]-o[2];if(l*l+d*d+u*u<Ov)return;this._rayFrom=o;let m=this._rayDirection;m[0]=l,m[1]=d,m[2]=u;let p=this.triangleIndexMap.length;this._callback=n,this._intersectionOptions=s,this.intersectRayBSP(this.bspNodeTree[0],0,p),this._callback=zq,this._intersectionOptions=Bq}intersectRayBSP(i,r,s){let n=this._rayFrom,o=this._rayDirection;if(!Eee(i.aabb,n,o))return;let a=i.axis,l=i.d;if(n[a]<l||o[a]<0){let d=r,u=i.midStartIndex;if(d<u){let m=i.leftNode;m!==void 0?this.intersectRayBSP(m,d,u):this.intersectRayTriangleRange(d,u)}}if(this.intersectRayTriangleRange(i.midStartIndex,i.rightStartIndex),n[a]>l||o[a]>0){let d=i.rightStartIndex,u=s;if(d<u){let m=i.rightNode;m!==void 0?this.intersectRayBSP(m,d,u):this.intersectRayTriangleRange(d,u)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}}return e.numFacesTested=0,e})(),ig=[1/0,1/0,1/0],rg=[-1/0,-1/0,-1/0];function Ree(e,t,i,r,s,n){let o=i,a=r;for(;o<a;){let d=e[o];t[6*d+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=d)}let l=o;for(a=r;l<a;){let d=e[a-1];t[6*d+s]>=n?--a:(e[a-1]=e[l],e[l]=d,++l)}return{next:o,mid:l}}function Aee(e,t,i,r){if(r<=i)return GM(NaN,NaN,NaN,NaN,NaN,NaN);{let s=6*e[i];for(let n=0;n<3;++n)ig[n]=t[s+0+n],rg[n]=t[s+3+n]}for(let s=i+1;s<r;++s){let n=6*e[s];for(let o=0;o<3;++o)ig[o]=Math.min(ig[o],t[n+0+o]),rg[o]=Math.max(rg[o],t[n+3+o])}return GM(ig[0],ig[1],ig[2],rg[0],rg[1],rg[2])}function Iee(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],s=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function Dee(e,t,i,r,s){let n=i-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){let l=3*(a+t),d=e[l]*s,u=e[l+1]*s,m=e[l+2]*s;for(let p=0;p<3;++p){let f=r[d+p],g=r[u+p],_=r[m+p];o[6*a+p]=Math.min(f,g,_),o[6*a+3+p]=Math.max(f,g,_)}}return o}var Pee=255,Oee=65535,Bq=new hp,zq=()=>{};var ns=class extends yN{constructor(t){super(),this.spherical=t,this.overlayMode=FE.Disabled,this.tileBlendInput=Dd.LayerOnly,this.transparencyMode=Ys.Opaque,this.pbrMode=dp.Simplified,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.screenSpaceReflections=!1,this.cloudReflections=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.normalType=VF.Compressed,this.textureCoordinateType=lN.Compressed,this.highStepCount=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!1,this.hasColorTexture=!0,this.canHaveOverlay=!0}};c([ai({count:FE.COUNT})],ns.prototype,"overlayMode",void 0),c([ai({count:Dd.COUNT})],ns.prototype,"tileBlendInput",void 0),c([ai({count:Ys.COUNT})],ns.prototype,"transparencyMode",void 0),c([ai({count:dp.COUNT})],ns.prototype,"pbrMode",void 0),c([ai()],ns.prototype,"doublePrecisionRequiresObfuscation",void 0),c([ai()],ns.prototype,"receiveShadows",void 0),c([ai()],ns.prototype,"hasSlicePlane",void 0),c([ai()],ns.prototype,"backfaceCullingEnabled",void 0),c([ai()],ns.prototype,"textureFadingEnabled",void 0),c([ai()],ns.prototype,"renderOccluded",void 0),c([ai()],ns.prototype,"screenSpaceReflections",void 0),c([ai()],ns.prototype,"cloudReflections",void 0),c([ai()],ns.prototype,"tileBorders",void 0),c([ai()],ns.prototype,"visualizeNormals",void 0),c([ai()],ns.prototype,"screenSizePerspective",void 0),c([ai()],ns.prototype,"receiveAmbientOcclusion",void 0);var NP=7,kee=10,VP=ld(),lo=class extends sp{get _isGlobal(){return this._stage.viewingMode===we.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(e,t,i,r,s){super({}),this._overlayRenderer=e,this._stage=t,this._allTiles=i,this._ellipsoidRadius=r,this.type=va.TERRAIN,this.isGround=!0,this._tileSize=256,this._passParameters=new Zz,this._drawParameters=new $F,this._renderDataPool=new yo(iT),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new cw,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=Br.Occlude,this.produces=new Map([[ne.OPAQUE_TERRAIN,()=>this._produces()&&this.transparency===Ys.Opaque],[ne.TRANSPARENT_TERRAIN,()=>this._produces()&&(this.transparency===Ys.Transparent||this.transparency===Ys.InvisibleWithDraped)],[ne.OCCLUDED_TERRAIN,()=>this._produces()]]),this._configuration=new ns(t.viewingMode===we.Global),this._tileTextureCache=new Yo((n,o)=>s.newCache(n,o),"TileTexture"),this.tileGeometryCache=new pT(s)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(T(()=>this._overlayRenderer.rendersOccludedDraped,e=>{this.renderOccludedFlags=e?BE:Br.Occlude,this.setNeedsRender()},Re))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?WF:qF}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}updateHeading(e){this._tileRenderer?.updateHeading(e)}set transparency(e){this._configuration.transparencyMode!==e&&(this._configuration.transparencyMode=e,this.setNeedsRender())}get transparency(){return this._configuration.transparencyMode}get renderPatchBorders(){return this._configuration.tileBorders}set renderPatchBorders(e){this._configuration.tileBorders!==e&&(this._configuration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return this._configuration.visualizeNormals}set visualizeNormals(e){this._configuration.visualizeNormals!==e&&(this._configuration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._configuration.backfaceCullingEnabled}set cullBackFaces(e){this._configuration.backfaceCullingEnabled!==e&&(this._configuration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return cc}get slicePlaneEnabled(){return this._configuration.hasSlicePlane}set slicePlaneEnabled(e){this._configuration.hasSlicePlane!==e&&(this._configuration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._configuration.textureFadingEnabled!==e&&(this._configuration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._configuration.pbrMode!==e&&(this._configuration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._configuration.screenSizePerspective!==e&&(this._configuration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_ensureRenderData(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._ensureRenderData(e),this.updateTileGeometryState(e),this.reuseTextureFromParent(e)||this.updateTileTexture(e,_e.TEXTURE_FADING)}reuseTextureFromParent(e){let t=e.parent;if(!t)return!1;let i=$s(1&e.lij[2]?.5:0,1&e.lij[1]?0:.5,.5,.5);return t.renderData?.reuseTexture(e.renderData,i)??!1}updateTileTexture(e,t){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,t===_e.TEXTURE_FADING?bi.FADING:bi.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){for(let i of e.layerInfo[Pe.ELEVATION])i.pendingUpdates&=~_e.GEOMETRY;e.resetPendingUpdate(_e.GEOMETRY);let t=e.renderData.updateGeometryState();return t&&this.setDirty(),t}updateGeometryIfNeeded(e){e.loaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){let t=e.renderData;t&&(t.releaseGeometry(),this._renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){let t=kee-NP,i=Math.max(0,Math.floor((e.level-t)/NP)*NP);if(this._isGlobal&&i===0)return wo;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Te.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Te.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Te.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new vT(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=dw(this._rctx)}uninitializeRenderContext(){this._emptyTex=Ne(this._emptyTex),this._tileRenderer=Ne(this._tileRenderer)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==Ys.Opaque)return;let s=Lee,n=Fee;ge(s,r,i),ve(n,1/s[0],1/s[1],1/s[2]);let o=e.results.min,a=e.results.max,l=e.results.ground,d=e.options.store===ll.MIN,u=!!e.results.ground.target,m=eN(e.verticalOffset),p=e.tolerance,f,g=d&&o.dist!=null?o.dist:1/0,_=e.options,y=_.normalRequired||!_.backfacesTerrain,v=new hp(!1,y),x=C=>{let E=C.renderData;if(!E?.vao)return;let R=E.geometry;p2(VP,R.boundingBox);let D=E.localOrigin;m!=null&&(m.localOrigin=D,m.applyToAabb(VP));let L=VP;if(sg[0]=i[0]-D[0],sg[1]=i[1]-D[1],sg[2]=i[2]-D[2],!R0(L,sg,n,p,g))return;let O=(Q,Ie,de)=>{Q.set(this.type,C,Ie,de,ud),g=d&&o.dist!=null?o.dist:1/0},H=(Q,Ie,de)=>{if((!y||de!=null)&&Q>=0&&(_.backfacesTerrain||X(de,s)<0)&&(_.invisibleTerrain||!_.selectionMode||t==null||t(i,r,Q))){if((l.dist==null||Q<l.dist)&&O(l,Q,de),_.isFiltered)return;_.store===ll.ALL&&(f==null?(f=tN(e.ray),O(f,Q,de),e.results.all.push(f)):Q<f.dist&&O(f,Q,de)),(o.dist==null||Q<o.dist)&&O(o,Q,de),_.store!==ll.MIN&&(a.dist==null||Q>a.dist)&&O(a,Q,de)}},B=Nee;ge(B,r,D);let{indices:j,indexCount:Y}=R,N=R.vertexAttributes,F=N.getField(Ii.POSITION,N2),me=new AF(F.typedBuffer,3,N.stride/4),$=Y/3;if(!m&&$>Uq){let Q=C.renderData;Q.intersectionData==null&&(Q.intersectionData=new Hq(j,0,$,me)),Q.intersectionData.intersectRay(sg,B,v,H)}else pN(sg,B,0,$,j,me,m,v,H)},S=this._rootTiles;S!=null&&(()=>{let C=this._tileIterator;C.reset(S);let E=e.options.invisibleTerrain;for(let R=C.next();R;R=C.next())!(R.visible||E&&R.intersectsClippingArea)||m==null&&!R.intersectsRay(i,s,p,g)||u&&this._useStencilForTile(R)?C.skipSubtree():x(R)})()}processScaleRangeQueries(e,t){if(!t.done)for(this._updatePatchGroups();e.updating&&!t.done;){e.prepare();for(let i of this._visiblePatchesByOrigin.values())for(let r of i)r.renderData?.textureReference!=null&&e.queriesForTile(r);e.process(),t.madeProgress()}}acquireTechniques(e){let t=!!Qe("enable-feature:terrain-shadows")&&e.bind.shadowMap.enabled;t!==this._castShadows&&(this._castShadows=t,this._patchesByOriginDirty=!0);let i=e.bind.viewshedEnabled;if(this._inViewshed!==i&&(this._inViewshed=i,this._patchesByOriginDirty=!0),e.bind.slot===ne.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&BE))return null}else{let r=this.transparency===Ys.Opaque?ne.OPAQUE_TERRAIN:ne.TRANSPARENT_TERRAIN;if(e.bind.slot!==r)return null}if(this.transparency===Ys.Invisible)return null;switch(this._configuration.screenSpaceReflections=this._configuration.cloudReflections=this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1,this._configuration.overlayMode=this._overlayRenderer.mode,e.output){case K.Color:case K.ColorEmission:return this._configuration.screenSpaceReflections=e.bind.ssr.lastFrameColor!=null,this._configuration.cloudReflections=e.bind.clouds.data!=null,this._configuration.receiveShadows=e.bind.shadowMap.ready,this._configuration.receiveAmbientOcclusion=e.bind.ssao!=null,this._acquireTechnique(e.output,e.bind.slot===ne.OCCLUDED_TERRAIN);case K.Shadow:case K.ShadowExcludeHighlight:return this._castShadows?this._acquireTechnique(K.Shadow,!1):null;case K.ViewshedShadow:return this._inViewshed?this._acquireTechnique(K.ViewshedShadow,!1):null;case K.Depth:case K.Normal:return this._acquireTechnique(e.output,!1);case K.ObjectAndLayerIdColor:return this._acquireTechnique(K.ObjectAndLayerIdColor,!1);case K.Highlight:return this._overlayRenderer.hasHighlights?this._acquireTechnique(K.Highlight,!1):null}return null}render(e,t){switch(this._updatePatchGroups(),t.useStencil=!1,e.output){case K.Color:case K.ColorEmission:{let i=e.bind.slot===ne.OCCLUDED_TERRAIN?Rd.Occluded:Rd.Color;this._renderMaterialPass(e,t,i);break}case K.Depth:case K.Normal:this._renderAuxiliaryPass(e,t,Rd.Color,this._visiblePatchesByOrigin);break;case K.Highlight:this._overlayRenderer.hasHighlights&&this._overlayRenderer.renders(Rd.Highlight)&&this._renderAuxiliaryPass(e,t,Rd.Highlight,this._visiblePatchesByOrigin);break;case K.Shadow:case K.ShadowExcludeHighlight:case K.ViewshedShadow:this._renderAuxiliaryPass(e,t,null,this._allPatchesByOrigin);break;case K.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,t,Rd.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;let t=this._tileRenderer,i;if(e!=null){let r=Ar.toUnitRGBA(e);i=dt(r[0]||0,r[1]||0,r[2]||0)}t.setBackground(i),this._allTiles.forAll(r=>t.updateTileTexture(r,bi.FADING)),this._configuration.tileBlendInput=t.backgroundIsGrid?Dd.GridComposite:t.backgroundColor!=null?Dd.ColorComposite:Dd.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==V_.NONE){let e=Array.from(this._visiblePatchesByOrigin.values()),t=this._stencilEnabledLayerExtents;for(let i of e)wz(this.renderOrder,i,t);e.sort((i,r)=>xz(i[0],r[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){let e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(let t of e)this._rebuildPatchGroupsForRootTile(t)}}_rebuildPatchGroupsForRootTile(e){let t=this._tileIterator;for(t.resetOne(e);!t.done;){let i=t.next(),r=i.renderData;if(!r){this._numTilesCulled++;continue}let s=r.localOrigin;if(this._castShadows||this._inViewshed){let o=this._allPatchesByOrigin.get(s);o||(o=[],this._allPatchesByOrigin.set(s,o)),o.push(i)}if(!i.visible){this._numTilesCulled++,t.skipSubtree();continue}let n=this._visiblePatchesByOrigin.get(s);n||(n=[],this._visiblePatchesByOrigin.set(s,n)),n.push(i),t.skipSubtree()}}_useStencilForTile(e){for(let t of this._stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderAuxiliaryPass(e,t,i,r){let s=e.rctx;this._passParameters.overlayContent=i,s.bindTechnique(t,e.bind,this._passParameters);let n=this._stencilEnabledLayerExtents.length>0;r.forEach(o=>{this._drawParameters.origin=o[0].renderData.localOrigin,t.program.bindDraw(e.bind,this._passParameters,this._drawParameters);for(let a=0;a<o.length;a++)this._renderPatch(e,t,o[a],ni.TRIANGLES,n,i)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,t,i){let{rctx:r}=e;this._passParameters.overlayContent=i,r.bindTechnique(t,e.bind,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;let s=e.bind.camera,n=t.program;if(this._configuration.screenSizePerspective&&this.pointsOfInterest){let m=C0(this._stage.viewingMode,this._ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;m.update({distance:p,fovY:s.fovY})}let o=this._stencilEnabledLayerExtents.length>0,a=i===Rd.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",wo),n.setUniform4fv("texOffsetAndScale",Zs));let l=this._tileRenderer?.backgroundColor!=null?this._tileRenderer.backgroundColor:wo;this._configuration.tileBlendInput===Dd.ColorComposite&&n.setUniform3fv("backgroundColor",l);let d=this.wireframe?ni.LINES:ni.TRIANGLES;this._configuration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);let u=this._visiblePatchesByOrigin;for(let m of u.values()){let p=m[0].renderData.localOrigin;this._drawParameters.origin=p,t.program.bindDraw(e.bind,this._passParameters,this._drawParameters),this._numOriginsRendered++;for(let f of m){let g=f.renderData,_=g.textureReference;if(_!=null){if(!a){n.setUniform4fv("texOffsetAndScale",_.offsetAndScale),n.bindTexture("tex",_.texture.texture);let y=g.textureFadeFactor,v=y<1?g.nextTextureReference:null;this._configuration.textureFadingEnabled&&v!=null&&y<1?(n.setUniform1f("fadeFactor",y),n.setUniform4fv("nextTexOffsetAndScale",v.offsetAndScale),n.setUniform3fv("nextTexOpacities",v.opacities),n.bindTexture("texNext",v.texture.texture)):n.setUniform1f("fadeFactor",1),g.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,t,f,d,o,i),f.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,t,i,r,s,n){let o=i.renderData,a=o.vao,l=a?.indexBuffer;if(!a||l==null)return void(Cr&&console.error("Rendered tile with no indices: ",i.lij," : ",o));let d=t.program;n==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(d,o.overlay),s&&(t.useStencil=this._useStencilForTile(i),e.rctx.setPipelineState(t.getPipeline()));let u=o.geometry.indexCount;e.rctx.bindVAO(a),d.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,u,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_acquireTechnique(e,t){return this._configuration.output=e,this._configuration.renderOccluded=t,this._techniques.acquire(tT,this._configuration)}get test(){}};c([h({readOnly:!0})],lo.prototype,"_isGlobal",null),c([h()],lo.prototype,"renderOccludedFlags",void 0),c([h({value:!1})],lo.prototype,"renderingDisabled",null),c([h({value:!0})],lo.prototype,"visible",null),c([h()],lo.prototype,"renderPatchBorders",null),c([h()],lo.prototype,"visualizeNormals",null),c([h()],lo.prototype,"cullBackFaces",null),c([h({value:V_.FRONT_TO_BACK})],lo.prototype,"renderOrder",null),c([h()],lo.prototype,"wireframe",null),lo=c([w("esri.views.3d.terrain.TerrainRenderer")],lo);var Lee=b(),Fee=b(),sg=b(),Nee=b();var xT=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}};var Va=class extends k{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),T(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!sd(t)||t.isRejected())&&!(t.isFulfilled()&&!Vee(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!(t?.type==="vector-tile"||iw(t)))),e)if(e.isResolved()){let t=pu(e,this.viewSpatialReference,this.viewingMode);if(t!=null){let i=new uu(t.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){let t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===we.Global){let t=e.levels.length-1,i=e.spatialReference;i.isWebMercator?e=uu.makeWebMercatorAuxiliarySphere(t):IB(i)&&(e=uu.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(T(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===we.Global){let e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=uu.WebMercatorAuxiliarySphere:AB(e)&&(this.tilingScheme=uu.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{let e=this.extentHelper.layerViewsExtent;e==null||ha(e,this.extent)||(this.tilingScheme=uu.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function Vee(e,t,i){return pu(e,t,i)!=null}c([h()],Va.prototype,"tilingScheme",void 0),c([h({readOnly:!0})],Va.prototype,"extent",void 0),c([h({value:!1})],Va.prototype,"tilingSchemeLocked",void 0),c([h({constructOnly:!0})],Va.prototype,"viewSpatialReference",void 0),c([h({constructOnly:!0})],Va.prototype,"layers",void 0),c([h({constructOnly:!0})],Va.prototype,"extentHelper",void 0),c([h({constructOnly:!0})],Va.prototype,"viewingMode",void 0),Va=c([w("esri.views.3d.terrain.TilingSchemeLogic")],Va);var CT=class{constructor(){this._offset=ir(),this.scale=0}get offset(){return this._offset}init(t,i,r,s){this.tile=t,this._offset[0]=i,this._offset[1]=r,this.scale=s}dispose(){this.tile=null,this._offset[0]=0,this._offset[1]=0,this.scale=0}};var TT,Ye=TT=class extends ti.EventedMixin(k){constructor(e){super(e),this._scaleRangeQueries=new Mv,this._iteratorPool=new yo(cw,t=>t.remove=()=>this._iteratorPool.release(t)),this._postorderIterator=new vz,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new xT,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=b(),this._eyePosSurfaceSR=b(),this._splitLimits=new ta,this._frustum=v_(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new il,this._frameTask=Jh,this._allTiles=new Dt,this._upsampleInfoPool=new yo(CT),this._shouldEmitChangeEvent=!1,this._destroying=!1,this._rootTilesExtent=ii(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=gt.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new Fl(1/0,-1/0),this.rootTileElevationBounds=new Fl(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=M2(),this._tilingSchemeSpatialReference=null,this._radiusModifier=Math.cos(Math.PI/16/16),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new nn(se(I({},e),{surface:this})),this._isGlobal=!e.view?.state?.isLocal,this._isGeographic=this._spatialReference?.isGeographic??!1,this._tileConstructor=this._isGlobal?mT:uT,this._ellipsoid=ht(e.view.spatialReference)}initialize(){let e=this.view,t=e.resourceController,i=t.memoryController;this._tileCache=new Yo((l,d)=>i.newCache(l,d),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new $S(i.newCache("elevation-query"));let r=this.overlayManager;this._renderer=new lo(r.renderer,e._stage,this._allTiles,this._ellipsoid.radius,i),this.addHandles([T(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),T(()=>this.renderer.visible,l=>this.suspended=!l),T(()=>this.heading,l=>{this._renderer.updateHeading(l),this._updateTileTextures(bi.FADING)}),T(()=>({heading:e.camera?.heading,state:e.state?.mode}),({heading:l,state:d})=>{if(l==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(l/90)%360);let u=Math.round(l)%360,m=Math.abs(u-this.heading);(d===Fi.IDLE||Math.min(m,360-m)>=30)&&(this.heading=u)})],"overlayManager"),this.addHandles([T(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?bi.UNFADED:bi.IMMEDIATE)},Ce),T(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?bi.UNFADED:bi.IMMEDIATE),Ce),T(()=>this.backgroundColor,(l,d)=>{l?.equals(d)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},Re),T(()=>this.snapLevel,()=>this._viewChanged=!0,Re),T(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),T(()=>Vr.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?import("./chunk-7HVD5D3T.js").then(({TerrainTileTree3DDebugger:d})=>{!this._treeDebugger&&Vr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new d({view:e}))}):l||(this._treeDebugger=z(this._treeDebugger))},ie)]);let{spatialReference:s}=e;this._extentHelper=W4(this.viewingMode,{layers:e.map.allLayers,layerViews:e.allLayerViews,viewSpatialReference:s});let n=new dc({getCollections:()=>e.defaultsFromMap?.mapCollections?.map(({layers:l})=>l),getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new Va({layers:n,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=t.createStreamDataRequester(L_.ELEVATION),this._mapDataRequester=t.createStreamDataRequester(L_.BASEMAP);let a=t.scheduler;this._frameTask=a.registerTask(si.TERRAIN_SURFACE,this),this.addHandles([T(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),ie),T(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Re),T(()=>this.extent,()=>this._updateRootTiles(),ie),e.on("resize",()=>this._viewChangeUpdate()),T(()=>{let l=e.state;return[this._lodBias,this.lodSnappingEnabled,e.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),Ce),T(()=>e.qualitySettings?.fadeDuration,l=>this._renderer.textureFadingEnabled=l>0,ie),T(()=>e.qualitySettings?.physicallyBasedRenderingEnabled,l=>this._renderer.pbrMode=l?dp.Simplified:dp.Disabled,ie),T(()=>e.qualitySettings?.tiledSurface.elevationLevelDelta,()=>this._updateAllTileGeometries()),T(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Re)]),this.addHandles(e.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._destroying=!0,this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",z(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",z(this.overlayManager)),this._tileCache=z(this._tileCache),Eh.prune(),this._treeDebugger=z(this._treeDebugger),this._renderer=z(this._renderer),this._iteratorPool=z(this._iteratorPool),this._upsampleMapCache=z(this._upsampleMapCache),this._elevationQueryCache=z(this._elevationQueryCache),this._set("view",null),this._extentHelper=z(this._extentHelper),this._upsampleInfoPool=z(this._upsampleInfoPool),tq()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnappingEnabled){let{view:e,tilingScheme:t}=this,i=e.scale;if(t&&i){let r=t.levelAtScale(i)+e.qualitySettings.tiledSurface.lodBias,s=t.getMaxLod();return r<=0?null:Math.min(r,s||1/0)}}return null}get lodSnappingEnabled(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get hasStencilEnabledExtents(){return this._extentHelper.stencilEnabledExtents.length>0}get _userClippingExtent(){let{spatialReference:e}=this,{clippingArea:t}=this.view;if(t==null||e==null)return null;let i=ii(),r=sw(t,i,e)?i:null,s=this._get("extent");return ha(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){let e=l_(this.groundExtent,this._userClippingExtent,ii()),t=this._get("extent");return ha(e,t)?t:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===Ys.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevationLevelDelta(e){return e<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(e,t,i,r){let s=this._rootTiles;if(!s?.length||s[0].layerInfo[Pe.ELEVATION].length===0)return null;let n=this._elevationProjectorCache.get(r);if(n===void 0&&(n=u_(r,this._spatialReference)??null,this._elevationProjectorCache.set(r,n)),n==null)return V.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;let o=ve(kv,e,t,i);return n(o,0,o,0),jq(s,o[0],o[1])}getElevations(e,t,i){let r=this._rootTiles,s=r?r[0].layerInfo[Pe.ELEVATION].length:0;if(r?.length&&s!==0)for(let n=0;n<t;++n){let o=3*n;i(n,jq(r,e[o],e[o+1]))}else for(let n=0;n<t;++n)i(n,null)}getScale(e){if(!this.tilingScheme)return null;if(!md(e,kv,this.spatialReference))return V.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;let t=this._rootTiles;if(t!=null){for(let i of t)if(i?.containsPoint(kv)){let r=i;for(;r.children[0]&&!r.rendered;){let s=r.children[0].extent,n=0;kv[0]>s[2]&&(n+=1),kv[1]<s[1]&&(n+=2),r=r.children[n]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}_ensureSEBProject(e){let t=this._sebProjectorMap.get(e);if(t)return t;let i=u_(e,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(e,i),i}getSphereElevationBounds(e,t){let i=this._ensureSEBProject(t);if(i==null)return V.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;DF(e,ng);let r=ng;i(r,0,r,0);let s=new rp,n=this._rootTiles;if(n!=null){let o=[];for(let l of n)o.push(l);let a=0;for(;a<o.length;){let l=o[a];if(++a,!FM(l.extent,ng))continue;let d=l.children;if(d[0]==null||l.rendered)s.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(let u of d)o.push(u)}}return s}getRootElevationBounds(){return new rp(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getLowerBoundRadius(){let e=(this._ellipsoid.radius+this.visibleElevationBounds.min)*this._radiusModifier;return Math.min(e,this._ellipsoid.radius)}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!md(e,ng,this.spatialReference))return V.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;ng[3]=t;let i=null,r=n=>{if(n&&FM(n.extent,ng)){let o=n.children;if(o[0]&&!n.rendered)for(let a of o)r(a);else{let a=this._getLodBiasCorrectedScale(n.level);i=i==null?a:Math.min(i,a)}}},s=this._rootTiles;if(s!=null)for(let n of s)r(n);return i}queryVisibleScaleRange(e,t,i,r){let s=t?this.tilingScheme.levelAtScale(t):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,s+o,n+o,r)}_evaluateTransparency(){let e=this.baseOpacity,t=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?t?Ys.Invisible:Ys.InvisibleWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?Ys.Opaque:Ys.Transparent;return this._renderer.transparency=r,i!==r}_updateTilingScheme(){let e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;xr(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();let t=e?.spatialReference??gt.WebMercator;this._spatialReference=t,this._isWebMercator=!!t?.isWebMercator,this._isWebMercatorOnPlateCarree=this._isWebMercator&&Fb(this.view?.renderSpatialReference),this._isGeographic=t?.isGeographic??!1,this._set("tilingScheme",e),this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,t,i,r){let s=this._tileCache.pop(TT._tileMemcacheKey);return s?(s.init(e,t,i,r,this),s):new this._tileConstructor(e,t,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){let{extent:e,tilingScheme:t}=this;if(!t)return;let i=Bee,r=t.rootTilesInExtent(e,i,5*D_);if(this._rootTiles!=null){if(r.length>D_)return void V.getLogger(this).warn(CB);let s=this._rootTiles.map(o=>o.lij),n=Zg(s,r,Sv);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){let o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>Sv(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>D_&&(V.getLogger(this).warn(SB),r=t.rootTilesInExtent(e,i,D_)),this._setRootTiles(r.map(s=>this._newRootTile(s)));ha(i,this._rootTilesExtent)||(this._rootTilesExtent=ii(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){let e=this._allTiles.filter(t=>t.loaded&&t.intersectsClippingArea);e.sort(Po),e.forEach(t=>this._renderer.updateTileGeometryState(t)),e.forEach(t=>t.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(Po);let t=this.renderer;e.forEach(i=>t.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===_e.SPLIT}_newRootTile(e){let t=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(t)&&t.setPendingUpdate(_e.SPLIT),this._loadTile(t),this._markTileToUpdate(t),this._updateRootTileElevationBounds(),t}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){let t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(_e.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;let t=Tz(e),i=this.visibleElevationBounds,r=t?i.min:1/0,s=t?i.max:-1/0,n=this.extent,o=this.view.state.contentCamera.viewProjectionMatrix;this.setTileTreeDirty();let a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){let l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(_e.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBoundsMin,r),s=Math.max(l.elevationBoundsMax,s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(s)&&(i.min!==r||i.max!==s)&&(this.visibleElevationBounds=new Fl(r,s))}_updateRootTileElevationBounds(){let e=1/0,t=-1/0,i=this._rootTiles;i?.forEach(({elevationBoundsMin:s,elevationBoundsMax:n})=>{e=Math.min(e,s),t=Math.max(t,n)});let r=this.rootTileElevationBounds;r.min===e&&r.max===t||(this.rootTileElevationBounds=new Fl(e,t))}_updateViewDependentParameters(){let{camera:e,contentCamera:t}=this.view.state,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=b_(this._splitLimits.frustum??v_(),t.frustum):this._splitLimits.frustum=null,b_(this._frustum,e.frustum),G(this._eyePosRenderSR,t.eye),sl(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForUpdate(e){e.forEachLoadedNeighbor(t=>{this._layerViews[Pe.MAP].some(wp)&&t.setPendingUpdate(_e.TEXTURE_FADING),this._pendingTilesToUpdate.add(t)})}_updateTileTexture(e,t){let i=e.resetPendingUpdate(_e.TEXTURE_FADING)?_e.TEXTURE_FADING:!!e.resetPendingUpdate(_e.TEXTURE_NOFADING)&&_e.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;let e=BP.extent;da(e),this._pendingTilesForElevationUpdateEvent.forEach(t=>Ya(e,t.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),BP.spatialReference=this.spatialReference,this.emit("elevation-change",BP),this._shouldEmitChangeEvent=!1}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);let t=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(e,t),this._updateElevation(e),this._updateTextures(e),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),Cr&&this._checkTileInvariant(),!e.hasProgressed)return ar}_checkTileInvariant(){let e=new Map;this._allTiles.forAll(t=>e.set(t,new Set)),this._allTiles.forAll(t=>{if(xr(t.rendered===t.leaf,` rendered ${t.rendered} != ${t.leaf} leaf`),!t.leaf){let i=s=>s.unmergableChildCount===0&&s.maxLevelDeltaNeighborCount===0,r=t.children.reduce((s,n)=>s+(i(n)?0:1),0);if(xr(t.unmergableChildCount===r,` Tile[${t.lij.toString()}] unmergeable child count mismatch: actual ${t.unmergableChildCount} vs ${r}`),t.hasPendingUpdate(_e.MERGE)){xr(!t.hasPendingUpdate(_e.SPLIT),"Tile can be both split and merge at the same time");for(let s of t.children)xr(s.leaf||s.hasPendingUpdate(_e.MERGE),"Child of tile to merge must also merge")}}for(let i=0;i<4;++i){if(t.rendered){let o=t.renderData?.geometryState.edgePeerNeighbors[i];if(o!=null){{let a=t.level-o.level<=hr;a||(console.log(`tile level delta [${t.lij.toString()}] vs [${o.lij.toString()}] > ${hr}  (edge[${i}])`),xr(a,`tile level delta [${t.level}] vs [${o.level}] > ${hr}`))}xr(t.level-o.level<=hr,`Max tile lod delta exceeded: [${t.lij.toString()}] vs [${o.lij.toString()}]`)}}let r=t.level-hr,s=o=>o.leaf||o.level===t.level,n=t.findNeighborTile(_n[i],s);if(n!=null){if(t.leaf&&t.level>=hr){let o=n;for(;t.level-o.level<hr;)o=o.parent;let a=[r,t.lij[1]>>hr,t.lij[2]>>hr];if(!Sv(a,o.lij)){let l=e.get(o);xr(!l.has(t),"Cannot already have neighbor"),l.add(t)}}xr(n.rendered||n.level===t.level,"Non-same-level-neighbor of rendered must be rendered"),xr(t.level-n.level<=hr,`Tile level delta [${t.level}] vs [${n.level}] > ${hr}`)}}}),this._allTiles.forAll(t=>{let i=t.maxLevelDeltaNeighborCount,r=e.get(t);xr(i===r.size,`Tile[${t.lij.toString()}] merge-blocker mismatch: actual ${i} vs ${r.size}`)})}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;let t=new UP(this._allTiles.length);t.pushAll(this._rootTiles);let i=this.snapLevel,r=this._splitLimits,s=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});let n=this.view.state.contentCamera.viewProjectionMatrix;for(;!t.empty;){let o=t.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(_e.MERGE),d=l?_e.MERGE:o.shouldSplit(r,s,i),u=d===_e.SPLIT;o.leaf?zP(o,u):t.pushAll(o.children),l?(o.resetPendingUpdate(_e.SPLIT),o.leaf||o.setPendingUpdate(_e.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(n)):u?(o.resetPendingUpdate(_e.MERGE),o.leaf&&o.setPendingUpdate(_e.SPLIT)):(o.resetPendingUpdate(_e.SPLIT)&&o.updateAgentSuspension(),d===_e.ELEVATION&&o.updateAgents(Pe.ELEVATION),o.leaf||(o.setPendingUpdate(_e.MERGE),o.resetPendingUpdate(_e.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(Cz(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){W(e.loaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForUpdate(e))}_updatePendingTileGeometries(){let e=this._pendingTilesToUpdate,t=Array.from(e.keys()).filter(s=>s.loaded&&s.intersectsClippingArea);if(t.length===0)return void e.clear();let i=(s,n)=>{!n?.loaded||!n.intersectsClippingArea||n.level<s.level||e.has(n)||(e.add(n),t.push(n),n.renderData.updateNeighborData())};t.sort(Po);let r=t.length;for(let s=0;s<r;++s){let n=t[s];W(n.loaded),W(n.intersectsClippingArea);let o=n.renderData;o.updateNeighborData();let a=o.dirtyEdgeResolutions,l=o.geometryState,d=u=>{let m=fu[u];i(n,l.cornerPeerNeighbors[u]?.findCorner(Cp(m),p=>p.loaded))};for(let u=0;u<4;++u)if(a&1<<u){let m=o.geometryState.edgePeerNeighbors[u];m&&m?.level>=n.level&&m.forAllSubtreeOnSide(Sp(_n[u]),p=>!(!p.loaded||!p.intersectsClippingArea)&&(W(e.has(p)||Po(n,p)<0),i(n,p),!0)),d((u+1)%4),d(u)}}e.clear(),this._updateTilesGeometries(t),this._shouldEmitChangeEvent=!0,Cr&&O_&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1,r=this.view.state.fixedContentCamera,s=!1;for(;!e.done;){s=!0;let n=!1,o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return e.done;let l=a;if(a.hasPendingUpdate(_e.MERGE)){if(!t||a.unmergableChildCount>0)return e.done;for(a.resetPendingUpdate(_e.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(_e.MERGE);)l=l.parent;this._mergeTile(l),n=!0,e.madeProgress()}else if(a.resetPendingUpdate(_e.SPLIT)){let d=!0,u=a.level;if(u>=hr){let m=p=>p.leaf||u-p.level<hr;for(let p=0;p<4;++p){let f=a.findNeighborTile(_n[p],m);f!=null&&u-f.level===hr&&(d=!1,Cr&&(W(f.leaf),W(f.hasPendingUpdate(_e.SPLIT))))}}d?(this._splitTile(a),e.madeProgress(),n=!0):a.setPendingUpdate(_e.SPLIT)}return e.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!i){i=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?e.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(t=>(t.resetPendingUpdate(_e.GEOMETRY)&&(this._updateTileGeometryState(t),this._shortBatches&&this._updatePendingTileGeometries(),e.madeProgress()),e.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Te.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){let e=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*bB}_getLodBiasCorrectedScale(e){let t=this.tilingScheme.levels,i=U(e-this._lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeSubtree(e){let t=e.children;t[0]&&(this._purgeTile(t[0]),this._purgeTile(t[1]),this._purgeTile(t[2]),this._purgeTile(t[3]),e.clearChildren())}_purgeTile(e){e.leaf?Gq(e):this._purgeSubtree(e),this._allTiles.removeUnordered(e),this._unloadTile(e),e.dispose(),this._tileCache.put(TT._tileMemcacheKey,e)}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){xr(e.leaf,"Tile that is already split should not be split again!"),xr(e.rendered,"Tile marked to split is not rendered"),Gq(e);let t=e.createChildren();this._allTiles.pushArray(t),e.updateAgentSuspension(),xr(e.rendered,"parent should be rendered"),t.forEach(i=>this._loadTile(i)),t.forEach(i=>this._pendingTilesToUpdate.add(i)),this._unloadTile(e),this._markAllTileNeighborsForUpdate(e),this._emitTileScaleChange(e,e.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),t.forEach(i=>zP(i,i.hasPendingUpdate(_e.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){ST.spatialReference=this.spatialReference,ST.extent=e.extent,ST.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",ST)}createTile(e,t,i,r){xr(!!r,"createTile sanity check");let s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this.view.state.contentCamera.viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(_e.SPLIT),s}get _shortBatches(){return this.view.state.mode!==Fi.IDLE}_mergeTile(e){xr(!e.hasPendingUpdate(_e.SPLIT),"_mergeTile sanity check"),xr(!e.leaf,"Cannot merge a leaf"),e.leaf||(this._purgeSubtree(e),xr(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this._shortBatches&&this._updatePendingTileGeometries(),zP(e,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(e){e.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_handleLayerViewChanges(e=qn){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1,i=new Set,r=-1;for(let s=this.view.allLayerViews.length-1;s>=0;s--){let n=this.view.allLayerViews.items[s];if(i.add(n.uid),k_(n)||xp(n))if(this._basemapLayerViewHandles.has(n.uid)&&!xp(n)){let o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<r||r==null)&&(t=!0),r=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(t=!0)}this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){let e=this.view.map?.ground?.opacity===0;for(let t of this.view.allLayerViews.items)if(IE(t)&&!zm(t.layer)&&t.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(let e of this.view.allLayerViews.items)if((Td(e)||xp(e))&&Vz(B_[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return AE(e)?Pe.ELEVATION:Pe.MAP}_registerTiledLayerView(e){let t=[];if((Td(e)||xp(e))&&t.push(T(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(bi.UNFADED)})),!xp(e)){let i=this._layerClassFromLayerView(e);t.push(T(()=>e.suspended,()=>this._updateTiledLayers())),t.push(T(()=>e.fullOpacity,()=>this._updateTileTextures(bi.UNFADED))),t.push(T(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),t.push(e.on("data-changed",()=>{let r=this._getLayerIdxByUID(i,e.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){let t=this._basemapLayerViewHandles.get(e);if(t){for(let i of t)i.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;let e=this.view.allLayerViews,t=[[],[]],i=null;e.forEach(r=>{if(!r.layer||r.suspended||!k_(r)||!r.fullExtent)return;let s=this._layerClassFromLayerView(r);if(s===Pe.MAP){let n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}t[s].push(r)});for(let r of xh){let s=this._layerViews[r],n=t[r];n.reverse();let o=n.length,a=s.length!==o,l=new Array(o),d=new Array(s.length);this._layerIndexByUid[r].clear();for(let u=0;u<o;u++){let m=n[u].uid;this._layerIndexByUid[r].set(m,u);let p=s.indexOf(n[u]);l[u]=p,u!==p&&(a=!0),p>-1&&(d[p]=u)}if(a){let u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(d,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(e){let t=this._postorderIterator;for(t.reset(this._rootTiles);!t.done;){let i=t.next();i.restartAgents(e),e===Pe.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(Pe.MAP),e===bi.IMMEDIATE?this.renderer.updateTileTexture(t,_e.TEXTURE_NOFADING):t.updateRenderData(Pe.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Te.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){let s=this.layerViewByIndex(t,i),n=s.layer;return!n.tilemapCache||wp(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],se(I({},r),{timeout:6e3})).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Ut(r),xs(o)||this._dataMissing(e,i,s),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,r),r.signal)))}_requestTileData(e,t,i,r){if(this._destroying)return Promise.resolve();let s=t===Pe.ELEVATION;return r.requester??=s?this._elevationDataRequester:this._mapDataRequester,s?AE(i)?this._requestElevationTileData(e,i,r):Promise.reject():IE(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;let r=n=>{!Jl(i)&&n&&(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,t,n))},s=n=>{xs(n)||(V.getLogger(this).error(`Tile ${e.lij.toString()} layer ${Pe.ELEVATION}/${t.uid} error ${n}`),this._dataMissing(e,Pe.ELEVATION,t),this.requestUpdate())};return t.fetchTile(e.lij,i).then(n=>this._frameTask.schedule(()=>r(n)),s).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(e,t,i){let r=this._layerIndexByUid[Pe.ELEVATION].get(t.uid);if(r==null)return void V.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Pe.ELEVATION,e.lij.toString());let s=new ZS(e.lij,e.extent,i);e.dataArrived(r,Pe.ELEVATION,s);let n=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){let l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_requestMapTileData(e,t,i){++this._asyncWorkItems;let r=(a,l)=>{Md(l),Jl(i)||(console.error(`Tile ${e.lij.toString()} layer ${Pe.MAP}/${t.uid} error ${a}`),this._dataMissing(e,Pe.MAP,t),this.requestUpdate())},s=a=>l=>r(l,a),n=a=>this._frameTask.schedule(()=>{this.requestUpdate(),Jl(i)?Md(a):this._mapTileDataArrived(e,t,a)},i.signal,s(a)).catch(s(a)),o=(a,l=null)=>this._frameTask.schedule(()=>r(a,l));return t.fetchTile(e.lij,i).then(n,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(e,t,i){let r=this._getLayerIdxByUID(Pe.MAP,t.uid);if(r==null)return Md(i),void V.getLogger(this).warn("TerrainSurface: received data from unknown layer");e.dataArrived(r,Pe.MAP,i)}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i){let r=this._getLayerIdxByUID(t,i.uid);r!=null?e.dataMissing(r,t):V.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){let e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.leaf&&e.numLeaves++;let i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((e,t)=>e+t.usedMemory,0)):null}getUsedMemoryForLayerView(e){let t=0,i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return r!=null&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(i,r)),t}getTile(e){if(e==null||this._rootTiles==null)return null;let t=e.split("/").map(o=>+o);if(t[0]===0)return this._rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);let i=t[0],r=t[1]>>i,s=t[2]>>i,n;if(this._rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return xr(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){}checkAllTilesWaterproofness(){if(!O_)return;let e=this._rootTiles;if(e==null)return;let t=n=>n?.renderData?.geometry?.indices?.length>0,i=(n,o)=>{t(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},r=n=>{if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometry&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!n.renderData?.geometry||(n.renderData.geometry.indices?.length??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometry),t(n)){n.checkGeometryWaterproofness();for(let o of n.children)i(o,n)}else if(n.leaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(let o of n.children)r(o)},s=n=>{let o=n.parent?.visible??!0,a=n.visible;n.computeVisibility();let l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.leaf)for(let d of n.children)s(d)};for(let n of e)r(n),s(n)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(e){return this._isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this._isGlobal&&e[2]===0}lijEastEnd(e){return 1<<e+(this._isGeographic?1:0)}wrapEastWest(e){let t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this._isGlobal)return null;let r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}enableInternalChecks(e){PB(e)}enableWaterproofnessChecks(e){DB(e)}};Ye._tileMemcacheKey="TerrainTileMemcache",c([h()],Ye.prototype,"_renderer",void 0),c([h({constructOnly:!0})],Ye.prototype,"_scaleRangeQueries",void 0),c([h({constructOnly:!0})],Ye.prototype,"view",void 0),c([h({constructOnly:!0})],Ye.prototype,"overlayManager",void 0),c([h()],Ye.prototype,"_hasPendingUpdates",void 0),c([h()],Ye.prototype,"_asyncWorkItems",void 0),c([h()],Ye.prototype,"_allTilesDirty",void 0),c([h()],Ye.prototype,"_allTilesSorted",void 0),c([h()],Ye.prototype,"_viewChanged",void 0),c([h({type:Number})],Ye.prototype,"heading",void 0),c([h()],Ye.prototype,"_splitLimits",void 0),c([h({readOnly:!0})],Ye.prototype,"_watchUpdatingTracking",void 0),c([h()],Ye.prototype,"_frameTask",void 0),c([h({readOnly:!0})],Ye.prototype,"snapLevel",null),c([h({readOnly:!0})],Ye.prototype,"lodSnappingEnabled",null),c([h()],Ye.prototype,"_userClippingExtent",null),c([h()],Ye.prototype,"_rootTilesExtent",void 0),c([h({readOnly:!0})],Ye.prototype,"extent",null),c([h({readOnly:!0})],Ye.prototype,"groundExtent",null),c([h({readOnly:!0})],Ye.prototype,"_tilingSchemeExtent",null),c([h({readOnly:!0})],Ye.prototype,"updating",null),c([h({readOnly:!0})],Ye.prototype,"running",null),c([h(MB)],Ye.prototype,"updatingProgress",void 0),c([h({readOnly:!0})],Ye.prototype,"updatingProgressValue",null),c([h()],Ye.prototype,"_maxNumUpdating",void 0),c([h()],Ye.prototype,"baseOpacity",null),c([h()],Ye.prototype,"hasCompositeBlendMode",void 0),c([h({readOnly:!0})],Ye.prototype,"viewingMode",null),c([h()],Ye.prototype,"maxTextureScale",void 0),c([h({readOnly:!0})],Ye.prototype,"ready",null),c([h({value:V_.FRONT_TO_BACK})],Ye.prototype,"renderOrder",null),c([h({readOnly:!0})],Ye.prototype,"rootTiles",null),c([h()],Ye.prototype,"_rootTiles",void 0),c([h({readOnly:!0})],Ye.prototype,"spatialReference",null),c([h({type:Ar})],Ye.prototype,"backgroundColor",null),c([h({value:!1})],Ye.prototype,"slicePlaneEnabled",null),c([h({readOnly:!0})],Ye.prototype,"tilingScheme",void 0),c([h({readOnly:!0})],Ye.prototype,"tilingSchemeLocked",null),c([h({readOnly:!0})],Ye.prototype,"tilingSchemeLogic",void 0),c([h()],Ye.prototype,"wireframe",null),c([h({value:!1})],Ye.prototype,"suspended",null),c([h()],Ye.prototype,"fadeDuration",null),c([h()],Ye.prototype,"visibleElevationBounds",void 0),c([h()],Ye.prototype,"rootTileElevationBounds",void 0),c([h()],Ye.prototype,"_layerViewsDirty",void 0),c([h()],Ye.prototype,"renderPatchBorders",null),c([h()],Ye.prototype,"visualizeNormals",null),c([h()],Ye.prototype,"renderingDisabled",null),Ye=TT=c([w("esri.views.3d.terrain.TerrainSurface")],Ye);var qq=Ye,kv=b(),ng=Nr(),Bee=ii();new Dt;var BP=new fz("ground"),ST={spatialReference:null,extent:null,scale:0};function jq(e,t,i){for(let r of e){if(!r.containsPointXY(t,i))continue;let s=r;for(;s&&!s.renderData;){let o=(t>s.extentMidX?1:0)+(i<s.extentMidY?2:0);s=s.children[o]}let n=s?.renderData?.geometryState.samplerData??null;return Mi(t,i,n)}return null}var UP=class{constructor(t){this.capacity=t,this._head=0,this._tail=0,this._data=new Array(t)}push(t){let i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=t,this._tail=i+1}pushAll(t){let i=t.length;if(i===0)return;let r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let s=0;s<i;++s)this._data[r+s]=t[s];this._tail=r+i}pop(){let t=this._head;if(t<this._tail){let i=this._data[t];return this._head=t+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}};function zP(e,t){!e.leaf||e.level<hr||jP(e,i=>{t&&Wq(i);let r=HP(i);if(i.maxLevelDeltaNeighborCount++,r){let s=i.parent;for(;s;){let n=HP(s);if(s.unmergableChildCount++,!n)break;s=s.parent}}})}function Wq(e){if(e.hasPendingUpdate(_e.SPLIT))return;let t=e.parent;for(;t?.resetPendingUpdate(_e.MERGE);)t=t.parent;e.resetPendingUpdate(_e.MERGE),e.leaf&&e.setPendingUpdate(_e.SPLIT),e.level<hr||jP(e,i=>{Wq(i)})}function Gq(e){e.level<hr||jP(e,t=>{if(t.maxLevelDeltaNeighborCount--,t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0){let i=t.parent;for(;i&&(i.unmergableChildCount--,HP(i));)i=i.parent}})}function HP(e){return e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0}function jP(e,t){if(e.level<hr)return;let i=e.level-hr,r=e.lij[1]>>hr,s=e.lij[2]>>hr,n=o=>o.leaf||o.level===i;for(let o=0;o<4;++o){let a=e.findNeighborTile(_n[o],n);if(!a||a.level!==i)continue;let l=a.lij;l[1]===r&&l[2]===s||t(a)}}var GP=class{constructor(t,i,r,s){this.operation=t,this.geometry=i,this.states=r,this.sync=s}},Lv=class extends k{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyRecordCount=0}get dirty(){return this._dirtyRecordCount>0}commitLayer(e,t){let i=this._dirtyGeomRecords.get(e);if(!i)return;let r=0;i.forEach((s,n)=>{let o=this._ensureGeomRecord(e,n);r+=s.size,s.forEach(({geometry:a,operation:l,states:d},u)=>{let m=!1;if(l===cr.UPDATE){let p=o.get(u);if(p){if(d&ol.TRANSFORMATION){let f=this.model.getObject(n);this.model.updateRenderGeometryTransformation(f,a,p)&&(m=!0)}m||t.updates.push({renderGeometry:p,updateType:d})}else us(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===cr.REMOVE||m){let p=o.get(u);p?(t.removes.push(p),o.delete(u)):l===cr.REMOVE&&us(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===cr.ADD||m){let p=this.model.getObject(n);if(p!=null){let f=this.model.getRenderGeometry(p,a);t.adds.push(f),o.set(u,f)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this._dirtyRecordCount-=r}commitSyncUpdates(e,t){let i=this._dirtyGeomRecords.get(e);i&&i.forEach((r,s)=>{let n=this._ensureGeomRecord(e,s);r.forEach(({geometry:o,operation:a,states:l,sync:d},u)=>{let m=!1;if(a===cr.UPDATE&&d){let p=n.get(u);if(p){if(l&ol.TRANSFORMATION){let f=this.model.getObject(s);this.model.updateRenderGeometryTransformation(f,o,p)&&(m=!0)}m||t.updates.push({renderGeometry:p,updateType:l})}else us(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,t){let i=this._residentGeomRecords.get(e);i&&i.forEach(r=>r.forEach(s=>t.push(s)))}_objectStateChanged(e,t){for(let i of t.geometries)this._updateOrCreateDirtyRecord(t,i,null,cr.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(ol.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(ol.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(ol.OCCLUDEE,e)}attributesChanged({object:e,geometry:t,sync:i}){this._updateOrCreateDirtyRecord(e,t,null,cr.UPDATE,ol.GEOMETRY,i)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){let i=e.id;for(let r of t.geometries)this._geometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(let t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(let t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){let i=e.id;for(let r of t.geometries)this._geometryRemoved(t,r,i)}transformationChanged(e){let t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{this._updateOrCreateDirtyRecord(e,r.geometry,t,cr.UPDATE,ol.TRANSFORMATION)})}shaderTransformationChanged(e){let t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{r.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,cr.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,cr.REMOVE)}_updateOrCreateDirtyRecord(e,t,i,r,s=ol.NONE,n=!1){i=i??this._getParentLayerId(e);let o=e.id,a=t.id,l=this._ensureDirtyRecord(i,o),d=l.get(a);if(d){let u=d.operation;u===cr.REMOVE&&r===cr.ADD&&d.states!==ol.NONE?d.operation=cr.UPDATE:u===cr.REMOVE&&r===cr.ADD||u===cr.ADD&&r===cr.REMOVE?(l.delete(a),this._dirtyRecordCount--):u!==cr.UPDATE||r!==cr.REMOVE&&r!==cr.UPDATE?(us((u===cr.REMOVE||u===cr.ADD)&&r===cr.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),d.states|=s):(d.operation=r,d.states|=s),d.sync=d.sync||n}else l.set(a,new GP(r,t,s,n)),this._dirtyRecordCount++}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:Yk}formatDebugInfo(){let e=["ADD","UPD",void 0,"REM"],t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=r+"."+n;let o=[];s.forEach(a=>{let l=a.operation;o[l]||(o[l]=[]),o[l].push(a.geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){}};c([h()],Lv.prototype,"_dirtyRecordCount",void 0),c([h({constructOnly:!0})],Lv.prototype,"model",void 0),Lv=c([w("esri.views.3d.webgl-engine.lib.ModelDirtySet")],Lv);var $q=Lv;var Fv=class extends k{constructor(){super(...arguments),this.dirtySet=new $q({model:this}),this._content=new Map,this._originFactory=new lz(null)}getObject(e){return this._content.get(e)}add(e){let t=e.id;us(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),Tp(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),Tp(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(let t of e)t&&(us(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(let t of e)t&&(us(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id))}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){let i=new UB(t,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});i.transformation=e.getCombinedStaticTransformation(t,Zq);let{localOrigin:r}=t;return i.localOrigin=r??this._originFactory.getOrigin(i.boundingSphere),i}updateRenderGeometryTransformation(e,t,i){if(e==null)return!1;i.transformation=e.getCombinedStaticTransformation(t,Zq);let r=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==r}getStats(){let e={},t=Array.from(this._content.values());for(let i=0;i<T0.COUNT;++i)e[i]=t.filter(r=>r.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};c([h({constructOnly:!0})],Fv.prototype,"dirtySet",void 0),Fv=c([w("esri.views.3d.webgl-engine.parts.Model")],Fv);var Zq=Ht();var MT=class extends gw{constructor(){super(...arguments),this.innerFadeDistance=0,this.altitudeFade=0,this.backgroundColor=b()}},og=class extends at{constructor(t,i,r){super(t,i,new ot(Yz,()=>import("./chunk-V63EHYLH.js")),r)}initializePipeline(t){return mt({blending:t.reduced?lp:ap(oi.SRC_ALPHA,oi.ONE_MINUS_SRC_ALPHA),depthTest:{func:t.reduced?Vi.ALWAYS:Vi.LEQUAL},colorWrite:wt})}};var Nv=class extends up{constructor(){super(...arguments),this.reduced=!1}};c([ai()],Nv.prototype,"reduced",void 0);var Vs=class extends Pn{constructor(e){super(e),this.produces="disabled",this.consumes={required:[Fe.OPAQUE_ENVIRONMENT]}}_enable(){this.produces=Fe.OPAQUE_ENVIRONMENT,this.requestRender(Te.UPDATE)}_disable(){this.produces="disabled",this.requestRender(Te.UPDATE)}};c([h()],Vs.prototype,"produces",void 0),c([h()],Vs.prototype,"consumes",void 0),c([h({constructOnly:!0})],Vs.prototype,"techniques",void 0),Vs=c([w("esri.views.3d.webgl-engine.effects.OpaqueEnvironment")],Vs);var Vv=class extends at{constructor(t,i,r){super(t,i,new ot(Jz,()=>import("./chunk-BHHPD66M.js")),r)}initializePipeline(){return mt({blending:ap(oi.SRC_ALPHA,oi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Vi.ALWAYS},colorWrite:wt})}};var ET=class extends Vs{constructor(e){super(e),this.requireGeometryDepth=!0,this._compositingPassParameters=new Xz,this._vao=null,this._passParameters=new MT,this._configuration=new Nv;let{techniques:t}=e;t.precompile(og,this._configuration),t.precompile(Vv),this._configuration.reduced=!0,t.precompile(og,this._configuration),this._configuration.reduced=!1}initialize(){this.addHandles([T(()=>this.view.environment.background,e=>{let t=e instanceof fC?Xm(e.color):Zs;ve(this._passParameters.backgroundColor,t[0]*t[3],t[1]*t[3],t[2]*t[3])},Ce),T(()=>this.view._stage?.renderer?.fullResolutionAtmosphere,e=>this._configuration.reduced=!e,Ce),T(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Ce)])}destroy(){this._vao=Ne(this._vao)}render(e){let t=e.find(({name:g})=>g===Fe.OPAQUE_ENVIRONMENT);if(!this.bindParameters.mainDepth)return t;let i=this.renderingContext;this._vao??=Qs(i,Ad.Pos2Tex);let r=t.getAttachment(i.gl.DEPTH_STENCIL_ATTACHMENT);this._update();let s=this.techniques.acquire(og,this._configuration);if(!s.compiled)return s.release(),this.requestRender(Te.UPDATE),t;if(!this._configuration.reduced)return t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(s,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(ni.TRIANGLE_STRIP,0,4),t.attachDepth(r),s.release(),t;let n=this.techniques.acquire(Vv);if(!n.compiled)return s.release(),n.release(),this.requestRender(Te.UPDATE),t;let o=i.getViewport(),a=this.bindParameters.camera,l=be(a.eye)-qs.radius,d,u=qs.atmosphereHeight;if(l<u){let g=Math.min(1,Math.max(0,l/u));d=Ke(.2,.3,g)}else{let g=Math.min(1,Math.max(0,(l-u)/(15*u)));d=Ke(.3,.6,g)}let m=wd(Math.round(d*a.fullViewport[2])),p=wd(Math.round(d*a.fullViewport[3]));i.setViewport(0,0,m,p);let f=this.fboCache.acquire(m,p,"chapman",dr.RGBA);return i.bindFramebuffer(f.fbo),i.clearFramebuffer([0,0,0,1],!0,!0),i.bindTechnique(s,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(ni.TRIANGLE_STRIP,0,4),i.setViewport(o.x,o.y,o.width,o.height),this._compositingPassParameters.color=f.getTexture(),t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(n,this.bindParameters,this._compositingPassParameters),i.screen.draw(),t.attachDepth(r),s.release(),n.release(),f.release(),t}_update(){let e=this.bindParameters.camera,t=ds(e.eye),i=Math.sqrt(t),r=t-this._passParameters.radii[1]**2,s=U((i-this._passParameters.radii[0])/qs.atmosphereHeight,0,1);So(this._passParameters.heightParameters,i,t,r,s);let n=this.view.basemapTerrain.getLowerBoundRadius();En(this._passParameters.radii,n,n+qs.atmosphereHeight),this._passParameters.innerFadeDistance=2*Math.sqrt((2*n-z_)*z_),this._passParameters.altitudeFade=Ap(i-n)}};ET=c([w("esri.views.3d.environment.ChapmanAtmosphere")],ET);var Bv=class extends at{constructor(t,i,r){super(t,i,new ot(e3,()=>import("./chunk-KMZAWPWZ.js")),r)}initializePipeline(){return mt({blending:cl(oi.ONE,oi.ZERO,oi.SRC_ALPHA,oi.ONE),depthTest:{func:Vi.LEQUAL},colorWrite:wt})}};var RT=class extends Vs{constructor(e){super(e),e.techniques.precompile(Bv),this._planetRadius=ht(e.view.spatialReference).radius}initialize(){this.addHandles([T(()=>this.view.environment.weather!=null&&this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),ie)])}destroy(){this._vao=Ne(this._vao)}render(e){let t=e.find(({name:o})=>o===Fe.OPAQUE_ENVIRONMENT),i=this.bindParameters.clouds;if(!i.data)return t;let r=this.techniques.acquire(Bv);if(!r.compiled)return this.requestRender(Te.UPDATE),r.release(),t;let s=this.renderingContext;this._vao??=Qs(s);let n=s.bindTechnique(r,this.bindParameters,zee);return s.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),s.drawArrays(ni.TRIANGLE_STRIP,0,4),r.release(),i.isFading&&this.requestRender(Te.UPDATE),t}};RT=c([w("esri.views.3d.environment.CloudsComposition")],RT);var zee=new nl;var zv=class extends at{constructor(t,i,r){super(t,i,new ot(i3,()=>import("./chunk-GEYBK2O6.js")),r)}initializePipeline(){return mt({blending:cl(oi.SRC_ALPHA,oi.ZERO,oi.ONE_MINUS_SRC_ALPHA,oi.ONE),colorWrite:wt})}};var om=class extends Vs{constructor(e){super(e),this.consumes={required:[Fe.TRANSPARENT_ENVIRONMENT]}}_enable(){this.produces=Fe.TRANSPARENT_ENVIRONMENT,this.requestRender(Te.UPDATE)}};c([h()],om.prototype,"consumes",void 0),om=c([w("esri.views.3d.webgl-engine.effects.TransparentEnvironment")],om);var Uee=.95,Hee=1,AT=class extends om{constructor(e){super(e),this.requireGeometryDepth=!0,this._newParameters=new Uv,this._oldParameters=new Uv,this._fadedParameters=new Uv,this._parameters=this._newParameters,this._passParameters=new t3;let{view:t,techniques:i}=e,r=ht(t.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+r.atmosphereHeight,i.precompile(zv)}toogle(){this.view.environment.atmosphereEnabled&&this.view.environment.weather?this._enable():this._disable()}initialize(){this.addHandles([T(()=>this.view.environment.atmosphereEnabled,()=>this.toogle(),Ce),T(()=>this.view.environment.weather,()=>this.toogle(),Ce),T(()=>this._updateFogParameters(),()=>{},Ce)]),this.addHandles(T(()=>this._fadeFactor,e=>this._fade(e),Ce))}get _fadeFactor(){return this.view._stage?.renderer.renderContext.bind.clouds.fadeFactor??1}_fade(e){let{_newParameters:t,_oldParameters:i}=this;e>=1?(this._parameters=t,this._oldParameters.copyFrom(this._newParameters)):e<=0?this._parameters=i:(this._fadedParameters.lerp(i,t,e),this._parameters=this._fadedParameters)}_updateFogParameters(){let e=this.view.environment.weather,t=e.type==="foggy"||e.type==="snowy"||e.type==="rainy";this._newParameters.strength=e.type==="foggy"?Ke(3e-5,.005,e.fogStrength**3):e.type==="snowy"||e.type==="rainy"?Ke(4e-6,2e-4,(e.precipitation??0)**3):0,this._newParameters.amount=t?1:0,e.type!=="foggy"&&e.type!=="snowy"||G(this._newParameters.color,Gee),e.type==="rainy"&&G(this._newParameters.color,jee),this._fadeFactor>=1&&this._oldParameters.copyFrom(this._newParameters),this.requestRender(Te.UPDATE)}render(e){let t=e.find(({name:n})=>n===Fe.TRANSPARENT_ENVIRONMENT);if(this._parameters.amount===0||(this._update(),this._passParameters.amount<=0))return t;let i=this.techniques.acquire(zv);if(!i.compiled)return this.requestRender(Te.UPDATE),i.release(),t;let r=this.renderingContext,s=t.getAttachment(r.gl.DEPTH_STENCIL_ATTACHMENT);return t.attachDepth(null),r.bindFramebuffer(t.fbo),r.bindTechnique(i,this.bindParameters,this._passParameters),r.screen.draw(),t.attachDepth(s),i.release(),t}_update(){let e=this.bindParameters.camera;Z(Qq,e.eye);let t=Math.max(0,X(Qq,this.bindParameters.lighting.mainLight.direction)),i=this._parameters.color;q(Kq,i,.1),di(this._passParameters.color,Kq,i,t);let r=be(e.eye);this._passParameters.atmosphereC=r**2-this._atmosphereRadius**2,this._passParameters.amount=(1-tc(Uee*N_,Hee*N_,Math.abs(r-this._planetRadius)))*this._parameters.amount,this._passParameters.strength=this._parameters.strength}};AT=c([w("esri.views.3d.environment.Fog")],AT);var Uv=class{constructor(){this.color=b(),this.strength=0,this.amount=0}copyFrom(t){this.amount=t.amount,this.strength=t.strength,G(this.color,t.color)}lerp(t,i,r){this.amount=Ke(t.amount,i.amount,r),this.strength=Ke(t.strength,i.strength,r),di(this.color,t.color,i.color,r)}},Qq=b(),Kq=b(),jee=dt(.5,.5,.5),Gee=dt(1.5,1.5,1.5);var jl=class extends at{constructor(t,i,r){super(t,i,new ot(r3,()=>import("./chunk-3RIENIM2.js")),r)}initializePipeline(t){let i=t.geometry===Pd.Cylinder;return mt({blending:dl,culling:i?S0:void 0,depthTest:{func:Vi.LEQUAL},colorWrite:wt})}};var Yq=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);var IT=class extends Vs{constructor(e){super(e),this._configuration=new _w,this._passParameters=new yw,this._vao=null,this._vaoCount=0;let{techniques:t}=e;this._configuration.geometry=Pd.Cylinder,t.precompile(jl,this._configuration)}initialize(){this.addHandles([T(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),ie)])}destroy(){this._passParameters.texture=Ne(this._passParameters.texture),this._vao=Ne(this._vao)}render(e){let t=e.find(({name:n})=>n===Fe.OPAQUE_ENVIRONMENT),i=this.techniques.acquire(jl,this._configuration);if(!i.compiled)return i.release(),this.requestRender(Te.UPDATE),t;let r=this.renderingContext;if(this._vao||(this._vao=qee(r),this._vaoCount=fa(this._vao,"geometry")),!this._passParameters.texture){let n=new Di;n.wrapMode=lr.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Rr(r,n,Yq)}let s=r.bindTechnique(i,this.bindParameters,this._passParameters);return Wee(Xq,this.bindParameters.camera.viewMatrix),s.setUniformMatrix4fv("view",Xq),r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(ni.TRIANGLES,0,this._vaoCount),i.release(),t}};function qee(e){let t=wN(1,2,!1),{data:i,indices:r}=t[0][1],s=Jq.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){let a=3*r[o%3==0?o+2:o%3==2?o-2:o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Dn(e,al,new Map([["geometry",In(Jq)]]),new Map([["geometry",es.createVertex(e,Is.STATIC_DRAW,s.buffer)]]))}function Wee(e,t){od(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}IT=c([w("esri.views.3d.environment.LocalAtmosphere")],IT);var Xq=Ht(),Jq=$n().vec3f(Ii.POSITION);var e8=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);var DT=128,t8=-z_,i8=0,qP=50,$ee=()=>1-511/512,Zee=ep([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]),$P=class extends Vs{constructor(e){super(e),this._passParameters=new yw,this._configuration=new _w,this._vao=null,this._vaoCount=0,this._fadeVao=null,this._fadeVaoCount=0,this._texV1=1;let{view:t,techniques:i}=e,r=ht(t.spatialReference),{outerAtmosphereRimWidth:s,radius:n}=r;this._planetRadius=n,this._innerRimFactor=1+t8/n,this._middleRimFactor=1+i8/n,this._outerRimFactor=1+s/n,this._texV0=i8/s,this._texVScale=this._texV1-this._texV0,i.precompile(jl,this._configuration),this._configuration.geometry=Pd.Underground,i.precompile(jl,this._configuration)}initialize(){this.addHandles(T(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),ie))}destroy(){this._passParameters.texture=Ne(this._passParameters.texture),this._fadeVao=Ne(this._fadeVao),this._vao=Ne(this._vao)}render(e){let t=e.find(({name:r})=>r===Fe.OPAQUE_ENVIRONMENT);this._update();let i=this.renderingContext;if(!this._passParameters.texture){let r=new Di;r.wrapMode=lr.CLAMP_TO_EDGE,r.flipped=!0,r.width=1,r.height=512,this._passParameters.texture=new Rr(i,r,e8)}if(this._passParameters.undergroundFadeAlpha<1){this._vao||(this._vao=this._createRibbon(i),this._vaoCount=fa(this._vao,"geometry")),this._configuration.geometry=Pd.Cone;let r=this.techniques.acquire(jl,this._configuration);if(!r.compiled)return r.release(),this.requestRender(Te.UPDATE),t;i.bindTechnique(r,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(ni.TRIANGLES,0,this._vaoCount),r.release()}if(this._passParameters.undergroundFadeAlpha>0){this._fadeVao||(this._fadeVao=Qs(i),this._fadeVaoCount=fa(this._fadeVao,"geometry")),this._configuration.geometry=Pd.Underground;let r=this.techniques.acquire(jl,this._configuration);if(!r.compiled)return r.release(),this.requestRender(Te.UPDATE),t;i.bindTechnique(r,this.bindParameters,this._passParameters),i.bindVAO(this._fadeVao),i.drawArrays(ni.TRIANGLE_STRIP,0,this._fadeVaoCount),r.release()}return t}_update(){let e=this.bindParameters.camera,t=b(),i=this._planetRadius,r=be(e.eye),s=r-i;if(s<0){let p=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=p}else this._passParameters.undergroundFadeAlpha=0;let n=Math.max(qP,s),o=i+t8;this._passParameters.innerScale=Qee(i+n,i,o)-1,this._passParameters.altitudeFade=Ap(s),q(t,e.eye,(i+qP)/r),r8(t,e.center,e.up,i,this._passParameters.silhouette);let a=this._computeScreenRimWidth(e,t,e.up,this._passParameters.silhouette),l=$ee(),d=Zee(s),u=this._texV0+l*this._texVScale,m=this._texV0+a*d*this._texVScale;if(s>qP){r8(e.eye,e.center,e.up,i,this._passParameters.silhouette);let p=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),f=U((p-1.5)/(a-1.5),0,1);u=this._texV0+f*l*this._texVScale,m=this._texV0+Ke(this._texV1,a*d,f)*this._texVScale}En(this._passParameters.texV,u,m)}_createRibbon(e){let t=r0(3+3*DT*3),i=new Uint32Array(3*DT*5);t[0]=0,t[1]=0,t[2]=-1;for(let n=0;n<DT;n++){let o=9*n+3;t[o]=n,t[o+1]=this._innerRimFactor,t[o+2]=-1,t[o+3]=n,t[o+4]=this._middleRimFactor,t[o+5]=0,t[o+6]=n,t[o+7]=this._outerRimFactor,t[o+8]=1;let a=3*n+1,l=n===DT-1?1:a+3,d=15*n;i[d]=a,i[d+1]=a+1,i[d+2]=l+1,i[d+3]=l+1,i[d+4]=l,i[d+5]=a,i[d+6]=a+1,i[d+7]=a+2,i[d+8]=l+2,i[d+9]=l+2,i[d+10]=l+1,i[d+11]=a+1,i[d+12]=a,i[d+13]=l,i[d+14]=0}let r=s8.createBuffer(i.length),s=r.position;for(let n=0;n<i.length;++n){let o=3*i[n];s.set(n,0,t[o]),s.set(n,1,t[o+1]),s.set(n,2,t[o+2])}return new Dn(e,al,new Map([["geometry",In(s8)]]),new Map([["geometry",es.createVertex(e,Is.STATIC_DRAW,r.buffer)]]))}_computeScreenRimWidth(e,t,i,r){return te(ag,r.center,r.v2),q(PT,ag,this._outerRimFactor),YL(WP,t,ag,i),ZM(ag,WP,e.projectionMatrix,e.viewport,ag),ZM(PT,WP,e.projectionMatrix,e.viewport,PT),Ai(ag,PT)/e.height}};function r8(e,t,i,r,s){let n=be(e),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.v1,d=s.v2;return q(s.center,e,a/n),Ct(l,e,t),ds(l)<1&&Ct(l,e,i),q(l,l,o/be(l)),Ct(d,l,e),q(d,d,o/be(d)),o}$P=c([w("esri.views.3d.environment.MarsAtmosphere")],$P);var WP=Ht(),ag=b(),PT=b();function Qee(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}var s8=$n().vec3f(Ii.POSITION),n8=$P;var OT=class{constructor(t){this._totalCount=t,this._componentCountCache=-1,this._indexRanges=[0,t]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(t){if(t<0||t>=this._totalCount)return!1;if(this.allVisible())return!0;{let i=this._indexRanges,r=0,s=i.length/2;if(t<i[2*r]||t>i[2*s]+i[2*s+1])return!1;for(;s-r>0;){let n=Math.floor(.5*(r+s)),o=i[2*n];if(t<o){if(s-r==1)return!1;s=n;continue}if(t<o+i[2*n+1])return!0;if(s-r==1)return!1;r=n+1}return!1}}get componentCount(){if(this._componentCountCache===-1){let t=this._indexRanges,i=0;for(let r=0;r<t.length;r+=2)i+=t[r+1];this._componentCountCache=i}return this._componentCountCache}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Kee(t),this._componentCountCache=-1}forEachComponent(t){let i=this._indexRanges;for(let r=0;r<i.length;r+=2){let s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){let i=this._indexRanges;for(let r=0;r<i.length;r+=2){let s=i[r];if(!t(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(t){let i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){let n=r[s],o=n+r[s+1],a=t[n],l=t[o];i[s]=a,i[s+1]=l-a}return i}};function Kee(e){let t=new Array;if(e.length===0)return t;let i=e[0],r=1;for(let s=1;s<e.length;s++){let n=e[s];i+r===n?r+=1:(t.push(i),t.push(r),i=n,r=1)}return t.push(i),t.push(r),t}var kT=class{constructor(t,i){this.offsets=i,this.pickability=null,this.highlightCounts=null,this.highlightGroups=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRangesMap=null,this.cachedDefaultRanges=null;let r=this.count;this.visibility=new OT(r),this.materialDataBuffer=t.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRangesMap)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRangesMap=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRangesMap==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null&&this.highlightGroups!=null){let{highlightRangesMap:t,defaultRanges:i}=Yee(this.highlightCounts,this.highlightGroups,this.visibility,this.offsets);this.cachedHighlightRangesMap=t,this.cachedDefaultRanges=i}}};function Yee(e,t,i,r){let s=new Map,n=[],o=r.length;return i.forEachComponent(a=>{if(e[a]>0){let l=t[a],d=s.get(l);d===void 0&&(d=[],s.set(l,d));let u=r[a],m=r[a+1];d.push(u),d.push(m-u)}else o!==a-1&&(n.length&&n.push(r[o+1]-n[n.length-1]),n.push(r[a])),o=a;return!0}),n.length&&n.push(r[o+1]-n[n.length-1]),{highlightRangesMap:s,defaultRanges:n}}var LT=class{constructor(t,i,r,s,n,o){this.transform=t,this.toMapSpace=i,this.obb=r,this.components=s,this.renderable=n,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=z(this.intersectionGeometry),this.renderable=z(this.renderable),this.components=z(this.components)}};function o8(e,t,i,r,s,n,o){let a=n-o,l=t-e,d=new Float64Array(4*l);for(let u=0;u<l;++u){let m=3*(u+e),p=s*i[m+0],f=r[p+0],g=r[p+1],_=a/(r[p+2]-o),y=f*_,v=g*_,x=s*i[m+1],S=r[x+0],C=r[x+1],E=a/(r[x+2]-o),R=S*E,D=C*E,L=s*i[m+2],O=r[L+0],H=r[L+1],B=a/(r[L+2]-o),j=O*B,Y=H*B,N=4*u;d[N+0]=Math.min(y,R,j),d[N+1]=Math.min(v,D,Y),d[N+2]=Math.max(y,R,j),d[N+3]=Math.max(v,D,Y)}return d}function a8(e,t,i,r,s){let n=t-e,o=new Float64Array(4*n);for(let a=0;a<n;++a){let l=3*(a+e),d=s*i[l+0],u=r[d+0],m=r[d+1],p=s*i[l+1],f=r[p+0],g=r[p+1],_=s*i[l+2],y=r[_+0],v=r[_+1],x=4*a;o[x+0]=Math.min(u,f,y),o[x+1]=Math.min(m,g,v),o[x+2]=Math.max(u,f,y),o[x+3]=Math.max(m,g,v)}return o}function l8(e,t){return new(Xee(e))(t)}function Xee(e){return e<128?Uint8Array:e<32768?Uint16Array:e<1<<31?Uint32Array:Array}var lg=class{constructor(t,i){this.elementCount=t,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=dt(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(t,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(t,i,r))}_intersectRayWithoutBVH(t){this._intersectRange(0,this.elementCount)}_intersectRange(t,i){this.model.intersectRange(t,i)}_intersectRayWithBVH(t,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(t):this._intersectGeometryWithBVHGeneralRay(t,i)}_intersectGeometryWithBVHVerticalRay(t){let i=t[0],r=t[1];if(!this.localMode){let{geometryMinZ:o,planetCenterZ:a}=this,l=(o-a)/(t[2]-a);i=t[0]*l,r=t[1]*l}let{_bspNodes:s}=this,n=0;for(;n>=0;){let o=s[n],{d:a,dim:l,minIndexIndex:d,minMidIndexIndex:u,maxMidIndexIndex:m,maxIndexIndex:p,aabb2D:f}=o;if(i<f[0]||i>f[2]||r<f[1]||r>f[3])break;if(l===-1||o.child0===-1&&o.child1===-1){this._intersectRange(d,p);break}{this._intersectRange(u,m);let g=(l===0?i:r)-a;if(g<0){if(o.child0===-1){this._intersectRange(d,u);break}n=o.child0}else{if(!(g>0))break;if(o.child1===-1){this._intersectRange(m,p);break}n=o.child1}}}}_intersectGeometryWithBVHGeneralRay(t,i){let r=t[0],s=t[1],n=i[0],o=i[1],{geometryMinZ:a}=this;if(!this.localMode){let g=0,_=1,y=Math.min(.5*this.planetCenterZ,a),v=t[2],x=i[2];if(v<y&&x<y||(v<y&&(g=(y-v)/(x-v)),x<y&&(_=(y-v)/(x-v)),g>_))return;let S=(1-g)*t[0]+g*i[0],C=(1-g)*t[1]+g*i[1],E=(1-g)*t[2]+g*i[2],R=(1-_)*t[0]+_*i[0],D=(1-_)*t[1]+_*i[1],L=(1-_)*t[2]+_*i[2],{planetCenterZ:O}=this,H=a-O,B=H/(E-O);r=S*B,s=C*B;let j=H/(L-O);n=R*j,o=D*j}let l=n-r,d=o-s,u=this._bspNodes,m=1;{let{aabb2D:g}=u[0],_=(x,S,C,E)=>{if(Math.abs(S)<1e-5*Math.max(E-C,1))return!1;let R=S>0,D=R?E:C,L=x+m*S;return(R?L<D:L>D)&&(m=Math.max((D-x)/S,m),!0)},y=()=>_(r,l,g[0],g[2]),v=()=>_(s,d,g[1],g[3]);Math.abs(l)>=Math.abs(d)?y()||v():v()||y()}let p=[0,0,m],f=0;for(;f<p.length;){let g=p[f],_=p[f+1],y=p[f+2];if(f+=3,_>y)continue;let v=u[g],{minIndexIndex:x,maxIndexIndex:S}=v,{child0:C,child1:E,minMidIndexIndex:R,maxMidIndexIndex:D,aabb2D:L,d:O,dim:H}=v;{let B=r+_*l,j=r+y*l,Y=Math.min(B,j),N=Math.max(B,j),F=L[0],me=L[2];if(N<F||me<Y)continue;if(Y<F){let $=(F-r)/l;l>0?_=Math.max(_,$):y=Math.min(y,$)}if(me<N){let $=(me-r)/l;l>0?y=Math.min(y,$):_=Math.max(_,$)}}{let B=s+_*d,j=s+y*d,Y=Math.min(B,j),N=Math.max(B,j),F=L[1],me=L[3];if(N<F||me<Y)continue;if(Y<F){let $=(F-s)/d;d>0?_=Math.max(_,$):y=Math.min(y,$)}if(me<N){let $=(me-s)/d;d>0?y=Math.min(y,$):_=Math.max(_,$)}}if(C===-1&&E===-1)this._intersectRange(x,S);else{let B=H===0?r:s,j=H===0?l:d,Y=B+_*j,N=B+y*j,F=Math.min(Y,N),me=Math.max(Y,N),$=U((O-B)/j,0,m);x<R&&F<=O&&(C!==-1?(p.push(C),p.push(j>=0?_:Math.max(_,$)),p.push(j>=0?Math.min(y,$):y)):this._intersectRange(x,R)),this._intersectRange(R,D),D<S&&O<=me&&(E!==-1?(p.push(E),p.push(j>=0?Math.max(_,$):_),p.push(j>=0?y:Math.min(y,$))):this._intersectRange(D,S))}}}_generateBsp(){let{elementCount:t}=this;if(t<1)return;let i=l8(t,t);this._elementIndexMap=i;for(let f=0;f<t;++f)i[f]=f;let r=this.model.getAabbs2D(),s=0,n=this._bspNodes;n.length=0;let{localMode:o}=this,a=!1;if(!o){let{planetCenterZ:f,geometryMinZ:g}=this;a=f>=0||g<.5*f}let l=[],d=(f,g,_,y,v)=>{l.push(f),l.push(g),l.push(_),l.push(y<0?-1:(v?0:1)+2*y)},{maxBspNodeDepth:u,minBspNodeElementCount:m}=this,p=(f,g,_,y,v)=>{let x=n.length;if(x>0&&(a||_>=u||g-f<m))return;let S=[0,0,0,0];ite(S,f,g,i,r);let{d:C,dim:E}=o?Jee(S):ete(S),{rangeMidStart:R,rangeMidEnd:D}=tte(f,g,E,C,i,r),L=_===u-1,O=!L&&R>=f+m,H=!L&&g>=D+m;if(O||H||x===0){let B=new ZP(f,R,D,g,E,C,S);if(O&&d(f,R,_+1,x,!0),H&&d(D,g,_+1,x,!1),n.push(B),y!==-1){let j=n[y];v?j.child0=x:j.child1=x}}};for(d(0,t,0,-1,!1);s<l.length;){let f=l[s],g=l[s+1],_=l[s+2],y=l[s+3];s+=4;let v=y>>1;p(f,g,_,v,y-(v<<1)==0)}this._generatedBVH=!0}};function Jee(e){let t=e[0],i=e[1],r=e[2],s=e[3],n,o;return r-t>=s-i?(o=.5*(t+r),n=0):(o=.5*(i+s),n=1),{d:o,dim:n}}function ete(e){let t=e[0],i=e[1],r=e[2],s=e[3],n,o;return r-t>=s-i?(n=0,o=.5*(t+r)):(n=1,o=.5*(i+s)),{dim:n,d:o}}function tte(e,t,i,r,s,n){let o=e;{let u=t;for(;o<u;){let m=s[o];c8(m,i,r,n)<0?++o:(--u,s[o]=s[u],s[u]=m)}}let a=o,l=o,d=t;for(;l<d;){let u=s[d-1];c8(u,i,r,n)>0?--d:(s[d-1]=s[l],s[l]=u,++l)}return{rangeMidStart:a,rangeMidEnd:d}}function c8(e,t,i,r){let s=4*e,n=r[s+0+t];return r[s+2+t]<i?-1:n>i?1:0}function ite(e,t,i,r,s){let n=1/0,o=1/0,a=-1/0,l=-1/0;for(let d=t;d<i;++d){let u=4*r[d];n=Math.min(n,s[u+0]),o=Math.min(o,s[u+1]),a=Math.max(a,s[u+2]),l=Math.max(l,s[u+3])}e[0]=n,e[1]=o,e[2]=a,e[3]=l}var ZP=class{constructor(t,i,r,s,n,o,a){this.minIndexIndex=t,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=s,this.dim=n,this.d=o,this.aabb2D=a,this.child0=-1,this.child1=-1}};var FT=class{constructor(t,i,r,s,n,o,a,l,d){this.componentIndex=t,this.vertexData=i,this.vertexStride=r,this.indexData=s,this.startTriangleNumber=n,this.endTriangleNumber=o,this.geometryMinZ=a,this.planetCenterZ=l,this.localMode=d,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=b(),this.ray0=b(),this.isVerticalRay=!1,this._triangleHitCallback=d8,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new lg(o-n,this)}getAabbs2D(){return this.localMode?a8(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):o8(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(t,i,r,s,n,o){G(this.ray0,t),gi(this.rayDirection,i,t),this.isVerticalRay=r,this.totalElevationOffset=s,this.normalRequired=o,this._triangleHitCallback=n,this._bvh.intersectRay(t,i,r),this._triangleHitCallback=d8}intersectRange(t,i){let r=this._bvh.elementIndexMap;QP(this.ray0,this.rayDirection,t,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(t){return this.totalElevationOffset}};function QP(e,t,i,r,s,n,o,a,l,d,u,m=null,p=0){a!==0?fN(e,t,i,r,s,n,o,a,l,d,u,m,p):E0(e,t,i,r,s,n,o,d,u,m,p)}function d8(){}function h8(e,t,i,r){if(i>=t)return e;e==null&&(e=rte());let s=e.isVisibleBit,n=e.data,o=u8(n),a=i/o|0,l=i-o*a,d=(t-1)/o|0,u=n,m=r===s;if(!(i<u.length*o)&&m){let p=a+1,f=Math.ceil(u.length*Fk),g=d+1,_=Math.max(p,f);_=Math.min(_,g),n=new Uint32Array(_),n.set(u)}return a<n.length&&(n[a]=nte(n[a],l,m)),e.data=n,e}function Hv(e,t){if(e==null)return!0;let{isVisibleBit:i,data:r}=e,s=u8(r);return t<r.length*s?ste(i,r,t,s):!e.isVisibleBit}function rte(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function ste(e,t,i,r){let s=i/r|0,n=i-s*r;return ote(t[s],n)===e}function u8(e){return e.BYTES_PER_ELEMENT*8}function nte(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function ote(e,t){return!!(e&1<<t)}var NT=class{constructor(t,i,r,s,n,o,a,l){this.vertexData=t,this.vertexStride=i,this.indexData=r,this._components=s,this._componentAabbs3D=n,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=dte,this._ray1=hte,this._invDir=b(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=ute,this._callback=m8,this.rayDirectionC=b(),this._componentIndexMap=null,this._bvh=new lg(s.count,this),this.componentIntersectionData=new Array(s.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){let{numComponents:t,planetCenterZ:i,minZGlobal:r}=this,s=new Float64Array(4*t),n=this._componentAabbs3D;for(let o=0;o<t;++o){let a=6*o,l=n[a+0],d=n[a+1],u=n[a+2],m=n[a+3],p=n[a+4],f=r/(u-i),g=r/(n[a+5]-i),_=Math.min(l*f,l*g),y=Math.min(d*f,d*g),v=Math.max(m*f,m*g),x=Math.max(p*f,p*g),S=4*o;s[S+0]=_,s[S+1]=y,s[S+2]=v,s[S+3]=x}return s}getAabbs2DLocal(){let{numComponents:t}=this,i=new Float64Array(4*t),r=this._componentAabbs3D;for(let s=0;s<t;++s){let n=6*s,o=r[n+0],a=r[n+1],l=r[n+3],d=r[n+4],u=4*s;i[u+0]=o,i[u+1]=a,i[u+2]=l,i[u+3]=d}return i}intersectRay(t,i,r,s,n,o,a){let{isVerticalRay:l}=a;this._ray0=t,this._ray1=i,this._componentVerticalOffsets=r,this._verticalOffset=s,this._tolerance=o,this._intersectionOptions=a,this._componentIndexMap=this._bvh.elementIndexMap,gN(t,i,this._invDir),this._callback=n,this._bvh.intersectRay(t,i,l),this._callback=m8}intersectRange(t,i){let r=this._componentIndexMap,s=this._components,n=s.pickability,o=s.visibility;for(let a=t;a<i;++a){let l=r?r[a]:a;Hv(n,l)&&o.isVisible(l)&&this._intersectComponent(l)}}getComponentTriangleCount(t){let i=this._components.offsets,r=i[t]/3;return i[t+1]/3-r}getComponentAabb3D(t,i){let r=this._componentAabbs3D,s=6*t;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}_intersectComponent(t){if(!Hv(this._components.pickability,t))return;let i=this.getComponentAabb3D(t,ate),r=!1,{localMode:s,_componentVerticalOffsets:n,_verticalOffset:o,_ray0:a,_ray1:l,_invDir:d,planetCenterZ:u,_tolerance:m,rayDirectionC:p,componentIntersectionData:f}=this,{isVerticalRay:g}=this._intersectionOptions,_=this._components.offsets,y=G(lte,a),v=G(cte,l),x=n?.[t]??0,S=x+(o?.offset??0);if(S!==0&&(s?(y[2]=a[2]-S,v[2]=l[2]-S,r=!0):o!=null&&(o.componentOffset=x)),o==null||r||S===0||o.applyToAabb(i),!_N(i,y,d,m))return;gi(p,v,y);let C=_[t]/3,E=_[t+1]/3,R=E-C,D=(Y,N,F)=>{this._callback(Y,N,t,F)},{vertexData:L,vertexStride:O,indexData:H,_intersectionOptions:B}=this,{normalRequired:j}=B;if(R>mte){let Y=f[t];Y==null&&(Y=new FT(t,L,O,H,C,E,this.geometryMinZ,u,s),f[t]=Y),Y.intersectRay(y,v,g,r?0:S,D,j)}else QP(y,p,C,E,H,L,O,r?0:S,u,j,D)}},ate=ld(),lte=b(),cte=b(),dte=b(),hte=b(),m8=()=>{},ute=new hp,mte=40;var VT=class{constructor(t,i,r){this.viewingMode=t,this.positionData=i,this._components=r,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=b(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=i.indices?i0(i.indices):H2(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(t,i){let r=this._ensureComponentAabbs(),s=6*t;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(t,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[t],i.endIndex=this._components.offsets[t+1]}intersect(t,i,r,s,n,o,a,l){this.verticalOffset=s,this.componentVerticalOffsets=n;let{position:d}=o,u=gi(pte,t,d),m=gi(fte,i,d),p=n0(gte,o.rotationScale);Rn(u,u,p),Rn(m,m,p);let f=hd(yte,p);if(this.viewingMode===we.Global){let _=this._planetCenter;Wn(_,d),Rn(_,_,p)}let g=(_,y,v,x)=>{l(v,_,x?Rn(_te,x,f):null,y)};this._intersectComponents(u,m,n,s,g,r,a)}_computePerComponentAabbs(){let t=this._aabb,i=.5*(t[0]+t[3]),r=.5*(t[1]+t[4]),s=.5*(t[2]+t[5]),n=this._components.count,o=r0(6*n),a=this._indices,l=this._positions,d=this._components.offsets,u=0,m=1/0,p=1/0,f=1/0,g=-1/0,_=-1/0,y=-1/0;for(let v=0;v<n;v++){let x=d[v],S=d[v+1],C=1/0,E=1/0,R=1/0,D=-1/0,L=-1/0,O=-1/0;if(x<S)for(let H=x;H<S;H++){let B=3*a[H],j=l[B],Y=l[B+1],N=l[B+2];C=Math.min(C,j),E=Math.min(E,Y),R=Math.min(R,N),D=Math.max(D,j),L=Math.max(L,Y),O=Math.max(O,N)}else C=i,E=r,R=s,D=i,L=r,O=s;o[u++]=C,o[u++]=E,o[u++]=R,o[u++]=D,o[u++]=L,o[u++]=O,m=Math.min(m,C),p=Math.min(p,E),f=Math.min(f,R),g=Math.max(g,D),_=Math.max(_,L),y=Math.max(y,O)}return this._aabb[0]=m,this._aabb[1]=p,this._aabb[2]=f,this._aabb[3]=g,this._aabb[4]=_,this._aabb[5]=y,o}_intersectComponents(t,i,r,s,n,o,a){let l=this._componentBvh;l==null&&(l=new NT(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=l),l.intersectRay(t,i,r,s,n,o,a)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===we.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}},pte=b(),fte=b(),gte=un(),_te=b(),yte=un();var BT=class{constructor(t,i,r){this.material=t,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}};var zT=class{constructor(t,i,r,s){this.vao=t,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}};var Ah=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function vte(e,t){return{near:e,far:t}}function am(e){return e?cg(e,1/0,-1/0):vte(1/0,-1/0)}function cg(e,t,i){return e.near=t,e.far=i,e}function Ba(e,t){t!=null&&(e.near=Math.min(e.near,t.near),e.far=Math.max(e.far,t.far))}function jv(e,t){return e.near<=t&&t<=e.far}var Gv={near:0,far:0};function v8(e,t){let i=am(),{eye:r,frustum:s,viewForward:n}=e;t.forAll(o=>{let a=o.offsetObb!=null?o.offsetObb:o.obb,l=X(gi(co,a.center,r),n),d=a.projectedRadius(n);if(jv(i,l-d)&&jv(i,l+d))return;let u=Ste(a,s);if(u===-1)return;if(u===0)return Hc.far=l+d,Hc.near=l-d,void Ba(i,Hc);let m=UT.pushNew();m.near=l-d,m.far=l+d,m.mask=u,m.object=o});for(let o=0;o<UT.length;o++){let a=UT.data[o];if(jv(i,a.near)&&jv(i,a.far))continue;Hc.far=a.far,Hc.near=1/0,Cte(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,bte,d=>{let u=wte;for(let m=0;m<b8&&d.length>0;m++){if(!(a.mask&1<<m))continue;xte(s[m],d,u);let p=d;d=u,u=p}for(let m=0;m<d.length;m+=3){ve(xn,d.data[m],d.data[m+1],d.data[m+2]);let p=X(gi(xn,xn,r),n);Hc.near=Math.min(Hc.near,p)}})===0&&(Hc.near=0),Ba(i,Hc)}return UT.length=0,i}var UT=new Dt({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),Hc=am(),xn=b(),lm=b(),bte=new Dt({deallocator:null}),wte=new Dt({deallocator:null});function xte(e,t,i){i.length=0;let r=t.length-3;KP(xn,t,r);let s=lc(e,xn);s<=0&&(i.push(xn[0]),i.push(xn[1]),i.push(xn[2]));let n=0,o=s;for(;n<r;n+=3){KP(lm,t,n);let a=lc(e,lm);o*a<0&&(di(xn,lm,xn,a/(a-o)),Cn(i,xn)),a<=0&&Cn(i,lm),o=a,G(xn,lm)}o*s<0&&(KP(lm,t,r),di(xn,lm,xn,s/(s-o)),Cn(i,xn))}function KP(e,t,i){return ve(e,t.data[i],t.data[i+1],t.data[i+2])}function Cn(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function Cte(e,t,i,r){wF(f8,e.quaternion),gi(co,t,e.center),L2(co,co,f8);let s=e.halfSize,n=8*((co[0]<-s[0]?-1:co[0]>s[0]?1:0)+3*(co[1]<-s[1]?-1:co[1]>s[1]?1:0)+9*(co[2]<-s[2]?-1:co[2]>s[2]?1:0)+13),o=p8[n];if(o===0)return o;G2(HT,e.quaternion),a0(HT,HT,e.halfSize);let a=(l,d)=>{let u=p8[n+d+1];return ve(l,((1&u)<<1)-1,(2&u)-1,((4&u)>>1)-1),Rn(l,l,HT),te(l,e.center,l)};return i.length=0,Cn(i,a(YP,0)),Cn(i,a(g8,1)),Cn(i,a(co,2)),Cn(i,a(_8,3)),r(i),o===1||(i.length=0,Cn(i,YP),Cn(i,_8),Cn(i,a(co,4)),Cn(i,a(y8,5)),r(i),o===2||(i.length=0,Cn(i,YP),Cn(i,y8),Cn(i,a(co,6)),Cn(i,g8),r(i))),o}var p8=(()=>{let e=new Array(216),t=0,i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),b8=4;function Ste(e,t){let i=0;for(let r=0;r<b8;r++){let s=e.intersectPlane(t[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}var HT=un(),f8=g_(),co=b(),YP=b(),g8=b(),_8=b(),y8=b();var jT=class{constructor(t){this._objects=t}submit(t,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(t,i,r))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?v8(t,this._objects.visibleObjects):null}get hasEmissions(){return this._objects.visibleObjects.some(t=>t.renderable.material.hasEmissions)}};var GT=class{constructor(){this.externalColor=br(),this.externalColorMixMode=w0.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}};var w8=()=>V.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection"),qT=class{constructor(t,i){this._renderManager=t,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new Dt,this._hidden=new Dt,this._renderSubmit=new jT(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new s3(t.rctx,2+(vd()?1:0))}destroy(){us(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(t=>t.destroy()),this._hidden.forAll(t=>t.destroy()),this._visible.clear(),this._hidden.clear()}createObject(t){let i=t.geometry,r=new kT(this._componentBufferManager,i0(i.componentOffsets)),s=this._createRenderable(t,r),n=new VT(this._viewingMode,i.positionData,r),o=new LT(t.transform,t.toMapSpace,t.obb.clone(),r,s,n);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(t){let i=t;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(t,i){let r=t;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(t){let i=t.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Mo(i,r.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,i){let r=t.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,i){let r=t;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,i){return t.components.visibility.forEachComponent(i)}getComponentCount(t){let i=t,r=i.components.visibility.componentCount;return{visible:r,invisible:i.components.count-r}}setComponentData(t,i){let r=t,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new GT,d=o.textureBuffer,u=new Uint8Array(4),m=new Uint32Array(u.buffer),p=0,f=0,g=0,_=n.verticalOffsets,y=1/0,v=-1/0,x=!1,S=!1,C=0;for(let E=0;E<n.count;E++){i(E,l),p+=+(l.externalColor[3]<1),f+=+(l.externalColorMixMode===w0.Replace&&l.externalColor[3]===1),g+=+l.castShadows,FF(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,d.setData(a[E],0,u[0],u[1],u[2],u[3]),x||=E>0&&C!==m[0],C=m[0],S||=l.elevationOffset!==0,S&&_==null&&(_=new Array(E).fill(0)),_!=null&&(_[E]=l.elevationOffset),y=Math.min(y,l.elevationOffset),v=Math.max(v,l.elevationOffset),NF(l.elevationOffset,u),d.setData(a[E],1,u[0],u[1],u[2],u[3]);let R=l.objectAndLayerIdColor;R!=null&&d.setData(a[E],2,R[0],R[1],R[2],R[3]),l.pickable!==Hv(n.pickability,E)&&(n.pickability=h8(n.pickability,n.count,E,l.pickable))}n.verticalOffsets=S?_:null,r.offsetObb=S?IF(r.obb,y,v,this._viewingMode,r.offsetObb??r.obb.clone()):null,x||S||vd()?(s.componentParameters=new Oz,s.componentParameters.castShadows=XP(g,n.count),s.componentParameters.transparent=XP(p,n.count),s.componentParameters.opaqueOverride=XP(f,n.count),s.componentParameters.texture=d,d.updateTexture()):(s.componentParameters=new Pz,s.componentParameters.castShadows=l.castShadows?Ep.All:Ep.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(t,i,r,s=!1){t.intersectionGeometry.getComponentAabb(i,r);let n=t,o=n.components.verticalOffsets;if(s||o==null)return r;let a=o[i];if(this._viewingMode===we.Local||a===0)return r[2]+=a,r[5]+=a,r;let l=lE(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,i,r){return t.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(t,i,r,s){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||s.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);let n=t,o=n.components,a=o.count,l=o.verticalOffsets,d=n.intersectionGeometry,u=this._viewingMode===we.Local,m=d.getComponentAabbs(),p=Mte,f=1/0,g=-1/0;for(let _=0;_<a;_++){let y=6*_,v=l?.[_]??0,x=1/0,S=-1/0;if(u)x=m[y+2]+v+i,S=m[y+5]+v+i;else{if(p[0]=m[y],p[1]=m[y+1],p[2]=m[y+2],p[3]=m[y+3],p[4]=m[y+4],p[5]=m[y+5],v!==0){let D=lE(v);D.localOrigin=n.transform.position,D.applyToAabb(p)}let C=Math.max(Math.abs(p[3]),Math.abs(p[0])),E=Math.max(Math.abs(p[4]),Math.abs(p[1])),R=i+p[5]+r;s.expandElevationRangeValues(i+p[2],Math.sqrt(C*C+E*E+R*R)-r)}s.expandElevationRangeValues(x,S),f=Math.min(f,x),g=Math.max(g,S)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=f,this._elevationRangeCacheMax=g}intersect(t,i,r,s,n,o,a){let l=t,{transform:d}=l,{position:u}=d;return n!=null&&(n.localOrigin=u),l.intersectionGeometry.intersect(i,r,s,n,l.components.verticalOffsets,d,o,a)}addEdges(t,i,r,s,n){let o=t,{indices:a,positions:l}=o.intersectionGeometry,d=o.components.offsets;return i.addComponentObject(o,l,a,d,r,s,n)}extractEdgeInformation(t,i,r){return P(this,null,function*(){let s=t,n=s.components.visibility;if(n.allInvisible()){let{extractComponentsEdgeLocationsLayout:f}=yield import("./chunk-FWR34O2Z.js");return{buffer:f.createBuffer(0),origin:[0,0,0]}}let{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,{EdgeInputBufferLayout:d}=yield import("./chunk-E4KOKMQZ.js"),u=d.createBuffer(a.length/3);EF(u.position.typedBuffer,a,u.position.typedBufferStride,3),Q2(u.position,u.position,s.transform.rotationScale),this._setComponentIndices(u.componentIndex,o,l);let m=u.count,p=this._computeVisibilityIndices(o,n,l,m);return{origin:Ws(s.transform.position),buffer:yield i.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:u,writerSettings:{reducedPrecision:!1,variants:0}},r)}})}_setComponentIndices(t,i,r){let s=0;for(let n=0;n<r.length-1;n++){let o=r[n],a=r[n+1];for(let l=o;l<a;l++){let d=i?i[l]:l;t.set(d,s)}s++}}_computeVisibilityIndices(t,i,r,s){if(t&&i.allVisible())return t;let n=0;i.forEachComponentRange((l,d)=>(n+=r[d]-r[l],!0));let o=Vk(t)?new Array(n):t?.BYTES_PER_ELEMENT===2||s<=65536?new Uint16Array(n):new Uint32Array(n),a=0;return i.forEachComponentRange((l,d)=>{let u=r[l],m=r[d];for(let p=u;p<m;p++)o[a++]=t?t[p]:p;return!0}),o}addComponentHighlight(t,i,r){let s=t.components,n=s.highlightCounts,o=s.highlightGroups;n!=null&&o!=null||(n=new Uint32Array(s.count+1),s.highlightCounts=n,o=new Array(s.count+1),s.highlightGroups=o),o[i]=r,n[i]++===0&&(s.highlightsDirty(),this._notifyDirty()),n[s.count]++}removeComponentHighlight(t,i){let r=t.components,s=r.highlightCounts;if(s==null)return void w8().warn("Removing non-existing highlight.");let n=s[i];if(n===0)return void w8().warn("Removing non-existing highlight.");let o=s[r.count];if(n>1)return s[i]=n-1,void(s[r.count]=o-1);s[i]=0,r.highlightsDirty(),this._notifyDirty(),o===1?(r.highlightCounts=null,r.highlightGroups=null):s[r.count]=o-1}clearHighlights(t){let i=t.components;i.highlightCounts!=null&&(i.highlightCounts=null,i.highlightGroups=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(t,i){let r=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=es.createVertex(r,Is.STATIC_DRAW,s.vertices.data),a=s.indices?es.createIndex(r,Is.STATIC_DRAW,s.indices):null,l=In(_z(n)),d=new Uint16Array(s.vertices.count);for(let _=0;_<i.count;_++){let y=i.offsets[_],v=i.offsets[_+1],x=i.materialDataIndices[_];if(s.indices!=null)for(let S=y;S<v;S++)d[s.indices[S]]=x;else for(let S=y;S<v;S++)d[S]=x}let u=es.createVertex(r,Is.STATIC_DRAW,d.buffer),m=new Dz(t.transform,t.toMapSpace),p=new iN(r,Az,new Map([["data",l],["componentIndices",Tte]]),new Map([["data",o],["componentIndices",u]]),a),f=new zT(p,ni.TRIANGLES,n,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+u.usedMemory+(a!=null?a.usedMemory:0)};return new BT(m,f,g)}_notifyDirty(){this._renderManager.notifyDirty()}},Tte=In($n().u16(Ii.COMPONENTINDEX));function XP(e,t){return e===t?Ep.All:e===0?Ep.None:Ep.Some}var Mte=ld();var WT=class{constructor(t,i,r,s,n){this.rctx=t,this.viewingMode=i,this.stippleTextures=r,this.waterTextures=s,this.markerTextures=n}get spherical(){return this.viewingMode===we.Global}get doublePrecisionRequiresObfuscation(){return this.rctx.driverTest.doublePrecisionRequiresObfuscation.result}};var dg=class extends Pn{constructor(e){super(e),this.consumes={required:["olid"]},this.produces="olid"}destroy(){}render(e){let t=e.find(({name:r})=>r==="olid"),i=this.renderingContext;return i.bindFramebuffer(t.fbo),i.clearFramebuffer(Zs,!0,!0),this.view._stage.renderer.renderAllGeometry(K.ObjectAndLayerIdColor),i.clear(Ni.DEPTH|Ni.STENCIL),this.view._stage.renderer.renderHUD(Qn.NotOccluded),t}};c([h()],dg.prototype,"consumes",void 0),c([h()],dg.prototype,"produces",void 0),dg=c([w("esri.views.3d.webgl-engine.effects.geometry.ObjectAndLayerIDRenderNode")],dg);var cm=class extends Pn{constructor(e){super(e),this.consumes={required:[Fe.OCCLUDED]},this.produces=Fe.OCCLUDED;let t=e.view._stage.renderView.techniques;this._blit=new mw(t,mc.PremultipliedAlpha)}precompile(){let e=this.view._stage.renderer;e.plugins.plugins.forAll(t=>{e.precompileSlots(t,ne.OCCLUDED_TERRAIN,ne.TRANSPARENT_OCCLUDER_MATERIAL),t.material&&e.precompileOccludedSlots(t,x8)})}render(e){let t=e.find(({name:s})=>s===Fe.OCCLUDED),i=this.view._stage.renderer,r=0;if(jc.clear(),i.plugins.plugins.forAll(s=>{s.material&&s.queryRenderOccludedState(Br.OccludeAndTransparentStencil)&&(r|=Br.OccludeAndTransparentStencil,jc.push(s))}),jc.length>0&&(i.renderSlots(jc,ne.OCCLUDER_MATERIAL),r&Br.OccludeAndTransparentStencil&&this._renderAndComposite(t,.5,()=>i.renderSlots(jc,ne.TRANSPARENT_OCCLUDER_MATERIAL),!1,!1)),jc.clear(),i.plugins.plugins.forAll(s=>{if(!s.material)return;let n=s.queryRenderOccludedState(Br.OccludeAndTransparent),o=s.queryRenderOccludedState(Br.Transparent),a=s.queryRenderOccludedState(Br.Opaque);(n||o||a)&&(r|=n?Br.OccludeAndTransparent:o?Br.Transparent:Br.Opaque,jc.push(s))}),r|=i.plugins.renderOccludedFlags,!r)return t;for(let s of x8)r&s&&this._renderAndComposite(t,s===Br.Opaque?1:.5,()=>i.renderOccludedSlots(jc,s),!0,v0.OutlineVisualElementMask);return jc.clear(),t}_renderAndComposite(e,t,i,r,s){let n=this.renderingContext,{width:o,height:a}=e.fbo,l=this.fboCache.acquire(o,a,"tmp color"),d=r?this.fboCache.acquireDepth(ts.DEPTH_STENCIL_TEXTURE,o,a,"tmp depth"):e.getAttachment(su);l.attachDepth(d),n.bindFramebuffer(l.fbo),n.clearFramebuffer(Zs,r,s),i(),l.detachDepth(),this._blit.blend(n,l,e,this.bindParameters,t),r&&d.release(),l.release()}};c([h()],cm.prototype,"consumes",void 0),c([h()],cm.prototype,"produces",void 0),c([h({constructOnly:!0})],cm.prototype,"techniques",void 0),cm=c([w("esri.views.3d.webgl-engine.effects.geometry.RenderOccludedRenderNode")],cm);var jc=new Dt,x8=[Br.OccludeAndTransparent,Br.Transparent,Br.Opaque];var qv=class extends at{constructor(t,i,r){super(t,i,new ot(o3,()=>import("./chunk-U7YS63XO.js")),r)}initializePipeline(){return mt({blending:cl(oi.ONE,oi.ZERO,oi.ONE_MINUS_SRC_COLOR,oi.ONE),depthTest:{func:Vi.ALWAYS},colorWrite:wt})}};var $T=class extends gw{constructor(){super(...arguments),this.hazeStrength=1}},hg=class extends at{constructor(t,i,r){super(t,i,new ot(a3,()=>import("./chunk-ZCNIB4DR.js")),r)}initializePipeline(t){return t.reduced?mt({blending:lp,depthTest:{func:Vi.ALWAYS},colorWrite:wt}):mt({blending:cl(oi.ONE,oi.ZERO,oi.ONE_MINUS_SRC_COLOR,oi.ONE),colorWrite:wt})}};var Wv=class extends up{constructor(){super(...arguments),this.reduced=!1}};c([ai()],Wv.prototype,"reduced",void 0);var ZT=class extends om{constructor(e){super(e),this._compositingPassParameters=new n3,this._passParameters=new $T,this._hazeConfiguration=new Wv,this._vao=null,this.requireGeometryDepth=!0,this._oldAmount=1,this._newAmount=1,this._amount=this._newAmount;let{techniques:t}=e;t.precompile(hg,this._hazeConfiguration),t.precompile(qv),this._hazeConfiguration.reduced=!0,t.precompile(hg,this._hazeConfiguration),this._hazeConfiguration.reduced=!1}initialize(){this.addHandles([T(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Ce),T(()=>this.view._stage?.renderer.renderContext.bind.clouds.fadeFactor??1,e=>this._fade(e),Ce),T(()=>this.view.environment.weather.type,e=>this._newAmount=e==="rainy"?0:1,Ce),T(()=>this.view._stage.renderer?.fullResolutionAtmosphere,e=>this._hazeConfiguration.reduced=!e,Ce)])}_fade(e){e>=1?(this._amount=this._newAmount,this._oldAmount=this._newAmount):this._amount=e<=0?this._oldAmount:Ke(this._oldAmount,this._newAmount,e)}destroy(){this._vao=Ne(this._vao)}render(e){let t=e.find(({name:g})=>g===Fe.TRANSPARENT_ENVIRONMENT);if(!this.bindParameters.mainDepth)return t;let i=this.renderingContext;this._vao??=Qs(i,Ad.Pos2Tex);let r=this.techniques.acquire(hg,this._hazeConfiguration);if(!r.compiled)return r.release(),t;let s=t.getAttachment(i.gl.DEPTH_STENCIL_ATTACHMENT);if(this._update(),!this._hazeConfiguration.reduced)return t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(r,this.bindParameters,this._passParameters),this._renderCommon(i),t.attachDepth(s),r.release(),t;let n=this.techniques.acquire(qv);if(!n.compiled)return r.release(),n.release(),t;let o=i.getViewport(),a=this.camera,l=be(a.eye)-qs.radius,d,u=qs.atmosphereHeight;if(l<u){let g=Math.min(1,Math.max(0,l/u));d=Ke(.4,.5,g)}else{let g=Math.min(1,Math.max(0,(l-u)/(15*u)));d=Ke(.5,1,g)}let m=wd(Math.round(d*a.fullViewport[2])),p=wd(Math.round(d*a.fullViewport[3]));i.setViewport(0,0,m,p);let f=this.fboCache.acquire(m,p,"haze",dr.RGBA);return i.bindFramebuffer(f.fbo),i.clearFramebuffer([0,0,0,1],!0,!0),i.bindTechnique(r,this.bindParameters,this._passParameters),this._renderCommon(i),i.setViewport(o.x,o.y,o.width,o.height),this._compositingPassParameters.color=f.getTexture(),t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(n,this.bindParameters,this._compositingPassParameters),i.screen.draw(),t.attachDepth(s),n.release(),r.release(),f.release(),t}_renderCommon(e){this._vao!=null&&(e.bindVAO(this._vao),e.drawArrays(ni.TRIANGLE_STRIP,0,4))}_update(){let e=this.bindParameters.camera,t=ds(e.eye),i=Math.sqrt(t),r=t-this._passParameters.radii[1]*this._passParameters.radii[1],s=U((i-this._passParameters.radii[0])/qs.atmosphereHeight,0,1);So(this._passParameters.heightParameters,i,t,r,s);let n=this.view.basemapTerrain.getLowerBoundRadius();En(this._passParameters.radii,n,n+qs.atmosphereHeight),this._passParameters.hazeStrength=Ke(Ke(.6,1,tc(9500,10500,i-qs.radius)),1,this._amount)}};ZT=c([w("esri.views.3d.webgl-engine.effects.haze.Haze")],ZT);var QT=class extends M0{constructor(){super(...arguments),this.shadowColor=$s(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},$v=class extends at{constructor(t,i,r){super(t,i,new ot(l3,()=>import("./chunk-C2QOSSMR.js")),r),this.primitiveType=ni.TRIANGLE_STRIP}initializePipeline(){return mt({blending:dl,colorWrite:wt,depthTest:null,depthWrite:null})}};var Ete=1/512,Rte=4e4,Ate=5e4,Ih=class extends Pn{constructor(e){super(e),this.produces=zr.COMPOSITE,this.consumes={required:[zr.COMPOSITE,"highlights"]},this._passParameters=new QT,this._maxOpacity=1,this._shadowDifference=.2,e.techniques.precompile($v)}initialize(){this.addHandles([T(()=>this.view.highlightOptions.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??H0,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},Ce),T(()=>this.view.highlightOptions.shadowDifference,e=>{this._shadowDifference=e??j0,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},Ce),T(()=>this.view.highlightOptions.shadowColor,e=>{this._passParameters.shadowColor=Xm(e??U0),this._ensureMaxOpacity()},Ce)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_ensureMaxOpacity(){let e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3],this.requestRender(Te.UPDATE)}render(e){let t=e.find(({name:s})=>s===zr.COMPOSITE),i=this.bindParameters;if(!i.shadowHighlightsVisible||!i.depth||!this._ensureIfVisible(i.camera,i.lighting.mainLight.direction))return t;let r=this.techniques.acquire($v);if(r.compiled){this._passParameters.highlight=e.find(({name:n})=>n==="highlights")?.getTexture(),this._passParameters.origin=i.camera.center;let s=this.renderingContext;s.bindFramebuffer(t.fbo),s.bindTechnique(r,i,this._passParameters),s.screen.draw()}else this.requestRender(Te.UPDATE);return r.release(),t}_ensureIfVisible(e,t){this._passParameters.opacityElevation=1-tc(Rte,Ate,e.relativeElevation);let i=this.viewingMode===we.Global?Z(C8,e.center):ve(C8,0,0,1),r=X(i,t);return this._passParameters.dayNightTerminator=tc(0,1,U(30*r,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=Ete}};c([h()],Ih.prototype,"produces",void 0),c([h()],Ih.prototype,"consumes",void 0),c([h({constructOnly:!0})],Ih.prototype,"viewingMode",void 0),c([h({constructOnly:!0})],Ih.prototype,"techniques",void 0),Ih=c([w("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],Ih);var C8=b();var Zv=class extends at{constructor(t,i,r){super(t,i,new ot(d3,()=>import("./chunk-X2QJJAOO.js")),r)}initializePipeline(){return mt({blending:cp,depthTest:null,depthWrite:null,colorWrite:wt})}};var Gc=class extends Pn{constructor(e){super(e),this.produces=Fe.MAGNIFIER,this.consumes={required:[Fe.MAGNIFIER]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new c3,this._vao=null,this._magnifier=null,this._tmpScreenPoint=ri(),this._tmpRenderPoint=HL()}initialize(){this.addHandles([T(()=>this.view.magnifier,e=>this._update(e),Ce)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;let t=()=>{let i=this._validMagnifier;i?(this._loadResources(i),this.produces=Fe.MAGNIFIER):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(T(()=>this._magnifier?.version,t)),t()}get _validMagnifier(){return this._magnifier?.visible&&this._magnifier?.position&&this._magnifier?.size>0?this._magnifier:null}get _factor(){return this._magnifier?.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=Ne(this._vao)}_disposeTextures(){this._passParameters.mask=Ne(this._passParameters.mask),this._passParameters.overlay=Ne(this._passParameters.overlay),this._passParameters.input=Ne(this._passParameters.input)}precompile(){this._imageSources&&this.techniques.precompile(Zv)}render(e){let t=this._validMagnifier,i=e.find(({name:y})=>y===Fe.MAGNIFIER);if(t==null)return i;if(this._imageSources==null)return this.requestRender(Te.UPDATE),i;let r=this.renderingContext,s=this.camera.pixelRatio,n=Math.ceil(s*t.size);this._vao??=Qs(r,Ad.Pos2,al,0,1);let o=this.techniques.acquire(Zv);if(this._ensureTextureResources(r,n),!o.compiled||!this._passParameters.input)return o.release(),this.requestRender(Te.UPDATE),i;let a=Math.ceil(1/this._factor*n),l=this._passParameters.input;l.resize(a,a),ua(t.position,this._tmpScreenPoint);let d=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),u=this.camera.fullWidth,m=this.camera.fullHeight,p=.5*a,f=.5*a;d[0]=U(d[0],p,u-p-1),d[1]=U(d[1],f,m-f-1);let g=Math.floor(d[0]-p),_=Math.floor(d[1]-f);return r.bindFramebuffer(i.fbo),o.program.bindTexture("textureInput",l),r.gl.copyTexImage2D(l.descriptor.target,0,l.descriptor.pixelFormat,g,_,a,a,0),this._passParameters.magnifier=t,r.bindTechnique(o,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(ni.TRIANGLE_STRIP,0,4),o.release(),i}_loadResources(e){let{maskUrl:t,overlayUrl:i}=e;this._imageLoadTask?.maskUrl===t&&this._imageLoadTask?.overlayUrl===i||(this._imageLoadTask?.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:js(r=>P(this,null,function*(){let s=t==null||i==null?XV(r):null,n=t!=null?bd(t,{signal:r}):s.then(a=>a.mask),o=i!=null?bd(i,{signal:r}):s.then(a=>a.overlay);this._imageSources={mask:yield n,overlay:yield o}}))})}_ensureTextureResources(e,t){if(this._imageSources==null||this._passParameters.size===t&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=t,this._imageSources.overlay.height=this._imageSources.mask.height=t;let i=new Di;i.internalFormat=Ci.RGBA,i.wrapMode=lr.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!Pb(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new Rr(e,i,this._imageSources.overlay),i.pixelFormat=i.internalFormat=Ci.ALPHA,i.preMultiplyAlpha=!1,this._passParameters.mask=new Rr(e,i,this._imageSources.mask),i.pixelFormat=i.internalFormat=Ci.RGBA,i.flipped=!1,this._passParameters.input=new Rr(e,i)}};c([h()],Gc.prototype,"produces",void 0),c([h()],Gc.prototype,"consumes",void 0),c([h()],Gc.prototype,"_imageSources",void 0),c([h()],Gc.prototype,"_imageLoadTask",void 0),c([h({constructOnly:!0})],Gc.prototype,"techniques",void 0),Gc=c([w("esri.views.3d.webgl-engine.effects.magnifier.Magnifier")],Gc);var Qv=class extends at{constructor(t,i,r){super(t,i,new ot(h3,()=>import("./chunk-74HOEZ5V.js")),r)}initializePipeline(){return mt({colorWrite:wt})}};var Kv=class extends at{constructor(t,i,r){super(t,i,new ot(u3,()=>import("./chunk-RWZSAI2C.js")),r)}initializePipeline(){return mt({colorWrite:wt})}};var Yv=class extends at{constructor(t,i,r){super(t,i,new ot(m3,()=>import("./chunk-HPNNJ5NG.js")),r)}initializePipeline(){return mt({colorWrite:wt})}};var KT=class extends nl{};var qc=class extends Pn{constructor(e){super(e),this.produces="disabled",this.consumes={required:[Fe.ANTIALIASING],optional:[zr.COMPOSITE]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new KT,e.techniques.precompile(Yv),e.techniques.precompile(Qv),e.techniques.precompile(Kv)}initialize(){this.addHandles([T(()=>this.isEnabled(),e=>e?this.enable():this.disable(),Ce)])}enable(){return P(this,null,function*(){if(this.produces=Fe.ANTIALIASING,this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;let e=this._abortController.signal;try{let t=yield import("./chunk-Y57SXSNZ.js");yield this._loadTextures(t,e),this.requestRender(Te.UPDATE)}catch{}this._abortController=null})}_loadTextures(e,t){return P(this,null,function*(){Ut(t);let[i,r]=yield Promise.allSettled([bd(e.areaTexture,{signal:t}),bd(e.searchTexure,{signal:t})]);if(Ut(t),i.status!=="fulfilled"||r.status!=="fulfilled")return;let s=this.renderingContext;this._areaTexture=S8(s,An.LINEAR,Ci.RGB,i.value),this._searchTexture=S8(s,An.NEAREST,Ci.LUMINANCE,r.value)})}disable(){this.produces="disabled"}destroy(){this._searchTexture=Ne(this._searchTexture),this._areaTexture=Ne(this._areaTexture)}render(e){let t=e.find(({name:p})=>p===Fe.ANTIALIASING);if(!this._areaTexture||!this._searchTexture)return this.requestRender(Te.UPDATE),t;let i=this.techniques.acquire(Yv),r=this.techniques.acquire(Qv),s=this.techniques.acquire(Kv);if(!i.compiled||!r.compiled||!s.compiled)return i.release(),r.release(),s.release(),this.requestRender(Te.UPDATE),t;let n=e.find(({name:p})=>p===zr.COMPOSITE);if(!n)return t;let o=n.fbo.width,a=n.fbo.height,l=this.renderingContext;l.setViewport(0,0,o,a);let d=this.fboCache.acquire(o,a,"smaa edges",dr.RG);l.bindFramebuffer(d.fbo),l.setClearColor(0,0,0,1),l.clear(Ni.COLOR),this._smaaParameters.color=n.getTexture();let u=this.bindParameters;l.bindTechnique(i,u,this._smaaParameters),l.screen.draw(),i.release();let m=this.fboCache.acquire(o,a,"smaa blend");return l.bindFramebuffer(m.fbo),l.setClearColor(0,0,1,1),l.clear(Ni.COLOR),this._smaaParameters.inputTexture=d.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,l.bindTechnique(r,u,this._smaaParameters),l.screen.draw(),r.release(),d.release(),l.bindFramebuffer(t.fbo),l.setClearColor(0,1,0,1),l.clear(Ni.COLOR),this._smaaParameters.inputTexture=m.getTexture(),l.bindTechnique(s,u,this._smaaParameters),l.screen.draw(),s.release(),m.release(),t}};function S8(e,t,i,r){let s=new Di;return s.pixelFormat=i,s.wrapMode=lr.CLAMP_TO_EDGE,s.width=r.width,s.height=r.height,s.samplingMode=t,new Rr(e,s,r)}c([h()],qc.prototype,"produces",void 0),c([h()],qc.prototype,"consumes",void 0),c([h({constructOnly:!0})],qc.prototype,"isEnabled",void 0),c([h({constructOnly:!0})],qc.prototype,"techniques",void 0),c([h()],qc.prototype,"_abortController",void 0),qc=c([w("esri.views.3d.webgl-engine.effects.smaa.SMAA")],qc);var YT=class extends nl{constructor(){super(...arguments),this.modelMatrix=Ht()}},Xv=class extends at{constructor(t,i,r){super(t,i,new ot(p3,()=>import("./chunk-7N7CAGSB.js")),r)}initializePipeline(){return mt({blending:dl,depthTest:{func:Vi.LEQUAL},colorWrite:wt})}};var XT=class extends Vs{constructor(e){super(e),this._starData=null,this._loadDataTask=null,this._numPoints=0,this._passParameters=new YT,e.techniques.precompile(Xv)}initialize(){this.addHandles([T(()=>this.view.environment.starsEnabled,e=>e?this._enable():this._disable(),ie),T(()=>this.view.environment.lighting.type==="virtual"?null:this.view.environment.lighting.date,e=>this._update(e),Ce)])}_enable(){super._enable(),this._loadDataTask=this._createLoadDataTask()}get loading(){return!!this._loadDataTask&&!this._loadDataTask.finished}destroy(){this._loadDataTask=Er(this._loadDataTask),this._numPoints=0,this._vao=Ne(this._vao),this._starData=null}render(e){let t=e.find(({name:s})=>s===Fe.OPAQUE_ENVIRONMENT),i=this.renderingContext;if(this.loading)return this.requestRender(Te.UPDATE),t;if(!this._starData)return t;this._vao??=this._ensureResources(this._starData,i);let r=this.techniques.acquire(Xv);return r.compiled?(i.bindTechnique(r,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(ni.POINTS,0,this._numPoints),r.release(),t):(this.requestRender(Te.UPDATE),r.release(),t)}_ensureResources(e,t){return this._numPoints=e.byteLength/M8,Ite(t,new Float32Array(e,0,2*this._numPoints),new Uint8Array(e,2*this._numPoints*4,this._numPoints),this._numPoints)}_update(e){if(!e)return;let t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*Dte(e),r=od(this._passParameters.modelMatrix,Nte);d_(r,r,-i*Math.PI),Gn(r,Fte,r),d_(r,r,-t*Math.PI),this.requestRender(Te.UPDATE)}_createLoadDataTask(){if(this._starData)return null;let e=js(t=>P(this,null,function*(){let{data:i}=yield cL("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});Pte(i),this._starData=i}));return e.promise.catch(t=>{xs(t)||V.getLogger(this).error(t)}).then(()=>{this.destroyed||this.requestRender(Te.UPDATE)}),e}};function Ite(e,t,i,r){let s=T8.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){let d=t[2*l],u=t[2*l+1];n.set(l,0,-Math.cos(d)*Math.sin(u)),n.set(l,1,-Math.sin(d)*Math.sin(u)),n.set(l,2,-Math.cos(u));let m=kte(i[l]),p=Ote(Lte[m[1]]);o.set(l,0,255*p[0]),o.set(l,1,255*p[1]),o.set(l,2,255*p[2]),o.set(l,3,255),a.set(l,m[0])}return new Dn(e,al,new Map([["geometry",In(T8)]]),new Map([["geometry",es.createVertex(e,Is.STATIC_DRAW,s.buffer)]]))}function Dte(e){let t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}function Pte(e){if(!e)throw new le("stars:no-data-received","Failed to create stars because star catalogue is missing");let t=e.byteLength/M8;if(t%1!=0||t>5e4||t<5e3)throw new le("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function Ote(e){return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)]}function kte(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}XT=c([w("esri.views.3d.webgl-engine.effects.stars.Stars")],XT);var Lte=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],Fte=QM(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Nte=QM(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),M8=9,T8=$n().vec3f(Ii.POSITION).vec4u8(Ii.COLOR).f32(Ii.SIZE);var Jv=class extends at{constructor(t,i,r){super(t,i,new ot(g3,()=>import("./chunk-6KYKAPJ6.js")),r)}initializePipeline(){return mt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};var JT=class{constructor(t,i){this._rctx=t,this._techniques=i,this._configuration=new Ez,this._passParameters=new Rz,this._hudParameters=new f3,this._configuration.blitMode=mc.PremultipliedAlpha,this._techniques.precompile(Mp,this._configuration),this._configuration.hasOpacityFactor=!0,this._techniques.precompile(Mp,this._configuration),this._configuration.hasOpacityFactor=!1,this._configuration.blitMode=mc.Alpha,this._techniques.precompile(Mp,this._configuration),this._configuration.blitMode=mc.Depth,this._techniques.precompile(Mp,this._configuration),this._techniques.precompile(Jv)}compositeHUD(t,i){this._hudParameters.texture=i;let r=this._techniques.acquire(Jv);this._rctx.bindTechnique(r,t,this._hudParameters),this._rctx.screen.draw(),r.release()}compositePreMultipliedAlpha(t,i,r=1){this._composite(t,i,mc.PremultipliedAlpha,r)}composite(t,i){this._composite(t,i,mc.Alpha,1)}blitDepthToLinearDepth(t,i){this._composite(t,i,mc.Depth,1)}_composite(t,i,r,s){this._configuration.blitMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=i,this._passParameters.opacity=s;let n=this._techniques.acquire(Mp,this._configuration);this._rctx.bindTechnique(n,t,this._passParameters),this._rctx.screen.draw(),n.release()}};var e1=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new $M(new ArrayBuffer(4)),this._layerToOidToColor=new C_,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new C_,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(t,i,r,s,n,o=null,a=null,l=null){t&&i&&r&&s&&(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),n&&this._layerUidToGraphicsUidToObjectId.set(s,i,{objectId:t,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(t){let i=this.getObjectAndLayerIdColorArray(t);return $s(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(t){if(!t.layerUid||!t.graphicUid)return this.colorZero;let i=this._layerUidToPopupEnabled.get(t.layerUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;let r=this._layerUidToGraphicsUidToObjectId.get(t.layerUid,t.graphicUid)?.objectId;if(!r)return this.colorZero;let s=this._layerToOidToColor.get(t.layerUid,r);if(!s){if(Qe("enable-feature:objectAndLayerId-screenshot-testing"))s=r;else for(;!s;){let o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(t.layerUid,r,s),this._colorToUID.set(s,t)}let n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new $M(n)}getColorToObjectAndLayerIdMapping(){let t=new Map;for(let[i,r]of this._colorToUID.entries()){let s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid,r.graphicUid),n=this._layerUidToId.get(r.layerUid);s&&n&&t.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",olid:s.objectId,lid:n,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",olid:s.objectId,lid:n})}return t}};var ug=class{constructor(t,i){this.key=t,this.free=i,this.incarnation=0,this._refCount=1}retain(t=1){this._refCount+=t}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment "${this.name}" in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}},Gl;(function(e){e[e.FBO=0]="FBO",e[e.DEPTH=1]="DEPTH",e[e.COLOR=2]="COLOR"})(Gl||(Gl={}));var mg=class extends ug{constructor(t,i,r){super(t,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}};var t1=class extends mg{constructor(t,i,r){super(t,i,r),this.attachment=i,this.type=Gl.COLOR}};var eb=class extends mg{constructor(){super(...arguments),this.type=Gl.DEPTH}};function E8(e){return e?.attachment.type===tF.Texture}var tb=class extends ug{constructor(t,i,r,s,n,o){super(t,o),this.type=Gl.FBO,this._colors=new Map,this._name=zr.COMPOSITE,this.acquireDepth=null,this.acquireColor=null,this._name=i,this.fbo=r,this.acquireDepth=s,this.acquireColor=n}dispose(){this.fbo?.dispose()}get usedMemory(){return this.fbo?.usedMemory||0}get numberOfColorAttachments(){return this._colors.size}get name(){return this._name}setName(t){this._name=t}getTexture(t=pa.COLOR_ATTACHMENT0){return t===su?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(t)}getAttachment(t=pa.COLOR_ATTACHMENT0){return t===su?this._depth:this._colors.get(t)}hasAttachment(t){return Ib(this._colors,i=>i.name===t)}attachDepth(t){return t?.retain(),this.detachDepth(),t&&this.fbo?.attachDepthStencil(t.attachment),this._depth=t,this}detachDepth(){this.fbo?.detachDepthStencilTexture(),this.fbo?.detachDepthStencilBuffer(),this._depth=Hi(this._depth)}obtainDepthTexture(){let t=this._depth;return E8(t)?(this.fbo?.detachDepthStencilTexture(),this._depth=null,t):null}attachColor(t,i){return t.retain(),this.detachColor(i),this.fbo?.attachColorTexture(t.attachment,i),this._colors.set(i,t),this}detachColor(t){this.fbo?.detachColorTexture(t);let i=this._colors.get(t);this._colors.delete(t),i?.release()}detachAll(){this._colors.forEach((t,i)=>this.detachColor(i)),this.detachDepth()}};var pg=class{constructor(t,i){this._last=new Dt,this._incarnation=0,this._cache=new Yo(t,i)}destroy(){this._last?.forAll(t=>t.dispose()),this._last=null,this._cache.destroy()}set interactive(t){t&&!this._last?this._last=new Dt:t||(this._last?.forAll(i=>i.dispose()),this._last=null)}clean(){this._last?.filterInPlace(t=>!(t.incarnation<this._incarnation)||(this._cache.put(t.key,t),!1))}frame(){++this._incarnation}pop(t){if(this._last){let i=this._last.find(r=>r.key===t);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(t)}put(t){t.incarnation=this._incarnation,this._last?this._last.push(t):this._cache.put(t.key,t)}get usedMemory(){return this._last?.reduce((t,i)=>t+i.usedMemory,0)??0}};var o1=class{constructor(t){this.rctx=t,this._acquired=new Set,this._cache=new pg(t.newCache,"FBOCache"),this._depthCache=new pg(t.newCache,"DepthAttachmentCache"),this._colorCache=new pg(t.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){let t=this.debugCallback;t&&this._acquired.forEach(i=>i.type===Gl.FBO&&t(i.name,i.fbo,i.numberOfColorAttachments))}get usedMemory(){return Array.from(this._acquired.values()).reduce((t,i)=>t+("getTexture"in i?i.getTexture()?.usedMemory??0:i.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(t){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=t}acquire(t,i,r,s=dr.RGBA){let n=JP(s,t,i),o=this._cache.pop(n);if(o){o.retain(),o.setName(r);let a=this.rctx.getBoundFramebufferObject();if(this.rctx.bindFramebuffer(o.fbo),this.rctx.setDrawBuffers([pa.COLOR_ATTACHMENT0]),!o.fbo)throw new le("attempt to use a not existing framebuffer");this.rctx.unbindTexture(o.fbo.colorTexture),this.rctx.bindFramebuffer(a)}else o=new tb(n,r,new rl(this.rctx,se(I({},R8[s]),{width:t,height:i})),a=>{a??=ts.DEPTH_STENCIL_TEXTURE;let l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l,d)=>{l??=dr.RGBA;let u=this._acquireColor(l,t,i,d??`${o.name} color ${a}`);return this.rctx.unbindTexture(u.attachment),o.attachColor(u,a),u.release(),o},()=>{this.debugCallback&&this.debugCallback(o.name,o.fbo,o.numberOfColorAttachments),this._acquired.delete(o),o.detachAll(),this._cache.put(o)});return this._trackHandle(o)}acquireDepth(t,i,r,s){return this._acquireDepth(t,i,r,s)}_acquireDepth(t,i,r,s){let n=JP(t,i,r),o=this._depthCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);let a=t===ts.DEPTH_STENCIL_TEXTURE?new eb(n,new Rr(this.rctx,se(I({},A8[t]),{width:i,height:r})),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new eb(n,new sF(this.rctx,se(I({},A8[t]),{width:i,height:r})),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=s,this._trackHandle(a)}_acquireColor(t,i,r,s){let n=JP(t,i,r),o=this._colorCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);let a=new t1(n,new Rr(this.rctx,se(I({},R8[t]),{width:i,height:r})),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=s,this._trackHandle(a)}_trackHandle(t){return this._acquired.add(t),t}},ql=new tb("default","default",null,()=>ql,()=>ql,()=>{});function JP(e,t,i){return`${e}x${t}x${i}`}ql.release=()=>!1;var i1=new Di;i1.pixelFormat=Ci.RED,i1.internalFormat=dd.R8,i1.wrapMode=lr.CLAMP_TO_EDGE;var r1=new Di;r1.pixelFormat=Ci.RG,r1.internalFormat=dd.RG8,r1.wrapMode=lr.CLAMP_TO_EDGE;var s1=new Di;s1.internalFormat=dd.RGBA4,s1.dataType=tl.UNSIGNED_SHORT_4_4_4_4,s1.wrapMode=lr.CLAMP_TO_EDGE;var I8=new Di;I8.wrapMode=lr.CLAMP_TO_EDGE;var ib=new Di;ib.wrapMode=lr.CLAMP_TO_EDGE,ib.samplingMode=An.LINEAR_MIPMAP_LINEAR,ib.hasMipmap=!0,ib.maxAnisotropy=8;var rb=new Di;rb.pixelFormat=Ci.RED,rb.dataType=tl.HALF_FLOAT,rb.internalFormat=dd.R16F,rb.samplingMode=An.NEAREST;var n1=new Di;n1.dataType=tl.HALF_FLOAT,n1.internalFormat=dd.RGBA16F,n1.samplingMode=An.NEAREST;var R8={[dr.RED]:i1,[dr.RG]:r1,[dr.RGBA4]:s1,[dr.RGBA]:I8,[dr.RGBA_MIPMAP]:ib,[dr.R16F]:rb,[dr.RGBA16F]:n1},fg=new Di;fg.pixelFormat=Ci.DEPTH_STENCIL,fg.dataType=tl.UNSIGNED_INT_24_8,fg.samplingMode=An.NEAREST,fg.wrapMode=lr.CLAMP_TO_EDGE,fg.internalFormat=Ci.DEPTH24_STENCIL8;var A8={[ts.DEPTH_STENCIL_TEXTURE]:fg,[ts.DEPTH16_BUFFER]:new d0(t0.DEPTH_COMPONENT16,4)};var gg;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(gg||(gg={}));var ia=class{constructor(t,i,r=gg.FrontToBack){this._rctx=t,this._techniques=i,this._sorting=r,this._draws=new Dt({initialSize:32,allocator:s=>s??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,i,r,s,n){let o=this._draws.pushNew();o.geometry=i,o.geometryRanges=r,o.material=t,o.depthSquaredHint=s,o.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0,o.highlightGroupName=n}acquire(t,i){return this._draws.map(r=>r.material.acquireTechnique(this._techniques,t,i,r.geometry.parameters))}dispatch(t,i,r){let s=this._rctx;this._previouslyBoundDraw.clear();let n=null,o=this._draws.length;for(let a=0;a<o;a++){let l=this._draws.data[a];if(t.identifier===nw.Highlight){let{highlightGroupName:y}=l;if(y&&(i.highlightGroupIndices.get(y)??0)!==i.highlightLevel)continue}let d=r[a];d===n&&i.oitPass===hl.NONE||(s.bindTechnique(d,i,t),n=d);let{geometryRanges:u,indexType:m,geometry:p,material:f}=l;s.bindVAO(p.vao),this._previouslyBoundDraw.get(d)!==f&&(d.program.bindDraw(i,t,f),this._previouslyBoundDraw.set(d,f));let g=u.length,{primitiveType:_}=p;for(let y=0;y<g;y+=2){let v=u[y],x=u[y+1];if(m!==0){let S=a1.get(m);s.drawElements(_,x,m,v*S)}else s.drawArrays(_,v,x)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){let t=this._sorting===gg.FrontToBack?1:-1;this._draws.sort((i,r)=>{let s=t*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}},a1=new Map;a1.set(ru.UNSIGNED_BYTE,1),a1.set(ru.UNSIGNED_SHORT,2),a1.set(ru.UNSIGNED_INT,4);var l1=class extends sp{constructor(){super({}),this._passes=null,this.produces=new Map([[ne.OPAQUE_MATERIAL,e=>this._produces(e)],[ne.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[ne.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new ZB,this._shadowPassParameters=new QB,this._highlightPassParameters=new KB,this._viewshedPassParameters=new YB,this._systems=new Set}initializeRenderContext(e){this._context=e;let t=e.renderContext.rctx,i=e.techniques;this._passes={materialOpaque:new ia(t,i),materialTransparent:new ia(t,i,gg.BackToFront),materialIntegratedMesh:new ia(t,i),shadowMap:new ia(t,i),highlight:new ia(t,i),highlightIntegratedMesh:new ia(t,i),highlightShadowMap:new ia(t,i),viewshedShadowMap:new ia(t,i),defaultShadowMap:new ia(t,i)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===K.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==K.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(let t of Object.values(this._passes))t.prepareSubmit();this._systems.forEach(t=>t.submit(this._passes,e.bind));for(let t of Object.values(this._passes))t.finishSubmit();this._context.techniques.frameUpdate()}}acquireTechniques(e){if(this._systems.size===0)return null;let t=e.output===K.Shadow||e.output===K.ShadowHighlight||e.output===K.ShadowExcludeHighlight?this._shadowPassParameters:e.output===K.ViewshedShadow?this._viewshedPassParameters:e.output===K.Highlight?this._highlightPassParameters:this._materialPassParameters,i=e.bind;return this._updateParameters(i.camera,t,i.slot===ne.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(r,s)=>r.acquire(s,e.bind))}render(e,t){this._invoke(e,(i,r)=>i.dispatch(r,e.bind,t))}_invoke(e,t){if(this._passes===null)return null;switch(e.bind.slot){case ne.OPAQUE_MATERIAL:switch(e.output){case K.Color:case K.ColorEmission:case K.Depth:case K.Normal:case K.ObjectAndLayerIdColor:return t(this._passes.materialOpaque,this._materialPassParameters);case K.Highlight:return t(this._passes.highlight,this._highlightPassParameters);case K.Shadow:return t(this._passes.shadowMap,this._shadowPassParameters);case K.ShadowHighlight:return t(this._passes.highlightShadowMap,this._shadowPassParameters);case K.ShadowExcludeHighlight:return t(this._passes.defaultShadowMap,this._shadowPassParameters);case K.ViewshedShadow:return t(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case ne.TRANSPARENT_MATERIAL:switch(e.output){case K.Color:case K.ColorEmission:case K.Depth:case K.Normal:case K.ObjectAndLayerIdColor:return t(this._passes.materialTransparent,this._materialPassParameters)}break;case ne.INTEGRATED_MESH:switch(e.output){case K.Color:case K.ColorEmission:case K.Depth:case K.Normal:case K.ObjectAndLayerIdColor:return t(this._passes.materialIntegratedMesh,this._materialPassParameters);case K.Highlight:return t(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){let t=new Ah;return this._systems.forEach(i=>Ba(t,i.queryShadowCasterDepthRange(e))),t}get hasEmissions(){let e=!1;return this._systems.forEach(t=>e=t.hasEmissions||e),e}_updateParameters(e,t,i){let r=e.viewInverseTransposeMatrix;ve(eO,r[3],r[7],r[11]),tO.set(eO),G(t.transformWorldFromViewTH,tO.high),G(t.transformWorldFromViewTL,tO.low),G(t.slicePlaneLocalOrigin,eO),Zm(t.transformViewFromCameraRelativeRS,e.viewMatrix),od(t.transformProjFromView,e.projectionMatrix),t.identifier===nw.Material&&(this._materialPassParameters.transparent=i,hd(D8,t.transformViewFromCameraRelativeRS),n0(t.transformNormalViewFromGlobal,D8))}};l1=c([w("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],l1);var eO=b(),D8=un(),tO=new Iz;function P8(e){return e.name}var c1=class{constructor(t){this._context=t,this._nodes=new Dt}destroy(){this._nodes.forEach(t=>t.destroy()),this._nodes.clear()}add(t){this._nodes.push(t),KM&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}remove(t){this._nodes.remove(t),KM&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}produces(t){return this._nodes.some(({produces:i})=>i===t)}require(t,...i){let r=this._nodes,s=n=>r.reduce((o,{consumes:a,produces:l})=>o+(!a.required.includes(t)||n!=null&&l!==n?0:1),0);return i.length===0?s():i.reduce((n,o)=>n+s(o),0)}optional(t,...i){let r=this._nodes,s=n=>r.reduce((o,{consumes:a,produces:l})=>o+(!a.optional?.includes(t)||n!=null&&l!==n?0:1),0);return i.length===0?s():i.reduce((n,o)=>n+s(o),0)}updateAnimation(t){return this._nodes.reduce((i,r)=>r.updateAnimation(t)||i,!1)}precompile(...t){++this._context.techniques.precompiling;for(let i of t)this._nodes.forEach(r=>{r.produces===i&&r.precompile()});--this._context.techniques.precompiling}render(t,i,r=()=>{}){let s=t.name,n=this._nodes.filter(({produces:o})=>o===s);return n.length===0?P8(t)?t:ql:(n.forEach(o=>{let a=[t];for(let l of o.consumes.required){if(l===s)continue;let d=i.get(l);if(d)a.push(d);else if(l!=="emissive"||!i.get(s)?.hasAttachment(l))return void(r&&r(a))}if(o.consumes.optional)for(let l of o.consumes.optional){if(l===s)continue;let d=i.get(l);d&&a.push(d)}try{let l=o.doRender(a);l&&l!==t&&(s!==l.name&&(V.getLogger(o).errorOnce(`RenderNode produced ${l.name}, expected ${s}`),l.setName(s)),t.release(),t=l,i.set(s,t))}catch(l){V.getLogger(o).errorOnce(l)}r&&r(a)}),this._context.rctx.enforceState(),t)}requireGeometryDepth(){return this._nodes.some(t=>t.produces!=="disabled"&&t.requireGeometryDepth)}get test(){return{nodes:this._nodes}}};var d1=class{constructor(t){this.context=t,this._renderPlugins=new Dt,this._slots=new Array,this._version=To(0);for(let i=0;i<ne.MAX_SLOTS;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(t=>t.destroy()),this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(t,i){let r=()=>{if(i?.aborted)throw t.uninitializeRenderContext(),cs();this._renderPlugins.push(t),t.produces.forEach((n,o)=>this._slots[o].push(t)),this.context.requestRender(),this._version.value++},s=t.initializeRenderContext(this.context,i);if(Za(s))return s.then(r);r()}remove(t){this._renderPlugins.removeUnordered(t),t.uninitializeRenderContext();for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==t);this.context.requestRender(),this._version.value++}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this.context.renderContext)})}updateAnimation(t){let i=!1;return this._renderPlugins.forAll(r=>i=r.updateAnimation?.(t)||i),i}renderFeatureChanged(){this._renderPlugins.forAll(t=>{t.renderFeatureChanged&&t.renderFeatureChanged()})}precompile(...t){++this.context.techniques.precompiling;let i=this.context.renderContext.bind.slot;for(let r of t)this.context.renderContext.bind.slot=r,this._slots[r].forEach(s=>{s.produces.get(r)?.(this.context.renderContext.output)&&s.precompile(this.context.renderContext)});this.context.renderContext.bind.slot=i,--this.context.techniques.precompiling}_acquireRenderables(){let t=this.context.renderContext.bind.slot,i=this.context.renderContext.output??K.Color,r=new Map;return this._slots[t].forEach(s=>{if(!s.produces.get(t)?.(i)||s.isDecoration&&!this.context.renderContext.bind.decorations)return;let o=s.acquireTechniques(this.context.renderContext);o&&r.set(s,o)}),r}render(t,...i){for(let r of i)this.context.renderContext.bind.slot=r,this._acquireRenderables().forEach((s,n)=>{n.render(this.context.renderContext,s,t),x0(s)})}queryDepthRange(t){let i=new Ah;return this._renderPlugins.forAll(r=>{let s=r.queryDepthRange?.(t);Ba(i,s)}),i}get updating(){return this._version.value>=0&&this._renderPlugins.some(t=>t.running)}produces(t,...i){for(let r of i)if(this._slots[r].some(s=>{let n=s.produces.get(r);return!!n&&n(t)}))return!0;return!1}consumes(t){return this._renderPlugins.some(i=>i.consumes().required.includes(t))}get hasDecorations(){return this._renderPlugins.some(t=>t.isDecoration)}get hasOccludees(){return this._renderPlugins.some(t=>t.hasOccludees)}get hasEmissions(){return this._renderPlugins.some(t=>t.hasEmissions)}get renderOccludedFlags(){return this._renderPlugins.reduce((t,i)=>t|i.renderOccludedFlags,Br.None)}get usedMemory(){return this._renderPlugins.reduce((t,i)=>i.material?t:t+(i.usedMemory??0),0)}get test(){}};var sb=class extends at{constructor(t,i,r){super(t,i,new ot(y3,()=>import("./chunk-MISU3GET.js")),r)}initializePipeline(){return mt({blending:dl,colorWrite:wt})}};var h1=class{constructor(t){this._techniques=t,this._parameters=new _3,t.precompile(sb)}blend(t,i,r,s){this._parameters.colorTexture=i.getTexture(),this._parameters.alphaTexture=i.getTexture(pa.COLOR_ATTACHMENT1),this._parameters.frontFaceTexture=r.getTexture();let n=this._techniques.acquire(sb);t.bindTechnique(n,s,this._parameters),t.screen.draw(),n.release()}};var u1=class{constructor(t,i){this._camera=t,this._dt=0,this._time=0,this._lastUpdate=0,this._lastUpdate=i,this._time=i}advance(t,i,r){let s=i-this._lastUpdate;this._dt=s/r,this._time=this._time+s,this._lastUpdate=i,this._camera=t}forceTime(t){this._lastUpdate=this._time=t,this._dt=0}get camera(){return this._camera}get dt(){return this._dt}get time(){return this._time}};var m1=class{constructor(){this._step=L8,this._dilation=1,this._firstIdleTime=0}frame(t,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,Qe("disable-feature:high-quality-idle"))this._dilation=1;else{let s=i?performance.now()-this._firstIdleTime:0;if(s>=O8+Bte)return this._step=1/0,void(this._dilation=1);this._dilation=s>=O8?zte:1}let r=U(t/Vte,L8,Hte);this._step===1/0?this._step=r:this._step=this._step*k8+r*(1-k8)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}},Vte=.5,O8=12e4,Bte=1e4,zte=10,k8=.9,Ute=30,L8=1e3/1,Hte=1e3/Ute;var jte=1e4,sO=100,Gte=500,qte=500,Wte=.1;function V8(e,t,i){let r=0;if(!t.some(n=>!!n.material&&(r+=n.numGeometries,r>=jte)))return Xte.compute(e,t);let s=am();return i.forAll(n=>Ba(s,$te(e,n))),s}function $te(e,t){if(!t.visible)return;let i=am(),r=t.getSpatialQueryAccelerator();return r?Zte(i,e,r):Qte(i,e,t.objects),i}function Zte(e,t,i){let r=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.visible,a=i.objectCount;if(a<Gte)cg(ra,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,s,yd.DepthOrder.FRONT_TO_BACK,ra,(l,d)=>{nO(e,t,l),ra.far=e.near,d.setRange(ra)},n,o),cg(ra,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,s,yd.DepthOrder.BACK_TO_FRONT,ra,(l,d)=>{nO(e,t,l),ra.near=e.far,d.setRange(ra)},n,o);else{let l=Math.max(Math.min(a,qte),Math.ceil(a*Wte)),d=i.findClosest(s,yd.DepthOrder.FRONT_TO_BACK,n,o,l),u=i.findClosest(s,yd.DepthOrder.BACK_TO_FRONT,n,o,l);d&&u&&(F8(e,t,d.boundingVolumeWorldSpace.bounds),F8(e,t,u.boundingVolumeWorldSpace.bounds))}}function Qte(e,t,i){_g.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&_g.add(r)}),_g.empty||(_g.sort(t),cg(ra,t.near,Math.min(e.near,t.far)),_g.forEachInDepthRange(ra,yd.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<e.near&&nO(e,t,r)}),cg(ra,Math.max(e.far,t.near),t.far),_g.forEachInDepthRange(ra,yd.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{e.far=Math.max(e.far,n)}))}function nO(e,t,i){if(!i.visible||!w_(t.frustum,i.boundingVolumeWorldSpace.bounds))return;let r=i.transformation,s=Yte;i.geometries.forEach(n=>{Gn(s,r,n.transformation);let o=f0(s);B8(e,t,n.boundingInfo,s,o)})}function B8(e,t,i,r,s){if(i==null)return;fi(on,i.center,r);let{eye:n,viewForward:o}=t,a=o[0]*(on[0]-n[0])+o[1]*(on[1]-n[1])+o[2]*(on[2]-n[2]);if(on[3]=i.radius*s,!(a-on[3]>e.near&&a+on[3]<e.far)&&w_(t.frustum,on))if(i.radius>sO&&i.getChildren())for(let l of i.getChildren())B8(e,t,l,r,s);else cO.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function F8(e,t,i){let r=t.eye,s=t.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];e.near=Math.min(e.near,n-i[3]),e.far=Math.max(e.far,n+i[3])}var oO=class{constructor(){this._items=new Dt({allocator:t=>t||{object:null,distance:0,near:0,far:0},deallocator:t=>(t.object=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().object=t}sort(t){let i=t.eye,r=t.viewForward;this._items.forAll(s=>{let n=s.object.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,i,r){if(i===yd.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){let n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){let n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.object,n.near,n.far)}}},aO=class{constructor(){this._view=Ht(),this._viewProj=Ht(),this._frustum=v_(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(t,i){this._reset(),od(this._view,t.viewMatrix),Gn(this._viewProj,t.projectionMatrix,this._view),b_(this._frustum,t.frustum);let r=this._view,s=r[2],n=r[6],o=r[10],a=r[14];i.forAll(p=>{p.forEachGeometry(f=>{if(!f.visible||!f.castShadow)return;let g=f.boundingSphere,_=s*g[0]+n*g[1]+o*g[2]+a,y=_-g[3],v=_+g[3];this._geometries.push(f),this._near.push(-v),this._far.push(-y)})});let l=new Ah;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);let d=this._looseRange;d.near=Math.max(.5*l.near,2),d.far=2*l.far;let u=0,m=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=d.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=d.far?l.far=this._far[p]:this._farCandidates[m++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,f)=>this._near[p]<this._near[f]?-1:this._near[p]>this._near[f]?1:0),this._farCandidates.sort((p,f)=>this._far[p]<this._far[f]?1:this._far[p]>this._far[f]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){let f=this._nearCandidates[p];if(this._near[f]<l.near){let g=this._geometries[f],_=g.boundingInfo;this._includeNearBoundingInfoRec(_,g.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){let f=this._farCandidates[p];if(this._far[f]>l.far){let g=this._geometries[f],_=g.boundingInfo;this._includeFarBoundingInfoRec(_,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(t,i,r){if(t==null)return;let s=t.center;fi(on,s,i);let n=f0(i),o=on[0],a=on[1],l=on[2],d=t.radius*n,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>d||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>d||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>d||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>d)return;let m=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=m+d;if(!(-(m-d)<2||-p>=r.near))if(-p>this._looseRange.near)r.near=-p;else{if(d>sO){let f=t.getChildren();if(f!==void 0){for(let g of f)this._includeNearBoundingInfoRec(g,i,r);return}}cO.unionDepthRangeWithAABB(r,this._viewProj,i,t.bbMin,t.bbMax)}}_includeFarBoundingInfoRec(t,i,r){if(t==null)return;let s=t.radius,n=t.center;fi(on,n,i);let o=f0(i),a=on[0],l=on[1],d=on[2];s*=o;let u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*d+u[0][3]>s||u[1][0]*a+u[1][1]*l+u[1][2]*d+u[1][3]>s||u[2][0]*a+u[2][1]*l+u[2][2]*d+u[2][3]>s||u[3][0]*a+u[3][1]*l+u[3][2]*d+u[3][3]>s)return;let m=this._view[2]*a+this._view[6]*l+this._view[10]*d+this._view[14]-s;if(!(-m<=r.far))if(-m<this._looseRange.far)r.far=-m;else{if(s>sO){let p=t.getChildren();if(p!==void 0){for(let f of p)this._includeFarBoundingInfoRec(f,i,r);return}}cO.unionDepthRangeWithAABB(r,this._viewProj,i,t.bbMin,t.bbMax)}}},lO=class{constructor(){this._modelViewProj=Ht(),this._clipPosition=[br(),br(),br(),br(),br(),br(),br(),br()]}unionDepthRangeWithAABB(t,i,r,s,n){let o=this._modelViewProj;Gn(o,i,r);let a=!1;for(let l=0;l<8;++l){let d=this._clipPosition[l],u=l===0||l===3||l===4||l===7?s[0]:n[0],m=l===0||l===1||l===4||l===5?s[1]:n[1],p=l<4?s[2]:n[2];d[0]=o[0]*u+o[4]*m+o[8]*p+o[12],d[1]=o[1]*u+o[5]*m+o[9]*p+o[13],d[2]=o[2]*u+o[6]*m+o[10]*p+o[14],d[3]=o[3]*u+o[7]*m+o[11]*p+o[15]}for(let l=0;l<12;++l){let d=Kte(this._clipPosition[rO[l][0]],this._clipPosition[rO[l][1]],this._clipPosition[rO[l][2]]),u=!0;for(let m=0;m<d.length;++m)if(d[m][3]>=2){u=!1;break}if(!u){a=!0;for(let m=0;m<d.length;++m){let p=d[m][3];Number.isFinite(p)&&(t.near=Math.min(p,t.near),t.far=Math.max(p,t.far))}}}return a}};function Kte(e,t,i){let r=[e,t,i];for(let s=0;s<4;++s){let n=r;r=[];for(let o=0;o<n.length;++o){let a=n[o],l=n[(o+1)%n.length];iO(l,s)?(iO(a,s)||r.push(N8(a,l,s)),r.push(l)):iO(a,s)&&r.push(N8(a,l,s))}}return r}function iO(e,t){return t===0?e[0]>=-e[3]:t===1?e[1]>=-e[3]:t===2?e[0]<=e[3]:t===3?e[1]<=e[3]:void us(!1)}function N8(e,t,i){let r=0;return i===0?r=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):i===1?r=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):i===2?r=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):i===3&&(r=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),v2(br(),e,t,r)}var rO=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],on=Nr(),Yte=Ht(),ra=am(),_g=new oO,Xte=new aO,cO=new lO;var p1=class{constructor(t){this._fbos=t,this._requiresEmission=!1,this._size=new cz(0,0),this._clearColor=br()}dispose(){this._color=Hi(this._color),this.releaseDepth()}initialize(t,i,r,s){this._size.width=t,this._size.height=i,Ym(this._size,this._fbos.rctx.parameters.maxTextureSize);let n=this._color;return this._color=null,this.releaseDepth(),this._requiresEmission=s,Hm(this._clearColor,r),n}releaseDepth(){this._color?.detachDepth(),this._depth=Hi(this._depth)}update(t){let i=this._ensureColor();i.attachDepth(this.depth),this._color=t(i)}bind(){let t=this._color==null;if(this.color.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(this.color.fbo),t){let i=this._fbos.rctx;i.setClearStencil(0),i.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),i.clear(Ni.COLOR|Ni.DEPTH|Ni.STENCIL),this._requiresEmission&&i.gl.clearBufferfv(i.gl.COLOR,1,LV)}}_acquireColor(){return this._requiresEmission?this._fbos.acquire(this._size.width,this._size.height,"acquired-color").acquireColor(pa.COLOR_ATTACHMENT1,dr.RGBA,"emissive"):this._fbos.acquire(this._size.width,this._size.height,"acquired-color")}_acquireDepth(){return this._fbos.acquireDepth(ts.DEPTH_STENCIL_TEXTURE,this._size.width,this._size.height,"depth")}get size(){return this._size}get color(){return this._ensureColor()}get depth(){return this._depth??=this._acquireDepth(),this._depth}_ensureColor(){return this._color??=this._acquireColor(),this._color}};var f1=class{constructor(){this._inputs=new Map}set(t,i){this._inputs.set(t,i)}get(t){return this._inputs.get(t)}has(t){return this._inputs.has(t)}release(t){this._inputs.get(t)?.release()&&this._inputs.delete(t)}};var nb=class extends at{constructor(t,i,r){super(t,i,new ot(C3,()=>import("./chunk-34VGJFIQ.js")),r),this.primitiveType=ni.TRIANGLE_STRIP}initializePipeline(){return mt({blending:dl,colorWrite:wt,depthTest:null,depthWrite:null})}};var z8=4e4,U8=5e4,dO=1/512,ob=class extends k{constructor(e,t,i,r){super({}),this._techniques=e,this._rctx=t,this._data=i,this._requestRender=r,this._passParameters=new x3(this._data),this._configuration=new w3,this._enabled=!1,this._vao=Qs(t)}dispose(){this._stop(),this._vao=Ne(this._vao)}precompile(){this._showVisualization&&this._techniques.precompile(nb,this._configuration)}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;let t=this._techniques.acquire(nb,this._configuration);this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,e,this._passParameters),this._rctx.drawArrays(t.primitiveType,0,fa(this._vao,"geometry")),t.release()}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>dO}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfEnabled())}get _visualization(){return this._configuration.visualization}set _visualization(e){e!==this._visualization&&(this._configuration.visualization=e,this._requestRenderIfEnabled())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfEnabled())}get _bandsEnabled(){return this._configuration.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._configuration.bandsEnabled=e,this._requestRenderIfEnabled())}_setColor(e){let t=this._passParameters.color;b2(e,t)||(Hm(this._passParameters.color,e),this._requestRenderIfEnabled())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};c([h()],ob.prototype,"opacityFromElevation",null),ob=c([w("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],ob);var ab=class extends at{constructor(t,i,r){super(t,i,new ot(b3,()=>import("./chunk-PVLWL62K.js")),r),this.primitiveType=ni.TRIANGLE_STRIP}initializePipeline(){return mt({blending:nN,colorWrite:wt,depthTest:null,depthWrite:null})}};var an=class extends k{constructor(e,t,i,r,s,n){super({}),this.fbos=e,this._techniques=t,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new M0,this._cachedLightDirections=[],this._depthRange=Gv,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new aw(new lw(e,i.viewingMode)),this._bindParameters.shadowMap.enabled=!0,this._vao=Qs(this._rctx),this._accumulationRenderer=new ob(t,this._rctx,this,n);let o=this._stage.view.resourceController.scheduler;this.addHandles([o.registerTask(si.SHADOW_ACCUMULATOR,this),T(()=>i.renderView,a=>{this.removeHandles(H8),a!=null&&this.addHandles(a.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),H8)},Ce),T(()=>this._previewing,()=>this._requestRenderIfEnabled(),Re)],this._shadowAccumulatorKey),t.precompile(ab)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=Ne(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Ne(this._fbo),this._vao=Ne(this._vao),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==Gv&&this._opacityFromElevation>dO}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){let t=this._cachedLightDirections;if(xb(t,e,cd))return;let i=Math.min(v3,e.length);t.length=i,this._sampleCount=i;for(let r=0;r<i;++r)t[r]=G(t[r]??b(),e[r]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return!1;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();let s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(Jte,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();return this._cameraForcedForScreenshot=!1,this._requestRender(),s>0}precompile(){this._accumulationRenderer.precompile()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){let t=this._fbo!=null;e.enabled!==t&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,t){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||t<0||t>=this._fbo.height?0:(this._fbo.readPixels(e,t,1,1,Ci.RGBA,tl.UNSIGNED_BYTE,j8),j8[0]/this._progress)}_enable(){this._progress=0;let e=new Di;e.pixelFormat=Ci.RED,e.internalFormat=dd.R8,e.wrapMode=lr.CLAMP_TO_EDGE,this._fbo=new rl(this._rctx,e),this._requestRender()}_disable(){this._fbo=Ne(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(Ni.COLOR),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);let e=this._techniques.acquire(ab);this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,fa(this._vao,"geometry")),e.release()}_updateCamera(e){let t=this._fbo;if(t==null)return;let i=this._bindParameters.camera;e.equals(i)||i.copyFrom(e),t.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-tc(z8,U8,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};c([h()],an.prototype,"_progress",void 0),c([h()],an.prototype,"_sampleCount",void 0),c([h()],an.prototype,"_fbo",void 0),c([h()],an.prototype,"_depthRange",void 0),c([h()],an.prototype,"_previewing",void 0),c([h()],an.prototype,"_accumulationRenderer",void 0),c([h()],an.prototype,"_isRefining",null),c([h()],an.prototype,"_isActive",null),c([h()],an.prototype,"canAccumulate",null),c([h()],an.prototype,"_isDoneAccumulating",null),c([h()],an.prototype,"_opacityFromElevation",null),c([h()],an.prototype,"running",null),an=c([w("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],an);var Jte=6,H8="renderView",j8=new Uint8Array(4);var eie=S_(),g1=class{constructor(){this._plane=S_()}get plane(){return this._plane}set plane(t){np(t||eie,this._plane)}};function G8(e,t){let i=e.capabilities.disjointTimerQuery;return i==null?null:new hO(i,t)}var hO=class{constructor(t,i){this._timer=t,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{let s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){FV||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(t){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(t))return this.abort(),null;this._timer.endTimeElapsed();let i=this._queryResults.get(t);if(i==null)return this._queryResults.set(t,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;let r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(t,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(t=>{this._timer.deleteQuery(t)}),this._queryResults.forEach(t=>{t!=null&&this._timer.deleteQuery(t)})}};var Xi;(function(e){e.OVERLAY="overlay",e.PREPARE="prepare",e.SHADOW_MAP="shadow map",e.DEPTH="depth",e.ACCUMULATED_SHADOWS="accumulated shadows",e.APPLY_ACCUMULATED_SHADOWS="apply accumulated shadows",e.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",e.NORMALS="normals",e.SSAO="SSAO",e.HIGHLIGHTS="highlights",e.OPAQUE_EDGES="opaque edges",e.VOXEL="voxel",e.TRANSPARENT="transparent",e.TRANSPARENT_EDGES="transparent edges",e.HUD_VISIBILITY="HUD visibility",e.TRANSPARENT_TERRAIN="transparent terrain",e.TRANSPARENT_MATERIAL_WITHOUT_DEPTH="transparent material without depth",e.OPAQUE_ENVIRONMENT="opaque environment",e.TRANSPARENT_ENVIRONMENT="transparent environment",e.OCCLUDED="occluded",e.HUD="HUD",e.HUD_OCCLUDED="HUD occluded",e.FINISH="finish"})(Xi||(Xi={}));var uO=Object.values(zr).concat(Object.values(Fe)).concat(Object.values(Xi)),q8="Total",_1=class{constructor(t){this._rctx=t,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Xg(q8),this._cpuTimeSamplers=new Map(uO.map(i=>[i,new Xg(i)])),this._enableGPUTimer=0,this._totalGPUTime=new Xg("GPU"),this._gpuTimeSamplers=new Map(uO.map(i=>[i,new Xg(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){let i=[...uO,q8];this._gpuTimerPool=G8(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let t=!1;return{hasGPUTimerSupport:!0,remove:()=>{t||(t=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Ne(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&(this._gpuTimeSamplers.forEach(t=>t.push(0)),this._gpuTimerPool.start())}advance(t){let i=performance.now();if(this._cpuTimeSamplers.get(t).push(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){let r=this._gpuTimerPool.stop(t);this._gpuTimeSamplers.get(t).set(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){let i=this._gpuTimerPool.stop(Xi.FINISH);this._gpuTimeSamplers.get(Xi.FINISH).set(i),this._rctx.gl.flush()}let t=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+t,this._totalCPUTime.push(t),this._gpuTimerPool&&this._totalGPUTime.push(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}};var dm=class{constructor(t,i,r,s,n,o){this._stage=t,this._techniques=r,this._rctx=s,this._compositingHelper=n,this._requestRender=o,this._pluginsHas={hudElements:!1,water:!1},this._renderers=new Map,this.renderPassManager=new l1,this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=$s(0,0,0,1),this._sliceHelper=new g1,this._blit=null,this._oitblend=null,this._state=To(Fi.IDLE),this._highQualityTransparencyEnabled=!0,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new m1,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=To(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new f1,this._releaseNormals=a=>{a.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new o1(s),this._renderStateFeatures=To(UE(!Qe("disable-feature:high-quality-idle"),t.view.qualityProfile)),this._framebuffer=new p1(this.fboCache),this.performanceInfo=new _1(this._rctx),this._shadowMap=new lw(this.fboCache,t.viewingMode),this._shadowAccumulator=new an(this.fboCache,r,t,a=>{let l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(a.camera,a.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(a,l,d)=>{let u=this._stage.view.qualitySettings.maximumPixelRatio;a.shadowMap.start(a.camera,l,d,!0,u),this._renderShadowCascades(K.Shadow,a.shadowMap),a.shadowMap.finish(),a.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(a.camera,a.contentCamera)},o),this._renderContext=new dz(this._rctx,this._shadowMap,r),this._nodes=new c1(this._renderContext),this._plugins=new d1({renderContext:this._renderContext,techniques:r,materials:i,requestRender:o,controller:t,fbos:this.fboCache,isFeatureEnabled:a=>this.isFeatureEnabled(a)}),this._plugins.add(this.renderPassManager),this._handles=[T(()=>this._stage.view.state.camera,()=>o(),Ce),T(()=>Vr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,a=>{this._renderHiddenTransparentEdges=a?()=>this._renderEdges(lu.TRANSPARENT):()=>{},o()},ie),T(()=>this._stage.view.environment.background?.color,a=>{let l=a?Xm(a):Zs;So(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),o()},Ce),T(()=>this._stage.view.state.camera.relativeElevation,a=>this._inGlobeView=(a??1/0)>=5e5,Ce),T(()=>this._bindParameters.clouds.fadeFactor,()=>this._bindParameters.fadeLighting(),Re),T(()=>this._bindParameters.clouds.data?.state,()=>this._requestRender(Te.UPDATE),Re)]}destroy(){this._handles.forEach(t=>t.remove()),this._gpuTimerHandle=Nt(this._gpuTimerHandle),this._nodes.destroy(),this._framebuffer.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=Er(this._loadEdgeViewTask),this._edgeView=z(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),this._renderers.clear(),this._blit=null,this._oitblend=null,bN.prune()}get renderContext(){return this._renderContext}get _bindParameters(){return this._renderContext.bind}get _framebufferSize(){return this._framebuffer.size}updateRenderFeatures(t=null,i=!Qe("disable-feature:high-quality-idle")){this._renderStateFeatures.value=UE(i,t),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(t,i=this._state.value){return this._renderStateFeatures.value.get(i,t)??!1}setFeatureEnabled(t,i,r){this._renderStateFeatures.mutate(s=>s.set(i,t,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Oo.HighQualityTransparency)}get hasReflections(){return this._pluginsHas.water&&(this._ssrEnabled||this.isFeatureEnabled(Oo.WaterReflection))}get hasHighlights(){return this._plugins.produces(K.Highlight,ne.OPAQUE_MATERIAL,ne.TRANSPARENT_MATERIAL,ne.DRAPED_MATERIAL,ne.HUD_MATERIAL,ne.LABEL_MATERIAL)}get hasHighlightsOnHUD(){return this._plugins.produces(K.Highlight,ne.HUD_MATERIAL,ne.LABEL_MATERIAL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(Oo.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(Oo.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Oo.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=Hi(this._bindParameters.ssr.lastFrameColor),this._bindParameters.terrainDepth=Hi(this._bindParameters.terrainDepth),this._bindParameters.geometryDepth=Hi(this._bindParameters.geometryDepth)}_disposeOffscreenBuffers(){this._framebuffer.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=Hi(this._bindParameters.depth),this._bindParameters.hudVisibility=Hi(this._bindParameters.hudVisibility)}get updating(){return this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=js(t=>P(this,null,function*(){let{EdgeView:i}=yield import("./chunk-LC5SRMTT.js");Ut(t);let r=this._edgeView=new i({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:sie(this._stage.view.resourceController)});return this._handles.push(T(()=>r.updating,()=>this._requestRender(),Re)),this._requestRender(),this._edgeViewCallbacks.forEach(s=>s(r)),this._edgeViewCallbacks.length=0,r}))),this._loadEdgeViewTask.promise}withEdgeView(t){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(t):t(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&e2(this._bindParameters.ssr.reprojectionMatrix,ud)}set _reprojectionMatrix(t){Nk(this._bindParameters.ssr.reprojectionMatrix,t)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(t){let{_shadowMap:i,_bindParameters:r}=this;if(t.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==t.qualitySettings.reflections&&(this._ssrEnabled=t.qualitySettings.reflections,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&i.maxCascades!==t.shadowMapMaxCascades&&(i.maxCascades=t.shadowMapMaxCascades,this._requestRender()),t.environment!=null){t.environment.weather!=null&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible);let s=t.environment.lighting.type!=="virtual";r.enableFillLights!==s&&(r.enableFillLights=s,this._requestRender())}t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.shadowCast!==void 0&&this._shadowAccumulator.setOptions(t.shadowCast)}set slicePlane(t){this._sliceHelper.plane!==t&&(this._sliceHelper.plane=t,this._requestRender())}get plugins(){return this._plugins}getMaterialRenderer(t){return this._renderers.get(t)}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,i){this._isRendering&&console.warn("Renderer.modify called while rendering");let{adds:r,removes:s,updates:n}=t;r.length===0&&s.length===0&&n.length===0||(QF(t).forEach((o,a)=>{if(i.done)return;let l=this._renderers.get(a);l==null&&o.adds.length>0&&(l=new ZF({material:a}),l.initializeRenderContext(this._plugins.context),this._plugins.add(l),this._renderers.set(a,l)),l&&(l.modify(o),l.numGeometries===0&&(this._renderers.delete(l.material),this._plugins.remove(l),l.destroy())),o.removes.forEach(d=>t.removes.removeUnordered(d)),o.adds.forEach(d=>t.adds.removeUnordered(d)),o.updates.forEach(d=>t.updates.removeUnordered(d)),i.madeProgress()}),this.updateHasFlags())}updateHasFlags(){let t=this._pluginsHas;t.hudElements=this._plugins.produces(K.Color,ne.LINE_CALLOUTS_HUD_DEPTH,ne.HUD_MATERIAL,ne.LABEL_MATERIAL),t.water=this._plugins.produces(K.Normal,ne.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees,this._requestRender()}updateAnimation(t,i){this._animationTimer??=new u1(t.camera,i),this._animationTimer.advance(t.camera,i,this._animationTimeDilation),t.forcedAnimationTime!=null&&this._animationTimer.forceTime(t.forcedAnimationTime);let r=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(this._animationTimer),this._hasAnimations=this._nodes.updateAnimation(this._animationTimer)||this._hasAnimations,this._hasAnimations=this.overlay?.updateAnimation(this._animationTimer)||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?Nt(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get _animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(t,i,r=Eo.Default,s=!1){try{return this._isRendering=!0,this._render(t,i,r,s)}catch(n){console.error(`Exception during rendering: ${n}`)}finally{this._isRendering=!1}return new xv(this._pluginInput.get("final-color"),null)}_render(t,i,r=Eo.Default,s){this.performanceInfo.startFrame(),this.fboCache.frameStart(),this.fboCache.interactive=r===Eo.Default,this._disposeBindBuffers();let n=this._framebuffer,{camera:o,contentCamera:a,mode:l,alignPixelEnabled:d}=t;this._state.value=l,this._bindParameters.overlay=this.overlay?.render(i),this._bindParameters.overlay&&this.performanceInfo.advance(Xi.OVERLAY),this._renderContext.time=i,this._bindParameters.oitPass=hl.NONE,this._bindParameters.alignPixelEnabled=d,this._bindParameters.decorations=!s,this._bindParameters.mainDepth=null,this._bindParameters.viewshedEnabled=this._nodes.produces(Fe.VIEWSHED);let u=this._nodes.produces("magnifier-color"),m=this._nodes.produces("final-color");this._bindParameters.slicePlane=this._sliceHelper.plane,o.setGLViewport(this._rctx);let p=this._nodes.require("emissive")>0&&this._plugins.hasEmissions,f=p?K.ColorEmission:K.Color,g=n.initialize(o.fullWidth,o.fullHeight,this._backgroundColor,p);this.hasReflections?(g?.setName("last frame color"),this._bindParameters.ssr.lastFrameColor=g):g?.release(),this._ensureBindParametersCamera(o,a),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&!s;let _=this._highQualityTransparency&&this._needsTransparentTerrain,y=this._plugins.produces(K.Color,...lb);this._precompilePrepasses(),this.performanceInfo.advance(Xi.PREPARE);let v=this._computeDepthRange(o);this._renderShadowMap(o,this._bindParameters.lighting.mainLight.direction,v),this._ensureBindParametersCamera(o,a),this._pluginInput.set("normals",this._renderNormals()),this._renderRemainingGeometryDepth(),this._renderShadowAccumulation(v,o,a),this._ensureBindParametersSSR(i),this._precompileShaders(_,y,f),this._renderContext.output=f,n.bind(),this._bindParameters.mainDepth=n.depth.attachment;let x=this.plugins.produces(K.Color,...mO);x&&this._renderOpaqueGeometry(),n.update(B=>this._renderNodes(zr.OPAQUE,B,x)),this.fboCache.debugCallback?.("opaque-color",n.color.fbo),n.update(B=>this._renderNodes(Fe.OPAQUE_ENVIRONMENT,B)),this.fboCache.debugCallback?.(Fe.OPAQUE_ENVIRONMENT,n.color.fbo),this._renderTerrainDepth(_),this._setMultipassTerrain(_),this._renderEdges(lu.OPAQUE),n.bind(),this._renderPlugins(ne.VOXEL,Xi.VOXEL),this._renderHiddenTransparentEdges(),y&&(this._oitEnabled?this._renderOIT(vg.Geometry,f):this._renderTransparentGeometry()),n.update(B=>this._renderNodes(zr.TRANSPARENT,B,y)),this.fboCache.debugCallback?.("transparent-color",n.color.fbo),this._renderGeometryDepth(_),this._renderHUDVisibility(),_||this._plugins.render(this._pluginInput,ne.LINE_CALLOUTS);let S=r===Eo.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this._renderEdges(lu.TRANSPARENT);let C=this._needsTransparentTerrain?this._renderTransparentTerrain():null;C&&(this.performanceInfo.advance(Xi.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(_?this._renderLineCallouts(Qn.Occluded):(this._rctx.bindFramebuffer(this._bindParameters.hudVisibility?.fbo),this._compositingHelper.compositeHUD(this._bindParameters,C.getTexture())),this._renderHUD(Qn.Occluded,n.color,f))),this._cullAboveTerrain(!1),C&&(n.bind(),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,C.getTexture()),C.release(),_&&(this._renderEdges(lu.OPAQUE),y&&(this._oitEnabled?this._renderOIT(vg.Geometry,f):this._renderTransparentGeometry(),this.performanceInfo.advance(Xi.TRANSPARENT)),this._renderEdges(lu.TRANSPARENT))),this._bindParameters.ssao=Hi(this._bindParameters.ssao),_&&this._renderLineCallouts(Qn.NotOccluded),this._setTerrainDepthTest(!1),this._renderTransparentEnvironment(),n.update(B=>this._renderNodes(Fe.TRANSPARENT_ENVIRONMENT,B)),n.update(B=>this._renderNodes(Fe.VIEWSHED,B)),n.update(B=>this._renderNodes(Fe.LASERLINES,B)),n.update(B=>this._renderNodes(Fe.OCCLUDED,B)),this._pluginInput.set("highlights",this._renderHighlightPrepass()),n.update(B=>this._renderNodes(zr.COMPOSITE,B));let E=!(r!==Eo.Default||m||u&&!s&&r===Eo.Default),R=this._pluginInput.get(zr.COMPOSITE),D=E?ql:this.fboCache.acquire(R.fbo.width,R.fbo.height,Fe.ANTIALIASING),L=this._nodes.produces(Fe.ANTIALIASING)?this._renderNodes(Fe.ANTIALIASING,D):this._blitFBO(R,D,!1),O;this._pluginInput.set(Fe.ANTIALIASING,L),this.hasHighlightsOnHUD?(this._renderHUD(Qn.NotOccluded,L,f),O=this._renderNodes(Fe.HIGHLIGHTS,L)):(O=this._renderNodes(Fe.HIGHLIGHTS,L),this._renderHUD(Qn.NotOccluded,O,f));let H=this._renderNodes(Fe.MAGNIFIER,O);return u&&!s&&r===Eo.Default&&!m&&this._blitFBO(H),m?(H.attachDepth(n.depth),this._blitFBO(this._renderNodes(zr.FINAL,H)),H.detachDepth()):this._pluginInput.set(zr.FINAL,H),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),n.releaseDepth(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),r!==Eo.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),new xv(this._pluginInput.get("final-color"),S)}_precompileShaders(t,i,r){++this._plugins.context.techniques.precompiling,this._renderContext.output=r,this._precompileOpaqueGeometry(),this._setMultipassTerrain(t),this._renderContext.output=K.Depth,this._plugins.precompile(ne.TRANSPARENT_TERRAIN),t&&(this._precompileOpaqueGeometry(),this._precompileTransparentGeometry()),this._renderContext.output=r,this._plugins.precompile(ne.TRANSPARENT_TERRAIN),i&&(this._precompileTransparentGeometry(),this._needsTransparentTerrain&&(this._cullAboveTerrain(!1),this._precompileTransparentGeometry(),this._cullAboveTerrain(t))),this._needsHUDVisibility&&this._plugins.precompile(ne.OCCLUSION_PIXELS),t&&!this._needsHUDVisibility||this._plugins.precompile(ne.LINE_CALLOUTS),this._setMultipassTerrain(!1),this._nodes.precompile(Fe.VIEWSHED,Fe.LASERLINES,Fe.OCCLUDED,zr.COMPOSITE,Fe.MAGNIFIER),this._shadowAccumulator.precompile(),this._plugins.precompile(ne.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),--this._plugins.context.techniques.precompiling}_renderObjectAndLayerIdColor(){if(!this._nodes.produces("olid"))return null;++this._techniques.precompiling;let t=this._framebufferSize,i=this.fboCache.acquire(t.width,t.height,"olid");return i.acquireDepth(ts.DEPTH_STENCIL_TEXTURE),i=this._nodes.render(i,this._pluginInput),--this._techniques.precompiling,this.performanceInfo.advance(Xi.OBJECT_AND_LAYER_ID_COLOR),i}finish(t){this._hasAnimations||this._animationTimestep.clear();let i=this.performanceInfo.gpuSamplingEnabled,r=t===Te.BACKGROUND;if(r||i){let s=r?this.performanceInfo.elapsedTime:0,n=0;i?n=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.finish();let o=Math.max(s,n);this._animationTimestep.frame(o,r)}}readMainDepth(t,i){let{mainDepth:r,camera:s}=this._bindParameters;if(!r)return;let n=this.fboCache.acquire(this._framebufferSize.width,this._framebufferSize.height,"linear-depth");this._rctx.bindFramebuffer(n.fbo),s.setGLViewport(this._rctx),this._rctx.setScissorRect(t[0],t[1],t[2],t[3]),this._rctx.setScissorTestEnabled(!0),this._rctx.clearFramebuffer(Zs),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,r),this._rctx.setScissorTestEnabled(!1),this._rctx.setScissorRect(0,0,this._rctx.gl.canvas.width,this._rctx.gl.canvas.width),n.fbo?.readPixels(t[0],t[1],t[2],t[3],Ci.RGBA,tl.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(t,i,r,s,n){this._bindParameters.hudVisibility?.fbo?.readPixels(t,i,r,s,Ci.RGBA,tl.UNSIGNED_BYTE,n)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassTerrain(t){this._setTerrainDepthTest(t),this._cullAboveTerrain(t)}_setTerrainDepthTest(t){this._bindParameters.terrainDepthTest=t}_cullAboveTerrain(t){this._bindParameters.cullAboveTerrain=t}_renderEdges(t){let i=this._edgeView;if(!i?.shouldRender())return;let r=this._framebufferSize,s=this.fboCache.acquire(r.width,r.height,"edges"),n=()=>i.render(this._bindParameters,t),o=this._bindParameters.geometryDepth;this.renderToTargets(n,s,o??this._framebuffer.depth,Zs),this._framebuffer.bind(),this._compositingHelper.composite(this._bindParameters,s.getTexture()),s.release(),this.performanceInfo.advance(t===lu.OPAQUE?Xi.OPAQUE_EDGES:Xi.TRANSPARENT_EDGES)}_renderShadowMap(t,i,r){if(!this.shadowsEnabled)return;let s=this._shadowMap;s.start(t,i,r,this.isFeatureEnabled(Oo.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(K.ShadowHighlight,this._shadowMap),s.moveSnapshot(VE.Highlight),this._renderShadowCascades(K.ShadowExcludeHighlight,this._shadowMap),s.copySnapshot(VE.ExcludeHighlight),this._renderShadowCascades(K.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(K.Shadow),s.finish(),t.setGLViewport(this._rctx),this.performanceInfo.advance(Xi.SHADOW_MAP)}_precompileShadowCascades(t){for(let i of this._shadowMap.cascades)i.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(i.camera,i.camera),this._precompileAllGeometry(t)}_renderShadowCascades(t,i=this._shadowMap){for(let r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this.renderAllGeometry(t)}get _needsDepth(){return this._plugins.consumes(K.Depth)||this._nodes.requireGeometryDepth()||this.hasReflections||this._needsShadowHighlight||this._needsShadowAccumulation||this._debugNeedsDepth}_renderRemainingGeometryDepth(){let t=this._pluginInput.get("normals"),i=this._needsDepth;if(t){let r=i?t.getAttachment(su):null;r?.retain(),this._pluginInput.set(Fe.SSAO,this._renderSSAO()),this._renderGeometryWithoutNormalsDepth(i,r)}else this._renderAllGeometryDepth(i)}_renderGeometryWithoutNormalsDepth(t,i){if(!t||!i)return void(this._bindParameters.depth=Hi(this._bindParameters.depth));let r=this._framebufferSize,s=this.fboCache.acquire(r.width,r.height,"depth");s.attachDepth(i),i.release(),this._rctx.bindFramebuffer(s.fbo),this._rctx.clear(Ni.STENCIL),this._renderGeometryWithoutNormals(K.Depth),Hi(this._bindParameters.depth),this._bindParameters.depth=s.obtainDepthTexture(),s.release(),this.performanceInfo.advance(Xi.DEPTH)}_renderAllGeometryDepth(t){if(!t)return void(this._bindParameters.depth=Hi(this._bindParameters.depth));let i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"depth").acquireDepth(ts.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(r.fbo),this._rctx.clear(Ni.DEPTH|Ni.STENCIL),this.renderAllGeometry(K.Depth),Hi(this._bindParameters.depth),this._bindParameters.depth=r.obtainDepthTexture(),r.release(),this.performanceInfo.advance(Xi.DEPTH)}_renderTerrainDepth(t){if(!t)return void(this._bindParameters.terrainDepth=Hi(this._bindParameters.terrainDepth));let i=this._renderContext.output;this._renderContext.output=K.Depth;let r=this._framebufferSize,s=this.fboCache.acquire(r.width,r.height,"terrain depth").acquireDepth(ts.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(s.fbo),this._rctx.clear(Ni.DEPTH|Ni.STENCIL),this._renderTransparentTerrain(),Hi(this._bindParameters.terrainDepth),this._bindParameters.terrainDepth=s.obtainDepthTexture(),this._renderContext.output=i,s.release()}_renderGeometryDepth(t){if(!t)return void(this._bindParameters.geometryDepth=Hi(this._bindParameters.geometryDepth));let i=this._renderContext.output,{width:r,height:s}=this._framebufferSize,n=this.fboCache.acquire(r,s,"geometry depth").acquireDepth(ts.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clear(Ni.DEPTH|Ni.STENCIL),this._renderOpaqueAndTransparentGeometry(K.Depth),this._renderContext.output=i,Hi(this._bindParameters.geometryDepth),this._bindParameters.geometryDepth=n.obtainDepthTexture(),n.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowAccumulation}_computeDepthRange(t){if(!this._needsDepthRange)return Gv;let i=V8(t,this._plugins.plugins,this._stage.layers);return Ba(i,this._plugins.queryDepthRange(t)),i.near=Math.max(t.near,i.near),i.far=Math.min(t.far,i.far),i}get _normalsRequired(){let t=this._nodes.require("normals","final-color",zr.COMPOSITE,"opaque-color","transparent-color","laserline-color");return(this.hasSSAO?1:0)+t}_precompilePrepasses(){this._normalsRequired&&this._precompileAllGeometry(K.Normal),this._needsDepth&&this._precompileAllGeometry(K.Depth),this.shadowsEnabled&&(this._needsShadowHighlight?(this._precompileShadowCascades(K.ShadowHighlight),this._precompileShadowCascades(K.ShadowExcludeHighlight),this._precompileShadowCascades(K.ShadowHighlight)):this._precompileShadowCascades(K.Shadow)),this._needsShadowAccumulation&&this._precompileAllGeometry(K.Shadow)}_renderNormals(){let t=this._normalsRequired;if(t===0)return;let i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"normals",dr.RGBA);r.acquireDepth(ts.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(Zs,!0,!0),this._renderGeometryWithNormals(K.Normal);let s=this._nodes.optional("normals","final-color",zr.COMPOSITE,"opaque-color","transparent-color","viewshed-color");return r.retain(t+s-1),this.performanceInfo.advance(Xi.NORMALS),r}_renderSSAO(){let t=this._pluginInput.get("normals");if(!this.hasSSAO||!t)return void t?.detachDepth();ql.setName(Fe.SSAO);let i=this._nodes.render(ql,this._pluginInput);return this._bindParameters.ssao=i,t.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(Xi.SSAO),i}_precompileAllGeometry(t){let i=this._renderContext.output;this._renderContext.output=t,this._precompileOpaqueGeometry(),this._precompileTransparentGeometry(),this._plugins.precompile(ne.TRANSPARENT_TERRAIN),this._renderContext.output=i}renderAllGeometry(t){this._renderContext.output=t,this._renderOpaqueAndTransparentGeometry(t),this._renderTransparentTerrain()}precompileSlots(t,...i){for(let r of i)this._bindParameters.slot=r,t.precompile(this._renderContext)}precompileOccludedSlots(t,i){for(let r of i)this._renderContext.renderOccludedMask=r,this.precompileSlots(t,...W8);this._renderContext.renderOccludedMask=NE}renderSlots(t,...i){for(let r of i)this._bindParameters.slot=r,t.forAll(s=>{let n=s.acquireTechniques(this._renderContext);n&&(s.render(this._renderContext,n,this._pluginInput),x0(n))})}renderOccludedSlots(t,i){this._renderContext.renderOccludedMask=i,this.plugins.renderOccludedFlags>Br.Occlude&&this._plugins.render(this._pluginInput,ne.OCCLUDED_TERRAIN),this.renderSlots(t,...W8),this._renderContext.renderOccludedMask=NE}renderHUD(t){this._bindParameters.hudRenderStyle=t,this._plugins.render(this._pluginInput,ne.HUD_MATERIAL)}precompileViewshedShadowMap(){this._precompileAllGeometry(K.ViewshedShadow)}renderViewshedShadowMap(t){let{camera:i,contentCamera:r}=this._bindParameters,s=this._renderContext.output;t.setGLViewport(this._rctx),this._ensureBindParametersCamera(t,t),this.renderAllGeometry(K.ViewshedShadow),this._ensureBindParametersCamera(i,r),this._bindParameters.camera.setGLViewport(this._rctx),this._renderContext.output=s}_renderOpaqueAndTransparentGeometry(t){this._renderContext.output=t,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderGeometryWithNormals(t){this._renderContext.output=t,this._plugins.render(this._pluginInput,...iie),this._renderTransparentTerrain()}_renderGeometryWithoutNormals(t){this._renderContext.output=t,this._plugins.render(this._pluginInput,...rie)}_precompileOpaqueGeometry(){this._plugins.precompile(...mO)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...mO)}_renderTransparentGeometry(){this._plugins.render(this._pluginInput,...lb)}get _needsTransparentTerrain(){return this._plugins.produces(K.Color,ne.TRANSPARENT_TERRAIN)}_renderTransparentTerrain(){let t=()=>this._plugins.render(this._pluginInput,ne.TRANSPARENT_TERRAIN);if(!nE(this._renderContext.output))return void t();let i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"transparent terrain");return this.renderToTargets(t,r,this._framebuffer.depth,Zs),r}get _needsHUDVisibility(){return this._plugins.produces(this._renderContext.output,ne.OCCLUSION_PIXELS)}_renderHUDVisibility(){if(!this._needsHUDVisibility)return void(this._bindParameters.hudVisibility=Hi(this._bindParameters.hudVisibility));let{width:t,height:i}=this._framebufferSize,r=this._bindParameters.hudVisibility;r?.fbo?.width===t&&r?.fbo?.height===i||(r?.release(),r=this.fboCache.acquire(t,i,"hud visibility",dr.RGBA4),this._bindParameters.hudVisibility=r);let s=this._bindParameters.geometryDepth;r.attachDepth(s||this._framebuffer.depth),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer([0,1,0,1]),this._plugins.render(this._pluginInput,ne.OCCLUSION_PIXELS),r.detachDepth(),this._framebuffer.bind(),this.performanceInfo.advance(Xi.HUD_VISIBILITY)}_renderLineCallouts(t){if(this._bindParameters.hudRenderStyle=t,t===Qn.Occluded){let i=()=>this._plugins.render(this._pluginInput,ne.LINE_CALLOUTS),r=this._framebufferSize,s=this.fboCache.acquireDepth(ts.DEPTH16_BUFFER,r.width,r.height,"line callouts");this.renderToTargets(i,this._framebuffer.color,s,void 0,!0,!0),s.release()}else this._plugins.render(this._pluginInput,ne.LINE_CALLOUTS)}_renderHUD(t,i,r){if(this._pluginsHas.hudElements){if(this._oitEnabled){let s=this._renderOIT(vg.HUD,r,t);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,s.getTexture()),s.release()}else if(t===Qn.Occluded){this._renderContext.output=K.Color;let s=()=>this._renderHUDElements(t),n=this._framebufferSize,o=this.fboCache.acquireDepth(ts.DEPTH16_BUFFER,n.width,n.height,"hud");this.renderToTargets(s,this._framebuffer.color,o,void 0,!0,!0),o.release()}else this._renderContext.output=K.Color,i.acquireDepth(ts.DEPTH16_BUFFER),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(t),i.detachDepth();this.performanceInfo.advance(t===Qn.Occluded?Xi.HUD_OCCLUDED:Xi.HUD)}}_renderHUDElements(t){this._bindParameters.hudRenderStyle=t,this._plugins.precompile(ne.LINE_CALLOUTS_HUD_DEPTH,ne.HUD_MATERIAL,ne.LABEL_MATERIAL),this._plugins.render(this._pluginInput,ne.LINE_CALLOUTS_HUD_DEPTH,ne.HUD_MATERIAL,ne.LABEL_MATERIAL)}get _needsShadowHighlight(){return this.shadowsEnabled&&this._plugins.produces(K.ShadowHighlight,ne.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this.hasHighlights)return;let{fboCache:t,_rctx:i,_bindParameters:r}=this,s=this._framebufferSize,n=t.acquire(s.width,s.height,"highlights",dr.RG);return n.acquireDepth(ts.DEPTH_STENCIL_TEXTURE),i.bindFramebuffer(n.fbo),i.clearFramebuffer(Zs,!0),this._renderContext.output=K.Highlight,rz(i,t,s,this._stage.view.highlights,r,()=>this._renderHighlightGeometries(),0,()=>i.bindFramebuffer(n.fbo)),this.performanceInfo.advance(Xi.HIGHLIGHTS),n}_renderHighlightGeometries(){let t=[ne.TRANSPARENT_MATERIAL,ne.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,ne.OPAQUE_MATERIAL,ne.OPAQUE_MATERIAL_WITHOUT_NORMALS];this._bindParameters.highlightLevel===0&&t.push(ne.TRANSPARENT_TERRAIN,ne.INTEGRATED_MESH,ne.OPAQUE_TERRAIN),this._plugins.precompile(...t),this._plugins.render(this._pluginInput,...t),this._rctx.clear(Ni.DEPTH),this._renderHUDElements(Qn.Both)}get _needsShadowAccumulation(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(t,i,r){this._needsShadowAccumulation&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,t,i,r)&&this.performanceInfo.advance(Xi.ACCUMULATED_SHADOWS)}_precompileTransparentGeometry(){++this._plugins.context.techniques.precompiling,this._oitEnabled&&nE(this._renderContext.output)?(this._bindParameters.oitPass=hl.ColorAlpha,this._plugins.precompile(...lb),this._bindParameters.oitPass=hl.FrontFace,this._plugins.precompile(...lb),this._bindParameters.oitPass=hl.NONE):this._plugins.precompile(...lb),--this._plugins.context.techniques.precompiling}_renderOIT(t,i,r=Qn.Both){let s=t===vg.HUD,n=this._framebufferSize,o=s?this.fboCache.acquire(n.width,n.height,"oit hud composite"):null,a=s?()=>this._renderHUDElements(r):()=>this._renderTransparentGeometry(),l=this._bindParameters,d=this._renderContext.output;this._renderContext.output=i,l.oitPass=hl.ColorAlpha;let u=o?"oit hud color alpha":"oit color alpha",m=this.fboCache.acquire(n.width,n.height,u,dr.RGBA16F);m.acquireColor(pa.COLOR_ATTACHMENT1,dr.R16F),o||m.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(m.fbo),this._rctx.clearFramebuffer([0,0,0,1]),a(),m.detachDepth(),l.oitPass=hl.FrontFace;let p=this.fboCache.acquire(n.width,n.height,o?"oit hud front":"oit front");return o?p.acquireDepth(ts.DEPTH16_BUFFER):p.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(p.fbo),this._rctx.clearFramebuffer(Zs,!!o),a(),p.detachDepth(),l.oitPass=hl.NONE,o?(this._rctx.bindFramebuffer(o.fbo),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clear(Ni.COLOR)):this._framebuffer.bind(),this._oitblend??=new h1(this._techniques),this._oitblend.blend(this._rctx,m,p,l),o?.detachDepth(),p.release(),m.release(),this._renderContext.output=d,o}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this.performanceInfo.advance(Xi.APPLY_ACCUMULATED_SHADOWS),this._framebuffer.bind(),this._plugins.render(this._pluginInput,ne.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),this.performanceInfo.advance(Xi.TRANSPARENT_MATERIAL_WITHOUT_DEPTH)}_renderPlugins(t,i){this._plugins.produces(this._renderContext.output,t)&&(this._plugins.render(this._pluginInput,t),this.performanceInfo.advance(i))}_renderNodes(t,i,r=!1){if(i.setName(t),this._pluginInput.set(t,i),!this._nodes.produces(t))return r&&this.performanceInfo.advance(t),i;let s=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(t),s}_blitFBO(t,i=ql,r=!0){return this._blit??=new mw(this._techniques),this._blit.blit(this._rctx,t,i,this._bindParameters),this._pluginInput.set(t.name,i),r&&t.release(),i}_ensureBindParametersCamera(t,i){this._bindParameters.camera=t,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=ud:(zM(Z8,this._bindParameters.camera.viewMatrix),zM($8,this._bindParameters.camera.projectionMatrix),Gn(yg,Z8,$8),Gn(yg,this._renderContext.lastFrameCamera.viewMatrix,yg),Gn(yg,this._renderContext.lastFrameCamera.projectionMatrix,yg),this._reprojectionMatrix=yg);let i=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,t-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=ud,this._ssrEnableTime=null}addRenderNode(t){this._nodes.add(t),this._requestRender()}removeRenderNode(t){this._nodes.remove(t),this._requestRender()}updateLighting(t,i,r,s){this._bindParameters.updateLighting(t,i,r,s),this._requestRender(Te.UPDATE)}get usedMemory(){return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:this.edgeView?.usedMemory??0}}renderToTargets(t,i,r,s,n=!1,o=!1){i.attachDepth(r),this._rctx.bindFramebuffer(i.fbo),this._rctx.clearFramebuffer(s,n,o),t(),i.detachDepth()}get test(){}},vg;c([h({readOnly:!0})],dm.prototype,"fullResolutionAtmosphere",null),c([h()],dm.prototype,"_edgeView",void 0),c([h()],dm.prototype,"updating",null),function(e){e[e.Geometry=0]="Geometry",e[e.HUD=1]="HUD"}(vg||(vg={}));var iie=[ne.INTEGRATED_MESH,ne.OPAQUE_TERRAIN,ne.OPAQUE_MATERIAL,ne.TRANSPARENT_MATERIAL],rie=[ne.OPAQUE_MATERIAL_WITHOUT_NORMALS,ne.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],mO=[ne.INTEGRATED_MESH,ne.OPAQUE_TERRAIN,ne.OPAQUE_MATERIAL,ne.OPAQUE_MATERIAL_WITHOUT_NORMALS],lb=[ne.TRANSPARENT_MATERIAL,ne.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],W8=[ne.OPAQUE_MATERIAL,ne.TRANSPARENT_MATERIAL,ne.TRANSPARENT_MATERIAL_WITHOUT_DEPTH],$8=Ht(),Z8=Ht(),yg=Ht();function sie(e){return t=>e.immediate.schedule(t)}var y1=class{constructor(t){this._rctx=t,this._vao=nie(t)}destroy(){this._vao=Ne(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(ni.TRIANGLES,0,3))}get test(){}};function nie(e,t=tz,i=al){let r=new Float32Array([-1,-1,3,-1,-1,3]);return new Dn(e,i,new Map([["geometry",t]]),new Map([["geometry",es.createVertex(e,Is.STATIC_DRAW,r)]]))}var v1=class{constructor(t,i,r){this._rctx=t,this._locations=i,this._layout=r,this._cache=new Yo(t.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(t){let i=t.toString(),r=this._cache.pop(i);return r||(r=new Dn(this._rctx,this._locations,new Map([["geometry",this._layout]]),new Map([["geometry",es.createVertex(this._rctx,Is.STATIC_DRAW)]])),r.vertexBuffers.get("geometry")?.setSize(t),r)}deleteVao(t){if(t==null)return;let i=t.byteSize.toString();this._cache.put(i,t)}};var cb=class extends BV{constructor(t,i){super(t,i),this.gl=t,this._vaoCaches=new C_,this._appleAmdDriverHelper=null,this._refCount=1,this._newCache=i.newCache,this.screen=new y1(this)}configure(t){super.configure(t),this._newCache=t.newCache}destroy(){this._vaoCaches?.forAll(t=>t.dispose()),this._vaoCaches?.clear(),--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose(),this.screen.destroy(),this._vaoCaches.forAll(t=>t.dispose()),this._vaoCaches.clear()}get newCache(){return this._newCache}getVaoCache(t,i){let r=Array.from(t).join("."),s=JSON.stringify(i),n=this._vaoCaches.get(r,s);if(n)return n;let o=new v1(this,t,i);return this._vaoCaches.set(r,s,o),o}bindTechnique(t,i,r,s){return this.useProgram(t.program),this.setPipelineState(t.getPipeline()),r&&(t.program.bindPass(r,i),s&&t.program.bindDraw(i,r,s)),t.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??=new VV(this),this._appleAmdDriverHelper.run())}get test(){}};function pO(e){return!!e.frameUpdate}var hm=class extends k{constructor(e,t,i){super({}),this._stage=e,this._techniques=t,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new ti,this._frameTask=e.view.resourceController.scheduler.registerTask(si.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(T0.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniques.acquire(uz,new mz)),this._textureTechnique}acquire(e){let t=this._textures.get(e);return t?(t.ref(),t.loadingPromise??t):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{let i=t.texture.frameUpdate(t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",Te.BACKGROUND)}_createNewRef(e){let t=this._stage.getObject(e);if(t==null)return us(t!==void 0),null;let i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new fO(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._textures.set(e,r),r.ref(),t.glTexture?(this._updateGLTexture(r,t.glTexture),pO(t)&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{let s=t.load(this._rctx),n=a=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,a),pO(t)&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),o=a=>(this._loadingCount--,r.loadingPromise=null,xs(a)||V.getLogger(this).error(a),null);return Za(s)?s.then(n,o):n(s)}),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",Te.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};c([h()],hm.prototype,"_loadingCount",void 0),c([h()],hm.prototype,"_frameTask",void 0),c([h()],hm.prototype,"updating",null),hm=c([w("esri.views.3d.webgl-engine.lib.TextureRepository")],hm);var fO=class{constructor(t,i){this.id=t,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(V.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function Q8(e,t){return new nz(i=>az(i,e),i=>i,t)}var bg=class extends k{constructor(){super(...arguments),this._passParameters=new gO,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=Er(this._resourcesTask),this._passParameters.waveNormal=Ne(this._passParameters.waveNormal),this._passParameters.wavePerturbation=Ne(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=js(t=>P(this,null,function*(){yield Promise.allSettled([this._loadImageResource(e,t_("esri/images/materials/water/normals.jpg"),i=>this._passParameters.waveNormal=i,t),this._loadImageResource(e,t_("esri/images/materials/water/perturbation.jpg"),i=>this._passParameters.wavePerturbation=i,t)])}))),this._resourcesTask.finished?eE.LOADED:eE.LOADING}_loadImageResource(e,t,i,r){return P(this,null,function*(){try{let s=yield bd(t,{signal:r});Ut(r);let n=new Di(s.width,s.height);n.pixelFormat=Ci.RGB,n.samplingMode=An.LINEAR_MIPMAP_LINEAR,n.hasMipmap=!0,n.maxAnisotropy=8,i(new Rr(e,n,s))}catch(s){V.getLogger(this).error("Failed to load water material normal texture.",s)}})}};c([h()],bg.prototype,"_resourcesTask",void 0),c([h({type:Boolean,readOnly:!0})],bg.prototype,"updating",null),bg=c([w("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],bg);var gO=class extends nl{};var oie=new Map;function b1(){return oie}var w1=class{constructor(t,i){this.parameters=t,this.fbos=i}},x1=class{constructor(t,i,r){this._rctx=t,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}takeScreenshot(t){return P(this,null,function*(){yield this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Te.BACKGROUND);let i=Hn();return this._screenshotQueue.push({settings:t,resolver:i}),i.promise})}update(t,i){for(let r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}let s=se(I({},r.settings),{pixelRatio:r.settings.pixelRatio*t.parameters.camera.pixelRatio}),n=this._renderScreenshot(t,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,i,r){t.width=i.width,t.height=i.height;let s=t.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(t,r.disableDecorations,i),s.restore(),i}_readbackScreenshot(t,i){return t.resample?this._readbackScreenshotResampled(se(I({},t),{resample:t.resample}),i):this._readbackScreenshotImmediate(t,i)}_readbackScreenshotResampled(t,i){let{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas(),l=m0(r,s,a);this._rctx.gl.readPixels(0,0,r,s,Ci.RGBA,ru.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,se(I({},t),{region:void 0}));let d=m0(n.width,n.height,a);return GV(l,d,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,i){let{framebufferHeight:r,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=m0(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,Ci.RGBA,ru.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,i,r){let s=t.parameters.camera,n={width:i.framebufferWidth,height:i.framebufferHeight};Ym(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1,a=n.width!==s.fullWidth||n.height!==s.fullHeight,l=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,d=a||i.disableDecorations||l||i.objectAndLayerIdColor,u=null,m=null;if(d){let _=s.clone();if(i.ignorePadding){let C=w2(_.padding);for(let E=0;E<4;E++)C[E]=Math.round(C[E]/_.pixelRatio*i.pixelRatio);_.padding=C}_.fullWidth=n.width,_.fullHeight=n.height,_.pixelRatio=i.pixelRatio;let y=s.fovX-_.fovX,v=s.fovY-_.fovY;y<0&&y<v?_.fovX=s.fovX:v<0&&v<y&&(_.fovY=s.fovY);let x={camera:_,contentCamera:_,mode:Fi.IDLE,alignPixelEnabled:!0,contentPixelRatio:_.pixelRatio,forcedAnimationTime:t.parameters.forcedAnimationTime};this._forceCameraHook(x),o=!0;let S=this._renderFunctions.renderScene(x,r,i.objectAndLayerIdColor?Eo.ObjectAndLayerID:Eo.Screenshot,i.disableDecorations);m=S.screen,u=S.olid}let p=()=>{this._rctx.bindFramebuffer(null),m?.release()};this._rctx.bindFramebuffer(m?.fbo);let f=this._readbackScreenshot(i,p),g=null;if(i.objectAndLayerIdColor){let _=()=>{this._rctx.bindFramebuffer(null),u?.release()};this._rctx.bindFramebuffer(u?.fbo),g=this._readbackScreenshot(i,_),this._rctx.bindFramebuffer(null)}if(d&&!this._rctx.contextAttributes.alpha)for(let _=3;_<f.data.length;_+=4)f.data[_]=255;if(g&&!this._rctx.contextAttributes.alpha)for(let _=3;_<g.data.length;_+=4)g.data[_]=255;return o&&this._forceCameraHook(t.parameters),[f,g]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}};var K8={enabled:!1,disposeContextCache:()=>{let e=b1();e.forEach(t=>t.dispose()),e.clear()}};var _s=class extends k{constructor(e){super({}),this.events=new ti,this.waterTextures=new bg,this.olidRenderHelper=vd()?new e1:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode;try{this._initializeContext(e)}catch(r){return void console.error("Failed to initialize context",r)}let{memoryController:t}=e.view.resourceController;this.stippleTextures=oz(this._rctx,t),this.markerTextures=Q8(this._rctx,t),this._techniques=new kz(new WT(this._rctx,e.viewingMode,this.stippleTextures,this.waterTextures,this.markerTextures)),this._textures=new hm(e,this._techniques,this._rctx),this.addHandles(this._textures.events.on("changed",r=>this.requestRender(r))),this._materials=new sz(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new JT(this._rctx,this._techniques),this.renderer=new dm(e,this._materials,this._techniques,this._rctx,this._compositingHelper,r=>this.requestRender(r)),this.addHandles([T(()=>e.view.ready,r=>{r&&this._createRenderNodes(e.view,e.viewingMode)},ie),T(()=>this.waterTextures?.updating,()=>this.requestRender(),ie),T(()=>e.view.qualityProfile,r=>this.renderer?.updateRenderFeatures(r),Ce)]);let i={renderScene:(r,s,n,o)=>this.renderer.render(r,s,n,o),requestRenderScene:r=>this.requestRender(r),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(r,s,n)=>e.options.screenshot.renderOverlay(r,s,n)};this._screenshotManager=new x1(this._rctx,i,r=>this.events.emit("force-camera-for-screenshot",r)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Nt(this._frameTask),this._techniques=z(this._techniques),this._componentObjects=z(this._componentObjects),this._screenshotManager=z(this._screenshotManager),z(this.renderer),this._textures=z(this._textures),z(this.waterTextures),z(this.markerTextures),z(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=z(this._rctx)}_createRenderNodes(e,t){new XT({view:e,techniques:this._techniques}),Vb(e.spatialReference)||(t===we.Local?new IT({view:e,techniques:this._techniques}):Nb(e.spatialReference)?new n8({view:e,techniques:this._techniques}):(new ET({view:e,techniques:this._techniques}),new RT({view:e,techniques:this._techniques}),new ZT({view:e,techniques:this._techniques}),new AT({view:e,techniques:this._techniques}))),new cN({view:e,isEnabled:()=>this.renderer.hasSSAO,techniques:this._techniques}),new qc({view:e,isEnabled:()=>this.renderer.hasSMAA,techniques:this._techniques}),new Gc({view:e,techniques:this._techniques}),new iz({view:e,techniques:this._techniques}),new Ih({view:e,viewingMode:t,techniques:this._techniques}),new cm({view:e,techniques:this._techniques}),vd()&&new dg({view:e})}requestRender(e=Te.UPDATE){this._needsRender=!0,e===Te.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get techniques(){return this._techniques}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(t=>t[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,t,i,r,s,n=s){let o=r.constrainWindowSize(t,i,s*r.pixelRatio,n*r.pixelRatio),a=this._ensureLinearDepthArrayBuffer(o);this.renderer.readMainDepth(o,a);let l=(u,m,p)=>LF(m,u)*(p[1]-p[0])+p[0],d=Number.MAX_VALUE;for(let u=0;u<o[2]*o[3];u++){let m=l(4*u,a,r.nearFar);d>m&&m!==r.nearFar[0]&&m!==r.nearFar[1]&&(d=m)}if(e){let u=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);u!=null&&d>u&&u!==r.nearFar[0]&&u!==r.nearFar[1]&&(d=u)}return d===Number.MAX_VALUE?void 0:d}_ensureLinearDepthArrayBuffer(e){let t=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}reloadShaders(){return P(this,null,function*(){QS(),yield this._techniques.reloadAll(),this.renderer.overlay?.reloadShaders(),this.requestRender()})}_registerFrameTask(e){let t=e.view.state,i=!1,r=Te.BACKGROUND,s=!1,n={preRender:({time:o})=>{i=this.updating,r=this._needsUpdate?Te.UPDATE:Te.BACKGROUND,e.commitSyncLayers(),(o-this._lastAnimationUpdate>this.renderer.animationTimestep||t.forcedAnimationTime!=null||i||this._needsRender)&&(this.renderer.updateAnimation(t,o)&&this.requestRender(Te.BACKGROUND),this._lastAnimationUpdate=o)},render:({time:o})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){let a=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(t,o),s=!0,a&&this.renderer.hasReflections&&(this.requestRender(Te.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:o})=>{this._textures.update();let a=new w1(t,this.renderer.fboCache);this._screenshotManager.update(a,o)},finish:()=>{s&&(this.renderer.finish(t.mode===Fi.IDLE?r:Te.UPDATE),s=!1)}};this._frameTask=As(n)}_initializeContext(e){let t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");let i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:t.preserveDrawingBuffer??!1},r=this._canvas.getContext("webgl2",i);r!=null?(this._rctx=aie(r,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&V.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&Qe("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):V.getLogger(this).error("A WebGL2 context could not be created.")}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}getObjectAndLayerIdColor(e){return this.olidRenderHelper?.getObjectAndLayerIdColor(e)}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new qT(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}};function aie(e,t){let i=(s,n)=>t.view.resourceController.memoryController.newCache(s,n),r={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8,newCache:i};if(K8.enabled){let s=Y8.get(e);return s?(s.configure(r),s.ref(),s):(s=new cb(e,r),Y8.set(e,s),s.ref(),s)}return new cb(e,r)}c([h({type:Boolean,readOnly:!0})],_s.prototype,"updating",null),c([h()],_s.prototype,"_rctx",void 0),c([h()],_s.prototype,"_container",void 0),c([h()],_s.prototype,"_canvas",void 0),c([h()],_s.prototype,"stippleTextures",void 0),c([h()],_s.prototype,"markerTextures",void 0),c([h()],_s.prototype,"waterTextures",void 0),c([h({readOnly:!0})],_s.prototype,"olidRenderHelper",void 0),c([h()],_s.prototype,"_textures",void 0),c([h({readOnly:!0})],_s.prototype,"renderer",void 0),c([h()],_s.prototype,"_screenshotManager",void 0),c([h()],_s.prototype,"componentObjectCollection",null),c([h()],_s.prototype,"_componentObjects",void 0),c([h()],_s.prototype,"_needsUpdate",void 0),c([h()],_s.prototype,"_needsWaterReflectionUpdate",void 0),_s=c([w("esri.views.3d.webgl-engine.parts.RenderView")],_s);var Y8=b1();var ho=class extends k{constructor(e){super(e),this._model=new Fv,this._layers=new Dt,this._asyncChangeSet=new oE,this._syncChangeSet=new oE,this._layerSyncSet=new Set}initialize(){this._set("renderView",new _s(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(si.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),Tp(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(Tp(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return ar}_commit(e){let t=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;let r=this._layerSyncSet.has(i.id)||i.updatePolicy===rw.SYNC,s=r?this._syncChangeSet:this._asyncChangeSet;t.commitLayer(i.id,s),this._layerSyncSet.delete(i.id),s.empty||(this.renderer.modify(s,r?qn:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,qn),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==rw.ASYNC||(t.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){let e=this._model.dirtySet;this._layers.forAll(t=>{this._layerSyncSet.has(t.id)||t.updatePolicy===rw.SYNC?(e.commitLayer(t.id,this._syncChangeSet),this._layerSyncSet.delete(t.id)):e.commitSyncUpdates(t.id,this._syncChangeSet)});for(let t of this._layerSyncSet)e.commitLayer(t,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,qn),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,qn),this.renderView.requestRender())}schedule(e,t){return this._frameTask.schedule(e,t)}reschedule(e,t){return this._frameTask.reschedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,qn))}addRenderPlugin(e,t){let i=this.renderer.plugins.add(e,t),r=()=>{tP(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Za(i))return i.then(r);r()}removeRenderPlugin(e){this.destroyed||(tP(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};c([h({constructOnly:!0})],ho.prototype,"view",void 0),c([h({constructOnly:!0})],ho.prototype,"options",void 0),c([h({readOnly:!0})],ho.prototype,"viewingMode",null),c([h({constructOnly:!0})],ho.prototype,"container",void 0),c([h({readOnly:!0})],ho.prototype,"updating",null),c([h({constructOnly:!0})],ho.prototype,"_model",void 0),c([h()],ho.prototype,"renderView",void 0),c([h({readOnly:!0})],ho.prototype,"renderer",null),c([h({readOnly:!0})],ho.prototype,"running",null),ho=c([w("esri.views.3d.webgl-engine.Stage")],ho);var C1=class extends Kd{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};c([h()],C1.prototype,"components",void 0),C1=c([w("esri.views.ui.3d.DefaultUI3D")],C1);var _O=C1;var ce=class extends _x(bx(vx(Sx))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._overrideDefaultEnvironmentOnly=!0,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new fn({slicePlane:KF},this),this._resourceController=H4(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new RS({view:this}),this.labeler=new gz({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new Ud,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new Jd,this.environment=new Hu,this.environmentManager=new to,this.floors=new qe,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Vj({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new F4({view:this}),this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new _O,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlights=z4(),D0();let t=(i=null)=>{i!=null&&i.type===PM.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(r=>P(this,null,function*(){try{yield r.when()}catch{}this._updatingChanged()})))};this.addHandles([xi(()=>this.map?.allLayers,"after-changes",i=>t(i),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),T(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new m4({view:this}),this.stateManager=new Qi({view:this})}initialize(){this.groundView=new Oj({view:this}),this._updateUpdatingMonitors();let e=()=>this._updateDefaultToMapOptions();this.addHandles(xi(()=>this.map?.allLayers,"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},ie),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},ie),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,t=>Zk(t>0?1e3/Math.ceil(t):0),ie),this.updatingHandles.add(()=>this.map?.ground,e,Ce),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),Ce),this.addHandles(T(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Re))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=z(this.sharedSymbolResources),this._set("labeler",z(this.labeler)),this._set("deconflictor",z(this.deconflictor)),this._resourceController=z(this._resourceController),this._set("stateManager",z(this.stateManager)),this._set("inputManager",z(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",z(this.environmentManager)),this._set("environment",z(this.environment)),this.groundView=z(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy(),this.highlights.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state.animation}get camera(){return this.stateManager?.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get center(){return this.stateManager?.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this.map,t=this._userClippingArea||TM(e,"clippingArea");return!this._userClippingArea&&!TM(e,"clippingEnabled")||t==null?(this._clippingArea=null,null):t instanceof vi?this.spatialReference&&(t=S1(t,this.spatialReference),t==null)?(V.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),t.intersection(this._groundAndLayersExtent)==null&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(V.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&e!=null?V.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===we.Global)return null;let e=this.renderSpatialReference,t=this.dataExtent;return t==null||e==null||t.spatialReference.equals(e)?t:S1(t,e)}get tileInfo(){return this.basemapTerrain?.tilingScheme?.toTileInfo()}get dataExtent(){let e=this._groundAndLayersExtent,t=this.spatialReference||gt.WGS84,i=S1(this.clippingArea,t);i!=null&&(e=e!=null?e.intersection(i):i);let r=this._get("dataExtent");return e!=null&&e.equals(r)?r:e}get _groundAndLayersExtent(){let e=this.spatialReference||gt.WGS84,t,i=n=>{let o=S1(n,e);o!=null&&(t!=null?t.union(o):t=o.clone())},r=this.basemapTerrain;if(r?.spatialReference){let n=r.groundExtent;i(new vi({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){let n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(t==null)return null;t.hasZ?(t.zmin=Math.min(0,t.zmin??0),t.zmax=Math.max(0,t.zmax??0)):(t.zmin=0,t.zmax=0);let s=this._get("_groundAndLayersExtent");return t.equals(s)?s:t}castEnvironment(e){return e?e instanceof Hu?e:e instanceof gC?this.environment?.cloneWithWebsceneEnvironment(e)??Hu.fromWebsceneEnvironment(e):Qa(Hu,e):new Hu}get extent(){return this.stateManager?.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state?.stationary??!0)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}set qualityProfile(e){gv.isValidProfile(e)&&(gv.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||gv.getDefaultProfile()}set slicePlane(e){if(this._stage!=null&&(this._stage.renderer.slicePlane=e),e==null)return void this._set("slicePlane",null);let t=this._propertiesPool.get("slicePlane");np(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&!!this.stateManager?.preinit(this.spatialReference)}get resolution(){return this.spatialReference!=null?LN(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get heightModelInfo(){let e=this.getDefaultHeightModelInfo();return e!=null?Ub.deriveUnitFromSR(e,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(s=>{if(s.isFulfilled()){if(s.updating){if(t=!0,s.suspended||k_(s))return;++i,e+=s.updatingProgress}}else++i});for(let s of this._updatingObjects)s!=null&&s.updating&&(i+=.1,e+=.5*.1);for(let s of this._updatingObjectsWithProgress)s!=null&&s.updating&&(++i,e+=s.updatingProgress);let r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(s=>!s.isFulfilled())||this.textures?.updating),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){let s=performance.now();if(e<1){let n=Math.min((s-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-n)+e*n}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?s:0}return t}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){let e=this._predeterminedViewingMode;if(e!=null)return b0(e);let t=this.spatialReference;return t?this.defaultsFromMap?.viewingMode!=null&&t.equals(this.defaultsFromMap.spatialReference)?b0(this.defaultsFromMap.viewingMode):SE(t,we.Global)?"global":"local":"global"}set viewingMode(e){this.ready?V.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get visibleArea(){return this.stateManager?.visibleArea}get zoom(){return this.stateManager.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get highlightOptions(){for(let e of this.highlights)if(e.name===gp)return e.options;return new wh}set highlightOptions(e){for(let t of this.highlights)if(t.name===gp)return void(t.options=e)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new US(this)}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return V.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;let i=hu(e)?du(this,e):e;return Fz(this,i,t,this._defaultToMapOptions)}toScreen(e){if(!this.ready)return V.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;let t=(e.z==null?I_(this.elevationProvider,e):null)??0;return md(e,T1,this.renderSpatialReference,t),this.state.camera.projectToScreen(T1,yO),vr(yO[0],yO[1])}pixelSizeAt(e,t){if(!this.ready)return V.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!e)return 0;let i=this.renderSpatialReference;md(e,T1,i);let r=this.state.camera.computeScreenPixelSizeAt(T1);return t&&i!==t?r*Zh(i)/Zh(t):r}overlayPixelSizeInMapUnits(e){let t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e,()=>this.pixelSizeAt(e)):1}hitTest(e,t){if(!this.ready)return V.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;let i=hu(e)?du(this,e):e;return Lz(this,i,t,this._defaultHitTestOptions)}popupHitTest(e){return P(this,null,function*(){return U4(this,e)})}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}whenAnalysisView(e){return P(this,null,function*(){if(e.parent==null)throw new le("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":case"viewshed":return(yield this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}})}whenLayerView(e){return super.whenLayerView(e)}takeScreenshot(e){return P(this,null,function*(){let t=yield this._completeSettings(e);yield this.whenReady();let i=yield this._stage.renderView.takeScreenshot(t);return(yield import("./chunk-E7SBYW5D.js")).encode(i,t,this._pixelFormat())})}_takeScreenshot(e){return P(this,null,function*(){let t=yield this._completeSettings(e);yield this.whenReady();let i=yield this._stage.renderView.takeScreenshot(t);return(yield import("./chunk-E7SBYW5D.js")).encodeData(i,this._pixelFormat())})}_takeScreenshotWithObjectAndLayerId(e){return P(this,null,function*(){let t=yield this._completeSettings(e);yield this.whenReady();let i=yield this._stage.renderView.takeScreenshotWithOID(t),{encodeData:r}=yield import("./chunk-E7SBYW5D.js");return[r(i[0],this._pixelFormat()),r(i[1],this._pixelFormat())]})}_completeSettings(e){return P(this,null,function*(){let{toRenderSettings:t,screenshotSuperSampleSettings:i}=yield import("./chunk-E7SBYW5D.js"),r=t(e,this);return r.pixelRatio/=this.state.pixelRatio,i(r,this.supersampleScreenshotsEnabled,this.padding)})}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}takeScreenshotWithObjectAndLayerId(e){return P(this,null,function*(){if(!vd())throw new le("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true");let{encode:t}=yield import("./chunk-E7SBYW5D.js"),i=yield this._completeSettings(e);yield this.whenReady();let r=yield this._stage.renderView.takeScreenshotWithOID(i),s=t(r[0],i,this._pixelFormat()),n=yield this._completeSettings(e);return n.format="png",[s,t(r[1],n,this._pixelFormat())]})}getColorToObjectAndLayerIdMapping(){let e=this._stage.renderView.olidRenderHelper;if(e)return e.getColorToObjectAndLayerIdMapping();throw new le("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true")}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return PI.importLayerView(e)}hasLayerViewModule(e){return PI.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}validate(){return P(this,null,function*(){let e=Yx(this.type),t=Qe("safari");if(t&&t<9&&(e=new le("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:t})),e!=null)throw V.getLogger(this).warn("#validate()",e.message),e})}get _predeterminedViewingMode(){let e=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return e!=null?y_(e):null}getSpatialReferenceSupport(e,t){let i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;let r=this._validateSpatialReferenceForViewingMode(e,t,we.Local),s=this._validateSpatialReferenceForViewingMode(e,t,we.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,we.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,we.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!SE(e,i)&&(t==null||!!BM(t)||(!sd(t)||pu(t,e,i)!=null)&&(!VM(t)||i!==we.Global))}_makeSpatialReferenceConstraints(e,t,i){if(t==null)return[{spatialReference:e,viewingMode:i}];let{isWebMercator:r,isWGS84:s}=e;return BM(t)&&(r||s)?!s||i===we.Local||VB(t.tileInfo,t.fullExtent,e,we.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:gt.WebMercator,viewingMode:i}]:[{spatialReference:r?gt.WGS84:gt.WebMercator,viewingMode:i}]:sd(t)||VM(t)||!r&&!s?sd(t)&&r&&i!==we.Global?[{spatialReference:e,viewingMode:i},{spatialReference:gt.WGS84,viewingMode:we.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?gt.WGS84:gt.WebMercator,viewingMode:i}]}_validateSpatialReference(e){let t=this.getSpatialReferenceSupport(e)!=null,i=this._predeterminedViewingMode;return t||(i!=null?V.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${b0(i)} viewing mode.`):e.isGeographic&&V.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}trackGraphicState(e){if(!e.graphic)return V.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;let t=this.getViewForGraphic(e.graphic),i=null,r=!1,s=n=>{!r&&n!=null&&"processor"in n&&n.processor?.type==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(e))};return t!=null?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),kr(()=>{r=!0,i!=null&&(i.remove(),i=null)})}highlight(e){if(Array.isArray(e))return MM(e.map(i=>this.highlight(i)));if(qe.isCollection(e))return MM(e.toArray().map(i=>this.highlight(i)));let t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):kr()}maskOccludee(e){if(!e)return V.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;let t=this.getViewForGraphic(e),i=null,r=!1,s=n=>{!r&&n!=null&&zF(n)&&(i=n.maskOccludee(e))};return t!=null?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),kr(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){this.graphicsView!=null&&this.graphicsView.graphicChanged(e)}whenViewForGraphic(e,t){return P(this,null,function*(){if(e.layer===this)return yield Gs(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new le("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,r)=>{let s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(i,r))})}):this.whenLayerView(e.layer)})}_initBasemapTerrain(){this._set("basemapTerrain",new qq({view:this})),this._set("elevationProvider",new Wf({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new sn({view:this})),this._set("featureTiles",new rs({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));let e=()=>{let t=this.basemapTerrain?.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){let i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?sc(Hb(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>Vr.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(import("./chunk-E7TTBL37.js")).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&Vr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):t||!this._featureTreeDebugger||Vr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Ce),this.updatingHandles.add(()=>this.clippingArea,e,Ce),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,Ce)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.featureTiles&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this._set("featureTiles",z(this.featureTiles)),this._set("pointsOfInterest",z(this.pointsOfInterest)),this._exitBasemapTerrain(),this.state.reset(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){let e=this.spatialReference,t=this.state.isGlobal,i=xN(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",CN.create(this.state.viewingMode,i)),t||this.addHandles(T(()=>this.basemapTerrain?.extent,r=>{let s=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!Q0(r,this.basemapTerrain.spatialReference,X8,s)||(this.renderCoordsHelper.extent=X8)},Re),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(op/this.renderCoordsHelper.unitInMeters))}else this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null)}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){e!=null&&e.type===PM.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.addHandles(T(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),Re),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_prepareScreenshotOverlay(){return P(this,null,function*(){this.overlay&&(yield this.overlay.prepare())})}_renderScreenshotOverlay(e,t,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;let r=e.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(e,{disableDecorations:t}),r.getImageData(0,0,i.width,i.height)}_initStage(){let e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,s,n)=>this._renderScreenshotOverlay(r,s,n)}},t=new OS(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",t);let i=Lm(this.surface);this._stage=new ho({view:this,options:e,container:i}),this._stage.renderer.slicePlane=this.slicePlane,this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),ie),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),Sb(this._stage.renderView.canvas,"webglcontextlost",r=>{this.fatalError=new le("webgl-context-lost",r.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(op/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=z(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new qS({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;let e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}_createGraphicsViewAsync(e){return P(this,null,function*(){let t=(yield import("./chunk-KRAXCG6V.js")).default;Ut(e),yield Gs(()=>this.basemapTerrain?.ready,e),this._set("graphicsView",new t({view:this}))})}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){let e=y_(this.viewingMode);e===we.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.addHandles(xi(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();let t=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,i=t?.environment;i&&(this._overrideDefaultEnvironmentOnly?DI(this.environment,i):this.environment=this.environment.cloneWithWebsceneEnvironment(i)),this.timeExtent=t?.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new Ch(this._stage,this.resourceController.scheduler));let r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(s=>s(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this._overrideDefaultEnvironmentOnly=!1,this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",z(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(cc);for(let e of this.map.allLayers.items)c_(e.type)&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(cc);for(let e of this.map.allLayers.items)c_(e.type)&&e.opacity<1&&this._defaultHitTestOptions.exclude.add(e.uid)}}};function S1(e,t){return e!=null&&Kb(e.spatialReference,t)?sc(e,t):null}ce.type="3d",c([h()],ce.prototype,"_userClippingArea",void 0),c([h()],ce.prototype,"_resourceController",void 0),c([h()],ce.prototype,"_stage",void 0),c([h({readOnly:!0})],ce.prototype,"deconflictor",void 0),c([h({readOnly:!0})],ce.prototype,"labeler",void 0),c([h(T_(Ud,"analyses"))],ce.prototype,"analyses",void 0),c([h({type:Xs,readOnly:!0})],ce.prototype,"animation",null),c([h({readOnly:!0})],ce.prototype,"basemapTerrain",void 0),c([h({readOnly:!0})],ce.prototype,"elevationProvider",void 0),c([h()],ce.prototype,"camera",null),c([h({type:pn})],ce.prototype,"contentCamera",null),c([h({readOnly:!0})],ce.prototype,"canvas",void 0),c([h({type:je})],ce.prototype,"center",null),c([h({type:vi})],ce.prototype,"clippingArea",null),c([h({type:Jd})],ce.prototype,"constraints",void 0),c([h({type:vi,readOnly:!0})],ce.prototype,"renderDataExtent",null),c([h({readOnly:!0})],ce.prototype,"tileInfo",null),c([h({type:vi,readOnly:!0})],ce.prototype,"dataExtent",null),c([h({type:vi,readOnly:!0})],ce.prototype,"_groundAndLayersExtent",null),c([h({type:Hu})],ce.prototype,"environment",void 0),c([Lr("environment")],ce.prototype,"castEnvironment",null),c([h({readOnly:!0})],ce.prototype,"environmentManager",void 0),c([h({type:vi})],ce.prototype,"extent",null),c([h()],ce.prototype,"floors",void 0),c([h()],ce.prototype,"screenCenter",null),c([h()],ce.prototype,"frustum",null),c([h({type:Number,readOnly:!0})],ce.prototype,"fullOpacity",void 0),c([h({readOnly:!0})],ce.prototype,"graphicsView",void 0),c([h({readOnly:!0})],ce.prototype,"analysisViewManager",void 0),c([h()],ce.prototype,"groundView",void 0),c([h({type:Boolean})],ce.prototype,"initialExtentRequired",null),c([h()],ce.prototype,"defaultsFromMapSettings",null),c([h()],ce.prototype,"interacting",null),c([h()],ce.prototype,"stationary",null),c([h()],ce.prototype,"navigating",null),c([h()],ce.prototype,"map",void 0),c([h()],ce.prototype,"padding",null),c([h({type:sn,readOnly:!0})],ce.prototype,"pointsOfInterest",void 0),c([h({type:rs,readOnly:!0})],ce.prototype,"featureTiles",void 0),c([h()],ce.prototype,"_featureTreeDebugger",void 0),c([h({type:Boolean})],ce.prototype,"screenSizePerspectiveEnabled",void 0),c([h({constructOnly:!0})],ce.prototype,"deactivatedWebGLExtensions",void 0),c([h({constructOnly:!0})],ce.prototype,"debugWebGLExtensions",void 0),c([h({constructOnly:!0})],ce.prototype,"renderCanvas",void 0),c([h({constructOnly:!0})],ce.prototype,"state",void 0),c([h({readOnly:!0})],ce.prototype,"inputManager",void 0),c([h({readOnly:!0})],ce.prototype,"stateManager",void 0),c([h({type:["low","medium","high"]})],ce.prototype,"qualityProfile",null),c([h({type:nP,get(){let e=this._get("qualitySettings");return e||(e=new nP,gv.apply(this.qualityProfile,e)),e}})],ce.prototype,"qualitySettings",void 0),c([h()],ce.prototype,"slicePlane",null),c([h({readOnly:!0})],ce.prototype,"typeSpecificPreconditionsReady",null),c([h({readOnly:!0})],ce.prototype,"renderCoordsHelper",void 0),c([h({readOnly:!0})],ce.prototype,"sceneIntersectionHelper",void 0),c([h({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],ce.prototype,"resolution",null),c([h({type:Number})],ce.prototype,"scale",null),c([h()],ce.prototype,"heightModelInfo",null),c([h()],ce.prototype,"spatialReference",void 0),c([h({type:Boolean,constructOnly:!0})],ce.prototype,"alphaCompositingEnabled",void 0),c([h({constructOnly:!0})],ce.prototype,"preserveDrawingBufferEnabled",void 0),c([h({type:Boolean})],ce.prototype,"supersampleScreenshotsEnabled",void 0),c([h({readOnly:!0})],ce.prototype,"type",void 0),c([h(),Lr(e=>e instanceof Kd?e:Db(_O,e))],ce.prototype,"ui",void 0),c([h({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],ce.prototype,"updating",null),c([h()],ce.prototype,"_updatingObjects",null),c([h()],ce.prototype,"_updatingObjectsWithProgress",null),c([h({type:Number,readOnly:!0,dependsOn:["updating"]})],ce.prototype,"updatingProgress",void 0),c([h({type:["global","local"]})],ce.prototype,"viewingMode",null),c([h({type:rr})],ce.prototype,"viewpoint",null),c([h({readOnly:!0})],ce.prototype,"visibleArea",null),c([h({type:Number})],ce.prototype,"zoom",null),c([h({type:wh})],ce.prototype,"highlightOptions",null),c([h({type:qe.ofType(Pl)})],ce.prototype,"highlights",void 0),c([h({readOnly:!0})],ce.prototype,"quality",null),c([h({readOnly:!0})],ce.prototype,"resolutionScale",null),c([h()],ce.prototype,"textures",void 0),ce=c([w("esri.views.SceneView")],ce);var T1=b(),yO=ri(),X8=ii(),J8=ce;function eW(e,t,i){let r=e.effectiveClusterRenderer;if(!r||!("visualVariables"in r)||!r.visualVariables)return null;let s=r.visualVariables.find(u=>u.type==="size");if(!("stops"in s)||!s.stops)return null;let n=s.stops.find(u=>u.useMinValue),o=s.stops.find(u=>u.useMaxValue);if(n==null||o==null)return null;let a=i.featuresTilingScheme.getClosestInfoForScale(i.scale).level,l=s.field,d=t.getDisplayStatistics(a,l);return d?new f_({field:s.field,minSize:e.clusterMinSize,minDataValue:d.minValue,maxSize:e.clusterMaxSize,maxDataValue:d.maxValue}):null}function tW(e){let i=Math.floor(Math.log10(Math.abs(e)))+1,r=i<4||i>6?4:i,s=1e6,n=Math.abs(e)>=s?"compact":"standard";return Ob(e,{notation:n,minimumSignificantDigits:2,maximumSignificantDigits:r})}var iW=16,lie="https://utility.arcgis.com/sharing/tools/legend",cie="esri.layers.ImageryLayer",die="esri.layers.ImageryTileLayer",hie="esri.layers.WCSLayer",M1=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,uie=new nL({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),E1=new pd({size:6,outline:{color:[128,128,128,.5],width:.5}}),mie=new ou({style:"solid"});function wO(e){return e.type==="flow"}function nW(e){return e.type==="vector-field"}function oW(e){return e.type==="raster-colormap"}function aW(e){return e.type==="raster-stretch"}function lW(e){return e.type==="raster-shaded-relief"}function Cg(e){return e.declaredClass==="esri.renderers.SimpleRenderer"}function um(e){return e.declaredClass==="esri.renderers.ClassBreaksRenderer"}function Sg(e){return e.declaredClass==="esri.renderers.UniqueValueRenderer"}function cW(e){return e.declaredClass==="esri.renderers.HeatmapRenderer"}function pie(e){return xO(e)||CO(e)||SO(e)||fie(e)}function fie(e){return e.declaredClass==="esri.renderers.PointCloudRGBRenderer"}function xO(e){return e.declaredClass==="esri.renderers.PointCloudClassBreaksRenderer"}function CO(e){return e.declaredClass==="esri.renderers.PointCloudStretchRenderer"}function SO(e){return e.declaredClass==="esri.renderers.PointCloudUniqueValueRenderer"}function dW(e){return e.declaredClass==="esri.renderers.DotDensityRenderer"}function hW(e){return e.declaredClass==="esri.renderers.PieChartRenderer"}function gie(e,t){return Cg(e)||um(e)||Sg(e)||cW(e)||dW(e)||hW(e)?t.type==="2d"||qB(e):aW(e)||oW(e)||lW(e)||xO(e)||CO(e)||SO(e)||nW(e)||wO(e)}function _ie(e){return e.declaredClass==="esri.layers.BuildingSceneLayer"}function vO(e){return e.declaredClass==="esri.layers.SubtypeGroupLayer"}function yie(e){return e.declaredClass==="esri.layers.VoxelLayer"}function vie(e){return e.declaredClass==="esri.layers.WMSLayer"}function bie(e){return e.declaredClass==="esri.layers.WMTSLayer"}function bO(e){return e.declaredClass==="esri.layers.MapImageLayer"}function rW(e){return e.declaredClass==="esri.layers.TileLayer"}function wg(e){return e.declaredClass===cie}function R1(e){return e.declaredClass===die}function wie(e){return e.declaredClass===hie}function xie(e){return e.type==="stretch-ramp"}function Cie(e){return("authoringInfo"in e?e?.authoringInfo:null)?.type==="univariate-color-size"}function Sie(e){let t="authoringInfo"in e?e?.authoringInfo:null;return t?.type==="univariate-color-size"&&t?.univariateTheme==="above-and-below"}function sW(e){return"sublayers"in e}function Wc(e,t){return P(this,null,function*(){let i=yield kb("esri/widgets/Legend/t9n/Legend");return e!=="previewTemplateAriaLabel"||t||(e="previewAriaLabel"),ca(i[e],{label:t})})}function Tie(e,t){let{field:i,field2:r,field3:s,fieldDelimiter:n,valueExpression:o}=e;if(!i)return null;let a=!i&&!o||!r&&!s?[t]:t?.toString().split(n||""),l=i?{[i]:a?.[0]}:null;return l&&(r&&(l[r]=a?.[1]),s&&(l[s]=a?.[2])),l}var Mie=new pd({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}}),xg={},qr=class extends k{constructor(e){super(e),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this._layerDefinitionExpression=null,this._layerDefinitionExpressionClause=null,this.children=new qe,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerDefinitionExpression=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){let e=()=>this.notifyChange("ready");this.addHandles([xi(()=>this.children,"change",t=>{let{added:i,removed:r}=t;i.forEach(s=>{let n=`activeLayerInfo-ready-watcher-${s.layer.uid}`;this.addHandles(T(()=>s.ready,e,ie),n)}),r.forEach(s=>this.removeHandles(s.layer.uid)),e()})]),this.keepCacheOnDestroy||(xg={})}destroy(){this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(xg=null),this._layerDefinitionExpressionClause=null}get effectList(){let e=this.layer,t=null;return"effect"in e&&e.effect&&(t=new kV,t.effect=e.effect,t.endTransition(),t.scale=this.scale),t}get opacity(){let e=this.layer.opacity,t=this.parent?.opacity,i=this.layer.parent,r=i&&"uid"in i?this._getParentLayerOpacity(i):null;return t!=null?t*e:r!=null?r*e:e}get ready(){return this.layer===null||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view?.scale??0}get isScaleDriven(){let e=this.layer;if(e===null)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if(e.featureReduction.type==="cluster")return!0;if(e.featureReduction.type==="binning"&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}buildLegendElementsForFeatureCollections(e){return P(this,null,function*(){if(!(!this.hideLayersNotInCurrentView||(yield this._isLayerInCurrentView())))return this.legendElements=[],void this.notifyChange("ready");let t=Array.from(e,i=>{if(FL(i))return this._getRendererLegendElements(i.renderer,{title:i.title});if(i.featureSet?.features.length){let r=i.layerDefinition,s=r?.drawingInfo,n=s&&bF(s.renderer),o=uie.read(r.geometryType);return n?this._getRendererLegendElements(n,{title:i.name,geometryType:o}):(V.getLogger(this).warn("drawingInfo not available!"),null)}return null});try{let i=[],r=yield Promise.allSettled(t);for(let s of r)if(s.status==="fulfilled")for(let n of s.value??[])i.push(n);this.legendElements=i,this.notifyChange("ready")}catch(i){V.getLogger(this).warn("error while building legend for layer!",i)}})}buildLegendElementsForRenderer(e){return P(this,null,function*(){try{let t=!this.hideLayersNotInCurrentView||(yield this._isLayerInCurrentView());this.legendElements=t?yield this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){V.getLogger(this).warn("error while building legend for layer!",t)}})}buildLegendElementsForFeatureReduction(e){return P(this,null,function*(){try{let t=!this.hideLayersNotInCurrentView||(yield this._isLayerInCurrentView());this.legendElements=t?yield this._getLegendElementsForFeatureReduction(e):[],this.notifyChange("ready")}catch(t){V.getLogger(this).warn("error while building legend for layer!",t)}})}buildLegendElementsForTools(){return P(this,null,function*(){let e=this.layer;if(yie(e))this._constructLegendElementsForVoxelLayer();else if(bie(e))this._constructLegendElementsForWMTSlayer();else if(vie(e))yield this._constructLegendElementsForWMSSublayers();else if(_ie(e))yield this._constructLegendElementsForBuildingSceneLayer();else if(bO(e)||rW(e)||vO(e))yield this._constructLegendElementsForSublayers();else{this.removeHandles("imageryLayers-watcher");let t="default";if(wg(e)&&(t=(e?.rasterFunction?.functionName||"default")+"_"+(e.bandIds?.length?e.bandIds.join(""):"###")),R1(e)||e.type==="link-chart")return;yield this._getLegendLayers(`${e.uid}-${t}`).then(i=>P(this,null,function*(){this.legendElements=[],this.notifyChange("ready");let r=i.map(s=>P(this,null,function*(){if(wg(e)){let o=T(()=>[e.rasterFunction,e.bandIds],()=>$k(()=>P(this,null,function*(){xg.default=null,e.renderer?yield this.buildLegendElementsForRenderer(e.renderer):yield this.buildLegendElementsForTools()}))());this.addHandles(o,"imageryLayers-watcher")}let n=this._generateSymbolTableElementForLegendLayer(s);n?.infos.length&&(wg(e)&&(n.title=e.title),this.legendElements.push(n)),this.notifyChange("ready")}));yield Promise.allSettled(r)})).catch(i=>{V.getLogger(this).warn("Request to server for legend has failed!",i)})}})}_isLayerInCurrentView(){return P(this,null,function*(){let e=this.layer,t=this.layerView,i=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!i&&!(t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;yield Gs(()=>!t.updating);let r=i?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return r?(r.geometry=this.view.extent,(i?"queryFeatureCount"in t&&(yield t.queryFeatureCount(r)):"queryFeatureCount"in e&&(yield e.queryFeatureCount(r)))!==0):!0})}_getParentLayerOpacity(e){let t=1,i=e.parent;return i&&"uid"in i&&(t=this._getParentLayerOpacity(i)),e.opacity*t}_isGroupActive(){return this.children.some(e=>e.ready)}_isRendererScaleDriven(e){if(e.type==="dot-density")return!0;let t="valueExpression"in e?e.valueExpression:null;return M1.test(t)?!0:!!("visualVariables"in e?e.visualVariables:null)?.some(r=>this._isScaleDrivenSizeVariable(r))||this._hasScaleDrivenSymbols(e)}_hasScaleDrivenSymbols(e){switch(e.type){case"simple":return this._isScaleDrivenSymbol(e.symbol);case"class-breaks":return this._isScaleDrivenSymbol(e.defaultSymbol)||e.classBreakInfos.some(t=>this._isScaleDrivenSymbol(t.symbol));case"unique-value":return this._isScaleDrivenSymbol(e.defaultSymbol)||!!e.uniqueValueInfos?.some(t=>this._isScaleDrivenSymbol(t.symbol))}return!1}_isScaleDrivenSymbol(e){if(e?.type==="cim"){let{primitiveOverrides:t,minScale:i,maxScale:r}=e.data,s=t?.some(n=>/\$view\.scale/.test(n.valueExpressionInfo?.expression||""))??!1;return i!=null||r!=null||s}return!1}_isScaleDrivenSizeVariable(e){if(e&&e.type!=="size")return!1;let t=e,i=t.minSize,r=t.maxSize;return!(typeof i!="object"||!i||!this._isScaleDrivenSizeVariable(i))||!(typeof r!="object"||!r||!this._isScaleDrivenSizeVariable(r))||M1.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some(i=>this._isLayerScaleDriven(i));let t=e.parent;if(e.loaded===!1&&t&&bO(t)&&"source"in e&&e.source&&e.source.type==="map-layer"){for(let i of t.sourceJSON.layers??[])if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0}return!1}_constructLegendElementsForVoxelLayer(){return P(this,null,function*(){this.legendElements=[],this.removeHandles("voxel-style-watcher"),this.removeHandles("voxel-current-variable");let e=this.layer;this.addHandles(T(()=>e.currentVariableId,()=>this._constructLegendElementsForVoxelLayer()),"voxel-current-variable"),this.addHandles(T(()=>e.getVariableStyles(),()=>this._constructLegendElementsForVoxelLayer()),"voxel-style-watcher");let t=e.getVariableStyle(null),i=[];if(t){if(t.uniqueValues?.length){let n=[];t.uniqueValues.forEach(o=>{o.enabled&&n.push({label:o.label||`${o.value}`,value:o.value,symbol:new ou({color:o.color,outline:null})})}),n.length&&i.push({type:"symbol-table",title:t.label,infos:n})}else if(t.transferFunction){let{colorStops:n,stretchRange:o}=t.transferFunction,a=n.toArray().reverse(),l=o.map((u,m)=>`${m===0?WN:$N} ${tW(u)}`).reverse(),d=a.map(u=>({color:u.color,value:null,label:null}));d[0].label=l[0],d[d.length-1].label=l[1],i.push({type:"color-ramp",title:t.label,infos:d,preview:uc(a.map(u=>u.color),{ariaLabel:yield Wc("previewColorRampAriaLabel")})})}}let r=e.opacity,s=i.reduce((n,o)=>[...n,...this._getAllInfos(o)],[]).filter(n=>!!n?.symbol).map(n=>this._getSymbolPreview(n,r));yield Promise.allSettled(s),this.legendElements=i,this.notifyChange("ready")})}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this.removeHandles("wmts-activeLayer-watcher");let e=this.layer.activeLayer;this.addHandles(T(()=>{let{layer:i}=this;return i&&"activeLayer"in i&&i.activeLayer},()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher");let t=e.styleId?e.styles?.find(({id:i})=>i===e.styleId)?.legendUrl:void 0;t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}]),this.notifyChange("ready")}_constructLegendElementsForWMSSublayers(){return P(this,null,function*(){this.legendElements=[],this.removeHandles("wms-sublayers-watcher");let e=this.layer,t=null;(e.customParameters||e.customLayerParameters)&&(t=I(I({},e.customParameters),e.customLayerParameters)),this.addHandles(T(()=>{let{layer:i}=this;return i&&"sublayers"in i&&i.sublayers},()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher"),this.legendElements=yield this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")})}_generateLegendElementsForWMSSublayers(e,t){return P(this,null,function*(){let i=this.layer,r=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");let s=this.sublayerIds?.map(o=>i.findSublayerById(o))?.filter(Rs)??[],n=s.length?s:e.toArray();for(let o of n){let a=T(()=>[o.title,o.visible,o.legendEnabled],()=>this._constructLegendElementsForWMSSublayers());if(this.addHandles(a,"wms-sublayers-watcher"),!this.respectLayerVisibility||o.visible&&o.legendEnabled){let l=yield this._generateSymbolTableElementForWMSSublayer(o,t);l?.infos.length&&r.unshift(l)}}return r})}_generateSymbolTableElementForWMSSublayer(e,t){return P(this,null,function*(){if(!e.legendUrl&&e.sublayers){let i=(yield this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter(r=>r);return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendUrl(e,t)})}_generateSymbolTableElementForLegendUrl(e,t){return P(this,null,function*(){let i=e.legendUrl;if(!i)return;let r={type:"symbol-table",title:e.title||e.name||String(e.id??""),infos:[]};t&&(i=rL(i,t));let s=null,n=e.layer?.opacity;try{s=(yield jn(i,{responseType:"image"})).data,s&&(s.style.opacity=n)}catch{}return r.infos.push({src:i,preview:s,opacity:n}),r})}_getLegendLayers(e,t){let i=xg&&xg[e];return i?Promise.resolve(i):this._legendRequest(t).then(r=>{let s=r.layers;return xg[e]=s,s})}_legendRequest(e){let t=this.layer,i={f:"json",dynamicLayers:e};if(wg(t)){let s=t.exportImageServiceParameters.rasterFunction;if(s&&(i.renderingRule=JSON.stringify(s.functionDefinition?.toJSON()||s.toJSON())),t.bandIds&&(i.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){let{raster:n,viewId:o,customParameters:a}=t;i=I(I({raster:n,viewId:o},i),a)}}let r=t.url.replace(/(\/)+$/,"");if("version"in t&&+t.version>=10.01){let s=r.indexOf("?");s>-1?r=r.slice(0,s)+"/legend"+r.slice(s):r+="/legend"}else{let s=r.toLowerCase().indexOf("/rest/"),n=s===-1?r:r.slice(0,s)+r.slice(s+5);r=lie+"?soapUrl="+encodeURI(n)+"&returnbytes=true"}return jn(r,{query:i}).then(s=>s.data)}_constructLegendElementsForBuildingSceneLayer(){return P(this,null,function*(){this.legendElements=[],this.removeHandles("sublayers-watcher");let e=this.layer;this.addHandles(T(()=>e.sublayers,()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{this.legendElements=yield this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){V.getLogger(this).warn("Request to server for legend has failed!",t)}})}_generateLegendElementsForBuildingSublayers(e,t){return P(this,null,function*(){let i=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");let r=e.toArray();for(let s of r){let n=T(()=>["renderer"in s&&s.renderer,s.opacity,s.title,s.visible],()=>this._constructLegendElementsForBuildingSceneLayer());if(this.addHandles(n,"sublayers-watcher"),!this.respectLayerVisibility||s.visible){let o=s?.opacity!=null?s.opacity:null,a=o!=null?o*t:t;if(s.type==="building-group"){let l={type:"symbol-table",title:s.title,infos:[]},d=yield this._generateLegendElementsForBuildingSublayers(s.sublayers,a);l.infos.push(...d),i=[l,...i]}else s.renderer&&(i=[...yield this._getRendererLegendElements(s.renderer,{title:s.title,opacity:a,sublayer:s}),...i])}}return i.filter(s=>!!s&&(!("infos"in s)||!s.infos||s.infos.length>0))})}_constructLegendElementsForSublayers(){return P(this,null,function*(){this.legendElements=[],this.removeHandles("sublayers-watcher");let e=this.layer;if(bO(e)||rW(e)||vO(e)){this.addHandles(T(()=>e.sublayers,()=>this._constructLegendElementsForSublayers),"sublayers-watcher");try{this.legendElements=yield this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){V.getLogger(this).warn("Request to server for legend has failed!",t)}}})}_generateLegendElementsForSublayers(e,t,i){return P(this,null,function*(){let r=this.layer,s=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForSublayers()),"sublayers-watcher");let n=e.toArray();!i&&this.sublayerIds&&this.sublayerIds.length&&(n=vO(r)?this.sublayerIds.map(o=>r.findSublayerForSubtypeCode(o)).filter(Rs):this.sublayerIds.map(o=>r.findSublayerById(o)).filter(Rs));for(let o of n){let a=T(()=>[o.renderer,o.opacity,o.title,o.visible,o.legendEnabled],()=>this._constructLegendElementsForSublayers());if(this.addHandles(a,"sublayers-watcher"),!this.respectLayerVisibility||o.visible&&o.legendEnabled&&this._isSublayerInScale(o)){let l=o?.opacity!=null?o.opacity:null,d=l!=null?l*t:t,u=!sW(o)||o.originIdOf("renderer")>Xl.SERVICE&&!o.sublayers;if(o.renderer&&u)yield o.load(),s=[...yield this._getRendererLegendElements(o.renderer,{title:o.title,opacity:d,sublayer:o}),...s];else if(sW(o)){let m=yield this._generateSymbolTableElementForSublayer(o,d,i);m&&s.unshift(m)}}}return s.filter(o=>!!o&&(!("infos"in o)||!o.infos||o.infos.length>0))})}_generateSymbolTableElementForSublayer(e,t,i){return P(this,null,function*(){if(!i){i=new Map;let s=this.layer,n=e.source,o=null;if(!(!n||n.type==="map-layer"&&n.mapLayerId===e.id&&(!n.gdbVersion||n.gdbVersion===("gdbVersion"in s&&s.gdbVersion)))||e.originIdOf("renderer")>Xl.SERVICE||e.originIdOf("labelingInfo")>Xl.SERVICE||e.originIdOf("labelsVisible")>Xl.SERVICE){let l=new NN({layer:this.layer});o=l.hasDynamicLayers?l.dynamicLayers:null,l.destroy()}let a=o||`${s.uid}-default`;(yield this._getLegendLayers(a,o)).forEach(l=>i.set(l.layerId,l))}let r=i.get(e.id);if((!r||r?.subLayerIds&&r.defaultVisibility)&&e.sublayers){let s=yield this._generateLegendElementsForSublayers(e.sublayers,t,i);return{type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendLayer(r,e,t)})}_generateSymbolTableElementForLegendLayer(e,t,i){if(!e?.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;let r=t?.renderer,s=t?.title||e.layerName;if(r&&(!t||t?.originIdOf("renderer")>Xl.SERVICE)){let a=t?.title||this._getRendererTitle(r,t);a&&(s&&typeof a!="string"&&"title"in a&&(a.title=s),s=a)}let n={type:"symbol-table",title:s,legendType:e.legendType||null,infos:[]},o=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return e.legendGroups&&e.legendGroups.length>0?e.legendGroups.forEach(a=>{let l={type:"symbol-table",title:a.heading,legendType:e.legendType||null,infos:this._generateSymbolTableElementInfosForLegendLayer(o.filter(d=>d.groupId===a.id),e.layerId,i)};l.infos?.length>0&&n.infos.push(l)}):n.infos=this._generateSymbolTableElementInfosForLegendLayer(o,e.layerId,i),n.infos.length>0?n:null}_generateSymbolTableElementInfosForLegendLayer(e,t,i){return e.map(r=>{let s=r.url;if(r.imageData&&r.imageData.length>0)s=`data:image/png;base64,${r.imageData}`;else{if(s.indexOf("http")===0)return null;s=sL(`${this.layer.url}/${t}/images/${s}`)}return{label:r.label,src:s,opacity:i??this.opacity,width:r.width,height:r.height}}).filter(Rs)}_isSublayerInScale(e){let t=e.minScale||0,i=e.maxScale||0;return!(t>0&&t<this.scale||i>this.scale)}_isLegendLayerInScale(e,t){let i=t||this.layer,r=null,s=null,n=!0;return!i.minScale&&i.minScale!==0||!i.maxScale&&i.maxScale!==0?(e.minScale===0&&i.tileInfo&&(r=i.tileInfo.lods[0].scale),e.maxScale===0&&i.tileInfo&&(s=i.tileInfo.lods[i.tileInfo.lods.length-1].scale)):(r=Math.min(i.minScale,e.minScale)||i.minScale||e.minScale,s=Math.max(i.maxScale,e.maxScale)),(r>0&&r<this.scale||s>this.scale)&&(n=!1),n}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&+this.layer.version<10.1||e.length===0)return e;let i=t.renderer,r=e.some(o=>o.values),s=0,n=null;return r&&e.some((o,a)=>(o.values||(s=a,n=o,n.label||(n.label="others")),n!=null)),i?i.type==="unique-value"?n&&(e.splice(s,1),e.push(n)):i.type==="class-breaks"&&(n&&e.splice(s,1),e.reverse(),n&&e.push(n)):n&&(e.splice(s,1),e.push(n)),e}_getRendererLegendElements(i){return P(this,arguments,function*(e,t={}){if(!gie(e,this.view))return V.getLogger(this).warn(`Renderer of type '${e.type}' not supported!`),[];if(pie(e))return this._constructPointCloudRendererLegendElements(e,t);if(dW(e))return this._constructDotDensityRendererLegendElements(e);let r=yield this._loadRenderer(e);return hW(r)?this._constructPieChartRendererLegendElements(r):this._constructRendererLegendElements(r,t)})}_getLegendElementsForFeatureReduction(e){return P(this,null,function*(){let t=null;return e.type==="binning"?t=e.renderer:e.type==="cluster"&&(t=this._getClusterRenderer(e)),t?this._getRendererLegendElements(t):[]})}_getPointCloudRendererTitle(e){return(e.legendOptions?.title||e.field)??""}_constructPointCloudRendererLegendElements(i){return P(this,arguments,function*(e,t={}){let r=t.title,s=[],n=null,o=null;if(xO(e))n={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach(l=>{n.infos.unshift({label:l.label||l.minValue+" - "+l.maxValue,value:[l.minValue,l.maxValue],symbol:this._getAppliedCloneSymbol(E1,l.color)})});else if(CO(e)){let l=e.stops,d=null;if(l?.length&&(l.length===1&&(d=l[0].color),!d)){let m=l[0].value,p=l[l.length-1].value;m!=null&&p!=null&&(d=XN(m+(p-m)/2,l))}n={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(E1,d||E1.color)}]};let u=YN(e.stops??[])??[];o={type:"color-ramp",title:r||this._getPointCloudRendererTitle(e),infos:u,preview:uc(u.map(m=>m.color),{ariaLabel:yield Wc("previewColorRampAriaLabel")})}}else SO(e)&&(n={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos?.forEach(l=>{n.infos.push({label:l.label||l.values.join(", "),value:l.values.join(", "),symbol:this._getAppliedCloneSymbol(E1,l.color)})}));n?.infos.length&&s.push(n),o?.infos.length&&s.push(o);let a=s.reduce((l,d)=>[...l,...d.infos??[]],[]).filter(l=>!!l.symbol).map(l=>this._getSymbolPreview(l,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}}));return yield Promise.allSettled(a),s})}_getElementInfoForDotDensity(e,t){return P(this,null,function*(){let{color:i,label:r,valueExpressionTitle:s}=t,{backgroundColor:n,outline:o,dotSize:a}=e,l=this.effectList,d=l?.effects.map(v=>v.toJSON()),u=t2(d),m=yield Wc("previewTemplateAriaLabel",r||s),p=a+"-"+i+"-"+n+"-"+(o&&JSON.stringify(o.toJSON()))+"-"+u,f=this._dotDensityUrlCache,g=f.has(p)?f.get(p):dV(e,i,{ariaLabel:m});f.set(p,g);let _={shape:{type:"image",x:0,y:0,width:g.width,height:g.height,src:g.src},fill:null,stroke:null,offset:[0,0]},y=rV([[_]],[g.width,g.height],{effectView:this.effectList,ariaLabel:m});return{opacity:1,src:g.src,preview:y,width:g.width,height:g.height}})}_constructDotDensityRendererLegendElements(e){return P(this,null,function*(){let t=e.calculateDotValue(this.view.scale),i=e.legendOptions?.unit,r={type:"symbol-table",title:{value:t&&Math.round(t),unit:i||""},infos:[]};for(let s of e.attributes){let n=yield this._getElementInfoForDotDensity(e,s);n.label=s.label||s.valueExpressionTitle||s.field,r.infos.push(n)}return[r]})}_constructPieChartRendererLegendElements(e){return P(this,null,function*(){let t=this.layer.opacity,i=[],r=null,s=e.outline;e.attributes.forEach(l=>{let d=new pd({color:l.color,outline:s}),u=l.label||l.valueExpressionTitle||l.field;i.push({label:u,symbol:d})});let n=i.length?[...i]:[];if(e.othersCategory?.color&&e.othersCategory?.threshold!==0){let l=new pd({color:e.othersCategory.color,outline:s});r=e.othersCategory.label||"Other",i.push({label:r,symbol:l})}if(e.defaultColor?.a){let l=new pd({color:e.defaultColor,outline:s});i.push({label:e.defaultLabel,symbol:l})}let o=(yield this._getVisualVariableLegendElements(e,this.layer))||[];if(i.length){o.unshift({type:"symbol-table",title:null,infos:i});let l=n.filter(u=>u.label!==r).map(u=>u.symbol.color).filter(Boolean),d=hV(l,{holePercentage:e.holePercentage,backgroundColor:e.backgroundFillSymbol?.color,effectList:this.effectList,outline:s,ariaLabel:yield Wc("previewPieChartAriaLabel")});o.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:i,preview:d})}let a=o.reduce((l,d)=>[...l,...this._getAllInfos(d)],[]).filter(l=>!!l?.symbol&&!l?.preview).map(l=>this._getSymbolPreview(l,t,{effectList:this.effectList}));return yield Promise.allSettled(a),o})}_constructRendererLegendElements(i){return P(this,arguments,function*(e,t={}){let{title:r,sublayer:s}=t,n=s||this.layer,o=_E(e);if("definitionExpression"in n){let v=n.definitionExpression;if(v&&this.respectLayerDefinitionExpression&&Sg(e)){if(this._layerDefinitionExpression!==v){this._layerDefinitionExpressionClause=yield s2(v,n.fieldsIndex);let x=new Set((yield MN(e,n.fieldsIndex)).map(C=>C.toLowerCase())),S=this._layerDefinitionExpressionClause?.fieldNames.map(C=>C.toLowerCase());S?.every(C=>x.has(C))||(this._layerDefinitionExpressionClause=null,S?.length&&V.getLogger(this).warn("Definition expression will be ignored in the Legend, as fields in the expression do not match with renderer fields"))}}else this._layerDefinitionExpressionClause=null;this._layerDefinitionExpression=v}this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;let a=(yield this._getVisualVariableLegendElements(e,n))||[],l={type:"symbol-table",title:r||this._getRendererTitle(e,n),infos:[]},d=null,u=!1,m=new Set;if(wO(e)&&!this._hasSizeRamp){let v=yield QN(e);l.infos.push({label:null,symbol:v})}else if(Cie(e)){let v=r,x=Sie(e)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",S=a.findIndex(L=>L.type==="color-ramp"),C=S!==-1?a.splice(S,1)[0]:null,E=a.findIndex(L=>L.type==="size-ramp"),R=E!==-1?a.splice(E,1)[0]:null,D=[];C&&(v=C.title,D.push(C)),R&&(v=R.title,D.push(R)),D.length>0&&a.push({type:x,title:v,infos:D})}else if(cW(e)){let v=eV(e);a.push({type:"heatmap-ramp",title:r||this._getRendererTitle(e,n),infos:v,preview:uc(v.map(x=>x.color),{effectList:this.effectList,ariaLabel:yield Wc("previewColorRampAriaLabel")})})}else if(Sg(e)){let v=e.authoringInfo;if(v&&v.type==="relationship"){let{numClasses:x,field1:S,field2:C}=v,E=v.focus;if(x&&S&&C){let R=[S,C],D=nV(E)||0;for(let O of R){let{field:H,normalizationField:B,label:j}=O,Y=j||{field:this._getFieldAlias(H,n),normField:B&&this._getFieldAlias(B,n)},N=Mie.clone();N.angle=D,l.infos.push({label:Y,symbol:N}),m.add(N),D+=90}let L=sV({focus:E,numClasses:x,infos:e.uniqueValueInfos??[]});a.unshift(L)}}else if(wg(this.layer)||R1(this.layer))e.uniqueValueInfos?.forEach(x=>{x.symbol&&this._checkDefinitionExpressionForUVR(e,x.value)&&l.infos.push({label:x.label||x.value,value:x.value,symbol:x.symbol})});else{let{field:x,field2:S,field3:C,fieldDelimiter:E,valueExpression:R,defaultSymbol:D}=e,L=!(!x&&!R||!S&&!C),O=[];if(e.uniqueValueGroups?.forEach(H=>{let B={type:"symbol-table",title:H.heading,infos:[]};H.classes?.forEach(j=>{let{symbol:Y,values:N}=j;if(Y){let F=[],me=[];for(let de of N??[]){let{value:ke,value2:pe,value3:xe}=de,he=[],oe=[];(x||R)&&(he.push(ke),oe.push(this._getDomainName(x,ke,n))),S&&(he.push(pe),oe.push(this._getDomainName(S,pe,n))),C&&(he.push(xe),oe.push(this._getDomainName(C,xe,n))),F.push(L?he.join(E||""):he[0]),me.push(oe.join(" - "))}let $=F.join(", "),Q=j.label;if(!Q){let de=me.filter(Boolean);Q=de.length?de.join(", "):$}let Ie=Y.clone();Ie.type==="cim"&&o&&oV(Ie,{innerDotSize:.5*iW,outerRingSize:iW}),F.some(de=>this._checkDefinitionExpressionForUVR(e,de))&&B.infos.push({label:Q,value:$,symbol:Ie})}}),B.infos.length&&O.push(B)}),O.length){let H=O[0];O.length===1&&"title"in H&&!H.title?l.infos.push(...H.infos??[]):(D&&(O.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:D}]}),u=!0),l.infos.push(...O)),r||e.legendOptions?.title||e.valueExpressionTitle||(l.title=null)}}e.defaultSymbol&&!u&&(l.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),u=!0)}else if(um(e)){if(!o){if(d=this._isUnclassedRenderer(e),!d||!this._hasSizeRamp){let v=e.classBreakInfos.filter(({symbol:x})=>x);for(let{label:x,minValue:S,maxValue:C,symbol:E}of v)l.infos.unshift({label:x||(d?null:`${S} - ${C}`),value:[S,C],symbol:E});d&&(l.title=null),this._updateInfosForClassedSizeRenderer(e,l.infos)}e.defaultSymbol&&!d&&(l.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),u=!0)}}else if(aW(e))if(R1(this.layer)||wie(this.layer)){let v=yield this._constructTileImageryStretchRendererElements(e);xie(v)?a.push(v):l.infos=v}else{let v=this.layer,x,S;e.customStatistics?.length&&({min:x,max:S}=e.customStatistics[0]);let C=[],E=v.serviceRasterInfo;if(v.rasterFunction)try{E=yield v.generateRasterInfo(v.rasterFunction)}catch{}let R=iE(E.pixelType);if(E.bandCount===1){let D=v.bandIds?.[0]||0;x=x??(E.statistics?E.statistics[D].min:R[0]),S=S??(E.statistics?E.statistics[D].max:R[1]),x||S?a.push(yield this._getStretchLegendElements(e,{min:x,max:S})):this._getServerSideLegend()}else if(v.bandIds&&v.bandIds.length===1)x=x??(E.statistics?E.statistics[v.bandIds[0]].min:R[0]),S=S??(E.statistics?E.statistics[v.bandIds[0]].max:R[1]),x||S?a.push(yield this._getStretchLegendElements(e,{min:x,max:S})):this._getServerSideLegend();else if(E.bandCount>=3){let{bandInfos:D}=E,{bandIds:L}=v;D.length>=E.bandCount?L?.length===3?(C=L.map(O=>D[O].name),l.infos=this._createSymbolTableElementMultiBand(C)):v.format==="lerc"?(C=[0,1,2].map(O=>D[O].name),l.infos=this._createSymbolTableElementMultiBand(C)):this._getServerSideLegend():v.format==="lerc"?(C=["band1","band2","band3"],l.infos=this._createSymbolTableElementMultiBand(C)):this._getServerSideLegend()}else this._getServerSideLegend()}else if(oW(e))e.colormapInfos.forEach(v=>{l.infos.push({label:v.label,value:v.value,symbol:this._getAppliedCloneSymbol(mie,v.color)})});else if(Cg(e)){let v=e.symbol;switch(t.geometryType){case"point":v="pointSymbol"in n?n.pointSymbol:null;break;case"polyline":v="lineSymbol"in n?n.lineSymbol:null;break;case"polygon":v="polygonSymbol"in n?n.polygonSymbol:null}let x=this._hasClusterSizeVariable&&this._getClusterSymbol()||!this._hasSizeRamp;e.symbol&&x&&l.infos.push({label:e.label,symbol:v})}else if(nW(e)){e.outputUnit&&(this.title="("+e.toJSON().outputUnit+")"),l.title=e.attributeField;let v=e.getClassBreakInfos();v?.length?v.forEach(x=>{l.infos.push({label:x.minValue+" - "+x.maxValue,symbol:x.symbol})}):l.infos.push({label:e.attributeField,symbol:e.getDefaultSymbol()})}else lW(e)&&a.push(yield this._getStretchLegendElements(e,{min:0,max:255}));let p=e.defaultSymbol;!p||u||Cg(e)||d&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||a.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:p}]}),l.infos.length&&a.unshift(l);let f=t.opacity==null?this.opacity:t.opacity,g=this._isTallSymbol("visualVariables"in e?e.visualVariables:null),_=wg(this.layer)||R1(this.layer),y=a.reduce((v,x)=>[...v,...this._getAllInfos(x)],[]).filter(v=>!!v?.symbol).filter(v=>{if(v.symbol.type==="cim"){let{minScale:x,maxScale:S}=v.symbol.data;if(x&&x<this.scale||S&&S>this.scale)return!1}return!0}).map(v=>this._getSymbolPreview(v,f,{isDefault:v.symbol===p,applyScaleDrivenSize:!m.has(v.symbol),symbolConfig:{isTall:g,isSquareFill:_},effectList:m.has(v.symbol)?null:this.effectList}));return e=null,yield Promise.allSettled(y),a})}_checkDefinitionExpressionForUVR(e,t){if(!this._layerDefinitionExpressionClause)return!0;let i=Tie(e,t);return(i&&this._layerDefinitionExpressionClause.testFeature(i))??!0}_getServerSideLegend(){setTimeout(()=>this.buildLegendElementsForTools(),0)}_getAllInfos(e){let t=e?.infos;return t?t.reduce((i,r)=>i.concat(this._getAllInfos(r)),[]):[e]}_constructTileImageryStretchRendererElements(e){return P(this,null,function*(){let t=this.layer,i=t.symbolizer.rasterInfo??t.raster.rasterInfo,r,s,n=e?.customStatistics?.length?e.customStatistics:i?.statistics;if(n)({min:r,max:s}=n[0]);else{let a=iE(i.pixelType);r=a[0],s=a[1]}if(t.hasStandardTime()&&(r=t.getStandardTimeValue(r),s=t.getStandardTimeValue(s)),i.bandCount===1||t.bandIds?.length===1)return this._getStretchLegendElements(e,{min:r,max:s});let o=(t?.bandIds?.length?t.bandIds:Array.from(Array(Math.min(i.bandCount,3)).keys())).map(a=>i.bandInfos[a].name);return o.length<3?o.push(o[1]):o.length>3&&o.splice(3),this._createSymbolTableElementMultiBand(o)})}_getStretchLegendElements(e,t){return P(this,null,function*(){let i=e.colorRamp,r=JN(i,t);return{type:"stretch-ramp",title:"",infos:r,preview:uc(r.map(s=>s.color),{ariaLabel:yield Wc("previewColorRampAriaLabel")})}})}_getClusterSymbol(){let e=this.layer,t="featureReduction"in e&&e.featureReduction,i=t&&"symbol"in t&&t.renderer;return i&&i?.authoringInfo?.isAutoGenerated!==!0?null:t&&"symbol"in t?t.symbol:null}_getSizeLegendElement(e,t,i,r){return P(this,null,function*(){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:yield cV(i,t,yield gE(i),this.scale,this.view,r,this._hasClusterSizeVariable?this._getClusterSymbol():null)}})}_createSymbolTableElementMultiBand(e){let t=[],i=["red","green","blue"];return e.forEach((r,s)=>{t.push({label:{colorName:i[s],bandName:r},src:ZN[s],opacity:this.opacity??1})}),t}_updateInfosForClassedSizeRenderer(e,t){let i=e.authoringInfo&&e.authoringInfo.type==="class-breaks-size",r=e.classBreakInfos.some(s=>ON(s.symbol));if(i&&r){let s=aV,n=lV,o=e.classBreakInfos.length,a=(s-n)/(o>1?o-1:o);t.forEach((l,d)=>{l.size=s-a*d})}}_isTallSymbol(e){let t=!1,i=!1;if(e)for(let r=0;r<e.length&&(!t||!i);r++){let s=e[r];s.type==="size"&&(s.axis==="height"&&(t=!0),s.axis==="width-and-depth"&&(i=!0))}return t&&i}_getSymbolPreview(e,t,i){return P(this,null,function*(){let r=!i?.isDefault&&e.size==null&&this._hasSizeRamp?UL(tV.size):e.size;if(this._scaleDrivenSizeVariable&&i?.applyScaleDrivenSize){let{getSize:n}=yield import("./chunk-7PBEMZJ7.js");r=n(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:e.symbol.type==="simple-marker"?e.symbol.style:null})}let s=!i?.isDefault&&this._hasSizeRamp||!(!this._scaleDrivenSizeVariable||!i?.applyScaleDrivenSize);return uV(e.symbol,{size:r,opacity:t,scale:!1,symbolConfig:i?.symbolConfig,effectView:i?.effectList,style:"legend",cimOptions:{allowScalingUp:s,viewParams:this.isScaleDriven?{viewingMode:this.view?.type==="2d"?"map":this.view?.viewingMode,scale:this.view?.scale}:null},ariaLabel:e.label&&typeof e.label!="string"?null:yield Wc("previewTemplateAriaLabel",e.label)}).then(n=>(e.preview=n,e)).catch(()=>(e.preview=null,e))})}_getClusterRenderer(e){this._hasClusterSizeVariable=!1;let t="renderer"in this.layer?this.layer.renderer:null,i=e.renderer?.clone()||t?.clone(),r=eW(e,this.layerView,this.view);if(r&&i!=null&&"visualVariables"in i&&!i.visualVariables?.some(n=>n.type==="size"&&n.target!=="outline"&&!M1.test(n.valueExpression))){if("clusterMinSize"in e&&"clusterMaxSize"in e){let{clusterMinSize:o,clusterMaxSize:a}=e;r.legendOptions=new vF({showLegend:o!==a})}let n=i.visualVariables||[];i.visualVariables=n.concat([r]),this._hasClusterSizeVariable=!0}return i}_loadRenderer(e){return P(this,null,function*(){let t=[],i=e.clone(),r=yield gE(i);if(um(i)||Sg(i)){let s=(i.classBreakInfos||i.uniqueValueInfos).map(n=>this._fetchSymbol(n.symbol,r).then(o=>{n.symbol=o}).catch(()=>{n.symbol=null}));Array.prototype.push.apply(t,s)}return t.push(this._fetchSymbol(i.symbol||i.defaultSymbol,i.defaultSymbol?null:r).then(s=>{this._applySymbolToRenderer(i,s,Cg(i))}).catch(()=>{this._applySymbolToRenderer(i,null,Cg(i))})),yield Promise.allSettled(t),i})}_applySymbolToRenderer(e,t,i){i?e.symbol=t:e.defaultSymbol=t}_fetchSymbol(e,t){return P(this,null,function*(){if(!e)throw new Error;if(e.type==="web-style"){let i=this._webStyleSymbolCache;try{let r=yield this.view.type==="2d"?e.fetchCIMSymbol({cache:i}):e.fetchSymbol({cache:i});return this._getAppliedCloneSymbol(r,t)}catch{throw V.getLogger(this).warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)})}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;let i=e.clone(),r=t&&t.toRgba();return i.type.includes("3d")?this._applyColorTo3dSymbol(i,r):i.type==="cim"?DN(i,t):i.color&&(i.color=new Ar(r||i.color)),i}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach(i=>{i&&(i.material||(i.material={}),i.material.color=new Ar(t))})}_getVisualVariableLegendElements(e,t){return P(this,null,function*(){if(!("visualVariables"in e)||e.type==="vector-field")return null;let i=e.visualVariables??[],r=[],s=[],n=[],o=_E(e);if(o?.sizeStops?.length===2&&(um(e)||Sg(e))){let[m,p]=o.sizeStops;s.push(new f_({field:o.field??void 0,normalizationField:o.normalizationField,minSize:m.size,maxSize:p.size,minDataValue:m.value,maxDataValue:p.value}))}for(let m of i)m.type==="color"?r.push(m):m.type==="size"?s.push(m):m.type==="opacity"&&n.push(m);let a=[...r,...s,...n],l,d;if(r.length===0&&um(e)&&e.classBreakInfos&&e.classBreakInfos.length===1){let m=e.classBreakInfos[0];l=m&&m.symbol}if(r.length===0&&Cg(e)&&(l=e.symbol),l)if(l.type.includes("3d")){let m=l.symbolLayers.at(0);m.type==="water"?m.color!=null&&(d=m.color):m.material?.color!=null&&(d=m.material.color)}else l.url||(d=l.color);let u=this.effectList;return(yield Promise.all(a.map(m=>P(this,null,function*(){if(!m.legendOptions||m.legendOptions.showLegend!==!1){let p=wO(e)?m.field:this._getRampTitle(m,t),f=null,g=KN(t,m,this.view.timeZone);if(m.type==="color"){let _=(yield yE(m,null,g))??[];f={type:"color-ramp",title:p,infos:_,preview:uc(_.map(y=>y.color),{effectList:u,ariaLabel:yield Wc("previewColorRampAriaLabel")})},this._hasColorRamp||(this._hasColorRamp=_.length>0)}else if(m.type==="size"&&m.target!=="outline")M1.test(m.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=m):(f=yield this._getSizeLegendElement(p,m,e,g),this._hasSizeRamp||(this._hasSizeRamp=!(f.infos==null||!f.infos.length)));else if(m.type==="opacity"){let _=(yield yE(m,d,g))??[];f={type:"opacity-ramp",title:p,infos:_,preview:uc(_.map(y=>y.color),{effectList:u,ariaLabel:yield Wc("previewColorRampAriaLabel")})},this._hasOpacityRamp||(this._hasOpacityRamp=_.length>0)}return f?.infos?f:null}})))).filter(Rs)})}_getDomainName(e,t,i){if(e&&typeof e!="function"){let r="getField"in i&&i.getField?.(e),s=r&&"getFieldDomain"in i&&i.getFieldDomain?i.getFieldDomain(r.name,{excludeImpliedDomains:Qe("esri-widget-legacy-field-domain-calculation")}):null;return s?.type==="coded-value"?s.getName(t):null}return null}_getClusterTitle(e){let t=this.layer,i=e.field;if("featureReduction"in t&&t.featureReduction&&t.featureReduction.type==="cluster"){let r=t.featureReduction,s="popupTemplate"in r&&r.popupTemplate,n=s&&s.fieldInfos;if(n){for(let o of n)if(o.fieldName===i)return i==="cluster_count"?o.label||{showCount:!0}:o.label}}return{showCount:!0}}_getRampTitle(e,t){let i=e.field,r=e.normalizationField,s=!1,n=!1,o=!1,a=null;i=typeof i=="function"?null:i,r=typeof r=="function"?null:r;let l=e.legendOptions?.title;if(l!=null)a=l;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo?.visualVariables){let d=t.renderer.authoringInfo.visualVariables;for(let u=0;u<d.length;u++){let m=d[u];if(m.type==="color"){if(m.style==="ratio"){s=!0;break}if(m.style==="percent"){n=!0;break}if(m.style==="percent-of-total"){o=!0;break}}}}a={field:i&&this._getFieldAlias(i,t),normField:r&&this._getFieldAlias(r,t),ratio:s,ratioPercent:n,ratioPercentTotal:o}}return a}_getRendererTitle(e,t){let i=e;if(i.legendOptions?.title)return i.legendOptions.title;if(i.valueExpressionTitle)return i.valueExpressionTitle;let r=i.field,s=null,n=null;if(um(i)&&(s=i.normalizationField,n=i.normalizationType==="percent-of-total"),r=typeof r=="function"?null:r,s=typeof s=="function"?null:s,Sg(i)){let{field2:a,field3:l,fieldDelimiter:d}=i,u=r&&this._getFieldAlias(r,t);return a&&(u=`<${u}>${d}<${this._getFieldAlias(a,t)}>`,l&&(u=`${u}${d}<${this._getFieldAlias(l,t)}>`)),u}let o=null;return(r||s)&&(o={field:r&&this._getFieldAlias(r,t),normField:s&&this._getFieldAlias(s,t),normByPct:n}),o}_getFieldAlias(e,t){let s=("popupTemplate"in t?t.popupTemplate:null)?.fieldInfos?.find(u=>e===u.fieldName),n=null;"getField"in t&&t.getField?n=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(n=t.fieldsIndex.get(e));let o=null,a="featureReduction"in t&&t.featureReduction;a&&(s??="popupTemplate"in a?a.popupTemplate?.fieldInfos?.find(u=>e?.toLowerCase()===u.fieldName?.toLowerCase()):void 0,"fields"in a&&a.fields&&(o=a.fields.find(u=>u.name?.toLowerCase()===e?.toLowerCase())));let l=s||n||o,d=null;return l&&(d=s?.label||n?.alias||o?.alias||"name"in l&&l.name||"fieldName"in l&&l.fieldName||null),d}_isUnclassedRenderer(e){let t=e.visualVariables,i=!1;return um(e)&&e.classBreakInfos&&e.classBreakInfos.length===1&&t&&(i=e.field?t.some(r=>!(!r||e.field!==r.field||(e.normalizationField||r.normalizationField)&&e.normalizationField!==r.normalizationField)):!!t.length),i}};c([h()],qr.prototype,"children",void 0),c([h({readOnly:!0})],qr.prototype,"effectList",null),c([h()],qr.prototype,"layerView",void 0),c([h()],qr.prototype,"layer",void 0),c([h()],qr.prototype,"legendElements",void 0),c([h({readOnly:!0})],qr.prototype,"opacity",null),c([h()],qr.prototype,"parent",void 0),c([h({readOnly:!0,dependsOn:[]})],qr.prototype,"ready",null),c([h()],qr.prototype,"hideLayersNotInCurrentView",void 0),c([h()],qr.prototype,"keepCacheOnDestroy",void 0),c([h()],qr.prototype,"respectLayerDefinitionExpression",void 0),c([h()],qr.prototype,"respectLayerVisibility",void 0),c([h({readOnly:!0})],qr.prototype,"scale",null),c([h()],qr.prototype,"sublayerIds",void 0),c([h({readOnly:!0})],qr.prototype,"isScaleDriven",null),c([h()],qr.prototype,"title",void 0),c([h({readOnly:!0,dependsOn:["ready"],value:0})],qr.prototype,"version",null),c([h()],qr.prototype,"view",void 0),qr=c([w("esri.widgets.Legend.support.ActiveLayerInfo")],qr);var TO=qr;var mm={state:"state",view:"view",allLayerViews:"all-layer-views",legendProperties:"legend-properties"},uW=qe.ofType(TO),Eie=new Set(["esri.layers.BuildingSceneLayer","esri.layers.CatalogLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.OrientedImageryLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer","esri.layers.LinkChartLayer","esri.layers.catalog.CatalogFootprintLayer","esri.layers.catalog.CatalogDynamicGroupLayer","esri.layers.knowledgeGraph.KnowledgeGraphSublayer","esri.layers.KnowledgeGraphLayer"]),mW="view.basemapView.baseLayerViews",pW="view.groundView.layerViews",fW="view.basemapView.referenceLayerViews",Rie=[mW,pW,"view.layerViews",fW],uo=class extends k{constructor(e){super(e),this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new qe,this.activeLayerInfos=new uW,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerDefinitionExpression=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this.addHandles(T(()=>this.view,()=>this._viewHandles(),ie),mm.view),this.addHandles(km(()=>this._refresh()))}destroy(){this._destroyViewActiveLayerInfos(),this.view=null}get state(){return this.view?.ready?"ready":"disabled"}_viewHandles(){this.removeHandles(mm.state),this.view&&this.addHandles(T(()=>this.state,()=>this._stateHandles(),ie),mm.state)}_stateHandles(){this._resetAll(),this.state==="ready"&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this.removeHandles([mm.allLayerViews,mm.legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this.removeHandles(e);let t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t?.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){let{view:e}=this;if(!e)return;let{allLayerViews:t}=e;t.length&&this._refresh(),this.addHandles(t.on("change",i=>this._allLayerViewsChangeHandle(i)),mm.allLayerViews),this.addHandles(T(()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible],()=>this._propertiesChangeHandle()),mm.legendProperties)}_allLayerViewsChangeHandle(e){e.moved.length?this._propertiesChangeHandle():(e.removed.forEach(t=>this._destroyViewActiveLayerInfo(t.uid)),this._refresh())}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){let t=this.view;if(e.length<2||!t)return;let i=[];e.forEach(s=>{if(!s.parent){let n=s.layer.parent,o=n&&"uid"in n&&this._layerViewByLayerId[n.uid],a=o&&this._activeLayerInfosByLayerViewId[o.uid];a&&e.includes(a)&&(i.push(s),s.parent=a,a.children.add(s),this._sortActiveLayerInfos(a.children))}}),e.removeMany(i);let r={};t.allLayerViews.forEach((s,n)=>r[s.layer.uid]=n),e.sort((s,n)=>{let o=r[s.layer.uid]||0;return(r[n.layer.uid]||0)-o})}_generateLayerViews(){let e=[];return Rie.filter(this._filterLayerViews,this).map(t=>Om(this,t)).filter(t=>t!=null).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){let t=!this.basemapLegendVisible&&(e===mW||e===fW),i=!this.groundLegendVisible&&e===pW;return!t&&!i}_collectLayerViews(e,t){let i=r=>(r&&r.forEach(s=>{t.push(s),i(s[e])}),t);return i}_filterLayerViewsByLayerInfos(e){let t=this.layerInfos;return!t||!t.length||t.some(i=>this._hasLayerInfo(i,e))}_hasLayerInfo(e,t){let i=this._isLayerUIDMatching(e.layer,t.layer.uid);return i&&(this._layerInfosByLayerViewId[t.uid]=e),i}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some(i=>this._isLayerUIDMatching(i,t))}_isLayerViewSupported(e){return!!Eie.has(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this.removeHandles(e.uid),this.addHandles(T(()=>[e.legendEnabled,e.layer?.legendEnabled],()=>this._layerActiveHandle(e)),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this.removeHandles(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.layer?.legendEnabled}_buildActiveLayerInfo(e){let t=e.layer,i=e.uid,r=this._layerInfosByLayerViewId[i],s=this._activeLayerInfosByLayerViewId[i];if(!s){let o=r?.title!==void 0&&r.layer.uid===t.uid;s=new TO({layer:t,layerView:e,title:o?r.title:t.title,view:this.view??void 0,respectLayerDefinitionExpression:this.respectLayerDefinitionExpression,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:r?.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=s}let n=t.parent&&"uid"in t.parent?this._layerViewByLayerId[t.parent?.uid]:null;if(s.parent=this._activeLayerInfosByLayerViewId[n?.uid],!this.hasHandles(i)){let o=[T(()=>t.title,a=>this._titleHandle(a,s)),T(()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol],()=>this._constructLegendElements(s)),_r(()=>this.view?.stationary===!0,()=>this._scaleHandle(s),ie),T(()=>e.layer?xE(e.layer,e.view):null,()=>this._constructLegendElements(s)),T(()=>e.updating,()=>{e.layer!=null&&xE(e.layer,e.view)!=null&&this._constructLegendElements(s)}),T(()=>"effect"in t&&t.effect,()=>this._constructLegendElements(s)),_r(()=>this.view?.timeZone,()=>this._constructLegendElements(s),ie)];if(this.respectLayerVisibility){let a=T(()=>e.legendEnabled,d=>this._legendEnabledHandle(d,s)),l=T(()=>t.legendEnabled,d=>this._legendEnabledHandle(d,s));o.push(a,l)}if(this.respectLayerDefinitionExpression&&"definitionExpression"in t){let a=T(()=>[t.definitionExpression,this.respectLayerDefinitionExpression],()=>{s.respectLayerDefinitionExpression=this.respectLayerDefinitionExpression,this._constructLegendElements(s)});o.push(a)}this.addHandles(o,i)}s.isScaleDriven||this._constructLegendElements(s),this._addActiveLayerInfo(s)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){let{layerView:t,layer:i}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){let r=e.parent;if(r)r.children.includes(e)||r.children.push(e),this._sortActiveLayerInfos(r.children);else{let s=this.layerInfos?.some(o=>o.layer.uid===i.uid),n=i.parent;n&&"uid"in n&&this._layerViewByLayerId[n.uid]&&!s?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){let s=[];this._activeLayerInfosWithNoParent.forEach(n=>{let o=n.layer.parent,a=o&&"uid"in o?this._layerViewByLayerId[o?.uid]:null,l=this._activeLayerInfosByLayerViewId[a?.uid];l&&(s.push(n),n.parent=l)}),s.length&&(this._activeLayerInfosWithNoParent.removeMany(s),s.forEach(n=>this._addActiveLayerInfo(n)))}}}_removeActiveLayerInfo(e){let t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){let t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&t.featureReduction&&"renderer"in t.featureReduction&&(t.featureReduction.type==="binning"||t.featureReduction.type==="cluster")&&(!this.view||t.featureReduction.maxScale<=this.view.scale)?e.buildLegendElementsForFeatureReduction(t.featureReduction):"renderer"in t&&t.renderer&&!("sublayers"in t)?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url&&t.type!=="catalog"&&t.type!=="knowledge-graph"?e.buildLegendElementsForTools():e.children.forEach(i=>this._constructLegendElements(i))}};c([h({type:uW})],uo.prototype,"activeLayerInfos",void 0),c([h()],uo.prototype,"basemapLegendVisible",void 0),c([h()],uo.prototype,"groundLegendVisible",void 0),c([h()],uo.prototype,"hideLayersNotInCurrentView",void 0),c([h()],uo.prototype,"keepCacheOnDestroy",void 0),c([h()],uo.prototype,"respectLayerDefinitionExpression",void 0),c([h()],uo.prototype,"respectLayerVisibility",void 0),c([h()],uo.prototype,"layerInfos",void 0),c([h({readOnly:!0})],uo.prototype,"state",null),c([h()],uo.prototype,"view",void 0),uo=c([w("esri.widgets.Legend.LegendViewModel")],uo);var gW=uo;var hi="esri-legend--card",Tg="esri-legend",Oe={activated:`${hi}__carousel-indicator--activated`,base:hi,stacked:`${Tg}--stacked`,carouselTitle:`${hi}__carousel-title`,indicator:`${hi}__carousel-indicator`,intervalSeparator:`${hi}__interval-separator`,imageryLayerStretchedImage:`${hi}__imagery-layer-image--stretched`,imageLabel:`${hi}__image-label`,layerCaption:`${hi}__layer-caption`,labelElement:`${hi}__label-element`,layerRow:`${hi}__layer-row`,labelCell:`${hi}__label-cell`,message:`${hi}__message`,rampLabel:`${hi}__ramp-label`,section:`${hi}__section`,relationshipSection:`${hi}__relationship-section`,serviceCaptionText:`${hi}__service-caption-text`,serviceContent:`${hi}__service-content`,service:`${hi}__service`,groupLayer:`${hi}__group-layer`,groupLayerChild:`${hi}__group-layer-child`,symbol:`${hi}__symbol`,sizeRampRow:`${hi}__size-ramp-row`,symbolRow:`${hi}__symbol-row`,symbolCell:`${hi}__symbol-cell`,indicatorContainer:`${hi}__carousel-indicator-container`,intervalSeparatorsContainer:`${hi}__interval-separators-container`,relationshipLabelContainer:`${hi}__relationship-label-container`,labelContainer:`${hi}__label-container`,serviceCaptionContainer:`${hi}__service-caption-container`,symbolContainer:`${hi}__symbol-container`,sizeRampContainer:`${hi}__size-ramp-container`,sizeRampPreview:`${hi}__size-ramp-preview`,pieChartRampPreview:`${hi}__pie-chart-ramp-preview`,rampContainer:`${Tg}__ramps`,sizeRampHorizontal:`${Tg}__size-ramp--horizontal`,rampLabelsContainer:`${Tg}__ramp-labels`,layerInfo:`${Tg}__layer-cell ${Tg}__layer-cell--info`,univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card"};var Aie=n_(),_W=10,MO=20,A1=10,EO=20,RO={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function Iie(e="vertical"){let t="stroke:rgb(200, 200, 200);stroke-width:1";return e==="vertical"?A("svg",{height:"4",width:"10"},A("line",{style:t,x1:"0",x2:"10",y1:"2",y2:"2"})):A("svg",{height:"10",width:"10"},A("line",{style:t,x1:"5",x2:"5",y1:"0",y2:"10"}))}function Die(e,t="vertical"){let i=document.createElement("div");return i.style.height=`${MO}px`,i.className=RO.univariateAboveAndBelowSymbol,e!=null&&(i.style.opacity=e.toString()),Aie.append(i,Iie.bind(null,t)),i}function yW(e,t,i="vertical",r){e.infos.forEach((s,n)=>{if(r&&n===2)s.preview=Die(t,i);else{let o=Ja(s.size)+(i==="horizontal"?EO:A1),a=s.preview,l=a?.tagName.toLowerCase()==="div",d=l?a:document.createElement("div");d.className=RO.univariateAboveAndBelowSymbol,i==="horizontal"?d.style.width=`${o}px`:d.style.height=`${o}px`,!l&&a&&d.appendChild(a),s.preview=d}})}function Mg(e,t="classic"){let i=e.infos;return t==="classic"?(Ja(i[0].size)+A1)/2:(Ja(i[0].size)-Ja(i[i.length-1].size))/2}function Dh(e,t){if(!e)return null;let i=e.infos.map(s=>s.color),r=uc(t.type==="full"?i:t.type==="above"?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList,ariaLabel:t.ariaLabel});return r.className=RO.colorRamp,t.opacity!=null&&(r.style.opacity=t.opacity.toString()),r}function I1(e,t,i,r="vertical"){let s=0,n=e.infos,o=Math.floor(n.length/2),a=t==="full"||t==="above"?0:o,l=t==="full"||t==="below"?n.length-1:o;for(let d=a;d<=l;d++)i&&d===o?s+=r==="horizontal"?_W:MO:s+=Ja(n[d].size)+(r==="horizontal"?EO:A1);return Math.round(s)}function Ph(e,t,i,r="vertical"){let s=I1(e,t,i,r),n=e.infos,o=Math.floor(n.length/2),a=t==="full"||t==="above"?0:o,l=t==="full"||t==="below"?n.length-1:o,d=t==="full"?n[a].size+n[l].size:t==="above"?n[a].size:n[l].size,u=i?r==="vertical"?MO:_W:0,m=r==="vertical"?A1*(t==="full"?2:1):EO*(t==="full"?2:1);return Math.round(s-(Ja(d)/2+u/2+m/2))}function D1(e,t,i="vertical"){let r=e.infos,s=r.find(({type:o})=>o==="size-ramp"),n=r.find(({type:o})=>o==="color-ramp");return s&&(s=I({},s),s.infos=[...s.infos],yW(s,t,i,!0)),n&&(n=I({},n),n.infos=[...n.infos]),i==="horizontal"&&(s?.infos.reverse(),n?.infos.reverse()),{sizeRampElement:s,colorRampElement:n}}function P1(e,t="vertical"){let i=e.infos,r=i.find(({type:n})=>n==="size-ramp"),s=i.find(({type:n})=>n==="color-ramp");return r&&(r=I({},r),r.infos=[...r.infos],yW(r,null,t,!1)),s&&(s=I({},s),s.infos=[...s.infos]),t==="horizontal"&&(r?.infos.reverse(),s?.infos.reverse()),{sizeRampElement:r,colorRampElement:s}}function Pie(e,t){return t}function Wr(e){let t=this;e.appendChild(t)}function Wl(e,t,i){if(!t)return;if(typeof t=="number")return t;if(typeof t=="string")return zk(t);if("value"in t||"unit"in t)return ca(e.dotValue,t);if("colorName"in t&&"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:void 0;let r=null;return Pie(t,i)?r=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:AO(t,i)&&(r=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),r?ca(r==="showField"?"{field}":e[r],{field:t.field,normField:t.normField}):void 0}function AO(e,t){return!t}function O1(e,t){return!!(t&&t==="Stretched"&&e.version>=10.3&&e.declaredClass==="esri.layers.ImageryLayer")}function k1(e,t){return e.label?t[e.label]+": "+(typeof e.value=="string"?e.value:Ob(e.value??0,{style:"decimal",notation:e.value?.toString().toLowerCase().includes("e")?"scientific":"standard"})):""}var Oie=25,kie=25,Lie=768,Fie=100,Nie="#ddd",Eg=window.devicePixelRatio;function Vie(e){if(e){if(e.type.includes("3d")){let t=e.symbolLayers?.length;if(!t)return;let i=e.symbolLayers.at(t-1),r=i.resource?.primitive;return r==="circle"||r==="cross"||r==="kite"||r==="sphere"||r==="cube"||r==="diamond"}{let t=e.style;return t==="circle"||t==="diamond"||t==="cross"}}}function Bie(e){if(e){if(e.type.includes("3d")){let t=e.symbolLayers?.length;if(!t)return;let i=e.symbolLayers.at(t-1).get("resource.primitive");return i==="triangle"||i==="cone"||i==="tetrahedron"}return e.style==="triangle"}}var za=class extends Jr{constructor(e,t){super(e,t),this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.addHandles(T(()=>this.activeLayerInfos,e=>{this.removeAllHandles(),this._watchForSectionChanges(e)}))}render(){let{view:e}=this;this._hasIndicators=this.layout==="auto"&&e&&e.container.clientWidth<=Lie||this.layout==="stack";let t=this.activeLayerInfos,i=t?.toArray().map(l=>this._renderLegendForLayer(l)).filter(l=>!!l);this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;let r=this._sectionNames.length,s=this._sectionNames.map((l,d)=>{let u=ca(this.messagesCommon.pagination.pageText,{index:d+1,total:r});return A("div",{"aria-controls":`${l}-panel`,"aria-label":u,"aria-selected":(this._selectedSectionName===l).toString(),bind:this,class:this.classes(Oe.indicator,{[Oe.activated]:this._selectedSectionName===l}),"data-section-name":l,id:l,key:l,onclick:this._selectSection,onkeydown:this._focusSection,role:"tab",tabIndex:this._selectedSectionName===l?0:-1,title:u})}),n=this._hasIndicators&&r>1?A("div",{class:Oe.indicatorContainer,key:"carousel-navigation",role:"tablist"},s):null,o=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):i?.length?i:null,a={[Oe.stacked]:this._hasIndicators};return A("div",{class:this.classes(Oe.base,a)},o||A("div",{class:Oe.message},this.messages.noLegend),n)}_selectSection(e){let t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){let t=e.key,i=t==="ArrowLeft"?-1:1,r=e.target.getAttribute("data-section-name"),s=this._sectionNames.indexOf(r),n=this._sectionNames,o=null;s!==-1&&(n[s+i]?o=document.getElementById(n[s+i]):t==="ArrowLeft"?o=document.getElementById(n[n.length-1]):t==="ArrowRight"&&(o=document.getElementById(n[0])),o?.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach(i=>{let r=`activeLayerInfo-${i.layer.uid}-version-change`;this.removeHandles(r),this._watchForSectionChanges(i.children),this.addHandles(T(()=>i.version,()=>this._generateSectionNames()),r)});let t="activeLayerInfos-collection-change";this.removeHandles(t),this.addHandles(e.on("change",()=>this._watchForSectionChanges(e)),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,i){return`${this.id}${e.uid}-type-${t.type}-${i}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((t,i)=>{this._sectionNames.push(this._getSectionName(e.layer,t,i))})}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){let t=e.children.map(i=>this._renderLegendForLayer(i)).toArray();return A("div",{class:this.classes(Oe.service,Oe.groupLayer),key:e.layer.uid},A("div",{class:Oe.serviceCaptionContainer},e.title),t)}{let t=e.legendElements;if(t&&!t.length)return null;let i=t.some(n=>n.type==="relationship-ramp"),r=t.map((n,o)=>this._renderLegendForElement(n,e,o,i)).filter(n=>!!n);if(!r.length)return null;let s={[Oe.groupLayerChild]:!!e.parent};return A("div",{class:this.classes(Oe.service,s),key:e.layer.uid},A("div",{class:Oe.serviceCaptionContainer},A("div",{class:Oe.serviceCaptionText},e.title)),A("div",{class:Oe.serviceContent},r))}}_renderLegendForElement(e,t,i,r=!1,s=!1){let n=e.type==="color-ramp",o=e.type==="opacity-ramp",a=t.layer,l=null;if(typeof e.title=="string")l=e.title;else if(e.title){let g=e.title,_=Wl(this.messages,g,n||o);l=g.title?`${g.title} (${_})`:_}let d=this._getSectionName(a,e,i),u=this._hasIndicators&&!s?A("div",null,A(pp,{class:Oe.carouselTitle,level:this.headingLevel},t.title),A(pp,{class:Oe.layerCaption,level:GN(this.headingLevel)},l)):l?A(pp,{class:Oe.layerCaption,level:this.headingLevel},l):null,m=t.effectList,p=null;switch(e.type){case"symbol-table":{let g=e.infos.map((_,y)=>this._renderLegendForElementInfo(_,t,e.legendType,y)).filter(_=>!!_);if(g.length){let _=g[0].properties.classes?.[Oe.symbolRow],y={[Oe.labelContainer]:!_&&!r,[Oe.relationshipLabelContainer]:r};p=A("div",{class:this.classes(y)},g)}break}case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":p=this._renderLegendForRamp(e,a.opacity,m);break;case"size-ramp":p=this._renderSizeRamp(e,a.opacity);break;case"pie-chart-ramp":p=this._renderPieChartRamp(e);break;case"relationship-ramp":p=F0(e,this.id,{opacity:a.opacity,effectList:m,ariaLabel:this.messages.previewRelationshipRampAriaLabel});break;case"univariate-above-and-below-ramp":p=this._renderUnivariateAboveAndBelowRamp(e,a.opacity,m);break;case"univariate-color-size-ramp":p=this._renderUnivariateColorSizeRamp(e,a.opacity,m)}if(!p)return null;let f=A("div",{"aria-labelledby":d,class:Oe.section,id:`${d}-panel`,key:d,role:"tabpanel",tabIndex:0},[u,p]);return s||this._sectionMap.set(d,f),f}_renderPieChartRamp(e){return A("div",{afterCreate:Wr,bind:e.preview,class:Oe.pieChartRampPreview})}_renderUnivariateAboveAndBelowRamp(e,t,i){let{sizeRampElement:r,colorRampElement:s}=D1(e,t,"horizontal");if(!r)return null;let n=I1(r,"full",!0,"horizontal"),o=Ph(r,"above",!0,"horizontal"),a=Ph(r,"below",!0,"horizontal"),l=12,d=this.messages?.previewColorRampAriaLabel,u=Dh(s,{width:o,height:l,rampAlignment:"horizontal",opacity:t,type:"above",effectList:i,ariaLabel:d}),m=Dh(s,{width:a,height:l,rampAlignment:"horizontal",opacity:t,type:"below",effectList:i,ariaLabel:d}),p=Mg(r,"card"),f=r.infos.map(C=>C.label),g=f.length-1,_=f.map((C,E)=>E===0||E===g?A("div",{key:E},C):null),y={display:"flex",flexDirection:"column"},v={display:"flex",flexDirection:"row"},x={marginTop:"3px",display:"flex"};r_(this.container)?x.marginRight=`${p}px`:x.marginLeft=`${p}px`;let S={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return A("div",{class:Oe.layerRow,key:"size-ramp-preview",styles:y},A("div",{class:this.classes(Oe.symbolContainer,Oe.sizeRampHorizontal),styles:v},r.infos.map((C,E)=>A("div",{afterCreate:Wr,bind:C.preview,class:Oe.symbol,key:E}))),u?A("div",{class:Oe.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:x},A("div",{afterCreate:Wr,bind:u}),A("div",{afterCreate:Wr,bind:m})):null,A("div",{class:Oe.layerInfo},A("div",{class:Oe.rampLabelsContainer,styles:S},_)))}_renderUnivariateColorSizeRamp(e,t,i){let{sizeRampElement:r,colorRampElement:s}=P1(e,"horizontal");if(!r)return null;let n=I1(r,"full",!1,"horizontal"),o=Ph(r,"full",!1,"horizontal"),a=Dh(s,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:i,ariaLabel:this.messages?.previewColorRampAriaLabel}),l=Mg(r,"card"),d=r.infos.length-1,u=r.infos.map((_,y)=>y===0||y===d?A("div",{key:y},_.label):null),m={display:"flex",flexDirection:"column"},p={display:"flex",flexDirection:"row"},f={marginTop:"3px",display:"flex"};r_(this.container)?f.marginRight=`${l}px`:f.marginLeft=`${l}px`;let g={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return A("div",{class:Oe.layerRow,key:"size-ramp-preview",styles:m},A("div",{class:this.classes(Oe.symbolContainer,Oe.sizeRampHorizontal),styles:p},r.infos.map((_,y)=>A("div",{afterCreate:Wr,bind:_.preview,class:Oe.symbol,key:y}))),A("div",{class:Oe.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:f},A("div",{afterCreate:Wr,bind:a})),A("div",{class:Oe.layerInfo},A("div",{class:Oe.rampLabelsContainer,styles:g},u)))}_renderLegendForElementInfo(e,t,i,r){let s=t.layer;if(e.type)return this._renderLegendForElement(e,t,r,!1,!0);let n=O1(s,i),o=Wl(this.messages,e.label,!1)??"";if(e.preview){if(!e.symbol?.type.includes("simple-fill")){if(!e.label)return A("div",{afterCreate:Wr,bind:e.preview,key:r});let C={[Oe.symbolCell]:this._hasIndicators};return A("div",{class:this.classes(Oe.layerRow,{[Oe.symbolRow]:this._hasIndicators}),key:r},A("div",{afterCreate:Wr,bind:e.preview,class:this.classes(C)}),A("div",{class:this.classes(Oe.imageLabel,{[Oe.labelCell]:this._hasIndicators})},o))}let a=255,l=255,d=255,u=0,m=255,p=255,f=255,g=0,_=e.symbol.color?.a,y=e.symbol.outline?.color?.a;_&&(a=e.symbol.color.r,l=e.symbol.color.g,d=e.symbol.color.b,u=e.symbol.color.a*s.opacity),y&&(m=e.symbol.outline.color.r,p=e.symbol.outline.color.g,f=e.symbol.outline.color.b,g=e.symbol.outline.color.a*s.opacity);let v=e.symbol.color?.isBright??!0,x=v?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",S={background:_?`rgba(${a}, ${l}, ${d}, ${u})`:"none",color:v?"black":"white",textShadow:`-1px -1px 0 ${x},
                                              1px -1px 0 ${x},
                                              -1px 1px 0 ${x},
                                              1px 1px 0 ${x}`,border:y?`1px solid rgba(${m}, ${p}, ${f}, ${g})`:"none",filter:mE(t.effectList)??void 0};return A("div",{class:Oe.layerRow,key:r},A("div",{class:Oe.labelElement,styles:S},o))}if(e.src){let a=this._renderImage(e,s,n);return A("div",{class:Oe.layerRow,key:r},a,A("div",{class:Oe.imageLabel},o))}}_renderImage(e,t,i){let{label:r,src:s,opacity:n}=e,o={[Oe.imageryLayerStretchedImage]:i,[Oe.symbol]:!i},a={opacity:`${n??t.opacity}`};return A("img",{alt:Wl(this.messages,r,!1),"aria-label":Wl(this.messages,r,!1),border:0,class:this.classes(o),height:e.height,src:s,styles:a,width:e.width})}_renderSizeRampLines(e){let t=e.infos,i=t[0],r=t[t.length-1],s=i.symbol,n=this._hasIndicators,o=Ja(i.size+i.outlineSize)*Eg,a=Ja(r.size+r.outlineSize)*Eg,l=n?o:o+50*Eg,d=n?o/2+50*Eg:o,u=Bie(s),m=Vie(s),p=document.createElement("canvas");p.width=l,p.height=d,p.style.width=p.width/Eg+"px",p.style.height=p.height/Eg+"px";let f=p.getContext("2d");if(n){f.beginPath();let g=0,_=0,y=l/2-a/2,v=d;f.moveTo(g,_),f.lineTo(y,v);let x=l,S=0,C=l/2+a/2,E=d;f.moveTo(x,S),f.lineTo(C,E)}else{f.beginPath();let g=0,_=d/2-a/2,y=l;f.moveTo(g,_),f.lineTo(y,0);let x=0,S=d/2+a/2,C=l,E=d;f.moveTo(x,S),f.lineTo(C,E)}return f.strokeStyle=Nie,f.stroke(),A("div",{afterCreate:Wr,bind:p,styles:n?{display:"flex",marginTop:`-${u?0:m?o/2:0}px`,marginBottom:`-${u?a:m?a/2:0}px`}:{display:"flex",marginRight:`-${u?0:m?o/2:0}px`,marginLeft:`-${u?0:m?a/2:0}px`}})}_renderSizeRamp(e,t){let i=e.infos,r=i[0].label,s=i[i.length-1].label,n=i[0].preview,o=i[i.length-1].preview,a=this._hasIndicators,l={"flex-direction":a?"column":"row-reverse"};n&&(n=n.cloneNode(!0),n.style.display="flex"),o&&(o=o.cloneNode(!0),o.style.display="flex");let d={opacity:t!=null?`${t}`:""};return A("div",{class:this.classes(Oe.layerRow,{[Oe.sizeRampRow]:a})},A("div",{class:Oe.rampLabel},a?r:s),A("div",{class:Oe.sizeRampContainer,styles:l},A("div",{afterCreate:Wr,bind:n,class:Oe.sizeRampPreview,styles:d}),this._renderSizeRampLines(e),A("div",{afterCreate:Wr,bind:o,class:Oe.sizeRampContainer,styles:d})),A("div",{class:Oe.rampLabel},a?s:r))}_getRampStopLabel(e,t){switch(t){case"heatmap-ramp":return this.messages[e.label];case"stretch-ramp":return k1(e,this.messages);default:return e.label}}_renderLegendForRamp(e,t,i){let r=e.infos,s=e.type,n=s==="heatmap-ramp",o=r.length-1,a=kie,l=o>2&&!n?Oie*o:Fie,d=l+20,u=10,m=r.slice().reverse(),p=m.length-1,f=m.length%2!=0?m[m.length/2|0]:null,g=f&&A("div",{class:Oe.intervalSeparatorsContainer},A("div",{class:Oe.intervalSeparator},"|"),A("div",{class:Oe.rampLabel},this._getRampStopLabel(f,s))),_=[[{shape:{type:"path",path:`M0 ${a/2} L${u} 0 L${u} ${a} Z`},fill:m[0].color,stroke:{width:0}},{shape:{type:"rect",x:u,y:0,width:l,height:a},fill:{type:"linear",x1:u,y1:0,x2:l+u,y2:0,colors:m.map((S,C)=>({color:S.color,offset:n&&"ratio"in S?S.ratio:C/o}))},stroke:{width:0}},{shape:{type:"path",path:`M${l+u} 0 L${d} ${a/2} L${l+u} ${a} Z`},fill:m[p].color,stroke:{width:0}}]],y=iV(_,d,a),v={filter:mE(i)??void 0,opacity:t==null?void 0:`${t}`},x={justifyContent:"center"};return A("div",{class:Oe.layerRow,styles:x},A("div",{class:Oe.rampLabel},this._getRampStopLabel(m[0],s)),A("div",{class:Oe.symbolContainer},A("div",{styles:v},y),g),A("div",{class:Oe.rampLabel},this._getRampStopLabel(m[p],s)))}};c([h()],za.prototype,"activeLayerInfos",void 0),c([h()],za.prototype,"headingLevel",void 0),c([h()],za.prototype,"layout",void 0),c([h(),yr("esri/widgets/Legend/t9n/Legend")],za.prototype,"messages",void 0),c([h(),yr("esri/t9n/common")],za.prototype,"messagesCommon",void 0),c([h({readOnly:!0})],za.prototype,"type",void 0),c([h()],za.prototype,"view",void 0),c([cu()],za.prototype,"_selectSection",null),za=c([w("esri.widgets.Legend.styles.Card")],za);var L1=za;var ui="esri-legend",Je={service:`${ui}__service`,label:`${ui}__service-label`,layer:`${ui}__layer`,groupLayer:`${ui}__group-layer`,groupLayerChild:`${ui}__group-layer-child`,layerTable:`${ui}__layer-table`,layerTableSizeRamp:`${ui}__layer-table--size-ramp`,layerChildTable:`${ui}__layer-child-table`,layerCaption:`${ui}__layer-caption`,layerBody:`${ui}__layer-body`,layerRow:`${ui}__layer-row`,layerCell:`${ui}__layer-cell`,layerInfo:`${ui}__layer-cell ${ui}__layer-cell--info`,imageryLayerStretchedImage:`${ui}__imagery-layer-image--stretched`,imageryLayerCellStretched:`${ui}__imagery-layer-cell--stretched`,imageryLayerInfoStretched:`${ui}__imagery-layer-info--stretched`,symbolContainer:`${ui}__layer-cell ${ui}__layer-cell--symbols`,symbol:`${ui}__symbol`,rampContainer:`${ui}__ramps`,sizeRamp:`${ui}__size-ramp`,colorRamp:`${ui}__color-ramp`,opacityRamp:`${ui}__opacity-ramp`,borderlessRamp:`${ui}__borderless-ramp`,rampTick:`${ui}__ramp-tick`,rampFirstTick:`${ui}__ramp-tick-first`,rampLastTick:`${ui}__ramp-tick-last`,rampLabelsContainer:`${ui}__ramp-labels`,rampLabel:`${ui}__ramp-label`,message:`${ui}__message`,univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label"};var zie=`${ui}__`,Uie=24,vW={display:"flex",alignItems:"flex-start"},IO={marginLeft:"3px"},Rg={display:"table-cell",verticalAlign:"middle"},pm=class extends Jr{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){let e=this.activeLayerInfos,t=e?.toArray().map(i=>this._renderLegendForLayer(i)).filter(i=>!!i);return A("div",null,t?.length?t:A("div",{class:Je.message},this.messages.noLegend))}_renderLegendForLayer(e,t){if(!e.ready)return null;let i=!!e.children.length,r=`${e.layer.uid}-version-${e.version}`,s=`${zie}${t?`${t}-`:""}${r}`,n=e.title?pp({level:this.headingLevel,class:this.classes(st.heading,Je.label)},e.title):null;if(i){let o=e.children.map(a=>this._renderLegendForLayer(a,r)).toArray();return A("div",{class:this.classes(Je.service,Je.groupLayer),key:s},n,o)}{let o=e.legendElements;if(o&&!o.length)return null;let a=o.map(d=>this._renderLegendForElement(d,e.layer,e.effectList,s)).filter(d=>!!d);if(!a.length)return null;let l={[Je.groupLayerChild]:!!e.parent};return A("div",{class:this.classes(Je.service,l),key:s},n,A("div",{class:Je.layer},a))}}_renderLegendForElement(e,t,i,r,s){let n=e.type==="color-ramp",o=e.type==="opacity-ramp",a=e.type==="size-ramp",l=null,d=`${r}-${e.type}`;if(e.type==="symbol-table"||a){let _=e.infos.map(y=>this._renderLegendForElementInfo(y,t,i,a,e.legendType,d)).filter(y=>!!y);_.length&&(l=A("div",{class:Je.layerBody},_))}else e.type==="color-ramp"||e.type==="opacity-ramp"||e.type==="heatmap-ramp"||e.type==="stretch-ramp"?l=this._renderLegendForRamp(e,t.opacity,d):e.type==="relationship-ramp"?l=F0(e,this.id,{opacity:t.opacity,effectList:i,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:d}):e.type==="pie-chart-ramp"?l=this._renderPieChartRamp(e,d):e.type==="univariate-above-and-below-ramp"?l=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,i,d):e.type==="univariate-color-size-ramp"&&(l=this._renderUnivariateColorSizeRamp(e,t.opacity,i,d));if(!l)return null;let u=e.title,m=null;if(typeof u=="string")m=u;else if(u){let _=Wl(this.messages,u,n||o);m=AO(u,n||o)&&u.title?`${u.title} (${_})`:_}let p=s?Je.layerChildTable:Je.layerTable,f=m?A("div",{class:Je.layerCaption},m):null,g={[Je.layerTableSizeRamp]:a||!s};return A("div",{class:this.classes(p,g),key:`${r}-table`},f,l)}_renderPieChartRamp(e,t){return A("div",{afterCreate:Wr,bind:e.preview,key:`${t}-preview`})}_renderUnivariateAboveAndBelowRamp(e,t,i,r){let{sizeRampElement:s,colorRampElement:n}=D1(e,t);if(!s)return null;let o=this.messages?.previewColorRampAriaLabel,a=Ph(s,"above",!0),l=Ph(s,"below",!0),d=12,u=Dh(n,{width:d,height:a,rampAlignment:"vertical",opacity:t,type:"above",effectList:i,ariaLabel:o}),m=Dh(n,{width:d,height:l,rampAlignment:"vertical",opacity:t,type:"below",effectList:i,ariaLabel:o}),p=Mg(s),f=s.infos.map(R=>R.label),g=f.map((R,D)=>D===0?A("div",{class:R?u?Je.univariateAboveAndBelowLabel:Je.rampLabel:void 0,key:`${r}-color-ramp-above-label-${R??D}`},R):D===2?A("div",null):null),_=f.length-1,y=Math.floor(f.length/2),v=f.map((R,D)=>D===y||D===_?A("div",{class:R?u?Je.univariateAboveAndBelowLabel:Je.rampLabel:void 0,key:`${r}-color-ramp-below-label-${R??D}`},R):null),x={display:"table-cell",verticalAlign:"middle"},S={marginTop:`${p}px`},C={height:`${a}px`},E={height:`${l}px`};return A("div",{key:`${r}-container`,styles:vW},A("div",{class:Je.layerBody},s.infos.map((R,D)=>A("div",{class:this.classes(Je.layerRow,Je.sizeRamp),key:`${r}-row-${D}`},A("div",{afterCreate:Wr,bind:R.preview,class:Je.symbol,styles:x}),u||D%2!=0?null:A("div",{class:Je.layerInfo},f[D])))),u?A("div",{styles:S},A("div",{styles:IO},A("div",{styles:Rg},A("div",{afterCreate:Wr,bind:u,class:Je.rampContainer})),A("div",{styles:Rg},A("div",{class:Je.rampLabelsContainer,styles:C},g))),A("div",{styles:IO},A("div",{styles:Rg},A("div",{afterCreate:Wr,bind:m,class:Je.rampContainer})),A("div",{styles:Rg},A("div",{class:Je.rampLabelsContainer,styles:E},v)))):null)}_renderUnivariateColorSizeRamp(e,t,i,r){let{sizeRampElement:s,colorRampElement:n}=P1(e);if(!s)return null;let o=Mg(s),a=12,l=Ph(s,"full",!1),d=Dh(n,{width:a,height:l,rampAlignment:"vertical",opacity:t,type:"full",effectList:i,ariaLabel:this.messages?.previewColorRampAriaLabel}),u=s.infos.length-1,m=s.infos.map((_,y)=>y===0||y===u?A("div",{class:_.label?n?Je.univariateAboveAndBelowLabel:Je.rampLabel:void 0,key:`${r}-color-ramp-label-${_.label??y}`},_.label):null),p={display:"table-cell",verticalAlign:"middle"},f={marginTop:`${o}px`},g={height:`${l}px`};return A("div",{key:`${r}-container`,styles:vW},A("div",{class:Je.layerBody},s.infos.map((_,y)=>A("div",{class:this.classes(Je.layerRow,Je.sizeRamp),key:`${r}-row-${y}`},A("div",{afterCreate:Wr,bind:_.preview,class:Je.symbol,styles:p})))),A("div",{styles:f},A("div",{styles:IO},A("div",{styles:Rg},A("div",{afterCreate:Wr,bind:d,class:Je.rampContainer})),A("div",{styles:Rg},A("div",{class:Je.rampLabelsContainer,styles:g},m)))))}_renderLegendForRamp(e,t,i){let r=e.infos,s=e.type==="opacity-ramp",n=e.type==="heatmap-ramp",o=e.type==="stretch-ramp",a=e.preview,l=s?Je.opacityRamp:"";a.className=`${Je.colorRamp} ${l}`,t!=null&&(a.style.opacity=t.toString());let d=r.map((p,f)=>A("div",{class:p.label?Je.rampLabel:void 0,key:`${i}-stop-${p.label??f}-label`},n?this.messages[p.label]||p.label:o?k1(p,this.messages):p.label)),u={width:`${Uie}px`},m={height:a.style.height};return A("div",{class:Je.layerRow,key:`${i}-row`},A("div",{class:Je.symbolContainer,styles:u},A("div",{afterCreate:Wr,bind:a,class:Je.rampContainer})),A("div",{class:Je.layerInfo},A("div",{class:Je.rampLabelsContainer,styles:m},d)))}_renderLegendForElementInfo(e,t,i,r,s,n){let o=`${n}-${e.label}`;if(e.type)return this._renderLegendForElement(e,t,i,o,!0);let a=null,l=O1(t,s);if(e.preview?a=A("div",{afterCreate:Wr,bind:e.preview,class:Je.symbol}):e.src&&(a=this._renderImage(e,t,l)),!a)return null;let d={[Je.imageryLayerInfoStretched]:l},u={[Je.imageryLayerInfoStretched]:l,[Je.sizeRamp]:!l&&r};return A("div",{class:Je.layerRow,key:`${o}-row`},A("div",{class:this.classes(Je.symbolContainer,u)},a),A("div",{class:this.classes(Je.layerInfo,d)},Wl(this.messages,e.label,!1)||""))}_renderImage(e,t,i){let{label:r,src:s,opacity:n}=e,o={[Je.imageryLayerStretchedImage]:i,[Je.symbol]:!i},a={opacity:`${n??t.opacity}`};return A("img",{alt:Wl(this.messages,r,!1),"aria-label":Wl(this.messages,r,!1),border:0,class:this.classes(o),height:e.height,src:s,styles:a,width:e.width})}};c([h()],pm.prototype,"activeLayerInfos",void 0),c([h()],pm.prototype,"headingLevel",void 0),c([h(),yr("esri/widgets/Legend/t9n/Legend")],pm.prototype,"messages",void 0),c([h({readOnly:!0})],pm.prototype,"type",void 0),pm=c([w("esri.widgets.Legend.styles.Classic")],pm);var fm=pm;var Hie={base:"esri-legend"},ys=class extends Jr{constructor(e,t){super(e,t),this.headingLevel=3,this.messages=null,this.style=new fm,this.viewModel=new gW}initialize(){this.addHandles([xi(()=>this.view,"resize",()=>this.scheduleRender()),xi(()=>this.activeLayerInfos,"change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),T(()=>this.headingLevel,e=>{let{style:t}=this;t&&(t.headingLevel=e)}),T(()=>this.style,(e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,e.type==="card"&&(e.view=this.view),e.headingLevel=this.headingLevel)},ie)])}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(e){this.viewModel.activeLayerInfos=e}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(e){this.viewModel.basemapLegendVisible=e}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(e){this.viewModel.groundLegendVisible=e}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(e){this.viewModel.hideLayersNotInCurrentView=e}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(e){this.viewModel.keepCacheOnDestroy=e}get respectLayerDefinitionExpression(){return this.viewModel.respectLayerDefinitionExpression}set respectLayerDefinitionExpression(e){this.viewModel.respectLayerDefinitionExpression=e}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(e){this.viewModel.respectLayerVisibility=e}get icon(){return"legend"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}castStyle(e){if(e instanceof L1||e instanceof fm)return e;if(typeof e=="string")return e==="card"?new L1:new fm;if(e&&typeof e.type=="string"){let t=I({},e);return delete t.type,new(e.type==="card"?L1:fm)(t)}return new fm}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return A("div",{class:this.classes(Hie.base,st.widget,this.style instanceof fm?st.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){e.forEach(t=>{this.removeHandles(`version_${t.layer.uid}`),this._renderOnActiveLayerInfoChange(t)}),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){let t=T(()=>e.version,()=>this.scheduleRender());this.addHandles(t,`version_${e.layer.uid}`);let i=xi(()=>e.children,"change",()=>e.children.forEach(r=>this._renderOnActiveLayerInfoChange(r)),ie);this.addHandles(i,`version_${e.layer.uid}`),e.children.forEach(r=>this._renderOnActiveLayerInfoChange(r))}};c([h()],ys.prototype,"activeLayerInfos",null),c([h()],ys.prototype,"basemapLegendVisible",null),c([h()],ys.prototype,"groundLegendVisible",null),c([h()],ys.prototype,"headingLevel",void 0),c([h()],ys.prototype,"hideLayersNotInCurrentView",null),c([h()],ys.prototype,"keepCacheOnDestroy",null),c([h()],ys.prototype,"respectLayerDefinitionExpression",null),c([h()],ys.prototype,"respectLayerVisibility",null),c([h()],ys.prototype,"icon",null),c([h()],ys.prototype,"label",null),c([h()],ys.prototype,"layerInfos",null),c([h(),yr("esri/widgets/Legend/t9n/Legend")],ys.prototype,"messages",void 0),c([h()],ys.prototype,"style",void 0),c([Lr("style")],ys.prototype,"castStyle",null),c([h()],ys.prototype,"view",null),c([h()],ys.prototype,"viewModel",void 0),ys=c([w("esri.widgets.Legend")],ys);var bW=ys;var ji="esri-search",Ei={base:ji,hasMultipleSources:`${ji}--multiple-sources`,isLoading:`${ji}--loading`,isSearching:`${ji}--searching`,showSuggestions:`${ji}--show-suggestions`,showSources:`${ji}--sources`,showWarning:`${ji}--warning`,container:`${ji}__container`,input:`${ji}__input`,inputContainer:`${ji}__input-container`,form:`${ji}__form`,submitButton:`${ji}__submit-button`,sourcesButton:`${ji}__sources-button`,sourcesButtonDown:`${ji}__sources-button--down`,sourcesButtonUp:`${ji}__sources-button--up`,clearButton:`${ji}__clear-button`,sourceName:`${ji}__source-name`,suggestionsMenu:`${ji}__suggestions-menu`,suggestionList:`${ji}__suggestions-list`,suggestionListCurrentLocation:`${ji}__suggestions-list--current-location`,sourcesMenu:`${ji}__sources-menu`,source:`${ji}__source`,warningMenu:`${ji}__warning-menu`,warningMenuBody:`${ji}__warning-body`,warningMenuHeader:`${ji}__warning-header`,warningMenuText:`${ji}__warning-text`,noValueText:`${ji}__no-value-text`};var gm="esri-search-result-renderer",Oh={base:gm,showMoreResults:`${gm}__more-results--show-more-results`,moreResults:`${gm}__more-results`,moreResultsList:`${gm}__more-results-list`,moreResultsHeader:`${gm}__more-results-header`,moreResultsItem:`${gm}__more-results-item`,moreResultsListHeader:`${gm}__more-results-list-header`};var $r=class extends LL(Wi){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};c([h()],$r.prototype,"autoNavigate",void 0),c([h()],$r.prototype,"filter",void 0),c([h()],$r.prototype,"getResults",void 0),c([h()],$r.prototype,"getSuggestions",void 0),c([h()],$r.prototype,"maxResults",void 0),c([h()],$r.prototype,"maxSuggestions",void 0),c([h()],$r.prototype,"minSuggestCharacters",void 0),c([h()],$r.prototype,"outFields",void 0),c([h()],$r.prototype,"placeholder",void 0),c([h()],$r.prototype,"popupEnabled",void 0),c([h()],$r.prototype,"popupTemplate",void 0),c([h()],$r.prototype,"prefix",void 0),c([h()],$r.prototype,"resultGraphicEnabled",void 0),c([h()],$r.prototype,"resultSymbol",void 0),c([h()],$r.prototype,"suggestionsEnabled",void 0),c([h()],$r.prototype,"suffix",void 0),c([h()],$r.prototype,"withinViewEnabled",void 0),c([h()],$r.prototype,"zoomScale",void 0),$r=c([w("esri.widgets.Search.SearchSource")],$r);var Ag=$r;var jie=/https?:\/\/services.*\.arcgis\.com/i,Gie=/(?:\{([^}]+)\})/g,Ig=()=>V.getLogger("esri.widgets.Search.support.layerSearchUtils");function wW(e,t){let{exactMatch:i=!1,location:r,maxResults:s,spatialReference:n,source:o,sourceIndex:a,suggestResult:l,view:d}=e,{layer:u,filter:m,zoomScale:p}=o,f=d?.scale,g=CW(o,d),_=t?.signal;return TW(u).then(()=>{let y=u.popupTemplate;return y?y.getRequiredFields(u.fieldsIndex):null}).then(y=>{let{objectIdField:v,returnZ:x}=u,S=DW(o);if(!DO(u,S))throw Ig().error("invalid-field: displayField is invalid."),new le("getResults():invalid-field","displayField is invalid.");let C=y?.length?y:[S],E=o.outFields||C,R=SW(E);if(E.includes(v)||R||E.push(v),u.floorInfo?.floorField&&E.push(u.floorInfo.floorField),!(R||F1(u,E)))throw Ig().error("invalid-field: outField is invalid."),new le("getResults():invalid-field","outField is invalid.");let D=u.createQuery(),{orderByFields:L}=o;if(L&&(D.orderByFields=L),n){D.outSpatialReference=n;let B=1/Zh(n);B&&(D.maxAllowableOffset=B)}let O=u.geometryType==="mesh"||u.geometryType==="multipatch",H=u.capabilities?.data?.supportsZ&&!O;if(D.returnZ=H&&x!==!1,D.returnGeometry=!0,D.multipatchOption=O?"xyFootprint":null,E&&(D.outFields=E),r)D.geometry=r;else if(l.key)D.objectIds=[l.key];else{let B=o.searchFields||[S];if(!F1(u,B))throw Ig().error("invalid-field: search field is invalid."),new le("getResults():invalid-field","search field is invalid.");if(IW(u)&&(D.num=s),g&&(D.geometry=g),!l.text?.trim())return[];let Y=l.text,{prefix:N="",suffix:F=""}=o,me=PW(`${N}${Y}${F}`);AW(u)&&EW(u,B)&&!i&&Y&&(D.fullText=RW({text:Y,searchFields:B}));let $=OW({searchTerm:me,layer:u,searchFields:B,filter:m,exactMatch:i,query:D,type:"search"});if(D.where=$,!MW(D))return[]}return u.queryFeatures(D,{signal:_}).then(B=>ire(B,d,o,a,S,f,p))})}function xW(e,t){let{source:i,spatialReference:r,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a,exactMatch:l}=e,{layer:d,filter:u}=i,m=t?.signal,p=CW(i,s);return TW(d).then(()=>{if(!IW(d))return[];let f=DW(i),g=i.searchFields||[f],_=[];i.suggestionTemplate?i.suggestionTemplate.replaceAll(Gie,(H,B)=>(_.push(B),H)):_.push(f);let y=SW(_);_.includes(d.objectIdField)||y||_.push(d.objectIdField);let v=DO(d,f),x=y||F1(d,_),S=F1(d,g);if(!v)throw Ig().error("invalid-field: displayField is invalid."),new le("getSuggestions():invalid-field","displayField is invalid.");if(!x)throw Ig().error("invalid-field: outField is invalid."),new le("getSuggestions():invalid-field","outField is invalid.");if(!S)throw Ig().error("invalid-field: search field is invalid."),new le("getSuggestions():invalid-field","search field is invalid.");let C=d.createQuery(),{orderByFields:E}=i;if(E&&(C.orderByFields=E),C.outSpatialReference=r,C.returnGeometry=!1,C.num=o,C.outFields=_,p&&(C.geometry=p),!n.trim())return[];let{prefix:R="",suffix:D=""}=i,L=PW(`${R}${n}${D}`);AW(d)&&EW(d,g)&&!l&&n&&(C.fullText=RW({text:n,searchFields:g}));let O=OW({searchTerm:L,layer:d,searchFields:g,filter:u,exactMatch:l,query:C,type:"suggest"});return C.where=O,MW(C)?d.queryFeatures(C,{signal:m}).then(H=>Jie(H,i,a,f)):[]})}function CW(e,t){let{filter:i,withinViewEnabled:r}=e,s=t?.extent;return i?.geometry??(r&&s?s:void 0)}function SW(e){return e&&e.includes("*")}function TW(e){return P(this,null,function*(){e&&(yield e.load())})}function MW(e){return!(!e.fullText&&!e.where)}function EW(e,t){let i=e?.indexes;return!i||!t?.length?!1:i.filter(r=>r.indexType==="FullText").some(r=>{let s=r.fields?.split(",").map(n=>n.trim().toLowerCase())||[];return t.every(n=>s.includes(n.toLowerCase()))})}function RW({text:e,searchFields:t}){return e.trim().split(" ").filter(i=>!!i.trim()).map(i=>new o2({onFields:t,searchTerm:i,searchType:"prefix"}))}function AW(e){return e?.capabilities?.query?.supportsFullTextSearch??!1}function IW(e){return e?.capabilities?.query?.supportsPagination??!1}function qie(e){return e?.fieldsIndex?.fields?.find(t=>t.type==="string")?.name??""}function DW(e){return e.displayField||e.layer.displayField||qie(e.layer)}function F1(e,t){return!(!e||!t?.length)&&t.every(i=>DO(e,i))}function DO(e,t){return!!e.getField(t)}function Wie(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}function $ie({codedValues:e},t,i){return Kg(e??[],r=>{let s=r.name,n=i?s:s.toLowerCase();return(i?t:t.toLowerCase())===n?r.code.toString():null})??null}function PW(e){return e.replaceAll("'","''")}function db(e,t){let i=t?.where;return i?`(${e}) AND (${i})`:e}function Zie({currentTerm:e,field:t,filter:i,exactMatch:r,url:s,type:n}){let o=t?.type,a=t?.name;if(o==="string"||o==="date"||o==="global-id"){let l=jie.test(s??""),d=l&&Wie(e)?"N":"";return db(r&&n==="search"?`${a} = ${d}'${e}'`:l?`${a} LIKE ${d}${`'${e}%'`}`:`${`LOWER(${a})`} LIKE ${d}${`'${e.toLowerCase()}%'`}`,i)}if(o==="oid"||o==="small-integer"||o==="integer"||o==="single"||o==="double"){let l=Number(e);return isNaN(l)?null:db(`${a} = ${l}`,i)}return db(`${a} = ${e}`,i)}function Qie(e,t){return e?` OR (${t})`:`(${t})`}function OW({searchTerm:e,layer:t,searchFields:i,filter:r,exactMatch:s,query:n,type:o}){let{definitionExpression:a,url:l}=t,d="";return!n.fullText&&e&&i&&i.forEach(u=>{let m=t.getField(u),p=t.getFieldDomain?.(u,{excludeImpliedDomains:Qe("esri-widget-legacy-field-domain-calculation")}),f=(p&&p.type==="coded-value"?$ie(p,e,s):null)||e||null;if(f!==null){let g=Zie({currentTerm:f,field:m,filter:r,exactMatch:s,url:l,type:o});g&&(d+=Qie(d,g))}}),a&&d?`(${a}) AND (${d})`:a||d}function Kie(e,t){let i=null,{codedValues:r}=e;return r&&r.length&&r.some(s=>s.code===t&&(i=s.name,!0)),i}function Yie(e,t){return e[t]??e[Object.keys(e).find(i=>i.toLowerCase()===t.toLowerCase())]}function kW(e,t,i){let r=e.sourceLayer,{attributes:s}=e,n=r.getFieldDomain?.(i,{feature:e,excludeImpliedDomains:Qe("esri-widget-legacy-field-domain-calculation")});if(t)return ca(t,s);if(i&&s){let o=r.getField(i),a=Yie(s,i);return a==null?"":n&&n.type==="coded-value"?Kie(n,a)??"":o?.type==="date"?IM(new Date(a)):typeof a=="number"?a.toString():typeof a!="string"?"":a.trim()}return""}function Xie(e,t,i,r){let s=e.sourceLayer,{attributes:n}=e,{objectIdField:o}=s,a=o?n[o]:null;return{text:kW(e,t.suggestionTemplate,r),key:a,sourceIndex:i}}function Jie(e,t,i,r){return e.features.map(s=>Xie(s,t,i,r))}function ere(e){return e!=null&&e.minScale!=null&&e.maxScale!=null}function tre(e,t,i,r,s,n,o){let a=e.clone(),l=e.sourceLayer,d=l?.objectIdField,u=d?e.attributes[d]:null,m=kW(e,i.searchTemplate,s);n!=null&&ere(l)&&(l.minScale&&l.minScale<n?n=l.minScale:l.maxScale&&l.maxScale>n&&(n=l.maxScale));let p=a.geometry?R_(a.geometry,t??void 0,n??void 0):void 0,f=typeof o=="number"&&p?E_(Xr(p),t??void 0,o):p,g=e.clone();return f!=null&&(g.geometry=Xa.fromExtent(f)),{extent:f,target:g,feature:a,key:u,name:m,sourceIndex:r}}function ire(e,t,i,r,s,n,o){return e.features.map(a=>tre(a,t,i,r,s,n,o))}var PO,Ua=PO=class extends Ag{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(t,i)=>wW(I({source:this},t),i),this.getSuggestions=(t,i)=>xW(I({source:this},t),i)}set layer(e){this._set("layer",e),e&&e.load().catch(()=>{})}get name(){return this._getLayerTitle()??""}set name(e){this._overrideIfSome("name",e)}clone(){return new PO({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?Xr(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?Xr(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){return this.layer.fieldsIndex?.fields.find(e=>e.type==="string")?.name??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){let{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map(i=>e.getField(i)?.alias||i).join(", ")}`:""}_getLayerTitle(){let{layer:e}=this;if(!e)return;let{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};c([h({json:{read:{source:"field.name"},write:{target:"field.name"}}})],Ua.prototype,"displayField",void 0),c([h({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],Ua.prototype,"exactMatch",void 0),c([h({value:null})],Ua.prototype,"layer",null),c([h()],Ua.prototype,"name",null),c([h({type:[String],json:{write:!0}})],Ua.prototype,"orderByFields",void 0),c([h()],Ua.prototype,"searchFields",void 0),c([h()],Ua.prototype,"searchTemplate",void 0),c([h()],Ua.prototype,"suggestionTemplate",void 0),Ua=PO=c([w("esri.widgets.Search.LayerSearchSource")],Ua);var _m=Ua;function LW(e){return!!e&&typeof e.x=="number"&&typeof e.y=="number"}function FW(e){return e&&typeof e.xmin=="number"&&typeof e.ymin=="number"&&typeof e.xmax=="number"&&typeof e.ymax=="number"}var kh=class extends Wi{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};c([h({type:String,json:{write:!0}})],kh.prototype,"address",void 0),c([h({type:Object,json:{write:!0}})],kh.prototype,"attributes",void 0),c([h({type:vi,json:{write:!0}})],kh.prototype,"extent",void 0),c([h({type:je,json:{write:!0}})],kh.prototype,"location",void 0),c([h({type:Number,json:{write:!0}})],kh.prototype,"score",void 0),kh=c([w("esri.rest.support.AddressCandidate")],kh);var N1=kh;var Bs=class extends Wi{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};c([h({type:Object,json:{write:!0}})],Bs.prototype,"address",void 0),c([h(mp)],Bs.prototype,"apiKey",void 0),c([h({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],Bs.prototype,"categories",void 0),c([h({type:String,json:{write:!0}})],Bs.prototype,"countryCode",void 0),c([h({type:Boolean,json:{write:!0}})],Bs.prototype,"forStorage",void 0),c([h({type:je,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],Bs.prototype,"location",void 0),c([h({type:String,json:{write:!0}})],Bs.prototype,"locationType",void 0),c([h({type:String,json:{write:!0}})],Bs.prototype,"magicKey",void 0),c([h({type:Number,json:{write:!0}})],Bs.prototype,"maxLocations",void 0),c([h({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],Bs.prototype,"outFields",void 0),c([h({type:gt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Bs.prototype,"outSpatialReference",void 0),c([h({type:vi,json:{write:{writer:(e,t)=>{let i=e?e.shiftCentralMeridian():null;t.searchExtent=i}}}})],Bs.prototype,"searchExtent",void 0),Bs=c([w("esri.rest.support.AddressToLocationsParameters")],Bs),Bs.from=Qa(Bs);var V1=Bs;function NW(e,t,i){return P(this,null,function*(){t=V1.from(t);let r=Gm(e),u=t.toJSON(),{address:s}=u,n=$1(u,["address"]),o=se(I(I({},s),n),{f:"json"}),a=qm(I(I({},r.query),o)),l=jm(a,i),d=`${r.path}/findAddressCandidates`;return jn(d,l).then(rre)})}function rre({data:e}){if(!e)return[];let{candidates:t,spatialReference:i}=e;return t?t.map(r=>{if(!r)return;let{extent:s,location:n}=r,o=!s||FW(s);return LW(n)&&o?(s&&(s.spatialReference=i),n&&(n.spatialReference=i),N1.fromJSON(r)):void 0}):[]}var $c=class extends Wi{constructor(e){super(e),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};c([h(mp)],$c.prototype,"apiKey",void 0),c([h({type:je,json:{write:{writer:(e,t)=>{let i=e?e.clone().normalize():null,r=i!==void 0;t.location=r?i:null}}}})],$c.prototype,"location",void 0),c([h({type:String,json:{write:!0}})],$c.prototype,"locationType",void 0),c([h({type:gt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],$c.prototype,"outSpatialReference",void 0),$c=c([w("esri.rest.support.LocationToAddressParameters")],$c),$c.from=Qa($c);var B1=$c;function VW(e,t,i){return P(this,null,function*(){t=B1.from(t);let r=Gm(e),s=se(I({},t.toJSON()),{f:"json"}),n=qm(I(I({},r.query),s)),o=jm(n,i),a=`${r.path}/reverseGeocode`;return jn(a,o).then(sre)})}function sre({data:e}){if(!e)return;let{address:t,location:i}=e,r=t?.Match_addr||"";return N1.fromJSON({address:r,attributes:t||{},location:i,score:100})}var Dg=class extends Wi{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};c([h({type:Boolean,json:{write:!0}})],Dg.prototype,"isCollection",void 0),c([h({type:String,json:{write:!0}})],Dg.prototype,"magicKey",void 0),c([h({type:String,json:{write:!0}})],Dg.prototype,"text",void 0),Dg=c([w("esri.rest.support.SuggestionCandidate")],Dg);var BW=Dg;var mo=class extends Wi{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};c([h(mp)],mo.prototype,"apiKey",void 0),c([h({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],mo.prototype,"categories",void 0),c([h({type:String,json:{write:!0}})],mo.prototype,"countryCode",void 0),c([h({type:je,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],mo.prototype,"location",void 0),c([h({type:Number,json:{write:!0}})],mo.prototype,"maxSuggestions",void 0),c([h({type:gt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],mo.prototype,"outSpatialReference",void 0),c([h({type:vi,json:{write:{writer:(e,t)=>{let i=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(i)}}}})],mo.prototype,"searchExtent",void 0),c([h({type:String,json:{write:!0}})],mo.prototype,"text",void 0),mo=c([w("esri.rest.support.SuggestLocationsParameters")],mo),mo.from=Qa(mo);var z1=mo;function zW(e,t,i){return P(this,null,function*(){let r=Gm(e),s=se(I({},(t=z1.from(t)).toJSON()),{f:"json"}),n=qm(I(I({},r.query),s)),o=jm(n,i),a=`${r.path}/suggest`;return jn(a,o).then(nre)})}function nre(e){let{data:t}=e;if(!t)return[];let{suggestions:i}=t;return i?i.map(r=>new BW(r)):[]}var ore="Single Line Input",are=3e5;function UW(e,t){return e.location?lre(e,t):cre(e,t)}function HW(e,t){if(t.localSearchDisabled)return null;let i=e?.scale;return typeof i=="number"&&i<=are?e?.extent?.center:null}function jW(e,t){return P(this,null,function*(){let{source:i,spatialReference:r,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a}=e,l=new z1,{apiKey:d,url:u}=i,m=$W(i,s),p=t?.signal;if(!u)return null;d&&(l.apiKey=d),i.categories&&(l.categories=i.categories),r&&(l.outSpatialReference=r);let f=HW(s,i);if(f&&(l.location=f),!n.trim())return null;let{prefix:g="",suffix:_=""}=i,y=`${g}${n}${_}`;return l.text=y,m&&(l.searchExtent=m),l.maxSuggestions=o,i.countryCode&&(l.countryCode=i.countryCode),zW(u,l,{signal:p}).then(v=>hre(v,a))})}function GW(e){return!!e&&/(?:geocode-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function qW(e){return!!e&&/(?:\/servers\/[\da-z.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}function OO(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}var WW="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";function lre(e,t){return P(this,null,function*(){let{source:i,spatialReference:r,location:s,sourceIndex:n,view:o}=e,{apiKey:a,url:l,zoomScale:d,defaultZoomScale:u}=i;if(l==null)return[];let m=o?.scale,p=t?.signal,f=new B1({location:s});a&&(f.apiKey=a),r&&(f.outSpatialReference=r);try{return ZW([yield VW(l,f,{signal:p})],{sourceIndex:n,scale:m,view:o,zoomScale:d,defaultZoomScale:u})}catch{return[]}})}function $W(e,t){let{filter:i,withinViewEnabled:r}=e,s=t?.scale,n=t?.extent,o=i?.geometry;return(o?R_(o,t??void 0,s):void 0)||(r&&n?n:void 0)}function cre(e,t){return P(this,null,function*(){let{source:i,suggestResult:r,spatialReference:s,view:n,maxResults:o,sourceIndex:a}=e,l=i?.zoomScale,d=i?.defaultZoomScale;if(!r.text?.trim())return null;let m=!r.key&&i.prefix?i.prefix:"",p=!r.key&&i.suffix?i.suffix:"",f=`${m}${r.text}${p}`,g=new V1,{apiKey:_,url:y}=i,v=n?.scale,x=$W(i,n),S=t?.signal;if(_&&(g.apiKey=_),!y)return null;i.categories&&(g.categories=i.categories),i.locationType&&(g.locationType=i.locationType),s&&(g.outSpatialReference=s);let C=HW(n,i);C&&(g.location=C),g.maxLocations=o,x&&(g.searchExtent=x),i.countryCode&&(g.countryCode=i.countryCode);let{key:E}=r,R=`${E}`;return E&&(g.magicKey=R),g.address={},g.address[i.singleLineFieldName||ore]=f,i.outFields&&(g.outFields=i.outFields),NW(y,g,{signal:S}).then(D=>ZW(D,{key:R,scale:v,sourceIndex:a,view:n,zoomScale:l,defaultZoomScale:d}))})}function dre(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}function hre(e,t){return e.map(i=>dre(i,t))}function ure(e,t){let{key:i,scale:r,sourceIndex:s,view:n,zoomScale:o,defaultZoomScale:a}=t,{attributes:l,extent:d,location:u,address:m}=e,p=new ga({geometry:u,attributes:l}),f=d||u,g=f?R_(f,n??void 0,r??void 0):void 0,_=g?typeof o=="number"?E_(g,n??void 0,o):typeof a=="number"&&f?.type==="point"?E_(g,n??void 0,a):g:null,y=u?`${u.x},${u.y}`:"",v=m||y,x=p.clone();return _!=null&&(x.geometry=Xa.fromExtent(_)),{extent:_,feature:p,target:x,key:i,name:v,sourceIndex:s}}function ZW(e,t){return e.filter(Boolean).map(i=>ure(i,t))}var kO,ln=kO=class extends Ag{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(t,i)=>UW(I({source:this},t),i),this.getSuggestions=(t,i)=>jW(I({source:this},t),i)}clone(){return new kO({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?Xr(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?Xr(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};c([h()],ln.prototype,"apiKey",void 0),c([h()],ln.prototype,"categories",void 0),c([h()],ln.prototype,"countryCode",void 0),c([h({json:{write:!0}})],ln.prototype,"defaultZoomScale",void 0),c([h()],ln.prototype,"localSearchDisabled",void 0),c([h()],ln.prototype,"locationType",void 0),c([h({json:{write:!0}})],ln.prototype,"name",void 0),c([h({json:{write:!0}})],ln.prototype,"placeholder",void 0),c([h()],ln.prototype,"searchTemplate",void 0),c([h({json:{write:!0}})],ln.prototype,"singleLineFieldName",void 0),c([h({json:{read:{source:"suggest"},write:{target:"suggest"}}})],ln.prototype,"suggestionsEnabled",void 0),c([h({json:{write:!0}})],ln.prototype,"url",void 0),c([h({json:{write:!0}})],ln.prototype,"zoomScale",void 0),ln=kO=c([w("esri.widgets.Search.LocatorSearchSource")],ln);var LO=ln;var KW=()=>V.getLogger("esri.widgets.support.geolocationUtils"),mre={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function pre(){let e=!!Qe("esri-geolocation");return e||KW().warn("geolocation-unsupported","Geolocation unsupported."),e}function fre(){let e=window.isSecureContext;return e||KW().warn("insecure-context","Geolocation requires a secure origin."),e}function FO(){return pre()&&fre()}function YW(e){return e??=mre,new Promise((i,r)=>{setTimeout(()=>r(new le("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(i,r,e??void 0)})}var QW;function XW(e,t){if(QW)return QW(e,t);let{position:i,view:r}=e,s=gre(i),n=s?.coords;if(!n)throw new le("geometry-service:no-coords","Geolocation has no coordinates");return yre(_re(n),r,t)}function gre(e){let t=e&&e.coords||{},i={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e&&{coords:i,timestamp:e.timestamp}}function _re({longitude:e,latitude:t,altitude:i}){return new je({longitude:e,latitude:t,z:i||void 0,spatialReference:{wkid:4326}})}function yre(e,t,i){if(!t)return Promise.resolve(e);let r=t.spatialReference;return r.isWGS84?Promise.resolve(e):r.isWebMercator?Promise.resolve(Bb(e)):vre(i).then(s=>{if(!s)throw new le("geometry-service:missing-url","Geometry service URL is missing");let n=new SN({geometries:[e],outSpatialReference:r});return TN(s,n,i).then(o=>o[0])})}function vre(e){if(Qg.geometryServiceUrl)return Promise.resolve(Qg.geometryServiceUrl);let t=M_.getDefault();return t.load(e).catch(()=>{}).then(()=>t.helperServices?.geometry?.url)}function cn(e,t){return e.hasOwnProperty(t)&&e[t]!=null&&e[t]!==""}var bre=()=>kb("esri/widgets/Search/t9n/Search"),JW="highlight",U1=qe.ofType({key:e=>e.layer?"layer":"locator",base:Ag,typeMap:{layer:_m,locator:LO}}),e6=gt.WGS84,wre="esri/images/search/search-symbol-32.png",xre=/<[\s\S]*?>/g,Pg=-1,pt=class extends N0(ti.EventedMixin(k)){constructor(e){super(e),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new U1,this.defaultSymbols={point:new _F({url:t_(wre),size:24,width:24,height:24}),polyline:new h0({color:[130,130,130,1],width:2}),polygon:new ou({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=M_.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new U1,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){let e=()=>P(this,null,function*(){let t=yield bre();this.messages=t,this.defaultPopupTemplate=new XM({title:t.searchResult,content:"{Match_addr}"})});e(),this.addHandles([T(()=>[this.includeDefaultSources,this.view,this.portal],()=>this._update(),ie),km(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return this.allSources.length===1||!this.searchAllEnabled?0:Pg}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){return this.messages?.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){let{sources:e,defaultSources:t,includeDefaultSources:i}=this,r=typeof i=="function"?i.call(null,{sources:e,defaultSources:t}):i?t.concat(e):e,s=this._get("allSources")||new U1;return s.removeAll(),s.addMany(r.filter(Boolean)),s}get locationEnabled(){return this._get("locationEnabled")||FO()}set locationEnabled(e){if(e===void 0)return void this._clearOverride("locationEnabled");let t=FO();if(e&&!t){let i=new le("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});V.getLogger(this).error(i)}this._override("locationEnabled",!!e&&t)}get placeholder(){let{allSources:e,activeSourceIndex:t,allPlaceholder:i}=this;return t===Pg?i??"":e.at(t)?.placeholder??""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),e===""&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":this.allSources.length===0?"disabled":"ready"}get updating(){return this._updatingPromise!=null}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();let{view:e,resultGraphic:t}=this;e&&t&&e.graphics.remove(t),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();let i=this._createSuggestionForSearch(e),r=P(this,null,function*(){try{yield this.when();let s=yield this._getResultsFromSources(i,t);if(t?.signal?.aborted)return null;let n={activeSourceIndex:this.activeSourceIndex,searchTerm:i.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(n,s,i);let o=this._getFirstResult(n.results),a=i.location&&o?o.name:i.text,l=a?.replace(xre,"");return this._set("searchTerm",l),(i.key&&typeof i.sourceIndex=="number"||i.location)&&this._set("selectedSuggestion",i),this._set("results",n.results),this._set("resultCount",n.results.reduce((d,u)=>d+(u.results?.length??0),0)),this.emit("search-complete",n),yield this._selectFirstResult(o),n}finally{this._clearSearching()}});return this._searching=r,r}searchNearby(e){return P(this,null,function*(){if(!this.locationEnabled){let i=new le("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw V.getLogger(this).error(i),i}let t=P(this,null,function*(){try{let i=yield YW(),r=yield XW({position:i,view:this.view},e);return yield this.search(r,e)}finally{this._clearSearching()}});return this._searching=t,t})}select(e){return P(this,null,function*(){if(this.clearGraphics(),!e){let O=new le("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});throw V.getLogger(this).error(O),O}let{view:t}=this,i=cn(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),r=i!=null?this.allSources.at(i):null;if(!r){let O=new le("select:missing-source","Cannot select without a source.",{source:r});throw V.getLogger(this).error(O),O}let s=r instanceof _m?this._getLayerSourcePopupTemplate(r):r.popupTemplate,n=r.resultSymbol||this._getDefaultSymbol(e),o=cn(r,"resultGraphicEnabled")?r.resultGraphicEnabled:this.resultGraphicEnabled,a=cn(r,"autoNavigate")?r.autoNavigate:this.autoNavigate,l=cn(r,"popupEnabled")?r.popupEnabled:this.popupEnabled,d=l?s||this.popupTemplate||this.defaultPopupTemplate:null,{feature:u}=e;if(!u){let O=new le("select:missing-feature","Cannot select without a feature.",{feature:u});throw V.getLogger(this).error(O),O}let{attributes:m,geometry:p,layer:f,sourceLayer:g}=u,_=p?fE(p):null,y={layerViewQuery:this._getLayerView(u),elevationQuery:t&&_!=null?UN(_,t):Promise.resolve(_)},v=yield e_(y),x=v.layerViewQuery.value,S=v.elevationQuery.value;n instanceof dF&&(n.text=e.name);let C=t&&a?e.target||e.extent:null;yield C!=null?this._goToSearchResult(C):Promise.resolve();let R=x?u:new ga({geometry:p,symbol:n,attributes:m,layer:f,sourceLayer:g,popupTemplate:d}),D=t?.popup,L=D&&l&&R.getEffectivePopupTemplate(D.defaultPopupTemplateEnabled);return L&&(yield t.openPopup({features:[R],location:S})),x&&BF(x)&&!L&&this._highlightFeature({graphic:R,layerView:x}),!x&&o&&t&&t.graphics.push(R),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",R),this.emit("select-result",{result:e,source:r,sourceIndex:i}),e})}suggest(e,t,i){return P(this,null,function*(){let r=e||this.searchTerm;this.emit("suggest-start",{searchTerm:r}),yield this._suggestTimer(t,i);let s=yield this._suggestImmediate(r,i);return this._set("suggestions",s?.results),this._set("suggestionCount",s?.results.reduce((n,o)=>n+(o.results?.length??0),0)??null),this.emit("suggest-complete",s),s})}when(){return P(this,null,function*(){yield Gs(()=>!this.updating)})}_update(){return P(this,null,function*(){let{portal:e,view:t}=this;if(this.includeDefaultSources){let i=this._updatingPromise=e_([e?.load(),t?.when()]);if(this.destroyed||(yield i,i!==this._updatingPromise))return}yield Gs(()=>this.messages),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null})}_clearSearching(){this._searching=null}_convertHelperServices(){let e=this.portal?.helperServices?.geocode;return e?e.map(t=>{if(t.placefinding===!1)return;let i=Qg.apiKey&&OO(t.url)?{url:WW}:null,r=LO.fromJSON(I(I({},t),i)),s=r.url;if(OO(s)||qW(s)||GW(s)){let n=r.outFields??["Addr_type","Match_addr","StAddr","City"],o=(r.placeholder||this.messages?.placeholder)??"",a=typeof r.defaultZoomScale=="number"?r.defaultZoomScale:2500;r.singleLineFieldName="SingleLine",r.outFields=n,r.placeholder=o,r.defaultZoomScale=a}return r.singleLineFieldName?r:void 0}).filter(Rs):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach(e=>e?.destroy()),this._createdFeatureLayers=[]}_getLayerSources(e,t){let i=this.view?.map;return e.map(r=>{let s=i.findLayerById(r.id);if(!s)return;let n=this._getLayerJSON(r),o=_m.fromJSON(n);return o.placeholder=t,this._getLayer(s,n).then(a=>{o.layer=a}),o}).filter(Rs).toArray()}_getTableSources(e,t){let i=this.view?.map;return e.map(r=>{if(!r.id)return;let s=i.findTableById(r.id);if(!s)return;let n=this._getLayerJSON(r),o=_m.fromJSON(n);return o.placeholder=t,this._getLayer(s,n).then(a=>{o.layer=a}),o}).filter(Rs).toArray()}_convertApplicationProperties(){let e=this.view?.map,t=e?.applicationProperties?.viewing?.search;if(!t)return[];let{enabled:i,hintText:r,layers:s,tables:n}=t;return i?[...this._getLayerSources(s,r),...this._getTableSources(n,r)]:[]}_getSubLayer(e,t){return P(this,null,function*(){if(yield e.load(),!e.allSublayers)throw new Error;let i=e.allSublayers.find(s=>s.id===t.subLayer);if(!i)throw new Error;let r=yield i.createFeatureLayer?.();if(!r)throw new Error;return this._createdFeatureLayers.push(r),r})}_getBuildingSubLayer(e,t){return P(this,null,function*(){yield e.load();let i=e.allSublayers.find(r=>r.id===t.subLayer);if(i?.type!=="building-component")throw new Error;if(yield i.load(),i.associatedLayer==null)throw new Error;return yield i.associatedLayer.load(),i})}_getLayer(e,t){return P(this,null,function*(){if(e.type==="feature"||e.type==="scene"||e.type==="csv"||e.type==="geojson"||e.type==="ogc-feature")return e;if(e.type==="map-image")try{return yield this._getSubLayer(e,t)}catch{let r=new le("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return V.getLogger(this).error(r),null}return e.type==="building-scene"?this._getBuildingSubLayer(e,t):null})}_getLayerJSON(e){return typeof e.toJSON=="function"?e.toJSON():e}_updateDefaultSources(){let{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){let e=this.view?.popup,{resultGraphic:t}=this;if(!e||!t)return;let i="selectedFeature"in e,r=i?e.selectedFeature:null;i&&r&&r===t&&e.close()}_suggestTimer(e,t){let i=e??this.suggestionDelay;return Mb(i,null,t?.signal)}_createLocationForSearch(e){return e instanceof ga&&e.geometry?fE(e.geometry):e instanceof je?e:Array.isArray(e)&&e.length===2?new je({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&cn(e,"key")&&cn(e,"text")&&cn(e,"sourceIndex"))return e;let t=this._createLocationForSearch(e),i=typeof e=="string"?e:this.searchTerm,{selectedSuggestion:r,selectedResult:s}=this,n=!e&&r&&s,o=n&&r.key===s.key&&r.sourceIndex===s.sourceIndex,a=n&&r.location;return o||a?r:{location:t,text:t?"":i,sourceIndex:null,key:null}}_getFirstResult(e){return Kg(e,({results:t})=>t?.[0])??null}_selectFirstResult(e){return P(this,null,function*(){return this.autoSelect&&e?this.select(e):null})}_suggestImmediate(e,t){return P(this,null,function*(){yield this.when();let i=yield this._getSuggestionsFromSources(e,t);if(t?.signal?.aborted)return null;let r={activeSourceIndex:this.activeSourceIndex,searchTerm:e??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(r,i),r})}_formatSourceResponse(e,t,i){let r=t?.value||[],s=t?.error,n=this.allSources.at(i);if(s){let o={sourceIndex:i,source:n,error:s};e.errors.push(o),V.getLogger(this).error(s),e.numErrors++}else{let o={sourceIndex:i,source:n,results:r};e.results.push(o),e.numResults+=r.length}}_formatResponse(e,t,i){if(t)if(e.activeSourceIndex===Pg){let r=i&&cn(i,"sourceIndex")&&i.sourceIndex!==-1?i.sourceIndex:void 0;t.forEach((s,n)=>{let o=r!==void 0?r:n;this._formatSourceResponse(e,s,o)})}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}_getResultsFromSources(e,t){return P(this,null,function*(){let{allSources:i}=this,r=!e.location&&cn(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,s=[];if(!i.length){let n=new le("search:no-sources-defined","At least one source is required.",{allSources:i});throw V.getLogger(this).error(n),n}return r===Pg?i.forEach((n,o)=>{s.push(this._getResultsFromSource(e,o,t))}):s.push(this._getResultsFromSource(e,r,t)),e_(s)})}_getSuggestionsFromSources(e,t){return P(this,null,function*(){let{allSources:i,activeSourceIndex:r}=this,s=[];if(!i.length){let n=new le("suggest:no-sources-defined","At least one source is required.",{allSources:i});throw V.getLogger(this).error(n),n}return r===Pg?i.forEach((n,o)=>{s.push(this._getSuggestionsFromSource(e,o,t))}):s.push(this._getSuggestionsFromSource(e,r,t)),e_(s)})}_getResultsFromSource(e,t,i){return P(this,null,function*(){let r=t!=null?this.allSources.at(t):null;if(!r)return null;let{location:s=null}=e,n=this.view?.spatialReference||e6,o=cn(r,"maxResults")?r.maxResults:this.maxResults,a=!!(r instanceof _m&&cn(r,"exactMatch"))&&r.exactMatch,{view:l}=this;return r.getResults?.({view:l,sourceIndex:t,location:s,suggestResult:e,spatialReference:n,exactMatch:a,maxResults:o},i)})}_getSuggestionsFromSource(e,t,i){return P(this,null,function*(){let r=this.allSources.at(t);if(!r)return null;e??="";let s=cn(r,"suggestionsEnabled")?r.suggestionsEnabled:this.suggestionsEnabled,n=e?.length,o=cn(r,"minSuggestCharacters")?r.minSuggestCharacters:this.minSuggestCharacters;if(s&&e.trim()&&n>=o){let a=this.view?.spatialReference||e6,l=cn(r,"maxSuggestions")?r.maxSuggestions:this.maxSuggestions,{view:d}=this,u=!!(r instanceof _m&&cn(r,"exactMatch"))&&r.exactMatch;return r.getSuggestions?.({view:d,sourceIndex:t,suggestTerm:e,spatialReference:a,maxSuggestions:l,exactMatch:u},i)}return null})}_getLayerSourcePopupTemplate(e){let{layer:t}=e;if(t)return cn(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){return Kg(this.results??[],({results:t,sourceIndex:i})=>t?.includes(e)?i:null)??null}_goToSearchResult(e){return P(this,null,function*(){this._abortGoTo();let t=new AbortController;this._gotoController=t;let i={target:{target:e},options:{signal:t.signal}};e||(i.options.animate=!1),yield this.callGoTo(i),this._gotoController=null})}_getDefaultSymbol(e){let{defaultSymbols:t}=this,i=e.feature?.geometry;if(i==null)return null;switch(i.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this.removeHandles(JW)}_getLayerView(e){return P(this,null,function*(){let{view:t}=this;if(!e||!t||e.layer?.type==="building-component"||e.layer?.type==="subtype-sublayer")return null;let{layer:i}=e;return i?(yield t.when(),t.whenLayerView(i)):null})}_highlightFeature(e){let{graphic:t,layerView:i}=e,{attributes:r,layer:s}=t,{objectIdField:n}=s,o=(n&&r?.[n])??null,a=i.highlight(o??t);this.addHandles(a,JW)}_setResultFloor(e){let{view:t}=this,i=e.feature?.attributes,r=e.feature?.sourceLayer;if(r&&"floorInfo"in r&&r?.floorInfo?.floorField&&i){let s=i[r.floorInfo.floorField];t?.emit("select-result-floor",s)}}};pt.ALL_INDEX=Pg,c([h()],pt.prototype,"_searching",void 0),c([h()],pt.prototype,"_updatingPromise",void 0),c([h({readOnly:!0,value:null})],pt.prototype,"activeSource",null),c([h()],pt.prototype,"activeSourceIndex",null),c([h()],pt.prototype,"allPlaceholder",null),c([h({readOnly:!0})],pt.prototype,"allSources",null),c([h()],pt.prototype,"autoNavigate",void 0),c([h()],pt.prototype,"autoSelect",void 0),c([h()],pt.prototype,"defaultPopupTemplate",void 0),c([h({readOnly:!0})],pt.prototype,"defaultSources",void 0),c([h()],pt.prototype,"defaultSymbols",void 0),c([h()],pt.prototype,"includeDefaultSources",void 0),c([h()],pt.prototype,"locationEnabled",null),c([h()],pt.prototype,"maxInputLength",void 0),c([h()],pt.prototype,"maxResults",void 0),c([h()],pt.prototype,"maxSuggestions",void 0),c([h()],pt.prototype,"messages",void 0),c([h()],pt.prototype,"minSuggestCharacters",void 0),c([h({readOnly:!0})],pt.prototype,"placeholder",null),c([h()],pt.prototype,"popupEnabled",void 0),c([h({type:XM})],pt.prototype,"popupTemplate",void 0),c([h({type:M_})],pt.prototype,"portal",void 0),c([h()],pt.prototype,"resultCount",void 0),c([h()],pt.prototype,"resultGraphicEnabled",void 0),c([h({readOnly:!0})],pt.prototype,"resultGraphic",void 0),c([h({readOnly:!0})],pt.prototype,"results",void 0),c([h({readOnly:!0})],pt.prototype,"selectedSuggestion",void 0),c([h()],pt.prototype,"searchAllEnabled",void 0),c([h({readOnly:!0})],pt.prototype,"selectedResult",void 0),c([h()],pt.prototype,"searchTerm",null),c([h({type:U1})],pt.prototype,"sources",void 0),c([h({readOnly:!0})],pt.prototype,"state",null),c([h()],pt.prototype,"suggestionDelay",void 0),c([h()],pt.prototype,"suggestionCount",void 0),c([h({readOnly:!0})],pt.prototype,"suggestions",void 0),c([h()],pt.prototype,"suggestionsEnabled",void 0),c([h({readOnly:!0})],pt.prototype,"updating",null),c([h()],pt.prototype,"view",void 0),c([h()],pt.prototype,"clear",null),pt=c([w("esri.widgets.Search.SearchViewModel")],pt);var Lh=pt;var Fh=class extends Jr{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}destroy(){this.viewModel=null}render(){let e={[Oh.showMoreResults]:this.showMoreResultsOpen};return A("div",{class:this.classes(Oh.base,st.widget)},A("div",{class:this.classes(Oh.moreResults,e),key:"esri-search-renderer__container"},this._renderSearchResultName(),this._renderMoreResults()))}_renderMoreResults(){return A("div",{key:"esri-search-renderer__more-results"},this._renderMoreResultsButton(),this._renderMoreResultsLists())}_renderSearchResultName(){let e=this.viewModel?.selectedResult,t=e?.name||"";return A("div",{class:Oh.moreResultsItem,key:"esri-search-renderer__result-name"},t)}_renderMoreResultsLists(){let{viewModel:e}=this;if(!e)return[];let t=e.results;if((e.resultCount??0)<2)return null;let i=t?.map(r=>this._renderMoreResultsList(r));return A("div",{class:Oh.moreResultsList,key:"esri-search-renderer__more-results-container"},i)}_renderMoreResultsButton(){let{messages:e,viewModel:t}=this;return t?(t.resultCount??0)<2?null:A("div",{class:Oh.moreResultsItem,key:"esri-search-renderer__more-results-button"},A("a",{bind:this,class:st.anchor,href:"#",onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults)):null}_renderMoreResultsHeader(e,t){return A("div",{class:Oh.moreResultsListHeader,key:`esri-search-result-renderer__header-${t}`},e)}_renderMoreResultsList(e){let{results:t}=e,i=t?.length??0,r=i>0,s=this.viewModel?.selectedResult,n=i===1&&t[0]===s,o=this._getSourceName(e.source,e.sourceIndex),a=(this.viewModel?.results?.length??0)>1&&!n?this._renderMoreResultsHeader(o,e.sourceIndex):null,l=r&&t.map((u,m)=>this._renderMoreResultsListItem(u,m)),d=r&&!n?A("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},l):null;return r?A("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},a,d):null}_renderMoreResultsListItem(e,t){let i=this.viewModel?.selectedResult;return e!==i?A("li",{key:`esri-search-result-renderer__list-item-${t}`},A("a",{bind:this,class:st.anchor,"data-result":e,href:"#",onclick:this._selectResultClick,onkeydown:this._selectResultClick,tabIndex:0},e.name)):null}_showMoreResultsClick(e){e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;let t=this.viewModel?.view?.popup;t&&"reposition"in t&&t.reposition()}_selectResultClick(e){e.preventDefault();let t=e.currentTarget["data-result"];this.viewModel?.select(t)}_getSourceName(e,t){return t===Lh.ALL_INDEX?this.messages.all:e.name}};c([h(),yr("esri/widgets/Search/t9n/Search")],Fh.prototype,"messages",void 0),c([h()],Fh.prototype,"showMoreResultsOpen",void 0),c([h()],Fh.prototype,"viewModel",void 0),c([cu()],Fh.prototype,"_showMoreResultsClick",null),c([cu()],Fh.prototype,"_selectResultClick",null),Fh=c([w("esri.widgets.Search.SearchResultRenderer")],Fh);var t6=Fh;var Cre=/<[a-z/][\s\S]*>/i,Sre=(e,t)=>{let i=Bk(t).split(/\s/),r=new RegExp(`(${i.join("|")})`,"gi");return e.replace(r,s=>`<strong>${s}</strong>`)},_t=class extends Jr{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._inputNode=null,this._focusAbortController=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new t6,this._suggestController=null,this._searchController=null,this._locateFailed=!1,this._container=null,this.activeMenu="none",this.disabled=!1,this.messages=null,this.messagesCommon=null,this.viewModel=new Lh,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=i=>{let r=i.relatedTarget;r&&this._container?.contains(r)||this._clearActiveMenu()},this._renderSearchResultsContent=()=>this._searchResultRenderer,this.addHandles([T(()=>this.searchTerm,i=>{(i&&this.activeMenu==="warning"||!i&&!this.viewModel?.selectedSuggestion?.location)&&this._clearActiveMenu()}),xi(()=>this.viewModel?.allSources,"change",()=>this._watchSourceChanges()),T(()=>this.activeMenu,()=>this._resetActiveMenuItemIndex(),ie),T(()=>this.viewModel,i=>this._searchResultRenderer.viewModel=i,ie),T(()=>this.viewModel.results,()=>this._searchResultRenderer.showMoreResultsOpen=!1),T(()=>this.viewModel?.defaultPopupTemplate,i=>{i&&(i.content=this._renderSearchResultsContent)},ie)])}destroy(){this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer=z(this._searchResultRenderer),this._focusAbortController?.abort()}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}get activeSource(){return this.viewModel?.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"search"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){return this.viewModel?.portal}set portal(e){this.viewModel&&(this.viewModel.portal=e)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this.viewModel.clear()}focus(){this._handleFocus(),this.emit("search-focus")}_handleFocus(){return P(this,null,function*(){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;let e=this._focusAbortController.signal;yield Jg(Qk(e)),this._inputNode?.focus()})}blur(){this._inputNode?.blur(),this.emit("search-blur")}search(e){return P(this,null,function*(){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();let t=new AbortController,{signal:i}=t;this._searchController=t;try{let r=yield this.viewModel.search(e,{signal:i});return this._searchController!==t?void 0:(this.activeMenu=r?.numResults?"none":"warning",this._searchController=null,r)}catch{return this._searchController!==t?void 0:(this._clearActiveMenu(),void(this._searchController=null))}})}suggest(e){return P(this,null,function*(){this._cancelSuggest();let t=new AbortController,{signal:i}=t;this._suggestController=t;try{let r=yield this.viewModel.suggest(e,null,{signal:i});return this._suggestController!==t?void 0:(this._suggestController=null,r?.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),r)}catch{return this._suggestController!==t||(this._suggestController=null),null}})}render(){let{state:e}=this.viewModel,t={[st.disabled]:e==="disabled",[st.widgetDisabled]:this.disabled};return A("div",{class:this.classes(Ei.base,st.widget,t)},e==="loading"?this._renderLoader():this._renderContainer())}_renderSubmitButton(){let{messages:e,disabled:t}=this;return A("button",{"aria-label":e.searchButtonTitle,bind:this,class:this.classes(Ei.submitButton,st.widgetButton),disabled:t,key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle,type:"button"},A("span",{"aria-hidden":"true",class:hc.search}))}_renderWarningMenu(){return A("div",{class:this.classes(st.menu,Ei.warningMenu),key:"esri-search__error-menu"},A("div",{class:Ei.warningMenuBody},this._renderWarning()))}_renderSourceMenuButton(){let{messages:e,activeMenu:t,sourceMenuId:i,sourceMenuButtonId:r,disabled:s}=this,{activeSourceIndex:n,allSources:o}=this.viewModel;return o.length>1?A("button",{afterCreate:s_,"aria-controls":i,"aria-expanded":(t==="source").toString(),"aria-haspopup":"true","aria-label":e.searchIn,bind:this,class:this.classes(Ei.sourcesButton,st.widgetButton),"data-node-ref":"_sourceMenuButtonNode",disabled:s,id:r,key:"esri-search__source-menu-button",onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,title:e.searchIn,type:"button"},A("span",{"aria-hidden":"true",class:this.classes(hc.downArrow,Ei.sourcesButtonDown)}),A("span",{"aria-hidden":"true",class:this.classes(hc.upArrow,Ei.sourcesButtonUp)}),A("span",{class:Ei.sourceName},this._getSourceName(n))):null}_renderSourcesList(){let{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:i,activeMenu:r,sourceMenuId:s,sourceMenuButtonId:n}=this,o=r==="source"&&i>-1?this._buildId("source-item",i):null;return e.length>1?A("ul",{afterCreate:s_,"aria-activedescendant":o,"aria-labelledby":n,bind:this,class:st.menuList,"data-node-ref":"_sourceListNode",id:s,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,role:"menu",tabIndex:-1},t?this._renderSource(Lh.ALL_INDEX):null,e.map((a,l)=>this._renderSource(l)).toArray()):null}_renderSourcesMenu(){let{allSources:e}=this.viewModel;return e.length>1?A("div",{class:this.classes(st.menu,Ei.sourcesMenu),key:"esri-search__source-menu"},this._renderSourcesList()):null}_renderLoader(){let{messages:e,messagesCommon:t,disabled:i}=this;return A("div",{class:st.loader,key:"base-loader",tabIndex:i?-1:void 0},A("span",{"aria-hidden":"true",class:st.loaderAnimation}),A("span",{class:hc.fontFallbackText},e.searchButtonTitle),A("span",{class:st.loaderText},t.loading))}_renderContainer(){let{allSources:e,state:t}=this.viewModel,{activeMenu:i}=this,r={[Ei.hasMultipleSources]:e.length>1,[Ei.isLoading]:t==="loading",[Ei.isSearching]:t==="searching",[Ei.showWarning]:i==="warning",[Ei.showSources]:i==="source",[Ei.showSuggestions]:i==="suggestion"};return A("div",{afterCreate:s=>{this._container=s,s.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:s=>{s.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(r,Ei.container),key:"base-container",tabIndex:-1},this._renderSourceMenuButton(),this._renderSourcesMenu(),this._renderInputContainer(),this._renderSubmitButton(),this._renderWarningMenu())}_renderClearButton(){return this.searchTerm?A("button",{bind:this,class:this.classes(Ei.clearButton,st.widgetButton),disabled:this.disabled,key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},A("span",{"aria-hidden":"true",class:hc.close})):null}_renderLocationGroup(){let{messages:e,locationEnabled:t,displayedSearchTerm:i}=this,r=t&&!i,s=this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0;return r?A("ul",{class:this.classes(st.menuList,Ei.suggestionList,Ei.suggestionListCurrentLocation),key:"esri-search__suggestion-list-current-location",role:"group"},A("li",{"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0).toString(),bind:this,class:this.classes(st.menuItem,s?st.menuItemFocus:null),"data-current-location-item":!0,id:this._buildId("suggestion-item",0),onclick:this._handleUseCurrentLocationClick,role:"option"},A("span",{"aria-hidden":"true",class:hc.locateCircled})," ",e.useCurrentLocation)):null}_renderInput(){let{activeMenu:e,locationEnabled:t,displayedSearchTerm:i,messages:r,suggestionsMenuId:s,inputId:n,_activeMenuItemIndex:o,disabled:a}=this,{maxInputLength:l,placeholder:d,searchTerm:u,suggestionCount:m}=this.viewModel,p=!(!(t&&!i)&&!m),f=e==="suggestion"&&o>-1?this._buildId("suggestion-item",o):null;return A("input",{afterCreate:s_,"aria-activedescendant":f,"aria-autocomplete":"list","aria-controls":p?s:null,"aria-expanded":(p&&e==="suggestion").toString(),"aria-haspopup":"listbox","aria-label":r.searchButtonTitle,autocomplete:"off",bind:this,class:this.classes(st.input,Ei.input),"data-node-ref":"_inputNode",disabled:a,id:n,maxlength:l,onblur:this.blur,onclick:this._openSuggestionMenu,onfocus:this.focus,oninput:this._handleInputPaste,onkeyup:this._handleInputKeyup,onpaste:this._handleInputPaste,placeholder:d,role:"combobox",title:u?"":d,type:"text",value:u})}_renderForm(){return A("form",{bind:this,class:Ei.form,disabled:this.disabled,key:"esri-search__form",onsubmit:this._formSubmit,role:"search"},this._renderInput())}_renderSuggestList(e){let{sourceIndex:t}=e,{results:i}=e;return i?.length?A("ul",{class:this.classes(st.menuList,Ei.suggestionList),key:`esri-search__suggestion-list-${t}`,role:"group"},i?.map(s=>this._renderSuggestion(s,this._menuItemCount++))):null}_renderSuggestionsGroup(){let{suggestions:e}=this.viewModel;return e?e.map(t=>[this._renderSuggestionHeader(t),this._renderSuggestList(t)]):[]}_renderSuggestionsMenu(){let{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:i,inputId:r}=this,{suggestionCount:s}=this.viewModel,n=t&&!e||s;return this._menuItemCount=0,n?A("div",{afterCreate:s_,"aria-labelledby":r,bind:this,class:this.classes(st.menu,Ei.suggestionsMenu),"data-node-ref":"_suggestionListNode",id:i,key:"esri-search__suggestions-menu",role:"listbox"},this._renderLocationGroup(),this._renderSuggestionsGroup()):null}_renderInputContainer(){return A("div",{class:Ei.inputContainer,key:"esri-search__input-container"},this._renderForm(),this._renderSuggestionsMenu(),this._renderClearButton())}_renderSuggestionHeader(e){let{allSources:t,activeSourceIndex:i}=this.viewModel,{sourceIndex:r}=e,s=e.results?.length,n=t.length>1&&i===Lh.ALL_INDEX;return s&&n?A("div",{class:st.menuHeader,key:`esri-search__suggestion-header-${r}`},this._getSourceName(r)):null}_renderSuggestion(e,t){let{_activeMenuItemIndex:i,viewModel:{searchTerm:r}}=this;if(!r)return;let s=this.activeMenu==="suggestion"&&i===t;return A("li",{"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===t).toString(),bind:this,class:this.classes(st.menuItem,s?st.menuItemFocus:null),"data-suggestion":e,id:this._buildId("suggestion-item",t),innerHTML:this._getSuggestResultHTML(e.text,r),key:`esri-search__suggestion_${t}`,onclick:this._handleSuggestionClick,role:"option"})}_renderSource(e){let{activeSourceIndex:t,searchAllEnabled:i}=this.viewModel,r={[st.menuItemActive]:e===t,[st.menuItemFocus]:this.activeMenu==="source"&&e===(i?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},s=i?e+1:e;return A("li",{"aria-checked":(e===t).toString(),bind:this,class:this.classes(Ei.source,st.menuItem,r),"data-source-index":e,id:this._buildId("source-item",s),key:`esri-search__source-${e}`,onclick:this._handleSourceClick,role:"menuitemradio"},this._getSourceName(e))}_renderNoResultsWarning(e){let{messages:t}=this,i=e?ca(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return A("div",{key:"esri-search__no_results"},A("div",{class:Ei.warningMenuHeader},t.noResults),A("div",{class:Ei.warningMenuText},i))}_renderEmptySearchWarning(){let{messages:e}=this;return A("div",{key:"esri-search__empty-search"},A("span",{"aria-hidden":"true",class:hc.noticeTriangle}),A("span",{class:Ei.noValueText},e.emptyValue))}_renderLocateWarning(){let{messages:e}=this;return A("div",{key:"esri-search__locate-error"},A("span",{"aria-hidden":"true",class:hc.noticeTriangle}),A("span",{class:Ei.noValueText},e.locateError))}_renderWarning(){let{displayedSearchTerm:e,_locateFailed:t}=this,{viewModel:i}=this;return t?this._renderLocateWarning():i.selectedSuggestion?.location||e?this._renderNoResultsWarning(e):this._renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${t===void 0?"":`-${t}`}`}_watchSourceChanges(){let{viewModel:{allSources:e}}=this,t="sources";this.removeHandles(t),e.forEach(i=>this.addHandles(T(()=>i.name,()=>this.scheduleRender()),t))}_handleSourcesMenuToggleFocus(){this.activeMenu!=="source"&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){let e=this.activeMenu==="source";this.activeMenu=e?"none":"source",this.renderNow(),this.activeMenu==="source"&&this._sourceListNode?.focus()}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){let t=i6(e.currentTarget);t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();let e=new AbortController,{signal:t}=e;this._searchController=e,P(this,null,function*(){try{let i=yield this.viewModel.searchNearby({signal:t});this.activeMenu=i?.numResults?"none":"warning"}catch{this._locateFailed=!0,this.activeMenu="warning"}finally{this._searchController=null}})}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){if(!e)return;let t=Tre(e);t!=null&&(this.viewModel.activeSourceIndex=t,this._clearActiveMenu(),this._sourceMenuButtonNode?.focus())}_cancelSuggest(){this._suggestController=Er(this._suggestController)}_cancelSearch(){this._searchController=Er(this._searchController),this._locateFailed=!1}_handleInputKeyup(e){let{key:t}=e;if(e.ctrlKey||e.metaKey||t==="Copy"||t==="ArrowLeft"||t==="ArrowRight"||t==="Shift")return;if(t==="Tab"||t==="Escape"||e.shiftKey&&t==="Tab")return this._cancelSuggest(),void(t==="Escape"&&this._clearActiveMenu());let i=t==="Home"||t==="End"||t==="ArrowUp"||t==="ArrowDown";if(t==="Enter"&&this._activeMenuItemIndex<0)return void this._cancelSuggest();let r=this._suggestionListNode?.getElementsByTagName("li");if(r?.length){if(this.activeMenu!=="suggestion"&&this._openSuggestionMenu(),i)return e.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(t,r,this._suggestionListNode);let s=r[this._activeMenuItemIndex];if(t==="Enter"&&s){let n=i6(s);return void(n?(this._focus(),this.search(n)):Mre(s)&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(e,t,i){let r=this._activeMenuItemIndex;e==="Home"&&(this._activeMenuItemIndex=0),e==="End"&&(this._activeMenuItemIndex=t.length-1),e==="ArrowUp"&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),e==="ArrowDown"&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),r!==this._activeMenuItemIndex&&i&&Ere(t[this._activeMenuItemIndex],i)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){let t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){let{key:t}=e;if(uL(t)){e.preventDefault();let i=this._sourceListNode?.getElementsByTagName("li"),r=i?.[this._activeMenuItemIndex];this._setSourceFromMenuItem(r)}else t!=="ArrowUp"&&t!=="ArrowDown"&&t!=="End"&&t!=="Home"||e.preventDefault()}_handleSourceMenuKeyup(e){let{key:t}=e,i=t==="ArrowUp"||t==="ArrowDown"||t==="End"||t==="Home";if(i&&e.preventDefault(),t==="Escape")return this._clearActiveMenu(),void this._sourceMenuButtonNode?.focus();let r=this._sourceListNode?.getElementsByTagName("li");return r&&r.length!==0&&i?(this.activeMenu!=="source"&&(this.activeMenu="source"),void this._handleItemNavigation(t,r,this._sourceListNode?.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),this._activeMenuItemIndex===-1&&this.search()}_getSourceName(e){let{messages:t}=this,i=this.viewModel,{allSources:r}=i,s=r.at(e);return e===Lh.ALL_INDEX?t.all:s&&s.name||t.untitledSource}_getSuggestResultHTML(e,t){return e?Cre.test(e)?e:Sre(e,t):this.messages.untitledResult}};function i6(e){return e?.["data-suggestion"]}function Tre(e){return e?.["data-source-index"]}function Mre(e){return!!e?.["data-current-location-item"]}function Ere(e,t){let i=e.getBoundingClientRect(),r=t.getBoundingClientRect(),s=i.top+i.height,n=r.top+r.height,o=i.top,a=r.top;(s>n||o<a)&&e.scrollIntoView({block:"end"})}c([h()],_t.prototype,"_activeMenuItemIndex",void 0),c([h()],_t.prototype,"displayedSearchTerm",null),c([h({readOnly:!0})],_t.prototype,"inputId",null),c([h({readOnly:!0})],_t.prototype,"suggestionsMenuId",null),c([h({readOnly:!0})],_t.prototype,"sourceMenuId",null),c([h({readOnly:!0})],_t.prototype,"sourceMenuButtonId",null),c([h()],_t.prototype,"activeMenu",void 0),c([h({readOnly:!0})],_t.prototype,"activeSource",null),c([h()],_t.prototype,"activeSourceIndex",null),c([h()],_t.prototype,"allPlaceholder",null),c([h({readOnly:!0})],_t.prototype,"allSources",null),c([h()],_t.prototype,"autoNavigate",null),c([h()],_t.prototype,"autoSelect",null),c([h({readOnly:!0})],_t.prototype,"defaultSources",null),c([h()],_t.prototype,"disabled",void 0),c([h()],_t.prototype,"goToOverride",null),c([h()],_t.prototype,"icon",null),c([h()],_t.prototype,"includeDefaultSources",null),c([h()],_t.prototype,"label",null),c([h()],_t.prototype,"locationEnabled",null),c([h()],_t.prototype,"maxResults",null),c([h()],_t.prototype,"maxSuggestions",null),c([h(),yr("esri/widgets/Search/t9n/Search")],_t.prototype,"messages",void 0),c([h(),yr("esri/t9n/common")],_t.prototype,"messagesCommon",void 0),c([h()],_t.prototype,"minSuggestCharacters",null),c([h()],_t.prototype,"popupEnabled",null),c([h()],_t.prototype,"popupTemplate",null),c([h()],_t.prototype,"portal",null),c([h()],_t.prototype,"resultGraphic",null),c([h()],_t.prototype,"resultGraphicEnabled",null),c([h({readOnly:!0})],_t.prototype,"results",null),c([h()],_t.prototype,"searchAllEnabled",null),c([h()],_t.prototype,"searchTerm",null),c([h({readOnly:!0})],_t.prototype,"selectedResult",null),c([h()],_t.prototype,"sources",null),c([h({readOnly:!0})],_t.prototype,"suggestions",null),c([h()],_t.prototype,"suggestionsEnabled",null),c([h()],_t.prototype,"view",null),c([qN(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),h({type:Lh})],_t.prototype,"viewModel",void 0),_t=c([w("esri.widgets.Search")],_t);var r6=_t;var s6=(()=>{class e{initializeCanalData(){return new P0({url:"../../assets/data/main-irrigation-canal.geojson",renderer:new u0({symbol:new h0({color:"green",width:2})}),popupTemplate:{title:"{Kanal_nomi}",content:` <table style="width:100%; border-collapse: collapse;">
          <tr>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Property</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Value</th>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Kanal_nomi</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Kanal_nomi}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Kadastr_ra</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Kadastr_ra}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Joylashgan</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Joylashgan}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Suv_olish_</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Suv_olish_}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Kapitallik</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Kapitallik}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Asosiy_vaz</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{VazifasiAsosiy_vaztd>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Maksimal_s</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Maksimal_s}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Qoplama_tu</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Qoplama_tu}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Qoplama_1</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Qoplama_1}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Qoplamasiz</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Qoplamasiz}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Qoplamas_1</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Qoplamas_1}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Jami_uzunl</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Jami_uzunl}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Inshootlar</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Inshootlar}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Sugoriladi</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Sugoriladi}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Foydalanis</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Foydalanis}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Foydalanuv</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Foydalanuv}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Tamir_turi</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Tamir_turi}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Tamir_boyi</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Tamir_boyi}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Tamirlanga</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Tamirlanga}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Tamirlagan</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Tamirlagan}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">NAME</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{NAME}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">tessellate</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{tessellate}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Shape_Leng</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Shape_Leng}</td>
          </tr>
        </table>
`}})}initializeReservoirData(){return new P0({url:"../../assets/data/reservoirs.geojson",renderer:new u0({symbol:new ou({color:[0,0,255,.4],outline:{color:[0,0,255],width:2}})}),popupTemplate:{title:"{Suv_omborl}",content:`
    <table style="width:100%; border-collapse: collapse;">
      <tr>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Property</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Value</th>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Suv_omborl</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Suv_omborl}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Kadastr_ra</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Kadastr_ra}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Suv_ombor_</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Suv_ombor_}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Suv_ombor1</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Suv_ombor1}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Suv_olish_</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Suv_olish_}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Toplangan_</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Toplangan_}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Suv_ombo_1</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Suv_ombo_1}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Suv_ombo_2</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Suv_ombo_2}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Suv_istemo</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Suv_istemo}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Kapitallik</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Kapitallik}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Togon_turi</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Togon_turi}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Togonning_</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Togonning_}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Egallagan_</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Egallagan_}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Suv_ombo_3</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Suv_ombo_3}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Togondagi_</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Togondagi_}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Foydalanis</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Foydalanis}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Foydalanuv</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Foydalanuv}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Tamir_turi</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Tamir_turi}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Tamir_boyi</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Tamir_boyi}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Tamirlanga</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Tamirlanga}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Tamirlagan</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Tamirlagan}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Sarflangan</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Sarflangan}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">nomi</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{nomi}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">suv_s</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{suv_s}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">ishga</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{ishga}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">SHAPE_Leng</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{SHAPE_Leng}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Shape_Le_1</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Shape_Le_1}</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 8px;">Shape_Area</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{Shape_Area}</td>
      </tr>
    </table>
    `}})}initilizePumpingStationData(){return new P0({popupTemplate:{title:"{Nasos_stan}",content:` <table style="width:100%; border-collapse: collapse;">
          <tr>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Property</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Value</th>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Nasos_stan</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Nasos_stan}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Kadastr_ra</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Kadastr_ra}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Joylashgan</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Joylashgan}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Suv_olish_</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Suv_olish_}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Kapitallik</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Kapitallik}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Vazifasi</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Vazifasi}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Maksimal_s</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Maksimal_s}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Kotarish_b</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Kotarish_b}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Agregatlar</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Agregatlar}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Belgilanga</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Belgilanga}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Foydalanis</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Foydalanis}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Foydalanuv</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Foydalanuv}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Tamir_turi</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Tamir_turi}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Tamir_boyi</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Tamir_boyi}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Tamirlanga</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Tamirlanga}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Tamirlagan</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Tamirlagan}</td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">Sarflangan</td>
            <td style="border: 1px solid #ddd; padding: 8px;">{Sarflangan}</td>
          </tr>
        </table>
`},url:"../../assets/data/pumping-stations.geojson",renderer:new u0({symbol:new pd({color:"red",size:"5px",style:"circle"})})})}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=fe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Are=["mapView"],n6=(()=>{class e{constructor(i,r,s){this.bottomSheetService=i,this.sideNavContentService=r,this.dataService=s,this.dataLoaded=!1}ngOnInit(){this.map=new fx({basemap:this.bottomSheetService.getSelectedBasemap(),ground:"world-elevation"}),this.initializeSubscriptions()}ngOnDestroy(){this.mapView&&this.mapView.destroy()}initializeMapView(){this.mapView=new Dj({container:this.mapViewDiv?.nativeElement,map:this.map,center:[64,41],zoom:6})}initializeSceneView(){this.mapView=new J8({container:this.mapViewDiv?.nativeElement,map:this.map,center:[64,41],zoom:6})}initialiazeWidgets(){let i=new r6({view:this.mapView});this.mapView.ui.add(i,{position:"top-right"});let r=new Jx({view:this.mapView});this.mapView.ui.add(r,"top-left");let s=new bW({view:this.mapView});this.mapView.ui.add(s,{position:"bottom-right"})}initializeSubscriptions(){this.bottomSheetService.selectedBasemapObs.subscribe(i=>{this.mapView&&(this.mapView.map.basemap=i)}),this.sideNavContentService.mapViewObs.subscribe(i=>{i===Nd.MAP_VIEW?this.initializeMapView():i===Nd.SCENE_VIEW&&this.initializeSceneView(),this.initialiazeWidgets()}),this.sideNavContentService.toggleLayerObs.subscribe(i=>{this.dataLoaded||this.initilizeData(),this.pumpingStations.visible=i.includes(Ra.PUMPING_STATIONS),this.canals.visible=i.includes(Ra.CANALS),this.reservoirs.visible=i.includes(Ra.RESERVOIRS)})}initilizeData(){this.dataLoaded=!0,this.pumpingStations=this.dataService.initilizePumpingStationData(),this.reservoirs=this.dataService.initializeReservoirData(),this.canals=this.dataService.initializeCanalData(),this.map.addMany([this.pumpingStations,this.reservoirs,this.canals])}static{this.\u0275fac=function(r){return new(r||e)(Us(Vd),Us(ux),Us(s6))}}static{this.\u0275cmp=it({type:e,selectors:[["app-map"]],viewQuery:function(r,s){if(r&1&&ws(Are,7),r&2){let n;Zt(n=Qt())&&(s.mapViewDiv=n.first)}},decls:2,vars:0,consts:[["mapView",""],[1,"w-full","h-full"]],template:function(r,s){r&1&&pi(0,"div",1,0)},encapsulation:2})}}return e})();var Ire=["drawer"],o6=(()=>{class e{constructor(i){this.sidenavService=i}ngAfterViewInit(){this.sidenavService.setSidenav(this.sidenav)}static{this.\u0275fac=function(r){return new(r||e)(Us(mx))}}static{this.\u0275cmp=it({type:e,selectors:[["app-components"]],viewQuery:function(r,s){if(r&1&&ws(Ire,5),r&2){let n;Zt(n=Qt())&&(s.sidenav=n.first)}},decls:7,vars:1,consts:[["drawer",""],[3,"hasBackdrop"],["mode","side","position","start",1,"w-[300px]"],[1,"h-full"]],template:function(r,s){r&1&&(pi(0,"app-header"),De(1,"mat-drawer-container",1)(2,"mat-drawer",2,0),pi(4,"app-drawer-content"),Ze(),De(5,"mat-drawer-content"),pi(6,"app-map",3),Ze()()),r&2&&(Ft(),Mr("hasBackdrop",!1))},dependencies:[QH,n6,iH,aA,lA,fy,$H],styles:["[_nghost-%COMP%]{height:100vh;height:-webkit-fill-available;display:flex;flex-direction:column}[_nghost-%COMP%]     .mat-drawer-container, [_nghost-%COMP%]     .mat-drawer-content{flex:1;flex-direction:column;display:flex}@media only screen and (width <= 600px){.sidenav[_ngcontent-%COMP%]{width:100%}}"]})}}return e})();var a6=(()=>{class e{constructor(){this.title="base-angular"}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275cmp=it({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(r,s){r&1&&pi(0,"app-components")},dependencies:[o6],encapsulation:2})}}return e})();var l6=[];var Dre="@",Pre=(()=>{class e{doc;delegate;zone;animationType;moduleImpl;_rendererFactoryPromise=null;scheduler=null;injector=M(wi);loadingSchedulerFn=M(Ore,{optional:!0});_engine;constructor(i,r,s,n,o){this.doc=i,this.delegate=r,this.zone=s,this.animationType=n,this.moduleImpl=o}ngOnDestroy(){this._engine?.flush()}loadImpl(){let i=()=>this.moduleImpl??import("./chunk-VAUG37JC.js").then(s=>s),r;return this.loadingSchedulerFn?r=this.loadingSchedulerFn(i):r=i(),r.catch(s=>{throw new Gi(5300,!1)}).then(({\u0275createEngine:s,\u0275AnimationRendererFactory:n})=>{this._engine=s(this.animationType,this.doc);let o=new n(this.delegate,this._engine,this.zone);return this.delegate=o,o})}createRenderer(i,r){let s=this.delegate.createRenderer(i,r);if(s.\u0275type===0)return s;typeof s.throwOnSyntheticProps=="boolean"&&(s.throwOnSyntheticProps=!1);let n=new NO(s);return r?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(o=>{let a=o.createRenderer(i,r);n.use(a),this.scheduler??=this.injector.get(rk,null,{optional:!0}),this.scheduler?.notify(11)}).catch(o=>{n.use(s)}),n}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}static \u0275fac=function(r){sM()};static \u0275prov=fe({token:e,factory:e.\u0275fac})}return e})(),NO=class{delegate;replay=[];\u0275type=1;constructor(t){this.delegate=t}use(t){if(this.delegate=t,this.replay!==null){for(let i of this.replay)i(t);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(t,i){return this.delegate.createElement(t,i)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}get destroyNode(){return this.delegate.destroyNode}appendChild(t,i){this.delegate.appendChild(t,i)}insertBefore(t,i,r,s){this.delegate.insertBefore(t,i,r,s)}removeChild(t,i,r){this.delegate.removeChild(t,i,r)}selectRootElement(t,i){return this.delegate.selectRootElement(t,i)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,i,r,s){this.delegate.setAttribute(t,i,r,s)}removeAttribute(t,i,r){this.delegate.removeAttribute(t,i,r)}addClass(t,i){this.delegate.addClass(t,i)}removeClass(t,i){this.delegate.removeClass(t,i)}setStyle(t,i,r,s){this.delegate.setStyle(t,i,r,s)}removeStyle(t,i,r){this.delegate.removeStyle(t,i,r)}setProperty(t,i,r){this.shouldReplay(i)&&this.replay.push(s=>s.setProperty(t,i,r)),this.delegate.setProperty(t,i,r)}setValue(t,i){this.delegate.setValue(t,i)}listen(t,i,r,s){return this.shouldReplay(i)&&this.replay.push(n=>n.listen(t,i,r,s)),this.delegate.listen(t,i,r,s)}shouldReplay(t){return this.replay!==null&&t.startsWith(Dre)}},Ore=new He("");function c6(e="animations"){return rM("NgAsyncAnimations"),Mm([{provide:Ga,useFactory:(t,i,r)=>new Pre(t,i,r,e),deps:[bt,xw,vt]},{provide:bs,useValue:e==="noop"?"NoopAnimations":"BrowserAnimations"}])}var d6={providers:[TU(l6),c6()]};z3(a6,d6).catch(e=>console.error(e));
