import{a as m}from"./chunk-BIZV3H6H.js";import{a as v,b as o}from"./chunk-BXR2KKYP.js";import{d as n}from"./chunk-4OZVVJHM.js";import{a}from"./chunk-7W6RATG7.js";import{B as h}from"./chunk-GMC3I5VG.js";import{f as i}from"./chunk-WGF2T2BG.js";var s;function _(t,e){switch(e.textureCoordinateType){case s.Default:return t.attributes.add(a.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(o`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case s.Compressed:return t.attributes.add(a.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(o`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case s.Atlas:return t.attributes.add(a.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(a.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(o`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case s.None:return void t.vertex.code.add(o`void forwardTextureCoordinates() {}`);case s.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(s||(s={}));function I(t,e){let{textureCoordinateType:r}=e;if(r===s.None||r===s.COUNT)return;t.include(_,e);let u=r===s.Atlas;u&&t.include(m),t.fragment.code.add(o`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${u?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}var x=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}acquireTechnique(e,r){return this._techniques.acquire(e,this._material.getConfiguration(this._output,r))}ensureResources(e){return n.LOADED}};var p=class extends x{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){super.dispose(),this._texture=i(this._texture),this._textureNormal=i(this._textureNormal),this._textureEmissive=i(this._textureEmissive),this._textureOcclusion=i(this._textureOcclusion),this._textureMetallicRoughness=i(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?n.LOADED:n.LOADING}get textureBindParameters(){return new c(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=i(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);let u=this._textures.acquire(e);if(h(u))return++this._numLoading,void u.then(l=>{if(this._disposed)return i(l),void r(null);r(l)}).finally(()=>--this._numLoading);r(u)}},d=class extends v{constructor(e=null){super(),this.textureEmissive=e}},c=class extends d{constructor(e=null,r=null,u=null,l=null,T=null,g,f){super(u),this.texture=e,this.textureNormal=r,this.textureOcclusion=l,this.textureMetallicRoughness=T,this.scale=g,this.normalTextureTransformMatrix=f}};export{s as a,_ as b,I as c,x as d,p as e,c as f};
