import{b as j,c as w}from"./chunk-4YNUZOQW.js";import{z as u}from"./chunk-SVK2E2V5.js";import{a as v}from"./chunk-H4XRNT5U.js";import{a as S}from"./chunk-AY3YVZUY.js";import{a as g}from"./chunk-26R336GJ.js";import{b as x,d as _}from"./chunk-OC7V2CEX.js";import{k as y,r as T}from"./chunk-BDF7KEUQ.js";import{a as d}from"./chunk-6WKJD7BM.js";import{J as p}from"./chunk-4DLSYLKE.js";import{a}from"./chunk-VEDIBGHD.js";var I=class e{constructor(t,i,r,s){this.lij=[0,0,0],this.extent=d(),this.resolution=0,this.loadPriority=0,this.measures=new h,this.used=!1,this.acquire(t,i,r,s)}get planetRadius(){return p(this.tilingScheme.spatialReference).radius}acquire(t,i,r,s){this.tilingScheme=s,this.id=e.id(t,i,r),this.lij[0]=t,this.lij[1]=i,this.lij[2]=r,s.getExtent(t,i,r,this.extent),this.measures.effectiveLevelForLod=t,this.updateResolution()}updateResolution(){this.resolution=this.tilingScheme.resolutionAtLevel(this.measures.effectiveLevelForLod)}release(){this.tilingScheme=null}getChildren(t){let i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return t?t.acquire(i,r,s,this.tilingScheme):[new e(i,r,s,this.tilingScheme),new e(i,r+1,s,this.tilingScheme),new e(i,r,s+1,this.tilingScheme),new e(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.copyFrom(t.measures),this.updateResolution()}static id(t,i,r){return`${t}/${i}/${r}`}},c;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE=1]="VISIBLE"})(c||(c={}));var h=class{constructor(){this.visibility=c.VISIBLE,this.distance=0,this.shouldSplit=!1,this.effectiveLevelForLod=0}copyFrom(t){return this.visibility=t.visibility,this.distance=t.distance,this.shouldSplit=t.shouldSplit,this.effectiveLevelForLod=t.effectiveLevelForLod,this}};var l;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(l||(l={}));var L=class{constructor(){this._queue=new a,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.leaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=void 0}reset(t=null){this._queue.clear(),t!=null&&this._queue.pushArray(t),this._last=void 0}skipSubtree(){this._last=void 0}next(){let t=this._last?.children;return t?.[0]&&this._queue.pushArray(t),this._last=this._queue.pop(),this._last}},q=class{constructor(){this._q=new a}get done(){return this._q.length===0}reset(t){if(this._q.clear(),t!=null){this._q.pushArray(t);for(let i=0;i<this._q.length;++i){let r=this._q.data[i];r.leaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function k(e,t){if(t==null)return!1;let i=E(t);if(i?.fullExtent==null)return!1;let r=i.fullExtent,s=e.extent;if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;let n=e.surface.tilingScheme.levels[e.level].scale,f=i.minScale;if(f>0&&n>1.00000001*f)return!1;let m=i.maxScale;return!(m>0&&n<.99999999*m)}function E(e){return u(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale}:e.layer}function Q(e){return!u(e)&&e.layer&&"tilemapCache"in e.layer?e.layer.tilemapCache:null}function O(e,t){let i=e.lij,r=t.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function z(e,t,i=null){i==null||i.length===0?e===l.BACK_TO_FRONT?t.sort(P):t.sort(F):t.sort((r,s)=>B(r,s,e,i))}function P(e,t){let i=t.screenDepth-e.screenDepth;if(i!==0)return i;let r=e.lij,s=t.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function F(e,t){let i=e.screenDepth-t.screenDepth;if(i!==0)return i;let r=e.lij,s=t.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function R(e,t,i){let r=e.screenDepth,s=t.screenDepth;return r<s?-i:r>s?i:O(e,t)}function B(e,t,i,r){return A(e,r)===A(t,r)?R(e,t,i):e?i:-i}function A(e,t){for(let i of t)if(e.intersectsExtent(i))return!0;return!1}function D(e,t){let i=e.distanceToPOI-t.distanceToPOI;if(i!==0)return i;let r=e.lij,s=t.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function G(e,t){let i=e.length;for(let r=0;r<i;++r)e.at(r).updateDistanceToPOI(t);e.sort(D)}function H(e,t,i){let r=1,s=0,n=0;for(;e!==t;)if(r*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),1&e.lij[1]||(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(t,s,n,r)}function J(e){for(let t=0;t<e.length;t++){let i=e[t],r=i.parent;if(r)for(let s=0;s<4;s++){let n=r.children[s];if(n&&n!==i)return!0}}return!1}function X(e,t){if(!e||!t||e[0]===t[0])return!1;let i=e[0]<t[0],r=i?e:t,s=i?t:e,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}function oe(e,t=o.Pos2,i=S,r=-1,s=1){let n=t===o.Pos2?new Float32Array([r,r,s,r,r,s,s,s]):new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]);return new v(e,i,new Map([["geometry",V.get(t)]]),new Map([["geometry",g.createVertex(e,T.STATIC_DRAW,n)]]))}var N=4;function le(e){let t=new x(N);return t.samplingMode=y.NEAREST,new _(e,t)}var o;(function(e){e[e.Pos2=0]="Pos2",e[e.Pos2Tex=1]="Pos2Tex"})(o||(o={}));var V=new Map([[o.Pos2,j],[o.Pos2Tex,w]]);export{I as a,c as b,l as c,L as d,q as e,k as f,Q as g,O as h,z as i,R as j,G as k,H as l,J as m,X as n,oe as o,le as p,o as q};
