import{c as A}from"./chunk-DJGT5PK5.js";import{d as J,i as V}from"./chunk-LCTRO7CL.js";import{a as H,b as Y}from"./chunk-WJDHM47L.js";import{r as C}from"./chunk-5PTS4JDF.js";import{a as O}from"./chunk-NDYVXEZ5.js";import{b as D}from"./chunk-IZVEJCCI.js";import{g as m}from"./chunk-JEGVIFEP.js";var L,z;(function(e){e[e.None=0]="None",e[e.Int16=1]="Int16",e[e.Int32=2]="Int32"})(L||(L={})),function(e){e[e.Replace=0]="Replace",e[e.Outside=1]="Outside",e[e.Inside=2]="Inside",e[e.Finished=3]="Finished"}(z||(z={}));function $(){return T||(T=new Promise(e=>import("./chunk-4RQIQ3CF.js").then(t=>t.i).then(({default:t})=>{let n=t({locateFile:X,onRuntimeInitialized:()=>e(n)});delete n.then})).catch(e=>{throw e})),T}function X(e){return D(`esri/libs/i3s/${e}`)}var T;function de(e){return m(this,null,function*(){o=yield h();let t=[e.geometryBuffer];return{result:G(o,e,t),transferList:t}})}function me(e){return m(this,null,function*(){o=yield h();let t=[e.geometryBuffer],{geometryBuffer:n}=e,i=n.byteLength,s=o._malloc(i),c=new Uint8Array(o.HEAPU8.buffer,s,i);c.set(new Uint8Array(n));let a=o.dracoDecompressPointCloudData(s,c.byteLength);if(o._free(s),a.error.length>0)throw new Error(`i3s.wasm: ${a.error}`);let f=a.featureIds?.length>0?a.featureIds.slice():null,d=a.positions.slice();return f&&t.push(f.buffer),t.push(d.buffer),{result:{positions:d,featureIds:f},transferList:t}})}function ye(e){return m(this,null,function*(){yield h(),ee(e);let t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}})}function pe(e){return m(this,null,function*(){yield h(),Z(e)})}function be(e){return m(this,null,function*(){o=yield h(),o.setLegacySchema(e.context,e.jsonSchema)})}function he(e){return m(this,null,function*(){let{localMatrix:t,origin:n,positions:i,vertexSpace:s}=e,c=O.fromJSON(e.inSpatialReference),a=O.fromJSON(e.outSpatialReference),f,[{projectBuffer:d},{initializeProjection:N}]=yield Promise.all([import("./chunk-TWDKIPFC.js"),import("./chunk-PJC647Z6.js")]);yield N(c,a);let g=[0,0,0];if(!d(n,c,0,g,a,0))throw new Error("Failed to project");if(s.type==="georeferenced"&&s.origin==null){if(f=new Float64Array(i.length),!d(i,c,0,f,a,0,f.length/3))throw new Error("Failed to project")}else{let l=s.type==="georeferenced"?H.fromJSON(s):Y.fromJSON(s),{projectMeshVertexPositions:u}=yield import("./chunk-WQEQ7DTA.js"),y=u({vertexAttributes:{position:i},transform:t?{localMatrix:t}:void 0,vertexSpace:l,spatialReference:c},a);if(!y)throw new Error("Failed to project");f=y}let P=f.length,[w,x,E]=g;for(let l=0;l<P;l+=3)f[l]-=w,f[l+1]-=x,f[l+2]-=E;return{result:{projected:f,original:i,projectedOrigin:g},transferList:[f.buffer,i.buffer]}})}function ge(n){return m(this,arguments,function*({normalMatrix:e,normals:t}){let i=new Float32Array(t.length);return J(i,t,e),C(e)&&V(i,i),{result:{transformed:i,original:t},transferList:[i.buffer,t.buffer]}})}function we(e){k(e)}var M,o;function Z(e){if(!o)return;let t=e.modifications,n=o._malloc(8*t.length),i=new Float64Array(o.HEAPU8.buffer,n,t.length);for(let s=0;s<t.length;++s)i[s]=t[s];o.setModifications(e.context,n,t.length,e.isGeodetic),o._free(n)}function G(e,t,n){let{context:i,globalTrafo:s,mbs:c,obbData:a,elevationOffset:f,geometryBuffer:d,geometryDescriptor:N,indexToVertexProjector:g,vertexToRenderProjector:P}=t,w=e._malloc(d.byteLength),x=33,E=e._malloc(x*Float64Array.BYTES_PER_ELEMENT),l=new Uint8Array(e.HEAPU8.buffer,w,d.byteLength);l.set(new Uint8Array(d));let u=new Float64Array(e.HEAPU8.buffer,E,x);_(u,[NaN,NaN,NaN]);let y=u.byteOffset+3*u.BYTES_PER_ELEMENT,I=new Float64Array(u.buffer,y);_(I,s),y+=16*u.BYTES_PER_ELEMENT,I=new Float64Array(u.buffer,y),_(I,c),y+=4*u.BYTES_PER_ELEMENT,a&&(I=new Float64Array(u.buffer,y),_(I,a));let U=N,q={isDraco:!1,isLegacy:!1,color:t.layouts.some(p=>p.some(b=>b.name==="color")),normal:t.needNormals&&t.layouts.some(p=>p.some(b=>b.name==="normalCompressed")),uv0:t.layouts.some(p=>p.some(b=>b.name==="uv0")),uvRegion:t.layouts.some(p=>p.some(b=>b.name==="uvRegion")),featureIndex:U.featureIndex},r=e.process(i,!!t.obbData,w,l.byteLength,U,q,E,f,g,P,t.normalReferenceFrame);if(e._free(E),e._free(w),r.error.length>0)throw new Error(`i3s.wasm: ${r.error}`);if(r.discarded)return null;let S=r.componentOffsets.length>0?r.componentOffsets.slice():null,F=r.featureIds.length>0?r.featureIds.slice():null,K=r.anchorIds.length>0?Array.from(r.anchorIds):null,Q=r.anchors.length>0?Array.from(r.anchors):null,R=r.interleavedVertedData.slice().buffer,j=r.indicesType===L.Int16?new Uint16Array(r.indices.buffer,r.indices.byteOffset,r.indices.byteLength/2).slice():new Uint32Array(r.indices.buffer,r.indices.byteOffset,r.indices.byteLength/4).slice(),v=r.positions.slice(),B=r.positionIndicesType===L.Int16?new Uint16Array(r.positionIndices.buffer,r.positionIndices.byteOffset,r.positionIndices.byteLength/2).slice():new Uint32Array(r.positionIndices.buffer,r.positionIndices.byteOffset,r.positionIndices.byteLength/4).slice(),W={layout:t.layouts[0],interleavedVertexData:R,indices:j,hasColors:r.hasColors,hasModifications:r.hasModifications,positionData:{data:v,indices:B}};return F&&n.push(F.buffer),S&&n.push(S.buffer),n.push(R),n.push(j.buffer),n.push(v.buffer),n.push(B.buffer),{componentOffsets:S,featureIds:F,anchorIds:K,anchors:Q,transformedGeometry:W,obb:r.obb,globalTrafo:s}}function Ee(e){return e===0?A.Unmodified:e===1?A.PotentiallyModified:e===2?A.Culled:A.Unknown}function ee(e){if(!o)return;let{context:t,buffer:n}=e,i=o._malloc(n.byteLength),s=n.byteLength/Float64Array.BYTES_PER_ELEMENT,c=new Float64Array(o.HEAPU8.buffer,i,s),a=new Float64Array(n);c.set(a),o.filterOBBs(t,i,s),a.set(c),o._free(i)}function k(e){o&&o.destroy(e)===0&&(o=null)}function _(e,t){for(let n=0;n<t.length;++n)e[n]=t[n]}function Ie(){return m(this,null,function*(){o||(yield h())})}function h(){return o?Promise.resolve(o):(M||(M=$().then(e=>(o=e,M=null,o))),M)}var Ae={transform:(e,t)=>o&&G(o,e,t),destroy:k};export{z as a,de as b,me as c,ye as d,pe as e,be as f,he as g,ge as h,we as i,Z as j,Ee as k,ee as l,Ie as m,Ae as n};
