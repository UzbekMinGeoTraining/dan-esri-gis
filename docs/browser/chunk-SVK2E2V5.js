import{a as L}from"./chunk-GB5RQL32.js";import{a as M,b as R}from"./chunk-IH2TDIRR.js";import{b as te,d as ie,e as W,n as re,v as G}from"./chunk-2HUIJUS4.js";import{o as ee}from"./chunk-LAJXTVEO.js";import{a as x,e as Y,p as Z,u as $}from"./chunk-6WKJD7BM.js";import{a as v}from"./chunk-PYQRTZNZ.js";import{c as k}from"./chunk-VQHENXDQ.js";import{h as y,m as O,o as K,p as Q,s as X}from"./chunk-5PTS4JDF.js";import{b as N,c as _,l as w,y as J}from"./chunk-N27U3N2T.js";import{a as C}from"./chunk-NDYVXEZ5.js";import{da as B,p as F,q as P,r as q,t as I,x as D,z as j}from"./chunk-4DLSYLKE.js";import{t as u}from"./chunk-3IBUFXWY.js";var Se=12,m=class e{constructor(t){let i=e.checkUnsupported(t);if(i!=null)throw i;let r=t;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=F(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;let n=r.lods.reduce((a,h)=>(h.level<a.minLod.level&&(a.minLod=h),a.max=Math.max(a.max,h.level),a),{minLod:r.lods[0],max:-1/0}),o=n.minLod,l=2**o.level,c=o.resolution*l,f=o.scale*l;this.levels=new Array(n.max+1);for(let a=0;a<this.levels.length;a++)this.levels[a]={resolution:c,scale:f,tileSize:[c*r.size[0],c*r.size[1]]},c/=2,f/=2}clone(){return new e(this.toTileInfo())}toTileInfo(){return new R({dpi:this.dpi,origin:new w({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>new M({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,r,n){let o=this.levels[t],l=o.tileSize[0],c=o.tileSize[1];n[0]=this.origin[0]+r*l,n[2]=this.origin[0]+(r+1)*l,n[3]=this.origin[1]-i*c,n[1]=this.origin[1]-(i+1)*c}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=N(t[0]),i[1]=_(t[1]),i[2]=N(t[2]),i[3]=_(t[3])):this._isGCS&&(i[0]=y(t[0]),i[1]=y(t[1]),i[2]=y(t[2]),i[3]=y(t[3]))}getExtentGeometry(t,i,r,n=new J){return this.getExtent(t,i,r,g),n.spatialReference=this.spatialReference,n.xmin=g[0],n.ymin=g[1],n.xmax=g[2],n.ymax=g[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){let{resolution:r,scale:n}=this.levels[this.levels.length-1],o=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:n/2,tileSize:[o,o]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){let i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t,i=1/0){if(e.checkUnsupported(t))return!1;let r=new e(t);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;let n=Math.min(this.levels.length-1,r.levels.length-1,i),o=this.levels[n].resolution,l=.5*o;return!O(r.origin[0],this.origin[0],l)||!O(r.origin[1],this.origin[1],l)?!1:(l=.5*o/2**n/this.pixelSize*Se,O(o,r.levels[n].resolution,l))}rootTilesInExtent(t,i=null,r=1/0){let n=new Array,o=this.levels[0].tileSize;if(t==null||o[0]===0||o[1]===0)return n;e.computeRowColExtent(t,o,this.origin,g);let l=g[1],c=g[3],f=g[0],a=g[2],h=a-f,d=c-l;if(h*d>r){let p=Math.floor(Math.sqrt(r));d>p&&(l=l+Math.floor(.5*d)-Math.floor(.5*p),c=l+p),h>p&&(f=f+Math.floor(.5*h)-Math.floor(.5*p),a=f+p)}for(let p=l;p<c;p++)for(let z=f;z<a;z++)n.push([0,p,z]);return i!=null&&(i[0]=this.origin[0]+f*o[0],i[1]=this.origin[1]-c*o[1],i[2]=this.origin[0]+a*o[0],i[3]=this.origin[1]-l*o[1]),n}static computeRowColExtent(t,i,r,n){let o=.001*(t[2]-t[0]+(t[3]-t[1]));n[0]=Math.max(0,Math.floor((t[0]+o-r[0])/i[0])),n[2]=Math.max(0,Math.ceil((t[2]-o-r[0])/i[0])),n[1]=Math.max(0,Math.floor((r[1]-t[3]+o)/i[1])),n[3]=Math.max(0,Math.ceil((r[1]-t[1]-o)/i[1]))}static isPowerOfTwo(t){let i=t.lods,r=i[0].resolution*2**i[0].level;return!i.some(n=>!K(n.resolution,r/2**n.level))}static hasGapInLevels(t){let i=t.lods.map(r=>r.level);i.sort((r,n)=>r-n);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(t){let i=t.size[1];return i===t.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(t){let i=t.origin;return t.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new u("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return t==null?b():t.lods.length<1?new u("tilingscheme:generic","Tiling scheme must have at least one level"):e.isPowerOfTwo(t)?e.hasGapInLevels(t)?new u("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):e.tileSizeSupported(t)?e.hasOriginPerLODs(t)?new u("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new u("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new u("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){let r=t[2]-t[0],n=t[3]-t[1],o=B(i),l=1.2*Math.max(r,n),c=256,f=l/c,a=f*o*(96/.0254),h=new e(new R({size:[c,c],origin:new w({x:t[0]-.5*(l-r),y:t[3]+.5*(l-n)}),lods:[new M({level:0,resolution:f,scale:a})],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){let i=new e(e.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,r=16){let n=256/i,o=new e(new R({size:[i,i],origin:new w({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new M({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return o.ensureMaxLod(r),o}get test(){}};function b(){return new u("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}m.WebMercatorAuxiliarySphereTileInfo=new R({size:[256,256],origin:new w({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:C.WebMercator}),spatialReference:C.WebMercator,lods:[new M({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),m.WebMercatorAuxiliarySphere=m.makeWebMercatorAuxiliarySphere(19);var g=x();var U=64,$e=512,et=2.5,tt=Q(X/10),it=2,xe=x();m.WebMercatorAuxiliarySphere.getExtent(0,0,0,xe);var rt=x([-180,-90,180,90]),nt="Cannot extend surface to encompass all layers because it would result in too many root tiles.",ot="Surface extent is too large for tile resolution at level 0.",st=4;var s;(function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"})(s||(s={}));function ne(e){return e!=null&&"type"in e&&e.type==="vector-tile"}function oe(e){return e!=null&&"type"in e&&e.type==="raster-tile"}function se(e){return e!=null&&"type"in e&&e.type==="tile-texture"}function le(e){return e!=null&&"type"in e&&e.type==="image+type"}function ae(e){return V(e)||D(e)||j(e)}function V(e){return q(e)||I(e)}var E=v(),de=v(),T=v(),S=v();function Ee(e,t,i=0){let r=e.extent;if(r==null)return!1;if(i===0)return Z(r,t);let n=Math.min(r[2]-r[0],r[3]-r[1]);return $(r,t,i*n)}function H(e,t,i,r){te(E,i),E[r]=t[r];let n=W(E,E,t),o=W(de,e,t),l=G(o,n),c=G(n,n),f;f=l<=0?t:c<=l?i:ie(E,t,re(n,n,l/c));let a=W(E,e,f);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*a[0]+a[1]*a[1]))}function we(e,t,i){let r=e.extent;if(r==null)return 0;T[0]=r[0],T[1]=r[1],T[2]=i,S[0]=r[2],S[1]=r[3],S[2]=i;let n=1/0,o=1/0;return t[0]<T[0]?n=H(t,T,S,0):t[0]>S[0]&&(n=H(t,S,T,0)),t[1]<T[1]?o=H(t,T,S,1):t[1]>S[1]&&(o=H(t,S,T,1)),Math.min(n,o)}function ye(e,t,i,r){if(e==null)return b();let n=e.spatialReference;if(n.isGeographic&&!V(n))return new u("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");let o=m.checkUnsupported(e);return o??(i==null?new u("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):ve(e,i)||(t==null||n.equals(t)||t.isWGS84&&n.isWebMercator?null:new u("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function ve(e,t){let i=e.lods,r=i[0].resolution*2**i[0].level,n=[r*e.size[0],r*e.size[1]],o=[e.origin.x,e.origin.y],l=Y(t),c=x();m.computeRowColExtent(l,n,o,c);let f=(c[2]-c[0])*(c[3]-c[1]);if(f>U){let a=i[0].scale*2**i[0].level,h=Math.max((l[3]-l[1])/e.size[1],(l[2]-l[0])/e.size[0])*a/r,d=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**d)*10**d,new u("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(a).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:a,suggestedLevel0Scale:h,requiredNumRootTiles:f,allowedNumRootTiles:U})}return null}var ce=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:ye,isInsideExtent:Ee,tiltToExtentEdge:we},Symbol.toStringTag,{value:"Module"}));function Me(){return!0}function Re(){return 0}function be(e,t,i,r){if(e==null)return b();let n=e?.lods.length-1,o=e.spatialReference;if(o.isWebMercator){if(!m.makeWebMercatorAuxiliarySphere(n).compatibleWith(e,r))return new u("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!ae(o))return new u("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!m.makeGCSWithTileSize(e.spatialReference,e.size[0],n).compatibleWith(e,r))return e.spatialReference.isWGS84?new u("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new u("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return t==null||e.spatialReference.equals(t)?null:new u("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}var ue=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:be,isInsideExtent:Me,tiltToExtentEdge:Re},Symbol.toStringTag,{value:"Module"}));var Ie={[L.Global]:ue,[L.Local]:ce};function At(e,t){e||console.warn("Terrain: "+t)}var A=!1,Oe=!1;function zt(e){Oe=e,A=A||e}function Ct(e){A=e}function Nt(e,t){if(A&&!e){let i=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+i),new Error("Assertion failed"+(t?": "+t:""))}}function fe(e){return e?.type==="imagery-tile"||e?.type==="wcs"}function he(e){return e?.type==="imagery-tile-3d"}function me(e){return e?.type==="tile-3d"}function pe(e){return e?.type==="vector-tile-3d"}function ge(e){return e?.type==="wmts-3d"}function We(e){return e?.type==="elevation-3d"}function _t(e){return e?.type==="group"}function Gt(e){return e&&(me(e)||ge(e)||he(e)||pe(e))}function Le(e){return e&&(me(e)||he(e)||pe(e)||ge(e))}function Ut(e){return Le(e)||We(e)}function Vt(e){return oe(e?.sourceLayerInfo?.data)}function kt(e){return He(e?.sourceLayerInfo)||!!e?.isVTLBackground}function Ft(e){return se(e?.sourceLayerInfo?.data)}function Pt(e){let t=e?.sourceLayerInfo?.data;return le(t)||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData}function He(e){return ne(e?.data)}function qt(e){return e!=null&&"release"in e&&e.release(),null}function Dt(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function Te(e,t,i,r,n){return Ie[r].checkIfTileInfoSupportedForViewSR(e,i,t,n)}function jt(e,t,i){let r=null,n=null;if(e?.type==="wmts"){let l=Ae(e,t,i);r=l.tileInfo,n=l.fullExtent}else{n=fe(e)?e.getCompatibleFullExtent(t):e.fullExtent;let l=i===L.Local;fe(e)?r=e.getCompatibleTileInfo(t,n,l):e?.type==="vector-tile"?r=l&&!ze(t)||Ce.force512VTL?e.tileInfo:e.tileInfo.getCompatibleForVTL(256):r=e.tileInfo}let o="tilemapCache"in e?e.tilemapCache?.effectiveMaxLOD:void 0;return r!=null&&n!=null&&Te(r,n,t,i,o)==null?{tileInfo:r,fullExtent:n}:null}function Ae(e,t,i){let r=ee(e);if(r!=null){if(!k.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{let n=r.find(o=>Te(o.tileInfo,o.fullExtent,t,i)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function ze(e){return e.isWGS84||e.isWebMercator||I(e)||!P(e)}var Ce={force512VTL:!1};function Bt(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function Jt(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function Kt(e,t,i=Ne){return Math.abs(e-t)<i}function Qt(e){return e===s.NORTH_EAST?s.SOUTH_WEST:e===s.NORTH_WEST?s.SOUTH_EAST:e===s.SOUTH_WEST?s.NORTH_EAST:s.NORTH_WEST}function Xt(e){return e===s.NORTH?s.SOUTH:e===s.EAST?s.WEST:e===s.SOUTH?s.NORTH:s.EAST}function Yt(e){return e===s.NORTH_WEST||e===s.SOUTH_WEST}function Zt(e){return e===s.NORTH_WEST||e===s.NORTH_EAST}function $t(e){return e===s.NORTH_WEST||e===s.WEST||e===s.SOUTH_WEST}function ei(e){return e===s.NORTH_EAST||e===s.EAST||e===s.SOUTH_EAST}function ti(e){return e===s.SOUTH_EAST||e===s.SOUTH||e===s.SOUTH_WEST}function ii(e){return e===s.NORTH_EAST||e===s.NORTH||e===s.NORTH_WEST}var ri=[s.NORTH,s.EAST,s.SOUTH,s.WEST],ni=[s.NORTH_EAST,s.SOUTH_EAST,s.SOUTH_WEST,s.NORTH_WEST],Ne=1e-5;export{m as a,U as b,$e as c,et as d,tt as e,it as f,xe as g,rt as h,nt as i,ot as j,st as k,s as l,ne as m,oe as n,se as o,le as p,ae as q,V as r,At as s,A as t,Oe as u,zt as v,Ct as w,Nt as x,fe as y,he as z,pe as A,We as B,_t as C,Gt as D,Le as E,Ut as F,Vt as G,kt as H,Ft as I,Pt as J,He as K,qt as L,Dt as M,Te as N,jt as O,ze as P,Ce as Q,Bt as R,Jt as S,Kt as T,Qt as U,Xt as V,Yt as W,Zt as X,$t as Y,ei as Z,ti as _,ii as $,ri as aa,ni as ba};
