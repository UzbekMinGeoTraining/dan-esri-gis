import{a as zt,b as Q,f as wt,h as Dt,i as $t,j as we,l as $e}from"./chunk-CAC75TDU.js";import{b as Zt}from"./chunk-YRE2G4RX.js";import{a as Ze,f as jt}from"./chunk-F5CPBNZH.js";import{b as Xe,c as _t,d as Ce,e as be}from"./chunk-M4PATAW3.js";import{a as ye}from"./chunk-RRDM7P6F.js";import{l as Ye,y as ge}from"./chunk-N27U3N2T.js";import{a as qe}from"./chunk-4R5NBZMW.js";import{a as Ke}from"./chunk-NDYVXEZ5.js";import{a as Je}from"./chunk-CMMPCPP5.js";import{a as Xt}from"./chunk-B7IARA3F.js";import{b as We}from"./chunk-IZVEJCCI.js";import{g as He,h as yt}from"./chunk-2JF6YUJG.js";import{Q as U}from"./chunk-GGZQ5GCM.js";import{U as gt}from"./chunk-TFUPB3ZG.js";import{a as M}from"./chunk-BMVJCP2M.js";import{k as ze,n as je}from"./chunk-GMC3I5VG.js";import{a as Ot}from"./chunk-WGF2T2BG.js";import{b as rt,r as me,t as mt}from"./chunk-3IBUFXWY.js";import{a as $,b as et,g as pt}from"./chunk-JEGVIFEP.js";var Qe,tr={exports:{}};function Vr(){return Qe||(Qe=1,e=tr,t=function(){function i(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return i.prototype={ensureBuffer:function(o){var l=this.buffer,h=l?l.byteLength:0;if(o<h)return l;for(var a=512;a<o;)a<<=1;for(var s=new Uint8Array(a),u=0;u<h;++u)s[u]=l[u];return this.buffer=s},getByte:function(){for(var o=this.pos;this.bufferLength<=o;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(o){var l=this.pos;if(o){this.ensureBuffer(l+o);for(var h=l+o;!this.eof&&this.bufferLength<h;)this.readBlock();var a=this.bufferLength;h>a&&(h=a)}else{for(;!this.eof;)this.readBlock();h=this.bufferLength}return this.pos=h,this.buffer.subarray(l,h)},lookChar:function(){for(var o=this.pos;this.bufferLength<=o;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var o=this.pos;this.bufferLength<=o;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(o,l,h){for(var a=o+l;this.bufferLength<=a&&!this.eof;)this.readBlock();return new Stream(this.buffer,o,l,h)},skip:function(o){o||(o=1),this.pos+=o},reset:function(){this.pos=0}},i}(),(r=function(){if(!self||!self.Uint32Array)return null;var i=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),l=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),h=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function s(n){throw new Error(n)}function u(n){var c=0,f=n[c++],d=n[c++];f!=-1&&d!=-1||s("Invalid header in flate stream"),(15&f)!=8&&s("Unknown compression method in flate stream"),((f<<8)+d)%31!=0&&s("Bad FCHECK in flate stream"),32&d&&s("FDICT bit set in flate stream"),this.bytes=n,this.bytesPos=c,this.codeSize=0,this.codeBuf=0,t.call(this)}return u.prototype=Object.create(t.prototype),u.prototype.getBits=function(n){for(var c,f=this.codeSize,d=this.codeBuf,m=this.bytes,g=this.bytesPos;f<n;)(c=m[g++])===void 0&&s("Bad encoding in flate stream"),d|=c<<f,f+=8;return c=d&(1<<n)-1,this.codeBuf=d>>n,this.codeSize=f-=n,this.bytesPos=g,c},u.prototype.getCode=function(n){for(var c=n[0],f=n[1],d=this.codeSize,m=this.codeBuf,g=this.bytes,S=this.bytesPos;d<f;){var C;(C=g[S++])===void 0&&s("Bad encoding in flate stream"),m|=C<<d,d+=8}var I=c[m&(1<<f)-1],v=I>>16,p=65535&I;return(d==0||d<v||v==0)&&s("Bad encoding in flate stream"),this.codeBuf=m>>v,this.codeSize=d-v,this.bytesPos=S,p},u.prototype.generateHuffmanTable=function(n){for(var c=n.length,f=0,d=0;d<c;++d)n[d]>f&&(f=n[d]);for(var m=1<<f,g=new Uint32Array(m),S=1,C=0,I=2;S<=f;++S,C<<=1,I<<=1)for(var v=0;v<c;++v)if(n[v]==S){var p=0,y=C;for(d=0;d<S;++d)p=p<<1|1&y,y>>=1;for(d=p;d<m;d+=I)g[d]=S<<16|v;++C}return[g,f]},u.prototype.readBlock=function(){function n(z,Y,j,F,W){for(var tt=z.getBits(j)+F;tt-- >0;)Y[I++]=W}var c=this.getBits(3);if(1&c&&(this.eof=!0),(c>>=1)!=0){var f,d;if(c==1)f=h,d=a;else if(c==2){for(var m=this.getBits(5)+257,g=this.getBits(5)+1,S=this.getBits(4)+4,C=Array(i.length),I=0;I<S;)C[i[I++]]=this.getBits(3);for(var v=this.generateHuffmanTable(C),p=0,y=(I=0,m+g),T=new Array(y);I<y;){var w=this.getCode(v);w==16?n(this,T,2,3,p):w==17?n(this,T,3,3,p=0):w==18?n(this,T,7,11,p=0):T[I++]=p=w}f=this.generateHuffmanTable(T.slice(0,m)),d=this.generateHuffmanTable(T.slice(m,y))}else s("Unknown block type in flate stream");for(var b=(L=this.buffer)?L.length:0,x=this.bufferLength;;){var k=this.getCode(f);if(k<256)x+1>=b&&(b=(L=this.ensureBuffer(x+1)).length),L[x++]=k;else{if(k==256)return void(this.bufferLength=x);var A=(k=o[k-=257])>>16;A>0&&(A=this.getBits(A)),p=(65535&k)+A,k=this.getCode(d),(A=(k=l[k])>>16)>0&&(A=this.getBits(A));var E=(65535&k)+A;x+p>=b&&(b=(L=this.ensureBuffer(x+p)).length);for(var P=0;P<p;++P,++x)L[x]=L[x-E]}}}else{var R,G=this.bytes,O=this.bytesPos;(R=G[O++])===void 0&&s("Bad block header in flate stream");var V=R;(R=G[O++])===void 0&&s("Bad block header in flate stream"),V|=R<<8,(R=G[O++])===void 0&&s("Bad block header in flate stream");var N=R;(R=G[O++])===void 0&&s("Bad block header in flate stream"),(N|=R<<8)!=(65535&~V)&&s("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var J=this.bufferLength,L=this.ensureBuffer(J+V),_=J+V;this.bufferLength=_;for(var B=J;B<_;++B){if((R=G[O++])===void 0){this.eof=!0;break}L[B]=R}this.bytesPos=O}},u}())!==void 0&&(e.exports=r)),tr.exports;var t,e,r}var vt=Zt(Vr());var Qt=class t{constructor(e){this._canvas=null,this._ctx=null,e&&(this._canvas=e.canvas,this._ctx=e.ctx||e.canvas&&e.canvas.getContext("2d"))}decode(e,r,i){if(!e||e.byteLength<10)throw new mt("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:o=0,height:l=0,format:h}=r,{applyJpegMask:a}=r;if(a&&(!o||!l))throw new mt("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((s,u)=>{let n=null;h==="jpg"&&a&&(n=t._getMask(e,{width:o,height:l}));let c=new Blob([new Uint8Array(e)],{type:"image/"+h=="jpg"?"jpeg":h}),f=URL.createObjectURL(c),d=new Image,m;d.src=f,d.onload=()=>{if(URL.revokeObjectURL(f),je(i))return void u(ze());o=d.width,l=d.height,this._canvas&&this._ctx?(this._canvas.width===o&&this._canvas.height===l||(this._canvas.width=o,this._canvas.height=l),this._ctx.clearRect(0,0,o,l)):(this._canvas=document.createElement("canvas"),this._canvas.width=o,this._canvas.height=l,this._ctx=this._canvas.getContext("2d")),this._ctx.drawImage(d,0,0);let g=this._ctx.getImageData(0,0,o,l),S;if(m=g.data,r.renderOnCanvas){if(n)for(S=0;S<n.length;S++)n[S]?m[4*S+3]=255:m[4*S+3]=0;return this._ctx.putImageData(g,0,0),void s(null)}let C=o*l,I=new Uint8Array(C),v=new Uint8Array(C),p=new Uint8Array(C);if(n)for(S=0;S<C;S++)I[S]=m[4*S],v[S]=m[4*S+1],p[S]=m[4*S+2];else for(n=new Uint8Array(C),S=0;S<C;S++)I[S]=m[4*S],v[S]=m[4*S+1],p[S]=m[4*S+2],n[S]=m[4*S+3];s({width:o,height:l,pixels:[I,v,p],mask:n,pixelType:"u8"})},d.onerror=()=>{URL.revokeObjectURL(f),u("cannot load image")}})}static _getMask(e,r){let i=null;try{let o=new Uint8Array(e),l=Math.ceil(o.length/2),h=0,a=o.length-2;for(h=l;h<a&&(o[h]!==255||o[h+1]!==217);h++);if(h+=2,h<o.length-1){let s=new vt(o.subarray(h)).getBytes();i=new Uint8Array(r.width*r.height);let u=0;for(let n=0;n<s.length;n++)for(let c=7;c>=0;c--)i[u++]=s[n]>>c&1}}catch{}return i}};var er,rr={exports:{}};function _r(){return er||(er=1,t=rr,e=function(){var i=function(){function o(l){this.message="JPEG error: "+l}return o.prototype=new Error,o.prototype.name="JpegError",o.constructor=o,o}();return function(){if(!self||!self.Uint8ClampedArray)return null;var o=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),l=4017,h=799,a=3406,s=2276,u=1567,n=3784,c=5793,f=2896;function d(){this.decodeTransform=null,this.colorTransform=-1}function m(p,y){for(var T,w,b=0,x=[],k=16;k>0&&!p[k-1];)k--;x.push({children:[],index:0});var A,E=x[0];for(T=0;T<k;T++){for(w=0;w<p[T];w++){for((E=x.pop()).children[E.index]=y[b];E.index>0;)E=x.pop();for(E.index++,x.push(E);x.length<=T;)x.push(A={children:[],index:0}),E.children[E.index]=A.children,E=A;b++}T+1<k&&(x.push(A={children:[],index:0}),E.children[E.index]=A.children,E=A)}return x[0].children}function g(p,y,T){return 64*((p.blocksPerLine+1)*y+T)}function S(p,y,T,w,b,x,k,A,E){var P=T.mcusPerLine,R=T.progressive,G=y,O=0,V=0;function N(){if(V>0)return V--,O>>V&1;if((O=p[y++])===255){var D=p[y++];if(D)throw new i("unexpected marker "+(O<<8|D).toString(16))}return V=7,O>>>7}function J(D){for(var K=D;;){if(typeof(K=K[N()])=="number")return K;if(typeof K!="object")throw new i("invalid huffman sequence")}}function L(D){for(var K=0;D>0;)K=K<<1|N(),D--;return K}function _(D){if(D===1)return N()===1?1:-1;var K=L(D);return K>=1<<D-1?K:K+(-1<<D)+1}function B(D,K){var q=J(D.huffmanTableDC),ot=q===0?0:_(q);D.blockData[K]=D.pred+=ot;for(var st=1;st<64;){var ht=J(D.huffmanTableAC),it=15&ht,lt=ht>>4;if(it!==0){var Fr=o[st+=lt];D.blockData[K+Fr]=_(it),st++}else{if(lt<15)break;st+=16}}}function z(D,K){var q=J(D.huffmanTableDC),ot=q===0?0:_(q)<<E;D.blockData[K]=D.pred+=ot}function Y(D,K){D.blockData[K]|=N()<<E}var j=0;function F(D,K){if(j>0)j--;else for(var q=x,ot=k;q<=ot;){var st=J(D.huffmanTableAC),ht=15&st,it=st>>4;if(ht!==0){var lt=o[q+=it];D.blockData[K+lt]=_(ht)*(1<<E),q++}else{if(it<15){j=L(it)+(1<<it)-1;break}q+=16}}}var W,tt=0;function kt(D,K){for(var q,ot,st=x,ht=k,it=0;st<=ht;){var lt=o[st];switch(tt){case 0:if(it=(ot=J(D.huffmanTableAC))>>4,(q=15&ot)==0)it<15?(j=L(it)+(1<<it),tt=4):(it=16,tt=1);else{if(q!==1)throw new i("invalid ACn encoding");W=_(q),tt=it?2:3}continue;case 1:case 2:D.blockData[K+lt]?D.blockData[K+lt]+=N()<<E:--it==0&&(tt=tt===2?3:0);break;case 3:D.blockData[K+lt]?D.blockData[K+lt]+=N()<<E:(D.blockData[K+lt]=W<<E,tt=0);break;case 4:D.blockData[K+lt]&&(D.blockData[K+lt]+=N()<<E)}st++}tt===4&&--j==0&&(tt=0)}function Ft(D,K,q,ot,st){var ht=q%P;K(D,g(D,(q/P|0)*D.v+ot,ht*D.h+st))}function de(D,K,q){K(D,g(D,q/D.blocksPerLine|0,q%D.blocksPerLine))}var St,ft,Ct,xt,Z,Vt,It=w.length;Vt=R?x===0?A===0?z:Y:A===0?F:kt:B;var ct,At,Kt,qt,bt=0;for(At=It===1?w[0].blocksPerLine*w[0].blocksPerColumn:P*T.mcusPerColumn;bt<At;){var Yt=b?Math.min(At-bt,b):At;for(ft=0;ft<It;ft++)w[ft].pred=0;if(j=0,It===1)for(St=w[0],Z=0;Z<Yt;Z++)de(St,Vt,bt),bt++;else for(Z=0;Z<Yt;Z++){for(ft=0;ft<It;ft++)for(Kt=(St=w[ft]).h,qt=St.v,Ct=0;Ct<qt;Ct++)for(xt=0;xt<Kt;xt++)Ft(St,Vt,bt,Ct,xt);bt++}V=0,(ct=v(p,y))&&ct.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+ct.invalid),y=ct.offset);var Et=ct&&ct.marker;if(!Et||Et<=65280)throw new i("marker was not found");if(!(Et>=65488&&Et<=65495))break;y+=2}return(ct=v(p,y))&&ct.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+ct.invalid),y=ct.offset),y-G}function C(p,y,T){var w,b,x,k,A,E,P,R,G,O,V,N,J,L,_,B,z,Y=p.quantizationTable,j=p.blockData;if(!Y)throw new i("missing required Quantization Table.");for(var F=0;F<64;F+=8)G=j[y+F],O=j[y+F+1],V=j[y+F+2],N=j[y+F+3],J=j[y+F+4],L=j[y+F+5],_=j[y+F+6],B=j[y+F+7],G*=Y[F],O|V|N|J|L|_|B?(O*=Y[F+1],V*=Y[F+2],N*=Y[F+3],J*=Y[F+4],L*=Y[F+5],_*=Y[F+6],B*=Y[F+7],b=(w=(w=c*G+128>>8)+(b=c*J+128>>8)+1>>1)-b,z=(x=V)*n+(k=_)*u+128>>8,x=x*u-k*n+128>>8,P=(A=(A=f*(O-B)+128>>8)+(P=L<<4)+1>>1)-P,E=(R=(R=f*(O+B)+128>>8)+(E=N<<4)+1>>1)-E,k=(w=w+(k=z)+1>>1)-k,x=(b=b+x+1>>1)-x,z=A*s+R*a+2048>>12,A=A*a-R*s+2048>>12,R=z,z=E*h+P*l+2048>>12,E=E*l-P*h+2048>>12,P=z,T[F]=w+R,T[F+7]=w-R,T[F+1]=b+P,T[F+6]=b-P,T[F+2]=x+E,T[F+5]=x-E,T[F+3]=k+A,T[F+4]=k-A):(z=c*G+512>>10,T[F]=z,T[F+1]=z,T[F+2]=z,T[F+3]=z,T[F+4]=z,T[F+5]=z,T[F+6]=z,T[F+7]=z);for(var W=0;W<8;++W)G=T[W],(O=T[W+8])|(V=T[W+16])|(N=T[W+24])|(J=T[W+32])|(L=T[W+40])|(_=T[W+48])|(B=T[W+56])?(b=(w=4112+((w=c*G+2048>>12)+(b=c*J+2048>>12)+1>>1))-b,z=(x=V)*n+(k=_)*u+2048>>12,x=x*u-k*n+2048>>12,k=z,P=(A=(A=f*(O-B)+2048>>12)+(P=L)+1>>1)-P,E=(R=(R=f*(O+B)+2048>>12)+(E=N)+1>>1)-E,z=A*s+R*a+2048>>12,A=A*a-R*s+2048>>12,R=z,z=E*h+P*l+2048>>12,E=E*l-P*h+2048>>12,G=(G=(w=w+k+1>>1)+R)<16?0:G>=4080?255:G>>4,O=(O=(b=b+x+1>>1)+(P=z))<16?0:O>=4080?255:O>>4,V=(V=(x=b-x)+E)<16?0:V>=4080?255:V>>4,N=(N=(k=w-k)+A)<16?0:N>=4080?255:N>>4,J=(J=k-A)<16?0:J>=4080?255:J>>4,L=(L=x-E)<16?0:L>=4080?255:L>>4,_=(_=b-P)<16?0:_>=4080?255:_>>4,B=(B=w-R)<16?0:B>=4080?255:B>>4,j[y+W]=G,j[y+W+8]=O,j[y+W+16]=V,j[y+W+24]=N,j[y+W+32]=J,j[y+W+40]=L,j[y+W+48]=_,j[y+W+56]=B):(z=(z=c*G+8192>>14)<-2040?0:z>=2024?255:z+2056>>4,j[y+W]=z,j[y+W+8]=z,j[y+W+16]=z,j[y+W+24]=z,j[y+W+32]=z,j[y+W+40]=z,j[y+W+48]=z,j[y+W+56]=z)}function I(p,y){for(var T=y.blocksPerLine,w=y.blocksPerColumn,b=new Int16Array(64),x=0;x<w;x++)for(var k=0;k<T;k++)C(y,g(y,x,k),b);return y.blockData}function v(p,y,T){function w(E){return p[E]<<8|p[E+1]}var b=p.length-1,x=T<y?T:y;if(y>=b)return null;var k=w(y);if(k>=65472&&k<=65534)return{invalid:null,marker:k,offset:y};for(var A=w(x);!(A>=65472&&A<=65534);){if(++x>=b)return null;A=w(x)}return{invalid:k.toString(16),marker:A,offset:x}}return d.prototype={parse:function(p){function y(){var D=p[k]<<8|p[k+1];return k+=2,D}function T(){var D=y(),K=k+D-2,q=v(p,K,k);q&&q.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+q.invalid),K=q.offset);var ot=p.subarray(k,K);return k+=ot.length,ot}function w(D){for(var K=Math.ceil(D.samplesPerLine/8/D.maxH),q=Math.ceil(D.scanLines/8/D.maxV),ot=0;ot<D.components.length;ot++){Z=D.components[ot];var st=Math.ceil(Math.ceil(D.samplesPerLine/8)*Z.h/D.maxH),ht=Math.ceil(Math.ceil(D.scanLines/8)*Z.v/D.maxV),it=K*Z.h,lt=q*Z.v*64*(it+1);Z.blockData=new Int16Array(lt),Z.blocksPerLine=st,Z.blocksPerColumn=ht}D.mcusPerLine=K,D.mcusPerColumn=q}var b,x,k=0,A=null,E=null,P=[],R=[],G=[],O=y();if(O!==65496)throw new i("SOI not found");for(O=y();O!==65497;){var V,N,J;switch(O){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var L=T();O===65504&&L[0]===74&&L[1]===70&&L[2]===73&&L[3]===70&&L[4]===0&&(A={version:{major:L[5],minor:L[6]},densityUnits:L[7],xDensity:L[8]<<8|L[9],yDensity:L[10]<<8|L[11],thumbWidth:L[12],thumbHeight:L[13],thumbData:L.subarray(14,14+3*L[12]*L[13])}),O===65518&&L[0]===65&&L[1]===100&&L[2]===111&&L[3]===98&&L[4]===101&&(E={version:L[5]<<8|L[6],flags0:L[7]<<8|L[8],flags1:L[9]<<8|L[10],transformCode:L[11]});break;case 65499:for(var _=y()+k-2;k<_;){var B=p[k++],z=new Uint16Array(64);if(B>>4){if(B>>4!=1)throw new i("DQT - invalid table spec");for(N=0;N<64;N++)z[o[N]]=y()}else for(N=0;N<64;N++)z[o[N]]=p[k++];P[15&B]=z}break;case 65472:case 65473:case 65474:if(b)throw new i("Only single frame JPEGs supported");y(),(b={}).extended=O===65473,b.progressive=O===65474,b.precision=p[k++],b.scanLines=y(),b.samplesPerLine=y(),b.components=[],b.componentIds={};var Y,j=p[k++],F=0,W=0;for(V=0;V<j;V++){Y=p[k];var tt=p[k+1]>>4,kt=15&p[k+1];F<tt&&(F=tt),W<kt&&(W=kt);var Ft=p[k+2];J=b.components.push({h:tt,v:kt,quantizationId:Ft,quantizationTable:null}),b.componentIds[Y]=J-1,k+=3}b.maxH=F,b.maxV=W,w(b);break;case 65476:var de=y();for(V=2;V<de;){var St=p[k++],ft=new Uint8Array(16),Ct=0;for(N=0;N<16;N++,k++)Ct+=ft[N]=p[k];var xt=new Uint8Array(Ct);for(N=0;N<Ct;N++,k++)xt[N]=p[k];V+=17+Ct,(St>>4?R:G)[15&St]=m(ft,xt)}break;case 65501:y(),x=y();break;case 65498:y();var Z,Vt=p[k++],It=[];for(V=0;V<Vt;V++){var ct=b.componentIds[p[k++]];Z=b.components[ct];var At=p[k++];Z.huffmanTableDC=G[At>>4],Z.huffmanTableAC=R[15&At],It.push(Z)}var Kt=p[k++],qt=p[k++],bt=p[k++],Yt=S(p,k,b,It,x,Kt,qt,bt>>4,15&bt);k+=Yt;break;case 65535:p[k]!==255&&k--;break;default:if(p[k-3]===255&&p[k-2]>=192&&p[k-2]<=254){k-=3;break}throw new i("unknown marker "+O.toString(16))}O=y()}for(this.width=b.samplesPerLine,this.height=b.scanLines,this.jfif=A,this.eof=k,this.adobe=E,this.components=[],V=0;V<b.components.length;V++){var Et=P[(Z=b.components[V]).quantizationId];Et&&(Z.quantizationTable=Et),this.components.push({output:I(b,Z),scaleX:Z.h/b.maxH,scaleY:Z.v/b.maxV,blocksPerLine:Z.blocksPerLine,blocksPerColumn:Z.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(p,y){var T,w,b,x,k,A,E,P,R,G,O,V=this.width/p,N=this.height/y,J=0,L=this.components.length,_=p*y*L,B=new Uint8ClampedArray(_),z=new Uint32Array(p),Y=4294967288;for(E=0;E<L;E++){for(w=(T=this.components[E]).scaleX*V,b=T.scaleY*N,J=E,O=T.output,x=T.blocksPerLine+1<<3,k=0;k<p;k++)P=0|k*w,z[k]=(P&Y)<<3|7&P;for(A=0;A<y;A++)for(G=x*((P=0|A*b)&Y)|(7&P)<<3,k=0;k<p;k++)B[J]=O[G+z[k]],J+=L}var j=this.decodeTransform;if(j)for(E=0;E<_;)for(P=0,R=0;P<L;P++,E++,R+=2)B[E]=(B[E]*j[R]>>8)+j[R+1];return B},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(p){for(var y,T,w,b=0,x=p.length;b<x;b+=3)y=p[b],T=p[b+1],w=p[b+2],p[b]=y-179.456+1.402*w,p[b+1]=y+135.459-.344*T-.714*w,p[b+2]=y-226.816+1.772*T;return p},_convertYcckToRgb:function(p){for(var y,T,w,b,x=0,k=0,A=p.length;k<A;k+=4)y=p[k],T=p[k+1],w=p[k+2],b=p[k+3],p[x++]=T*(-660635669420364e-19*T+.000437130475926232*w-54080610064599e-18*y+.00048449797120281*b-.154362151871126)-122.67195406894+w*(-.000957964378445773*w+.000817076911346625*y-.00477271405408747*b+1.53380253221734)+y*(.000961250184130688*y-.00266257332283933*b+.48357088451265)+b*(-.000336197177618394*b+.484791561490776),p[x++]=107.268039397724+T*(219927104525741e-19*T-.000640992018297945*w+.000659397001245577*y+.000426105652938837*b-.176491792462875)+w*(-.000778269941513683*w+.00130872261408275*y+.000770482631801132*b-.151051492775562)+y*(.00126935368114843*y-.00265090189010898*b+.25802910206845)+b*(-.000318913117588328*b-.213742400323665),p[x++]=T*(-.000570115196973677*T-263409051004589e-19*w+.0020741088115012*y-.00288260236853442*b+.814272968359295)-20.810012546947+w*(-153496057440975e-19*w-.000132689043961446*y+.000560833691242812*b-.195152027534049)+y*(.00174418132927582*y-.00255243321439347*b+.116935020465145)+b*(-.000343531996510555*b+.24165260232407);return p},_convertYcckToCmyk:function(p){for(var y,T,w,b=0,x=p.length;b<x;b+=4)y=p[b],T=p[b+1],w=p[b+2],p[b]=434.456-y-1.402*w,p[b+1]=119.541-y+.344*T+.714*w,p[b+2]=481.816-y-1.772*T;return p},_convertCmykToRgb:function(p){for(var y,T,w,b,x=0,k=1/255,A=0,E=p.length;A<E;A+=4)y=p[A]*k,T=p[A+1]*k,w=p[A+2]*k,b=p[A+3]*k,p[x++]=255+y*(-4.387332384609988*y+54.48615194189176*T+18.82290502165302*w+212.25662451639585*b-285.2331026137004)+T*(1.7149763477362134*T-5.6096736904047315*w-17.873870861415444*b-5.497006427196366)+w*(-2.5217340131683033*w-21.248923337353073*b+17.5119270841813)-b*(21.86122147463605*b+189.48180835922747),p[x++]=255+y*(8.841041422036149*y+60.118027045597366*T+6.871425592049007*w+31.159100130055922*b-79.2970844816548)+T*(-15.310361306967817*T+17.575251261109482*w+131.35250912493976*b-190.9453302588951)+w*(4.444339102852739*w+9.8632861493405*b-24.86741582555878)-b*(20.737325471181034*b+187.80453709719578),p[x++]=255+y*(.8842522430003296*y+8.078677503112928*T+30.89978309703729*w-.23883238689178934*b-14.183576799673286)+T*(10.49593273432072*T+63.02378494754052*w+50.606957656360734*b-112.23884253719248)+w*(.03296041114873217*w+115.60384449646641*b-193.58209356861505)-b*(22.33816807309886*b+180.12613974708367);return p},getData:function(p,y,T){if(this.numComponents>4)throw new i("Unsupported color mode");var w=this._getLinearizedBlockData(p,y);if(this.numComponents===1&&T){for(var b=w.length,x=new Uint8ClampedArray(3*b),k=0,A=0;A<b;A++){var E=w[A];x[k++]=E,x[k++]=E,x[k++]=E}return x}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(w);if(this.numComponents===4){if(this._isColorConversionNeeded())return T?this._convertYcckToRgb(w):this._convertYcckToCmyk(w);if(T)return this._convertCmykToRgb(w)}return w}},d}()},(r=e())!==void 0&&(t.exports=r)),rr.exports;var t,e,r}var te=Zt(_r());var ee=class{static decode(e,r=!1){let i=new Uint8Array(e),o=new te;o.parse(i);let{width:l,height:h,numComponents:a,eof:s}=o,u=o.getData(l,h,!0),n=l*h,c,f=null,d=0,m=0,g=0;if(!r&&s<i.length-1)try{let S=new vt(i.subarray(s)).getBytes();f=new Uint8Array(n);let C=0;for(d=0;d<S.length;d++)for(g=7;g>=0;g--)f[C++]=S[d]>>g&1}catch{}if(a===1&&u.length===l*h){let S=new Uint8Array(u.buffer);c=[S,S,S]}else{for(c=[],d=0;d<3;d++)c.push(new Uint8Array(n));for(g=0,m=0;m<n;m++)for(d=0;d<3;d++)c[d][m]=u[g++]}return{width:l,height:h,pixels:c,mask:f}}};var or=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}],ve=null;function oe(){return ve||(ve=import("./chunk-CPQ3HZCO.js").then(t=>t.l).then(({default:t})=>t({locateFile:e=>We(`esri/layers/support/rasterFormats/${e}`)})).then(t=>{jr(t)}),ve)}var re={getBlobInfo:null,decode:null};function zr(t){return 16+(t>>3<<3)}function Tt(t,e,r){r.set(t.slice(e,e+r.length))}function jr(t){let{_malloc:e,_free:r,_lerc_getBlobInfo:i,_lerc_getDataRanges:o,_lerc_decode_4D:l,asm:h}=t,a,s=Object.values(h).find(n=>n&&"buffer"in n&&n.buffer===t.HEAPU8.buffer),u=n=>{let c=n.map(g=>zr(g)),f=c.reduce((g,S)=>g+S),d=e(f);a=new Uint8Array(s.buffer);let m=c[0];c[0]=d;for(let g=1;g<c.length;g++){let S=c[g];c[g]=c[g-1]+m,m=S}return c};re.getBlobInfo=n=>{let d=new Uint8Array(48),m=new Uint8Array(8*3),[g,S,C]=u([n.length,d.length,m.length]);a.set(n,g),a.set(d,S),a.set(m,C);let I=i(g,n.length,S,C,12,3);if(I)throw r(g),new Error(`lerc-getBlobInfo: error code is ${I}`);a=new Uint8Array(s.buffer),Tt(a,S,d),Tt(a,C,m);let v=new Uint32Array(d.buffer),p=new Float64Array(m.buffer),[y,T,,w,b,x,k,A,E,P,R]=v,G={version:y,depthCount:P,width:w,height:b,validPixelCount:k,bandCount:x,blobSize:A,maskCount:E,dataType:T,minValue:p[0],maxValue:p[1],maxZerror:p[2],statistics:[],bandCountWithNoData:R};if(R&&P>1)return r(g),G;if(P===1&&x===1)return r(g),G.statistics.push({minValue:p[0],maxValue:p[1]}),G;let O=P*x*8,V=new Uint8Array(O),N=new Uint8Array(O),J=g,L=0,_=0,B=!1;if(a.byteLength<g+2*O?(r(g),B=!0,[J,L,_]=u([n.length,O,O]),a.set(n,J)):[L,_]=u([O,O]),a.set(V,L),a.set(N,_),I=o(J,n.length,P,x,L,_),I)throw r(J),B||r(L),new Error(`lerc-getDataRanges: error code is ${I}`);a=new Uint8Array(s.buffer),Tt(a,L,V),Tt(a,_,N);let z=new Float64Array(V.buffer),Y=new Float64Array(N.buffer),j=G.statistics;for(let F=0;F<x;F++)if(P>1){let W=z.slice(F*P,(F+1)*P),tt=Y.slice(F*P,(F+1)*P),kt=Math.min.apply(null,W),Ft=Math.max.apply(null,tt);j.push({minValue:kt,maxValue:Ft,depthStats:{minValues:W,maxValues:tt}})}else j.push({minValue:z[F],maxValue:Y[F]});return r(J),B||r(L),G},re.decode=(n,c)=>{let{maskCount:f,depthCount:d,bandCount:m,width:g,height:S,dataType:C,bandCountWithNoData:I}=c,v=or[C],p=g*S,y=new Uint8Array(p*m),T=p*d*m*v.size,w=new Uint8Array(T),b=new Uint8Array(m),x=new Uint8Array(8*m),[k,A,E,P,R]=u([n.length,y.length,w.length,b.length,x.length]);a.set(n,k),a.set(y,A),a.set(w,E),a.set(b,P),a.set(x,R);let G=l(k,n.length,f,A,d,g,S,m,C,E,P,R);if(G)throw r(k),new Error(`lerc-decode: error code is ${G}`);a=new Uint8Array(s.buffer),Tt(a,E,w),Tt(a,A,y);let O=null;if(I){Tt(a,P,b),Tt(a,R,x),O=[];let V=new Float64Array(x.buffer);for(let N=0;N<b.length;N++)O.push(b[N]?V[N]:null)}return r(k),{data:w,maskData:y,noDataValues:O}}}function Hr(t,e,r,i,o){if(r<2)return t;let l=new i(e*r);for(let h=0,a=0;h<e;h++)for(let s=0,u=h;s<r;s++,u+=e)l[u]=t[a++];return l}function ie(t,e={}){let r=e.inputOffset??0,i=t instanceof Uint8Array?t.subarray(r):new Uint8Array(t,r),o=re.getBlobInfo(i),{data:l,maskData:h,noDataValues:a}=re.decode(i,o),{width:s,height:u,bandCount:n,depthCount:c,dataType:f,maskCount:d,statistics:m}=o,g=or[f],S=new g.ctor(l.buffer),C=[],I=[],v=s*u,p=v*c;for(let k=0;k<n;k++){let A=S.subarray(k*p,(k+1)*p);if(e.returnInterleaved)C.push(A);else{let E=Hr(A,v,c,g.ctor);C.push(E)}I.push(h.subarray(k*p,(k+1)*p))}let y=d===0?null:d===1?I[0]:new Uint8Array(v);if(d>1){y.set(I[0]);for(let k=1;k<I.length;k++){let A=I[k];for(let E=0;E<v;E++)y[E]=y[E]&A[E]}}let{noDataValue:T}=e,w=T!=null&&g.range[0]<=T&&g.range[1]>=T;if(d>0&&w)for(let k=0;k<n;k++){let A=C[k],E=I[k]||y;for(let P=0;P<v;P++)E[P]===0&&(A[P]=T)}let b=d===n&&n>1?I:null,{pixelType:x}=g;return{width:s,height:u,bandCount:n,pixelType:x,depthCount:c,statistics:m,pixels:C,mask:y,bandMasks:b,noDataValues:a}}function Wr(t,e,r,i=!0){if(e%4!=0||r%4!=0){let o=new ArrayBuffer(4*Math.ceil(r/4)),l=new Uint8Array(o),h=new Uint8Array(t,e,r);if(i)for(let a=0;a<l.length;a+=4)l[a]=h[a+3],l[a+1]=h[a+2],l[a+2]=h[a+1],l[a+3]=h[a];else l.set(h);return new Uint32Array(l.buffer)}if(i){let o=new Uint8Array(t,e,r),l=new Uint8Array(o.length);for(let h=0;h<l.length;h+=4)l[h]=o[h+3],l[h+1]=o[h+2],l[h+2]=o[h+1],l[h+3]=o[h];return new Uint32Array(l.buffer)}return new Uint32Array(t,e,r/4)}function ir(){let t=[];for(let e=0;e<=257;e++)t[e]=[e];return t}function nr(t,e){for(let r=0;r<e.length;r++)t.push(e[r])}var Ut=new Set;function Ht(t,e,r,i=!0){let o=Wr(t,e,r,i),l=9,h=ir(),a=32,s=h.length,u=[],n=1,c=o[0],f=0,d=o.length,m=8*(4*d-r),g=[];for(;c!=null;){if(a>=l)a-=l,f=c>>>32-l,c<<=l;else{f=c>>>32-a,c=o[n++];let C=l-a;a=32-C,f=(f<<C)+(c>>>a),c<<=C}if(f===257)break;if(f===256){l=9,h=ir(),s=h.length,u=[];continue}let S=h[f];if(S==null){if(f>h.length)throw new Error("data integrity issue: code does not exist on code page");u.push(u[0]),h[s++]=u.slice(),nr(g,u)}else nr(g,S),u.push(S[0]),u.length>1&&(h[s++]=u.slice()),u=S.slice();if(Ut.has(s)&&l++,a===0&&(c=o[n++],a=32),n>d||n===d&&a<=m)break}return new Uint8Array(g)}Ut.add(511),Ut.add(1023),Ut.add(2047),Ut.add(4095),Ut.add(8191);var ar=(t,e)=>{let r=e.width*e.height,i=e.pixelType;return Math.floor(t.byteLength/(r*sr(i)))},sr=t=>{let e=1;switch(t){case Uint8Array:case Int8Array:e=1;break;case Uint16Array:case Int16Array:e=2;break;case Uint32Array:case Int32Array:case Float32Array:e=4;break;case Float64Array:e=8}return e},Jr=(t,e)=>{if(8*t.byteLength<e)return null;let r=new Uint8Array(t,0,Math.ceil(e/8)),i=new Uint8Array(e),o=0,l=0,h=0,a=0;for(h=0;h<r.length-1;h++)for(l=r[h],a=7;a>=0;a--)i[o++]=l>>a&1;for(a=7;o<e-1;)l=r[r.length-1],i[o++]=l>>a&1,a--;return i},ne=class{static decode(e,r){let i=r.pixelType,o=[],l=r.width*r.height,h=ar(e,r),{bandIds:a,format:s}=r,u=a?.length||ar(e,r),n=e.byteLength-e.byteLength%(l*sr(i)),c=new i(e,0,l*h),f,d,m,g,S=null;if(s==="bip")for(f=0;f<u;f++){for(m=new i(l),g=a?a[f]:f,d=0;d<l;d++)m[d]=c[d*h+g];o.push(m)}else if(s==="bsq")for(f=0;f<u;f++)g=a?a[f]:f,o.push(c.subarray(g*l,(g+1)*l));return n<e.byteLength-1&&(S=Jr(e.slice(n),l)),{pixels:o,mask:S}}};function lr(t,e){let r=0,i="",o=0,l=0,h=t.length;for(;r<h;)l=t[r++],o=l>>4,o<8?o=1:o===15?(o=4,l=(7&l)<<18|(63&t[r++])<<12|(63&t[r++])<<6|63&t[r++]):o===14?(o=3,l=(15&l)<<12|(63&t[r++])<<6|63&t[r++]):(o=2,l=(31&l)<<6|63&t[r++]),(l!==0||e)&&(i+=String.fromCharCode(l));return i}var Te=(()=>{let t=[];return t[254]="NEWSUBFILETYPE",t[255]="SUBFILETYPE",t[256]="IMAGEWIDTH",t[257]="IMAGELENGTH",t[258]="BITSPERSAMPLE",t[259]="COMPRESSION",t[262]="PHOTOMETRICINTERPRETATION",t[263]="THRESHHOLDING",t[264]="CELLWIDTH",t[265]="CELLLENGTH",t[266]="FILLORDER",t[269]="DOCUMENTNAME",t[270]="IMAGEDESCRIPTION",t[271]="MAKE",t[272]="MODEL",t[273]="STRIPOFFSETS",t[274]="ORIENTATION",t[277]="SAMPLESPERPIXEL",t[278]="ROWSPERSTRIP",t[279]="STRIPBYTECOUNTS",t[280]="MINSAMPLEVALUE",t[281]="MAXSAMPLEVALUE",t[282]="XRESOLUTION",t[283]="YRESOLUTION",t[284]="PLANARCONFIGURATION",t[285]="PAGENAME",t[286]="XPOSITION",t[287]="YPOSITION",t[288]="FREEOFFSETS",t[289]="FREEBYTECOUNTS",t[290]="GRAYRESPONSEUNIT",t[291]="GRAYRESPONSECURVE",t[292]="T4OPTIONS",t[293]="T6OPTIONS",t[296]="RESOLUTIONUNIT",t[297]="PAGENUMBER",t[300]="COLORRESPONSEUNIT",t[301]="TRANSFERFUNCTION",t[305]="SOFTWARE",t[306]="DATETIME",t[315]="ARTIST",t[316]="HOSTCOMPUTER",t[317]="PREDICTOR",t[318]="WHITEPOINT",t[319]="PRIMARYCHROMATICITIES",t[320]="COLORMAP",t[321]="HALFTONEHINTS",t[322]="TILEWIDTH",t[323]="TILELENGTH",t[324]="TILEOFFSETS",t[325]="TILEBYTECOUNTS",t[326]="BADFAXLINES",t[327]="CLEANFAXDATA",t[328]="CONSECUTIVEBADFAXLINES",t[330]="SUBIFD",t[332]="INKSET",t[333]="INKNAMES",t[334]="NUMBEROFINKS",t[336]="DOTRANGE",t[337]="TARGETPRINTER",t[338]="EXTRASAMPLES",t[339]="SAMPLEFORMAT",t[340]="SMINSAMPLEVALUE",t[341]="SMAXSAMPLEVALUE",t[342]="TRANSFERRANGE",t[347]="JPEGTABLES",t[512]="JPEGPROC",t[513]="JPEGIFOFFSET",t[514]="JPEGIFBYTECOUNT",t[515]="JPEGRESTARTINTERVAL",t[517]="JPEGLOSSLESSPREDICTORS",t[518]="JPEGPOINTTRANSFORM",t[519]="JPEGQTABLES",t[520]="JPEGDCTABLES",t[521]="JPEGACTABLES",t[529]="YCBCRCOEFFICIENTS",t[530]="YCBCRSUBSAMPLING",t[531]="YCBCRPOSITIONING",t[532]="REFERENCEBLACKWHITE",t[700]="XMP",t[33550]="GEOPIXELSCALE",t[33922]="GEOTIEPOINTS",t[33432]="COPYRIGHT",t[42112]="GDAL_METADATA",t[42113]="GDAL_NODATA",t[50844]="RPCCOEFFICIENT",t[34264]="GEOTRANSMATRIX",t[34735]="GEOKEYDIRECTORY",t[34736]="GEODOUBLEPARAMS",t[34737]="GEOASCIIPARAMS",t[34665]="EXIFIFD",t[34853]="GPSIFD",t[40965]="INTEROPERABILITYIFD",t})(),Kr=(()=>{let t=Te.slice();return t[36864]="ExifVersion",t[40960]="FlashpixVersion",t[40961]="ColorSpace",t[42240]="Gamma",t[37121]="ComponentsConfiguration",t[37122]="CompressedBitsPerPixel",t[40962]="PixelXDimension",t[40963]="PixelYDimension",t[37500]="MakerNote",t[37510]="UserComment",t[40964]="RelatedSoundFile",t[36867]="DateTimeOriginal",t[36868]="DateTimeDigitized",t[36880]="OffsetTime",t[36881]="OffsetTimeOriginal",t[36882]="OffsetTimeDigitized",t[37520]="SubSecTime",t[37521]="SubSecTimeOriginal",t[37522]="SubSecTimeDigitized",t[37888]="Temperature",t[37889]="Humidity",t[37890]="Pressure",t[37891]="WaterDepth",t[37892]="Acceleration",t[37893]="CameraElevationAngle",t[42016]="ImageUniqueID",t[42032]="CameraOwnerName",t[42033]="BodySerialNumber",t[42034]="LensSpecification",t[42035]="LensMake",t[42036]="LensModel",t[42037]="LensSerialNumber",t[33434]="ExposureTime",t[33437]="FNumber",t[34850]="ExposureProgram",t[34852]="SpectralSensitivity",t[34855]="PhotographicSensitivity",t[34856]="OECF",t[34864]="SensitivityType",t[34865]="StandardOutputSensitivity",t[34866]="RecommendedExposureIndex",t[34867]="ISOSpeed",t[34868]="ISOSpeedLatitudeyyy",t[34869]="ISOSpeedLatitudezzz",t[37377]="ShutterSpeedValue",t[37378]="ApertureValue",t[37379]="BrightnessValue",t[37380]="ExposureBiasValue",t[37381]="MaxApertureValue",t[37382]="SubjectDistance",t[37383]="MeteringMode",t[37384]="LightSource",t[37385]="Flash",t[37386]="FocalLength",t[37396]="SubjectArea",t[41483]="FlashEnergy",t[41484]="SpatialFrequencyResponse",t[41486]="FocalPlaneXResolution",t[41487]="FocalPlaneYResolution",t[41488]="FocalPlaneResolutionUnit",t[41492]="SubjectLocation",t[41493]="ExposureIndex",t[41495]="SensingMethod",t[41728]="FileSource",t[41729]="SceneType",t[41730]="CFAPattern",t[41985]="CustomRendered",t[41986]="ExposureMode",t[41987]="WhiteBalance",t[41988]="DigitalZoomRatio",t[41989]="FocalLengthIn35mmFilm",t[41990]="SceneCaptureType",t[41991]="GainControl",t[41992]="Contrast",t[41993]="Saturation",t[41994]="Sharpness",t[41995]="DeviceSettingDescription",t[41996]="SubjectDistanceRange",t})(),qr=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],Yr=(()=>{let t=[];return t[1024]="GTModelTypeGeoKey",t[1025]="GTRasterTypeGeoKey",t[1026]="GTCitationGeoKey",t[2048]="GeographicTypeGeoKey",t[2049]="GeogCitationGeoKey",t[2050]="GeogGeodeticDatumGeoKey",t[2051]="GeogPrimeMeridianGeoKey",t[2052]="GeogLinearUnitsGeoKey",t[2053]="GeogLinearUnitSizeGeoKey",t[2054]="GeogAngularUnitsGeoKey",t[2055]="GeogAngularUnitSizeGeoKey",t[2056]="GeogEllipsoidGeoKey",t[2057]="GeogSemiMajorAxisGeoKey",t[2058]="GeogSemiMinorAxisGeoKey",t[2059]="GeogInvFlatteningGeoKey",t[2061]="GeogPrimeMeridianLongGeoKey",t[2060]="GeogAzimuthUnitsGeoKey",t[3072]="ProjectedCSTypeGeoKey",t[3073]="PCSCitationGeoKey",t[3074]="ProjectionGeoKey",t[3075]="ProjCoordTransGeoKey",t[3076]="ProjLinearUnitsGeoKey",t[3077]="ProjLinearUnitSizeGeoKey",t[3078]="ProjStdParallel1GeoKey",t[3079]="ProjStdParallel2GeoKey",t[3080]="ProjNatOriginLongGeoKey",t[3081]="ProjNatOriginLatGeoKey",t[3082]="ProjFalseEastingGeoKey",t[3083]="ProjFalseNorthingGeoKey",t[3084]="ProjFalseOriginLongGeoKey",t[3085]="ProjFalseOriginLatGeoKey",t[3086]="ProjFalseOriginEastingGeoKey",t[3087]="ProjFalseOriginNorthingGeoKey",t[3088]="ProjCenterLongGeoKey",t[3090]="ProjCenterEastingGeoKey",t[3091]="ProjCenterNorthingGeoKey",t[3092]="ProjScaleAtNatOriginGeoKey",t[3093]="ProjScaleAtCenterGeoKey",t[3094]="ProjAzimuthAngleGeoKey",t[3095]="ProjStraightVertPoleLongGeoKey",t[4096]="VerticalCSTypeGeoKey",t[4097]="VerticalCitationGeoKey",t[4098]="VerticalDatumGeoKey",t[4099]="VerticalUnitsGeoKey",t})(),Xr=(t,e)=>{let r=(e||Te)[t];return r===void 0&&(r="unknown"+String(t)),r},Se=new Map;Se.set("EXIFIFD",Kr),Se.set("GPSIFD",qr);var Pt={tiffTags:Te,ifdTags:Se,geoKeys:Yr,getTagName:Xr};var Wt=(()=>{let t=new ArrayBuffer(4),e=new Uint8Array(t);return new Uint32Array(t)[0]=1,e[0]===1})();var ur=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],Gt=4294967296,Zr=new Set([1,5,6,7,8,34712,34887]);function Pe(t,e){let r="unknown";return t===3?r=e===64?"f64":"f32":t===1?e===1?r="u1":e===2?r="u2":e===4?r="u4":e<=8?r="u8":e<=16?r="u16":e<=32&&(r="u32"):t===2&&(e<=8?r="s8":e<=16?r="s16":e<=32&&(r="s32")),r}function se(t){let e=null;switch(t?t.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":e=Uint8Array;break;case"u16":e=Uint16Array;break;case"u32":e=Uint32Array;break;case"s8":e=Int8Array;break;case"s16":e=Int16Array;break;case"s32":e=Int32Array;break;case"f64":e=Float64Array;break;default:e=Float32Array}return e}function $r(t,e){return{x:e[0]*t.x+e[1]*t.y+e[2],y:e[3]*t.x+e[4]*t.y+e[5]}}function fr(t,e){return t.get(e)?.values}function Rt(t,e){return t.get(e)?.values}function cr(t,e){return t.get(e)?.values?.[0]}function H(t,e){return t.get(e)?.values?.[0]}function ke(t,e,r,i=0,o=Pt.tiffTags,l=4){let h=l===8,a=h?Me(new DataView(t,r,8),0,e):new DataView(t,r,2).getUint16(0,e),s=4+2*l,u=h?8:2,n=u+a*s;if(r+n>t.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:n};let c=r+n+4<=t.byteLength?ae(new DataView(t,r+n,l===8?8:4),0,e,l===8):null,f=r+u,d=new Map,m,g,S,C,I,v=0,p=0;for(let y=0;y<a;y++){g=new DataView(t,f+s*y,s),S=g.getUint16(0,e),I=g.getUint16(2,e),C=Pt.getTagName(S,o);let T=[];l===2?(v=g.getUint16(4,e),p=g.getUint16(6,e)):l===4?(v=g.getUint32(4,e),p=g.getUint32(8,e)):l===8&&(v=ae(g,4,e,!0),p=ae(g,12,e,!0),T.push(g.getUint32(12,e)),T.push(g.getUint32(16,e))),m={id:S,type:I,valueCount:v,valueOffset:p,valueOffsets:T,values:null},io(t,e,m,i,!1,l),d.set(C,m)}return{success:!0,ifd:d,nextIFD:c,requiredBufferSize:n}}var Qr=(t,e)=>ie(t,{inputOffset:e}).pixels[0];function xe(t,e){if(e!==1&&e!==2&&e!==4)return t;let r=new Uint8Array(t),i=8/e,o=new Uint8Array(t.byteLength*i),l=0,h=2**e-1;for(let a=0;a<r.length;a++){let s=r[a];for(let u=0;u<i;u++)o[l++]=s<<e*u>>>8-e&h}return o.buffer}function Ie(t,e,r){let i=new te;i.parse(t),i.colorTransform=r===6?-1:0;let o=i.getData(i.width,i.height,e!==1&&e!==4);return new Uint8Array(o.buffer)}function Ae(t){let e=new vt(t).getBytes(),r=new ArrayBuffer(e.length),i=new Uint8Array(r);return i.set(e),i}function Ee(t,e,r,i,o){return pt(this,null,function*(){let l=Wt===e,h=H(r,"BITSPERSAMPLE"),a=H(r,"SAMPLESPERPIXEL")??1,s=H(r,"PHOTOMETRICINTERPRETATION"),u=H(r,"SAMPLEFORMAT")??1,n=Pe(u,h),c=H(r,"COMPRESSION")??1,f=se(n),d,m,g;if(c===34887)return yield oe(),Qr(t,i);if(c===1)d=t.slice(i,i+o),m=new Uint8Array(d);else if(c===8||c===32946)m=new Uint8Array(t,i,o),m=Ae(m),d=m.buffer;else if(c===6)m=new Uint8Array(t,i,o),m=Ie(m,a,s),d=m.buffer;else if(c===7){let v=r.get("JPEGTABLES").values,p=v.length-2;m=new Uint8Array(p+o-2);for(let T=0;T<p;T++)m[T]=v[T];let y=new Uint8Array(t,i+2,o-2);for(let T=0;T<y.length;T++)m[p+T]=y[T];m=Ie(m,a,s),d=m.buffer}else{if(c!==5)throw new Error("tiff-decode: unsupport compression "+c);m=Ht(t,i,o,e),d=m.buffer}if(d=xe(d,h),n==="u8"||n==="s8"||l)g=new f(d);else{d=new ArrayBuffer(m.length);let v=new Uint8Array(d);switch(n){case"u16":case"s16":for(let p=0;p<m.length;p+=2)v[p]=m[p+1],v[p+1]=m[p];break;case"u32":case"s32":case"f32":for(let p=0;p<m.length;p+=4)v[p]=m[p+3],v[p+1]=m[p+2],v[p+2]=m[p+1],v[p+3]=m[p]}g=new f(d)}let S=H(r,"PREDICTOR")??1,C=H(r,"TILEWIDTH"),I=H(r,"TILELENGTH");if(S>1&&(c===5||c===8||c===32946)&&C&&I){let v=le(r),p=new f(g.length);p.set(g),g=uo(p,I,C,u===3&&S===3,v?1:a)}return g})}function to(t,e,r){return pt(this,null,function*(){let i=Rt(r,"TILEOFFSETS");if(i===void 0)return null;let o=Rt(r,"TILEBYTECOUNTS"),{width:l,height:h,pixelType:a,tileWidth:s,tileHeight:u}=Re([r]),n=le(r,e),c=H(r,"SAMPLESPERPIXEL")||e.planes,f=l*h,d=H(r,"BITSPERSAMPLE"),m=(H(r,"COMPRESSION")??1)===34887,g=se(a),S=[];for(let V=0;V<c;V++)S.push(new g(f));let C,I,v,p,y,T,w,b,x,k,A,E,P,R=Math.ceil(l/s),G=new Uint8Array(f).fill(255),O=!1;if(d%8==0)if(m&&n&&c>1){let V=Math.round(i.length/c);for(C=0;C<V;C++){T=Math.floor(C/R)*u,w=C%R*s,b=T*l+w;for(let N=0;N<c;N++){let J=C*c+N;for(o[J]===0?(v=null,O=!0):v=yield Ee(t,e.littleEndian,r,i[J],o[J]),k=0,x=b,E=Math.min(s,l-w),A=Math.min(u,h-T),P=S[N],p=0;p<A;p++)for(x=b+p*l,k=p*s,y=0;y<E;y++,x++,k++)v?P[x]=v[k]:G[x]=0}}}else for(C=0;C<i.length;C++)for(T=Math.floor(C/R)*u,w=C%R*s,b=T*l+w,o[C]===0?(v=null,O=!0):v=yield Ee(t,e.littleEndian,r,i[C],o[C]),k=0,x=b,E=Math.min(s,l-w),A=Math.min(u,h-T),I=0;I<c;I++)if(P=S[I],n||m)for(p=0;p<A;p++)for(x=b+p*l,k=s*u*I+p*s,y=0;y<E;y++,x++,k++)v?P[x]=v[k]:G[x]=0;else for(p=0;p<A;p++)for(x=b+p*l,k=p*s*c+I,y=0;y<E;y++,x++,k+=c)v?P[x]=v[k]:G[x]=0;return{width:l,height:h,pixelType:a,pixels:S,mask:O?G:void 0}})}var eo=(t,e,r)=>{let i=Wt===e.littleEndian,o=Rt(r,"STRIPOFFSETS");if(o===void 0)return null;let{width:l,height:h,pixelType:a}=Re([r]),s=H(r,"SAMPLESPERPIXEL")||e.planes,u=H(r,"PHOTOMETRICINTERPRETATION"),n=l*h,c=H(r,"BITSPERSAMPLE"),f=se(a),d=new f(n*s),m=Rt(r,"STRIPBYTECOUNTS"),g=H(r,"ROWSPERSTRIP"),S=H(r,"COMPRESSION")??1,C,I,v,p,y,T,w,b,x;if(c%8==0)for(C=0;C<o.length;C++){if(y=C*(g*l)*s,a==="u8"||a==="s8"||i)S===8||S===32946?(w=new Uint8Array(t,o[C],m[C]),w=Ae(w),T=w.buffer):S===6?(w=new Uint8Array(t,o[C],m[C]),w=Ie(w,s,u),T=w.buffer):S===5?(w=Ht(t,o[C],m[C],e.littleEndian),T=w.buffer):T=t.slice(o[C],o[C]+m[C]),T=xe(T,c),p=new f(T);else{switch(S===6||S===8||S===32946?(w=new Uint8Array(t,o[C],m[C]),b=Ae(w),T=b.buffer):(T=new ArrayBuffer(m[C]),w=new Uint8Array(t,o[C],m[C]),b=new Uint8Array(T)),a){case"u16":case"s16":for(v=0;v<w.length;v+=2)b[v]=w[v+1],b[v+1]=w[v];break;case"u32":case"s32":case"f32":for(v=0;v<w.length;v+=4)b[v]=w[v+3],b[v+1]=w[v+2],b[v+2]=w[v+1],b[v+3]=w[v]}T=xe(T,c),p=new f(T)}d.set(p,y)}let k=[];if(s===1)k.push(d);else for(C=0;C<s;C++){for(x=new f(n),I=0;I<n;I++)x[I]=d[I*s+C];k.push(x)}return{width:l,height:h,pixelType:a,pixels:k}},ro=(t,e,r)=>{if(!(t&&t.length>0&&e&&r))return null;let i,o,l,h=t[0].length,a=t.length,s=new Uint8Array(h);for(let u=0;u<a;u++)if(i=t[u],o=e[u],l=r[u],u===0)for(let n=0;n<h;n++)s[n]=i[n]<o||i[n]>l?0:1;else for(let n=0;n<h;n++)s[n]&&(s[n]=i[n]<o||i[n]>l?0:1);return s},oo=t=>{if(!t)return null;let e=t.match(/<Item(.*?)Item>/gi);if(!e||e.length===0)return null;let r=new Map,i,o,l,h,a;for(let C=0;C<e.length;C++)i=e[C],o=i.slice(6,i.indexOf(">")),h=i.indexOf("sample="),h>-1&&(a=i.slice(h+8,i.indexOf('"',h+8))),h=i.indexOf("name="),h>-1&&(o=i.slice(h+6,i.indexOf('"',h+6))),o&&(l=i.slice(i.indexOf(">")+1,i.indexOf("</Item>")).trim(),a!=null?r.has(o)?r.get(o)[a]=l:r.set(o,[l]):r.set(o,l)),a=null;let s=r.get("STATISTICS_MINIMUM"),u=r.get("STATISTICS_MAXIMUM"),n=r.get("STATISTICS_MEAN"),c=r.get("STATISTICS_STDDEV"),f=null;if(s&&u){f=[];for(let C=0;C<s.length;C++)f.push({min:parseFloat(s[C]),max:parseFloat(u[C]),avg:n&&parseFloat(n[C]),stddev:c&&parseFloat(c[C])})}let d=r.get("BandName"),m=r.get("WavelengthMin"),g=r.get("WavelengthMax"),S=null;if(d){S=[];for(let C=0;C<d.length;C++)S.push({BandName:d[C],WavelengthMin:m&&parseFloat(m[C]),WavelengthMax:g&&parseFloat(g[C])})}return{statistics:f,bandProperties:S,dataType:r.get("DataType"),rawMetadata:r}};function io(t,e,r,i=0,o=!1,l=4){if(r.values)return!0;let h=r.type,a=r.valueCount,s=r.valueOffset,u=[],n=ur[h],c=8*n,f=a*n,d=a*ur[h]*8,m,g,S=l===8?64:32,C=r.valueOffsets;if(d>S&&f>(o?t.byteLength:t?t.byteLength-s+i:0))return r.offlineOffsetSize=[s,f],r.values=null,!1;if(d<=S){if(!e)if(S<=32)s>>>=32-d;else{let I=C?.length?C[0]:s>>>0,v=C?.length?C[1]:Math.round((s-I)/Gt);d<=32?(s=I>>>32-d,C[0]=s):(s=I*2**(32-d)+(v>>>32-d),C[0]=I,C[1]=v>>>32-d)}if(a===1&&c===S)u=[s];else if(S===64){let I=C?.length?C[0]:s>>>0,v=C?.length?C[1]:Math.round((s-I)/Gt),p=I,y=32;for(g=1;g<=a;g++){let T=32-c*g%32;if(y<c){let w=p<<T>>>32-y,b=v<<32-y>>>32-y;p=v,u.push(w+b*2**(c-y)),y-=32-(c-y)}else u.push(p<<T>>>32-c),y-=c;y===0&&(y=32,p=v)}}else for(g=1;g<=a;g++){let I=32-c*g;u.push(s<<I>>>32-c)}}else{s-=i,o&&(s=0);for(let I=s;I<s+f;I+=n){switch(h){case 1:case 2:case 7:m=new DataView(t,I,1).getUint8(0);break;case 3:m=new DataView(t,I,2).getUint16(0,e);break;case 4:case 13:m=new DataView(t,I,4).getUint32(0,e);break;case 5:m=new DataView(t,I,4).getUint32(0,e)/new DataView(t,I+4,4).getUint32(0,e);break;case 6:m=new DataView(t,I,1).getInt8(0);break;case 8:m=new DataView(t,I,2).getInt16(0,e);break;case 9:m=new DataView(t,I,4).getInt32(0,e);break;case 10:m=new DataView(t,I,4).getInt32(0,e)/new DataView(t,I+4,4).getInt32(0,e);break;case 11:m=new DataView(t,I,4).getFloat32(0,e);break;case 12:m=new DataView(t,I,8).getFloat64(0,e);break;case 16:case 18:m=Me(new DataView(t,I,8),0,e);break;case 17:m=ao(new DataView(t,I,8),0,e);break;default:m=null}u.push(m)}}if(h===2){let I="",v=u;for(u=[],g=0;g<v.length;g++)v[g]===0&&I!==""?(u.push(I),I=""):I+=String.fromCharCode(v[g]);I===""&&u.length!==0||u.push(I)}return r.values=u,!0}function Re(t){let e=t[0],r=H(e,"TILEWIDTH"),i=H(e,"TILELENGTH"),o=H(e,"IMAGEWIDTH"),l=H(e,"IMAGELENGTH"),h=H(e,"BITSPERSAMPLE"),a=H(e,"SAMPLESPERPIXEL"),s=H(e,"SAMPLEFORMAT")??1,u=Pe(s,h),n=le(e),c=fr(e,"GDAL_NODATA"),f=null;c?.length&&(f=c.map(_=>parseFloat(_)),f.some(_=>isNaN(_))&&(f=null));let d=H(e,"COMPRESSION")??1,m;switch(d){case 1:m="NONE";break;case 2:case 3:case 4:case 32771:m="CCITT";break;case 5:m="LZW";break;case 6:case 7:m="JPEG";break;case 32773:m="PACKBITS";break;case 8:case 32946:m="DEFLATE";break;case 34712:m="JPEG2000";break;case 34887:m="LERC";break;default:m=String(d)}let g=!0,S="";Zr.has(d)||(g=!1,S+="unsupported tag compression "+d),s>3&&(g=!1,S+="unsupported tag sampleFormat "+s),h!==1&&h!==2&&h!==4&&h%8!=0&&(g=!1,S+="unsupported tag bitsPerSample "+h);let C=cr(e,"GEOASCIIPARAMS"),I;if(C){let _=C.split("|").find(z=>z.includes("ESRI PE String = ")),B=_?_.replace("ESRI PE String = ",""):"";I=B.startsWith("COMPD_CS")||B.startsWith("PROJCS")||B.startsWith("GEOGCS")?{wkid:null,wkt:B}:null}let v=Rt(e,"GEOTIEPOINTS"),p=Rt(e,"GEOPIXELSCALE"),y=Rt(e,"GEOTRANSMATRIX"),T=e.has("GEOKEYDIRECTORY")?e.get("GEOKEYDIRECTORY").data:null,w,b,x=!1,k=!1;if(T){x=H(T,"GTRasterTypeGeoKey")===2;let _=H(T,"GTModelTypeGeoKey");if(_===2){let B=H(T,"GeographicTypeGeoKey");B>=1024&&B<=32766&&(I={wkid:B}),I||B!==32767||(k=!0,I={wkid:4326})}else if(_===1){let B=H(T,"ProjectedCSTypeGeoKey");B>=1024&&B<=32766&&(I={wkid:B})}}if(p&&v&&v.length>=6?(w=[p[0],0,v[3]-v[0]*p[0],0,-Math.abs(p[1]),v[4]-v[1]*p[1]],x&&(w[2]-=.5*w[0]+.5*w[1],w[5]-=.5*w[3]+.5*w[4])):y&&y.length===16&&(w=x?[y[0],y[1],y[3]-.5*y[0],y[4],y[5],y[7]-.5*y[5]]:[y[0],y[1],y[3],y[4],y[5],y[7]]),w){let _=[{x:0,y:l},{x:0,y:0},{x:o,y:l},{x:o,y:0}],B,z=Number.POSITIVE_INFINITY,Y=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,F=Number.NEGATIVE_INFINITY;for(let W=0;W<_.length;W++)B=$r(_[W],w),z=B.x>z?z:B.x,j=B.x<j?j:B.x,Y=B.y>Y?Y:B.y,F=B.y<F?F:B.y;b={xmin:z,xmax:j,ymin:Y,ymax:F,spatialReference:I}}else b={xmin:-.5,ymin:.5-l,xmax:o-.5,ymax:.5,spatialReference:I};k&&(b.xmax-b.xmin>400||Math.max(Math.abs(b.xmin),Math.abs(b.xmax))>361)&&(I=null,b.spatialReference=null);let A=hr(t),E,P,R,G,O;if(A.length>0){R=Math.round(Math.log(o/H(A[0],"IMAGEWIDTH"))/Math.LN2);let _=A[A.length-1];G=A.length,E=H(_,"TILEWIDTH"),P=H(_,"TILELENGTH")}E=G!=null&&G>0?E||r:null,P=G!=null&&G>0?P||i:null,r&&(O=[{maxCol:Math.ceil(o/r)-1,maxRow:Math.ceil(l/i)-1,minRow:0,minCol:0}],A.forEach(_=>{O.push({maxCol:Math.ceil(H(_,"IMAGEWIDTH")/H(_,"TILEWIDTH"))-1,maxRow:Math.ceil(H(_,"IMAGELENGTH")/H(_,"TILELENGTH"))-1,minRow:0,minCol:0})}));let V=cr(t[0],"GDAL_METADATA"),N=oo(V);S+=" "+dr({width:o,height:l,tileWidth:r,tileHeight:i,planes:a,ifds:t});let J=pr(t).length===A.length+1,L=A?.length?A.map(_=>({x:o/H(_,"IMAGEWIDTH"),y:l/H(_,"IMAGELENGTH")})):void 0;return{width:o,height:l,tileWidth:r,tileHeight:i,planes:a,isBSQ:n,pixelType:u,compression:m,noData:f,hasMaskBand:J,isSupported:g,pyramidResolutions:L,message:S,extent:b,isPseudoGeographic:k,affine:p?null:w,firstPyramidLevel:R,maximumPyramidLevel:G,pyramidBlockWidth:E,pyramidBlockHeight:P,tileBoundary:O,metadata:N}}function le(t,e){let r=fr(t,"PLANARCONFIGURATION");return r?r[0]===2:!!e&&e.isBSQ}function hr(t){return t.filter(e=>H(e,"NEWSUBFILETYPE")===1)}function pr(t){return t.filter(e=>{let r=!(4&~(H(e,"NEWSUBFILETYPE")??0)),i=H(e,"PHOTOMETRICINTERPRETATION")===4;return r&&i})}function no(t){let{littleEndian:e,isBigTiff:r,firstIFDPos:i}=so(t),o=i,l=[];do{let h=lo(t,e,o,0,Pt.tiffTags,r?8:4);if(!h.success)break;l.push(h.ifd),o=h.nextIFD}while(o>0);return et($({},Re(l)),{littleEndian:e,isBigTiff:r,ifds:l,pyramidIFDs:hr(l),maskIFDs:pr(l)})}function Me(t,e,r){let i=t.getUint32(e,r),o=t.getUint32(e+4,r);return r?o*Gt+i:i*Gt+o}function ao(t,e,r){let i=r?t.getInt32(e,r):t.getUint32(e,r),o=r?t.getUint32(e+4,r):t.getInt32(e+4,r),l=(r?i:o)>=0?1:-1;return r?i*=l:o*=l,l*(r?o*Gt+i:i*Gt+o)}function ae(t,e,r,i){return i?Me(t,e,r):t.getUint32(e,r)}function so(t){let e=new DataView(t,0,16),r=e.getUint16(0,!1),i=null;if(r===18761)i=!0;else{if(r!==19789)throw new Error("unexpected endianess byte");i=!1}let o=e.getUint16(2,i);if(o!==42&&o!==43)throw new Error("unexpected tiff identifier");let l=4,h=o===43;if(h){let a=e.getUint16(l,i);if(l+=2,a!==8)throw new Error("unsupported bigtiff version");if(e.getUint16(l,i)!==0)throw new Error("unsupported bigtiff version");l+=2}return{littleEndian:i,isBigTiff:h,firstIFDPos:ae(e,l,i,h)}}function lo(t,e,r,i=0,o=Pt.tiffTags,l=4){let h=ke(t,e,r,i,o,l),a,s=h.ifd;if(s){if(Pt.ifdTags.forEach((u,n)=>{s.has(n)&&(a=s.get(n),a.data=ke(t,e,a.valueOffset-i,i,u).ifd)}),s.has("GEOKEYDIRECTORY")){a=s.get("GEOKEYDIRECTORY");let u=a.values;if(u&&u.length>4){let n=u[0]+"."+u[1]+"."+u[2];a.data=ke(t,e,a.valueOffset+6-i,i,Pt.geoKeys,2).ifd,a.data&&a.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[n]})}}if(s.has("XMP")){a=s.get("XMP");let u=a.values;typeof u[0]=="number"&&a.type===7&&(a.values=[lr(new Uint8Array(u))])}}return h}function dr(t){let{width:e,height:r,tileHeight:i,tileWidth:o}=t,l=t.planes,h=o?o*i:e*r,a=H(t.ifds[0],"BITSPERSAMPLE"),s="";return h*l>2**30/(a>8?a/8:1)&&(s=o?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),s}function uo(t,e,r,i,o){let l=i?4:1,h=r*l*o;i&&(t=new Uint8Array(t.buffer));for(let u=0;u<e;u++){let n=u*h;for(let c=o;c<h;c++)t[n+c]+=t[n+c-o]}if(!i)return t;let a=new Uint8Array(t.length),s=r*o;for(let u=0;u<e;u++){let n=u*h;for(let c=0;c<s;c++)for(let f=0;f<l;f++)a[n+c*l+f]=t[n+c+(l-f-1)*s]}return new Float32Array(a.buffer)}function mr(t,e){return pt(this,null,function*(){let{headerInfo:r,ifd:i,offsets:o,sizes:l}=e,h=[];for(let x=0;x<o.length;x++){l[x];let k=yield Ee(t,r.littleEndian,i,o[x],l[x]||t.byteLength);h.push(k)}let a=le(i,r),s=H(i,"BITSPERSAMPLE"),u=Pe(H(i,"SAMPLEFORMAT")??1,s),n=H(i,"SAMPLESPERPIXEL")||r.planes,c=se(u),f=H(i,"TILEWIDTH"),d=H(i,"TILELENGTH"),m=H(i,"COMPRESSION")??1,g=f*d,S,C=[],I=h[0],v=m===34887;for(let x=0;x<n;x++){if(S=new c(g),h.length===n)I=h[x],I.length===g&&(S=I);else if(I.length)if(a||v)S=I.length===g?I:I.slice(g*x,g*(x+1));else for(let k=0;k<g;k++)S[k]=I[k*n+x];C.push(S)}let p=r.noData?r.noData[0]:e.noDataValue,y=r.metadata?r.metadata.statistics:null,T=y?y.map(x=>x.min):null,w=y?y.map(x=>x.max):null,b={pixelType:u,width:f,height:d,pixels:C,noDataValue:p};return p!=null?jt(b,p):T&&w&&e.applyMinMaxConstraint&&(b.mask=ro(C,T,w)),b})}function gr(r){return pt(this,arguments,function*(t,e={}){let i=e.pyramidLevel||0,o=e.headerInfo||no(t),{ifds:l,noData:h}=o;if(l.length===0)throw new Error("no valid image file directory");let a=dr(o);if(a)throw a;let s=null,u=i===-1?l[l.length-1]:l[i],n=h??e.noDataValue;return s=o.tileWidth?yield to(t,o,u):eo(t,o,u),s&&(n!=null&&jt(s,n),s)})}var co=function(t){var e,r,i,o,l,h;function a(s){var u,n,c,f,d,m,g,S,C,I,v,p,y;for(this.data=s,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},d=null;;){switch(u=this.readUInt32(),S=function(){var T,w;for(w=[],T=0;T<4;++T)w.push(String.fromCharCode(this.data[this.pos++]));return w}.call(this).join(""),S){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(u);break;case"fcTL":d&&this.animation.frames.push(d),this.pos+=4,d={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},f=this.readUInt16(),c=this.readUInt16()||100,d.delay=1e3*f/c,d.disposeOp=this.data[this.pos++],d.blendOp=this.data[this.pos++],d.data=[];break;case"IDAT":case"fdAT":for(S==="fdAT"&&(this.pos+=4,u-=4),s=d?.data||this.imgData,v=0;0<=u?v<u:v>u;0<=u?++v:--v)s.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(u),(C=255-this.transparency.indexed.length)>0)for(p=0;0<=C?p<C:p>C;0<=C?++p:--p)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(u)[0];break;case 2:this.transparency.rgb=this.read(u)}break;case"tEXt":m=(I=this.read(u)).indexOf(0),g=String.fromCharCode.apply(String,I.slice(0,m)),this.text[g]=String.fromCharCode.apply(String,I.slice(m+1));break;case"IEND":return d&&this.animation.frames.push(d),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(y=this.colorType)===4||y===6,n=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*n,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=u}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return a.load=function(s,u,n){var c;return typeof u=="function"&&(n=u),(c=new XMLHttpRequest).open("GET",s,!0),c.responseType="arraybuffer",c.onload=function(){var f;return f=new a(new Uint8Array(c.response||c.mozResponseArrayBuffer)),typeof u?.getContext=="function"&&f.render(u),typeof n=="function"?n(f):void 0},c.send(null)},r=1,i=2,e=0,a.prototype.read=function(s){var u,n;for(n=[],u=0;0<=s?u<s:u>s;0<=s?++u:--u)n.push(this.data[this.pos++]);return n},a.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},a.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},a.prototype.decodePixels=function(s){var u,n,c,f,d,m,g,S,C,I,v,p,y,T,w,b,x,k,A,E,P,R,G;if(s==null&&(s=this.imgData),s.length===0)return new Uint8Array(0);for(s=(s=new vt(s)).getBytes(),b=(p=this.pixelBitlength/8)*this.width,y=new Uint8Array(b*this.height),m=s.length,w=0,T=0,n=0;T<m;){switch(s[T++]){case 0:for(f=A=0;A<b;f=A+=1)y[n++]=s[T++];break;case 1:for(f=E=0;E<b;f=E+=1)u=s[T++],d=f<p?0:y[n-p],y[n++]=(u+d)%256;break;case 2:for(f=P=0;P<b;f=P+=1)u=s[T++],c=(f-f%p)/p,x=w&&y[(w-1)*b+c*p+f%p],y[n++]=(x+u)%256;break;case 3:for(f=R=0;R<b;f=R+=1)u=s[T++],c=(f-f%p)/p,d=f<p?0:y[n-p],x=w&&y[(w-1)*b+c*p+f%p],y[n++]=(u+Math.floor((d+x)/2))%256;break;case 4:for(f=G=0;G<b;f=G+=1)u=s[T++],c=(f-f%p)/p,d=f<p?0:y[n-p],w===0?x=k=0:(x=y[(w-1)*b+c*p+f%p],k=c&&y[(w-1)*b+(c-1)*p+f%p]),g=d+x-k,S=Math.abs(g-d),I=Math.abs(g-x),v=Math.abs(g-k),C=S<=I&&S<=v?d:I<=v?x:k,y[n++]=(u+C)%256;break;default:throw new Error("Invalid filter algorithm: "+s[T-1])}w++}return y},a.prototype.decodePalette=function(){var s,u,n,c,f,d,m,g,S;for(n=this.palette,d=this.transparency.indexed||[],f=new Uint8Array((d.length||0)+n.length),c=0,n.length,s=0,u=m=0,g=n.length;m<g;u=m+=3)f[c++]=n[u],f[c++]=n[u+1],f[c++]=n[u+2],f[c++]=(S=d[s++])!=null?S:255;return f},a.prototype.copyToImageData=function(s,u){var n,c,f,d,m,g,S,C,I,v,p;if(c=this.colors,I=null,n=this.hasAlphaChannel,this.palette.length&&(I=(p=this._decodedPalette)!=null?p:this._decodedPalette=this.decodePalette(),c=4,n=!0),C=(f=s.data||s).length,m=I||u,d=g=0,c===1)for(;d<C;)S=I?4*u[d/4]:g,v=m[S++],f[d++]=v,f[d++]=v,f[d++]=v,f[d++]=n?m[S++]:this.transparency.grayscale&&this.transparency.grayscale===v?0:255,g=S;else for(;d<C;)S=I?4*u[d/4]:g,f[d++]=m[S++],f[d++]=m[S++],f[d++]=m[S++],f[d++]=n?m[S++]:this.transparency.rgb&&this.transparency.rgb[1]===m[S-3]&&this.transparency.rgb[3]===m[S-2]&&this.transparency.rgb[5]===m[S-1]?0:255,g=S},a.prototype.decode=function(){var s;return s=new Uint8Array(this.width*this.height*4),this.copyToImageData(s,this.decodePixels()),s},l=t.document&&t.document.createElement("canvas"),h=l&&l.getContext("2d"),o=function(s){var u;return h.width=s.width,h.height=s.height,h.clearRect(0,0,s.width,s.height),h.putImageData(s,0,0),(u=new Image).src=l.toDataURL(),u},a.prototype.decodeFrames=function(s){var u,n,c,f,d,m,g,S;if(this.animation){for(S=[],n=d=0,m=(g=this.animation.frames).length;d<m;n=++d)u=g[n],c=s.createImageData(u.width,u.height),f=this.decodePixels(new Uint8Array(u.data)),this.copyToImageData(c,f),u.imageData=c,S.push(u.image=o(c));return S}},a.prototype.renderFrame=function(s,u){var n,c,f;return n=(c=this.animation.frames)[u],f=c[u-1],u===0&&s.clearRect(0,0,this.width,this.height),f?.disposeOp===r?s.clearRect(f.xOffset,f.yOffset,f.width,f.height):f?.disposeOp===i&&s.putImageData(f.imageData,f.xOffset,f.yOffset),n.blendOp===e&&s.clearRect(n.xOffset,n.yOffset,n.width,n.height),s.drawImage(n.image,n.xOffset,n.yOffset)},a.prototype.animate=function(s){var u,n,c,f,d,m,g=this;return n=0,m=this.animation,f=m.numFrames,c=m.frames,d=m.numPlays,(u=function(){var S,C;if(S=n++%f,C=c[S],g.renderFrame(s,S),f>1&&n/f<d)return g.animation._timeout=setTimeout(u,C.delay)})()},a.prototype.stopAnimation=function(){var s;return clearTimeout((s=this.animation)!=null?s._timeout:void 0)},a.prototype.render=function(s){var u,n;return s._png&&s._png.stopAnimation(),s._png=this,s.width=this.width,s.height=this.height,u=s.getContext("2d"),this.animation?(this.decodeFrames(u),this.animate(u)):(n=u.createImageData(this.width,this.height),this.copyToImageData(n,this.decodePixels()),u.putImageData(n,0,0))},a}(self),fo=new Set(["jpg","png","bmp","gif"]);function ho(t,e){return pt(this,null,function*(){if(!Wt)throw new mt("rasterCoded:decode","lerc decoder is not supported on big endian platform");yield oe();let{offset:r}=e,{width:i,height:o,pixelType:l,statistics:h,depthCount:a,noDataValues:s,bandMasks:u,pixels:n,mask:c}=ie(t,{inputOffset:r,returnInterleaved:e.returnInterleaved}),f=new Q({width:i,height:o,pixelType:l.toLowerCase(),pixels:n,mask:c,statistics:h.map(({minValue:d,maxValue:m})=>new zt(d,m)),bandMasks:u,depthCount:a,noDataValues:s});return h?.length||f.updateStatistics(),f})}function po(t,e){return pt(this,null,function*(){let r=yield gr(t,et($({},e),{noDataValue:null}));Ot(r);let i=new Q({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,bandMasks:r.bandMasks,statistics:null});return i.updateStatistics(),i})}function mo(t,e){return pt(this,null,function*(){let r=yield mr(t,e.customOptions),i=new Q({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return i.updateStatistics(),i})}function yr(t,e){let r=e.pixelType||"u8",i=Q.getPixelArrayConstructor(r),o=r==="u8"?t:new i(t.buffer),l=[],h=e.planes||1;if(h===1)l.push(o);else for(let s=0;s<h;s++){let u=(e.width||1)*(e.height||t.length),n=new i(u);for(let c=0;c<u;c++)n[c]=o[c*h+s];l.push(n)}let a=new Q({width:e.width||1,height:e.height||t.length,pixels:l,pixelType:r,statistics:null});return a.updateStatistics(),a}function go(t,e){return yr(new vt(new Uint8Array(t)).getBytes(),e)}function yo(t,e){return yr(Ht(t,e.offset,e.eof,!e.isInputBigEndian),e)}function Co(t,e,r){let{pixelTypeCtor:i}=To(e.pixelType),o=(0,ne.decode)(t,{width:e.width,height:e.height,pixelType:i,format:r}),l=new Q({width:e.width,height:e.height,pixels:o.pixels,pixelType:e.pixelType,mask:o.mask,statistics:null});return l.updateStatistics(),l}function bo(t,e){let r=ee.decode(t,e.hasNoZlibMask??void 0),i=new Q({width:r.width,height:r.height,pixels:r.pixels,pixelType:"u8",mask:r.mask,statistics:null});return i.updateStatistics(),i}function wo(t,e){let r=new Uint8Array(t),i=new co(r),{width:o,height:l}=e,h=o*l,a=i.decode(),s,u=0,n=0,c=new Uint8Array(h);for(u=0;u<h;u++)c[u]=a[4*u+3];let f=new Q({width:o,height:l,pixels:[],pixelType:"u8",mask:c,statistics:[]});for(u=0;u<3;u++){for(s=new Uint8Array(h),n=0;n<h;n++)s[n]=a[4*n+u];f.addData({pixels:s})}return f.updateStatistics(),f}function vo(t,e,r,i){return pt(this,null,function*(){let o=new Qt,l=$({applyJpegMask:!1,format:e},r),h=yield o.decode(t,l,i),a=new Q(h);return a.updateStatistics(),a})}function Cr(t){if(t==null)throw new mt("rasterCodec:decode","parameter encodeddata is required.");let e=new Uint8Array(t,0,10),r="";return e[0]===255&&e[1]===216?r="jpg":e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71?r="png":e[0]===67&&e[1]===110&&e[2]===116&&e[3]===90&&e[4]===73&&e[5]===109&&e[6]===97&&e[7]===103&&e[8]===101&&e[9]===32?r="lerc":e[0]===76&&e[1]===101&&e[2]===114&&e[3]===99&&e[4]===50&&e[5]===32?r="lerc2":e[0]===73&&e[1]===73&&e[2]===42&&e[3]===0||e[0]===77&&e[1]===77&&e[2]===0&&e[3]===42||e[0]===73&&e[1]===73&&e[2]===43&&e[3]===0||e[0]===77&&e[1]===77&&e[2]===0&&e[3]===43?r="tiff":e[0]===71&&e[1]===73&&e[2]===70?r="gif":e[0]===66&&e[1]===77?r="bmp":String.fromCharCode.apply(null,e).toLowerCase().includes("error")&&(r="error"),r}function So(t){let e=null;switch(t){case"lerc":case"lerc2":e=ho;break;case"jpg":e=bo;break;case"png":e=wo;break;case"bsq":case"bip":e=(r,i)=>Co(r,i,t);break;case"tiff":e=po;break;case"deflate":e=go;break;case"lzw":e=yo;break;case"error":e=()=>{throw new mt("rasterCodec:decode","input data contains error")};break;default:e=()=>{throw new mt("rasterCodec:decode","unsupported raster format")}}return e}function To(t){let e=null,r=null;switch(t?t.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":r=255,e=Uint8Array;break;case"u16":r=r||65535,e=Uint16Array;break;case"u32":r=r||2**32-1,e=Uint32Array;break;case"s8":r=r||-128,e=Int8Array;break;case"s16":r=r||-32768,e=Int16Array;break;case"s32":r=r||0-2**31,e=Int32Array;break;default:e=Float32Array}return{pixelTypeCtor:e,noDataValue:r}}function ko(t,e=1){if(!t)return;let{pixels:r,width:i,height:o,mask:l}=t;if(!r||r.length===0)return;let h=r.length,a=i-1,s=o-1,u=[],n,c,f,d,m,g,S=null,C=Q.getPixelArrayConstructor(t.pixelType);if(e===0){for(n=0;n<h;n++){for(m=r[n],g=new C(a*s),c=0;c<s;c++)for(d=c*i,f=0;f<a;f++)g[c*a+f]=m[d+f];u.push(g)}if(l!=null)for(S=new Uint8Array(a*s),c=0;c<s;c++)for(d=c*i,f=0;f<a;f++)S[c*a+f]=l[d+f]}else{for(n=0;n<h;n++){for(m=r[n],g=new C(a*s),c=0;c<s;c++)for(d=c*i,f=0;f<a;f++)g[c*a+f]=(m[d+f]+m[d+f+1]+m[d+i+f]+m[d+i+f+1])/4;u.push(g)}if(l)for(S=new Uint8Array(a*s),c=0;c<s;c++)for(d=c*i,f=0;f<a;f++)S[c*a+f]=Math.min.apply(null,[l[d+f],l[d+f+1],l[d+i+f],l[d+i+f+1]])}t.width=a,t.height=s,t.mask=S,t.pixels=u}function Li(t){let e=Cr(t);return e==="lerc2"?e="lerc":e==="error"&&(e=""),e}function Oi(i){return pt(this,arguments,function*(t,e={},r){if(t==null)throw new mt("rasterCodec:decode","missing encodeddata parameter.");let o=e.format?.toLowerCase();if(!(o!=="bsq"&&o!=="bip"||e.width!=null&&e.height!=null))throw new mt("rasterCodec:decode","requires width and height in options parameter.");if(o==="tiff"&&e.customOptions)return mo(t,e);if((!o||o!=="bsq"&&o!=="bip"&&o!=="deflate"&&o!=="lzw")&&(o=Cr(t)),e.useCanvas&&fo.has(o))return vo(t,o,e,r);let l=So(o),h;e.isPoint&&((e=$({},e)).width!=null&&e.width++,e.height!=null&&e.height++);let{offsets:a}=e;if(a&&a.length>1){let s=a.map((c,f)=>l(t.slice(c,a[f+1]),e)),u=yield Promise.all(s);h=u[0],h.pixels=u.map(c=>c.pixels[0]);let n=u.map(c=>c.mask);u.some(c=>c!=null)&&(n.forEach((c,f)=>{c==null&&(n[f]=new Uint8Array(h.width*h.height).fill(255))}),h.bandMasks=n,h.mask=Q.combineBandMasks(n)),h.updateStatistics()}else h=yield l(t,et($({},e),{offset:a?.[0]??e.offset}));return o!=="jpg"&&e.noDataValue!=null&&h.depthCount===1&&jt(h,e.noDataValue,{customFloatTolerance:e.tolerance}),e.isPoint&&ko(h),h})}var Ni=new Xt({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"}),br={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"};var Le=1,xo=[.299,.587,.114];function Oe(t,e=256){e=Math.min(e,256);let{size:r,counts:i}=t,o=new Uint8Array(r),l=i.reduce((n,c)=>n+c/e,0),h=0,a=0,s=0,u=l;for(let n=0;n<r;n++)if(s+=i[n],!(n<r-1&&s+i[n+1]<u)){for(;h<e-1&&u<s;)h++,u+=l;for(let c=a;c<=n;c++)o[c]=h;a=n+1}for(let n=a;n<r;n++)o[n]=e-1;return o}function De(t){let{minCutOff:e,maxCutOff:r,gamma:i,pixelType:o,rounding:l}=t,h=t.outMin||0,a=t.outMax||255;if(!["u8","u16","s8","s16"].includes(o))return null;let s=e.length,u,n,c=0;o==="s8"?c=-127:o==="s16"&&(c=-32767);let f=256;["u16","s16"].includes(o)&&(f=65536);let d=[],m=[],g=a-h;for(u=0;u<s;u++)m[u]=r[u]-e[u],d[u]=m[u]===0?0:g/m[u];let S,C=[],I,v,p;if(i&&i.length>=s){let y=vr(s,i);for(u=0;u<s;u++){for(p=[],n=0;n<f;n++)if(m[u]!==0)if(I=n+c,S=(I-e[u])/m[u],v=1,i[u]>1&&(v-=(1/g)**(S*y[u])),I<r[u]&&I>e[u]){let T=v*g*S**(1/i[u])+h;p[n]=l==="floor"?Math.floor(T):l==="round"?Math.round(T):T}else I>=r[u]?p[n]=a:p[n]=h;else p[n]=h;C[u]=p}}else for(u=0;u<s;u++){for(p=[],n=0;n<f;n++)if(I=n+c,I<=e[u])p[n]=h;else if(I>=r[u])p[n]=a;else{let y=(I-e[u])*d[u]+h;p[n]=l==="floor"?Math.floor(y):l==="round"?Math.round(y):y}C[u]=p}if(t.contrastOffset!=null){let y=Io(t.contrastOffset,t.brightnessOffset);for(u=0;u<s;u++)for(p=C[u],n=0;n<f;n++)p[n]=y[p[n]]}return{lut:C,offset:c}}function Io(t,e){let r=Math.min(Math.max(t,-100),100),i=Math.min(Math.max(e??0,-100),100),o=255,l=128,h=0,a=0,s=new Uint8Array(256);for(h=0;h<256;h++)r>0&&r<100?a=(200*h-100*o+2*o*i)/(2*(100-r))+l:r<=0&&r>-100?a=(200*h-100*o+2*o*i)*(100+r)/2e4+l:r===100?(a=200*h-100*o+(o+1)*(100-r)+2*o*i,a=a>0?o:0):r===-100&&(a=l),s[h]=a>o?o:a<0?0:a;return s}function wr(t,e,r){let i=[];for(let o=0;o<e.length;o++){let l=0,h=0,a=0;"min"in e[o]?{min:l,max:h,avg:a}=e[o]:[l,h,a]=e[o];let s=a??0;t!=="u8"&&(s=255*(s-l)/(h-l)),r&&(s*=xo[o]),i.push(Ao(s))}return i}function Ao(t){if(t<=0||t>=255)return Le;let e=0;t!==150&&(e=t<=150?45*Math.cos(.01047*t):17*Math.sin(.021*t));let r=255,i=t+e,o=Math.log(t/r),l=Math.log(i/r);if(l===0)return Le;let h=o/l;return isNaN(h)?Le:Math.min(9.9,Math.max(.01,h))}function Eo(t,e,r,i){let o=1/0,l=-1/0,h=0,a=0,s=0,u=0,n=t.length,c=new Map,f=[];for(let w=0;w<n;w++){let b=t[w];if(!e||e[w]){f.push(b);let x=(c.get(b)??0)+1;c.set(b,x),x>u&&(u=x,s=b),o=b<o?b:o,l=b>l?b:l,h+=b,a++}}if(a===0)return{statistics:{min:0,max:0,avg:0,stddev:0,mode:0,median:0},histogram:null};let d=h/a,m=0;for(let w=0;w<n;w++)e&&!e[w]||(m+=(t[w]-d)**2);let g=e?e.filter(w=>w).length:n,S=g<=1?0:Math.sqrt(m/(g-1));f.sort((w,b)=>w-b);let C=a>>>1,I={min:o,max:l,avg:d,stddev:S,mode:s,median:a%2?f[Math.floor(C)]:(f[C-1]+f[C])/2};if(["u8","s8","u4","u2","u1"].includes(r)){let w=l-o+1,b=new Uint32Array(w);for(let x=0;x<n;x++)e&&!e[x]||b[t[x]-o]++;return{statistics:I,histogram:{min:o-.5,max:l+.5,size:w,counts:b}}}let v=256,p=new Uint32Array(v),y=(l-o)/v;if(y===0)return{statistics:I,histogram:{min:o,max:l,size:1,counts:new Uint32Array(1).fill(a)}};let T=new Uint32Array(v+1);for(let w=0;w<n;w++)e&&!e[w]||T[Math.floor((t[w]-o)/y)]++;for(let w=0;w<v-1;w++)p[w]=T[w];return p[v-1]=T[v-1]+T[v],{statistics:I,histogram:{min:o,max:l,size:v,counts:p}}}function ji(t){let{pixels:e,mask:r,pixelType:i,bandMasks:o}=t,l=e.map((h,a)=>Eo(h,o?.[a]??r,i));return{statistics:l.map(({statistics:h})=>h),histograms:l.map(({histogram:h})=>h)}}function Po(t){if(!t?.pixels?.length)return null;let{pixels:e,mask:r,bandMasks:i,pixelType:o}=t,l=t.width*t.height,h=e.length,a=[],s=[],u=256,n,c,f,d;for(let m=0;m<h;m++){f=new Uint32Array(u);let g=e[m],S=i?.[m]??r;if(o==="u8"){if(n=255,c=0,S){for(let A=0;A<l;A++)if(S[A]){let E=g[A];n=E<n?E:n,c=E>c?E:c,f[E]++}}else for(let A=0;A<l;A++){let E=g[A];n=E<n?E:n,c=E>c?E:c,f[E]++}f=f.slice(n,c+1)}else{let A=!1;t.statistics||(t.updateStatistics(),A=!0);let E=t.statistics;n=E[m].minValue,c=E[m].maxValue;let P=(c-n)/u;if(P===0){!E||t.validPixelCount||A||t.updateStatistics();let R=(t.validPixelCount||t.width*t.height)/u;for(let G=0;G<u;G++)f[G]=Math.round(R*(G+1))-Math.round(R*G)}else{d=new Uint32Array(u+1);for(let R=0;R<l;R++)S&&!S[R]||d[Math.floor((g[R]-n)/P)]++;for(let R=0;R<u-1;R++)f[R]=d[R];f[u-1]=d[u-1]+d[u]}}let C=o==="u8"?n-.5:n,I=o==="u8"?c+.5:c;a.push({min:C,max:I,size:f.length,counts:f});let v=0,p=0,y=0;for(let A=0;A<f.length;A++)v+=f[A],p+=A*f[A];let T=p/v;for(let A=0;A<f.length;A++)y+=f[A]*(A-T)**2;let w=Math.sqrt(y/(v-1)),b=(I-C)/f.length,x=(T+(o==="u8"?0:.5))*b+n,k=w*b;s.push({min:n,max:c,avg:x,stddev:k})}return{statistics:s,histograms:a}}function Hi(t){let e=[];for(let r=0;r<t.length;r++){let{min:i,max:o,size:l,counts:h}=t[r],a=0,s=0;for(let m=0;m<l;m++)a+=h[m],s+=m*h[m];let u=s/a,n=0;for(let m=0;m<l;m++)n+=h[m]*(m-u)**2;let c=(o-i)/l,f=(u+.5)*c+i,d=Math.sqrt(n/(a-1))*c;e.push({min:i,max:o,avg:f,stddev:d})}return e}function Nt(t,e){let{pixelBlock:r,bandIds:i,returnHistogramLut:o,rasterInfo:l}=e,h=null,a=null,s=t.stretchType;if(typeof s=="number"&&(s=br[s]),t.dra)if(s==="minMax"&&r?.statistics)h=r.statistics.map(k=>[k.minValue,k.maxValue,0,0]);else{let k=Po(r);h=k!=null?k.statistics:null,a=k!=null?k.histograms:null}else h=t.statistics?.length?t.statistics:l.statistics,a="histograms"in t?t.histograms:void 0,a||(a=l.histograms);s!=="percentClip"&&s!=="histogramEqualization"||a?.length||(s="minMax");let u=h?.length||a?.length||l.bandCount,n=[],c=[],f,d,m,g,S,C,I,v,p;h&&!Array.isArray(h[0])&&(h=h.map(k=>[k.min,k.max,k.avg,k.stddev]));let[y,T]=Ze(l.pixelType);if(!h?.length){for(h=[],v=0;v<u;v++)h.push([y,T,1,1]);s==="standardDeviation"&&(s="minMax")}switch(s){case"none":for(v=0;v<u;v++)n[v]=y,c[v]=T;break;case"minMax":for(v=0;v<u;v++){let k=h[v];n[v]=k[0],c[v]=k[1]}break;case"standardDeviation":{let{numberOfStandardDeviations:k=2}=t;for(v=0;v<u;v++){let A=h[v];n[v]=A[2]-k*A[3],c[v]=A[2]+k*A[3],n[v]<A[0]&&(n[v]=A[0]),c[v]>A[1]&&(c[v]=A[1])}}break;case"histogramEqualization":for(Ot(a),v=0;v<u;v++)n[v]=a[v].min,c[v]=a[v].max;break;case"percentClip":for(Ot(a),v=0;v<a.length;v++){for(f=a[v],S=new Uint32Array(f.size),g=[...f.counts],g.length>=20&&(g[0]=g[1]=g[2]=g[g.length-1]=g[g.length-2]=0),m=0,d=(f.max-f.min)/f.size,I=f.min===-.5&&d===1?.5:0,p=0;p<f.size;p++)m+=g[p],S[p]=m;for(C=(t.minPercent||0)*m/100,n[v]=f.min+I,p=0;p<f.size;p++)if(S[p]>C){n[v]=f.min+d*(p+I);break}for(C=(1-(t.maxPercent||0)/100)*m,c[v]=f.max+I,p=f.size-2;p>=0;p--)if(S[p]<C){c[v]=f.min+d*(p+2-I);break}if(c[v]<n[v]){let k=n[v];n[v]=c[v],c[v]=k}}break;default:for(v=0;v<u;v++){let k=h[v];n[v]=k[0],c[v]=k[1]}}let w,b,x;return s==="histogramEqualization"?(Ot(a),b=a[0].size||256,w=0,o&&(x=a.map(k=>Oe(k)))):(b=t.max||255,w=t.min||0),Ro({minCutOff:n,maxCutOff:c,outMax:b,outMin:w,histogramLut:x},i)}function Ro(t,e){if(e==null||e.length===0)return t;let r=Math.max.apply(null,e),{minCutOff:i,maxCutOff:o,outMin:l,outMax:h,histogramLut:a}=t;return i.length===e.length||i.length<=r?t:{minCutOff:e.map(s=>i[s]),maxCutOff:e.map(s=>o[s]),histogramLut:a?e.map(s=>a[s]):null,outMin:l,outMax:h}}function vr(t,e){let r=new Float32Array(t);for(let i=0;i<t;i++)e[i]>1?e[i]>2?r[i]=6.5+(e[i]-2)**2.5:r[i]=6.5+100*(2-e[i])**4:r[i]=1;return r}function ue(t,e){if(!t?.pixels?.length)return t;let{mask:r,bandMasks:i,width:o,height:l,pixels:h}=t,{minCutOff:a,maxCutOff:s,gamma:u}=e,n=e.outMin||0,c=e.outMax||255,f=o*l,d=e.outputPixelType||"u8",m=t.pixels.map(()=>Q.createEmptyBand(d,f)),g=m.length,S=c-n,C=[],I=[];for(let w=0;w<g;w++)I[w]=s[w]-a[w],C[w]=I[w]===0?0:S/I[w];let v=d.startsWith("u")||d.startsWith("s"),p=u&&u.length>=g,y=!!e.isRenderer;if(p){let w=vr(g,u);for(let b=0;b<g;b++){let x=i?.[b]??r;for(let k=0;k<f;k++)if(x==null||x[k]){if(I[b]===0){m[b][k]=n;continue}let A=h[b][k],E=(A-a[b])/I[b],P=1;if(u[b]>1&&(P-=(1/S)**(E*w[b])),A<s[b]&&A>a[b]){let R=P*S*E**(1/u[b])+n;m[b][k]=y?Math.floor(R):v?Math.round(R):R}else A>=s[b]?m[b][k]=c:m[b][k]=n}}}else for(let w=0;w<g;w++){let b=i?.[w]??r;for(let x=0;x<f;x++)if(b==null||b[x]){let k=h[w][x];if(k<s[w]&&k>a[w]){let A=(k-a[w])*C[w]+n;m[w][x]=y?Math.floor(A):v?Math.round(A):A}else k>=s[w]?m[w][x]=c:m[w][x]=n}}let T=new Q({width:o,height:l,mask:r,bandMasks:i,pixels:m,pixelType:d});return T.updateStatistics(),T}var Ue;function Mt(t){return t=Number(t),isNaN(t)?void 0:t}var dt=Ue=class extends yt{constructor(){super(...arguments),this.name=null,this.minWavelength=void 0,this.maxWavelength=void 0,this.radianceBias=void 0,this.radianceGain=void 0,this.reflectanceBias=void 0,this.reflectanceGain=void 0,this.solarIrradiance=void 0}clone(){return new Ue({name:this.name,minWavelength:this.minWavelength,maxWavelength:this.maxWavelength,radianceBias:this.radianceBias,radianceGain:this.radianceGain,reflectanceBias:this.reflectanceBias,reflectanceGain:this.reflectanceGain,solarIrradiance:this.solarIrradiance})}};M([U({json:{name:"BandName",write:!0}})],dt.prototype,"name",void 0),M([U({json:{name:"WavelengthMin",read:{reader:Mt},write:!0}})],dt.prototype,"minWavelength",void 0),M([U({json:{name:"WavelengthMax",read:{reader:Mt},write:!0}})],dt.prototype,"maxWavelength",void 0),M([U({json:{name:"RadianceBias",read:{reader:Mt},write:!0}})],dt.prototype,"radianceBias",void 0),M([U({json:{name:"RadianceGain",read:{reader:Mt},write:!0}})],dt.prototype,"radianceGain",void 0),M([U({json:{name:"ReflectanceBias",read:{reader:Mt},write:!0}})],dt.prototype,"reflectanceBias",void 0),M([U({json:{name:"ReflectanceGain",read:{reader:Mt},write:!0}})],dt.prototype,"reflectanceGain",void 0),M([U({json:{name:"SolarIrradiance",read:{reader:Mt},write:!0}})],dt.prototype,"solarIrradiance",void 0),dt=Ue=M([gt("esri.layers.support.RasterBandInfo")],dt);var Ge=dt;var Ne;function Jt(t){return t=Number(t),isNaN(t)?void 0:t}var ut=Ne=class extends yt{constructor(){super(...arguments),this.acquisitionDate=void 0,this.cloudCover=void 0,this.productName=void 0,this.sensorName=null,this.sensorAzimuth=void 0,this.sensorElevation=void 0,this.sunAzimuth=void 0,this.sunElevation=void 0}readAcquisitionDate(t){return new Date(t)}writeAcquisitionDate(t,e){e.AcquisitionDate=t.getTime()}clone(){return new Ne({acquisitionDate:this.acquisitionDate,cloudCover:this.cloudCover,productName:this.productName,sensorName:this.sensorName,sensorAzimuth:this.sensorAzimuth,sensorElevation:this.sensorElevation,sunAzimuth:this.sunAzimuth,sunElevation:this.sunElevation})}};M([U({json:{name:"AcquisitionDate",write:!0}})],ut.prototype,"acquisitionDate",void 0),M([qe("acquisitionDate")],ut.prototype,"readAcquisitionDate",null),M([Je("acquisitionDate")],ut.prototype,"writeAcquisitionDate",null),M([U({json:{name:"CloudCover",read:{reader:Jt},write:!0}})],ut.prototype,"cloudCover",void 0),M([U({json:{name:"ProductName",write:!0}})],ut.prototype,"productName",void 0),M([U({json:{name:"SensorName",write:!0}})],ut.prototype,"sensorName",void 0),M([U({json:{name:"SensorAzimuth",read:{reader:Jt},write:!0}})],ut.prototype,"sensorAzimuth",void 0),M([U({json:{name:"SensorElevation",read:{reader:Jt},write:!0}})],ut.prototype,"sensorElevation",void 0),M([U({json:{name:"SunAzimuth",read:{reader:Jt},write:!0}})],ut.prototype,"sunAzimuth",void 0),M([U({json:{name:"SunElevation",read:{reader:Jt},write:!0}})],ut.prototype,"sunElevation",void 0),ut=Ne=M([gt("esri.layers.support.RasterSensorInfo")],ut);var Sr=ut;var Be,nt=Be=class extends yt{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new Be({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:rt(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:rt(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:rt(this.tileInfo),transposeInfo:rt(this.transposeInfo),blockBoundary:rt(this.blockBoundary)})}};M([U({type:Number,json:{write:!0}})],nt.prototype,"blockWidth",void 0),M([U({type:Number,json:{write:!0}})],nt.prototype,"blockHeight",void 0),M([U({type:String,json:{write:!0}})],nt.prototype,"compression",void 0),M([U({type:Ye,json:{write:!0}})],nt.prototype,"origin",void 0),M([U({type:Number,json:{write:!0}})],nt.prototype,"firstPyramidLevel",void 0),M([U({type:Number,json:{write:!0}})],nt.prototype,"maximumPyramidLevel",void 0),M([U({json:{write:!0}})],nt.prototype,"pyramidResolutions",void 0),M([U({type:Number,json:{write:!0}})],nt.prototype,"pyramidScalingFactor",void 0),M([U({type:Number,json:{write:!0}})],nt.prototype,"pyramidBlockWidth",void 0),M([U({type:Number,json:{write:!0}})],nt.prototype,"pyramidBlockHeight",void 0),M([U({type:Boolean,json:{write:!0}})],nt.prototype,"isVirtualTileInfo",void 0),M([U({json:{write:!0}})],nt.prototype,"tileInfo",void 0),M([U()],nt.prototype,"transposeInfo",void 0),M([U()],nt.prototype,"blockBoundary",void 0),nt=Be=M([gt("esri.layers.support.RasterStorageInfo")],nt);var Tr=nt;var Fe,X=Fe=class extends yt{constructor(t){super(t),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get bandInfos(){let t=this.keyProperties.BandProperties,{bandCount:e}=this;if(!t?.length||t.length<e){let i=[];for(let o=1;o<=e;o++)i.push(new Ge({name:"band_"+o}));return i}let r=t.map(i=>Ge.fromJSON(i));for(let i=0;i<r.length;i++)r[i].name=r[i].name||"band_"+(i+1);return r}get dataType(){let t=this.keyProperties?.DataType?.toLowerCase()??"generic";return t==="stdtime"?"standard-time":t}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(t){t&&this._set("nativeExtent",t)}get nativePixelSize(){if(this.transform==null||!this.transform.affectsPixelSize)return this.pixelSize;let t=this.nativeExtent;return{x:t.width/this.width,y:t.height/this.height}}get hasMultidimensionalTranspose(){return!!this.storageInfo?.transposeInfo}get sensorInfo(){if(this.keyProperties?.SensorName)return Sr.fromJSON(this.keyProperties)}clone(){return new Fe({attributeTable:rt(this.attributeTable),bandCount:this.bandCount,colormap:rt(this.colormap),extent:rt(this.extent),format:this.format,height:this.height,width:this.width,histograms:rt(this.histograms),keyProperties:rt(this.keyProperties),multidimensionalInfo:rt(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:rt(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:rt(this.spatialReference),statistics:rt(this.statistics),storageInfo:rt(this.storageInfo),transform:rt(this.transform)})}};M([U({json:{write:!0}})],X.prototype,"attributeTable",void 0),M([U({json:{write:!0}})],X.prototype,"bandCount",void 0),M([U({readOnly:!0})],X.prototype,"bandInfos",null),M([U({json:{write:!0}})],X.prototype,"colormap",void 0),M([U({type:String,readOnly:!0})],X.prototype,"dataType",null),M([U({type:ge,json:{write:!0}})],X.prototype,"extent",void 0),M([U({type:ge,json:{write:!0}})],X.prototype,"nativeExtent",null),M([U({json:{write:!0}})],X.prototype,"nativePixelSize",null),M([U({json:{write:!0}})],X.prototype,"format",void 0),M([U({json:{write:!0}})],X.prototype,"height",void 0),M([U({json:{write:!0}})],X.prototype,"width",void 0),M([U({json:{write:!0}})],X.prototype,"hasMultidimensionalTranspose",null),M([U({json:{write:!0}})],X.prototype,"histograms",void 0),M([U({json:{write:!0}})],X.prototype,"keyProperties",void 0),M([U({json:{write:!0}})],X.prototype,"multidimensionalInfo",void 0),M([U({json:{write:!0}})],X.prototype,"noDataValue",void 0),M([U({json:{write:!0}})],X.prototype,"pixelSize",void 0),M([U({json:{write:!0}})],X.prototype,"pixelType",void 0),M([U()],X.prototype,"isPseudoSpatialReference",void 0),M([U({readOnly:!0})],X.prototype,"sensorInfo",null),M([U({type:Ke,json:{write:!0}})],X.prototype,"spatialReference",void 0),M([U({json:{write:!0}})],X.prototype,"statistics",void 0),M([U({type:Tr,json:{write:!0}})],X.prototype,"storageInfo",void 0),M([U({json:{write:!0}})],X.prototype,"transform",void 0),X=Fe=M([gt("esri.layers.support.RasterInfo")],X);var kr=X;var at=1,Bt=1/111e3;function Ve(t){let{altitude:e,azimuth:r}=t,{hillshadeType:i,pixelSizePower:o=1,pixelSizeFactor:l=1,scalingType:h,isGCS:a,resolution:s}=t,u=i==="multi-directional"?2*t.zFactor:t.zFactor,{x:n,y:c}=s,f=u/(8*n),d=u/(8*c);if(a&&u>.001&&(f/=Bt,d/=Bt),h==="adjusted")if(a){let E=n*Bt,P=c*Bt;f=(u+E**o*l)/(8*E),d=(u+P**o*l)/(8*P)}else f=(u+n**o*l)/(8*n),d=(u+c**o*l)/(8*c);let m=(90-e)*Math.PI/180,g=Math.cos(m),S=(360-r+90)*Math.PI/180,C=Math.sin(m)*Math.cos(S),I=Math.sin(m)*Math.sin(S),v=[315,270,225,360,180,0],p=[60,60,60,60,60,90],y=new Float32Array([3,5,3,2,1,4]),T=y.reduce((E,P)=>E+P),w=y.map(E=>E/T),b=i==="multi-directional"?v.length:1,x=new Float32Array(6),k=new Float32Array(6),A=new Float32Array(6);if(i==="multi-directional")for(let E=0;E<b;E++)e=p[E],r=v[E],m=(90-e)*Math.PI/180,g=Math.cos(m),S=(360-r+90)*Math.PI/180,C=Math.sin(m)*Math.cos(S),I=Math.sin(m)*Math.sin(S),x[E]=g,k[E]=C,A[E]=I;else x.fill(g),k.fill(C),A.fill(I);return{resolution:s,factor:[f,d],sinZcosA:C,sinZsinA:I,cosZ:g,sinZcosAs:k,sinZsinAs:A,cosZs:x,weights:w,hillshadeType:["traditional","multi-directional"].indexOf(i)}}function ce(t,e){let{width:r,height:i}=t,o=r*i,l=new Uint8Array(o),h=t.mask!=null,a;if(h){a=new Uint8Array(t.mask);for(let T=0;T<a.length;T++)a[T]&&(l[T]=1,a[T]=1)}let s=t.pixels[0],u=new Float32Array(o),n=new Float32Array(o),c,f=0;if(e){let{resolution:T}=e,w=T?(T.x+T.y)/2:1;f=200*e.zFactor/(w*w),c=new Float32Array(o)}let d=e?.curvatureType,m,g,S,C,I,v,p,y;for(let T=at;T<i-at;T++){let w=T*r;for(let b=at;b<r-at;b++){let x=w+b;if(!a||a[x]!==0){if(a){if(a[x-r-1]+a[x-r]+a[x-r+1]+a[x-1]+a[x+1]+a[x+r-1]+a[x+r]+a[x+r+1]<7){l[x]=0;continue}m=a[x-r-1]?s[x-r-1]:s[x],g=a[x-r]?s[x-r]:s[x],S=a[x-r+1]?s[x-r+1]:s[x],C=a[x-1]?s[x-1]:s[x],I=a[x+1]?s[x+1]:s[x],v=a[x+r-1]?s[x+r-1]:s[x],p=a[x+r]?s[x+r]:s[x],y=a[x+r+1]?s[x+r+1]:s[x]}else m=s[x-r-1],g=s[x-r],S=s[x-r+1],C=s[x-1],I=s[x+1],v=s[x+r-1],p=s[x+r],y=s[x+r+1];if(u[x]=S+I+I+y-(m+C+C+v),n[x]=v+p+p+y-(m+g+g+S),c!=null){let k=s[x],A=.5*(C+I)-k,E=.5*(g+p)-k;if(d==="standard")c[x]=-f*(A+E);else{let P=(-m+S+v-y)/4,R=(-C+I)/2,G=(g-p)/2,O=R*R,V=G*G,N=O+V;N&&(c[x]=d==="profile"?f*(A*O+E*V+P*R*G)/N:-f*(A*V+E*O-P*R*G)/N)}}}}}return{outMask:h?l:null,dzxs:u,dzys:n,curvatures:c}}function fe(t,e,r){for(let i=0;i<r;i++)t[i*e]=t[i*e+1],t[(i+1)*e-1]=t[(i+1)*e-2];for(let i=1;i<e-1;i++)t[i]=t[i+e],t[i+(r-1)*e]=t[i+(r-2)*e]}function xr(t,e){if(!wt(t))return t;let{factor:r,sinZcosA:i,sinZsinA:o,cosZ:l,sinZcosAs:h,sinZsinAs:a,cosZs:s,weights:u}=Ve(e),[n,c]=r,f=e.hillshadeType==="traditional",{width:d,height:m}=t,g=new Uint8Array(d*m),{dzxs:S,dzys:C,outMask:I}=ce(t);for(let v=at;v<m-at;v++){let p=v*d;for(let y=at;y<d-at;y++){let T=p+y;if(!I||I[T]){let w=S[T]*n,b=C[T]*c,x=Math.sqrt(1+w*w+b*b),k=0;if(f){let A=255*(l+o*b-i*w)/x;A<0&&(A=0),k=A}else{let A=a.length;for(let E=0;E<A;E++){let P=255*(s[E]+a[E]*b-h[E]*w)/x;P<0&&(P=0),k+=P*u[E]}}g[T]=255&k}}}return fe(g,d,m),new Q({width:d,height:m,pixels:[g],mask:I,pixelType:"u8",validPixelCount:t.validPixelCount,statistics:[new zt(0,255)]})}function Ir(t,e,r,i){if(!wt(t)||!wt(e))return;let{min:o,max:l}=i,h=t.pixels[0],{pixels:a,mask:s}=e,u=a[0],n=255.00001/(l-o),c=new Uint8ClampedArray(u.length),f=new Uint8ClampedArray(u.length),d=new Uint8ClampedArray(u.length),m=r.length-1;for(let g=0;g<u.length;g++){if(s&&s[g]===0)continue;let S=Math.floor((u[g]-o)*n),[C,I]=r[S<0?0:S>m?m:S],v=h[g],p=v*I,y=p*(1-Math.abs(C%2-1)),T=v-p;switch(Math.floor(C)){case 0:c[g]=p+T,f[g]=y+T,d[g]=T;break;case 1:c[g]=y+T,f[g]=p+T,d[g]=T;break;case 2:c[g]=T,f[g]=p+T,d[g]=y+T;break;case 3:c[g]=T,f[g]=y+T,d[g]=p+T;break;case 4:c[g]=y+T,f[g]=T,d[g]=p+T;break;case 5:case 6:c[g]=p+T,f[g]=T,d[g]=y+T}}t.pixels=[c,f,d],t.updateStatistics()}function Vn(t,e){if(!wt(t))return t;let r=e.zFactor,i=e.pixelSizePower??1,o=e.pixelSizeFactor??1,l=e.slopeType,h=e.isGCS,{x:a,y:s}=e.resolution,u=r/(8*a),n=r/(8*s);h&&Math.abs(r-1)<1e-4&&(u/=Bt,n/=Bt),l==="adjusted"&&(u=(r+a**i*o)/(8*a),n=(r+s**i*o)/(8*s));let{dzxs:c,dzys:f,outMask:d}=ce(t),{width:m,height:g}=t,S=new Float32Array(m*g);for(let I=at;I<g-at;I++){let v=I*m;for(let p=at;p<m-at;p++){let y=v+p;if(!d||d[y]){let T=c[y]*u,w=f[y]*n,b=Math.sqrt(T*T+w*w);S[v+p]=l==="percent-rise"?100*b:57.2957795*Math.atan(b)}}}fe(S,m,g);let C=new Q({width:m,height:g,pixels:[S],mask:d,pixelType:"f32",validPixelCount:t.validPixelCount});return C.updateStatistics(),C}function _n(t,e={}){if(!wt(t))return t;let{resolution:r}=e,i=r?1/r.x:1,o=r?1/r.y:1,{dzxs:l,dzys:h,outMask:a}=ce(t),{width:s,height:u}=t,n=new Float32Array(s*u);for(let c=at;c<u-at;c++){let f=c*s;for(let d=at;d<s-at;d++){let m=f+d;if(!a||a[m]){let g=l[m]*i,S=h[m]*o,C=-1;g===0&&S===0||(C=90-57.29578*Math.atan2(S,-g),C<0&&(C+=360),C===360?C=0:C>360&&(C%=360)),n[f+d]=C}}}return fe(n,s,u),new Q({width:s,height:u,pixels:[n],mask:a,pixelType:"f32",validPixelCount:t.validPixelCount,statistics:[new zt(-1,360)]})}function zn(t,e){if(!wt(t))return t;let{curvatures:r,outMask:i}=ce(t,e),{width:o,height:l}=t;fe(r,o,l);let h=new Q({width:o,height:l,pixels:[r],mask:i,pixelType:"f32",validPixelCount:t.validPixelCount});return h.updateStatistics(),h}function jn(t,e,r){let{hillshadeType:i,altitude:o,azimuth:l,zFactor:h,pixelSizeFactor:a,pixelSizePower:s,slopeType:u}=t;return{hillshadeType:i,altitude:o,azimuth:l,zFactor:h,pixelSizePower:s,pixelSizeFactor:a,scalingType:u==="scaled"?"adjusted":"none",resolution:e,isGCS:r}}var Yn=["random","ndvi","ndvi2","ndvi3","elevation","gray","hillshade"],Mr=[{id:"aspect",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"black-to-white",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blue-bright",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blue-light-to-dark",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blue-green-bright",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blue-green-light-to-dark",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brown-light-to-dark",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brown-to-blue-green-diverging-right",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brown-to-blue-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficient-bias",fromColor:[214,214,255],toColor:[0,57,148]},{id:"cold-to-hot-diverging",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"condition-number",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyan-to-purple",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyan-light-to-blue-dark",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors",fromColor:[255,235,214],toColor:[196,10,10]},{id:"gray-light-to-dark",fromColor:[219,219,219],toColor:[69,69,69]},{id:"green-bright",fromColor:[204,255,204],toColor:[14,204,14]},{id:"green-light-to-dark",fromColor:[220,245,233],toColor:[34,102,51]},{id:"green-to-blue",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orange-bright",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orange-light-to-dark",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partial-spectrum",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partial-spectrum-1-diverging",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partial-spectrum-2-diverging",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pink-to-yellow-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pink-to-yellow-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purple-bright",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purple-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purple-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purple-blue-bright",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purple-blue-light-to-dark",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purple-red-bright",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purple-red-light-to-dark",fromColor:[250,215,246],toColor:[143,17,57]},{id:"red-bright",fromColor:[255,204,204],toColor:[219,0,0]},{id:"red-light-to-dark",fromColor:[255,224,224],toColor:[143,10,10]},{id:"red-to-blue-diverging-bright",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"red-to-blue-diverging-dark",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"red-to-green",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"red-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"red-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrum-full-bright",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrum-full-dark",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrum-full-light",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"white-to-black",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellow-to-dark-red",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellow-to-green-to-dark-blue",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellow-to-red",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellow-green-bright",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellow-green-light-to-dark",fromColor:[215,240,175],toColor:[96,107,45]}],Mo=new Xt({Aspect:"aspect","Black to White":"black-to-white","Blue Bright":"blue-bright","Blue Light to Dark":"blue-light-to-dark","Blue-Green Bright":"blue-green-bright","Blue-Green Light to Dark":"blue-green-light-to-dark","Brown Light to Dark":"brown-light-to-dark","Brown to Blue Green Diverging, Bright":"brown-to-blue-green-diverging-right","Brown to Blue Green Diverging, Dark":"brown-to-blue-green-diverging-dark","Coefficient Bias":"coefficient-bias","Cold to Hot Diverging":"cold-to-hot-diverging","Condition Number":"condition-number","Cyan to Purple":"cyan-to-purple","Cyan-Light to Blue-Dark":"cyan-light-to-blue-dark",Distance:"distance","Elevation #1":"elevation1","Elevation #2":"elevation2",Errors:"errors","Gray Light to Dark":"gray-light-to-dark","Green Bright":"green-bright","Green Light to Dark":"green-light-to-dark","Green to Blue":"green-to-blue","Orange Bright":"orange-bright","Orange Light to Dark":"orange-light-to-dark","Partial Spectrum":"partial-spectrum","Partial Spectrum 1 Diverging":"partial-spectrum-1-diverging","Partial Spectrum 2 Diverging":"partial-spectrum-2-diverging","Pink to YellowGreen Diverging, Bright":"pink-to-yellow-green-diverging-bright","Pink to YellowGreen Diverging, Dark":"pink-to-yellow-green-diverging-dark",Precipitation:"precipitation",Prediction:"prediction","Purple Bright":"purple-bright","Purple to Green Diverging, Bright":"purple-to-green-diverging-bright","Purple to Green Diverging, Dark":"purple-to-green-diverging-dark","Purple-Blue Bright":"purple-blue-bright","Purple-Blue Light to Dark":"purple-blue-light-to-dark","Purple-Red Bright":"purple-red-bright","Purple-Red Light to Dark":"purple-red-light-to-dark","Red Bright":"red-bright","Red Light to Dark":"red-light-to-dark","Red to Blue Diverging, Bright":"red-to-blue-diverging-bright","Red to Blue Diverging, Dark":"red-to-blue-diverging-dark","Red to Green":"red-to-green","Red to Green Diverging, Bright":"red-to-green-diverging-bright","Red to Green Diverging, Dark":"red-to-green-diverging-dark",Slope:"slope","Spectrum-Full Bright":"spectrum-full-bright","Spectrum-Full Dark":"spectrum-full-dark","Spectrum-Full Light":"spectrum-full-light",Surface:"surface",Temperature:"temperature","White to Black":"white-to-black","Yellow to Dark Red":"yellow-to-dark-red","Yellow to Green to Dark Blue":"yellow-to-green-to-dark-blue","Yellow to Red":"yellow-to-red","Yellow-Green Bright":"yellow-green-bright","Yellow-Green Light to Dark":"yellow-green-light-to-dark"});function he(t,e){if(!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]>e[r]+2||t[r]<e[r]-2)return!1;return!0}function Ar(t){let e=t.clone();return e.fromColor=t.toColor,e.toColor=t.fromColor,e.algorithm=t.algorithm,e}function Lo(t){if(t.type==="multipart"){let e=t.clone();return e.colorRamps?.length&&(e.colorRamps=e.colorRamps.reverse().map(r=>Ar(r))),e}return Ar(t)}function Er(t,e){if(!t)return;let r=e??Mr,i=null;return t.type==="algorithmic"?r.some(o=>{if(he(t.fromColor.toRgb(),o.fromColor)&&he(t.toColor.toRgb(),o.toColor))return i=o.id,!0}):t.type==="multipart"&&r.some(o=>{let l=t.colorRamps,h=o.colorRamps;if(l&&h&&l.length===h.length&&!h.some((a,s)=>{if(!he(l[s].fromColor.toRgb(),new ye(a.fromColor).toRgb())||!he(l[s].toColor.toRgb(),new ye(a.toColor).toRgb()))return!0})){if(i)return!0;i=o.id}}),i}function Oo(t,e,r=!1){if(!t)return;let i=!1,o=Er(t,e);return o!=null||r||(i=!0,o=Er(t=Lo(t),e)),o?{id:o,inverted:i}:void 0}function Do(t,e=!1){let r=typeof t=="string"?t:Oo(t,void 0,e)?.id;return r?Mo.toJSON(r):null}function Xn(t,e="esriCIELabAlgorithm"){let r=Mr.find(({id:i})=>i===t);return r?r.colorRamps?{type:"multipart",colorRamps:r.colorRamps.map(i=>({type:"algorithmic",algorithm:e,fromColor:[...i.fromColor],toColor:[...i.toColor]}))}:{type:"algorithmic",algorithm:e,fromColor:[...r.fromColor],toColor:[...r.toColor]}:null}function Lr(t){let e=(t=t||{}).numColors||256,r=t.distanceOffset||0,i=t.isCustomInterval!=null?t.isCustomInterval:t.distanceInterval!==null&&t.distanceInterval!==1/(e-1),o=t.distanceInterval||1/(e-1);return et($({},t),{numColors:e,distanceOffset:r,interpolateAlpha:!!t.interpolateAlpha,distanceInterval:o,isCustomInterval:i,weights:t.weights})}function Uo(t,e,r){let{numColors:i,distanceOffset:o,distanceInterval:l,isCustomInterval:h}=r,a=t.s===0,s=e.s===0,u=t.h,n=e.h;a&&!s?u=n:s&&!a&&(e=et($({},e),{h:u}),n=u);let c,f=Math.abs(n-u),d=360;f<d/2?c=(n-u)*l:(f=d-f,c=u>n?f*l:-f*l);let m=(e.s-t.s)*l,g=(e.v-t.v)*l,{s:S,v:C}=t,I=u;if(o){let p=o/l;I=(I+p*c+d)%d,S+=p*m,C+=p*g}let v=[];for(let p=0;p<i-1;p++)v.push({h:I,s:S,v:C}),I=(I+c+d)%d,S+=m,C+=g;return v.push(h?{h:I,s:S,v:C}:e),v}function Go(t,e,r){let{numColors:i,distanceOffset:o,distanceInterval:l,isCustomInterval:h}=r,{l:a,a:s,b:u}=t,n=(e.l-a)*l,c=(e.a-s)*l,f=(e.b-u)*l,d=[];if(o){let m=o/l;a+=m*n,s+=m*c,u+=m*f}for(let m=0;m<i-1;m++)d.push({l:a,a:s,b:u}),a+=n,s+=c,u+=f;return d.push(h?{l:a,a:s,b:u}:e),d}function No(t,e,r){let{numColors:i,distanceOffset:o,distanceInterval:l,isCustomInterval:h}=r,a=t.h,s=e.h,u=2*Math.PI,n;if(a<=s){let I=s-a,v=s-a-u;n=Math.abs(v)<Math.abs(I)?v:I}else{let I=s+u-a,v=s-a;n=Math.abs(v)<Math.abs(I)?v:I}let c=n*l,f=(e.l-t.l)*l,d=(e.c-t.c)*l,{l:m,c:g,h:S}=t;if(o){let I=o/l;m+=I*f,g+=I*d,S=(S+I*c+u)%u}let C=[];for(let I=0;I<i-1;I++)C.push({l:m,c:g,h:S}),m+=f,g+=d,S=(S+c+u)%u;return C.push(h?{l:m,c:g,h:S}:e),C}function Or(t,e){let{fromColor:r,toColor:i}=t;r=[...r],i=[...i],r.length===3&&(r=r.concat([255])),i.length===3&&(i=i.concat([255]));let o=t.algorithm||"esriCIELabAlgorithm",l=Lr(e),{numColors:h,distanceOffset:a,isCustomInterval:s,interpolateAlpha:u}=l;if(h===1&&a===0)return[r];if(h===2&&a===0&&!s)return[r,i];let n={r:r[0],g:r[1],b:r[2]},c={r:i[0],g:i[1],b:i[2]},f=o==="esriCIELabAlgorithm"?Go(Ce(n),Ce(c),l):o==="esriHSVAlgorithm"?Uo(_t(n),_t(c),l):No(be(n),be(c),l),d=[],m=r[3]??255,g=((i[3]??255)-m)/(h-1);for(let S=0;S<h;S++){let{r:C,g:I,b:v}=Xe(f[S]),p=u?Math.round(m+g*S):255;d.push([C,I,v,p])}return d}function Bo(t,e){let{numColors:r,interpolateAlpha:i}=Lr(e),o=e?.weights,{colorRamps:l}=t;if(o){let c=o.reduce((f,d)=>f+d);o=o.map(f=>f/c)}else{o=[];for(let c=0;c<l.length;c++)o[c]=1/l.length}let h=[],a=1/(r-1),s=0,u=!1;for(let c=0;c<l.length;c++){let f=h.length,d=u?0:f*a-s;s+=o[c];let m=c===l.length-1?r-1-f:(o[c]-d)/a;if(u=Math.ceil(m)===m,m=Math.ceil(m),m===0)continue;let g=Or(l[c],{numColors:m,interpolateAlpha:i,distanceOffset:d/o[c],distanceInterval:a/o[c]});h.push(...g)}let n=[...l[l.length-1].toColor];return n.length===3&&n.push(255),h.push(n),h}function Fo(t,e){let r=He(t)?t.toJSON():t;return r.type==="multipart"?Bo(r,e):Or(r,e)}function _e(t,e){let r=Fo(t,e),i=e?.interpolateAlpha;return r.forEach((o,l)=>{o.unshift(l),i||o.pop()}),r}function Dr(t){let e=[];for(let r=0;r<t.length;r+=4){let i=_t({r:t[r],g:t[r+1],b:t[r+2]});e.push([i.h/60,i.s/100,255*i.v/100])}return e}function Pr(t){let e=_t(t);return{type:"HsvColor",Hue:e.h,Saturation:e.s,Value:e.v,AlphaValue:255}}function Rr(t){return{Algorithm:t.toJSON()?.Algorithm||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:Pr(t.fromColor),ToColor:Pr(t.toColor)}}function Zn(t){let e=Do(t);if(!e)return null;if(t.type==="algorithmic")return et($({},Rr(t)),{Name:e});if(t.colorRamps){let r=t.colorRamps.map(Rr);return{type:"MultiPartColorRamp",NumColorRamps:r.length,ArrayOfColorRamp:r,Name:e}}return null}function $n(t){let e=t.reverse().map(r=>{let i=r.toString(16);return i.length<2?"0"+i:i});return 4294967295&Number.parseInt(e.join(""),16)}function Vo(t){return["u8","s8"].includes(t.pixelType)&&t.statistics?.[0]?.min!=null&&t.statistics[0]?.max!=null&&t.bandCount===1}function Ur(t,e){let{attributeTable:r,bandCount:i}=t;return r==null&&Vo(t)?!0:!(r==null||i>1||e&&r.fields.find(o=>o.name.toLowerCase()===e.toLowerCase())==null)}function Gr(t){let{bandCount:e,dataType:r,pixelType:i}=t;return r==="elevation"||r==="generic"&&e===1&&(i==="s16"||i==="s32"||i==="f32"||i==="f64")}function Nr(t,e=!1){let{bandCount:r,colormap:i,pixelType:o}=t;return r===1&&(!!i?.length||!e&&o==="u8")}function ea(t,e=!1){let{attributeTable:r,bandCount:i}=t;return i===1&&(!e||r!=null||t.histograms!=null)}function ra(t){let{dataType:e}=t;return e==="vector-uv"||e==="vector-magdir"}function oa(t){let{dataType:e}=t;return e==="vector-uv"||e==="vector-magdir"}function pe(t){return!!t?.length&&t.length<=16384}var Lt=class extends yt{constructor(t){super(t)}bind(){let{rendererJSON:t}=this;if(!t)return{success:!1};let e;switch(this.lookup={rendererJSON:{}},t.type){case"uniqueValue":e=this._updateUVRenderer(t);break;case"rasterColormap":e=this._updateColormapRenderer(t);break;case"rasterStretch":e=this._updateStretchRenderer(t);break;case"classBreaks":e=this._updateClassBreaksRenderer(t);break;case"rasterShadedRelief":e=this._updateShadedReliefRenderer(t);break;case"vectorField":e=this._updateVectorFieldRenderer();break;case"flowRenderer":e=this._updateFlowRenderer()}return e}symbolize(t){let e=t?.pixelBlock;if(!Br(e))return e;if(t.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(e,t.simpleStretchParams);try{let r;switch(e.pixels.length>3&&(e=e.extractBands(t.bandIds??[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":r=this._symbolizeColormap(e);break;case"classBreaks":r=this._symbolizeClassBreaks(e);break;case"rasterStretch":r=this._symbolizeStretch(e,t.bandIds);break;case"rasterShadedRelief":{let i=t.extent,o=i.spatialReference.isGeographic,l={x:(i.xmax-i.xmin)/e.width,y:(i.ymax-i.ymin)/e.height};r=this._symbolizeShadedRelief(e,{isGCS:o,resolution:l});break}}return r}catch(r){return me.getLogger(this).error("symbolize",r.message),e}}simpleStretch(t,e){if(!Br(t))return t;try{return t.pixels.length>3&&(t=t.extractBands([0,1,2])),ue(t,et($({},e),{isRenderer:!0}))}catch(r){return me.getLogger(this).error("symbolize",r.message),t}}generateWebGLParameters(t){if(["uniqueValue","rasterColormap","classBreaks"].includes(this.rendererJSON.type)){let{indexedColormap:h,offset:a}=this.lookup.colormapLut||{};return{colormap:h,colormapOffset:a,isClassBreaks:this.rendererJSON.type==="classBreaks",type:"lut"}}let{pixelBlock:e,isGCS:r,resolution:i,bandIds:o}=t,{rendererJSON:l}=this;return l.type==="rasterStretch"?this._generateStretchWebGLParams(e,l,o):l.type==="rasterShadedRelief"?this._generateShadedReliefWebGLParams(l,r,i??void 0):l.type==="vectorField"?this._generateVectorFieldWebGLParams(l):null}_isLUTChanged(t){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){let e=this.rendererJSON.colorRamp;return t?JSON.stringify(e)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(t){return this._isLUTChanged()&&!this.bind().success?t:$t(t,this.lookup.colormapLut)}_symbolizeClassBreaks(t){let{canUseIndexedLUT:e}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?t:e?$t(t,this.lookup.colormapLut):$e(t,this.lookup.remapLut??[])}_symbolizeStretch(t,e){let{rasterInfo:r}=this,{pixelType:i,bandCount:o}=r,l=this.rendererJSON,h=["u8","u16","s8","s16"].includes(i),a,s,{dra:u}=l,{gamma:n}=this.lookup;if(l.stretchType==="histogramEqualization"){let c=u?null:this.lookup?.histogramLut,f=Nt(l,{rasterInfo:r,pixelBlock:t,bandIds:e,returnHistogramLut:!c}),d=ue(t,et($({},f),{gamma:n,isRenderer:!0}));s=we(d,{lut:u?f.histogramLut:c,offset:0})}else if(h){if(u){let c=Nt(l,{rasterInfo:r,pixelBlock:t,bandIds:e});a=De(et($({pixelType:i},c),{gamma:n,rounding:"floor"}))}else if(this._isLUTChanged()){if(!this.bind().success)return t;a=this.lookup?this.lookup.stretchLut:null}else a=this.lookup?this.lookup.stretchLut:null;if(!a)return t;o>1&&e!=null&&e.length===t?.pixels.length&&a?.lut.length===o&&(a={lut:e.map(c=>a.lut[c]),offset:a.offset}),s=we(t,a)}else{let c=Nt(l,{rasterInfo:r,pixelBlock:t,bandIds:e});s=ue(t,et($({},c),{gamma:n,isRenderer:!0}))}if(l.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return t;s=$t(s,this.lookup?.colormapLut)}return s}_symbolizeShadedRelief(t,e){let r=this.rendererJSON,i=$($({},r),e),o=xr(t,i);if(!r.colorRamp)return o;let l;if(this._isLUTChanged(!0)){if(!this.bind().success)return o;l=this.lookup?this.lookup.hsvMap:null}else l=this.lookup?this.lookup.hsvMap:null;if(!l)return o;let h=this.rasterInfo.statistics?.[0]??{min:0,max:8e3};return Ir(o,t,l,h),o}_isVectorFieldData(){let{bandCount:t,dataType:e}=this.rasterInfo;return t===2&&(e==="vector-magdir"||e==="vector-uv")}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(t){let{bandCount:e,attributeTable:r,pixelType:i}=this.rasterInfo,o=t.field1;if(!o)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};let l=t.defaultSymbol,h=e===1&&["u8","s8"].includes(i);if(!Ur(this.rasterInfo,o)&&!h)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};let a=[];if(r!=null){let u=r.fields.find(n=>n.name.toLowerCase()==="value");if(!u)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};r.features.forEach(n=>{let c=t.uniqueValueInfos?.find(d=>String(d.value)===String(n.attributes[o])),f=c?.symbol?.color;f?a.push([n.attributes[u.name]].concat(f)):l&&a.push([n.attributes[u.name]].concat(l.color))})}else{if(o.toLowerCase()!=="value")return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not available.'};t.uniqueValueInfos?.forEach(u=>{let n=u?.symbol?.color;n?a.push([parseInt(""+u.value,10)].concat(n)):l&&a.push([parseInt(""+u.value,10)].concat(l?.color))})}if(a.length===0)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};let s=Dt({colormap:a});return this.lookup={rendererJSON:t,colormapLut:s},this.canRenderInWebGL=pe(s?.indexedColormap),{success:!0}}_updateColormapRenderer(t){if(!Nr(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};let e=t.colormapInfos.map(i=>[i.value].concat(i.color)).sort((i,o)=>i[0]-o[0]);if(!e||e.length===0)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};let r=Dt({colormap:e});return this.lookup={rendererJSON:t,colormapLut:r},this.canRenderInWebGL=pe(r?.indexedColormap),{success:!0}}_updateShadedReliefRenderer(t){if(!Gr(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(t.colorRamp){let e=_e(t.colorRamp,{interpolateAlpha:!0}),r=Dt({colormap:e}),i=Dr(r.indexedColormap);this.lookup={rendererJSON:t,colormapLut:r,hsvMap:i}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(t){let{attributeTable:e,pixelType:r}=this.rasterInfo,i=e!=null?e.fields.find(h=>h.name.toLowerCase()==="value"):null,o=e!=null?e.fields.find(h=>h.name.toLowerCase()===t.field.toLowerCase()):null,l=i!=null&&o!==null;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(r)||l,tableValueField:i,tableBreakField:o}}_updateClassBreaksRenderer(t){let{attributeTable:e}=this.rasterInfo,{canUseIndexedLUT:r,tableValueField:i,tableBreakField:o}=this._analyzeClassBreaks(t),l=t.classBreakInfos;if(!l?.length)return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};let h=l.sort((c,f)=>c.classMaxValue-f.classMaxValue),a=h[h.length-1],s=t.minValue;if(!r){let c=[];for(let f=0;f<h.length;f++)c.push({value:h[f].classMinValue??s,mappedColor:h[f].symbol.color}),s=h[f].classMaxValue;return c.push({value:a.classMaxValue,mappedColor:a.symbol.color}),this.lookup={rendererJSON:t,remapLut:c},this.canRenderInWebGL=!1,{success:!0}}let u=[];if(e!=null&&i!=null&&o!==null&&i!==o){let c=i.name,f=o.name,d=h[h.length-1],{classMaxValue:m}=d;s=t.minValue;for(let g of e.features){let S=g.attributes[c],C=g.attributes[f],I=C===m?d:C<s?null:h.find(({classMaxValue:v})=>v>C);I&&u.push([S].concat(I.symbol.color))}}else{s=Math.floor(t.minValue);for(let c=0;c<h.length;c++){let f=h[c];for(let d=s;d<f.classMaxValue;d++)u.push([d].concat(f.symbol.color));s=Math.ceil(f.classMaxValue)}a.classMaxValue===s&&u.push([a.classMaxValue].concat(a.symbol.color))}let n=Dt({colormap:u,fillUnspecified:!1});return this.lookup={rendererJSON:t,colormapLut:n},this.canRenderInWebGL=pe(n?.indexedColormap),{success:!0}}_updateStretchRenderer(t){let{stretchType:e,dra:r}=t;if(!(e==="none"||t.statistics?.length||zo(this.rasterInfo.statistics)||r))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};let i=t.histograms||this.rasterInfo.histograms;!_o(t.stretchType)||i?.length||r||(e="minMax");let{computeGamma:o,useGamma:l,colorRamp:h}=t,{gamma:a}=t;if(l&&o&&!a?.length){let n=t.statistics?.length?t.statistics:this.rasterInfo.statistics;a=wr(this.rasterInfo.pixelType,n)}let s=this.rasterInfo.pixelType,u=!r&&["u8","u16","s8","s16"].includes(s);if(e==="histogramEqualization"){let n=i.map(c=>Oe(c));this.lookup={rendererJSON:t,histogramLut:n}}else if(u){let n=Nt(t,{rasterInfo:this.rasterInfo}),c=De(et($({pixelType:s},n),{gamma:l?a:null,rounding:"floor"}));this.lookup={rendererJSON:t,stretchLut:c}}if(h&&!jo(h)){let n=_e(h,{interpolateAlpha:!0});this.lookup||(this.lookup={rendererJSON:t}),this.lookup.colormapLut=Dt({colormap:n}),this.lookup.rendererJSON=t}return this.lookup.gamma=l&&a?.length?a:null,this.canRenderInWebGL=!0,{success:!0}}_generateStretchWebGLParams(t,e,r){let i=null,o=null,l=this.lookup?.colormapLut;e.colorRamp&&l&&(i=l.indexedColormap,o=l.offset),e.stretchType==="histogramEqualization"&&(e=et($({},e),{stretchType:"minMax"}));let{gamma:h}=this.lookup,a=!(!e.useGamma||!h?.some(v=>v!==1)),{minCutOff:s,maxCutOff:u,outMin:n,outMax:c}=Nt(e,{rasterInfo:this.rasterInfo,pixelBlock:t,bandIds:r}),f=0;t!=null&&(f=t.getPlaneCount(),f===2&&((t=t.clone()).statistics=[t.statistics[0]],t.pixels=[t.pixels[0]]));let{bandCount:d}=this.rasterInfo,m=Math.min(3,r?.length||f||d,d),g=new Float32Array(m),S=i||a?1:255,C;for(C=0;C<s.length;C++)g[C]=u[C]===s[C]?0:(c-n)/(u[C]-s[C])/S;let I=new Float32Array(m);if(a&&h)for(C=0;C<m;C++)h[C]>1?h[C]>2?I[C]=6.5+(h[C]-2)**2.5:I[C]=6.5+100*(2-h[C])**4:I[C]=1;return{bandCount:m,outMin:n/S,outMax:c/S,minCutOff:s,maxCutOff:u,factor:g,useGamma:a,gamma:a?h:[1,1,1],gammaCorrection:a?I:[1,1,1],colormap:i,colormapOffset:o,stretchType:e.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(t,e=!1,r={x:0,y:0}){let i=null,o=null,l=this.lookup?.colormapLut;t.colorRamp&&l&&(i=l.indexedColormap,o=l.offset);let h=et($({},t),{isGCS:e,resolution:r}),a=Ve(h),s=this.rasterInfo.statistics?.[0];return et($({},a),{minValue:s?.min??0,maxValue:s?.max??8e3,hillshadeType:t.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:i,colormapOffset:o})}_generateVectorFieldWebGLParams(t){let{style:e,inputUnit:r,outputUnit:i,visualVariables:o,symbolTileSize:l,flowRepresentation:h}=t,a,s=this.rasterInfo.statistics?.[0].min??0,u=this.rasterInfo.statistics?.[0].max??50,n=o?.find(C=>C.type==="sizeInfo")??{type:"sizeInfo",field:"Magnitude",maxDataValue:u,maxSize:.8*l,minDataValue:s,minSize:.2*l},c=n.minDataValue??s,f=n.maxDataValue??u,d=n.maxSize!=null&&n.minSize!=null?[n.minSize/l,n.maxSize/l]:[.2,.8];if(e==="wind_speed"){let C=(d[0]+d[1])/2;d[0]=d[1]=C}let m=c!=null&&f!=null?[c,f]:null;if(e==="classified_arrow")if(c!=null&&f!=null&&n!=null){a=[];let C=(n.maxDataValue-n.minDataValue)/5;for(let I=0;I<6;I++)a.push(n.minDataValue+C*I)}else a=[0,1e-6,3.5,7,10.5,14];let g=h==="flow_to"==(e==="ocean_current_kn"||e==="ocean_current_m")?0:Math.PI,S=o?.find(C=>C.type==="rotationInfo");return{breakValues:a,dataRange:m,inputUnit:r,outputUnit:i,symbolTileSize:l,symbolPercentRange:d,style:e||"single_arrow",rotation:g,rotationType:this.rasterInfo.storageInfo?.tileInfo&&this.rasterInfo.dataType==="vector-uv"?"geographic":S?.rotationType||t.rotationType,type:"vectorField"}}};M([U({json:{write:!0}})],Lt.prototype,"rendererJSON",void 0),M([U({type:kr,json:{write:!0}})],Lt.prototype,"rasterInfo",void 0),M([U({json:{write:!0}})],Lt.prototype,"lookup",void 0),M([U()],Lt.prototype,"canRenderInWebGL",void 0),Lt=M([gt("esri.renderers.support.RasterSymbolizer")],Lt);var Ca=Lt;function _o(t){return t==="percentClip"||t==="histogramEqualization"}function zo(t){return t!=null&&t.length>0&&t[0].min!=null&&t[0].max!=null}function Br(t){return wt(t)&&t.validPixelCount!==0}function jo(t){return t.type==="algorithmic"&&["0,0,0,255","0,0,0"].includes(t.fromColor.join(","))&&["255,255,255,255","255,255,255"].includes(t.toColor.join(","))}export{lr as a,Pt as b,Wt as c,io as d,Re as e,le as f,hr as g,pr as h,so as i,lo as j,Li as k,Oi as l,Tr as m,kr as n,Bt as o,Ve as p,xr as q,Ir as r,Vn as s,_n as t,zn as u,jn as v,Yn as w,Mr as x,Mo as y,Do as z,Xn as A,Fo as B,_e as C,Dr as D,Zn as E,$n as F,Ur as G,Gr as H,Nr as I,ea as J,ra as K,oa as L,pe as M,Ni as N,br as O,De as P,Io as Q,ji as R,Po as S,Hi as T,Nt as U,vr as V,ue as W,Ca as X};
