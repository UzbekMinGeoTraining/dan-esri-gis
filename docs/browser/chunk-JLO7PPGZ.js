import{a as J,b as j,c as Q}from"./chunk-2F2E6NNR.js";import{a as z}from"./chunk-PY5WUUCV.js";import{b as k,d as Z}from"./chunk-OC7V2CEX.js";import{a as R,r as Y,v as $}from"./chunk-PXLEIVAM.js";import{a as D}from"./chunk-RRDM7P6F.js";import{i as q,j as P,l as X}from"./chunk-BDF7KEUQ.js";import{g as K,h as V}from"./chunk-SEKMXZL5.js";import{da as B}from"./chunk-4DLSYLKE.js";import{a as U}from"./chunk-B7IARA3F.js";import{Q as p,S as H}from"./chunk-GGZQ5GCM.js";import{U as S}from"./chunk-TFUPB3ZG.js";import{a}from"./chunk-BMVJCP2M.js";import{b as A,r as w}from"./chunk-3IBUFXWY.js";import{a as F}from"./chunk-BP73DJTS.js";import{a as O,b as L}from"./chunk-JEGVIFEP.js";var v=-1,d=class extends H{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=F("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(tt(t))}catch(e){this._transitionTo([]),w.getLogger(this).warn("Invalid Effect",{effect:t,error:e})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return this._to!==null}canTransitionTo(t){try{return this.scale>0&&et(this._current,tt(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&et(this._current,t,this.scale)?(this._final=t,this._to=A(t),_t(this._current,this._to,this.scale),this._from=A(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?A(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;let e=Math.min(1,this._time/this.duration);for(let i=0;i<this._current.length;i++){let o=this._current[i],s=this._from[i],u=this._to[i];o.scale=yt(s.scale,u.scale,e);for(let l=0;l<o.effects.length;l++){let h=o.effects[l],r=s.effects[l],c=u.effects[l];h.interpolate(r,c,e)}}e===1&&(this._current=this._final,this._set("effects",this._current[0]?A(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),this._current.length===0)return;let e=this._current,i=this._current.length-1,o,s,u=1;if(e.length===1||t>=e[0].scale)s=o=e[0].effects;else if(t<=e[i].scale)s=o=e[i].effects;else for(let l=0;l<i;l++){let h=e[l],r=e[l+1];if(h.scale>=t&&r.scale<=t){u=(t-h.scale)/(r.scale-h.scale),o=h.effects,s=r.effects;break}}for(let l=0;l<this.effects.length;l++)this.effects[l].interpolate(o[l],s[l],u)}};function tt(t){let e=z(t)||[];return Et(e)?[{scale:v,effects:e}]:e}function et(t,e,i){return!t[0]?.effects||!e[0]?.effects?!0:!((t[0]?.scale===v||e[0]?.scale===v)&&(t.length>1||e.length>1)&&i<=0)&&K(t[0].effects,e[0].effects)}function _t(t,e,i){let o=t.length>e.length?t:e,s=t.length>e.length?e:t,u=s[s.length-1],l=u?.scale??i,h=u?.effects??[];for(let r=s.length;r<o.length;r++)s.push({scale:l,effects:[...h]});for(let r=0;r<o.length;r++)s[r].scale=s[r].scale===v?i:s[r].scale,o[r].scale=o[r].scale===v?i:o[r].scale,V(s[r].effects,o[r].effects)}function yt(t,e,i){return t+(e-t)*i}function Et(t){let e=t[0];return!!e&&"type"in e}a([p()],d.prototype,"_to",void 0),a([p()],d.prototype,"duration",void 0),a([p({value:""})],d.prototype,"effect",null),a([p({readOnly:!0})],d.prototype,"effects",void 0),a([p({readOnly:!0})],d.prototype,"final",null),a([p({readOnly:!0})],d.prototype,"hasEffects",null),a([p({value:0})],d.prototype,"scale",null),a([p({readOnly:!0})],d.prototype,"transitioning",null),d=a([S("esri.layers.effects.EffectView")],d);var it,ot,st,rt,lt,nt,M,at,ht;(function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT",t[t.LABEL=4]="LABEL"})(it||(it={})),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LABEL=2]="LABEL",t[t.LABEL_ALPHA=4]="LABEL_ALPHA",t[t.HITTEST=8]="HITTEST",t[t.HIGHLIGHT=16]="HIGHLIGHT",t[t.CLIP=32]="CLIP",t[t.DEBUG=64]="DEBUG",t[t.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(ot||(ot={})),function(t){t[t.SIZE=0]="SIZE",t[t.COLOR=1]="COLOR",t[t.OPACITY=2]="OPACITY",t[t.ROTATION=3]="ROTATION"}(st||(st={})),function(t){t[t.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",t[t.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",t[t.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",t[t.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(rt||(rt={})),function(t){t[t.SPRITE=0]="SPRITE",t[t.GLYPH=1]="GLYPH"}(lt||(lt={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SIMPLE=1]="SIMPLE",t[t.DOT_DENSITY=2]="DOT_DENSITY",t[t.OUTLINE_FILL=3]="OUTLINE_FILL",t[t.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",t[t.HEATMAP=5]="HEATMAP",t[t.PIE_CHART=6]="PIE_CHART"}(nt||(nt={})),function(t){t[t.All=0]="All",t[t.Highlight=1]="Highlight",t[t.InsideEffect=2]="InsideEffect",t[t.OutsideEffect=3]="OutsideEffect"}(M||(M={})),function(t){t[t.BATCHING=0]="BATCHING",t[t.STRICT_ORDER=1]="STRICT_ORDER",t[t.STRICT_MARKERS_AND_TEXT=2]="STRICT_MARKERS_AND_TEXT"}(at||(at={})),function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT"}(ht||(ht={}));var ft={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{ref:t=>t.stencilRef,compare:q.EQUAL,mask:255,op:{fail:P.KEEP,zFail:P.KEEP,zPass:P.REPLACE}}}},Ot={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:!1},Lt=L(O({},ft),{color:{write:[!0,!0,!0,!0],blendMode:"delete"}});function St({pixelRatio:t,state:e,displayLevel:i,requiredLevel:o},s){let u=1/2**(i-s.key.level),l=1/2**(o-s.key.level);return{displayMat3:e.displayMat3,displayViewMat3:e.displayViewMat3,displayViewScreenMat3:s.transforms.displayViewScreenMat3,viewMat3:e.viewMat3,tileMat3:s.transforms.tileMat3,displayZoomFactor:u,requiredZoomFactor:l,tileOffset:[s.x,s.y],currentScale:e.scale,currentZoom:i,metersPerSRUnit:B(e.spatialReference),rotation:e.rotation,pixelRatio:t}}function pt(t){return t.passOptions?.type==="highlight"}function ut(t){return t.passOptions?.type==="hittest"}function Ct(t){if(!ut(t))return null;let{position:e,distance:i,smallSymbolDistance:o,smallSymbolSizeThreshold:s}=t.passOptions;return{position:e,distance:i,smallSymbolDistance:o,smallSymbolSizeThreshold:s}}function It(t){if(!pt(t))return null;let{activeReasons:e,highlightAll:i}=t.passOptions;return{activeReasons:e,highlightAll:i?1:0}}function qt(t,e,i){let o={};for(let s in i)i[s]instanceof Function?o[s]=i[s](t,e):o[s]=i[s];return o}function Xt(t,e){let{attributeView:i,context:o}=t;return{storage:i.getUniforms(o),view:St(t,e),hittestRequest:Ct(t),highlight:It(t)}}function Yt(t){return{inside:t.selection===M.InsideEffect,outside:t.selection===M.OutsideEffect}}function dt(t){return ut(t)?Ot:pt(t)&&t.passOptions.stepType==="clear"?Lt:ft}function $t(t){let{row:e,col:i}=t.key,o=i*512,s=e*512;return{tileOffsetFromLocalOrigin:[o%R,s%R],maxIntsToLocalOrigin:[Math.floor(o/R),Math.floor(s/R)]}}var Jt=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],jt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],C=256;var y=class extends H{constructor(t){super(t),this.color=J.clone(),this.haloOpacity=j,this.fillOpacity=Q}equals(t){return this.color.equals(t.color)&&(this.haloColor||this.color).equals(t.haloColor||t.color)&&this.haloOpacity===t.haloOpacity&&this.fillOpacity===t.fillOpacity}};a([p({type:D})],y.prototype,"color",void 0),a([p({type:D})],y.prototype,"haloColor",void 0),a([p()],y.prototype,"haloOpacity",void 0),a([p()],y.prototype,"fillOpacity",void 0),y=a([S("esri.views.support.HighlightOptions")],y);var gt=y;var W,T=W=class extends gt{constructor(t){super(t),this.haloWidth=2.1,this.haloBlur=.8/this.haloWidth}equals(t){return super.equals(t)&&this.haloWidth===t.haloWidth&&this.haloBlur===t.haloBlur}get optionsKey(){return`${this.color};${this.haloColor};${this.haloOpacity};${this.fillOpacity};${this.haloWidth};${this.haloBlur}`}clone(){return new W({color:this.color.clone(),haloColor:this.haloColor?.clone(),haloOpacity:this.haloOpacity,fillOpacity:this.fillOpacity,haloWidth:this.haloWidth,haloBlur:this.haloBlur})}};a([p()],T.prototype,"haloWidth",void 0),a([p()],T.prototype,"haloBlur",void 0),T=W=a([S("esri.views.2d.support.HighlightOptions")],T);var mt=T;var b=()=>w.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function Rt(t,e){e.fillColor[0]=t.color.r/255,e.fillColor[1]=t.color.g/255,e.fillColor[2]=t.color.b/255,e.fillColor[3]=t.color.a,t.haloColor?(e.outlineColor[0]=t.haloColor.r/255,e.outlineColor[1]=t.haloColor.g/255,e.outlineColor[2]=t.haloColor.b/255,e.outlineColor[3]=t.haloColor.a):(e.outlineColor[0]=e.fillColor[0],e.outlineColor[1]=e.fillColor[1],e.outlineColor[2]=e.fillColor[2],e.outlineColor[3]=e.fillColor[3]),e.fillColor[3]*=t.fillOpacity,e.outlineColor[3]*=t.haloOpacity,e.fillColor[0]*=e.fillColor[3],e.fillColor[1]*=e.fillColor[3],e.fillColor[2]*=e.fillColor[3],e.outlineColor[0]*=e.outlineColor[3],e.outlineColor[1]*=e.outlineColor[3],e.outlineColor[2]*=e.outlineColor[3],e.outlineWidth=(1-t.haloBlur)*t.haloWidth,e.outerHaloWidth=t.haloBlur*t.haloWidth/2,e.innerHaloWidth=t.haloBlur*t.haloWidth/2,e.outlinePosition=0}var vt=[0,0,0,0],I=class{constructor(){this.type="single",this._highlightOptions=new mt,this._convertedHighlightOptions={fillColor:[0,0,0,0],outlineColor:[0,0,0,0],outlinePosition:0,outlineWidth:0,innerHaloWidth:0,outerHaloWidth:0},this._optionsShadeTexKey="",this._texelData=new Uint8Array(4*C),this._minMaxDistance=[0,0]}setHighlightOptions(e){this._highlightOptions=e}applyHighlightOptions(e,i){this._updateGradientTexture(e),e.bindTexture(this._shadeTex,Y),i.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){this._shadeTex?.dispose(),this._shadeTex=null}getReasonsWithGradients(){return[{activeReasons:(1<<$)-1,activeGradient:this}]}_updateGradientTexture(e){let{optionsKey:i}=this._highlightOptions;if(i===this._optionsShadeTexKey)return;this._optionsShadeTexKey=i,Rt(this._highlightOptions,this._convertedHighlightOptions);let o=this._convertedHighlightOptions,s=o.outlinePosition-o.outlineWidth/2-o.outerHaloWidth,u=o.outlinePosition-o.outlineWidth/2,l=o.outlinePosition+o.outlineWidth/2,h=o.outlinePosition+o.outlineWidth/2+o.innerHaloWidth,r=Math.sqrt(Math.PI/2)*1,c=Math.abs(s)>r?Math.round(10*(Math.abs(s)-r))/10:0,m=Math.abs(h)>r?Math.round(10*(Math.abs(h)-r))/10:0,g;c&&!m?b().error("The outer rim of the highlight is "+c+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!c&&m?b().error("The inner rim of the highlight is "+m+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):c&&m&&b().error("The highlight is "+Math.max(c,m)+"px away from the edge of the feature; consider reducing some width values.");let n=[void 0,void 0,void 0,void 0];function E(f,G,_){n[0]=(1-_)*f[0]+_*G[0],n[1]=(1-_)*f[1]+_*G[1],n[2]=(1-_)*f[2]+_*G[2],n[3]=(1-_)*f[3]+_*G[3]}let{_texelData:x}=this;for(let f=0;f<C;++f)g=s+f/(C-1)*(h-s),g<s?(n[0]=0,n[1]=0,n[2]=0,n[3]=0):g<u?E(vt,o.outlineColor,(g-s)/(u-s)):g<l?[n[0],n[1],n[2],n[3]]=o.outlineColor:g<h?E(o.outlineColor,o.fillColor,(g-l)/(h-l)):[n[0],n[1],n[2],n[3]]=o.fillColor,x[4*f]=255*n[0],x[4*f+1]=255*n[1],x[4*f+2]=255*n[2],x[4*f+3]=255*n[3];if(this._minMaxDistance[0]=s,this._minMaxDistance[1]=h,!this._shadeTex){let f=new k;f.wrapMode=X.CLAMP_TO_EDGE,f.width=C,f.height=1,this._shadeTex=new Z(e,f)}this._shadeTex.updateData(0,0,0,C,1,this._texelData)}};var N=class{constructor(){this.type="multi",this.gradients=[]}setHighlightOptions(e){for(let i=0;i<e.length;i++)this.gradients[i]||(this.gradients[i]=new I),this.gradients[i].setHighlightOptions(e[i].options);for(let i=e.length+1;i<this.gradients.length;i++)this.gradients[i].destroy();this.gradients.length=e.length}destroy(){for(let e of this.gradients)e.destroy()}getReasonsWithGradients(){let e=1,i=[];for(let o=0;o<this.gradients.length;o++){let s=this.gradients[o];i.push({activeReasons:e,activeGradient:s}),e<<=1}return i}};var Mt=new U({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function Pe(t){return Mt.toJSON(t)}function Ne(t){let{bandCount:e,attributeTable:i,colormap:o,pixelType:s}=t.raster.rasterInfo;return e===1&&(i!=null||o!=null||s==="u8"||s==="s8")}function De(t,e){return e==null?(t?.destroy(),null):(t?.type==="single"&&Array.isArray(e)&&(t.destroy(),t=null),t?.type!=="multi"||Array.isArray(e)||(t.destroy(),t=null),t||(t=Array.isArray(e)?new N:new I),Array.isArray(e)?t.type==="multi"&&t.setHighlightOptions(e):t.type==="single"&&t.setHighlightOptions(e),t)}function We(t,e,i,o){let{painter:s,highlightGradient:u}=t,{highlight:l}=s.effects;if(!u)return;let h=t.passOptions,r=u.getReasonsWithGradients();for(let c=0;c<r.length;c++){let m=L(O({},t),{passOptions:{type:"highlight",activeGradient:o!=null?r[o].activeGradient:r[c].activeGradient,activeReasons:r[c].activeReasons,stepType:"burn",highlightAll:e}});if(l.bind(m),i(m),c<r.length-1){let n=0;for(let E=c+1;E<r.length;E++)n|=r[E].activeReasons;i(L(O({},t),{passOptions:{type:"highlight",activeGradient:o!=null?r[o].activeGradient:r[c].activeGradient,activeReasons:n,stepType:"clear",highlightAll:e}}))}let g=L(O({},t),{passOptions:{type:"highlight",activeGradient:o!=null?r[o].activeGradient:r[c].activeGradient,activeReasons:r[c].activeReasons,stepType:"draw",highlightAll:e}});s.setPipelineState(dt(t)),s.updatePipelineState(t.context),l.draw(g),l.unbind()}t.passOptions=h}export{d as a,ot as b,st as c,lt as d,M as e,at as f,ht as g,St as h,pt as i,ut as j,qt as k,Xt as l,Yt as m,dt as n,$t as o,Jt as p,jt as q,gt as r,mt as s,Pe as t,Ne as u,De as v,We as w};
