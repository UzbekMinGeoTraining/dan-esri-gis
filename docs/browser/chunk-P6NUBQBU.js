import{g as L}from"./chunk-NR6RKORG.js";import"./chunk-TOCNTYZ2.js";import"./chunk-7ZBDS6BA.js";import{a as _}from"./chunk-VMYCUJRH.js";import"./chunk-PTVRFY4B.js";import{a as y,e as j,g as P}from"./chunk-3ZOLHUAU.js";import{b as v,p as l}from"./chunk-7ISKCG7U.js";import"./chunk-OFGHVREP.js";import"./chunk-X7XJWAFC.js";import"./chunk-CYCLIMTY.js";import"./chunk-NH3JQE75.js";import"./chunk-XXOIKNT6.js";import"./chunk-DBLGLVAQ.js";import"./chunk-7KH77MT4.js";import"./chunk-I6LCIPDY.js";import"./chunk-Y6H3NTW7.js";import"./chunk-4RLJMQW4.js";import"./chunk-J6ZRC6RI.js";import"./chunk-EBGO44EK.js";import"./chunk-THY6AAMN.js";import"./chunk-7W6RATG7.js";import"./chunk-45SNVLPM.js";import"./chunk-BDF7KEUQ.js";import"./chunk-HWN5REN7.js";import"./chunk-B4JAL745.js";import"./chunk-XTES2GPX.js";import{d as h,o as f,p as g}from"./chunk-2HUIJUS4.js";import"./chunk-5MNDZ6BX.js";import"./chunk-3CR7P5WT.js";import"./chunk-YRTBL7EE.js";import"./chunk-3FPO2LOS.js";import"./chunk-QNZSBADV.js";import{a as c,b as p}from"./chunk-PYQRTZNZ.js";import"./chunk-5PTS4JDF.js";import{U as w}from"./chunk-TFUPB3ZG.js";import"./chunk-ANPNMGFG.js";import{a as E}from"./chunk-BMVJCP2M.js";import{l as x}from"./chunk-GMC3I5VG.js";import"./chunk-WGF2T2BG.js";import"./chunk-VEDIBGHD.js";import"./chunk-3IBUFXWY.js";import"./chunk-BP73DJTS.js";import{g as u}from"./chunk-JEGVIFEP.js";var I=1e3;function S(t,s,o){let n=v(),e=n;return f(e,e,t,.5),f(e,e,s,.5),n[3]=g(e,t),h(e,e,o),n}var b=class{constructor(){this._idToComponent=new Map,this._components=new _(t=>t.bounds),this._edges=new _(t=>t.bounds),this._tmpLineSegment=y(),this._tmpP1=c(),this._tmpP2=c(),this._tmpP3=c(),this.remoteClient=null}fetchCandidates(t,s){return u(this,null,function*(){yield Promise.resolve(),x(s),yield this._ensureEdgeLocations(t,s);let o=[];return this._edges.forEachNeighbor(n=>(this._addCandidates(t,n,o),o.length<I),t.bounds),{result:{candidates:o}}})}_ensureEdgeLocations(t,s){return u(this,null,function*(){let o=[];if(this._components.forEachNeighbor(i=>{if(i.info==null){let{id:a,uid:r}=i;o.push({id:a,uid:r})}return!0},t.bounds),!o.length)return;let n={components:o},e=yield this.remoteClient.invoke("fetchAllEdgeLocations",n,s??{});for(let i of e.components)this._setFetchEdgeLocations(i)})}add(t){return u(this,null,function*(){let s=new A(t.id,t.bounds);return this._idToComponent.set(s.id,s),this._components.add([s]),{result:{}}})}remove(t){return u(this,null,function*(){let s=this._idToComponent.get(t.id);if(s){let o=[];this._edges.forEachNeighbor(n=>(n.component===s&&o.push(n),!0),s.bounds),this._edges.remove(o),this._components.remove([s]),this._idToComponent.delete(s.id)}return{result:{}}})}_setFetchEdgeLocations(t){let s=this._idToComponent.get(t.id);if(s==null||t.uid!==s.uid)return;let o=L.createView(t.locations),n=new Array(o.count),e=c(),i=c();for(let d=0;d<o.count;d++){o.position0.getVec(d,e),o.position1.getVec(d,i);let m=S(e,i,t.origin),T=new C(s,d,m);n[d]=T}this._edges.add(n);let{objectIds:a,origin:r}=t;s.info={locations:o,objectIds:a,origin:r}}_addCandidates(t,s,o){let{info:n}=s.component,{origin:e,objectIds:i}=n,a=n.locations,r=a.position0.getVec(s.index,this._tmpP1),d=a.position1.getVec(s.index,this._tmpP2);h(r,r,e),h(d,d,e);let m=i[a.componentIndex.get(s.index)];this._addEdgeCandidate(t,m,r,d,o),V(t,m,r,o),V(t,m,d,o)}_addEdgeCandidate(t,s,o,n,e){if(!t.returnEdge)return;let i=t.bounds,a=j(o,n,this._tmpLineSegment),r=P(a,i,this._tmpP3);l(t.bounds,r)&&e.push({type:"edge",objectId:s,target:p(r),distance:g(i,r),start:p(o),end:p(n)})}};b=E([w("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],b);var Y=b;function V(t,s,o,n){if(!t.returnVertex||!l(t.bounds,o))return;let e=t.bounds;n.push({type:"vertex",objectId:s,target:p(o),distance:g(e,o)})}var A=(()=>{class t{constructor(o,n){this.id=o,this.bounds=n,this.info=null,this.uid=++t.uid}}return t.uid=0,t})(),C=class{constructor(s,o,n){this.component=s,this.index=o,this.bounds=n}};export{Y as default};
