import{a as Rt}from"./chunk-QCDIRHTH.js";import{a as v}from"./chunk-XRVFK5TR.js";import{c as ht,e as X,f as _,g as k,h as xt,i as wt,j as bt}from"./chunk-PVCDKA4D.js";import{c as ut,d as O}from"./chunk-CY477QBZ.js";import{c as I,g as W,h as q,r as L}from"./chunk-FW33MEBA.js";import{a as u,c as dt}from"./chunk-HWN5REN7.js";import{a as ft,b as m,c as mt,d as D,g as A,k as J,m as yt,n as Q,o as pt,p as gt,s as T,y as U}from"./chunk-XTES2GPX.js";import{a as ct}from"./chunk-OFZ6SV37.js";import{f as E}from"./chunk-Q5WFUDPQ.js";import{c as lt}from"./chunk-QNZSBADV.js";import{c as rt}from"./chunk-VQHENXDQ.js";import{h as st}from"./chunk-5PTS4JDF.js";import{a as V,l as B,y as C}from"./chunk-N27U3N2T.js";import{a as it}from"./chunk-NDYVXEZ5.js";import{B as F,da as ot,m as z,n as at}from"./chunk-4DLSYLKE.js";import{a as nt}from"./chunk-GZXWFBZI.js";import{h as et}from"./chunk-2JF6YUJG.js";import{Q as S}from"./chunk-GGZQ5GCM.js";import{U as tt}from"./chunk-TFUPB3ZG.js";import{a as R}from"./chunk-BMVJCP2M.js";import{g as P}from"./chunk-JEGVIFEP.js";var K,x=K=class extends et{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new K({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};R([S({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:H}}}}})],x.prototype,"rotation",void 0),R([nt("rotation")],x.prototype,"castRotation",null),R([S({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:H}}}}})],x.prototype,"scale",void 0),R([S({types:ct,json:{read:E,write:!0,origins:{"web-scene":{read:E,write:{overridePolicy:H}}}}})],x.prototype,"targetGeometry",void 0),R([S({type:Rt,json:{write:!0}})],x.prototype,"camera",void 0),x=K=R([tt("esri.Viewpoint")],x);var N=x;function H(){return{enabled:!this.camera}}var St=96,At=39.37,Ft=180/Math.PI;function vt(t){return t.wkid?t:t.spatialReference||it.WGS84}function Y(t,e){return e.type?m(t,e.x,e.y):ft(t,e)}function Mt(t){return ot(t)}function jt(t,e,r=0){let n=t.width,a=t.height;if(r!==0){let s=st(r),l=Math.abs(Math.cos(s)),c=Math.abs(Math.sin(s));n=t.width*l+t.height*c,a=t.width*c+t.height*l}let o=Math.max(1,e[0]),i=Math.max(1,e[1]);return Math.max(n/o,a/i)*Wt(t.spatialReference)}function M(t,e,r,n){return P(this,null,function*(){let a,o;if(!t||Array.isArray(t)&&!t.length)return null;if(rt.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){let s=t.every(p=>"attributes"in p),l=t.some(p=>!p.geometry),c=t;if(s&&l&&e&&e.allLayerViews){let p=new Map;for(let f of t){let y=f.layer,G=p.get(y)||[],h=f.attributes[y.objectIdField];h!=null&&G.push(h),p.set(y,G)}let d=[];p.forEach((f,y)=>{let G=e.allLayerViews.find(h=>h.layer.id===y.id);if(G&&"queryFeatures"in G){let h=y.createQuery();h.objectIds=f,h.returnGeometry=!0,d.push(G.queryFeatures(h))}});let b=yield Promise.all(d),g=[];for(let f of b)if(f&&f.features&&f.features.length)for(let y of f.features)y.geometry!=null&&g.push(y.geometry);c=g}for(let p of c)n=yield M(p,e,r,n);return n}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")a=new B(t);else if(t instanceof V)a=t;else if("geometry"in t){if(t.geometry)a=t.geometry;else if(t.layer){let s=t.layer,l=e.allLayerViews.find(c=>c.layer.id===s.id);if(l&&"queryFeatures"in l){let c=s.createQuery();c.objectIds=[t.attributes[s.objectIdField]],c.returnGeometry=!0,a=(yield l.queryFeatures(c))?.features?.[0]?.geometry}}}if(a==null)return null;switch(a.type){case"point":o=new C({xmin:a.x,ymin:a.y,xmax:a.x,ymax:a.y,spatialReference:a.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":o=ut(a);break;default:o=a.extent}if(!o)return null;I()||L(o.spatialReference,r)||(yield W());let i=q(o,r);if(!i)return null;if(n){let s=i.center,l=s.clone();l.x=O(s.x,n.center.x,r),l.x!==s.x&&i.centerAt(l),n=n.union(i)}else n=i;return n})}function Vt(t){if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&t.layer?.minScale!=null&&t.layer.maxScale!=null){let e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every(e=>"layer"in e)){let e=0,r=0;for(let n of t){let a=n.layer;a?.minScale&&a.maxScale&&(e=a.minScale<e?a.minScale:e,r=a.maxScale>r?a.maxScale:r)}return e&&r?{min:e,max:r}:null}}}function Gt(t,e){let r=vt(t);return z(r,e)||r.imageCoordinateSystem||e.imageCoordinateSystem?t:q(t,e)}function we(t,e){return P(this,null,function*(){if(!t||!e)return new N({targetGeometry:new B,scale:0,rotation:0});let r=e.spatialReference,{constraints:n,padding:a,viewpoint:o,size:i}=e,s=[a?i[0]-a.left-a.right:i[0],a?i[1]-a.top-a.bottom:i[1]],l=null;t instanceof N?l=t:t.viewpoint?l=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(l=t.target);let c=null;l?.targetGeometry?c=l.targetGeometry:t instanceof C?c=t:t instanceof V?c=yield M(t,e,r):t&&(c=(yield M(t.center,e,r))||(yield M(t.target,e,r))||(yield M(t,e,r))),!c&&o?.targetGeometry?c=o.targetGeometry:!c&&e.extent&&(c=e.extent),r||(r=vt(e.spatialReference||e.extent||c)),I()||z(c.spatialReference,r)||L(c.spatialReference,r)||(yield W());let p=Gt(c,r),d="center"in p?p.center:p;e.pickClosestTarget!==!1&&d.type==="point"&&o.targetGeometry?.type==="point"&&(d.x=O(d.x,o.targetGeometry.x,d.spatialReference));let b=0;l?b=l.rotation:t.hasOwnProperty("rotation")?b=t.rotation:o&&(b=o.rotation);let g=0;g=l?.targetGeometry!=null&&l.targetGeometry.type==="point"?l.scale:"scale"in t&&t.scale?t.scale:"zoom"in t&&t.zoom!==-1&&n&&n.effectiveLODs?n.zoomToScale(t.zoom):Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0?o.scale:jt(Gt(c.extent,r),s,b);let f=Vt(t.target??t);f&&(f.min&&f.min<g?g=f.min:f.max&&f.max>g&&(g=f.max));let y=new N({targetGeometry:d,scale:g,rotation:b});return n&&(y=n.fit(y),n.constrainByGeometry(y),n.rotationEnabled||(y.rotation=o.rotation)),y})}function w(t,e){let r=t.targetGeometry,n=e.targetGeometry;return r.x=n.x,r.y=n.y,r.spatialReference=n.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function Bt(t,e,r){return r?m(t,.5*(e[0]-r.right+r.left),.5*(e[1]-r.bottom+r.top)):A(t,e,.5)}var be=function(){let t=u();return function(e,r,n){let a=r.targetGeometry;Y(t,a);let o=.5*j(r);return e.xmin=t[0]-o*n[0],e.ymin=t[1]-o*n[1],e.xmax=t[0]+o*n[0],e.ymax=t[1]+o*n[1],e.spatialReference=a.spatialReference,e}}();function Re(t,e,r,n,a){return Ot(t,e,r.center),t.scale=jt(r,n),a?.constraints?.constrain(t),t}function Ct(t,e,r,n){return Nt(t,e,r,n),ht(t,t)}var Tt=function(){let t=u();return function(e,r,n){return U(e,qt(e,r),Bt(t,r,n))}}(),Et=function(){let t=v(),e=u();return function(r,n,a,o){let i=j(n),s=Z(n);return m(e,i,i),wt(t,e),X(t,t,s),k(t,t,Tt(e,a,o)),k(t,t,[0,o.top-o.bottom]),m(r,t[4],t[5])}}();function j(t){return t.scale*It(t.targetGeometry?.spatialReference)}function It(t){return t!=null&&F(t)?1/(Mt(t)*At*St):1}function Z(t){return lt(t.rotation)||0}function Wt(t){return F(t)?Mt(t)*At*St:1}function qt(t,e){return A(t,e,.5)}var kt=function(){let t=u(),e=u(),r=u();return function(n,a,o,i,s,l){return yt(t,a),A(e,o,.5*l),m(r,1/i*l,-1/i*l),bt(n,e),s&&X(n,n,s),_(n,n,r),k(n,n,t),n}}(),Nt=function(){let t=u();return function(e,r,n,a){let o=j(r),i=Z(r);return Y(t,r.targetGeometry),kt(e,t,n,o,i,a)}}(),Ge=function(){let t=u();return function(e,r,n,a){let o=j(r);return Y(t,r.targetGeometry),kt(e,t,n,o,0,a)}}();function Lt(t){let e=at(t);return e?e.valid[1]-e.valid[0]:0}function Se(t,e){return Math.round(Lt(t)/e)}var Ae=function(){let t=u(),e=u(),r=[0,0,0];return function(n,a,o){D(t,n,a),Q(t,t),D(e,n,o),Q(e,e),gt(r,t,e);let i=Math.acos(pt(t,e)/(J(t)*J(e)))*Ft;return r[2]<0&&(i=-i),isNaN(i)&&(i=0),i}}(),ve=function(){let t=u();return function(e,r,n,a){let o=e.targetGeometry;return w(e,r),Et(t,r,n,a),o.x+=t[0],o.y+=t[1],e}}(),Ot=function(t,e,r){w(t,e);let n=t.targetGeometry;return n.x=r.x,n.y=r.y,n.spatialReference=r.spatialReference,t},Me=function(){let t=u();return function(e,r,n,a,o){o||(o="center"),U(t,n,a),A(t,t,.5);let i=t[0],s=t[1];switch(o){case"center":m(t,0,0);break;case"left":m(t,-i,0);break;case"top":m(t,0,s);break;case"right":m(t,i,0);break;case"bottom":m(t,0,-s);break;case"top-left":m(t,-i,s);break;case"bottom-left":m(t,-i,-s);break;case"top-right":m(t,i,s);break;case"bottom-right":m(t,i,-s)}return $(e,r,t),e}}();function je(t,e,r){return w(t,e),t.rotation+=r,t}function Te(t,e,r){return w(t,e),t.rotation=r,t}var Dt=function(){let t=u();return function(e,r,n,a,o){return w(e,r),isNaN(n)||n===0||(Pt(t,a,r,o),e.scale=r.scale*n,zt(t,t,e,o),$(e,e,m(t,t[0]-a[0],a[1]-t[1]))),e}}();function ke(t,e,r){return w(t,e),t.scale=r,t}var Jt=function(){let t=u();return function(e,r,n,a,o,i){return w(e,r),isNaN(n)||n===0||(Pt(t,o,r,i),e.scale=r.scale*n,e.rotation+=a,zt(t,t,e,i),$(e,e,m(t,t[0]-o[0],o[1]-t[1]))),e}}(),Ne=function(){let t=u(),e=u();return function(r,n,a,o,i,s,l){return Tt(e,s,l),mt(t,i,e),o?Jt(r,n,a,o,t,s):Dt(r,n,a,t,s)}}(),Pt=function(){let t=v();return function(e,r,n,a){return T(e,r,Ct(t,n,a,1))}}(),zt=function(){let t=v();return function(e,r,n,a){return T(e,r,Nt(t,n,a,1))}}(),$=function(){let t=u(),e=v();return function(r,n,a){w(r,n);let o=j(n),i=r.targetGeometry;return xt(e,Z(n)),_(e,e,dt(o,o)),T(t,a,e),i.x+=t[0],i.y+=t[1],r}}();export{N as a,jt as b,we as c,w as d,Bt as e,be as f,Re as g,Tt as h,j as i,It as j,kt as k,Nt as l,Ge as m,Lt as n,Se as o,Ae as p,ve as q,Ot as r,Me as s,je as t,Te as u,ke as v,Jt as w,Ne as x,$ as y};
