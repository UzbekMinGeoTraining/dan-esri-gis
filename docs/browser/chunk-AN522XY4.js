import{i as rn}from"./chunk-DI7IQ2JQ.js";import{a as nn}from"./chunk-KCNSUZFF.js";import{a as en}from"./chunk-FPZYH52G.js";import{a as ee}from"./chunk-B7GIKKEW.js";import{v as _e}from"./chunk-PXLEIVAM.js";import{a as tn}from"./chunk-AYOI2Y26.js";import{a as Qr}from"./chunk-EBGO44EK.js";import{a as Yr}from"./chunk-MBJHSEMD.js";import{Q as er,S as Jr}from"./chunk-GGZQ5GCM.js";import{U as Xr}from"./chunk-TFUPB3ZG.js";import{a as s,b as x}from"./chunk-BMVJCP2M.js";import{h as Wr,n as Zr,r as At,t as Fe}from"./chunk-3IBUFXWY.js";import{a as Ie}from"./chunk-BP73DJTS.js";import{a as b,b as Pt}from"./chunk-JEGVIFEP.js";var on;(function(e){e[e.AnimatedMarker=0]="AnimatedMarker",e[e.Blend=1]="Blend",e[e.ComplexFill=2]="ComplexFill",e[e.ComplexOutlineFill=3]="ComplexOutlineFill",e[e.DotDensity=4]="DotDensity",e[e.Fill=5]="Fill",e[e.Grid=6]="Grid",e[e.Heatmap=7]="Heatmap",e[e.Label=8]="Label",e[e.Line=9]="Line",e[e.Magnifier=10]="Magnifier",e[e.Marker=11]="Marker",e[e.OutlineFill=12]="OutlineFill",e[e.Overlay=13]="Overlay",e[e.PatternFill=14]="PatternFill",e[e.PatternOutlineFill=15]="PatternOutlineFill",e[e.PieChart=16]="PieChart",e[e.Test=17]="Test",e[e.Text=18]="Text",e[e.TexturedLine=19]="TexturedLine"})(on||(on={}));var sn;(function(e){e[e.Geographic=0]="Geographic",e[e.Arithmatic=1]="Arithmatic"})(sn||(sn={}));var fo=3.14159265359/180,an=3.14159265359/128,yo=180/3.141592654,go=1/8;var vo=1,un=1.1,ln=1,bo=1/4,xo=1/8;var wo=24,So=8;var cn=1e-5,rr=.05;var pn=1e-30;var dn=4;var mn=0,hn=2,To=2,Vo=3,Io=0,Fo=3,fn=16777216,_o=1.1;var yn;(function(e){e.Local="Local",e.Global="Global"})(yn||(yn={}));var bt=class{generateSource(t){let r=[];for(let o=1;o<this.length;o++)r.push(`vec4 atom${o} = texture(${t.animationTexture}, (pointer + 0.5) / size);`),r.push("pointer.x += 1.0;");for(let o=0;o<this.ins;o++)r.push("top--;"),r.push(`vec4 in${this.ins-o-1} = stack[top];`);for(let o=0;o<this.outs;o++)r.push(`vec4 out${o};`);let{microcode:n}=this;for(let o of n)r.push(o);for(let o=0;o<this.outs;o++)r.push(`stack[top] = out${o};`),r.push("top++;"),r.push(`if (top >= ${lr}) { top = ${lr-1}; }`);return r}},kt=128,nr=class extends bt{constructor(){super(...arguments),this.opcode=++kt,this.length=1,this.ins=0,this.outs=0,this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}},or=class extends bt{constructor(){super(...arguments),this.opcode=++kt,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(t){return[[this.opcode,t,0,0]]}},ir=class extends bt{constructor(){super(...arguments),this.opcode=++kt,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.yzw, 0.0);"]}encode(t){return[[this.opcode,t[0]||0,t[1]||0,t[2]||0]]}},sr=class extends bt{constructor(){super(...arguments),this.opcode=++kt,this.length=2,this.ins=0,this.outs=1,this.microcode=["out0 = atom1;"]}encode(t){return[[this.opcode,0,0,0],t]}};function re(e){return[`float duration = clamp(${e.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${e.startTimeOffset};`,`float repeatDelay = ${e.repeatDelay};`,`float timeOriginSelector = ${e.timeOriginSelector};`,`float repeatType = ${e.repeatType};`,`float easing = ${e.easing};`,`float playAnimation = ${e.playAnimation} * (1.0 - step(0.0, -${e.duration}));`,`float reverseAnimation = ${e.reverseAnimation};`,"float time = globalTime - (timeOriginSelector == 1.0 ? localTimeOrigin : 0.0);","time *= playAnimation;","time *= 1.0 - reverseAnimation * 2.0;","float period = duration + repeatDelay;","time += reverseAnimation == 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega = time / period;","float oi = floor(omega);","omega = repeatType == 1.0 || repeatType == 3.0 ? omega - oi : omega;","float of = omega * period;","of = (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of = easing == 2.0 ? pow(of, 3.0) : of;","of = easing == 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of = easing == 4.0 ? of < 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate = repeatType == 3.0 && mod(oi, 2.0) == 1.0;",`${e.out} = oscillate ? 1.0 - of : of;`]}var Un={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},Rn={Loop:1,None:2,Oscillate:3},Bn={Local:1,Global:2};function ne(e){let t=Un[e.easing],r=Rn[e.repeatType],n=Bn[e.timeOriginSelector];return[[e.duration,e.startTimeOffset,e.repeatDelay,n],[r,t,e.playAnimation,e.reverseAnimation]]}var ar=class extends bt{constructor(){super(...arguments),this.opcode=++kt,this.length=10,this.ins=1,this.outs=1,this.microcode=["vec2 fromTranslation = atom1.xy;","vec2 toTranslation = atom1.zw;","float fromRotation = atom2.x;","float toRotation = atom2.y;","float fromScale = atom2.z;","float toScale = atom2.w;","bool relativeTranslation = atom9.x == 1.0;","bool absoluteScale = atom9.y == 1.0;","vec2 translationMultiplier = relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor = absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...re({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...re({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...re({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation = mix(fromTranslation, toTranslation, fTranslation);","float aRotation = mix(fromRotation, toRotation, fRotation);","float aScale = mix(fromScale, toScale, fScale);","vec2 pTranslation = in0.xy;","float pRotation = in0.z;","float pScale = in0.w;","aTranslation *= translationMultiplier;","aScale /= scaleDivisor;","float rotation = pRotation + aRotation;","float scale = pScale * aScale;","float sin1 = sin(pRotation);","float cos1 = cos(pRotation);","float s1 = pScale;","float x1 = pTranslation.x;","float y1 = pTranslation.y;","float x2 = aTranslation.x;","float y2 = aTranslation.y;",`
    vec2 translation = vec2(
      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,
      sin1 * s1 * x2 + cos1 * s1 * y2 + y1
    );
    `,"out0 = vec4(translation, rotation, scale);"]}encode(t){return[[this.opcode,0,0,0],[t.translation.from[0],t.translation.from[1],t.translation.to[0],t.translation.to[1]],[t.rotation.from,t.rotation.to,t.scale.from,t.scale.to],...ne(t.translation.timing),...ne(t.rotation.timing),...ne(t.scale.timing),[t.relativeTranslation?1:0,t.absoluteScale?1:0,0,0]]}},ur=class extends bt{constructor(){super(...arguments),this.opcode=++kt,this.length=7,this.ins=1,this.outs=1,this.microcode=["float fromOpacity = atom0.y;","float toOpacity = atom0.z;","vec4 fromColor = atom1;","vec4 toColor = atom2;","float fColor;","{",...re({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...re({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor = mix(fromColor, toColor, fColor);","aColor.a *= mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor = in0;","out0 = aColor * pColor;"]}encode(t){return[[this.opcode,t.opacity.from,t.opacity.to,0],[t.color.from[0],t.color.from[1],t.color.from[2],t.color.from[3]],[t.color.to[0],t.color.to[1],t.color.to[2],t.color.to[3]],...ne(t.color.timing),...ne(t.opacity.timing)]}},gn={scalar:new or,vector3:new ir,vector4:new sr,animatedTransform:new ar,animatedColor:new ur,ret:new nr},Ln=40,lr=4;function Oo(e){let t=[];t.push(`float globalTime = ${e.globalTime};`),t.push(`float localTimeOrigin = ${e.localTimeOrigin};`),t.push(`vec2 pointer = ${e.animationPointer};`),t.push(`vec2 size = ${e.animationTextureSize};`),t.push("int top = 0;"),t.push(`vec4 stack[${lr}];`),t.push(`for (int counter = 0; counter < ${Ln}; counter++) {`),t.push(`vec4 atom0 = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;"),t.push(`vec2 pixelDimensions = ${e.pixelDimensions};`),t.push("if (false) {");for(let r in gn){let n=gn[r];t.push(`} else if (int(atom0.x) == ${n.opcode}) {`);for(let o of n.generateSource(e))t.push(o)}return t.push("} // End if-else."),t.push("} // End for."),t.push(`${e.out} = top > 0 ? stack[top - 1] : vec4(0.0);`),t.join(`
`)}var Do={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}};function Hn(e){return e.split(" ").map((t,r)=>r>0?t.charAt(0).toUpperCase()+t.slice(1):t).join("")}function vn(e,t){let r=[];for(r.push(t);r.length;){let n=r.pop();if(typeof n=="object"&&!e.has(n.uid)){e.add(n.uid);for(let o of n.children)r.push(o)}}}var dt=class e{constructor(){this.uid=e.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=Hn(t),this._debugName=t,this.isImplicit&&this.children[0]instanceof e&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(t){t._debugName=this._debugName,t._isMutable=this._isMutable,t.isImplicit=this.isImplicit,t.uid=this.uid}};function d(e){return typeof e=="object"?e.clone():e}dt.NodeCount=0;var _=class extends dt{constructor(){super(...arguments),this.shaderType="primitive-node"}},$e=class e extends dt{constructor(t){super(),this.child=t,this.shaderType="scope-node"}get children(){return[this.child]}clone(){let t=new e(d(this.child));return this.cloneInto(t),t}};var Oe=class e extends dt{constructor(t,r,n){super(),this.property=t,this.target=r,this.returnType=n,this.shaderType="property-access-node"}get children(){let t=[this.target];return typeof this.property!="string"&&t.push(this.property),t}clone(){let t=new e(this.property,d(this.target),this.returnType);return this.cloneInto(t),t}},Ce=class e extends dt{constructor(t,r,n){super(),this.condition=t,this.ifTrue=r,this.ifFalse=n,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){let t=d(this.ifTrue),r=this.ifFalse?d(this.ifFalse):null,n=new e(this.condition,t,r);return this.cloneInto(n),n}},Pe=class e extends dt{constructor(t,r,n,o){super(),this.captureList=t,this.returnType=r,this.generator=o,this.shaderType="block-node",n&&(this.subgraph=new $e(n))}get children(){return Object.keys(this.captureList).map(t=>this.captureList[t]).concat(this.subgraph??[])}clone(){let t={};for(let n in this.captureList)t[n]=d(this.captureList[n]);let r=new e(t,this.returnType,this.subgraph?d(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(r),r}},it=class e extends dt{constructor(t,r,n,o,i,a=!1){super(),this.token=t,this._children=r,this.isInfix=n,this.isPropertyAccess=o,this.returnType=i,this.isTernary=a,this.shaderType="function-node"}get children(){return this._children}clone(){let t=new e(this.token,this._children.map(d),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}};var oe,cr,pr,dr,mr,hr,fr,yr,gr,vr,br,xr,wr,Sr;function Gn(e){let t=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(let r of t)if(r.includes(e))return r.map(n=>qn[n]);throw new Error("Unable to find type family")}function bn(e){return new Proxy(e,{get(t,r){if(r==="constructor")return new Proxy(t.constructor,{construct:(n,o,i)=>bn(new n(...o))});if(r in t)return t[r];if(typeof r=="string"){let n=Gn(e.type);return R(e,r,n[r.length-1])}}})}function B(e){return new Proxy(e,{construct:(t,r,n)=>bn(new t(...r))})}function Kn(e){return new Proxy(e,{get(t,r){if(r in t)return t[r];if(typeof r=="string"){let n=parseInt(r,10);if(!isNaN(n))return R(e,`[${n}]`,e.elementType.constructor)}}})}function jn(e){return new Proxy(e,{construct:(t,r,n)=>Kn(new t(...r))})}var ie=class extends Error{},E=oe=class extends _{constructor(e,t){super(),this.elementType=e,this.size=t,this.children=[],this.type="array"}clone(){let e=new oe(this.elementType,this.size);return super.cloneInto(e),e}get(e){if(typeof e=="number"){let t=new xt(e);return t.isImplicit=!0,R(this,t,this.elementType.constructor)}return R(this,e,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(e,t,r){return Wn(this,e,t,r)}glslFindIndex(e,t,r){return Zn(this,e,t,r)}static ofType(e,t){let r={construct:(n,o)=>new oe(new e,t)};return new Proxy(oe,r)}};E.type="array",E=oe=s([jn],E);var Y=(()=>{class e extends _{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){let r=new e;return r.children=this.children.map(d),super.cloneInto(r),r}}return e.type="sampler2D",e})(),u=(()=>{class e extends _{constructor(r){super(),this.type="float",this.children=[r]}clone(){let r=new e(d(this.children[0]));return super.cloneInto(r),r}multiply(r){return ht(this,typeof r=="number"?O(r,e):r)}divide(r){return Rt(this,typeof r=="number"?O(r,e):r)}add(r){return Bt(this,typeof r=="number"?O(r,e):r)}subtract(r){return ae(this,typeof r=="number"?O(r,e):r)}}return e.type="float",e})(),y=cr=class extends _{constructor(e,t){super(),this.type="vec2",this.children=[e,t].filter(r=>r!=null)}clone(){let e=new cr(d(this.children[0]),d(this.children[1]));return super.cloneInto(e),e}get 0(){return R(this,"[0]",u)}get 1(){return R(this,"[1]",u)}get 2(){throw new ie}get 3(){throw new ie}multiply(e){return ht(this,typeof e=="number"?O(e,u):e)}divide(e){return Rt(this,typeof e=="number"?O(e,u):e)}add(e){return Bt(this,typeof e=="number"?O(e,u):e)}subtract(e){return ae(this,typeof e=="number"?O(e,u):e)}};y.type="vec2",y=cr=s([B],y);var V=pr=class extends _{constructor(e,t,r){super(),this.type="vec3",this.children=[e,t,r].filter(n=>n!=null)}get 0(){return R(this,"[0]",u)}get 1(){return R(this,"[1]",u)}get 2(){return R(this,"[2]",u)}get 3(){throw new ie}clone(){let e=new pr(d(this.children[0]),d(this.children[1]),d(this.children[2]));return super.cloneInto(e),e}multiply(e){return ht(this,typeof e=="number"?O(e,u):e)}divide(e){return Rt(this,typeof e=="number"?O(e,u):e)}add(e){return Bt(this,typeof e=="number"?O(e,u):e)}subtract(e){return ae(this,typeof e=="number"?O(e,u):e)}};V.type="vec3",V=pr=s([B],V);var v=dr=class extends _{constructor(e,t,r,n){super(),this.type="vec4",this.children=[e,t,r,n].filter(o=>o!=null)}clone(){let e=new dr(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]));return super.cloneInto(e),e}get 0(){return R(this,"[0]",u)}get 1(){return R(this,"[1]",u)}get 2(){return R(this,"[2]",u)}get 3(){return R(this,"[3]",u)}multiply(e){return ht(this,typeof e=="number"?O(e,u):e)}divide(e){return Rt(this,typeof e=="number"?O(e,u):e)}add(e){return Bt(this,typeof e=="number"?O(e,u):e)}subtract(e){return ae(this,typeof e=="number"?O(e,u):e)}};v.type="vec4",v=dr=s([B],v);var De=mr=class extends _{constructor(e){super(),this.type="uint",this.children=[e]}clone(){let e=new mr(d(this.children[0]));return super.cloneInto(e),e}};De.type="uint",De=mr=s([B],De);var Ne=hr=class extends _{constructor(e,t){super(),this.type="uvec2",this.children=[e,t].filter(r=>r!=null)}clone(){let e=new hr(d(this.children[0]),d(this.children[1]));return super.cloneInto(e),e}};Ne.type="uvec2",Ne=hr=s([B],Ne);var Me=fr=class extends _{constructor(e,t,r){super(),this.type="uvec3",this.children=[e,t,r].filter(n=>n!=null)}clone(){let e=new fr(d(this.children[0]),d(this.children[1]),d(this.children[2]));return super.cloneInto(e),e}};Me.type="uvec3",Me=fr=s([B],Me);var ze=yr=class extends _{constructor(e,t,r,n){super(),this.type="uvec4",this.children=[e,t,r,n].filter(o=>o!=null)}clone(){let e=new yr(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]));return super.cloneInto(e),e}};ze.type="uvec4",ze=yr=s([B],ze);var q=(()=>{class e extends _{constructor(r){super(),this.type="bool",this.children=[r]}and(r){return Le(this,r)}or(r){return Ir(this,r)}clone(){let r=new e(d(this.children[0]));return super.cloneInto(r),r}}return e.type="bool",e})(),Ee=gr=class extends _{constructor(e,t){super(),this.type="bvec2",this.children=[e,t].filter(r=>r!=null)}all(){return Fr(this)}any(){return _r(this)}clone(){let e=new gr(d(this.children[0]),d(this.children[1]));return super.cloneInto(e),e}};Ee.type="bvec2",Ee=gr=s([B],Ee);var Ae=vr=class extends _{constructor(e,t,r){super(),this.type="bvec3",this.children=[e,t,r].filter(n=>n!=null)}all(){return Fr(this)}any(){return _r(this)}clone(){let e=new vr(d(this.children[0]),d(this.children[1]),d(this.children[2]));return super.cloneInto(e),e}};function O(e,t){return typeof e=="number"?new t(e):e}Ae.type="bvec3",Ae=vr=s([B],Ae);var ke=br=class extends _{constructor(e,t,r,n){super(),this.type="bvec4",this.children=[e,t,r,n].filter(o=>o!=null)}all(){return Fr(this)}any(){return _r(this)}clone(){let e=new br(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]));return super.cloneInto(e),e}};ke.type="bvec4",ke=br=s([B],ke);var xt=(()=>{class e extends _{constructor(r){super(),this.type="int",this.children=[r]}multiply(r){return ht(this,O(r,e))}add(r){return Bt(this,O(r,e))}subtract(r){return ae(this,O(r,e))}divide(r){return Rt(this,O(r,e))}clone(){let r=new e(d(this.children[0]));return super.cloneInto(r),r}}return e.type="int",e})(),Ue=xr=class extends _{constructor(e,t){super(),this.type="ivec2",this.children=[e,t].filter(r=>r!=null)}clone(){let e=new xr(d(this.children[0]),d(this.children[1]));return super.cloneInto(e),e}};Ue.type="ivec2",Ue=xr=s([B],Ue);var Re=wr=class extends _{constructor(e,t,r){super(),this.type="ivec3",this.children=[e,t,r].filter(n=>n!=null)}clone(){let e=new wr(d(this.children[0]),d(this.children[1]),d(this.children[2]));return super.cloneInto(e),e}};Re.type="ivec3",Re=wr=s([B],Re);var Be=Sr=class extends _{constructor(e,t,r,n){super(),this.type="ivec4",this.children=[e,t,r,n].filter(o=>o!=null)}clone(){let e=new Sr(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]));return super.cloneInto(e),e}};Be.type="ivec4",Be=Sr=s([B],Be);var Ao=(()=>{class e extends _{constructor(r,n,o,i){super(),this.type="mat2",this.children=[r,n,o,i]}clone(){let r=new e(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]));return super.cloneInto(r),r}multiply(r){return ht(this,r)}}return e.type="mat2",e})(),L=(()=>{class e extends _{static identity(){return new e(1,0,0,0,1,0,0,0,1)}static fromRotation(r){let n=ce(r),o=$r(r);return new e(o,n,0,Ut(n),o,0,0,0,1)}constructor(r,n,o,i,a,l,p,c,h){super(),this.type="mat3",this.children=[r,n,o,i,a,l,p,c,h]}add(r){return Bt(this,r)}multiply(r){return ht(this,r)}clone(){let r=new e(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]),d(this.children[4]),d(this.children[5]),d(this.children[6]),d(this.children[7]),d(this.children[8]));return super.cloneInto(r),r}}return e.type="mat3",e})(),ko=(()=>{class e extends _{static identity(){return new e(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(r,n,o,i,a,l,p,c,h,g,F,D,N,pt,vt,Ct){super(),this.type="mat4",this.children=[r,n,o,i,a,l,p,c,h,g,F,D,N,pt,vt,Ct]}static fromColumns(r,n,o,i){return new e(r.x,r.y,r.z,r.w,n.x,n.y,n.z,n.w,o.x,o.y,o.z,o.w,i.x,i.y,i.z,i.w)}multiply(r){return ht(this,r)}clone(){let r=new e(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]),d(this.children[4]),d(this.children[5]),d(this.children[6]),d(this.children[7]),d(this.children[8]),d(this.children[9]),d(this.children[10]),d(this.children[11]),d(this.children[12]),d(this.children[13]),d(this.children[14]),d(this.children[15]));return super.cloneInto(r),r}}return e.type="mat4",e})(),qn={float:u,vec2:y,vec3:V,vec4:v,int:xt,ivec2:Ue,ivec3:Re,ivec4:Be,uint:De,uvec2:Ne,uvec3:Me,uvec4:ze,bool:q,bvec2:Ee,bvec3:Ae,bvec4:ke},Dt=(...e)=>new xt(...e),I=(...e)=>new u(...e),se=(...e)=>new y(...e),xn=(...e)=>new V(...e),wn=(...e)=>new v(...e);var Tr=(...e)=>new L(...e);function R(e,t,r){let n=new r(new Oe(t,e,r));return n.isImplicit=!0,n}function k(e,t,r,n=null){if(n){let i=new n,a=new n(new it(e,[t,r],!0,!1,i));return a.isImplicit=!0,a}if(t.type==="float"||t.type==="int"){let i=new r.constructor(new it(e,[t,r],!0,!1,r.constructor));return i.isImplicit=!0,i}if((t.type==="mat2"||t.type==="mat3"||t.type==="mat4")&&r.type!=="float"){let i=new r.constructor(new it(e,[t,r],!0,!1,r.constructor));return i.isImplicit=!0,i}let o=new t.constructor(new it(e,[t,r],!0,!1,t.constructor));return o.isImplicit=!0,o}function A(e,t,r=t.constructor){let n=new r(new it(e,[t],!1,!1,r));return n.isImplicit=!0,n}function mt(e,t,r,n=t.constructor){let o=new n(new it(e,[t,r],!1,!1,n));return o.isImplicit=!0,o}function Vr(e,t,r,n,o=t.constructor){let i=new o(new it(e,[t,r,n],!1,!1,o));return i.isImplicit=!0,i}function Ut(e){return ht(e,I(-1))}function Sn(e,t,r,n){return new t(new Pe(e,t,r,n))}function Wn(e,t,r=0,n=e.size){let o=new xt(r).setMutable().setDebugName("FindIndexIterator"),i=t(e.get(o)).setDebugName("FindIndexPredicate");return Sn({iter:o},xt,i,({out:l,iter:p,subgraph:c})=>`
${l} = -1;

for (; ${p} < ${n}; ${p}++) {

${c.body}

  if (${c.varName}) {
    ${l} = ${p};
    break;
  }

}
`).setDebugName("FindIndexBlock")}function Zn(e,t,r=0,n=e.size){return Sn({array:e},xt,null,({out:i,array:a})=>`
${i} = -1;
for (int i = ${r}; i < ${n}; i++) {
  bool condition;
  ${t({array:a,i:"i",out:"condition"})}
  if (condition) {
    ${i} = i;
    break;
  }
}
`).setDebugName("GlslFindIndexBlock")}function T(e,t,r){let n=typeof t=="function"?t():t,o=typeof r=="function"?r():r,i=new n.constructor(new Ce(e,n,o));return i.isImplicit=!0,i}function st(...e){let t=e.map(([l,p])=>typeof p=="function"?[l,p()]:[l,p]),r=t[0][1].constructor,n=t.findIndex(l=>l[0]===!0);if(n===-1)throw new Error("A cond must have a fallthrough case with `true`/; ");let o=t.slice(0,n),i=t[n][1],a=new r(o.reduceRight((l,p)=>T(p[0],p[1],l),i));return a.isImplicit=!0,a}function ht(e,t){return k("*",e,t)}function Rt(e,t){return k("/",e,t)}function Bt(e,t){return k("+",e,t)}function ae(e,t){return k("-",e,t)}function Uo(e,t){return k("%",e,t)}function Ro(e,t){return k(">>",e,t)}function Bo(e,t){return k("&",e,t)}function Lt(e,t){return k("==",e,t,q)}function Tn(e,t){return k("<",e,t,q)}function wt(e,t){return k("<=",e,t,q)}function $(e,t){return k(">",e,t,q)}function St(e,t){return k(">=",e,t,q)}function Ir(...e){return e.length<=1?e[0]:e.slice(1).reduce((t,r)=>Xn(t,r),e[0])}function Xn(e,t){return k("||",e,t,q)}function Le(...e){return e.length<=1?e[0]:e.slice(1).reduce((t,r)=>Jn(t,r),e[0])}function Jn(e,t){return k("&&",e,t,q)}function Vn(e){return A("abs",e)}function Fr(e){return A("all",e,q)}function _r(e){return A("any",e,q)}function Lo(e,t){return t==null?A("atan",e):mt("atan",e,t,e.constructor)}function In(e){return A("ceil",e)}function Ht(e,t,r){return Vr("clamp",e,t,r,e.constructor)}function $r(e){return A("cos",e)}function Or(e,t){return mt("distance",e,t,u)}function ue(e,t){return mt("dot",e,t,u)}function Fn(e){return A("floor",e)}function He(e){return A("fract",e)}function Ge(e){return A("length",e,u)}function Tt(e,t){return mt("max",e,t)}function le(e,t){return mt("min",e,t)}function W(e,t,r){return Vr("mix",e,t,r)}function Q(e,t){return mt("mod",e,t)}function _n(e){return A("normalize",e)}function $n(e){return e.type==="bool"?A("!",e):A("not",e)}function Ho(e,t){return mt("pow",e,t)}function Go(e){return A("round",e)}function ce(e){return A("sin",e)}function Ko(e,t,r){return Vr("smoothstep",e,t,r)}function jo(e){return A("sqrt",e)}function tt(e,t){return mt("step",e,t,t.constructor)}function H(e,t){return mt("texture",e,t,v)}var Yn=()=>At.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder"),Ke=class{constructor(){this._includedModules=new Map}include(t,r){this._includedModules.has(t)?this._includedModules.get(t):(this._includedModules.set(t,r),t(this.builder,r))}},je=class extends Ke{constructor(){super(...arguments),this.vertex=new qe,this.fragment=new qe,this.attributes=new Dr,this.varyings=new Nr,this.extensions=new pe,this.constants=new We}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,r=!0){let n=this.extensions.generateSource(t),o=this.attributes.generateSource(t),i=this.varyings.generateSource(t),a=t==="vertex"?this.vertex:this.fragment,l=a.uniforms.generateSource(),p=a.code.generateSource(),c=t==="vertex"?to:Qn(),h=this.constants.generateSource().concat(a.constants.generateSource());return`${r?"#version 300 es":""}
${n.join(`
`)}
${c}
${h.join(`
`)}
${l.join(`
`)}
${o.join(`
`)}
${i.join(`
`)}
${p.join(`
`)}`}generateBindPass(t){let r=new Map;this.vertex.uniforms.entries.forEach(i=>{let a=i.bind[ee.Pass];a&&r.set(i.name,a)}),this.fragment.uniforms.entries.forEach(i=>{let a=i.bind[ee.Pass];a&&r.set(i.name,a)});let n=Array.from(r.values()),o=n.length;return(i,a)=>{for(let l=0;l<o;++l)n[l](t,i,a)}}generateBindDraw(t){let r=new Map;this.vertex.uniforms.entries.forEach(i=>{let a=i.bind[ee.Draw];a&&r.set(i.name,a)}),this.fragment.uniforms.entries.forEach(i=>{let a=i.bind[ee.Draw];a&&r.set(i.name,a)});let n=Array.from(r.values()),o=n.length;return(i,a,l)=>{for(let p=0;p<o;++p)n[p](t,l,i,a)}}},Cr=class{constructor(){this._entries=new Map}add(...t){for(let r of t)this._add(r)}get(t){return this._entries.get(t)}_add(t){if(t!=null){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new Fe(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else Yn().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(t=>t.arraySize!=null?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}},Pr=class{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}},qe=class extends Ke{constructor(){super(...arguments),this.uniforms=new Cr,this.code=new Pr,this.constants=new We}get builder(){return this}},Dr=class{constructor(){this._entries=new Array}add(t,r){this._entries.push([t,r])}generateSource(t){return t==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},Nr=class{constructor(){this._entries=new Map}add(t,r){this._entries.has(t)&&Qr(this._entries.get(t)===r),this._entries.set(t,r)}generateSource(t){let r=new Array;return this._entries.forEach((n,o)=>r.push(t==="vertex"?`out ${n} ${o};`:`in ${n} ${o};`)),r}},pe=class e{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){let r=t==="vertex"?e.ALLOWLIST_VERTEX:e.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(n=>r.includes(n)).map(n=>`#extension ${n} : enable`)}};pe.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],pe.ALLOWLIST_VERTEX=[];var We=class e{constructor(){this._entries=new Set}add(t,r,n){let o="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":o=e._numberToFloatStr(n);break;case"int":o=e._numberToIntStr(n);break;case"bool":o=n.toString();break;case"vec2":o=`vec2(${e._numberToFloatStr(n[0])},                            ${e._numberToFloatStr(n[1])})`;break;case"vec3":o=`vec3(${e._numberToFloatStr(n[0])},                            ${e._numberToFloatStr(n[1])},                            ${e._numberToFloatStr(n[2])})`;break;case"vec4":o=`vec4(${e._numberToFloatStr(n[0])},                            ${e._numberToFloatStr(n[1])},                            ${e._numberToFloatStr(n[2])},                            ${e._numberToFloatStr(n[3])})`;break;case"ivec2":o=`ivec2(${e._numberToIntStr(n[0])},                             ${e._numberToIntStr(n[1])})`;break;case"ivec3":o=`ivec3(${e._numberToIntStr(n[0])},                             ${e._numberToIntStr(n[1])},                             ${e._numberToIntStr(n[2])})`;break;case"ivec4":o=`ivec4(${e._numberToIntStr(n[0])},                             ${e._numberToIntStr(n[1])},                             ${e._numberToIntStr(n[2])},                             ${e._numberToIntStr(n[3])})`;break;case"mat2":case"mat3":case"mat4":o=`${r}(${Array.prototype.map.call(n,i=>e._numberToFloatStr(i)).join(", ")})`}return this._entries.add(`const ${r} ${t} = ${o};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}};function Qn(){return`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif
`}var to=`precision highp float;
precision highp sampler2D;`;function M(e,t,r){let n=t.split(`
`);for(let o of n)if(o.trim().length){{let i="";r!=null&&(i+=`/*id:${r??"000"}*/   `),e.body+=i.padEnd(14)}e.body+=" ".repeat(e.indent)+o+`
`}}var de=class{write(t){for(let r of t.rootOutputNodes())t.shouldPruneOutputNode(r)||(r.variableName=this._write(t,r.node));return t}_createVarName(t,r){let n="";return typeof r!="boolean"&&typeof r!="number"&&r.debugInfo.name&&(n=`${r.debugInfo.name}_`),`${n}v${t.varCount++}`}_write(t,r,n=!1){if(typeof r=="number"||typeof r=="boolean")return r.toString();let o=t.getEmit(r);if(o)return o;switch(r.shaderType){case"scope-node":o=this._writeScopeNode(t,r);break;case"primitive-node":o=this._writePrimitiveNode(t,r,n);break;case"function-node":o=this._writeFunctionNode(t,r);break;case"property-access-node":o=this._writePropertyAccessNode(t,r);break;case"text-node":o=r.text;break;case"block-node":o=this._writeBlockNode(t,r);break;case"condition-node":o=this._writeConditionNode(t,r)}return t.setEmit(r,o),o}_writeScopeNode(t,r){let n=new r.child.constructor;n.setDebugName(r.debugInfo.name);let o=this._write(t,n,!0);return M(t,`{ /*ScopeStart: ${r.uid} ${r.debugInfo.name}*/`),t.indent+=2,M(t,`${o} = ${this._write(t,r.child)};`),t.indent-=2,M(t,`} /*ScopeEnd: ${r.uid} ${r.debugInfo.name}*/`),o}_writeConditionNode(t,r){let n=new r.ifTrue.constructor,o=this._write(t,n,!0);M(t,`if (${this._write(t,r.condition)}) {`),t.indent+=2;let i=t.createSubgraphContext(),a=this._write(i,r.ifTrue);if(t.body+=i.body,a&&M(t,`${o} = ${a};`),t.indent-=2,M(t,"}"),r.ifFalse){M(t,"else {"),t.indent+=2;let l=t.createSubgraphContext(),p=this._write(l,r.ifFalse);t.body+=l.body,p&&M(t,`${o} = ${p};`),t.indent-=2,M(t,"}")}return o}_writeBlockNode(t,r){let{captureList:n,generator:o,returnType:i}=r,a={};for(let h in n){if(!n[h])continue;let g=this._write(t,n[h]);a[h]=g}let l=new i,p=this._write(t,l,!0);if(a.out=p,r.subgraph){let h=t.createSubgraphContext(),g=this._write(h,r.subgraph.child),F=h.body;a.subgraph={varName:g,body:F}}let c=o(a);return M(t,`{
`),t.indent+=2,M(t,c),t.indent-=2,M(t,`}
`),p}_writePropertyAccessNode(t,r){let n=this._write(t,r.target);return typeof r.property=="string"&&r.property.includes("[")?`${n}${r.property}`:typeof r.property!="string"?`${n}[${this._write(t,r.property)}]`:`${n}.${r.property}`}_writeFunctionNode(t,r){let n=r.returnType.type;if(r.isInfix){let[a,l]=r.children.map(c=>this._write(t,c)),p=this._createVarName(t,r);return M(t,`${n.padEnd(5)} ${p} = ${a} ${r.token} ${l};`,r.uid),p}let o=r.children.map(a=>this._write(t,a)).join(", "),i=this._createVarName(t,r);return M(t,`${n.padEnd(5)} ${i} = ${r.token}(${o});`,r.uid),i}_writePrimitiveNode(t,r,n=!1){let o=t.getInput(r);if(o)return o.isUsed=!0,o.variableName;let i=r.children.length===1&&r.children[0]?.type===r.type;if(r.isImplicit||i)return this._write(t,r.children[0]);let a=this._createVarName(t,r);if(n)return M(t,`${r.type.padEnd(5)} ${a};`,r.uid),a;let l=!r.debugInfo.name&&!r.isMutable;if(l&&r.type==="float"&&typeof r.children[0]=="number")return Number.isInteger(r.children[0])?r.children[0].toFixed(1):r.children[0].toString();if(l&&r.type==="int"&&typeof r.children[0]=="number"&&Number.isInteger(r.children[0]))return r.children[0].toString();let p=r.children.map(c=>this._write(t,c)).join(", ");return r.type==="array"?(M(t,`${r.type.padEnd(5)} ${a} = [${p}];`,r.uid),a):l?`${r.type}(${p})`:(M(t,`${r.type.padEnd(5)} ${a} = ${r.type}(${p});`,r.uid),a)}};var Vt=class e{constructor(t,r,n){this.variableName=t,this.variableInputType=r,this.node=n,this.type="shader-input",this.isUsed=!1}clone(){return new e(this.variableName,this.variableInputType,d(this.node))}},It=class e{constructor(t,r,n){this.outVariableName=t,this.outVariableType=r,this.node=n,this.type="shader-output"}clone(){let t=new e(this.outVariableName,this.outVariableType,d(this.node));return t.variableName=this.variableName,t}},me=class e{static createVertex(t,r,n,o,i,a){let l=[];for(let c in t){let h=t[c],g=n.get(c);g?l.push(new Vt(g,"builtin",h)):l.push(new Vt("a_"+c,"in",h))}for(let c of o){let h=c.uniformHydrated;l.push(new Vt(c.uniformName,"uniform",h))}let p=[];for(let c in r){let h=r[c];c==="glPosition"?p.push(new It("gl_Position","builtin",h)):c==="glPointSize"?p.push(new It("gl_PointSize","builtin",h)):p.push(new It("v_"+c,"out",h))}return new e(l,p,i,a)}static createFragment(t,r,n,o,i,a){let l=[],p=Array.from(i.rootOutputNodes());for(let h in t){let g=t[h],F=n.get(h);if(F){l.push(new Vt(F,"builtin",g));continue}let D=p.find(N=>N.node===g);D&&l.push(new Vt(D.outVariableName,"in",g))}for(let h of o){let g=h.uniformHydrated;l.push(new Vt(h.uniformName,"uniform",g))}let c=[];for(let h in r){let g=r[h],F=n.get(h);h==="discard"?c.push(new It(null,"discard",g)):F?c.push(new It(F,"builtin",g)):c.push(new It(h,"out",g))}return new e(l,c,a)}constructor(t,r,n,o){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(let i of t)this._inputShaderTypesByNodeUid.set(i.node.uid,i);this._outputShaderTypes=r,this._transformFeedbackBindings=n,this._transformFeedbackNames=new Set(n.map(i=>"v_"+i.propertyKey)),this._usedInFragmentShader=o}shouldPruneOutputNode(t){return!!this._usedInFragmentShader&&t.outVariableType!=="builtin"&&!this._transformFeedbackNames.has(t.outVariableName)&&!this._usedInFragmentShader.has(t.node.uid)}setEmit(t,r){this._nodeEmitMap.set(t.uid,r)}getEmit(t){return this._nodeEmitMap.get(t.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(t){return this._inputShaderTypesByNodeUid.get(t.uid)}*rootOutputNodes(){for(let t of this._outputShaderTypes)yield t}*nodes(){let t=[];for(let r of this._outputShaderTypes.values())t.push(r.node);for(;t.length;){let r=t.pop();typeof r!="number"&&typeof r!="boolean"&&t.push(...r.children.filter(Boolean)),yield r}}*nodesOfTypeOrFunction(){for(let t of this.nodes())typeof t!="number"&&typeof t!="boolean"&&(yield t)}createSubgraphContext(){let t=this.clone();return t.body="",t.indent=this.indent+2,t._nodeEmitMap=new Map(this._nodeEmitMap),t}clone(){let t=new e([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(t){t.vertex.code.add(""),this._insertInputs(t,"vertex"),t.vertex.code.add(""),t.vertex.code.add("// OUTPUTS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(let r of this.rootOutputNodes()){let n=r.outVariableType==="builtin";this.shouldPruneOutputNode(r)||(n?t.vertex.code.add(`// ${r.outVariableType.padEnd(7)} ${r.node.type.padEnd(9)} ${r.outVariableName};`):t.vertex.code.add(`${r.outVariableType.padEnd(10)} ${r.node.type.padEnd(9)} ${r.outVariableName};`))}t.vertex.code.add(""),t.vertex.code.add("void main() {"),t.vertex.code.add("  "+this.body.split(`
`).join(`
  `));for(let r of this.rootOutputNodes())this.shouldPruneOutputNode(r)||t.vertex.code.add(`  ${r.outVariableName} = ${r.variableName};`);t.vertex.code.add("}")}insertFragmentShader(t){this._insertInputs(t,"fragment"),t.fragment.code.add(""),t.fragment.code.add("// OUTPUTS: "),t.fragment.code.add("// --------------------------------------------------------- ");for(let r of this.rootOutputNodes())r.outVariableType==="builtin"?t.fragment.code.add(`// ${r.outVariableType.padEnd(7)} ${r.node.type.padEnd(9)} ${r.outVariableName};`):t.fragment.code.add(`${r.outVariableType.padEnd(10)} ${r.node.type.padEnd(9)} ${r.outVariableName};`);t.fragment.code.add(""),t.fragment.code.add("void main() {"),t.fragment.code.add("  "+this.body.split(`
`).join(`
  `));for(let r of this.rootOutputNodes())r.outVariableType==="discard"?(t.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),t.fragment.code.add(`  if (${r.variableName}) {`),t.fragment.code.add("    discard;"),t.fragment.code.add("  }"),t.fragment.code.add("  ")):t.fragment.code.add(`  ${r.outVariableName} = ${r.variableName};`);t.fragment.code.add("}")}_insertInputs(t,r){t[r].code.add("// INPUTS: "),t[r].code.add("// --------------------------------------------------------- ");for(let n of this.inputs())n.isUsed&&n.variableInputType!=="builtin"&&(n.node.type==="array"?t[r].code.add(`${n.variableInputType.padEnd(10)} ${n.node.elementType.type.padEnd(9)} ${n.variableName}[${n.node.size}];`):t[r].code.add(`${n.variableInputType.padEnd(10)} ${n.node.type.padEnd(9)} ${n.variableName};`))}};var eo=()=>At.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram");function he(e,t,r){let n=t.length;if(n!==r){let o=new Fe("Invalid Uniform",`Invalid length, expected ${r} but got ${n}`,{uniformName:e,values:t});eo().errorOnce(o)}}var fe=class{constructor(t,r,n,o,i,a){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=t,this.fragmentShader=r,this._locations=n,this._locationInfo=o,this._uniformBindings=i,this._transformFeedbackBindings=a}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(let t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){let r=this._uniforms;if(!this._program){let o=new Map;for(let[a,l]of this._locations)o.set(a,l);let i=[];for(let a of this._transformFeedbackBindings??[]){let{index:l,propertyKey:p}=a;i[l]=`v_${p}`}this._program=new nn(t,this.vertexShader,this.fragmentShader,o,new Map,i)}let n=this._program;t.useProgram(n);for(let o of this._uniformBindings){let{shaderModulePath:i,uniformName:a,uniformType:l,uniformArrayLength:p}=o,c=Wr(i,r);if(c==null){if(l==="sampler2D")continue;throw new Error(`Failed to find uniform value for ${i}`)}switch(l==="array"?o.uniformArrayElementType:l){case"sampler2D":{let{unit:h,texture:g}=c;if(n.setUniform1i(a,h),"type"in g)t.bindTexture(g,h);else{let F=rn(t,g.descriptor,g.data);t.bindTexture(F,h)}break}case"int":if(!p){n.setUniform1i(a,c);break}he(o.uniformName,c,p),n.setUniform1iv(a,c);break;case"float":if(!p){n.setUniform1f(a,c);break}he(o.uniformName,c,p),n.setUniform1fv(a,c);break;case"vec2":if(!p){n.setUniform2f(a,c[0],c[1]);break}he(o.uniformName,c,p),n.setUniform2fv(a,c.flat());break;case"vec3":if(!p){n.setUniform3f(a,c[0],c[1],c[2]);break}he(o.uniformName,c,p),n.setUniform3fv(a,c.flat());break;case"vec4":if(!p){n.setUniform4f(a,c[0],c[1],c[2],c[3]);break}he(o.uniformName,c,p),n.setUniform4fv(a,c.flat());break;case"mat3":n.setUniformMatrix3fv(a,c);break;case"mat4":n.setUniformMatrix4fv(a,c);break;default:throw new Error(`Unable to set uniform for type ${l}`)}}}};function ye(e){return new e}function ge(e,t,r){let n=e.constructor[t]??[];e.constructor.hasOwnProperty(t)||Object.defineProperty(e.constructor,t,{value:n.slice()}),e.constructor[t].push(r)}function f(e,t){return(r,n)=>{ge(r,"locations",{typeCtor:t,propertyKey:n,parameterIndex:null,index:e})}}var S=e=>(t,r,n)=>{ge(t,"inputs",{inputCtor:e,propertyKey:r,parameterIndex:n})},m=e=>(t,r)=>{ge(t,"uniforms",{typeCtor:e,propertyKey:r})},C=e=>(t,r)=>{ge(t,"options",{typeCtor:e,propertyKey:r})},zr=(e,t)=>{ge(e,"defines",{propertyKey:t})};var Mr=(e,t)=>(r,n)=>{r.constructor.builtins.push({builtin:e,propertyKey:n,typeCtor:t})},Gt=class{};Gt.builtins=[],s([Mr("gl_VertexID",xt)],Gt.prototype,"glVertexID",void 0);var Ze=class{},Ft=class{};Ft.builtins=[],s([Mr("gl_FragCoord",v)],Ft.prototype,"glFragCoord",void 0),s([Mr("gl_PointCoord",y)],Ft.prototype,"glPointCoord",void 0);var Xe=class{},w=class{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}},Je=class{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){let t=this._shaderModuleClass.inputs.findLast(r=>r.propertyKey==="vertex"&&r.parameterIndex===0);if(!t)throw new Error("Unable to find vertex input parameter");return t}get computeInput(){return this._shaderModuleClass.inputs.findLast(t=>t.propertyKey==="vertex"&&t.parameterIndex===1)}get fragmentInput(){let t=this._shaderModuleClass.inputs.findLast(r=>r.propertyKey==="fragment");if(!t)throw new Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){let t=new Map,r=new Set;for(let n of this.locations)r.has(n.index)?At.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${n.propertyKey} to ${n.index}. Index already in use`,{locationsMap:t}):(t.set(n.propertyKey,n.index),r.add(n.index));return t}get locationInfo(){if(!this._locationInfo){let t=this.locationsMap,r=Array.from(t.entries()).map(([i,a])=>`${i}.${a}`).join("."),n=Zr(r),o=this.computeAttributes;this._locationInfo={hash:n,locations:t,computeAttributeMap:o}}return this._locationInfo}get renamedLocationsMap(){let t=new Map;for(let r of this.locations)t.set("a_"+r.propertyKey,r.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){let t=new Set;for(let r of this._options)t.add(r.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,r,n,o){try{let{vertex:i,fragment:a,uniformBindings:l}=this._generateShaders(t,r,n,o);return new fe(i,a,this.renamedLocationsMap,this.locationInfo,l,this.transformFeedbackBindings)}catch{return new fe("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){let r=this._options.find(o=>o.propertyKey===t);if(r)return{type:"option",className:r.typeCtor};let n=this._uniforms.find(o=>o.propertyKey===t);if(!n)throw new Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:n.typeCtor}}getShaderKey(t,r,n,o){let i=Object.keys(t).map(c=>`${c}.${t[c]}`).join("."),a=Object.keys(n).map(c=>`${c}.${n[c]}`).join("."),l=Object.keys(o).map(c=>`${c}.${o[c]}`).join("."),p=Object.keys(r).filter(c=>this.optionPropertyKeys.has(c)&&r[c]).join(".");return`${this.constructor.name}.${i}.${a}.${l}.${p}`}_generateShaders(t,r,n,o){let i=[];this._setDefines(n),this._setOptionalUniforms(i,r),this._setRequiredUniforms(i);let a=this._hydrateVertexInput(o),l=this._injectPackPrecisionFactor(a,t),p=this._hydrateComputeInput(),c=p&&this._injectComputePackPrecisionFactor(p,t),h=this.vertex(l,c),g=this._hydrateFragmentInput(h),F=this.fragment(g),D=new Set;for(let An in F){let kn=F[An];vn(D,kn)}let N=this._getVertexInputBuiltins(),pt=me.createVertex(b(b({},a),p),h,N,i,this.transformFeedbackBindings,D);new de().write(pt);let vt=this._getFragmentInputBuiltins(F);vt.set("glPointCoord","gl_PointCoord");let Ct=me.createFragment(g,F,vt,i,pt,this.transformFeedbackBindings);new de().write(Ct);let Ve=this._createShaderBuilder(pt,Ct),jr=Ve.generate("vertex",!0),qr=Ve.generate("fragment",!0);return this.logShader&&(console.log(jr),console.log(qr)),{vertex:jr,fragment:qr,uniformBindings:i}}_setDefines(t){for(let r in t)this[r]=t[r]}_setOptionalUniforms(t,r){for(let n of this._options)r[n.propertyKey]?this[n.propertyKey]=this._hydrateUniformGroup(t,n):this[n.propertyKey]=null}_setRequiredUniforms(t){for(let r of this._uniforms)this[r.propertyKey]=this._hydrateUniformGroup(t,r)}_hydrateUniformGroup(t,r){let n=new r.typeCtor;for(let o of n._uniforms??[]){let i=ye(o.typeCtor),a=`u_${r.propertyKey}_${o.propertyKey}`,l=i.type,p=[r.propertyKey,o.propertyKey].join(".");if("type"in o.typeCtor&&o.typeCtor.type==="array"){let c=i;t.push({shaderModulePath:p,uniformName:a,uniformType:l,uniformArrayLength:c.size,uniformArrayElementType:c.elementType.type,uniformHydrated:i})}else t.push({shaderModulePath:p,uniformName:a,uniformType:l,uniformHydrated:i});n[o.propertyKey]=i}return n}_hydrateVertexInput(t){let r=this.vertexInput.inputCtor,n=r.locations.reduce((o,i)=>t[i.propertyKey]===!1?o:Pt(b({},o),{[i.propertyKey]:ye(i.typeCtor)}),{});for(let{propertyKey:o,typeCtor:i}of r.builtins){let a=ye(i);n[o]=a}return n}_hydrateComputeInput(){return this.computeInput==null?null:this.computeInput.inputCtor.locations.reduce((t,r)=>Pt(b({},t),{[r.propertyKey]:ye(r.typeCtor)}),{})}_injectPackPrecisionFactor(t,r){let n={};for(let o in t){let i=t[o],a=r[o];if(a){if(i.type!=="float"&&i.type!=="vec2"&&i.type!=="vec3"&&i.type!=="vec4")throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${i.type}`);n[o]=i.divide(new u(a))}else n[o]=i}return n}_injectComputePackPrecisionFactor(t,r){let n={},o=new Map;for(let i in this.computeAttributes)for(let a of this.computeAttributes[i]??[])o.set(a,i);for(let i in t){let a=t[i],l=o.get(i);if(!l)continue;let p=r[l];if(p){if(a.type!=="float"&&a.type!=="vec2"&&a.type!=="vec3"&&a.type!=="vec4")throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${a.type}`);n[i]=a.divide(new u(p))}else n[i]=a}return n}_hydrateFragmentInput(t){let r={};for(let n in t)r[n]=t[n];for(let{propertyKey:n,typeCtor:o}of Ft.builtins){let i=ye(o);r[n]=i}return r}_getVertexInputBuiltins(){let t=this.vertexInput.inputCtor,r=new Map;for(let{builtin:n,propertyKey:o}of t.builtins)r.set(o,n);return r}_getFragmentInputBuiltins(t){let r=t.constructor,n=new Map;for(let o of r.builtins??[])n.set(o.propertyKey,o.builtin);return n}_createShaderBuilder(t,r){let n=new je;return this._insertDebugInfo(n),t.insertVertexShader(n),r.insertFragmentShader(n),n}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: "),t.vertex.code.add("// --------------------------------------------------------- ");for(let r of this._defines)this[r.propertyKey]?t.vertex.code.add(`//   ${r.propertyKey}: true`):t.vertex.code.add(`//   ${r.propertyKey}: false`);t.vertex.code.add(""),t.vertex.code.add("// OPTIONS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(let r of this._options)this[r.propertyKey]?t.vertex.code.add(`//   ${r.propertyKey}: true`):t.vertex.code.add(`//   ${r.propertyKey}: false`)}};function Er(e){let t=I(12.9898),r=I(78.233),n=I(43758.5453),o=ue(e,se(t,r)),i=Q(o,I(3.14));return He(ce(i).multiply(n))}function G(e){return Lt(e,I(pn))}function On(e,t){return e.x.multiply(t.y).subtract(t.x.multiply(e.y))}function Cn(e){return e.multiply(2).subtract(1)}function et(e,t){let r=I(2**t);return Q(Fn(e.divide(r)),I(2))}function Ki(e,t){return $(et(e,t),I(.5))}function Ye(e,t){return et(e,t+_e)}function Pn(e,t){return et(e,t)}function Dn(e){let t=et(e.z,7),r=I(1).subtract(t),n=e.xyz.subtract(xn(0,0,I(128)));return r.multiply(e).add(t.multiply(n))}function Nn(e){let t=wn(.99609375,.0038909912109375,1519918441772461e-20,59371814131736755e-24);return ue(e,t)}function ji(e){return Tt(Tt(Tt(e.x,e.y),e.z),e.w)}function qi(e){return new u(1).subtract(e)}function Wi(e){return e.subtract(new u(1))}function Zi(e,t){return e.subtract(new u(t))}var K=class extends w{getVisualVariableData(t){if(!this._vvData){let r=this.getAttributeDataCoords(t);this._vvData=H(this.visualVariableData,r).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){let r=Dn(t),n=this.size,o=Dt(r.x),i=Dt(r.y).multiply(Dt(256)),a=Dt(r.z).multiply(Dt(256)).multiply(Dt(256)),l=I(o.add(i).add(a)),p=Q(l,n),c=l.subtract(p).divide(n);this._uv=new y(p,c).add(.5).divide(n)}return this._uv}getFilterData(t){let r=this.getAttributeDataCoords(t);return H(this.filterFlags,r).setDebugName("storage0")}getAnimationData(t){let r=this.getAttributeDataCoords(t);return H(this.animation,r).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){let r=this.getAttributeDataCoords(t);return H(this.dataDriven0,r).setDebugName("storage30")}getDataDrivenData1(t){let r=this.getAttributeDataCoords(t);return H(this.dataDriven1,r).setDebugName("storage31")}getDataDrivenData2(t){let r=this.getAttributeDataCoords(t);return H(this.dataDriven2,r).setDebugName("storage32")}getGPGPUData(t){let r=this.getAttributeDataCoords(t);return H(this.gpgpu,r).setDebugName("storage4")}getLocalTimeOrigin(t){let r=this.getAttributeDataCoords(t);return H(this.localTimeOrigin,r).x.setDebugName("storage5")}getFilterFlags(t){return Ie("webgl-ignores-sampler-precision")?In(this.getFilterData(t).x.multiply(I(255))):this.getFilterData(t).x.multiply(I(255))}getLabelVisibility(t){let r=this.getFilterData(t).y.multiply(255);return new u(1).subtract(r)}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}};s([m(Y)],K.prototype,"filterFlags",void 0),s([m(Y)],K.prototype,"animation",void 0),s([m(Y)],K.prototype,"gpgpu",void 0),s([m(Y)],K.prototype,"localTimeOrigin",void 0),s([m(Y)],K.prototype,"visualVariableData",void 0),s([m(Y)],K.prototype,"dataDriven0",void 0),s([m(Y)],K.prototype,"dataDriven1",void 0),s([m(Y)],K.prototype,"dataDriven2",void 0),s([m(u)],K.prototype,"size",void 0);var Kt=class extends w{};s([m(u)],Kt.prototype,"activeReasons",void 0),s([m(u)],Kt.prototype,"highlightAll",void 0);var _t=class extends w{};s([m(y)],_t.prototype,"position",void 0),s([m(u)],_t.prototype,"distance",void 0),s([m(u)],_t.prototype,"smallSymbolDistance",void 0),s([m(u)],_t.prototype,"smallSymbolSizeThreshold",void 0);var z=class extends w{};s([m(L)],z.prototype,"displayViewScreenMat3",void 0),s([m(L)],z.prototype,"displayViewMat3",void 0),s([m(L)],z.prototype,"displayMat3",void 0),s([m(L)],z.prototype,"viewMat3",void 0),s([m(L)],z.prototype,"tileMat3",void 0),s([m(u)],z.prototype,"displayZoomFactor",void 0),s([m(u)],z.prototype,"requiredZoomFactor",void 0),s([m(y)],z.prototype,"tileOffset",void 0),s([m(u)],z.prototype,"currentScale",void 0),s([m(u)],z.prototype,"currentZoom",void 0),s([m(u)],z.prototype,"metersPerSRUnit",void 0),s([m(u)],z.prototype,"rotation",void 0),s([m(u)],z.prototype,"pixelRatio",void 0);var j=class extends Gt{};s([f(0,V)],j.prototype,"id",void 0),s([f(1,u)],j.prototype,"bitset",void 0),s([f(2,y)],j.prototype,"pos",void 0);var P=class extends Ze{};s([f(14,y)],P.prototype,"nextPos1",void 0),s([f(15,y)],P.prototype,"nextPos2",void 0);var at=class extends Ft{},U=class extends Je{clip(t,r){let n=new u(0),o=this.storage.getFilterFlags(t);if(n=n.add(I(2).multiply(I(1).subtract(Ye(o,0)))),this.inside?n=n.add(I(2).multiply(I(1).subtract(Ye(o,1)))):this.outside?n=n.add(I(2).multiply(Ye(o,1))):this.highlight&&(n=n.add(I(2).multiply(I(1).subtract(this._checkHighlight(o))))),r!=null){let i=new u(1).subtract(tt(r.x,this.view.currentZoom)),a=tt(r.y,this.view.currentZoom);n=n.add(new u(2).multiply(i.add(a)))}return n}getFragmentOutput(t,r,n=new u(1/255)){let o=new Xe;return o.glFragColor=this._maybeWriteHittest(r)??this._maybeHighlight(t,n)??t,o}_maybeHighlight(t,r){return this.highlight?new v(t.rgb,tt(r,t.a)):null}_checkHighlight(t){let r=this._checkHighlightBit(t,0);for(let n=1;n<_e;n++)r=r.add(this._checkHighlightBit(t,n));return tt(new u(.1),r.add(this.highlight.highlightAll))}_checkHighlightBit(t,r){return Pn(t,r).multiply(et(this.highlight.activeReasons,r))}maybeRunHittest(t,r,n){if(this.hittestRequest==null)return null;let o=this.hittest(t,r,n),i=T($(o,this.hittestRequest.distance),new u(2),new u(0)),a=this.storage.getAttributeDataCoords(t.id),l=Cn(a);i=i.add(this.clip(t.id,t.zoomRange));let p=new v(new u(1/255),0,0,0);return{glPointSize:new u(1),glPosition:new v(l,i,1),color:p}}_maybeWriteHittest(t){return this.hittestRequest!=null?t.color:null}};s([zr],U.prototype,"inside",void 0),s([zr],U.prototype,"outside",void 0),s([C(Kt)],U.prototype,"highlight",void 0),s([m(K)],U.prototype,"storage",void 0),s([m(z)],U.prototype,"view",void 0),s([C(_t)],U.prototype,"hittestRequest",void 0);function ro(e,t){return ue(e,_n(t))}function jt(e,t,r){let n=r.subtract(t),o=ro(e.subtract(t),n),i=Ht(o.divide(Ge(n)),new u(0),new u(1));return Or(e,t.add(i.multiply(r.subtract(t))))}function no(e){let t=Vn(e);return tt(t.x.add(t.y).add(t.z),new u(1.05))}function oo(e,t,r,n){let o=new L(r.x.multiply(n.y).subtract(n.x.multiply(r.y)),n.x.multiply(t.y).subtract(t.x.multiply(n.y)),t.x.multiply(r.y).subtract(r.x.multiply(t.y)),r.y.subtract(n.y),n.y.subtract(t.y),t.y.subtract(r.y),n.x.subtract(r.x),t.x.subtract(n.x),r.x.subtract(t.x)),i=t.x.multiply(r.y.subtract(n.y)),a=r.x.multiply(n.y.subtract(t.y)),l=n.x.multiply(t.y.subtract(r.y)),p=i.add(a).add(l);return new u(1).divide(p).multiply(o.multiply(new V(1,e)))}function io(e,t,r,n){return Lt(no(oo(e,t,r,n)),new u(1))}function so(e,t,r,n){let o=r.subtract(t),i=n.subtract(t),a=On(o,i),l=Le(Tn(a,new u(rr)),$(a,new u(-rr)));return st([Le($n(l),io(e.xy,t,r,n)),new u(-1)],[!0,()=>{let p=jt(e,t,r),c=jt(e,r,n),h=jt(e,n,t);return le(le(p,c),h)}])}function Qe(e){return e.distance.add(1)}function qt(e,t,r){let{viewMat3:n,tileMat3:o}=e.view,i=n.multiply(o),a=i.multiply(new V(t.pos,1)),l=i.multiply(new V(r.nextPos1,1)),p=i.multiply(new V(r.nextPos2,1));return so(e.hittestRequest.position,a.xy,l.xy,p.xy)}function $s(e,t,r){return Or(e,r).subtract(t)}var ut=class extends w{getColor(t,r,n){return st([Ir(G(t),n),r],[wt(t,this.values.first()),this.colors.first()],[St(t,this.values.last()),this.colors.last()],[!0,()=>{let o=this.values.findIndex(c=>$(c,t)),i=this.values.get(o),a=o.subtract(1),l=this.values.get(a),p=t.subtract(l).divide(i.subtract(l));return W(this.colors.get(a),this.colors.get(o),p)}])}};s([m(E.ofType(v,8))],ut.prototype,"colors",void 0),s([m(E.ofType(u,8))],ut.prototype,"values",void 0);var lt=class extends w{getOpacity(t){return st([G(t),new u(1)],[wt(t,this.opacityValues.first()),this.opacities.first()],[St(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{let r=this.opacityValues.findIndex(l=>$(l,t)),n=this.opacityValues.get(r),o=r.subtract(1),i=this.opacityValues.get(o),a=t.subtract(i).divide(n.subtract(i));return W(this.opacities.get(o),this.opacities.get(r),a)}])}};s([m(E.ofType(u,8))],lt.prototype,"opacities",void 0),s([m(E.ofType(u,8))],lt.prototype,"opacityValues",void 0);function Ar(e){return e.visualVariableSizeMinMaxValue!=null||e.visualVariableSizeScaleStops!=null||e.visualVariableSizeStops!=null||e.visualVariableSizeUnitValue!=null}function Mn(e,t,r){if(Ar(e)){let n=e.storage.getSizeValue(t);return e.visualVariableSizeMinMaxValue?.getSize(n,r)??e.visualVariableSizeScaleStops?.getSizeForViewScale(e.view.currentScale)??e.visualVariableSizeStops?.getSize(n,r)??e.visualVariableSizeUnitValue?.getSize(n,r)}return r}function Wt(e,t,r,n=new q(!1)){if(e.visualVariableColor==null)return r;let o=e.storage.getColorValue(t);return e.visualVariableColor.getColor(o,r,n)}function Zt(e,t){if(e.visualVariableOpacity==null)return new u(1);let r=e.storage.getOpacityValue(t);return e.visualVariableOpacity.getOpacity(r)}function Bs(e,t){if(e.visualVariableRotation==null)return L.identity();let r=e.storage.getRotationValue(t);return e.visualVariableRotation.getVVRotationMat3(r)}function Ls(e,t){if(e.visualVariableRotation==null)return new u(0);let r=e.storage.getRotationValue(t);return e.visualVariableRotation.getNormalizedAngle(r)}var ft=class extends j{};s([f(3,v)],ft.prototype,"color",void 0),s([f(4,y)],ft.prototype,"zoomRange",void 0);var ct=class extends U{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,r){let n=Zt(this,t.id),o=Wt(this,t.id,t.color).multiply(n),i=this.view.displayViewScreenMat3.multiply(new V(t.pos.xy,1)),a=this.clip(t.id,t.zoomRange);return b({glPosition:new v(i.xy,a,1),color:o},this.maybeRunHittest(t,r,null))}fragment(t){return this.getFragmentOutput(t.color,t,new u(0))}hittest(t,r){return qt(this,t,r)}};s([C(ut)],ct.prototype,"visualVariableColor",void 0),s([C(lt)],ct.prototype,"visualVariableOpacity",void 0),s([x(0,S(ft)),x(1,S(P))],ct.prototype,"vertex",null),s([x(0,S(at))],ct.prototype,"fragment",null);var Z=class extends w{getPatternOffsetAtTileOrigin(t,r=new u(0),n=new u(1)){let o=new y(fn).divide(t),i=t.multiply(He(this.maxIntsToLocalOrigin.multiply(o))).add(this.tileOffsetFromLocalOrigin).subtract(new u(.5).multiply(t));return i=new y(i.x.multiply(n).subtract(i.y.multiply(r)),i.x.multiply(r).add(i.y.multiply(n))),Q(i,t)}};s([m(y)],Z.prototype,"tileOffsetFromLocalOrigin",void 0),s([m(y)],Z.prototype,"maxIntsToLocalOrigin",void 0);var X=class extends w{};s([m(y)],X.prototype,"size",void 0),s([m(Y)],X.prototype,"texture",void 0);var yt=class extends ft{};s([f(5,v)],yt.prototype,"tlbr",void 0),s([f(6,u)],yt.prototype,"width",void 0),s([f(7,u)],yt.prototype,"height",void 0),s([f(8,y)],yt.prototype,"offset",void 0),s([f(9,y)],yt.prototype,"scale",void 0),s([f(10,u)],yt.prototype,"angle",void 0);var kr=class extends at{};function ao(e,t,r,n,o){let i=Lt(et(o,hn),I(1)),a=Nn(new v(e,0));return T(i,Tr(n.divide(t.x),r.divide(t.y),0,Ut(r.divide(t.x)),n.divide(t.y),0,Er(se(a,0)),Er(se(0,a)),1),Tr(n.divide(t.x),r.divide(t.y),0,Ut(r.divide(t.x)),n.divide(t.y),0,0,0,1))}function Ur(e,t){let r=e.view.requiredZoomFactor,n=new y(t.width,t.height),o=n.multiply(t.scale).multiply(r),i=t.angle.multiply(an),a=ce(i),l=$r(i),p=ao(t.id,o,a,l,t.bitset),c=e.localTileOffset.getPatternOffsetAtTileOrigin(n,a,l),h=r.multiply(t.scale).multiply(t.offset.subtract(c)).divide(o),g=new V(t.pos,1),F=p.multiply(g).xy.subtract(h),D=t.tlbr.divide(e.mosaicInfo.size.xyxy),N=et(t.bitset,dn);return e.visualVariableColor!=null&&(N=T(G(e.storage.getColorValue(t.id)),new u(0),N)),{tileTextureCoord:F,tlbr:D,sampleAlphaOnly:N}}function Rr(e,t){let r=Q(t.tileTextureCoord,new u(1)),n=W(t.tlbr.xy,t.tlbr.zw,r),o=H(e.mosaicInfo.texture,n);return o=T($(t.sampleAlphaOnly,new u(.5)),o.aaaa,o),t.color.multiply(o)}var Xt=class extends ct{vertex(t,r){return b(b({},super.vertex(t,r)),Ur(this,t))}fragment(t){let r=Rr(this,t);return this.getFragmentOutput(r,t,new u(0))}};s([m(X)],Xt.prototype,"mosaicInfo",void 0),s([m(Z)],Xt.prototype,"localTileOffset",void 0),s([x(0,S(yt)),x(1,S(P))],Xt.prototype,"vertex",null),s([x(0,S(kr))],Xt.prototype,"fragment",null);var Nt=class extends w{getSize(t,r){let n=this.minMaxValueAndSize.xy,o=this.minMaxValueAndSize.zw;return T(G(t),r,()=>{let i=t.subtract(n.x).divide(n.y.subtract(n.x)),a=Ht(i,new u(0),new u(1));return o.x.add(a.multiply(o.y.subtract(o.x)))})}};s([m(v)],Nt.prototype,"minMaxValueAndSize",void 0);var $t=class extends w{getSizeForViewScale(t){return st([wt(t,this.values.first()),this.sizes.first()],[St(t,this.values.last()),this.sizes.last()],[!0,()=>{let r=this.values.findIndex(l=>$(l,t)),n=this.values.get(r),o=r.subtract(1),i=this.values.get(o),a=t.subtract(i).divide(n.subtract(i));return W(this.sizes.get(o),this.sizes.get(r),a)}])}};s([m(E.ofType(u,8))],$t.prototype,"sizes",void 0),s([m(E.ofType(u,8))],$t.prototype,"values",void 0);var Ot=class extends w{getSize(t,r){let n=st([G(t),r],[wt(t,this.values.first()),this.sizes.first()],[St(t,this.values.last()),this.sizes.last()],[!0,()=>{let o=this.values.findIndex(c=>$(c,t)),i=this.values.get(o),a=o.subtract(1),l=this.values.get(a),p=t.subtract(l).divide(i.subtract(l));return W(this.sizes.get(a),this.sizes.get(o),p)}]);return T(G(n),r,n)}};s([m(E.ofType(u,8))],Ot.prototype,"sizes",void 0),s([m(E.ofType(u,8))],Ot.prototype,"values",void 0);var Mt=class extends w{getSize(t,r){return T(G(t),r,t.multiply(this.unitValueToPixelsRatio))}};s([m(u)],Mt.prototype,"unitValueToPixelsRatio",void 0);var gt=class extends j{};s([f(3,v)],gt.prototype,"color",void 0),s([f(4,y)],gt.prototype,"offset",void 0),s([f(5,y)],gt.prototype,"normal",void 0),s([f(6,u)],gt.prototype,"halfWidth",void 0),s([f(7,u)],gt.prototype,"referenceHalfWidth",void 0),s([f(8,y)],gt.prototype,"zoomRange",void 0);var ve=class extends at{},zt=class extends w{};function zn(e){return Tt(new u(un).multiply(tt(e,new u(ln))),new u(1))}function uo(e,t){let{halfWidth:r,normal:n}=e,o=zn(r),i=Ge(n).multiply(r);return Ht(o.multiply(r.subtract(i)).divide(t.add(o).subtract(new u(1))),new u(0),new u(1))}function lo(e,t){let{id:r,halfWidth:n,referenceHalfWidth:o}=t;if(Ar(e)){let i=new u(2).multiply(o),a=Mn(e,r,i);return new u(.5).multiply(n.divide(Tt(o,new u(cn)))).multiply(a)}return n}function Br(e,t){let{id:r,offset:n,pos:o,normal:i,zoomRange:a}=t,{displayViewScreenMat3:l,displayViewMat3:p}=e.view,c=Wt(e,r,t.color),h=Zt(e,r),g=lo(e,t),F=new u(.5).multiply(e.antialiasingControls.antialiasing),D=Tt(g.add(F),new u(.45)).add(new u(.1).multiply(F)),N=zn(D).multiply(D).multiply(n),pt=p.multiply(new V(N,new u(0))),vt=l.multiply(new V(o,new u(1))).add(pt),Ct=new u(2).multiply(tt(g,new u(0))).add(e.clip(r,a)),Ve=new v(vt.xy,Ct,1);return{color:c,opacity:h,halfWidth:D,normal:i,scaledOffset:N,scaledHalfWidth:g,glPosition:new v(Ve.xy,Ct,1)}}function Et(e,t){let{opacity:r,color:n}=e,o=uo(e,t);return r.multiply(n).multiply(o)}s([m(u)],zt.prototype,"antialiasing",void 0),s([m(u)],zt.prototype,"blur",void 0);var rt=class extends U{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,r){let n=Br(this,t);return b(b({},n),this.maybeRunHittest(t,r,n.halfWidth))}fragment(t){let r=Et(t,this.antialiasingControls.blur);return this.getFragmentOutput(r,t)}hittest(t,r,n){let{viewMat3:o,tileMat3:i}=this.view,a=o.multiply(i),l=a.multiply(new V(t.pos,1)),p=a.multiply(new V(r.nextPos1,1)),c=a.multiply(new V(r.nextPos2,1)),{distance:h,smallSymbolDistance:g,smallSymbolSizeThreshold:F}=this.hittestRequest,D=tt(n,F.multiply(.5)).multiply(h.subtract(g)),N=this.hittestRequest.position;return le(jt(N,l.xy,p.xy),jt(N,l.xy,c.xy)).subtract(n).add(D)}};s([m(zt)],rt.prototype,"antialiasingControls",void 0),s([C(ut)],rt.prototype,"visualVariableColor",void 0),s([C(lt)],rt.prototype,"visualVariableOpacity",void 0),s([C(Nt)],rt.prototype,"visualVariableSizeMinMaxValue",void 0),s([C($t)],rt.prototype,"visualVariableSizeScaleStops",void 0),s([C(Ot)],rt.prototype,"visualVariableSizeStops",void 0),s([C(Mt)],rt.prototype,"visualVariableSizeUnitValue",void 0),s([x(0,S(gt)),x(1,S(P))],rt.prototype,"vertex",null),s([x(0,S(ve))],rt.prototype,"fragment",null);var nt=class extends j{};s([f(3,y)],nt.prototype,"offset",void 0),s([f(4,v)],nt.prototype,"color",void 0),s([f(5,y)],nt.prototype,"normal",void 0),s([f(6,u)],nt.prototype,"halfWidth",void 0),s([f(7,u)],nt.prototype,"referenceHalfWidth",void 0),s([f(8,y)],nt.prototype,"zoomRange",void 0);var be=class extends ve{};function xe(e,t,r){let{id:n,bitset:o}=t,i=et(o,mn),a=$(i,new u(.5)),l=Br(e,t),p=T(a,l.halfWidth,new u(0)),c=Zt(e,n),h=Wt(e,n,t.color),g=T(a,t.color,h.multiply(c)),F=e.view.displayViewScreenMat3.multiply(new V(t.pos.xy,1)),D=e.clip(t.id),N=new v(F.xy,D,1),pt=T(a,l.glPosition,N),vt=r&&e.maybeRunHittest(t,r,a);return b({isOutline:i,color:g,opacity:new u(1),halfWidth:p,normal:l.normal,glPosition:pt},vt)}var J=class extends U{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}};s([m(zt)],J.prototype,"antialiasingControls",void 0),s([C(ut)],J.prototype,"visualVariableColor",void 0),s([C(lt)],J.prototype,"visualVariableOpacity",void 0),s([C(Nt)],J.prototype,"visualVariableSizeMinMaxValue",void 0),s([C($t)],J.prototype,"visualVariableSizeScaleStops",void 0),s([C(Ot)],J.prototype,"visualVariableSizeStops",void 0),s([C(Mt)],J.prototype,"visualVariableSizeUnitValue",void 0);var Jt=class extends J{vertex(t,r){return xe(this,t,r)}fragment(t){let{color:r,isOutline:n}=t,o=$(n,new u(.5)),i=Et(t,this.antialiasingControls.blur),a=T(o,i,r),l=T(o,new u(1/255),new u(0));return this.getFragmentOutput(a,t,l)}hittest(t,r,n){return T(n,Qe(this.hittestRequest),qt(this,t,r))}};s([x(0,S(nt)),x(1,S(P))],Jt.prototype,"vertex",null),s([x(0,S(be))],Jt.prototype,"fragment",null);var we=class extends ft{};s([f(5,v)],we.prototype,"tlbr",void 0),s([f(6,u)],we.prototype,"inverseRasterizationScale",void 0);var Lr=class extends at{};function co(e){let t=new u(1),r=new u(0);return new L(t.divide(e.x),r.divide(e.y),0,Ut(r.divide(e.x)),t.divide(e.y),0,0,0,1)}function Hr(e,t){let r=t.tlbr.xy,n=t.tlbr.zw,o=n.x.subtract(r.x),i=r.y.subtract(n.y),a=new y(o,i).multiply(t.inverseRasterizationScale),l=a.multiply(e.view.requiredZoomFactor),p=co(l),c=e.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(l),h=new V(t.pos,1);return{tileTextureCoord:p.multiply(h).xy.subtract(c),tlbr:t.tlbr.divide(e.mosaicInfo.size.xyxy)}}function Gr(e,t){let r=Q(e.tileTextureCoord,new u(1)),n=W(e.tlbr.xy,e.tlbr.zw,r),o=H(t.texture,n);return e.color.multiply(o)}var Yt=class extends ct{vertex(t,r){return b(b({},super.vertex(t,r)),Hr(this,t))}fragment(t){let r=Gr(t,this.mosaicInfo);return this.getFragmentOutput(r,t,new u(0))}};s([m(X)],Yt.prototype,"mosaicInfo",void 0),s([m(Z)],Yt.prototype,"localTileOffset",void 0),s([x(0,S(we)),x(1,S(P))],Yt.prototype,"vertex",null),s([x(0,S(Lr))],Yt.prototype,"fragment",null);var Se=class extends nt{};s([f(9,v)],Se.prototype,"tlbr",void 0),s([f(10,u)],Se.prototype,"inverseRasterizationScale",void 0);var Te=class extends be{},Qt=class extends Jt{vertex(t,r){return b(b({},xe(this,t,r)),Hr(this,t))}fragment(t){let{isOutline:r}=t,n=$(r,new u(.5)),o=Et(t,this.antialiasingControls.blur),i=Gr(t,this.mosaicInfo),a=T(n,o,i),l=T(n,new u(1/255),new u(0));return this.getFragmentOutput(a,t,l)}};s([m(X)],Qt.prototype,"mosaicInfo",void 0),s([m(Z)],Qt.prototype,"localTileOffset",void 0),s([x(0,S(Se)),x(1,S(P))],Qt.prototype,"vertex",null),s([x(0,S(Te))],Qt.prototype,"fragment",null);var po=16,En=1/po,mo=128,ot=class extends j{};s([f(3,v)],ot.prototype,"color",void 0),s([f(4,v)],ot.prototype,"tlbr",void 0),s([f(5,u)],ot.prototype,"angle",void 0),s([f(6,u)],ot.prototype,"aux1",void 0),s([f(7,u)],ot.prototype,"aux2",void 0),s([f(8,y)],ot.prototype,"aux3",void 0),s([f(9,y)],ot.prototype,"aux4",void 0),s([f(10,y)],ot.prototype,"zoomRange",void 0);var Kr=class extends Te{},te=class extends J{vertex(t,r){let{aux1:n,aux2:o,aux3:i,aux4:a}=t,l=Pt(b({},t),{width:n,height:o,offset:i,scale:a.multiply(En)}),p=Pt(b({},t),{halfWidth:n,referenceHalfWidth:o,offset:i,normal:a.subtract(mo).multiply(En)}),c=xe(this,p),h=Ur(this,l),g=$(c.isOutline,new u(.5));return b(b(b({},c),h),this.maybeRunHittest(t,r,g))}fragment(t){let{isOutline:r}=t,n=$(r,new u(.5)),o=Et(t,this.antialiasingControls.blur),i=Rr(this,t),a=T(n,o,i),l=T(n,new u(1/255),new u(0));return this.getFragmentOutput(a,t,l)}hittest(t,r,n){return T(n,Qe(this.hittestRequest),qt(this,t,r))}};s([m(X)],te.prototype,"mosaicInfo",void 0),s([m(Z)],te.prototype,"localTileOffset",void 0),s([x(0,S(ot)),x(1,S(P))],te.prototype,"vertex",null),s([x(0,S(Kr))],te.prototype,"fragment",null);var tr=class extends Jr{constructor(e){super(e),this.debugName="",this._updatingHandles=new tn,this._idToUpdatingState=new en}get updating(){let e=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(t=>t);if(Ie("esri-2d-log-updating")){let t=Array.from(this._idToUpdatingState.entries()).map(([r,n])=>`-> ${r}: ${n}`).join(`
`);console.log(`${this.debugName}: Updating: ${e}
-> Handles: ${this._updatingHandles.updating}
${t}`)}return e}addUpdateTracking(e,t){let r=Yr(()=>t.updating,n=>this._idToUpdatingState.set(e,n),{sync:!0});this.addHandles(r)}addPromise(e){return this._updatingHandles.addPromise(e)}};s([er({constructOnly:!0})],tr.prototype,"debugName",void 0),s([er({readOnly:!0})],tr.prototype,"updating",null),tr=s([Xr("esri.views.2d.layers.support.UpdateTracking2D")],tr);var ul=e=>e&8388607;function ll(e,t){return((t?8388608:0)|e)>>>0}export{on as a,Do as b,sn as c,fo as d,an as e,vo as f,wo as g,So as h,pn as i,dn as j,mn as k,hn as l,To as m,Vo as n,Io as o,Fo as p,_o as q,E as r,Y as s,u as t,y as u,V as v,v as w,q as x,xt as y,Ao as z,L as A,ko as B,Ut as C,Sn as D,T as E,st as F,ht as G,Uo as H,Ro as I,Bo as J,Lt as K,Tn as L,wt as M,$ as N,Ir as O,Vn as P,Lo as Q,Ht as R,$r as S,Or as T,ue as U,Fn as V,He as W,Ge as X,Tt as Y,le as Z,W as _,Ho as $,Go as aa,ce as ba,Ko as ca,jo as da,tt as ea,H as fa,fe as ga,f as ha,S as ia,m as ja,C as ka,zr as la,Gt as ma,Ze as na,Ft as oa,Xe as pa,w as qa,Je as ra,G as sa,Cn as ta,et as ua,Ki as va,Nn as wa,ji as xa,qi as ya,Wi as za,Zi as Aa,z as Ba,j as Ca,P as Da,at as Ea,U as Fa,no as Ga,oo as Ha,so as Ia,Qe as Ja,$s as Ka,ut as La,lt as Ma,Mn as Na,Wt as Oa,Zt as Pa,Bs as Qa,Ls as Ra,ct as Sa,X as Ta,Xt as Ua,Nt as Va,$t as Wa,Ot as Xa,Mt as Ya,gt as Za,uo as _a,Br as $a,rt as ab,Jt as bb,Yt as cb,Qt as db,po as eb,mo as fb,te as gb,ul as hb,ll as ib,yn as jb,gn as kb,Oo as lb,tr as mb};
