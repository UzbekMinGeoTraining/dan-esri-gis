import{t as $i}from"./chunk-MTRBRBPC.js";import{a as It}from"./chunk-UBLMESLY.js";import{a as Ft}from"./chunk-VHWLEJLO.js";import{a as ji}from"./chunk-JLACL4RV.js";import{a as A,b as Oe,c as At,h as Wi}from"./chunk-UO2ZXJZK.js";import{a as zi}from"./chunk-N5XPA5VH.js";import{o as Hi}from"./chunk-23WSQWHC.js";import{b as Se}from"./chunk-7Z3Y27UA.js";import{a as Yt}from"./chunk-BNQ5VRNF.js";import{a as bt}from"./chunk-FPZYH52G.js";import{a as Xe}from"./chunk-LHH3AZP2.js";import{a as se}from"./chunk-HVNUIUKO.js";import{b as Si,d as vt,e as Oi,f as Vi,g as qi,i as wt,j as Pi}from"./chunk-Y5M2SONX.js";import{a as Re}from"./chunk-Q6ZVH4MK.js";import{b as Ee}from"./chunk-ZGDQY5ZD.js";import{c as Ri}from"./chunk-QH2MD2O2.js";import{a as _t}from"./chunk-EN6CTWVM.js";import{c as Y,d as q,e as j}from"./chunk-JTM5BEUP.js";import{a as Qt}from"./chunk-S5E62J6M.js";import{e as u,f as Wt}from"./chunk-AKDLIRLE.js";import{f as ae,g as ft,h as yt}from"./chunk-5TKTI2G2.js";import{a as C,c as Te,d as Ei,h as E}from"./chunk-MBJHSEMD.js";import{a as Jt,b as Xt}from"./chunk-R7Q3STHM.js";import{B as Kt,I as Bi,K as ei,w as Ui}from"./chunk-7D4IYTAJ.js";import{a as Di}from"./chunk-GLWPOGYF.js";import{q as Li}from"./chunk-LAJXTVEO.js";import{p as Ni}from"./chunk-T7BKG6V3.js";import{a as Je,b as $e,d as ye}from"./chunk-S4PLWG55.js";import{b as xi,c as zt}from"./chunk-GYH7NDHH.js";import{a as Ci,g as Mi}from"./chunk-S3UQHW42.js";import{c as Z}from"./chunk-VQHENXDQ.js";import{l as gt}from"./chunk-N27U3N2T.js";import{a as Gt}from"./chunk-4R5NBZMW.js";import{a as Zt}from"./chunk-CMMPCPP5.js";import{a as oe}from"./chunk-GZXWFBZI.js";import{a as ht}from"./chunk-B7IARA3F.js";import{b as Ti}from"./chunk-IZVEJCCI.js";import{k as ki}from"./chunk-TEY6TKJV.js";import{h as mt}from"./chunk-2JF6YUJG.js";import{Q as a,S as B}from"./chunk-GGZQ5GCM.js";import{U as w}from"./chunk-TFUPB3ZG.js";import{a as o}from"./chunk-BMVJCP2M.js";import{D as xe,s as Fi,t as Ai,u as Me,w as ce,z as pt}from"./chunk-GMC3I5VG.js";import{b as ut}from"./chunk-WGF2T2BG.js";import{l as be,p as Ht,r as fe,t as S}from"./chunk-3IBUFXWY.js";import{a as Ii,f as Bt,u as Ce}from"./chunk-BP73DJTS.js";import{a as v,b as Ge,g}from"./chunk-JEGVIFEP.js";var Jr="esri.widgets.Feature.support.featureUtils",ii=()=>fe.getLogger(Jr),Xr=/href=(""|'')/gi,Yr=/(\{([^{\r\n]+)\})/g,Kr=/'/g,Xi=/^\s*expression\//i,eo=/(\n)/gi,to=/[\u00A0-\u9999<>&]/gim,io=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,ro=/^(?:mailto:|tel:)/,Yi="relationships/",Qi=xi("short-date-short-time");function Ct(e){if(e!=null)return(e.sourceLayer||e.layer)??void 0}function qe(r){return g(this,arguments,function*({type:e,value:t,event:i}){try{return typeof t=="function"?t(i):yield t}catch(s){return void ii().error("error",`An error occurred when calling the "${e}" function`,{error:s,graphic:i.graphic,value:t})}})}function Mt(e=""){if(e)return!ro.test(e.trim().toLowerCase())}function Ye(e){return!!e&&Xi.test(e)}function oo(e,t){if(!t||!Ye(t)||!e)return;let i=t.replace(Xi,"").toLowerCase();return e.find(({name:r})=>r.toLowerCase()===i)}function xt(e,t){let i=oo(t,e?.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function so(e,t){return`{${t.get(e.toLowerCase())?.fieldName||e}}`}function no(e){return e.replaceAll(Xr,"")}function ke(e,t){let i=ri(t,e);return i?i.name:e}function Ki(e,t){return e&&e.map(i=>ke(i,t))}function ri(e,t){return e&&typeof e.getField=="function"&&t?e.getField(t)??null:null}function er(e){return`${e}`.trim()}function ge({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?Tt({formattedAttributes:t,template:uo(r,v(v(v({},t),s),e),i),fieldInfoMap:n}):""}function Tt({formattedAttributes:e,template:t,fieldInfoMap:i}){return er(no(be(be(t,r=>so(r,i)),e)))}function ao(e,t,i=!1){let r=t[e];if(typeof r=="string"){let s="%27",n=(i?encodeURIComponent(r):r).replaceAll(Kr,s);t[e]=n}}function lo(e,t=!1){let i=v({},e);return Object.keys(i).forEach(r=>ao(r,i,t)),i}function co(e,t,i){let r=(t=er(t))&&t[0]!=="{";return be(e,lo(i,r||!1))}function Et(e,t){return e.replaceAll(Yr,(i,r,s)=>{let n=ri(t,s);return n?`{${n.name}}`:r})}function uo(e,t,i){let r=Et(e,i);return r&&r.replaceAll(io,(s,n,l)=>co(s,n||l,t))}function po(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){let i=Number(e);if(!isNaN(i))return i}return e}function tr(e){return e!=null&&typeof e=="object"&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&(e.type==="feature"||e.type==="scene"||e.type==="subtype-sublayer"||e.type==="sublayer")&&"when"in e}function mo(e){return e!=null&&typeof e=="object"&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function ho(e){return!!(e&&typeof e=="object"&&"createQuery"in e&&"queryFeatureCount"in e&&"type"in e)&&(e.type==="subtype-sublayer"&&"parent"in e&&e.parent&&typeof e.parent=="object"?"globalIdField"in e.parent:"globalIdField"in e)}function oi(e){return tr(e)&&mo(e)}function ir(e){return tr(e)&&ho(e)}function fo(e,t){let{fieldInfos:i,fieldName:r,preventPlacesFormatting:s,layer:n,timeZone:l}=t,d=si(i,r),c=ri(n,r);if(d&&!ei(r)){let m=c?.type,h=d.format?.dateFormat;if(m==="date"||m==="date-only"||m==="time-only"||m==="timestamp-offset"||h)return Xt(e,{format:h,fieldType:m,timeZoneOptions:{layerTimeZone:n&&"preferredTimeZone"in n?n.preferredTimeZone:null,viewTimeZone:l,datesInUnknownTimezone:!(!n||!("datesInUnknownTimezone"in n))&&!!n.datesInUnknownTimezone}})}let p=d?.format;return typeof e=="string"&&ei(r)&&p?yo(e,p):typeof(e=po(e,p))=="string"||e==null||p==null?Pe(e):$e(e,s?Ge(v({},Je(p)),{minimumFractionDigits:0,maximumFractionDigits:20}):Je(p))}function yo(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?ti(e,",",", ",t):e.includes(";")?ti(e,";","; ",t):e.includes(" ")?ti(e," "," ",t):$e(Number(e),Je(t))}function ti(e,t,i,r){return e.trim().split(t).map(s=>$e(Number(s),Je(r))).join(i)}function si(e,t){if(e?.length&&t)return e.find(i=>i.fieldName?.toLowerCase()===t.toLowerCase())}function go({fieldName:e,graphic:t,layer:i}){if(ne(e)||!i||typeof i.getFeatureType!="function")return null;let{typeIdField:r}=i;if(!r||e!==r)return null;let s=i.getFeatureType(t);return s?s.name:null}function _o({fieldName:e,value:t,graphic:i,layer:r}){if(ne(e)||!r||typeof r.getFieldDomain!="function")return null;let s=i&&r.getFieldDomain(e,{feature:i,excludeImpliedDomains:Ii("esri-widget-legacy-field-domain-calculation")});return s&&s.type==="coded-value"?s.getName(t):null}function rr(e,t,i,r){let{creatorField:s,creationDateField:n,editorField:l,editDateField:d}=e;if(!t)return;let c=Mi(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,i,Qi,"date"),p=v(v({},Qi),c),m=t[d];if(typeof m=="number"){let f=t[l];return{type:"edit",date:zt(m,p),user:f}}let h=t[n];if(typeof h=="number"){let f=t[s];return{type:"create",date:zt(h,p),user:f}}return null}function or(e,t){let i=new Map;if(!e)return i;for(let r of e){if(!r.fieldName)continue;let s=ke(r.fieldName,t);r.fieldName=s,i.set(s.toLowerCase(),r)}return i}function ni(e){let t=[];if(!e)return t;let{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){let n=s?.fieldInfos;n&&t.push(...n)}}),t}function kt(e){return e.replaceAll(to,t=>`&#${t.charCodeAt(0)};`)}function Pe(e){return typeof e=="string"?e.replaceAll(eo,'<br class="esri-text-new-line" />'):e}function sr(e){let{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:l,timeZone:d}=e;if(t==null)return"";let c=_o({fieldName:i,value:t,graphic:l,layer:n});if(c)return c;let p=go({fieldName:i,graphic:l,layer:n});if(p)return p;if(s.get(i.toLowerCase()))return fo(t,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n,timeZone:d});let m=n?.fieldsIndex?.get(i);return m&&(Jt(m)||Kt(m))?Xt(t,{fieldType:m.type,timeZoneOptions:{layerTimeZone:n&&"preferredTimeZone"in n?n.preferredTimeZone:null,viewTimeZone:d,datesInUnknownTimezone:!(!n||!("datesInUnknownTimezone"in n))&&!!n.datesInUnknownTimezone}}):Pe(t)}function Nt({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n,timeZone:l}){let d={};return n?.forEach(c=>wo({attributes:d,relatedInfo:c,fieldInfoMap:s,fieldInfos:e,layer:i,timeZone:l})),t&&Object.keys(t).forEach(c=>{let p=t[c];d[c]=sr({fieldName:c,fieldInfos:e,fieldInfoMap:s,layer:i,value:p,graphic:r,timeZone:l})}),d}function ai(e,t){return g(this,null,function*(){let{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:l,spatialReference:d}=e,c=n[0];if(typeof c!="number"&&typeof c!="string"){let m="Could not query required fields for the specified feature. The feature's ID is invalid.",h={layer:i,graphic:r,objectId:c,requiredFields:s};return ii().warn(m,h),null}if(!Li(i)?.operations?.supportsQuery){let m="The specified layer cannot be queried. The following fields will not be available.",h={layer:i,graphic:r,requiredFields:s,returnGeometry:l};return ii().warn(m,h),null}let p=i.createQuery();return p.objectIds=n,p.outFields=s?.length?s:[i.objectIdField],p.returnGeometry=!!l,p.returnZ=!!l,p.returnM=!!l,p.outSpatialReference=d,(yield i.queryFeatures(p,t)).features[0]})}function bo(e){return g(this,null,function*(){if(!e.expressionInfos?.length)return!1;let t=yield Di(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)})}function nr(n,l){return g(this,arguments,function*({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t||(typeof i.load=="function"&&(yield i.load(s)),!e.attributes))return;let d=i.objectIdField,c=e.attributes[d];if(c==null)return;let p=[c],m=yield t.getRequiredFields(i.fieldsIndex),h=Bi(m,e),f=h?[]:m.includes(d)?m:[...m,d],y=t.returnGeometry||(yield bo(t));if(h&&!y)return;let b=yield ai({layer:i,graphic:e,outFields:f,objectIds:p,returnGeometry:y,spatialReference:r},s);b&&(b.geometry&&(e.geometry=b.geometry),b.attributes&&(e.attributes=v(v({},e.attributes),b.attributes)))})}function ne(e=""){return!!e&&e.includes(Yi)}function vo(e){return e?`${Yi}${e.layerId}/${e.fieldName}`:""}function Zi({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n,timeZone:l}){e&&t&&i&&Object.keys(t.attributes).forEach(d=>{let c=vo({layerId:i.relation.id.toString(),fieldName:d}),p=t.attributes[d];e[c]=sr({fieldName:c,fieldInfos:r,fieldInfoMap:s,layer:n,value:p,graphic:t,timeZone:l})})}function wo({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:n}){e&&t&&(t.relatedFeatures?.forEach(l=>Zi({attributes:e,graphic:l,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:n})),t.relatedStatsFeatures?.forEach(l=>Zi({attributes:e,graphic:l,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:n})))}var Gi=e=>{if(!e)return!1;let t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},ar=({layer:e,method:t,query:i,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||t==="attachments")return;let s=i.where!=null?i.where:null,n=i.geometry!=null?i.geometry:null;Gi(r)||Gi(s)||n?.type==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},lr=({query:e,layer:t,method:i})=>{ar({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})},dr=({queryPayload:e,layer:t,method:i})=>{ar({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})};function cr(e,t,i){return e&&t&&i?t.type==="sublayer"?Ve({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:i})||Ve({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:i}):Ve({layers:e.allLayers,map:e,relatedLayer:t,relationship:i})||Ve({layers:e.allTables,map:e,relatedLayer:t,relationship:i}):null}function li(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find(i=>i.isUtilityLayer(t)):null}function Ji(e,t){return e?.allTables.find(i=>i.type==="feature"&&i.layerId===t.id&&i.url===t.layer?.url)}function Ve({map:e,relationship:t,relationship:{relatedTableId:i},relatedLayer:r,layers:s}){if(!s)return null;for(let n of s){if(n.type==="map-image"){let d=Ve({layers:n.sublayers,map:e,relatedLayer:r,relationship:t})||Ve({layers:n.subtables,map:e,relatedLayer:r,relationship:t});if(d)return d;continue}if(!oi(n))continue;if(r.type==="sublayer"){if(n!==r&&n.id===i)return n.isTable?Ji(e,n):n;continue}let l=r.type==="scene"&&r.associatedLayer?r.associatedLayer.url:r.url;if(!l)return null;if(n.type!=="sublayer"){if(n!==r&&n.url===l&&n.layerId===i)return n}else if(n!==r&&n.layer?.url===l&&n.id===i)return n.isTable?Ji(e,n):n}return null}var ur={editing:!1,operations:{add:!0,update:!0,delete:!0}},pr=Z.ofType(ji),K=class extends B{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities=v({},ur),this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new pr,this.fileInfos=new Z,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(C(()=>this.graphic,()=>this._graphicChanged(),E))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return v(v({},ur),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){let{graphic:e}=this;if(!e)return!1;let t=e.layer||e.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){return g(this,null,function*(){let{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new S("invalid-layer","getAttachments(): A valid layer is required.");let i=this._getObjectId();if(typeof i!="number")throw new S("invalid-object-id","getAttachments(): Numeric object id is required");let r=new Yt({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then(d=>d[i]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");let l=yield n;return t.destroyAll(),l.length&&t.addMany(l),this._getAttachmentsPromise=null,this.notifyChange("state"),l})}addAttachment(i){return g(this,arguments,function*(e,t=this.graphic){let{_attachmentLayer:r,attachmentInfos:s,capabilities:n}=this;if(!t)throw new S("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new S("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!n.operations?.add)throw new S("invalid-capabilities","addAttachment(): add capabilities are required.");if(!r||typeof r.addAttachment!="function")throw new S("invalid-layer","addAttachment(): A valid layer is required.");let l=r.addAttachment(t,e).then(c=>this._queryAttachment(c.objectId,t)),d=yield l;return s.add(d),d})}deleteAttachment(e){return g(this,null,function*(){let{_attachmentLayer:t,attachmentInfos:i,graphic:r,capabilities:s}=this;if(!e)throw new S("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations?.delete)throw new S("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new S("invalid-layer","deleteAttachment(): A valid layer is required.");if(!r)throw new S("invalid-graphic","deleteAttachment(): A graphic is required.");let n=t.deleteAttachments(r,[e.id]).then(()=>e),l=yield n;return i.remove(l),l.destroy(),l})}updateAttachment(i){return g(this,arguments,function*(e,t=this.activeAttachmentInfo){let{_attachmentLayer:r,attachmentInfos:s,graphic:n,capabilities:l}=this;if(!e)throw new S("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new S("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!l.operations?.update)throw new S("invalid-capabilities","updateAttachment(): Update capabilities are required.");let d=s.indexOf(t);if(!r||typeof r.updateAttachment!="function")throw new S("invalid-layer","updateAttachment(): A valid layer is required.");if(!n)throw new S("invalid-graphic","updateAttachment(): A graphic is required.");let c=r.updateAttachment(n,t.id,e).then(m=>this._queryAttachment(m.objectId)),p=yield c;return s.splice(d,1,p),p})}commitFiles(){return g(this,null,function*(){return yield Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()})}addFile(e,t){if(!e||!t)return null;let i={file:e,form:t};return this.fileInfos.add(i),i}updateFile(e,t,i=this.activeFileInfo){if(!e||!t||!i)return null;let r=this.fileInfos.indexOf(i);return r>-1&&this.fileInfos.splice(r,1,{file:e,form:t}),this.fileInfos.items[r]}deleteFile(e){let t=this.fileInfos.find(i=>i.file===e);return t?(this.fileInfos.remove(t),t):null}_queryAttachment(e,t){return g(this,null,function*(){let{_attachmentLayer:i}=this;if(!e||!i?.queryAttachments)throw new S("invalid-attachment-id","Could not query attachment.");let r=this._getObjectId(t);if(typeof r!="number")throw new S("invalid-object-id","getAttachments(): Numeric object id is required");let s=new Yt({objectIds:[r],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(s).then(n=>n[r][0])})}_getObjectId(e=this.graphic){return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>this.attachmentInfos.destroyAll()))}_setAttachmentLayer(){let{graphic:e}=this,t=Ct(e);this._attachmentLayer=t?t.type==="scene"&&t.associatedLayer!=null?t.associatedLayer:t:null}};o([a()],K.prototype,"capabilities",void 0),o([oe("capabilities")],K.prototype,"castCapabilities",null),o([a()],K.prototype,"activeAttachmentInfo",void 0),o([a()],K.prototype,"activeFileInfo",void 0),o([a({readOnly:!0,type:pr})],K.prototype,"attachmentInfos",void 0),o([a()],K.prototype,"fileInfos",void 0),o([a({type:se})],K.prototype,"graphic",void 0),o([a()],K.prototype,"mode",void 0),o([a({readOnly:!0})],K.prototype,"state",null),o([a()],K.prototype,"filesEnabled",void 0),o([a({readOnly:!0})],K.prototype,"supportsResizeAttachments",null),K=o([w("esri.widgets.Attachments.AttachmentsViewModel")],K);var Ke=K;function di(e){let t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function mr(e){let t=Ti("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}var hr={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},T="esri-attachments",I={base:T,loaderContainer:`${T}__loader-container`,loader:`${T}__loader`,fadeIn:`${T}--fade-in`,container:`${T}__container`,containerList:`${T}__container--list`,containerPreview:`${T}__container--preview`,actions:`${T}__actions`,deleteButton:`${T}__delete-button`,addAttachmentButton:`${T}__add-attachment-button`,errorMessage:`${T}__error-message`,items:`${T}__items`,item:`${T}__item`,itemButton:`${T}__item-button`,itemMask:`${T}__item-mask`,itemMaskIcon:`${T}__item-mask--icon`,itemImage:`${T}__image`,itemImageResizable:`${T}__image--resizable`,itemLabel:`${T}__label`,itemFilename:`${T}__filename`,itemChevronIcon:`${T}__item-chevron-icon`,itemLink:`${T}__item-link`,itemLinkOverlay:`${T}__item-link-overlay`,itemLinkOverlayIcon:`${T}__item-link-overlay-icon`,itemEditIcon:`${T}__item-edit-icon`,itemAddIcon:`${T}__item-add-icon`,itemAddButton:`${T}__item-add-button`,formNode:`${T}__form-node`,fileFieldset:`${T}__file-fieldset`,fileLabel:`${T}__file-label`,fileName:`${T}__file-name`,fileInput:`${T}__file-input`,metadata:`${T}__metadata`,metadataFieldset:`${T}__metadata-fieldset`,progressBar:`${T}__progress-bar`},ci=window.CSS,z=class extends q{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements=v({},hr),this._supportsImageOrientation=ci&&ci.supports&&ci.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e?.viewModel||(e=v({viewModel:new Ke},e)),e}initialize(){this.addHandles([Te(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),Te(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),C(()=>this.viewModel?.mode,()=>this._modeChanged(),E)])}loadDependencies(){return Y({icon:()=>import("./chunk-7ENH7JJJ.js")})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){let{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"attachment"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return v(v({},hr),e)}addAttachment(){let{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new S("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){let{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new S("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){let{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new S("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}addFile(){let e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){let{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){let t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",t}render(){let{submitting:e,viewModel:t}=this,{state:i}=t;return u("div",{class:this.classes(I.base,A.widget)},e?this._renderProgressBar():null,i==="loading"?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){let{error:e,visibleElements:t}=this;return e&&t.errorMessage?u("div",{class:I.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){let{activeFileInfo:e,mode:t,activeAttachmentInfo:i}=this.viewModel;return t==="add"?this._renderAddForm():t==="edit"?this._renderDetailsForm(i||e):this._renderAttachmentContainer()}_renderLoading(){return u("div",{class:I.loaderContainer,key:"loader"},u("div",{class:I.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?u("div",{class:I.progressBar,key:"progress-bar"}):null}_renderAddForm(){let{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?u("button",{bind:this,class:this.classes(A.button,A.buttonTertiary,A.buttonSmall,A.buttonHalf,e&&A.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?u("button",{class:this.classes(A.button,A.buttonSecondary,A.buttonSmall,A.buttonHalf,{[A.buttonDisabled]:i}),disabled:i,type:"submit"},this.messages.add):null,n=t?u("span",{class:I.fileName,key:"file-name"},t.name):null,l=u("form",{afterCreate:yt,afterRemoved:ft,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},u("fieldset",{class:I.fileFieldset},n,u("label",{class:this.classes(I.fileLabel,A.button,A.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,u("input",{bind:this,class:I.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),s,r);return u("div",{class:I.formNode,key:"add-form-container"},l)}_renderDetailsForm(e){let{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{capabilities:n}=i,l=s||!r,d,c,p,m;r?(d=r.type,c=r.name,p=r.size):e&&"file"in e?(d=e.file.type,c=e.file.name,p=e.file.size):e&&"contentType"in e&&(d=e.contentType,c=e.name,p=e.size,m=e.url);let h=n.editing&&n.operations?.delete&&t.deleteButton?u("button",{bind:this,class:this.classes(A.button,A.buttonSmall,A.buttonTertiary,I.deleteButton,{[A.buttonDisabled]:s}),disabled:s,key:"delete-button",onclick:$=>this._submitDeleteAttachment($,e),type:"button"},this.messages.delete):void 0,f=n.editing&&n.operations?.update&&t.updateButton?u("button",{class:this.classes(A.button,A.buttonSmall,A.buttonThird,{[A.buttonDisabled]:l}),disabled:l,key:"update-button",type:"submit"},this.messages.update):void 0,y=this.visibleElements.cancelUpdateButton?u("button",{bind:this,class:this.classes(A.button,A.buttonSmall,A.buttonTertiary,A.buttonThird,{[A.buttonDisabled]:s}),disabled:s,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,b=n.editing&&n.operations?.update?u("fieldset",{class:I.fileFieldset,key:"file"},u("span",{class:I.fileName,key:"file-name"},c),u("label",{class:this.classes(I.fileLabel,A.button,A.buttonSecondary)},this.messages.changeFile,u("input",{bind:this,class:I.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,F=u("fieldset",{class:I.metadataFieldset,key:"size"},u("label",null,Hi(this.messagesUnits,p??0))),x=u("fieldset",{class:I.metadataFieldset,key:"content-type"},u("label",null,d)),_=m!=null?u("a",{class:I.itemLink,href:m,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),u("div",{class:I.itemLinkOverlay},u("span",{class:I.itemLinkOverlayIcon},u("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),N=u("form",{afterCreate:yt,afterRemoved:ft,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:$=>this._submitUpdateAttachment($,e)},u("div",{class:I.metadata},F,x),b,u("div",{class:I.actions},h,y,f));return u("div",{class:I.formNode,key:"edit-form-container"},_,N)}_renderImageMask(e,t){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}_renderGenericImageMask(e,t){let{supportsResizeAttachments:i}=this.viewModel,r=mr(t),s={[I.itemImageResizable]:i};return u("div",{class:this.classes(I.itemMaskIcon,I.itemMask),key:r},u("img",{alt:e,class:this.classes(s,I.itemImage),src:r,title:e}))}_renderImageMaskForAttachment(e,t){let{supportsResizeAttachments:i}=this.viewModel;if(!e)return null;let{contentType:r,name:s,url:n}=e;if(!i||!di(r))return this._renderGenericImageMask(s,r);let l=this._getCSSTransform(e),d=l?{transform:l,"image-orientation":"none"}:{},c=`${n}${n?.includes("?")?"&":"?"}w=${t}`,p={[I.itemImageResizable]:i};return u("div",{class:this.classes(I.itemMask),key:c},u("img",{alt:s,class:this.classes(p,I.itemImage),src:c,styles:d,title:s}))}_renderFile(e){let{file:t}=e;return u("li",{class:I.item,key:t},u("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:I.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),u("label",{class:I.itemLabel},u("span",{class:I.itemFilename},t.name||this.messages.noTitle),u("span",{"aria-hidden":"true",class:this.classes(I.itemChevronIcon,ae(this.container)?Oe.left:Oe.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:t}){let{viewModel:i,effectiveDisplayType:r}=this,{capabilities:s,supportsResizeAttachments:n}=i,{contentType:l,name:d,url:c}=e,p=this._renderImageMask(e,t==="list"?48:400),m=s.editing?u("span",{"aria-hidden":"true",class:this.classes(I.itemChevronIcon,ae(this.container)?Oe.left:Oe.right)}):null,h=[p,r==="preview"&&n&&di(l)?null:u("label",{class:I.itemLabel},u("span",{class:I.itemFilename},d||this.messages.noTitle),m)],f=s.editing?u("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:I.itemButton,"data-attachment-info-id":e.id,key:"details-button",onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:"button"},h):u("a",{class:I.itemButton,href:c??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},h);return u("li",{class:I.item,key:e},f)}_renderAttachmentContainer(){let{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,capabilities:s,fileInfos:n}=t,l=!!r?.length,d=!!n?.length,c={[I.containerList]:e!=="preview",[I.containerPreview]:e==="preview"},p=s.editing&&s.operations?.add&&i.addButton?u("button",{bind:this,class:this.classes(A.button,A.buttonTertiary,I.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},u("span",{"aria-hidden":"true",class:this.classes(I.itemAddIcon,Oe.plus)}),this.messages.add):void 0,m=l?u("ul",{class:I.items,key:"attachments-list"},r.toArray().map(y=>this._renderAttachmentInfo({attachmentInfo:y,displayType:e}))):void 0,h=d?u("ul",{class:I.items,key:"file-list"},n.toArray().map(y=>this._renderFile(y))):void 0,f=d||l?void 0:u("div",{class:A.empty},this.messages.noAttachments);return u("div",{class:this.classes(I.container,c),key:"attachments-container"},m,h,f,p)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){let t=e.target,i=t.files?.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){let{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){let{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){let{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}};o([a()],z.prototype,"capabilities",null),o([a()],z.prototype,"displayType",void 0),o([a({readOnly:!0})],z.prototype,"effectiveDisplayType",null),o([a()],z.prototype,"graphic",null),o([a()],z.prototype,"icon",null),o([a()],z.prototype,"label",null),o([a(),j("esri/widgets/Attachments/t9n/Attachments")],z.prototype,"messages",void 0),o([a(),j("esri/core/t9n/Units")],z.prototype,"messagesUnits",void 0),o([a({readOnly:!0})],z.prototype,"selectedFile",void 0),o([a({readOnly:!0})],z.prototype,"submitting",void 0),o([a({readOnly:!0})],z.prototype,"error",void 0),o([a({type:Ke})],z.prototype,"viewModel",void 0),o([a()],z.prototype,"visibleElements",void 0),o([oe("visibleElements")],z.prototype,"castVisibleElements",null),z=o([w("esri.widgets.Attachments")],z);var fr=z;var et=class extends Ke{constructor(e){super(e),this.description=null,this.title=null}};o([a()],et.prototype,"description",void 0),o([a()],et.prototype,"title",void 0),et=o([w("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],et);var tt=et;var ui="esri-feature-element-info",pi={base:ui,title:`${ui}__title`,description:`${ui}__description`},je=class extends q{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return u("div",{class:pi.base},this._renderTitle(),this._renderDescription())}_renderTitle(){let{title:e}=this;return e?u(At,{class:pi.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){let{description:e}=this;return e?u("div",{class:pi.description,innerHTML:e,key:"description"}):null}};o([a()],je.prototype,"description",void 0),o([a()],je.prototype,"headingLevel",void 0),o([a()],je.prototype,"title",void 0),je=o([w("esri.widgets.Feature.support.FeatureElementInfo")],je);var ue=je;var Io={base:"esri-feature-attachments"},pe=class extends q{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new fr,this.headingLevel=2,this.viewModel=new tt}initialize(){this._featureElementInfo=new ue,this.addHandles([C(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),E),C(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,E)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{attachmentsWidget:e}=this;return u("div",{class:Io.base},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){let{description:e,title:t,headingLevel:i}=this;this._featureElementInfo?.set({description:e,title:t,headingLevel:i})}};o([a({readOnly:!0})],pe.prototype,"attachmentsWidget",void 0),o([a()],pe.prototype,"description",null),o([a()],pe.prototype,"displayType",null),o([a()],pe.prototype,"graphic",null),o([a()],pe.prototype,"headingLevel",void 0),o([a()],pe.prototype,"title",null),o([a({type:tt})],pe.prototype,"viewModel",void 0),pe=o([w("esri.widgets.Feature.FeatureAttachments")],pe);var yr=pe;var ve=class extends B{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(C(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},E))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){let{created:e,graphic:t,destroyer:i}=this;e&&t&&(qe({type:"content",value:i,event:{graphic:t}}),this._set("created",null))}_createContent(e){return g(this,null,function*(){let t=this.graphic;if(!t||!e)return;let i=qe({type:"content",value:e,event:{graphic:t}});this._loadingPromise=i,this.notifyChange("state");let r=yield i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))})}};o([a({readOnly:!0})],ve.prototype,"created",void 0),o([a()],ve.prototype,"creator",void 0),o([a()],ve.prototype,"destroyer",void 0),o([a({type:se})],ve.prototype,"graphic",void 0),o([a({readOnly:!0})],ve.prototype,"state",null),ve=o([w("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],ve);var Ne=ve;function Lt(e){return e&&typeof e.render=="function"}function gr(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}var mi="esri-feature-content",hi={base:mi,loaderContainer:`${mi}__loader-container`,loader:`${mi}__loader`},De=class extends q{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{Mt(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){let e=this.viewModel?.state;return u("div",{class:hi.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return u("div",{class:hi.loaderContainer,key:"loader"},u("div",{class:hi.loader}))}_renderCreated(){let e=this.viewModel?.created;return e?e instanceof HTMLElement?u("div",{afterCreate:this._attachToNode,bind:e,key:e}):Lt(e)?u("div",{key:e},!e.destroyed&&e.render()):u("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};o([a()],De.prototype,"creator",null),o([a()],De.prototype,"graphic",null),o([a({type:Ne})],De.prototype,"viewModel",void 0),De=o([w("esri.widgets.Feature.FeatureContent")],De);var Ue=De;var _e=class extends B{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){let{expressionInfos:e,fieldInfos:t}=this,i=[];return t?.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;let s=r.clone();s.label=xt(s,e),i.push(s)}),i}};o([a()],_e.prototype,"attributes",void 0),o([a({type:[Pi]})],_e.prototype,"expressionInfos",void 0),o([a()],_e.prototype,"description",void 0),o([a({type:[vt]})],_e.prototype,"fieldInfos",void 0),o([a({readOnly:!0})],_e.prototype,"formattedFieldInfos",null),o([a()],_e.prototype,"title",void 0),_e=o([w("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],_e);var Le=_e;var Fo=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function _r(e,t){if(typeof t!="string"||!t)return t;let i=Fo.find(c=>c.pattern.test(t));if(!i)return t;let r=t.match(i.pattern),s=r?.[2],n=be(be(i.label,{messages:e,hierPart:s}),{appName:i.appName}),l=i.target?` target="${i.target}"`:"",d=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${l} href="$1"${d}>${n}</a>`)}var $t="esri-feature-fields",Rt={base:$t,fieldHeader:`${$t}__field-header`,fieldData:`${$t}__field-data`,fieldDataDate:`${$t}__field-data--date`},le=class extends q{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new Le,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new ue,this.addHandles(C(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),E))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return u("div",{class:Rt.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(e,t){let{attributes:i}=this.viewModel,r=e.fieldName||"",s=e.label||r,n=i?i[r]==null?"":i[r]:"",l=!!e.format?.dateFormat,d=typeof n=="number"&&!l?this._forceLTR(n):_r(this.messagesURIUtils,n),c={[Rt.fieldDataDate]:l};return u("tr",{key:`fields-element-info-row-${r}-${t}`},u("th",{class:Rt.fieldHeader,innerHTML:s,key:`fields-element-info-row-header-${r}-${t}`}),u("td",{class:this.classes(Rt.fieldData,c),innerHTML:d,key:`fields-element-info-row-data-${r}-${t}`}))}_renderFields(){let{formattedFieldInfos:e}=this.viewModel;return e?.length?u("table",{class:A.table,summary:this.messages.fieldsSummary},u("tbody",null,e.map((t,i)=>this._renderFieldInfo(t,i)))):null}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};o([a()],le.prototype,"attributes",null),o([a()],le.prototype,"description",null),o([a()],le.prototype,"expressionInfos",null),o([a()],le.prototype,"fieldInfos",null),o([a()],le.prototype,"title",null),o([a({type:Le,nonNullable:!0})],le.prototype,"viewModel",void 0),o([a(),j("esri/widgets/Feature/t9n/Feature")],le.prototype,"messages",void 0),o([a(),j("esri/widgets/support/t9n/uriUtils")],le.prototype,"messagesURIUtils",void 0),le=o([w("esri.widgets.Feature.FeatureFields")],le);var St=le;var Ao="esri.widgets.Feature.support.relatedFeatureUtils",br=()=>fe.getLogger(Ao),vr=new Map;function Be(e){if(!ne(e))return null;let[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function Co(e,t){if(!t.relationships)return null;let i=null,{relationships:r}=t;return r.some(s=>s.id===parseInt(e,10)&&(i=s,!0)),i}function Mo({originRelationship:e,relationships:t,layerId:i}){return t.find(({relatedTableId:r,id:s})=>`${r}`===i&&s===e?.id)??null}function xo(e,t){let i=t.toLowerCase();for(let r in e)if(r.toLowerCase()===i)return e[r];return null}function wr(e,t){let i=Co(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function Ir(e,t){if(!t||!e)return;let{features:i,statsFeatures:r}=e,s=i?.value;t.relatedFeatures=s?s.features:[];let n=r?.value;t.relatedStatsFeatures=n?n.features:[]}function To(e,t,i,r){let s=new Xe;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],s.gdbVersion=i.gdbVersion??null,s.historicMoment=i.historicMoment??null,i.queryRelatedFeatures?.(s,r)??Promise.resolve({})}function Eo(e,t,i){let r=0,s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}function ko(e){return e?Bt(e):void 0}function No(e){return e?Bt(e,(t,i)=>JSON.stringify(t.toJSON())===JSON.stringify(i.toJSON())):void 0}function Lo(e,t,i,r){return g(this,null,function*(){let s=i.layerId.toString(),{layerInfo:n,relation:l,relatedFields:d,outStatistics:c,url:p,sourceSpatialReference:m}=t,h=ko(d),f=No(c);if(!n||!l)return null;let y=Mo({originRelationship:l,relationships:n.relationships,layerId:s});if(y?.relationshipTableId&&y.keyFieldInRelationshipTable){let F=(yield To(e,y,i,r))[e.attributes[i.objectIdField]];if(!F)return null;let x=F.features.map(_=>_.attributes[n.objectIdField]);if(f?.length&&n.supportsStatistics){let _=new Ee;_.where=Eo(n.objectIdField,x,1e3),_.outFields=h,_.outStatistics=f,_.sourceSpatialReference=m;let N={features:Promise.resolve(F),statsFeatures:It(p,_)};return ce(N)}}let b=y?.keyField;if(b){let F=Ui(Ro(n.fields,b)),x=xo(e.attributes,l.keyField),_=F?`${b}=${x}`:`${b}='${x}'`,N=i.historicMoment,$=i.gdbVersion,ie=It(p,new Ee({where:_,outFields:h,sourceSpatialReference:m,historicMoment:N,gdbVersion:$}),r),re=f?.length&&n.supportsStatistics?It(p,new Ee({where:_,outFields:h,outStatistics:f,sourceSpatialReference:m}),r):null,X={features:ie};return re&&(X.statsFeatures=re),ce(X)}return null})}function $o(e,t){return ki(e,{query:{f:"json"},signal:t?.signal})}function Fr({relatedInfos:e,layer:t},i){let r={};return e.forEach((s,n)=>{let{relation:l}=s;if(!l){let h=new S("relation-required","A relation is required on a layer to retrieve related records.");throw br().error(h),h}let{relatedTableId:d}=l;if(typeof d!="number"){let h=new S("A related table ID is required on a layer to retrieve related records.");throw br().error(h),h}let c=`${t.url}/${d}`,p=vr.get(c),m=p??$o(c);p||vr.set(c,m),r[n]=m}),Fi(ce(r),i)}function Ar({graphic:e,relatedInfos:t,layer:i},r){let s={};return t.forEach((n,l)=>{n.layerInfo&&(s[l]=Lo(e,n,i,r))}),ce(s)}function Cr({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields?.push(t),i.statisticType){let r=new Ri({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics?.push(r)}}function Ro(e,t){if(e!=null){t=t.toLowerCase();for(let i of e)if(i&&i.name.toLowerCase()===t)return i}return null}var Mr={chartAnimation:!0},D=class extends B{constructor(e){super(e),this.abilities=v({},Mr),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return v(v({},Mr),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){let{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){let{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){let{mediaInfos:e,layer:t}=this,i=this.attributes??{},r=this.formattedAttributes??{},s=this.expressionAttributes??{},n=this.fieldInfoMap??new Map;return e?.map(l=>{let d=l?.clone();return d?(d.title=ge({attributes:i,fieldInfoMap:n,globalAttributes:r,expressionAttributes:s,layer:t,text:d.title}),d.caption=ge({attributes:i,fieldInfoMap:n,globalAttributes:r,expressionAttributes:s,layer:t,text:d.caption}),d.altText=ge({attributes:i,fieldInfoMap:n,globalAttributes:r,expressionAttributes:s,layer:t,text:d.altText}),d.type==="image"?d.value?(this._setImageValue({value:d.value,formattedAttributes:r,layer:t}),d.value.sourceURL?d:void 0):void 0:d.type==="pie-chart"||d.type==="line-chart"||d.type==="column-chart"||d.type==="bar-chart"?d.value?(this._setChartValue({value:d.value,chartType:d.type,attributes:i,formattedAttributes:r,layer:t,expressionAttributes:s}),d):void 0:null):null}).filter(Ce)??[]}_setImageValue(e){let t=this.fieldInfoMap??new Map,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:l}=i;if(l){let d=Et(l,s);i.sourceURL=Tt({formattedAttributes:r,template:d,fieldInfoMap:t})}if(n){let d=Et(n,s);i.linkURL=Tt({formattedAttributes:r,template:d,fieldInfoMap:t})}}_setChartValue(e){let{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n,expressionAttributes:l}=e,{popupTemplate:d,relatedInfos:c}=this,{fields:p,normalizeField:m}=t,h=n;if(t.fields=Ki(p,h),m&&(t.normalizeField=ke(m,h)),!p.some(y=>!!(r[y]!=null||ne(y)&&c?.size)))return;let f=d?.fieldInfos??[];p.forEach((y,b)=>{let F=t.colors?.[b];if(ne(y))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:f,fieldName:y,formattedAttributes:r,chartType:s,value:t,color:F})]);let x=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,expressionAttributes:l,fieldName:y,fieldInfos:f,color:F});t.series.push(x)})}_getRelatedChartInfos(e){let{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:s,value:n,color:l}=e,d=[],c=Be(i),p=c&&this.relatedInfos?.get(c.layerId.toString());if(!p)return d;let{relatedFeatures:m,relation:h}=p;if(!h||!m)return d;let{cardinality:f}=h;return m.forEach(y=>{let{attributes:b}=y;b&&Object.keys(b).forEach(F=>{F===c.fieldName&&d.push(this._getChartOption({value:n,attributes:b,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:F,hasMultipleRelatedFeatures:m?.length>1,fieldInfos:t,color:l}))})}),f==="one-to-many"||f==="many-to-many"?d:[d[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){let{value:t,attributes:i,formattedAttributes:r,expressionAttributes:s,fieldName:n,relatedFieldName:l,fieldInfos:d,chartType:c,hasMultipleRelatedFeatures:p,color:m}=e,h=this.layer,f=this.fieldInfoMap??new Map,{normalizeField:y,tooltipField:b}=t,F=y?ne(y)?i[Be(y).fieldName]:i[y]:null,x=Ye(n)&&s&&s[n]!==void 0?s[n]:l&&i[l]!==void 0?i[l]:i[n]!==void 0?i[n]:r[n],_=new Vi({fieldName:n,color:m,value:x===void 0?null:x&&F?x/F:x});if(ne(n)){let X=f.get(n.toLowerCase()),ct=b&&f.get(b.toLowerCase()),he=X?.fieldName??n,Ut=p&&b?Be(b).fieldName:ct?.fieldName??b,Zr=p&&Ut?i[Ut]:r[Ut]??X?.label??X?.fieldName??l,Gr=p&&l?i[l]:r[he];return _.tooltip=this._getTooltip({label:Zr,value:Gr,chartType:c}),_}let N=si(d,n),$=ke(n,h),ie=b&&r[b]!==void 0?r[b]:xt(N||new vt({fieldName:$}),this.popupTemplate?.expressionInfos),re=r[$];return _.tooltip=this._getTooltip({label:ie,value:re,chartType:c}),_}};o([a()],D.prototype,"abilities",void 0),o([oe("abilities")],D.prototype,"castAbilities",null),o([a()],D.prototype,"activeMediaInfoIndex",void 0),o([a({readOnly:!0})],D.prototype,"activeMediaInfo",null),o([a()],D.prototype,"attributes",void 0),o([a()],D.prototype,"description",void 0),o([a()],D.prototype,"fieldInfoMap",void 0),o([a()],D.prototype,"formattedAttributes",void 0),o([a()],D.prototype,"expressionAttributes",void 0),o([a({readOnly:!0})],D.prototype,"formattedMediaInfos",null),o([a()],D.prototype,"isAggregate",void 0),o([a()],D.prototype,"layer",void 0),o([a({readOnly:!0})],D.prototype,"formattedMediaInfoCount",null),o([a()],D.prototype,"mediaInfos",void 0),o([a()],D.prototype,"popupTemplate",void 0),o([a()],D.prototype,"relatedInfos",void 0),o([a()],D.prototype,"title",void 0),D=o([w("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],D);var me=D;var U="esri-feature-media",G={base:U,mediaContainer:`${U}__container`,mediaItemContainer:`${U}__item-container`,mediaItem:`${U}__item`,mediaItemText:`${U}__item-text`,mediaItemTitle:`${U}__item-title`,mediaItemCaption:`${U}__item-caption`,mediaNavigation:`${U}__item-navigation`,mediaPagination:`${U}__pagination`,mediaPaginationText:`${U}__pagination-text`,mediaPrevious:`${U}__previous`,mediaPreviousIconLTR:`${U}__previous-icon`,mediaPreviousIconRTL:`${U}__previous-icon--rtl`,mediaNext:`${U}__next`,mediaNextIconLTR:`${U}__next-icon`,mediaNextIconRTL:`${U}__next-icon--rtl`,mediaChart:`${U}__chart`,mediaPaginationButton:`${U}__pagination-button`,mediaPaginationIcon:`${U}__pagination-icon`,mediaChartRendered:`${U}__chart--rendered`},fi=15,we="category",it="value",So="rgba(50, 50, 50, 1)",Oo=250,Vo=500,qo=200,J=class extends q{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new me,this.messages=null,this._disposeChart=i=>{this._chartRootMap.get(i)?.dispose(),this._chartRootMap.delete(i)},this._createChart=i=>g(this,null,function*(){let{destroyed:r,viewModel:s}=this;if(r||!s||!i)return;let{createRoot:n}=yield import("./chunk-RCDLU46I.js"),l=yield n(i);this._chartRootMap.set(i,l),this._renderChart({mediaInfo:s.activeMediaInfo,root:l})})}initialize(){this._featureElementInfo=new ue,this.addHandles([C(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),E),C(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),E)])}loadDependencies(){return Y({icon:()=>import("./chunk-7ENH7JJJ.js")})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return u("div",{bind:this,class:G.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){let{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?u("div",{class:G.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),u("div",{class:G.mediaNavigation},i,e>1?u("div",{class:G.mediaPagination},this._renderMediaPageButton("previous"),u("span",{class:G.mediaPaginationText},ye(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){let{activeMediaInfo:e}=this.viewModel;if(!e)return null;let t=e&&e.title?u("div",{class:G.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?u("div",{class:G.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?u("div",{class:G.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){if(!e.value)return null;let{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:l,title:d,type:c}=e,{sourceURL:p,linkURL:m}=s,h=Mt(m??void 0)?"_blank":"_self",f=h==="_blank"?"noreferrer":"",y=n?t:null,b=y?y.timestamp:0,F=y?y.sourceURL:p,x=u("img",{alt:l||d,key:`media-${c}-${i}-${r}-${b}`,src:F??void 0});return(m?u("a",{href:m,rel:f,target:h,title:d},x):null)??x}_renderChartMediaInfo(e){let{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return u("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:G.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){let{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){let{activeMediaInfo:e}=this.viewModel;return e?u("div",{class:G.mediaItemContainer,key:"media-container"},u("div",{class:G.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;let t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?"chevron-left":"chevron-right",s=t?"media-previous":"media-next",n=t?this._previous:this._next;return u("button",{"aria-label":i,bind:this,class:G.mediaPaginationButton,key:s,onclick:n,tabIndex:0,title:i,type:"button"},u("calcite-icon",{class:G.mediaPaginationIcon,icon:r,scale:"s"}))}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;let{isAggregate:e,layer:t}=this.viewModel;return e&&t?.featureReduction&&"renderer"in t.featureReduction?t.featureReduction.renderer:t?.renderer}_getSeriesColors(e){return g(this,null,function*(){let{colorAm5:t}=yield import("./chunk-5H6OHQP3.js"),i=new Map;return e.forEach(r=>{r.color&&i.set(r,t(r.color.toCss(!0)))}),i})}_getRendererColors(){return g(this,null,function*(){let{colorAm5:e}=yield import("./chunk-5H6OHQP3.js"),t=new Map,i=this._getRenderer(),r="default";if(!i)return t;let s=yield Wi(i);return s.delete(r),Array.from(s.values()).every(n=>n?.length===1)&&Array.from(s.keys()).forEach(n=>{let l=s.get(n)?.[0]?.toCss(!0);l&&t.set(n,e(l))}),t})}_handleMediaKeyup(e){let{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!zi()}_getChartAnimationMS(){return this._canAnimateChart()?Oo:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Vo:0}_renderChart(e){return g(this,null,function*(){let{root:t,mediaInfo:i}=e,{value:r,type:s}=i,{ResponsiveThemeAm5:n,DarkThemeAm5:l,AnimatedThemeAm5:d,ColorSetAm5:c,ThemeAm5:p,esriChartColorSet:m}=yield import("./chunk-5H6OHQP3.js"),h=p.new(t);h.rule("ColorSet").set("colors",m),h.rule("ColorSet").set("reuse",!0);let f=[n.new(t),h];Qt()&&f.push(l.new(t)),this._canAnimateChart()&&f.push(d.new(t)),t.setThemes(f);let y=yield this._getRendererColors(),b=yield this._getSeriesColors(r.series),F=c.new(t,{}),x=b.get(r.series[0]),_=x?{lineSettings:{stroke:x}}:void 0,N=r.series.map(($,ie)=>{let re=b.get($)||y.get($.fieldName)||F.getIndex(ie);return v({[we]:$.tooltip,[it]:$.value,columnSettings:{fill:re,stroke:re}},_)}).filter($=>s!=="pie-chart"||$.value!=null&&$.value>0);s==="pie-chart"?this._createPieChart(e,N):this._createXYChart(e,N)})}_getDirection(){return ae(this.container)?"rtl":"ltr"}_customizeChartTooltip(e,t="horizontal"){return g(this,null,function*(){let{colorAm5:i}=yield import("./chunk-5H6OHQP3.js");e.setAll({pointerOrientation:t}),e.get("background")?.setAll({stroke:i(So)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:qo})})}_createPieChart(e,t){return g(this,null,function*(){let{TooltipAm5:i}=yield import("./chunk-5H6OHQP3.js"),{PieChartAm5:r,PieSeriesAm5:s}=yield import("./chunk-PQTLPKVQ.js"),{mediaInfo:n,root:l}=e,{title:d}=n,c=5,p=n?.altText||n?.title||"",m=l.container.children.push(r.new(l,{ariaLabel:p,focusable:!0,paddingBottom:c,paddingTop:c,paddingLeft:c,paddingRight:c})),h=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,f=i.new(l,{labelText:h}),y=m.series.push(s.new(l,{name:d,valueField:it,categoryField:we,tooltip:f}));y.ticks.template.set("forceHidden",!0),y.labels.template.set("forceHidden",!0),y.slices.template.states.create("active",{shiftRadius:c}),this._customizeChartTooltip(f),y.slices.template.setAll({ariaLabel:h,focusable:!0,templateField:"columnSettings"}),y.data.setAll(t),y.appear(this._getChartSeriesAnimationMS()),m.appear(this._getChartAnimationMS()),m.root.dom.classList.toggle(G.mediaChartRendered,!0)})}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:s}=yield import("./chunk-5H6OHQP3.js"),{CategoryAxisAm5:n,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:c,ColumnSeriesAm5:p}=yield import("./chunk-AZCVXQVI.js"),{mediaInfo:m,root:h}=t,{value:f,title:y}=m;e.setAll({wheelX:"panX",wheelY:"zoomX"});let b=e.xAxes.push(n.new(h,{renderer:l.new(h,{inversed:ae(this.container)}),categoryField:we}));b.get("renderer").labels.template.setAll({forceHidden:!0});let F=e.yAxes.push(d.new(h,{renderer:c.new(h,{inside:!1}),min:this._getMinSeriesValue(f.series)}));F.get("renderer").labels.template.setAll({direction:this._getDirection()});let x="{categoryX}",_=r.new(h,{labelText:x}),N=e.series.push(p.new(h,{name:y,xAxis:b,yAxis:F,valueYField:it,categoryXField:we,tooltip:_}));this._customizeChartTooltip(_),N.columns.template.setAll({ariaLabel:x,focusable:!0,templateField:"columnSettings"}),f.series.length>fi&&e.set("scrollbarX",s.new(h,{orientation:"horizontal"})),b.data.setAll(i),N.data.setAll(i),N.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createBarChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:s}=yield import("./chunk-5H6OHQP3.js"),{CategoryAxisAm5:n,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:c,ColumnSeriesAm5:p}=yield import("./chunk-AZCVXQVI.js"),{mediaInfo:m,root:h}=t,{value:f,title:y}=m;e.setAll({wheelX:"panY",wheelY:"zoomY"});let b=e.yAxes.push(n.new(h,{renderer:c.new(h,{inversed:!0}),categoryField:we}));b.get("renderer").labels.template.setAll({forceHidden:!0});let F=e.xAxes.push(d.new(h,{renderer:l.new(h,{inside:!1,inversed:ae(this.container)}),min:this._getMinSeriesValue(f.series)}));F.get("renderer").labels.template.setAll({direction:this._getDirection()});let x="{categoryY}",_=r.new(h,{labelText:x}),N=e.series.push(p.new(h,{name:y,xAxis:F,yAxis:b,valueXField:it,categoryYField:we,tooltip:_}));this._customizeChartTooltip(_,"vertical"),N.columns.template.setAll({ariaLabel:x,focusable:!0,templateField:"columnSettings"}),f.series.length>fi&&e.set("scrollbarY",s.new(h,{orientation:"vertical"})),b.data.setAll(i),N.data.setAll(i),N.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createLineChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:s}=yield import("./chunk-5H6OHQP3.js"),{CategoryAxisAm5:n,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:c,LineSeriesAm5:p}=yield import("./chunk-AZCVXQVI.js"),{root:m,mediaInfo:h}=t,{value:f,title:y}=h;e.setAll({wheelX:"panX",wheelY:"zoomX"});let b=e.xAxes.push(n.new(m,{renderer:l.new(m,{inversed:ae(this.container)}),categoryField:we}));b.get("renderer").labels.template.setAll({forceHidden:!0});let F=e.yAxes.push(d.new(m,{renderer:c.new(m,{inside:!1}),min:this._getMinSeriesValue(f.series)}));F.get("renderer").labels.template.setAll({direction:this._getDirection()});let x="{categoryX}",_=i[0]?.lineSettings?.stroke,N=r.new(m,{getFillFromSprite:!_,labelText:x});_&&N.get("background")?.setAll({fill:_});let $=e.series.push(p.new(m,{name:y,xAxis:b,yAxis:F,valueYField:it,categoryXField:we,tooltip:N}));$.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(N,"vertical"),f.series.length>fi&&e.set("scrollbarX",s.new(m,{orientation:"horizontal"})),b.data.setAll(i),$.data.setAll(i),$.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createXYChart(e,t){return g(this,null,function*(){let{XYChartAm5:i,XYCursorAm5:r}=yield import("./chunk-AZCVXQVI.js"),{root:s,mediaInfo:n}=e,{type:l}=n,d=n?.altText||n?.title||"",c=s.container.children.push(i.new(s,{ariaLabel:d,focusable:!0,panX:!0,panY:!0}));c.set("cursor",r.new(s,{})),l==="column-chart"&&(yield this._createColumnChart(c,e,t)),l==="bar-chart"&&(yield this._createBarChart(c,e,t)),l==="line-chart"&&(yield this._createLineChart(c,e,t)),c.root.dom.classList.toggle(G.mediaChartRendered,!0)})}_clearMediaRefreshTimer(){let{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){let t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();let{activeMediaInfo:e}=this.viewModel;e?.type==="image"&&e?.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){let{refreshInterval:t,value:i}=e,r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);let s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=s}_getImageSource(e,t){let i=e.includes("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};o([a()],J.prototype,"_refreshIntervalInfo",void 0),o([a()],J.prototype,"attributes",null),o([a()],J.prototype,"activeMediaInfoIndex",null),o([a()],J.prototype,"description",null),o([a()],J.prototype,"fieldInfoMap",null),o([a()],J.prototype,"layer",null),o([a()],J.prototype,"mediaInfos",null),o([a()],J.prototype,"popupTemplate",null),o([a()],J.prototype,"relatedInfos",null),o([a()],J.prototype,"title",null),o([a({type:me})],J.prototype,"viewModel",void 0),o([a(),j("esri/widgets/Feature/t9n/Feature")],J.prototype,"messages",void 0),J=o([w("esri.widgets.Feature.FeatureMedia")],J);var Ot=J;function Vt(e,t,i,r){let s=null,n=1e3;typeof t=="number"?(n=t,r=i):(s=t??null,n=i);let l,d=0,c=()=>{d=0,e.apply(r,l)},p=(...m)=>{s&&s.apply(r,m),l=m,n?d||(d=setTimeout(c,n)):c()};return p.remove=()=>{d&&(clearTimeout(d),d=0)},p.forceUpdate=()=>{d&&(clearTimeout(d),c())},p.hasPendingUpdates=()=>!!d,p}var Po="esri.widgets.Feature.support.arcadeFeatureUtils",xr=()=>fe.getLogger(Po);function jo(e){return typeof e=="string"?Pe(kt(e)):Array.isArray(e)?Do(e):e?.declaredClass==="esri.arcade.Dictionary"?Uo(e):e}function Do(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?Pe(kt(t)):t}</li>`).join("")}</ul>`}function Uo(e){let t=e.keys().map(i=>{let r=e.field(i);return`<tr><th>${i}</th><td>${typeof r=="string"?Pe(kt(r)):r}</td></tr>`}).join("");return`<table class="${A.table}">${t}</table>`}function yi(){return import("./chunk-TE5ASDHF.js")}function Bo(e){return"createQuery"in e&&"queryFeatures"in e}function Ho(r){return g(this,arguments,function*({graphic:e,view:t,options:i}){let{isAggregate:s,layer:n}=e;if(!s||!n||t?.type!=="2d")return[];let l=yield t.whenLayerView(n);if(!Bo(l))return[];let d=l.createQuery(),c=e.getObjectId();d.aggregateIds=c!=null?[c]:[];let{features:p}=yield l.queryFeatures(d,i);return p})}function zo({layer:e,aggregatedFeatures:t,interceptor:i}){let{fields:r,objectIdField:s,geometryType:n,spatialReference:l,displayField:d}=e;return new Ft(Ge(v({fields:r,objectIdField:s,geometryType:n,spatialReference:l,displayField:d,interceptor:i},e.type==="feature"?{templates:e.templates,typeIdField:e.typeIdField,types:e.types}:null),{source:t}))}function gi(p){return g(this,arguments,function*({expressionInfo:e,arcade:t,interceptor:i,spatialReference:r,map:s,graphic:n,location:l,view:d,options:c}){if(!e?.expression)return null;let{isAggregate:m}=n,h=(n.sourceLayer||n.layer)??void 0,f=m?"feature-reduction-popup":"popup",y=t.createArcadeProfile(f),b=t.createArcadeExecutor(e.expression,y).catch(ie=>xr().error("arcade-executor-error",{error:ie,expressionInfo:e})),[F,x]=yield Promise.all([Ho({graphic:n,view:d,options:c}),b]);if(!x)return null;let _=f==="feature-reduction-popup"?zo({layer:h,aggregatedFeatures:F,interceptor:i}):void 0,N=Ge(v({},f==="feature-reduction-popup"?{$aggregatedFeatures:_}:{$datastore:h?.url,$layer:h!=null&&$i(h)?h:h?.type==="scene"&&h.associatedLayer!=null?h.associatedLayer:void 0,$map:s,$userInput:l,$graph:h?.type==="knowledge-graph-sublayer"?h?.parentCompositeLayer?.knowledgeGraph:void 0}),{$feature:n}),$={abortSignal:c?.signal??void 0,interceptor:i??void 0,rawOutput:!0,spatialReference:r??void 0,timeZone:d?.timeZone};return yield x.executeAsync(N,$).catch(ie=>xr().error("arcade-execution-error",{error:ie,graphic:n,expressionInfo:e})).finally(()=>_?.destroy())})}function Tr(c){return g(this,arguments,function*({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:n,location:l,options:d}){if(!e?.length)return{};let p=yield yi(),m={};for(let y of e)m[`expression/${y.name}`]=gi({expressionInfo:y,arcade:p,interceptor:r,spatialReference:t,map:s,graphic:i,location:l,view:n,options:d});let h=yield ce(m),f={};for(let y in h)f[y]=jo(h[y].value);return f})}var Wo=1,ee=class extends B{constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{let{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{let t=this.contentElement?.type;this.contentElementViewModel?.destroy();let i=t==="fields"?new Le:t==="media"?new me:t==="text"?new Ne:null;this._set("contentElementViewModel",i)},this._compile=()=>g(this,null,function*(){this._cancelQuery();let t=new AbortController;this._abortController=t,yield this._compileExpression(),this._abortController===t&&(this._abortController=null)}),this._compileThrottled=Vt(this._compile,Wo,this),this._compileExpression=()=>g(this,null,function*(){let{expressionInfo:t,graphic:i,interceptor:r,spatialReference:s,map:n,location:l,view:d,_abortController:c}=this;if(!t||!i)return void this._set("contentElement",null);let p=yield yi();if(c!==this._abortController)return;let m=yield gi({arcade:p,expressionInfo:t,graphic:i,location:l,interceptor:r,map:n,spatialReference:s,view:d});if(!m||m.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);let h=yield m.castAsJsonAsync(c?.signal),f=h?.type,y=f==="media"?qi.fromJSON(h):f==="text"?wt.fromJSON(h):f==="fields"?Oi.fromJSON(h):null;y.type==="media"&&!y.mediaInfos||y.type==="fields"&&!y.fieldInfos||y.type==="text"&&!y.text?this._set("contentElement",null):this._set("contentElement",y)}),this.addHandles([C(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),E),C(()=>[this.contentElement],()=>this._createVM(),E)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){let{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){return this.view?.map??null}set map(e){this._override("map",e)}};o([a()],ee.prototype,"_abortController",void 0),o([a({type:Si})],ee.prototype,"expressionInfo",void 0),o([a({type:se})],ee.prototype,"graphic",void 0),o([a({readOnly:!0})],ee.prototype,"contentElement",void 0),o([a({readOnly:!0})],ee.prototype,"contentElementViewModel",void 0),o([a()],ee.prototype,"interceptor",void 0),o([a({type:gt})],ee.prototype,"location",void 0),o([a()],ee.prototype,"spatialReference",null),o([a({readOnly:!0})],ee.prototype,"state",null),o([a()],ee.prototype,"map",null),o([a()],ee.prototype,"view",void 0),ee=o([w("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],ee);var rt=ee;var Er="esri-feature",kr={base:`${Er}-expression`,loadingSpinnerContainer:`${Er}__loading-container`},qt=class extends q{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new rt}initialize(){this.addHandles(C(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),E))}loadDependencies(){return Y({loader:()=>import("./chunk-DGUNVUME.js")})}destroy(){this._destroyContentWidget()}render(){let{state:e}=this.viewModel;return u("div",{class:kr.base},e==="loading"?this._renderLoading():e==="disabled"?null:this._contentWidget?.render())}_renderLoading(){return u("div",{class:kr.loadingSpinnerContainer,key:"loading-container"},u("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){let{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){let{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t?.type;this._destroyContentWidget();let r=e?i==="fields"?new St({viewModel:e}):i==="media"?new Ot({viewModel:e}):i==="text"?new Ue({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};o([a({type:rt})],qt.prototype,"viewModel",void 0),qt=o([w("esri.widgets.Feature.FeatureExpression")],qt);var Nr=qt;var Lr;(function(e){e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"})(Lr||(Lr={}));var $r=e=>{let t=[];if(e.formTemplate){let{description:i,title:r}=e.formTemplate;e.fields?.forEach(s=>{let n=r&&Ht(r,s.name),l=i&&Ht(i,s.name);(n||l)&&t.push(s.name)})}return t};var _i=100,k=class extends _t(Re(B)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{let{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{let{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{let{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=()=>g(this,null,function*(){this._cancelQuery();let t=new AbortController;this._queryAbortController=t,yield Me(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)}),this._queryFeatureCountController=()=>g(this,null,function*(){this._loaded=!1,this._cancelQueryFeatureCount();let t=new AbortController;this._queryFeatureCountAbortController=t,yield Me(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0}),this._queryPageController=()=>g(this,null,function*(){let t=new AbortController;this._queryPageAbortController=t,yield Me(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)}),this._queryDebounced=xe(this._queryController,_i),this._queryFeatureCountDebounced=xe(this._queryFeatureCountController,_i),this._queryPageDebounced=xe(this._queryPageController,_i),this._query=()=>g(this,null,function*(){let{_queryAbortController:t,relatedFeatures:i}=this;this.featureCount&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.destroyAll(),this.destroyed||i.addMany(this._sliceFeatures(yield this._queryRelatedFeatures({signal:t?.signal}))))}),this.addHandles([C(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),E),C(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),C(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){let{featuresPerPage:t,featureCount:i}=this,r=1,s=Math.ceil(i/t)||1;this._set("featurePage",Math.min(Math.max(e,r),s))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){let{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map(i=>{let r=i.clone();return r.field=ke(i.field,t),r}):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){let e=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&e?.supportsCount&&e?.supportsPagination)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new Z}get relatedLayer(){let{layer:e,map:t,relationship:i}=this;return e?.loaded&&t&&i?cr(t,e,i)??null:null}get relationship(){let{relationshipId:e,layer:t}=this;return e!=null?t?.relationships?.find(({id:i})=>i===e)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new Z}get state(){let{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:i,canQuery:r,_loaded:s,canLoad:n}=this;return t||n&&!s?"loading":e||i?"querying":r?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.destroyAll()}_queryFeatureCount(){return g(this,null,function*(){let{layer:e,relatedLayer:t,relationshipId:i,objectId:r,_queryFeatureCountAbortController:s,canQuery:n,supportsCacheHint:l}=this;if(yield e?.load(),yield t?.load(),!n||!e||!t||r==null)return void this._set("featureCount",0);let d=t.createQuery(),{historicMoment:c,gdbVersion:p}=e,m=new Xe({cacheHint:l,gdbVersion:p,historicMoment:c,relationshipId:i,returnGeometry:!1,objectIds:[r],where:d.where??void 0}),h=yield e.queryRelatedFeaturesCount(m,{signal:s?.signal});this._set("featureCount",h[r]||0)})}_sliceFeatures(e){let{showAllEnabled:t,displayCount:i}=this;return t?e:i?e.slice(0,i):[]}_queryPage(){return g(this,null,function*(){let{relatedFeatures:e,featurePage:t,showAllEnabled:i,_queryPageAbortController:r,featureCount:s}=this;!i||t<2||!s||e.addMany(yield this._queryRelatedFeatures({signal:r?.signal}))})}_queryRelatedFeatures(e){return g(this,null,function*(){let{orderByFieldsFixedCasing:t,showAllEnabled:i,featuresPerPage:r,displayCount:s,layer:n,relationshipId:l,featurePage:d,featureCount:c,relatedLayer:p,supportsCacheHint:m}=this,{canQuery:h,objectId:f}=this;if(!h||!n||!p||f==null)return[];let y=i?((d-1)*r+c)%c:0,b=i?r:s,F=p.objectIdField,x=[...t.map(he=>he.field),...$r(p),F].filter(Ce),_=t.map(he=>`${he.field} ${he.order}`),N=p.createQuery(),{historicMoment:$,gdbVersion:ie}=n,re=new Xe({orderByFields:_,start:y,num:b,outFields:x,cacheHint:m,historicMoment:$,gdbVersion:ie,relationshipId:l,returnGeometry:!1,objectIds:[f],where:N.where??void 0}),X=yield n.queryRelatedFeatures(re,{signal:e?.signal}),ct=X[f]?.features||[];return ct.forEach(he=>{he.sourceLayer=p,he.layer=p}),ct})}};o([a()],k.prototype,"_loaded",void 0),o([a()],k.prototype,"_queryAbortController",void 0),o([a()],k.prototype,"_queryPageAbortController",void 0),o([a()],k.prototype,"_queryFeatureCountAbortController",void 0),o([a({value:1})],k.prototype,"featurePage",null),o([a()],k.prototype,"featuresPerPage",void 0),o([a({readOnly:!0})],k.prototype,"orderByFieldsFixedCasing",null),o([a({readOnly:!0})],k.prototype,"supportsCacheHint",null),o([a({readOnly:!0})],k.prototype,"canLoad",null),o([a({readOnly:!0})],k.prototype,"canQuery",null),o([a()],k.prototype,"description",void 0),o([a({readOnly:!0})],k.prototype,"itemDescriptionFieldName",null),o([a({value:3})],k.prototype,"displayCount",null),o([a({type:se})],k.prototype,"graphic",void 0),o([a()],k.prototype,"layer",void 0),o([a()],k.prototype,"map",void 0),o([a({readOnly:!0})],k.prototype,"objectId",null),o([a({readOnly:!0})],k.prototype,"objectIdField",null),o([a()],k.prototype,"orderByFields",void 0),o([a({readOnly:!0})],k.prototype,"relatedFeatures",null),o([a({readOnly:!0})],k.prototype,"relatedLayer",null),o([a({readOnly:!0})],k.prototype,"relationship",null),o([a()],k.prototype,"featureCount",void 0),o([a({readOnly:!0})],k.prototype,"relatedFeatureViewModels",null),o([a()],k.prototype,"relationshipId",void 0),o([a()],k.prototype,"showAllEnabled",void 0),o([a()],k.prototype,"state",null),o([a()],k.prototype,"title",void 0),k=o([w("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],k);var ot=k;var bi,Pt="esri-feature",st=`${Pt}-relationship`,Ie={base:st,listContainer:`${st}__list`,listItem:`${st}__list-item`,listItemHidden:`${st}__list-item--hidden`,listContainerQuerying:`${st}__list--querying`,featureObserver:`${Pt}__feature-observer`,stickySpinnerContainer:`${Pt}__sticky-loading-container`,loadingSpinnerContainer:`${Pt}__loading-container`},Rr={title:!0,description:!0},H=bi=class extends q{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.flowItems=null,this.flowType="feature-relationship",this.headingLevel=2,this.viewModel=new ot,this.messages=null,this.messagesCommon=null,this.visibleElements=v({},Rr),this._increaseFeaturePage=()=>{let{state:i,showAllEnabled:r,relatedFeatures:s,featuresPerPage:n,featurePage:l}=this.viewModel;i==="ready"&&r&&s.length>=n*l&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new ue,this.addHandles([C(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),E),C(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),Te(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Y({icon:()=>import("./chunk-7ENH7JJJ.js"),list:()=>import("./chunk-CR5HHLBE.js"),"list-item":()=>import("./chunk-Z3NOTX23.js"),loader:()=>import("./chunk-DGUNVUME.js"),notice:()=>import("./chunk-5TGZ7FNZ.js")})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=ut(this._featureElementInfo)}get displayShowAllButton(){let{showAllEnabled:e,featureCount:t,displayCount:i,state:r}=this.viewModel;return!e&&!!t&&r==="ready"&&(t>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){let{messages:e}=this,{featureCount:t}=this.viewModel;return ye(e?.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return v(v({},Rr),e)}render(){let{state:e}=this.viewModel;return u("div",{class:this.classes(Ie.base,A.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_selectRecord(e){return g(this,null,function*(){let{flowItems:t,featureVisibleElements:i}=this;if(!t)return;e.abilities={relationshipContent:!0};let{default:r}=yield import("./chunk-BZZ6WIBO.js");t.push(new r({flowItems:t,flowType:this.flowType,viewModel:e,visibleElements:i}))})}_showAllRecords(){let{flowItems:e}=this;if(!e)return;let{viewModel:t,featureVisibleElements:i}=this;t.showAllEnabled=!0;let r=new bi({flowItems:e,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:t});e.push(r)}_renderStickyLoading(){return this.viewModel.state==="querying"?u("div",{class:Ie.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return u("calcite-loader",{inline:!0,label:""})}_renderLoading(){return u("div",{class:Ie.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return u("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){let e=ae(this.container)?"chevron-left":"chevron-right";return u("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderRelatedFeature(e){let{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&e.formattedAttributes?.global[t];let r=e.state==="loading";return u("calcite-list-item",{class:this.classes(Ie.listItem,{[Ie.listItemHidden]:r}),description:e.description??"",key:e.uid,label:i,onCalciteListItemSelect:()=>this._selectRecord(e)},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?u("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this._showAllRecords()},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return u("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},u("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return u("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Ie.featureObserver,key:"feature-observer"})}_renderList(){let{relatedFeatureViewModels:e}=this.viewModel;return u("calcite-list",null,e.toArray().map(t=>this._renderRelatedFeature(t)),this._renderShowAllListItem())}_renderRelatedFeatures(){let{displayListItems:e}=this,{state:t}=this.viewModel;return u("div",{class:this.classes(Ie.listContainer,{[Ie.listContainerQuerying]:t==="querying"}),key:"list-container"},e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return u("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},u("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){let{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e?.forEach(i=>{this.addHandles(C(()=>[i.title,i.state],()=>this.scheduleRender(),E),t)}),this.scheduleRender()}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,r=t.title&&this.title;this._featureElementInfo?.set({description:i,title:r,headingLevel:e})}_handleRelatedFeatureObserverChange(){return g(this,null,function*(){this._unobserveRelatedFeatureObserver();let{state:e,showAllEnabled:t}=this.viewModel;yield pt(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)})}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};o([a()],H.prototype,"_relatedFeatureIntersectionObserverNode",void 0),o([a({readOnly:!0})],H.prototype,"displayShowAllButton",null),o([a({readOnly:!0})],H.prototype,"displayListItems",null),o([a()],H.prototype,"description",null),o([a({readOnly:!0})],H.prototype,"featureCountDescription",null),o([a()],H.prototype,"featureVisibleElements",void 0),o([a()],H.prototype,"flowItems",void 0),o([a()],H.prototype,"flowType",void 0),o([a()],H.prototype,"headingLevel",void 0),o([a()],H.prototype,"title",null),o([a({type:ot})],H.prototype,"viewModel",void 0),o([a(),j("esri/widgets/Feature/t9n/Feature")],H.prototype,"messages",void 0),o([a(),j("esri/t9n/common")],H.prototype,"messagesCommon",void 0),o([a()],H.prototype,"visibleElements",void 0),o([oe("visibleElements")],H.prototype,"castVisibleElements",null),H=bi=o([w("esri.widgets.Feature.FeatureRelationship")],H);var Sr=H;var Or;(function(e){e[e.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",e[e.RTAttachment=2]="RTAttachment",e[e.RTContainment=3]="RTContainment",e[e.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",e[e.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity"})(Or||(Or={}));var nu=new ht({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"}),nt=new ht({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionMidspanConnectivity:"junction-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"});var Vr=Array.from({length:33},(e,t)=>2*t),qr=new Map([[1,"connectivity"],[2,"containment"],[3,"attachment"],[4,"junction-edge-from-connectivity"],[5,"junction-midspan-connectivity"],[6,"junction-edge-to-connectivity"]]),au=new ht({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});var de=class extends mt{constructor(e){super(e),this.assetGroupCode=null,this.assetTypeCode=null,this.globalId=null,this.networkSourceId=null,this.objectId=null,this.positionFrom=null,this.positionTo=null,this.terminalId=null}};o([a({type:Number,json:{write:!0}})],de.prototype,"assetGroupCode",void 0),o([a({type:Number,json:{write:!0}})],de.prototype,"assetTypeCode",void 0),o([a({type:String,json:{write:!0}})],de.prototype,"globalId",void 0),o([a({type:Number,json:{write:!0}})],de.prototype,"networkSourceId",void 0),o([a({type:Number,json:{write:!0}})],de.prototype,"objectId",void 0),o([a({type:Number,json:{write:!0}})],de.prototype,"positionFrom",void 0),o([a({type:Number,json:{write:!0}})],de.prototype,"positionTo",void 0),o([a({type:Number,json:{write:!0}})],de.prototype,"terminalId",void 0),de=o([w("esri.rest.networks.support.NetworkElement")],de);var Fe=de;var W=class extends mt{constructor(e){super(e),this.globalId=null,this.associationType=null,this.fromNetworkElement=null,this.toNetworkElement=null,this.geometry=null,this.errorMessage=null,this.percentAlong=null,this.errorCode=null,this.isContentVisible=null,this.status=null}readFromNetworkElement(e,t){return new Fe({globalId:t.fromGlobalId,networkSourceId:t.fromNetworkSourceId,terminalId:t.fromTerminalId})}writeFromNetworkElement(e,t){e&&(t.fromGlobalId=e.globalId,t.fromNetworkSourceId=e.networkSourceId,t.fromTerminalId=e.terminalId)}readToNetworkElement(e,t){return new Fe({globalId:t.toGlobalId,networkSourceId:t.toNetworkSourceId,terminalId:t.toTerminalId})}writeToNetworkElement(e,t){e&&(t.toGlobalId=e.globalId,t.toNetworkSourceId=e.networkSourceId,t.toTerminalId=e.terminalId)}};o([a({type:String,json:{write:!0}})],W.prototype,"globalId",void 0),o([a({type:nt.apiValues,json:{type:nt.jsonValues,read:nt.read,write:nt.write}})],W.prototype,"associationType",void 0),o([a({type:Fe,json:{write:{target:{fromGlobalId:{type:String},fromNetworkSourceId:{type:Number},fromTerminalId:{type:Number}}},read:{source:["fromGlobalId","fromNetworkSourceId","fromTerminalId"]}}})],W.prototype,"fromNetworkElement",void 0),o([Gt("fromNetworkElement")],W.prototype,"readFromNetworkElement",null),o([Zt("fromNetworkElement")],W.prototype,"writeFromNetworkElement",null),o([a({type:Fe,json:{write:{target:{toGlobalId:{type:String},toNetworkSourceId:{type:Number},toTerminalId:{type:Number}}},read:{source:["toGlobalId","toNetworkSourceId","toTerminalId"]}}})],W.prototype,"toNetworkElement",void 0),o([Gt("toNetworkElement")],W.prototype,"readToNetworkElement",null),o([Zt("toNetworkElement")],W.prototype,"writeToNetworkElement",null),o([a({type:Ni,json:{write:!0}})],W.prototype,"geometry",void 0),o([a({type:String,json:{write:!0}})],W.prototype,"errorMessage",void 0),o([a({type:Number,json:{write:!0}})],W.prototype,"percentAlong",void 0),o([a({type:Number,json:{write:!0}})],W.prototype,"errorCode",void 0),o([a({type:Boolean,json:{write:!0}})],W.prototype,"isContentVisible",void 0),o([a({type:Number,json:{write:!0}})],W.prototype,"status",void 0),W=o([w("esri.rest.networks.support.Association")],W);var Pr=W;var R={fromGlobalId:"fromglobalid",fromNetworkSourceId:"fromnetworksourceid",fromTerminalId:"fromterminalid",toGlobalId:"toglobalid",toNetworkSourceId:"tonetworksourceid",toTerminalId:"toterminalid",associationType:"associationtype",globalId:"globalid",status:"status",isContentVisible:"iscontentvisible",percentAlong:"percentalong",assetGroup:"assetgroup",assetType:"assettype"};var jr=100,M=class extends _t(Re(B)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.networkSourceIdsInUse=new Set,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.featureCount=0,this.associationTypes=null,this.showAllEnabled=!1,this.title=null,this.attachmentsFeatureCount=0,this.structureFeatureCount=0,this.contentFeatureCount=0,this.containerFeatureCount=0,this.connectivityFeatureCount=0,this._cancelQuery=()=>{let{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{let{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._queryController=t=>g(this,null,function*(){this._cancelQuery();let i=new AbortController;this._queryAbortController=i,yield Me(this._query(t)),this._queryAbortController===i&&(this._queryAbortController=null)}),this._queryFeatureCountController=()=>g(this,null,function*(){this._loaded=!1,this._cancelQueryFeatureCount();let t=new AbortController;this._queryFeatureCountAbortController=t,yield Me(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0}),this._queryDebounced=xe(this._queryController,jr),this._queryFeatureCountDebounced=xe(this._queryFeatureCountController,jr)}initialize(){this.associationTypes?.forEach(e=>{e.open=!1}),this.addHandles([...this.associationTypes?.map(e=>C(()=>e.open,()=>{e.open&&this._queryDebounced(e)}))??[],C(()=>[this.graphic,this.layer,this.map,this.associationTypes,this.objectId,this.globalId,this.canQuery],()=>this._queryFeatureCountDebounced(),E)])}destroy(){this._cancelQuery(),this._cancelQueryFeatureCount(),this._destroyAssociatedFeatureViewModels()}get supportsCacheHint(){return!!this.layer?.capabilities?.query?.supportsCacheHint}get canLoad(){return!!this.map&&!!this.associationTypes&&typeof this.globalId=="string"}get canQuery(){let e=this.layer?.capabilities?.query;return!!this.associationTypes&&typeof this.globalId=="string"&&!!e?.supportsPagination}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get globalId(){return(this.globalIdField&&this.graphic?.attributes?.[this.globalIdField])??null}get globalIdField(){let{layer:e}=this;return e?.type==="subtype-sublayer"&&e?.parent?e.parent.globalIdField??null:e?.globalIdField??null}get state(){let{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:i,canQuery:r,_loaded:s,canLoad:n}=this;return t||n&&!s?"loading":e||i?"querying":r&&this.featureCount!==0?"ready":"disabled"}get utilityNetwork(){let{layer:e,map:t}=this;return e?.loaded&&t?e?.type==="subtype-sublayer"&&e?.parent?li(t,e.parent)??null:li(t,e)??null:null}get associationsLayer(){let{utilityNetwork:e}=this;return e?.loaded?new Ft({url:e.networkSystemLayers.associationsTableUrl,gdbVersion:e.gdbVersion}):null}get attachmentsAssociations(){return this._get("attachmentsAssociations")||new Z}get structureAssociations(){return this._get("structureAssociations")||new Z}get contentAssociations(){return this._get("contentAssociations")||new Z}get containerAssociations(){return this._get("containerAssociations")||new Z}get connectivityAssociations(){return this._get("connectivityAssociations")||new Z}get associationFeatures(){return this._get("associationFeatures")||new bt}get associationViewModels(){return this._get("associationViewModels")||new Map}refresh(){this._queryFeatureCountDebounced()}_destroyAssociatedFeatureViewModels(){this.associationViewModels.forEach(e=>e.destroyAll())}_generateGlobalIdWhereClause(e,t){let{globalId:i,networkSourceIdsInUse:r}=this,{associatedNetworkSourceId:s}=e,n=t.fieldsIndex.get(R.fromGlobalId),l=t.fieldsIndex.get(R.toGlobalId),d=t.fieldsIndex.get(R.fromNetworkSourceId),c=t.fieldsIndex.get(R.toNetworkSourceId),p=s!=null,m=`(${Array.from(r.values())})`,h=p?` AND ${c.name} = ${s} AND ${c.name} IN ${m}`:"",f=p?` AND ${d.name} = ${s} AND ${d.name} IN ${m}`:"";switch(e.type){case"connectivity":return`((${n.name} = '${i}'${h}) OR (${l.name} = '${i}'${f}))`;case"attachment":case"content":return`${n.name} = '${i}'${h}`;case"container":case"structure":return`${l.name} = '${i}'${f}`;default:return""}}_generateNetworkSourceIdWhereClause(e){let{networkSourceIdsInUse:t}=this,i=`(${Array.from(t.values())})`,r=e.fieldsIndex.get(R.fromNetworkSourceId),s=e.fieldsIndex.get(R.toNetworkSourceId);return`(${r.name} IN ${i} AND ${s.name} IN ${i})`}_generateAssociationTypeWhereClause(e,t){let i=t.fieldsIndex.get(R.associationType);switch(e.type){case"attachment":case"structure":return`${i.name} = 3`;case"connectivity":return`${i.name} IN  (1, 4, 5, 6)`;case"container":case"content":return`${i.name} = 2`;default:return""}}_generateWhereClause(e,t){let i=t.fieldsIndex.get(R.status),r=`(${Vr.join(",")})`,s=`${i.name} IN ${r}`;return`(${this._generateGlobalIdWhereClause(e,t)} AND ${s} AND ${this._generateAssociationTypeWhereClause(e,t)})`}_loadUtiltyNetworks(){return g(this,null,function*(){let e=this.map;if(!e)return;yield Promise.allSettled(e.utilityNetworks?.map(r=>g(this,null,function*(){yield r.load()}))??[]);let t=r=>{if("layerId"in r&&i.isUtilityLayer(r)){let s=i.getSourceIdByLayerId(r.layerId);s!==null&&this.networkSourceIdsInUse.add(s)}},i=this.utilityNetwork;this._set("networkSourceIdsInUse",new Set),e.allLayers.forEach(t),e.allTables.forEach(t)})}_findLayersBySourceId(e){return g(this,null,function*(){let{utilityNetwork:t,map:i}=this,r=c=>{let p=c;return c.url&&p.layerId===s?c.url.replace(/\/\d+$/,"")===t?.featureServiceUrl:!1};yield t?.load();let s=t.getLayerIdBySourceId(e),n=i.allLayers.filter(r),l=i.allTables.filter(r),d=n.concat(l).toArray();return yield Promise.allSettled(d.map(c=>c.load())),d})}_clearAssociations(){this.attachmentsAssociations.removeAll(),this.structureAssociations.removeAll(),this.contentAssociations.removeAll(),this.containerAssociations.removeAll(),this.connectivityAssociations.removeAll()}_clearFeatures(){this.associationFeatures.forEach(e=>e.removeAll()),this.associationFeatures.clear()}_getAssociationsByType(e){switch(e){case"attachment":return this.attachmentsAssociations;case"structure":return this.structureAssociations;case"connectivity":return this.connectivityAssociations;case"container":return this.containerAssociations;case"content":return this.contentAssociations}}_createAssociationFromFeature(e,t){if(!e)return null;let i=qr.get(t.attributes[e.fieldsIndex.get(R.associationType).name]);return new Pr({globalId:t.attributes[e.fieldsIndex.get(R.globalId).name],fromNetworkElement:new Fe({globalId:t.attributes[e.fieldsIndex.get(R.fromGlobalId).name],networkSourceId:t.attributes[e.fieldsIndex.get(R.fromNetworkSourceId).name],terminalId:t.attributes[e.fieldsIndex.get(R.fromTerminalId).name]}),toNetworkElement:new Fe({globalId:t.attributes[e.fieldsIndex.get(R.toGlobalId).name],networkSourceId:t.attributes[e.fieldsIndex.get(R.toNetworkSourceId).name],terminalId:t.attributes[e.fieldsIndex.get(R.toTerminalId).name]}),associationType:i,status:t.attributes[e.fieldsIndex.get(R.status).name],isContentVisible:t.attributes[e.fieldsIndex.get(R.isContentVisible).name],percentAlong:t.attributes[e.fieldsIndex.get(R.percentAlong).name]})}_queryLayer(e,t,i,r,s){return g(this,null,function*(){let n=e.fieldsIndex.get(R.assetGroup),l=e.fieldsIndex.get(R.assetType),d=i!=null,c=r!=null,p="("+t.map(b=>`'${b}'`).join(", ")+")",m=d?` AND ${n?.name} = ${i}`:"",h=d&&c?` AND ${l?.name} = ${r}`:"",f=`${e.globalIdField} IN ${p}`+m+h,y=new Ee({outFields:["*"],cacheHint:this.supportsCacheHint,where:f});return yield this._queryAll(y,e,{signal:s?.signal})})}_createAssociationFeatureObjects(e,t,i,r,s,n){return g(this,null,function*(){if(e.length===0)return[];let l=new Map;for(let[c,p]of t){let m=yield this._findLayersBySourceId(c);for(let h of m)(yield this._queryLayer(h,p,r,s,n)).forEach(f=>{if(f.getEffectivePopupTemplate()&&f.layer){let y=l.get(f.attributes[h.globalIdField])??[];y.push(f),l.set(f.attributes[h.globalIdField],y)}})}let d=[];return e.toArray().forEach(c=>{let p=c.fromNetworkElement.globalId===i?c.toNetworkElement:c.fromNetworkElement;(l.get(p.globalId)??[]).forEach(m=>{let h=this.utilityNetwork?.getTerminalById(p?.terminalId)?.name;d.push({association:c,feature:m,terminalName:h})})}),d})}_parseFeatureObjects(e,t){e.forEach(i=>{let r=i?.feature,s=r.layer,n=t.get(s)??new Z;n.add(i),t.set(s,n)})}_queryAll(e,t,i){return g(this,null,function*(){let r=[],s=0,n=!1;e.num=t.sourceJSON?.maxRecordCount??2e3;do{e.start=s;let l=yield t.queryFeatures(e,i);r.push(...l.features),n=l.exceededTransferLimit,n&&(s+=l.features.length)}while(n);return r})}_queryAssociatedFeatureCount(e){return g(this,null,function*(){let{layer:t,globalId:i,supportsCacheHint:r,associationTypes:s,associationsLayer:n,utilityNetwork:l,canQuery:d}=this;if(yield Promise.allSettled([t?.load(),l?.load(),n?.load()]),this._clearAssociations(),!(d&&t&&s&&n))return;let c=n.fieldsIndex.get(R.toGlobalId).name,p=n.fieldsIndex.get(R.fromGlobalId).name,m=s.map(_=>this._generateWhereClause(_,n)),h=this._generateNetworkSourceIdWhereClause(n),f=m.join(" OR "),y=new Ee({outFields:["*"],cacheHint:r,returnGeometry:!1,where:`(${f}) AND (${h})`}),b=yield this._queryAll(y,n,{signal:e?.signal}),F=new Map;s.forEach(_=>{F.set(_.type,[])}),b.forEach(_=>{let N=n.fieldsIndex.get(R.associationType);switch(_.attributes[N.name]){case 1:case 4:case 5:case 6:_.attributes[p]===i?F.get("connectivity").push(_.attributes[c]):F.get("connectivity").push(_.attributes[p]),this.connectivityAssociations.add(this._createAssociationFromFeature(n,_));break;case 2:_.attributes[p]===i?(F.get("content").push(_.attributes[c]),this.contentAssociations.add(this._createAssociationFromFeature(n,_))):(F.get("container").push(_.attributes[p]),this.containerAssociations.add(this._createAssociationFromFeature(n,_)));break;case 3:_.attributes[p]===i?(F.get("attachment").push(_.attributes[c]),this.attachmentsAssociations.add(this._createAssociationFromFeature(n,_))):(F.get("structure").push(_.attributes[p]),this.structureAssociations.add(this._createAssociationFromFeature(n,_)))}});let x=s.map(_=>g(this,null,function*(){let{associatedNetworkSourceId:N,associatedAssetGroup:$,associatedAssetType:ie}=_,re=F.get(_.type),X=$!=null?yield this._countAssociatedFeatures(N,re,$,ie,e):re.length;switch(_.type){case"attachment":this._set("attachmentsFeatureCount",X);break;case"structure":this._set("structureFeatureCount",X);break;case"content":this._set("contentFeatureCount",X);break;case"container":this._set("containerFeatureCount",X);break;case"connectivity":this._set("connectivityFeatureCount",X)}}));yield Promise.allSettled(x)})}_countAssociatedFeatureCount(e,t,i,r,s){return g(this,null,function*(){let n=e.fieldsIndex.get(R.assetGroup),l=e.fieldsIndex.get(R.assetType),d=r!=null,c="("+t.map(f=>`'${f}'`).join(", ")+")",p=` AND ${n?.name} = ${i}`,m=d?` AND ${l?.name} = ${r}`:"",h=`${e.globalIdField} IN ${c}`+p+m;return e.queryFeatureCount({where:h,outFields:["*"],returnGeometry:!1},{signal:s?.signal})})}_countAssociatedFeatures(e,t,i,r,s){return g(this,null,function*(){if(t.length===0)return 0;let n=(yield this._findLayersBySourceId(e)).map(l=>g(this,null,function*(){return this._countAssociatedFeatureCount(l,t,i,r,s)}));return(yield Promise.all(n)).reduce((l,d)=>l+d,0)})}_queryAssociatedFeatures(e,t){return g(this,null,function*(){let{layer:i,globalId:r,associationTypes:s,associationsLayer:n,utilityNetwork:l,canQuery:d,associationFeatures:c}=this;if(yield Promise.allSettled([i?.load(),l?.load(),n?.load()]),!(d&&i&&s&&n))return;let p=this._getAssociationsByType(e.type),{associatedAssetGroup:m,associatedAssetType:h}=e,f=new Map;p.forEach(b=>{let{networkSourceId:F,elementGlobalId:x}=b.fromNetworkElement.globalId===r?{networkSourceId:b.toNetworkElement.networkSourceId,elementGlobalId:b.toNetworkElement.globalId}:{networkSourceId:b.fromNetworkElement.networkSourceId,elementGlobalId:b.fromNetworkElement.globalId},_=f.get(F)||[];_.push(x),f.set(F,_)});let y=yield this._createAssociationFeatureObjects(p,f,r,m,h,t);this._parseFeatureObjects(y,c)})}_queryFeatureCount(){return g(this,null,function*(){yield this._loadUtiltyNetworks();let{_queryFeatureCountAbortController:e,canQuery:t}=this;t?(yield this._queryAssociatedFeatureCount(e),this._set("featureCount",this.attachmentsFeatureCount+this.structureFeatureCount+this.contentFeatureCount+this.containerFeatureCount+this.connectivityFeatureCount)):this._set("featureCount",0)})}_query(e){return g(this,null,function*(){yield this._loadUtiltyNetworks();let{_queryAbortController:t}=this;this.featureCount&&(this._destroyAssociatedFeatureViewModels(),this._clearFeatures(),this.destroyed||(yield this._queryAssociatedFeatures(e,{signal:t?.signal})))})}};o([a()],M.prototype,"_loaded",void 0),o([a()],M.prototype,"_queryAbortController",void 0),o([a()],M.prototype,"_queryPageAbortController",void 0),o([a()],M.prototype,"_queryFeatureCountAbortController",void 0),o([a({readOnly:!0})],M.prototype,"supportsCacheHint",null),o([a({readOnly:!0})],M.prototype,"canLoad",null),o([a({readOnly:!0})],M.prototype,"canQuery",null),o([a()],M.prototype,"networkSourceIdsInUse",void 0),o([a()],M.prototype,"description",void 0),o([a({type:se})],M.prototype,"graphic",void 0),o([a()],M.prototype,"layer",void 0),o([a()],M.prototype,"map",void 0),o([a({readOnly:!0})],M.prototype,"objectId",null),o([a({readOnly:!0})],M.prototype,"objectIdField",null),o([a({readOnly:!0})],M.prototype,"globalId",null),o([a({readOnly:!0})],M.prototype,"globalIdField",null),o([a()],M.prototype,"featureCount",void 0),o([a()],M.prototype,"associationTypes",void 0),o([a()],M.prototype,"showAllEnabled",void 0),o([a()],M.prototype,"state",null),o([a()],M.prototype,"title",void 0),o([a({readOnly:!0})],M.prototype,"utilityNetwork",null),o([a({readOnly:!0})],M.prototype,"associationsLayer",null),o([a({readOnly:!0})],M.prototype,"attachmentsFeatureCount",void 0),o([a({readOnly:!0})],M.prototype,"structureFeatureCount",void 0),o([a({readOnly:!0})],M.prototype,"attachmentsAssociations",null),o([a({readOnly:!0})],M.prototype,"structureAssociations",null),o([a({readOnly:!0})],M.prototype,"contentFeatureCount",void 0),o([a({readOnly:!0})],M.prototype,"containerFeatureCount",void 0),o([a({readOnly:!0})],M.prototype,"contentAssociations",null),o([a({readOnly:!0})],M.prototype,"containerAssociations",null),o([a({readOnly:!0})],M.prototype,"connectivityFeatureCount",void 0),o([a({readOnly:!0})],M.prototype,"connectivityAssociations",null),o([a({readOnly:!0})],M.prototype,"associationFeatures",null),o([a({readOnly:!0})],M.prototype,"associationViewModels",null),M=o([w("esri.widgets.Feature.FeatureUtilityNetworkAssociations.FeatureUtilityNetworkAssociationsViewModel")],M);var Ae=M;var at=class extends B{constructor(e){super(e),this.title=!0,this.description=!0}};o([a({type:Boolean,nonNullable:!0})],at.prototype,"title",void 0),o([a({type:Boolean,nonNullable:!0})],at.prototype,"description",void 0),at=o([w("esri.widgets.Feature.FeatureUtilityNetworkAssociations.VisibleElements")],at);var He=at;var vi,lt="esri-feature",ze=`${lt}-relationship`,We={base:ze,listContainer:`${ze}__list`,listItem:`${ze}__list-item`,listItemHidden:`${ze}__list-item--hidden`,listContainerQuerying:`${ze}__list--querying`,featureObserver:`${lt}__feature-observer`,stickySpinnerContainer:`${lt}__sticky-loading-container`,loadingSpinnerContainer:`${lt}__loading-container`,expander:`${ze}__expander`,filterContainer:`${lt}__filter-container`},O=vi=class extends q{constructor(e,t){super(e,t),this.flowType="feature-utility-network-association-type",this.description=null,this.headingLevel=2,this.title=null,this.viewModel=new Ae,this.parentFeatureViewModel=null,this.listType=null,this.selectedLayer=null,this.flowItems=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new He,this._featuresPerPage=50,this._maxNumFeatures=1e3,this._currentFeaturePage=1,this._previewDisplayCount=3,this._associatedFeatureIntersectionObserverNode=null,this._associatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this._tooltipReferenceMap=new bt,this._filterText=""}initialize(){this.addHandles([C(()=>[this._associatedFeatureIntersectionObserverNode],()=>this._handleAssociatedFeatureObserverChange())])}loadDependencies(){return Y({chip:()=>import("./chunk-CVOMCBYR.js"),icon:()=>import("./chunk-7ENH7JJJ.js"),input:()=>import("./chunk-YYGIDEVG.js"),loader:()=>import("./chunk-DGUNVUME.js"),list:()=>import("./chunk-CR5HHLBE.js"),"list-item":()=>import("./chunk-Z3NOTX23.js"),tooltip:()=>import("./chunk-RB4IGLCN.js")})}destroy(){this._tooltipReferenceMap.clear()}get _numAssociatedFeatures(){let e=this.viewModel.associationViewModels;return this.selectedLayer?e.get(this.selectedLayer).length:0}set currentFeaturePage(e){let{_featuresPerPage:t,_numAssociatedFeatures:i}=this,r=1,s=Math.ceil(i/t)||1;this._currentFeaturePage=Math.max(Math.min(e,s),r)}get currentFeaturePage(){return this._currentFeaturePage}render(){let e=this.viewModel.associationViewModels,{state:t,showAllEnabled:i}=this.viewModel,{state:r}=this.parentFeatureViewModel??{};return u("div",{class:this.classes(We.base,A.widget)},t==="loading"||t==="querying"||r==="loading"?this._renderLoading():u("calcite-list",null,i&&this.selectedLayer?u(Wt,null,this._renderFilter(),this._renderAssociatedFeatureListPage(),this._renderFeatureObserver()):Array.from(e.keys(),s=>this._renderTypeList(s,e.get(s)))))}_renderFilter(){return u("div",{class:We.filterContainer,key:"filter"},u("calcite-input",{icon:"search",placeholder:this.messages.associationFilterPlaceholder,type:"search",onCalciteInputInput:e=>{this._filterText=e.target.value.trim().toLowerCase(),this._currentFeaturePage=1}}))}_showAllAssociations(e){let{flowItems:t,viewModel:i,description:r}=this;if(!t||!e)return;i.showAllEnabled=!0;let s=new vi({selectedLayer:e,title:e?.title,flowItems:t,parentFeatureViewModel:this.parentFeatureViewModel,featureVisibleElements:this.featureVisibleElements,description:r,visibleElements:{title:!1,description:!1},viewModel:i});t.push(s)}_renderAssociatedFeatureListPage(){let{currentFeaturePage:e,_featuresPerPage:t,_maxNumFeatures:i,_filterText:r}=this,s=Math.min(e*t,i),n=this.viewModel.associationViewModels.get(this.selectedLayer).filter(l=>Se(l.featureViewModel).toLowerCase().includes(r)).slice(0,s);return[...this._renderTooltips(n),...this._renderAssociatedFeatureList(n)]}_handleAssociatedFeatureObserverChange(){return g(this,null,function*(){this._associatedFeatureIntersectionObserverNode&&this._associatedFeatureIntersectionObserver.unobserve(this._associatedFeatureIntersectionObserverNode);let{state:e,showAllEnabled:t}=this.viewModel;yield pt(0),this._associatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._associatedFeatureIntersectionObserver.observe(this._associatedFeatureIntersectionObserverNode)})}_associatedFeatureIntersectionObserverCreated(e){this._associatedFeatureIntersectionObserverNode=e}_renderFeatureObserver(){return u("div",{afterCreate:this._associatedFeatureIntersectionObserverCreated,bind:this,class:We.featureObserver,key:"feature-observer"})}_increaseFeaturePage(){this.currentFeaturePage++}_renderLoading(){return u("div",{class:We.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderLoadingIcon(){return u("calcite-loader",{inline:!0,label:""})}isConnectivity(e){return["connectivity","junction-junction-connectivity","junction-edge-from-connectivity","junction-midspan-connectivity","junction-edge-to-connectivity"].includes(e.association.associationType)}_getConnectivityTooltip(e){switch(e){case"connectivity":case"junction-junction-connectivity":return this.messages.associationsJunctionJunction;case"junction-edge-from-connectivity":return this.messages.associationsJunctionEdgeFrom;case"junction-midspan-connectivity":return this.messages.associationsJunctionEdgeMidspan;case"junction-edge-to-connectivity":return this.messages.associationsJunctionEdgeTo;default:return""}}_renderItemTooltip(e){let{_tooltipReferenceMap:t}=this;return this.isConnectivity(e)?u("calcite-tooltip",{key:`tooltip-${e.featureViewModel.uid}`,referenceElement:t.get(e.featureViewModel.uid)},this._getConnectivityTooltip(e.association.associationType)):null}_renderConnectivityIcon(e,t){let i;switch(e){case"junction-edge-from-connectivity":i="connection-end-left";break;case"junction-edge-to-connectivity":i="connection-end-right";break;case"junction-midspan-connectivity":i="connection-middle";break;default:i="connection-to-connection"}return u("calcite-icon",{afterCreate:r=>this._tooltipReferenceMap.set(t,r),afterRemoved:()=>this._tooltipReferenceMap.delete(t),icon:i,scale:"s",slot:"content-start"})}_formatPercentAlong(e){return`${$e(e.association.percentAlong,{style:"percent",maximumFractionDigits:2})}`}_renderAssociatedFeature(e){let{featureViewModel:t}=e,i=Se(t),r=t.state==="loading",s=this._findFlowItem(t),n=s<0&&this._isParentFeature(t),l=n||s>=0,d=this.isConnectivity(e),c=d&&e.association.associationType==="junction-midspan-connectivity";return u("calcite-list-item",{class:this.classes(We.listItem,{[We.listItemHidden]:r}),description:e.terminalName??"",key:`associated-feature-type-${t.uid}`,label:i,onCalciteListItemSelect:()=>this._handleFeatureClick(n,s,t)},d?this._renderConnectivityIcon(e.association.associationType,e.featureViewModel.uid):null,c?u("calcite-chip",{scale:"s",slot:"content-end",value:e.association.percentAlong},this._formatPercentAlong(e)):null,this._renderChevronIconNode(l))}_selectAssociation(e){return g(this,null,function*(){let{flowItems:t,featureVisibleElements:i}=this;if(!t)return;e.abilities={utilityNetworkAssociationsContent:!0};let{default:r}=yield import("./chunk-BZZ6WIBO.js");t.push(new r({flowItems:t,flowType:"feature-association",viewModel:e,visibleElements:i}))})}_handleFeatureClick(e,t,i){if(e)this.flowItems.drain(r=>{"showAllEnabled"in r.viewModel&&(r.viewModel.showAllEnabled=!1),r.viewModel=null,r.destroy()});else if(t<0||!this.flowItems)this._selectAssociation(i);else for(;this.flowItems.length>t+1;){let r=this.flowItems.pop();r&&("showAllEnabled"in r.viewModel&&(r.viewModel.showAllEnabled=!1),r.viewModel=null,r.destroy())}}_featureViewModelMatch(e,t){let i=e.graphic,r=i?.layer,s=null;r?.type==="subtype-sublayer"&&r.parent?s=r.parent.globalIdField??null:r&&"globalIdField"in r&&(s=r.globalIdField);let n=s?i?.attributes[s]:null,l=t.graphic,d=l?.layer,c=null;d?.type==="subtype-sublayer"&&d.parent?c=d.parent.globalIdField??null:d&&"globalIdField"in d&&(c=d.globalIdField);let p=c?l?.attributes[c]:null;return n&&p&&n===p}_isParentFeature(e){let t=this.flowItems?.getItemAt(0);if(!t)return!1;let i=t.parentFeatureViewModel;return this._featureViewModelMatch(i,e)}_findFlowItem(e){return this.flowItems?.findIndex(t=>{if(t.flowType!=="feature")return!1;let i=t.viewModel;return this._featureViewModelMatch(i,e)})??-1}_renderTooltips(e){return e.toArray().map(t=>this._renderItemTooltip(t))}_renderAssociatedFeatureList(e){return e.toArray().map(t=>this._renderAssociatedFeature(t))}_renderChevronIconNode(e){return u("calcite-icon",{flipRtl:!0,icon:e?"move-up":"chevron-right",scale:"s",slot:"content-end"})}_renderTypeList(e,t){let{messages:i}=this,r=t.slice(0,this._previewDisplayCount),s=r.length<t.length;return u("calcite-list-item",{key:"show-all",label:e.title,open:!0,value:e.id},u("calcite-chip",{scale:"s",slot:"actions-end",value:e.id},t.length),u("calcite-list",{group:e.id},[this._renderTooltips(r),this._renderAssociatedFeatureList(r)],s?u("calcite-list-item",{description:ye(i?.numberRecords,{number:t.length.toString()}),key:"show-all-item",label:i.showAll,onCalciteListItemSelect:()=>this._showAllAssociations(e)},u("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})):null))}};o([a()],O.prototype,"flowType",void 0),o([a()],O.prototype,"description",void 0),o([a()],O.prototype,"headingLevel",void 0),o([a()],O.prototype,"title",void 0),o([a({type:Ae})],O.prototype,"viewModel",void 0),o([a()],O.prototype,"parentFeatureViewModel",void 0),o([a()],O.prototype,"listType",void 0),o([a()],O.prototype,"selectedLayer",void 0),o([a()],O.prototype,"featureVisibleElements",void 0),o([a()],O.prototype,"flowItems",void 0),o([a(),j("esri/widgets/Feature/t9n/Feature")],O.prototype,"messages",void 0),o([a(),j("esri/t9n/common")],O.prototype,"messagesCommon",void 0),o([a({type:He,nonNullable:!0})],O.prototype,"visibleElements",void 0),o([a()],O.prototype,"_featuresPerPage",void 0),o([a()],O.prototype,"_maxNumFeatures",void 0),o([a()],O.prototype,"_numAssociatedFeatures",null),o([a()],O.prototype,"_currentFeaturePage",void 0),o([a()],O.prototype,"currentFeaturePage",null),o([a()],O.prototype,"_previewDisplayCount",void 0),o([a()],O.prototype,"_associatedFeatureIntersectionObserverNode",void 0),o([a()],O.prototype,"_tooltipReferenceMap",void 0),o([a()],O.prototype,"_filterText",void 0),O=vi=o([w("esri.widgets.Feature.FeatureUtilityNetworkAssociationType")],O);var Dr=O;var jt="esri-feature",Qe=`${jt}-relationship`,dt={base:Qe,listContainer:`${Qe}__list`,listItem:`${Qe}__list-item`,listItemHidden:`${Qe}__list-item--hidden`,listContainerQuerying:`${Qe}__list--querying`,featureObserver:`${jt}__feature-observer`,stickySpinnerContainer:`${jt}__sticky-loading-container`,loadingSpinnerContainer:`${jt}__loading-container`,expander:`${Qe}__expander`},te=class extends q{constructor(e,t){super(e,t),this._featureElementInfo=null,this.flowType="feature-utility-network-associations",this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=2,this.viewModel=new Ae,this.messages=null,this.messagesCommon=null,this.visibleElements=new He}initialize(){this._featureElementInfo=new ue,this.addHandles([C(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),E)])}loadDependencies(){return Y({chip:()=>import("./chunk-CVOMCBYR.js"),icon:()=>import("./chunk-7ENH7JJJ.js"),loader:()=>import("./chunk-DGUNVUME.js"),notice:()=>import("./chunk-5TGZ7FNZ.js"),list:()=>import("./chunk-CR5HHLBE.js"),"list-item":()=>import("./chunk-Z3NOTX23.js")})}destroy(){this._featureElementInfo=ut(this._featureElementInfo)}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{state:e}=this.viewModel;return u("div",{class:this.classes(dt.base,A.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return this.viewModel.state==="querying"?u("div",{class:dt.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return u("calcite-loader",{inline:!0,label:""})}_renderLoading(){return u("div",{class:dt.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderAssociationNotFound(){return u("calcite-notice",{icon:"exclamation-mark-triangle",key:"association-not-found",kind:"danger",open:!0,scale:"s",width:"full"},u("div",{slot:"message"},this.messages?.noAssociations))}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,r=t.title&&this.title;this._featureElementInfo?.set({description:i,title:r,headingLevel:e})}_getAssociationTypeTitle(e){let{messages:t}=this;if(e.title)return e.title;switch(e.type){case"attachment":return t.associationsAttachments;case"connectivity":return t.associationsConnectivity;case"structure":return t.associationsStructure;case"content":return t.associationsContents;case"container":return t.associationsContainer}}_selectAssociationType(e){let{viewModel:t,flowItems:i,parentFeatureViewModel:r}=this;if(!i)return;let{associationTypes:s}=t;s.forEach(l=>{l.type===e.type?l.open=!0:l.open=!1});let n=new Dr({viewModel:t,parentFeatureViewModel:r,listType:e,title:this._getAssociationTypeTitle(e),featureVisibleElements:this.featureVisibleElements,description:this.parentFeatureViewModel?.title,flowItems:i});i.push(n)}_renderAssociationType(e){let t=this._getAssociationTypeTitle(e);return u("calcite-list-item",{description:e.description,key:`association-type-${e.type}`,label:t,value:e.type,onCalciteListItemSelect:()=>this._selectAssociationType(e)},u("calcite-chip",{scale:"s",slot:"content-end",value:e.type},this._getFeatureCount(e.type)),u("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_getFeatureCount(e){switch(e){case"attachment":return this.viewModel.attachmentsFeatureCount;case"structure":return this.viewModel.structureFeatureCount;case"content":return this.viewModel.contentFeatureCount;case"container":return this.viewModel.containerFeatureCount;case"connectivity":return this.viewModel.connectivityFeatureCount}}_renderAssociations(e){return u("div",null,this._getFeatureCount(e.type)>0?this._renderAssociationType(e):null)}_renderContent(){let{state:e,associationTypes:t}=this.viewModel;return u("div",{class:this.classes(dt.listContainer,{[dt.listContainerQuerying]:e==="querying"}),key:"list-container"},e==="ready"?u("calcite-list",null,t.map(i=>this._renderAssociations(i))):null,this._renderStickyLoading())}};o([a()],te.prototype,"flowType",void 0),o([a()],te.prototype,"flowItems",void 0),o([a()],te.prototype,"parentFeatureViewModel",void 0),o([a()],te.prototype,"featureVisibleElements",void 0),o([a()],te.prototype,"description",null),o([a()],te.prototype,"headingLevel",void 0),o([a()],te.prototype,"title",null),o([a({type:Ae})],te.prototype,"viewModel",void 0),o([a(),j("esri/widgets/Feature/t9n/Feature")],te.prototype,"messages",void 0),o([a(),j("esri/t9n/common")],te.prototype,"messagesCommon",void 0),o([a({type:He,nonNullable:!0})],te.prototype,"visibleElements",void 0),te=o([w("esri.widgets.Feature.FeatureUtilityNetworkAssociations")],te);var Ur=te;var Dt=class{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}};var Ze,Qo=1,Br="content-view-models",Hr="relationship-view-models",Zo="association-view-models",zr={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0,utilityNetworkAssociationsContent:!0},L=Ze=class extends Re(B){constructor(e){super(e),this._error=null,this._featureAbortController=null,this._associationVMAbortController=null,this._graphicChangedThrottled=Vt(this._graphicChanged,Qo,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=v({},zr),this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{let{abilities:i}=this;return t.type==="attachments"&&!!i.attachmentsContent||t.type==="custom"&&!!i.customContent||t.type==="fields"&&!!i.fieldsContent||t.type==="media"&&!!i.mediaContent||t.type==="text"&&!!i.textContent||t.type==="expression"&&!!i.expressionContent||t.type==="relationship"&&!!i.relationshipContent||t.type==="utility-network-associations"&&!!i.utilityNetworkAssociationsContent},this.addHandles(C(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),E))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return or(ni(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Ct(this.graphic)}castAbilities(e){return v(v({},zr),e)}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._featureAbortController=new AbortController,this._set("graphic",e?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){return this.view?.timeZone??Ci}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){return this.view?.map||null}set map(e){this._override("map",e)}get waitingForContent(){return!(!this._featureAbortController&&!this._associationVMAbortController)}setActiveMedia(e,t){let i=this.contentViewModels[e];i instanceof me&&i.setActiveMedia(t)}nextMedia(e){let t=this.contentViewModels[e];t instanceof me&&t.next()}previousMedia(e){let t=this.contentViewModels[e];t instanceof me&&t.previous()}updateGeometry(){return g(this,null,function*(){let{graphic:e,spatialReference:t,_sourceLayer:i}=this;yield i?.load();let r=i?.objectIdField;if(!r||!e||!i)return;let s=e?.attributes?.[r];if(s==null)return;let n=[s];if(!e.geometry){let l=yield ai({layer:i,graphic:e,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:t}),d=l?.geometry;d&&(e.geometry=d)}})}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){return g(this,null,function*(){this._cancelFeatureQuery(),this._error=null,this._clear();let{graphic:e}=this;if(!e)return;let t=new AbortController;this._featureAbortController=t;try{yield this._queryFeature({signal:t.signal})}catch(i){Ai(i)||(this._error=i,fe.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)})}_cancelFeatureQuery(){let{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):e.type==="utility-network-associations"?this._compileUtilityNetworkAssociation(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)).filter(Ce):typeof e=="string"?this._compileText(new wt({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(Hr),this.removeHandles(Br),this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){let i=e?.graphic?.getObjectId(),r=t?.getObjectId();return i!=null&&r!=null&&i===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:i}){let{view:r,spatialReference:s,timeZone:n}=this;t?.filter(Boolean).forEach(l=>{e.some(d=>this._matchesFeature(d,l))||e.add(new Ze({abilities:{relationshipContent:!1},map:i,view:r,spatialReference:s,timeZone:n,graphic:l}))}),e.forEach(l=>{t?.find(c=>this._matchesFeature(l,c))||e.remove(l)})}_setExpressionContentVM(e,t){let i=this.formattedAttributes,{contentElement:r,contentElementViewModel:s}=e,n=r?.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileRelationship(e,t){let{displayCount:i,orderByFields:r,relationshipId:s,title:n,description:l}=e,{_sourceLayer:d,graphic:c,map:p}=this;if(!oi(d))return;let m=new ot(v({displayCount:i,graphic:c,orderByFields:r,relationshipId:s,layer:d,map:p},this._compileTitleAndDesc({title:n,description:l})));return this.contentViewModels[t]=m,this.addHandles(Te(()=>m.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(m)),Hr),e}_matchesGlobalFeature(e,t){let i=e?.association.globalId,r=t?.association.globalId;return i!=null&&r!=null&&i===r}_setUpUtilityNetworkAssociationsViewModels(e,t,i){return g(this,null,function*(){let{view:r,spatialReference:s,timeZone:n}=this;e.forEach((d,c)=>{let p=t.get(c);p?d.forEach(m=>{p.find(h=>this._matchesGlobalFeature(m,h))||(d.remove(m),d.length===0&&e.delete(c))}):(d.removeAll(),e.delete(c))}),t.forEach((d,c)=>{let p=e.get(c)||new Z;d?.filter(Boolean).forEach(m=>{p.some(h=>this._matchesGlobalFeature(h,m))||p.add({association:m.association,featureViewModel:new Ze({abilities:{utilityNetworkAssociationsContent:!1},map:i,view:r,spatialReference:s,timeZone:n,graphic:m.feature}),terminalName:m.terminalName})}),e.set(c,p)});let l=new AbortController;this._associationVMAbortController=l,yield this._sortListObjectsByTitle(e,{signal:l.signal}),this._associationVMAbortController===l&&(this._associationVMAbortController=null)})}_sortListObjectsByTitle(e,t){return g(this,null,function*(){for(let i of e.values()){let r=i.map(s=>Ei(()=>s.featureViewModel.state==="ready",t?.signal));yield Promise.all(r),i.sort(this._compareByFeatureTitle)}})}_compareByFeatureTitle(e,t){let i=Se(e.featureViewModel),r=Se(t.featureViewModel);return i.localeCompare(r,void 0,{numeric:!0})}_compileUtilityNetworkAssociation(e,t){let{title:i,description:r,associationTypes:s}=e,{_sourceLayer:n,graphic:l,map:d}=this;if(!ir(n))return;let c=new Ae(v({graphic:l,associationTypes:s,layer:n,map:d},this._compileTitleAndDesc({title:i,description:r})));return this.contentViewModels[t]=c,this.addHandles([C(()=>c.associationFeatures.values(),()=>this._setUpUtilityNetworkAssociationsViewModels(c.associationViewModels,c.associationFeatures,c.map))],Zo),e}_compileExpression(e,t){let{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:n,view:l,location:d}=this,c=new rt({expressionInfo:i,graphic:r,interceptor:Ze.interceptor,map:s,spatialReference:n,view:l,location:d});return this.contentViewModels[t]=c,this.addHandles(C(()=>c.contentElementViewModel,()=>this._setExpressionContentVM(c,t),E),Br),e}_compileAttachments(e,t){let{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new tt(v({graphic:i},this._compileTitleAndDesc({title:s,description:r}))),e}_compileCustom(e,t){let{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new Ne({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){let{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n}=this,l=s?.attributes,d=this._expressionAttributes,c=n.global;return{title:ge({attributes:l,fieldInfoMap:i,globalAttributes:c,expressionAttributes:d,layer:r,text:e}),description:ge({attributes:l,fieldInfoMap:i,globalAttributes:c,expressionAttributes:d,layer:r,text:t})}}_createFieldsVMParams(e,t){let i=this._effectivePopupTemplate,r=this.formattedAttributes,s=v(v({},r?.global),r?.content[t]),n=e?.fieldInfos||i?.fieldInfos,l=n?.filter(({fieldName:m})=>!!m&&(Ye(m)||ne(m)||s.hasOwnProperty(m))),d=i?.expressionInfos,{description:c,title:p}=e;return v({attributes:s,expressionInfos:d,fieldInfos:l},this._compileTitleAndDesc({title:p,description:c}))}_compileFields(e,t){let i=e.clone(),r=new Le(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(),i}_createMediaVMParams(e,t){let{abilities:i,graphic:r,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:l,_sourceLayer:d,_expressionAttributes:c}=this,p=this.formattedAttributes,m=r?.attributes??{},{description:h,mediaInfos:f,title:y}=e;return v({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:m,isAggregate:r?.isAggregate,layer:d,fieldInfoMap:s,formattedAttributes:v(v({},p?.global),p?.content[t]),expressionAttributes:c,mediaInfos:f,popupTemplate:n,relatedInfos:l},this._compileTitleAndDesc({title:y,description:h}))}_compileMedia(e,t){let i=e.clone(),r=new me(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(),this.contentViewModels[t]=r,i}_createTextVMParams(e){let{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){let n=t?.attributes??{},l=this.formattedAttributes?.global??{};e.text=ge({attributes:n,fieldInfoMap:i,globalAttributes:l,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){let i=e.clone();return this.contentViewModels[t]=new Ne(this._createTextVMParams(i)),i}_compileLastEditInfo(){let{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:r}=this;if(!e)return;let{lastEditInfoEnabled:s}=e,n=t?.editFieldsInfo;return s&&n?rr(n,i?.attributes,r,t):void 0}_compileTitle(e){let{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,n=r?.attributes??{},l=this.formattedAttributes?.global??{};return ge({attributes:n,fieldInfoMap:t,globalAttributes:l,expressionAttributes:s,layer:i,text:e})}_getTitle(){return g(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?qe({type:"title",value:e?.title,event:{graphic:t}}):null})}_getContent(){return g(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?qe({type:"content",value:e?.content,event:{graphic:t}}):null})}_queryFeature(e){return g(this,null,function*(){let{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s}=this,n=this.map,l=this.view,d=this.spatialReference,c=this.location;if(t!==this._featureAbortController||!r)return;yield nr({graphic:r,popupTemplate:s,layer:i,spatialReference:d},e);let{content:{value:p},title:{value:m}}=yield ce({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:h}}=yield ce({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:Tr({expressionInfos:s?.expressionInfos,spatialReference:d,graphic:r,map:n,interceptor:Ze.interceptor,view:l,options:e,location:c})});t===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes=v(v({},r.attributes),h),this._set("formattedAttributes",this._createFormattedAttributes(p)),this._set("title",this._compileTitle(m)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(p)||null))})}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){let{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:l,_fieldInfoMap:d,_graphicExpressionAttributes:c,timeZone:p}=this;i.content[t]=Nt({fieldInfos:r?.fieldInfos,graphic:s,attributes:v(v({},c),e.attributes),layer:l,fieldInfoMap:d,relatedInfos:n,timeZone:p})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){let{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:l,_graphicExpressionAttributes:d,timeZone:c}=this;i.content[t]=Nt({fieldInfos:e.fieldInfos,graphic:r,attributes:v(v({},d),e.attributes),layer:n,fieldInfoMap:l,relatedInfos:s,timeZone:c})}}_createFormattedAttributes(e){let{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:l,timeZone:d}=this,c=t?.fieldInfos,p={global:Nt({fieldInfos:c,graphic:i,attributes:l,layer:s,fieldInfoMap:n,relatedInfos:r,timeZone:d}),content:[]};return Array.isArray(e)&&e.forEach((m,h)=>{m.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:m,contentElementIndex:h,formattedAttributes:p}),m.type==="media"&&this._createMediaFormattedAttributes({contentElement:m,contentElementIndex:h,formattedAttributes:p})}),p}_checkForRelatedFeatures(e){let{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,ni(i),e)}_queryRelatedInfos(e,t,i){return g(this,null,function*(){let{relatedInfos:r,_sourceLayer:s}=this;r.clear();let n=s?.associatedLayer!=null?yield s?.associatedLayer.load(i):s;if(!n||!e||!t.filter(p=>!!p.fieldName&&ne(p.fieldName))?.length)return;t.forEach(p=>this._configureRelatedInfo(p,n));let d=yield Fr({relatedInfos:r,layer:n},i);Object.keys(d).forEach(p=>{let m=r.get(p.toString()),h=d[p]?.value;m&&h&&(m.layerInfo=h.data)});let c=yield Ar({graphic:e,relatedInfos:r,layer:n},i);Object.keys(c).forEach(p=>{Ir(c[p]?.value,r.get(p.toString()))})})}_configureRelatedInfo(e,t){let{relatedInfos:i}=this,r=Be(e.fieldName||"");if(!r)return;let{layerId:s,fieldName:n}=r;if(!s)return;let l=i.get(s.toString())||wr(s,t);l&&(Cr({relatedInfo:l,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,l))}};L.interceptor=new Dt(lr,dr),o([a()],L.prototype,"_error",void 0),o([a()],L.prototype,"_featureAbortController",void 0),o([a()],L.prototype,"_associationVMAbortController",void 0),o([a({readOnly:!0})],L.prototype,"_effectivePopupTemplate",null),o([a({readOnly:!0})],L.prototype,"_fieldInfoMap",null),o([a({readOnly:!0})],L.prototype,"_sourceLayer",null),o([a()],L.prototype,"abilities",void 0),o([oe("abilities")],L.prototype,"castAbilities",null),o([a({readOnly:!0})],L.prototype,"content",void 0),o([a({readOnly:!0})],L.prototype,"contentViewModels",void 0),o([a()],L.prototype,"description",void 0),o([a({type:Boolean})],L.prototype,"defaultPopupTemplateEnabled",void 0),o([a({readOnly:!0})],L.prototype,"isTable",null),o([a({readOnly:!0})],L.prototype,"state",null),o([a({readOnly:!0})],L.prototype,"formattedAttributes",void 0),o([a({type:se,value:null})],L.prototype,"graphic",null),o([a({readOnly:!0})],L.prototype,"lastEditInfo",void 0),o([a({type:gt})],L.prototype,"location",void 0),o([a({readOnly:!0})],L.prototype,"relatedInfos",void 0),o([a()],L.prototype,"spatialReference",null),o([a()],L.prototype,"timeZone",null),o([a({readOnly:!0})],L.prototype,"title",void 0),o([a()],L.prototype,"map",null),o([a({readOnly:!0})],L.prototype,"waitingForContent",null),o([a()],L.prototype,"view",void 0),L=Ze=o([w("esri.widgets.Feature.FeatureViewModel")],L);var wi=L;var Q="esri-feature",V={base:Q,container:`${Q}__size-container`,title:`${Q}__title`,main:`${Q}__main-container`,btn:`${Q}__button`,icon:`${Q}__icon`,content:`${Q}__content`,contentNode:`${Q}__content-node`,contentNodeText:`${Q}__content-node--text`,contentElement:`${Q}__content-element`,text:`${Q}__text`,lastEditedInfo:`${Q}__last-edited-info`,fields:`${Q}__fields`,fieldHeader:`${Q}__field-header`,fieldData:`${Q}__field-data`,fieldDataDate:`${Q}__field-data--date`,loadingSpinnerContainer:`${Q}__loading-container`};var Wr=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>Lt(i)&&!i.destroyed?u("div",{class:V.contentNode,key:i},i.render()):i instanceof HTMLElement?u("div",{afterCreate:this._attachToNode,bind:i,class:V.contentNode,key:i}):gr(i)?u("div",{afterCreate:this._attachToNode,bind:i.domNode,class:V.contentNode,key:i}):null}_attachToNode(i){let r=this;i.appendChild(r)}};return t=o([w("esri.widgets.Feature.support.FeatureContentMixin")],t),t};var Qr={title:!0,content:!0,lastEditedInfo:!0},P=class extends Wr(q){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowType="feature",this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements=v({},Qr),this.viewModel=new wi}initialize(){this.addHandles(C(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),E))}loadDependencies(){return Y({notice:()=>import("./chunk-5TGZ7FNZ.js"),loader:()=>import("./chunk-DGUNVUME.js")})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return v(v({},Qr),e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){let{state:e}=this.viewModel,t=u("div",{class:V.container,key:"container"},this._renderTitle(),e==="error"?this._renderError():e==="loading"?this._renderLoading():this._renderContentContainer());return u("div",{class:this.classes(V.base,A.widget)},t)}_renderError(){let{messagesCommon:e,messages:t,visibleElements:i}=this;return u("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?u("div",{key:"error-title",slot:"title"},e.errorMessage):null,u("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return u("div",{class:V.loadingSpinnerContainer,key:"loading-container"},u("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){let{visibleElements:e}=this;return e.content?u("div",{class:V.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){let{visibleElements:e,title:t}=this;return e.title?u(At,{class:V.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){let e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?u("div",{class:V.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e=="string"){let i=this._contentWidgets[0];return!i||i.destroyed?null:u("div",{class:this.classes(V.contentNode,V.contentNodeText),key:`${t}-content`},i.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){let{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content?.[e.type])return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);case"utility-network-associations":return this._renderAssociation(t);default:return null}}_renderAttachments(e){let t=this._contentWidgets[e];if(!t||t.destroyed)return null;let{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?u("div",{class:this.classes(V.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?u("div",{class:V.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderAssociation(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?u("div",{class:V.contentElement,key:this._buildKey("utility-network-association-element",e)},t.render()):null}_renderExpression(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&t.viewModel.contentElement?u("div",{class:V.contentElement,key:this._buildKey("expression-element",e)},t.render()):null}_renderCustom(e,t){let{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?u("div",{class:V.contentElement,key:this._buildKey("custom-element",t)},r.render()):null}_renderFields(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:u("div",{class:V.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:u("div",{class:V.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){let{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;let{date:r,user:s}=i,n=i.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,l=ye(n,{date:r,user:s});return u("div",{class:this.classes(V.lastEditedInfo,V.contentElement),key:"edit-info-element"},l)}_renderText(e,t){let i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?u("div",{class:this.classes(V.contentElement,V.text),key:this._buildKey("text-element",t)},r.render()):null}_buildKey(e,...t){return`${e}__${this.viewModel?.graphic?.uid||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();let{headingLevel:e,visibleElements:t,flowItems:i,viewModel:r}=this,s=r?.content,{contentViewModels:n}=r;if(Array.isArray(s))s.forEach((l,d)=>{if(l.type==="attachments"&&(this._contentWidgets[d]=new yr({displayType:l.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:n[d]})),l.type==="fields"&&(this._contentWidgets[d]=new St({viewModel:n[d]})),l.type==="media"&&(this._contentWidgets[d]=new Ot({viewModel:n[d]})),l.type==="text"&&(this._contentWidgets[d]=new Ue({viewModel:n[d]})),l.type==="custom"&&(this._contentWidgets[d]=new Ue({viewModel:n[d]})),l.type==="expression"&&(this._contentWidgets[d]=new Nr({viewModel:n[d]})),l.type==="relationship"){let c=new Sr({flowItems:i,featureVisibleElements:t,viewModel:n[d]});this._contentWidgets[d]=c}if(l.type==="utility-network-associations"){let c=new Ur({flowItems:i,parentFeatureViewModel:r,featureVisibleElements:t,viewModel:n[d]});this._contentWidgets[d]=c}},this);else{let l=n[0];l&&!l.destroyed&&(this._contentWidgets[0]=new Ue({viewModel:l}))}this.scheduleRender()}};o([a()],P.prototype,"flowType",void 0),o([a()],P.prototype,"graphic",null),o([a()],P.prototype,"defaultPopupTemplateEnabled",null),o([a()],P.prototype,"flowItems",void 0),o([a()],P.prototype,"headingLevel",void 0),o([a({readOnly:!0})],P.prototype,"isTable",null),o([a()],P.prototype,"icon",null),o([a()],P.prototype,"label",null),o([a()],P.prototype,"location",null),o([a(),j("esri/widgets/Feature/t9n/Feature")],P.prototype,"messages",void 0),o([a(),j("esri/t9n/common")],P.prototype,"messagesCommon",void 0),o([a()],P.prototype,"spatialReference",null),o([a()],P.prototype,"timeZone",null),o([a({readOnly:!0})],P.prototype,"title",null),o([a()],P.prototype,"visibleElements",void 0),o([oe("visibleElements")],P.prototype,"castVisibleElements",null),o([a()],P.prototype,"map",null),o([a()],P.prototype,"view",null),o([a({type:wi})],P.prototype,"viewModel",void 0),P=o([w("esri.widgets.Feature")],P);var wh=P;export{Vt as a,wi as b,V as c,Wr as d,wh as e};
