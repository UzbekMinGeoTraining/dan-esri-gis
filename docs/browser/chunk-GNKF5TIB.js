import{a as b}from"./chunk-VPH54J3G.js";import{g}from"./chunk-MBJHSEMD.js";import{c as y}from"./chunk-VQHENXDQ.js";import{a as v}from"./chunk-GZXWFBZI.js";import{M as u,Q as i}from"./chunk-GGZQ5GCM.js";import{U as d}from"./chunk-TFUPB3ZG.js";import{a}from"./chunk-BMVJCP2M.js";import{D as p,u as c}from"./chunk-GMC3I5VG.js";import{r as m}from"./chunk-3IBUFXWY.js";import{g as l}from"./chunk-JEGVIFEP.js";var n=new y,o=new WeakMap;function I(e){T(e)&&n.push(new WeakRef(e))}function w(e){let r=n.find(s=>s.deref()===e);r&&n.remove(r)}function T(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function L(e,r){return Number.isFinite(e)&&Number.isFinite(r)?r<=0?e:L(r,e%r):0}var h=0,f=0;function C(){let e=Date.now(),r=!1;for(let s of n){let t=s.deref();t?t.refreshInterval&&e-(o.get(t)??0)+5>=6e4*t.refreshInterval&&(o.set(t,e),t.refresh(e)):r=!0}if(r)for(let s=n.length-1;s>=0;s--)n.at(s).deref()||n.removeAt(s)}u(()=>{let e=Date.now(),r=0;for(let s of n){let t=s.deref();t&&(r=L(Math.round(6e4*t.refreshInterval),r),t.refreshInterval?o.get(t)||o.set(t,e):o.delete(t))}if(r!==f){if(f=r,clearInterval(h),f===0)return void(h=0);h=setInterval(C,f)}},g);function q(e){return e!=null&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}var R=.1,z=e=>{let r=class extends e{constructor(...s){super(...s),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=p(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||I(this)},()=>{})}destroy(){w(this)}castRefreshInterval(s){return s>=R?s:s<=0?0:R}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(s=Date.now()){c(this._debounceHasDataChanged()).then(t=>{t&&this._set("refreshTimestamp",s),this.emit("refresh",{dataChanged:t})},t=>{m.getLogger(this).error(t),this.emit("refresh",{dataChanged:!1,error:t})})}hasDataChanged(){return l(this,null,function*(){return!0})}get test(){}};return a([i({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:b}}}}})],r.prototype,"refreshInterval",void 0),a([v("refreshInterval")],r.prototype,"castRefreshInterval",null),a([i({readOnly:!0})],r.prototype,"refreshTimestamp",void 0),a([i({readOnly:!0})],r.prototype,"refreshParameters",null),r=a([d("esri.layers.mixins.RefreshableLayer")],r),r};export{q as a,z as b};
