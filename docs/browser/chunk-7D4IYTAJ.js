import{a as E}from"./chunk-TSNWBMBA.js";import{a as N}from"./chunk-GLWPOGYF.js";import{d}from"./chunk-MUI46NAG.js";import{D as V}from"./chunk-GGZQ5GCM.js";import{i as O}from"./chunk-WGF2T2BG.js";import{h as D,i as v,t as T}from"./chunk-3IBUFXWY.js";import{a as g,b as F,g as r}from"./chunk-JEGVIFEP.js";function f(e){return typeof e=="string"||e instanceof String}var o;(function(e){e.HM="HH:mm",e.HMS="HH:mm:ss",e.HMS_MS="HH:mm:ss.SSS"})(o||(o={}));var J=[o.HMS_MS,o.HMS,o.HM,"TT"],q="yyyy-MM-dd",Ke=o.HMS;function I(e){if(!e||!f(e))return null;let n=d.fromFormat(e,q);return n.isValid?n:null}function b(e){return e&&f(e)?O(J,n=>{let t=d.fromFormat(e,n);return t.isValid?t:null})??null:null}function x(e){if(!e||!f(e))return null;let n=d.fromISO(e);return n.isValid?n:null}var s;(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(s||(s={}));var W=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function Y(e){return e!=null&&W.has(e.type)}function M(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function A(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function _(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function L(e,n,t){let i=t??e?.domain;if(!i)return null;switch(i.type){case"range":{let{min:a,max:l}=R(e,t);if(a!=null&&+n<a||l!=null&&+n>l)return s.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(i.codedValues==null||i.codedValues.every(a=>a==null||a.code!==n))return s.INVALID_CODED_VALUE}return null}function R(e,n){let t=n??e?.domain;if(!t||t.type!=="range")return;let i="range"in t?t.range[0]:t.minValue,a="range"in t?t.range[1]:t.maxValue,l=Y(e);return M(e)||_(e)||A(e)?F(g({},K(e,a,i)),{isInteger:l}):{min:i!=null&&typeof i=="number"?i:null,max:a!=null&&typeof a=="number"?a:null,rawMin:i,rawMax:a,isInteger:l}}function K(e,n,t){return M(e)?{min:I(t)?.toMillis(),max:I(n)?.toMillis(),rawMin:t,rawMax:n}:_(e)?{min:b(t)?.toMillis(),max:b(n)?.toMillis(),rawMin:t,rawMax:n}:A(e)?{min:x(t)?.toMillis(),max:x(n)?.toMillis(),rawMin:t,rawMax:n}:{max:null,min:null}}var Q=/^([0-9_])/,ee=/[^a-z0-9_\u0080-\uffff]+/gi;function fn(e){return e==null?null:e.trim().replaceAll(ee,"_").replace(Q,"F$1")||null}var ne=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],te=["field","normalizationField"];function cn(e,n){if(e!=null&&n!=null){for(let t of Array.isArray(e)?e:[e])if(C(ne,t,n),"visualVariables"in t&&t.visualVariables)for(let i of t.visualVariables)C(te,i,n)}}function C(e,n,t){if(e)for(let i of e){let a=D(i,n),l=a&&typeof a!="function"&&t.get(a);l&&v(i,l.name,n)}}function mn(e,n){if(e!=null&&n?.fields?.length)if("startField"in e){let t=n.get(e.startField),i=n.get(e.endField);e.startField=t?.name??null,e.endField=i?.name??null}else{let t=n.get(e.startTimeField),i=n.get(e.endTimeField);e.startTimeField=t?.name??null,e.endTimeField=i?.name??null}}var S=new Set;function h(e,n){return e&&n?(S.clear(),c(S,e,n),Array.from(S).sort()):[]}function c(e,n,t){if(t)if(n?.fields?.length)if(t.includes("*"))for(let{name:i}of n.fields)e.add(i);else for(let i of t)y(e,n,i);else{if(t.includes("*"))return e.clear(),void e.add("*");for(let i of t)i!=null&&e.add(i)}}function y(e,n,t){if(typeof t=="string")if(n){let i=n.get(t);i&&e.add(i.name)}else e.add(t)}function pn(e,n){return n==null||e==null?[]:n.includes("*")?(e.fields??[]).map(t=>t.name):n}function yn(e,n,t=1){if(!n||!e)return[];if(n.includes("*"))return["*"];let i=h(e,n);return i.length/e.fields.length>=t?["*"]:i}function u(e,n,t){return r(this,null,function*(){if(!t)return;let{arcadeUtils:i}=yield N(),a=i.extractFieldNames(t,n?.fields?.map(l=>l.name));for(let l of a)y(e,n,l)})}function $(e,n,t){return r(this,null,function*(){if(t&&t!=="1=1"){let i=yield E(t,n);if(!i.isStandardized)throw new T("fieldUtils:collectFilterFields","Where clause is not standardized",{where:t});c(e,n,i.fieldNames)}})}function gn({displayField:e,fields:n}){return e||(n?.length?w(n,"name-or-title")||w(n,"unique-identifier")||w(n,"type-or-category")||ie(n):null)}function ie(e){for(let n of e){if(!n?.name)continue;let t=n.name.toLowerCase();if(t.includes("name")||t.includes("title"))return n.name}return null}function w(e,n){for(let t of e)if(t?.valueType&&t.valueType===n)return t.name;return null}function Fn(e,n){return r(this,null,function*(){if(!n)return;let t=n.elevationInfo?.featureExpressionInfo;return t?t.collectRequiredFields(e,n.fieldsIndex):void 0})}function ae(e,n,t){t.onStatisticExpression?u(e,n,t.onStatisticExpression.expression):e.add(t.onStatisticField)}function Tn(e,n,t){return r(this,null,function*(){if(!n||!t||!("fields"in t))return;let i=[],a=t.popupTemplate;i.push(le(e,n,a)),t.fields&&i.push(...t.fields.map(l=>r(this,null,function*(){return ae(e,n.fieldsIndex,l)}))),yield Promise.all(i)})}function le(e,n,t){return r(this,null,function*(){let i=[];t?.expressionInfos&&i.push(...t.expressionInfos.map(l=>u(e,n.fieldsIndex,l.expression)));let a=t?.content;if(Array.isArray(a))for(let l of a)l.type==="expression"&&l.expressionInfo&&i.push(u(e,n.fieldsIndex,l.expressionInfo.expression));yield Promise.all(i)})}function In(e,n,t){return r(this,null,function*(){n&&(n.timeInfo&&t?.timeExtent&&c(e,n.fieldsIndex,[n.timeInfo.startField,n.timeInfo.endField]),n.floorInfo&&c(e,n.fieldsIndex,[n.floorInfo.floorField]),t?.where!=null&&(yield $(e,n.fieldsIndex,t.where)))})}function bn(e,n,t){return r(this,null,function*(){n&&t&&(yield Promise.all(t.map(i=>re(e,n,i))))})}function re(e,n,t){return r(this,null,function*(){n&&t&&(t.valueExpression?yield u(e,n.fieldsIndex,t.valueExpression):t.field&&y(e,n.fieldsIndex,t.field))})}function xn(e){return e?h(e.fieldsIndex,U(e)):[]}function se(e){if(!e)return[];let n=e.geometryFieldsInfo;return n?h(e.fieldsIndex,[n.shapeAreaField,n.shapeLengthField]):[]}var oe=new Set(["oid","global-id","guid"]),ue=new Set(["oid","global-id"]),de=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function fe(e){let n=new Set;k(e).forEach(i=>n.add(i)),se(e).forEach(i=>n.add(i.toLowerCase()));let t=e&&"infoFor3D"in e?e.infoFor3D:void 0;return t&&(Object.values(t.assetMapFieldRoles).forEach(i=>n.add(i.toLowerCase())),Object.values(t.transformFieldRoles).forEach(i=>n.add(i.toLowerCase()))),Array.from(n)}function U(e){if(!e)return[];let n="editFieldsInfo"in e&&e.editFieldsInfo;if(!n)return[];let{creationDateField:t,creatorField:i,editDateField:a,editorField:l}=n;return[t,i,a,l].filter(Boolean)}function k(e){return U(e).map(n=>n.toLowerCase())}function Sn(e,n){return e.editable&&!oe.has(e.type)&&!k(n).includes(e.name?.toLowerCase()??"")}function wn(e,n){let t=e.name?.toLowerCase()??"";return!(n?.objectIdField!=null&&t===n.objectIdField.toLowerCase()||n?.globalIdField!=null&&t===n.globalIdField.toLowerCase()||fe(n).includes(t)||ue.has(e.type)||de.some(i=>i.test(t)))}function hn(e,n){return r(this,null,function*(){let{labelingInfo:t,fieldsIndex:i}=n;t?.length&&(yield Promise.all(t.map(a=>ce(e,i,a))))})}function ce(e,n,t){return r(this,null,function*(){if(!t)return;let i=t.getLabelExpression(),a=t.where;if(i.type==="arcade")yield u(e,n,i.expression);else{let l=i.expression.match(/{[^}]*}/g);l&&l.forEach(X=>{y(e,n,X.slice(1,-1))})}yield $(e,n,a)})}function Dn(e){let n=e.defaultValue;return n!==void 0&&G(e,n)?n:e.nullable?null:void 0}function vn(e){let n=typeof e=="string"?{type:e}:e;return Se(n)?255:n.type==="esriFieldTypeDate"||n.type==="date"?8:void 0}function H(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function me(e){return e===null||H(e)}function pe(e){return e===null||Number.isInteger(e)}function z(e){return e!=null&&typeof e=="string"}function ye(e){return e===null||z(e)}function ge(){return!0}function G(e,n){let t;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":t=e.nullable?pe:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":t=e.nullable?me:H;break;case"string":case"esriFieldTypeString":t=e.nullable?ye:z;break;default:t=ge}return arguments.length===1?t:t(n)}var Z=["integer","small-integer","big-integer"],j=["single","double"],On=[...Z,...j],Fe=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],Te=["esriFieldTypeSingle","esriFieldTypeDouble"],P=new Set([...Z,...Fe]),Ie=new Set([...j,...Te]),be=V(P,Ie);function Vn(e){return e!=null&&P.has(e.type)}function xe(e){return e!=null&&be.has(e.type)}function Se(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function En(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}function Nn(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function Mn(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function An(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function _n(e){return e!=null&&(e.type==="oid"||e.type==="esriFieldTypeOID")}function Ln(e){return e!=null&&(e.type==="global-id"||e.type==="esriFieldTypeGlobalID")}function Rn(e,n){return we(e,n)===null}var m,p;function Cn(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function we(e,n){return e==null||e.nullable&&n===null?null:xe(e)&&!he(e.type,Number(n))?m.OUT_OF_RANGE:G(e,n)?e.domain?L(e,n):null:p.INVALID_TYPE}function he(e,n){let t=typeof e=="string"?B(e):e;if(!t)return!1;let i=t.min,a=t.max;return t.isInteger?Number.isInteger(n)&&n>=i&&n<=a:n>=i&&n<=a}function B(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return De;case"esriFieldTypeInteger":case"integer":return ve;case"esriFieldTypeBigInteger":case"big-integer":return Oe;case"esriFieldTypeSingle":case"single":return Ve;case"esriFieldTypeDouble":case"double":return Ee}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(m||(m={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(p||(p={}));var De={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},ve={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},Oe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},Ve={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},Ee={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function $n(e,n,t){switch(e){case s.INVALID_CODED_VALUE:return`Value ${t} is not in the coded domain - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case s.VALUE_OUT_OF_RANGE:return`Value ${t} is out of the range of valid values - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case p.INVALID_TYPE:return`Value ${t} is not a valid value for the field type - field: ${n.name}, type: ${n.type}, nullable: ${n.nullable}`;case m.OUT_OF_RANGE:{let{min:i,max:a}=B(n.type);return`Value ${t} is out of range for the number type - field: ${n.name}, type: ${n.type}, value range is ${i} to ${a}`}}}function Un(e,n){return!Ne(e,n,null)}function Ne(e,n,t){if(!n?.attributes||!e){if(t!=null)for(let l of e??[])t.add(l);return!0}let i=new Set(Object.keys(n.attributes)),a=!1;for(let l of e)if(!i.has(l)){if(a=!0,t==null)break;t.add(l)}return a}function kn(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some(n=>e.toLowerCase().startsWith(n))}function Hn(e,n){return r(this,null,function*(){let t=new Set;return e?.collectRequiredFields&&(yield e.collectRequiredFields(t,n)),Array.from(t).sort()})}function zn(e){let n=e?.match(/{[^}]+}/g);return n?n.map(t=>t.slice(1,-1).split(":")[0].trim()):[]}export{R as a,fn as b,cn as c,mn as d,h as e,c as f,y as g,pn as h,yn as i,u as j,gn as k,Fn as l,Tn as m,In as n,bn as o,xn as p,Sn as q,wn as r,hn as s,Dn as t,vn as u,Vn as v,xe as w,Se as x,En as y,Nn as z,Mn as A,An as B,_n as C,Ln as D,Rn as E,Cn as F,we as G,$n as H,Un as I,Ne as J,kn as K,Hn as L,zn as M};
