import{a as I}from"./chunk-AAVC4ZRS.js";import{a as g}from"./chunk-UFJ62PBU.js";import{a as y}from"./chunk-QN72YLVS.js";import{a as u}from"./chunk-4IUQ56CO.js";import{a as c}from"./chunk-2K35ZAGK.js";import"./chunk-SVK2E2V5.js";import"./chunk-PA5IAWXD.js";import"./chunk-AR3SF3CU.js";import"./chunk-WP7QHDBV.js";import"./chunk-5DAF2FXI.js";import"./chunk-U3ETEC6R.js";import"./chunk-GNKF5TIB.js";import"./chunk-VPH54J3G.js";import"./chunk-GB5RQL32.js";import"./chunk-Q6ZVH4MK.js";import"./chunk-AYOI2Y26.js";import"./chunk-IH2TDIRR.js";import"./chunk-3FCM74ZB.js";import"./chunk-MBVOWLUI.js";import"./chunk-2HUIJUS4.js";import{d as f}from"./chunk-MBJHSEMD.js";import"./chunk-OFZ6SV37.js";import{o as p}from"./chunk-LAJXTVEO.js";import"./chunk-YSOJWUIW.js";import"./chunk-Q5WFUDPQ.js";import"./chunk-T7BKG6V3.js";import"./chunk-R6VC74T7.js";import"./chunk-6WKJD7BM.js";import"./chunk-3CR7P5WT.js";import"./chunk-QNZSBADV.js";import"./chunk-PYQRTZNZ.js";import{c as d}from"./chunk-VQHENXDQ.js";import"./chunk-VWF5VUO3.js";import"./chunk-HRP5LYWJ.js";import"./chunk-BIVFGNT6.js";import"./chunk-3M7VXIQH.js";import"./chunk-TBYT66N3.js";import"./chunk-5PTS4JDF.js";import"./chunk-N27U3N2T.js";import"./chunk-4R5NBZMW.js";import"./chunk-NDYVXEZ5.js";import"./chunk-CMMPCPP5.js";import"./chunk-4DLSYLKE.js";import"./chunk-VPXBKZQM.js";import"./chunk-GZXWFBZI.js";import"./chunk-B7IARA3F.js";import"./chunk-IZVEJCCI.js";import"./chunk-TEY6TKJV.js";import"./chunk-4M6XQSBA.js";import"./chunk-2JF6YUJG.js";import{Q as l}from"./chunk-GGZQ5GCM.js";import{U as m}from"./chunk-TFUPB3ZG.js";import"./chunk-ANPNMGFG.js";import{a as s}from"./chunk-BMVJCP2M.js";import"./chunk-GMC3I5VG.js";import"./chunk-WGF2T2BG.js";import"./chunk-YZP43POT.js";import"./chunk-VEDIBGHD.js";import{r as h}from"./chunk-3IBUFXWY.js";import"./chunk-BP73DJTS.js";import{g as n}from"./chunk-JEGVIFEP.js";var r=class extends u(g(y(c))){constructor(){super(...arguments),this.type="wmts-3d"}initialize(){this._getCompatibleTileInfoMatrixSet(t=>this._getTileInfoSupportError(t.tileInfo,t.fullExtent));let e=f(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{let t=this._getCompatibleTileInfoMatrixSet(i=>this._getTileInfoError(i.tileInfo,i.fullExtent));t!=null&&(t.id!==null&&this.layer.activeLayer.tileMatrixSetId!==t.id&&(this.layer.activeLayer.tileMatrixSetId=t.id),t.tileInfo&&(this.tileInfo=t.tileInfo),this.layer.fullExtent=t.fullExtent)});this.addResolvingPromise(e),this.when(()=>this._postInitialize())}refresh(){this.emit("data-changed")}canResume(){if(!super.canResume())return!1;let e=this.layer.activeLayer.tileMatrixSet;return e!=null&&!this._getTileInfoError(e.tileInfo,e.fullExtent)}fetchTile(e,t){return n(this,null,function*(){return I(this,e,t)})}doRefresh(){return n(this,null,function*(){this.suspended||this.emit("data-changed")})}_postInitialize(){this._updatingHandles.add(()=>this.layer?.activeLayer?.styleId,()=>this.refresh()),this._updatingHandles.add(()=>this.layer?.activeLayer,e=>{let t=this._getCompatibleTileInfoMatrixSet(i=>this._getTileInfoError(i.tileInfo,i.fullExtent),!0);t&&t.id!=null&&e.tileMatrixSetId!==t.id&&(this.layer.activeLayer.tileMatrixSetId=t.id),this.notifyChange("suspended"),this.canResume()&&this.refresh()})}_getCompatibleTileInfoMatrixSet(e,t=!1){let i=p(this.layer);if(i!=null){if(d.isCollection(i))return i.find(x=>{let o=e(x);return o!=null&&(t?h.getLogger(this).error("The selected tile matrix set is not compatible with the view",o):this.addResolvingPromise(Promise.reject(o))),o==null});let a=e(i);return a!=null&&(t?h.getLogger(this).error("The selected tile matrix set is not compatible with the view",a):this.addResolvingPromise(Promise.reject(a))),i}return null}_getTileInfoError(e,t){return this._getTileInfoSupportError(e,t)||this._getTileInfoCompatibilityError(e,this.view.basemapTerrain.tilingScheme)}};s([l()],r.prototype,"layer",void 0),s([l()],r.prototype,"suspended",void 0),s([l()],r.prototype,"tileInfo",void 0),r=s([m("esri.views.3d.layers.WMTSLayerView3D")],r);var j=r;export{j as default};
