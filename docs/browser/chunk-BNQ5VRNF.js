import{a as H}from"./chunk-NOFXYDQS.js";import{a as k}from"./chunk-4BLMEKFL.js";import{n as J}from"./chunk-RPIA54UY.js";import{a as S}from"./chunk-LHH3AZP2.js";import{J as V}from"./chunk-OL43UY3L.js";import{b}from"./chunk-ZGDQY5ZD.js";import{a as j,b as v}from"./chunk-LVPMJTA6.js";import{d as G}from"./chunk-VDNXTMSC.js";import{v as z,x as $}from"./chunk-7D4IYTAJ.js";import{a as Q}from"./chunk-TSNWBMBA.js";import{p as N}from"./chunk-LAJXTVEO.js";import{d as D}from"./chunk-HRP5LYWJ.js";import{a as F}from"./chunk-CMMPCPP5.js";import{a as M}from"./chunk-B7IARA3F.js";import{d as w}from"./chunk-TEY6TKJV.js";import{h as R}from"./chunk-2JF6YUJG.js";import{Q as d}from"./chunk-GGZQ5GCM.js";import{B as P,P as T,U as L}from"./chunk-TFUPB3ZG.js";import{a as l}from"./chunk-BMVJCP2M.js";import{b as C,t as a}from"./chunk-3IBUFXWY.js";import{a as I,b as E,g as i}from"./chunk-JEGVIFEP.js";var q,u=q=class extends R{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new q(C({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};l([d({type:[String],json:{write:!0}})],u.prototype,"attachmentTypes",void 0),l([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],u.prototype,"attachmentsWhere",void 0),l([d({type:Boolean,json:{write:!0}})],u.prototype,"cacheHint",void 0),l([d({type:[String],json:{write:!0}})],u.prototype,"keywords",void 0),l([d({type:[String],json:{write:!0}})],u.prototype,"globalIds",void 0),l([d({json:{write:!0}})],u.prototype,"name",void 0),l([d({type:Number,json:{read:{source:"resultRecordCount"}}})],u.prototype,"num",void 0),l([d({type:[Number],json:{write:!0}})],u.prototype,"objectIds",void 0),l([d({type:Boolean,json:{default:!1,write:!0}})],u.prototype,"returnMetadata",void 0),l([d({type:[Number],json:{write:!0}})],u.prototype,"size",void 0),l([d({type:Number,json:{read:{source:"resultOffset"}}})],u.prototype,"start",void 0),l([F("start"),F("num")],u.prototype,"writeStart",null),l([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],u.prototype,"where",void 0),u=q=l([L("esri.rest.support.AttachmentQuery")],u),u.from=P(u);var B=u;var qt=new M({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});function xt(t,e,n,r){return i(this,null,function*(){let o=yield h(t);if(yield O(t,e,r),!o.addAttachment)throw new a(r,"Layer source does not support addAttachment capability");return o.addAttachment(e,n)})}function O(t,e,n){let{attributes:r}=e,{objectIdField:o}=t;return t.capabilities?.data?.supportsAttachment?e?r?o&&r[o]?Promise.resolve():Promise.reject(new a(n,`feature is missing the identifying attribute ${o}`)):Promise.reject(new a(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new a(n,"A feature is required to add/delete/update attachments")):Promise.reject(new a(n,"this layer doesn't support attachments"))}function Ot(t,e,n,r,o){return i(this,null,function*(){let s=yield h(t);if(yield O(t,e,o),!s.updateAttachment)throw new a(o,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,n,r)})}function At(t,e,n){return i(this,null,function*(){let{applyEdits:r}=yield import("./chunk-RQK2YC46.js"),o=yield t.load(),s=n;return o.type==="feature"&&o.infoFor3D&&e.deleteFeatures!=null&&o.globalIdField!=null&&(s=E(I({},s),{globalIdToObjectId:yield Z(o,e.deleteFeatures,o.globalIdField)})),r(o,o.source,e,n)})}function Et(t,e,n){return i(this,null,function*(){let{uploadAssets:r}=yield import("./chunk-RQK2YC46.js"),o=yield t.load();return r(o,o.source,e,n)})}function Ct(t,e,n,r){return i(this,null,function*(){let o=yield h(t);if(yield O(t,e,r),!o.deleteAttachments)throw new a(r,"Layer source does not support deleteAttachments capability");return o.deleteAttachments(e,n)})}function Pt(t,e,n){return i(this,null,function*(){let r=(yield t.load({signal:e?.signal})).source;if(!r.fetchRecomputedExtents)throw new a(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)})}function Tt(t,e,n,r){return i(this,null,function*(){e=B.from(e),yield t.load();let o=t.source,s=t.capabilities;if(!s?.data?.supportsAttachment)throw new a(r,"this layer doesn't support attachments");let{attachmentTypes:c,objectIds:m,globalIds:g,num:p,size:y,start:f,where:A}=e;if(!s?.operations?.supportsQueryAttachments&&(c?.length>0||g?.length>0||y?.length>0||p||f||A))throw new a(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(m?.length||g?.length||A))throw new a(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!o.queryAttachments)throw new a(r,"Layer source does not support queryAttachments capability",e);return o.queryAttachments(e)})}function Lt(t,e,n,r){return i(this,null,function*(){let o=yield h(t);if(!o.queryObjectIds)throw new a(r,"Layer source does not support queryObjectIds capability");return o.queryObjectIds(b.from(e)??t.createQuery(),n)})}function Rt(t,e,n,r){return i(this,null,function*(){let o=yield h(t);if(!o.queryFeatureCount)throw new a(r,"Layer source does not support queryFeatureCount capability");return o.queryFeatureCount(b.from(e)??t.createQuery(),n)})}function Mt(t,e,n,r){return i(this,null,function*(){let o=yield h(t);if(!o.queryExtent)throw new a(r,"Layer source does not support queryExtent capability");return o.queryExtent(b.from(e)??t.createQuery(),n)})}function Dt(t,e,n,r){return i(this,null,function*(){let o=yield h(t);if(!o.queryRelatedFeatures)throw new a(r,"Layer source does not support queryRelatedFeatures capability");return o.queryRelatedFeatures(S.from(e),n)})}function Gt(t,e,n,r){return i(this,null,function*(){let o=yield h(t);if(!o.queryRelatedFeaturesCount)throw new a(r,"Layer source does not support queryRelatedFeaturesCount capability");return o.queryRelatedFeaturesCount(S.from(e),n)})}function Nt(t){return i(this,null,function*(){let e=t.source;if(e?.refresh)try{let{dataChanged:n,updates:r}=yield e.refresh();if(r!=null&&(t.sourceJSON=I(I({},t.sourceJSON),r),t.read(r,{origin:"service",url:t.parsedUrl})),n)return!0}catch{}if(t.definitionExpression)try{return(yield Q(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1})}function Qt(t){let e=new b,n=t.capabilities?.data,r=t.capabilities?.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),n.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];let{timeOffset:o,timeExtent:s}=t;return e.timeExtent=o!=null&&s!=null?s.offset(-o.value,o.unit):s||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function Vt(t){let{globalIdField:e,fields:n}=t;if(e)return e;if(n){for(let r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function kt(t){let{objectIdField:e,fields:n}=t;if(e)return e;if(n){for(let r of n)if(r.type==="esriFieldTypeOID")return r.name}}function Jt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function Ht(t,e){let{subtypes:n,subtypeField:r}=t;if(!e?.attributes||!n?.length||!r)return null;let o=e.attributes[r];return o==null?null:n.find(s=>s.code===o)}function zt(t,e){let{fieldsIndex:n,subtypeField:r}=t,{name:o,type:s}=n.get(e)??{};if(!o)return null;if((r&&n.get(r)?.name)===o&&t.subtypes?.length){let c=t.subtypes.map(m=>new j({code:U(m.code,s),name:m.name}));if(c?.length)return new v({codedValues:c})}return null}function $t(t,e){let{fieldsIndex:n}=t,{name:r,type:o}=n.get(e)??{};if(!r)return null;if(("typeIdField"in t?n.get(t.typeIdField)?.name:null)===r&&"types"in t&&t.types?.length){let s=t.types.map(c=>new j({code:U(c.id,o),name:c.name}));return new v({codedValues:s})}return null}function U(t,e){return e?$({type:e})&&typeof t=="number"?`${t}`:z({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}function h(t){return i(this,null,function*(){return(yield t.load()).source})}function W(t,e){return i(this,null,function*(){if(!w||w.findCredential(t))return;let n;try{let r=yield N(t,e);r&&(n=yield w.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{let r=e!=null?e.signal:null;yield w.getCredential(t,{signal:r})}catch{}})}function Bt(t,e,n){return i(this,null,function*(){let r=t.parsedUrl?.path;r&&t.authenticationTriggerEvent===e&&(yield W(r,n))})}function Ut(t){return!K(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}var x=T({types:V});function Wt(t,e){if(t.defaultSymbol)return t.types?.length?new J({defaultSymbol:x(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(n=>({id:n.id,symbol:x(n.symbol,n,e)}))}):new k({symbol:x(t.defaultSymbol,t,e)})}function Zt(t){let e=t.sourceJSON?.cacheMaxAge;if(!e)return!1;let n=t.editingInfo?.lastEditDate?.getTime();return n==null||(e*=1e3,Date.now()-n<e)}function Z(t,e,n){return i(this,null,function*(){if(e==null)return null;let r=[],{objectIdField:o}=t;if(e.forEach(p=>{let y=null;if("attributes"in p){let{attributes:f}=p;y={globalId:f[n],objectId:f[o]!=null&&f[o]!==-1?f[o]:null}}else y={globalId:p.globalId,objectId:p.objectId!=null&&p.objectId!==-1?p.objectId:null};y.globalId!=null&&(y.objectId!=null&&y.objectId!==-1||r.push(y.globalId))}),r.length===0)return null;let s=t.createQuery();s.where=r.map(p=>`${n}='${p}'`).join(" OR "),s.returnGeometry=!1,s.outFields=[o,n],s.cacheHint=!1;let c=yield D(H(t,s));if(!c.ok)return null;let m=new Map,g=c.value.features;for(let p of g){let y=p.attributes[n],f=p.attributes[o];y!=null&&f!=null&&f!==-1&&m.set(G(y),f)}return m})}function Kt(t,e,n){if(!e||!n||!t)return null;let r=n.getAttribute(e);return r==null?null:t.find(o=>{let{id:s}=o;return s!=null&&s.toString()===r.toString()})??null}function K(t){return t.sourceJSON?.isMultiServicesView||_(t)}function _(t){return!!t.sourceJSON?.capabilities?.toLowerCase().split(",").map(e=>e.trim()).includes("map")}function _t(t,e,n){let r=e?.queryBins;if(!r)throw new a(n,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!r.supportsAutoInterval)throw new a(n,"Layer source does not support auto-interval binning");break;case"date":if(!r.supportsDate)throw new a(n,"Layer source does not support date binning");break;case"fixed-boundaries":if(!r.supportsFixedBoundaries)throw new a(n,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!r.supportsFixedInterval)throw new a(n,"Layer source does not support fixed-interval binning")}let o=r?.supportedStatistics;if(t.outStatistics&&o){let s=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(let{statisticType:c}of t.outStatistics){let m=s.get(c);if(m&&!o[m])throw new a(n,`Layer source does not support ${c} statistic type`)}}}export{B as a,qt as b,xt as c,Ot as d,At as e,Et as f,Ct as g,Pt as h,Tt as i,Lt as j,Rt as k,Mt as l,Dt as m,Gt as n,Nt as o,Qt as p,Vt as q,kt as r,Jt as s,Ht as t,zt as u,$t as v,Bt as w,Ut as x,Wt as y,Zt as z,Z as A,Kt as B,K as C,_t as D};
