import{a as he,c as de}from"./chunk-INHI75TM.js";import{a as ue,c as fe}from"./chunk-SWYHTFS7.js";import{f as le,i as pe}from"./chunk-Q3K3B6ZB.js";import"./chunk-NVD74CNP.js";import{a as ne}from"./chunk-QN72YLVS.js";import{a as ae}from"./chunk-2K35ZAGK.js";import"./chunk-ELOFFQD3.js";import{a as $}from"./chunk-J2D4NQQB.js";import"./chunk-RI2HJFLU.js";import"./chunk-TOCNTYZ2.js";import{a as me}from"./chunk-4YNUZOQW.js";import"./chunk-4EBEFT6T.js";import"./chunk-W4FJ4A5Q.js";import"./chunk-Q5GL3CSI.js";import"./chunk-X7CRJ427.js";import{q as ce}from"./chunk-4DR6EKLV.js";import"./chunk-2SZOQMAQ.js";import"./chunk-OT635BJR.js";import"./chunk-EDY6B353.js";import"./chunk-KS6SWJU3.js";import"./chunk-JHBR5RZV.js";import"./chunk-6J446DPN.js";import"./chunk-E3LKQDEM.js";import"./chunk-GWDYH5GG.js";import"./chunk-XCZY4IUQ.js";import"./chunk-DZBIKPHA.js";import"./chunk-F4QTXEUP.js";import"./chunk-C6VBL32Q.js";import"./chunk-OXOFK4XQ.js";import"./chunk-3DR4YGRI.js";import"./chunk-WCQK6XOZ.js";import"./chunk-RCCESRES.js";import"./chunk-FTNMSGGI.js";import"./chunk-4DJFVMMN.js";import"./chunk-DQVRRO4N.js";import"./chunk-MM6IP4FS.js";import"./chunk-DYNH5H2C.js";import"./chunk-WP7QHDBV.js";import"./chunk-2F2E6NNR.js";import"./chunk-H7LSTWKZ.js";import{a as ie}from"./chunk-SDHCGQUI.js";import"./chunk-VSPQNL6A.js";import"./chunk-7H32J6FD.js";import"./chunk-XNAAMINV.js";import"./chunk-NPF6KTZO.js";import"./chunk-WNU76WNW.js";import{a as re}from"./chunk-H4XRNT5U.js";import"./chunk-WIJFCRLT.js";import"./chunk-6ISQQD7M.js";import"./chunk-VHVYC3RW.js";import"./chunk-ZBOVC36T.js";import"./chunk-BUWHOOA3.js";import"./chunk-RLQK45UV.js";import"./chunk-SDC4SION.js";import"./chunk-N3AGC3JB.js";import"./chunk-KHTVZWEX.js";import"./chunk-IGNHVSQC.js";import"./chunk-B3W5V2XP.js";import"./chunk-NP35J4DQ.js";import"./chunk-JBGML6IF.js";import"./chunk-S2HMCZNZ.js";import"./chunk-WUAC4CFP.js";import"./chunk-ONDKJR4V.js";import"./chunk-QB4KDO4M.js";import"./chunk-NNNTRPDR.js";import"./chunk-KDLA3TQ2.js";import"./chunk-RPMDOAYZ.js";import"./chunk-J7UK2QPE.js";import"./chunk-6DXGZQQN.js";import"./chunk-3PK63SMD.js";import"./chunk-2DN2BYDF.js";import"./chunk-MEA3RU4I.js";import"./chunk-3QNHUVFJ.js";import"./chunk-7OTZECLS.js";import"./chunk-XBFBZZXW.js";import"./chunk-LWUJWBPJ.js";import"./chunk-V7QAQAGA.js";import"./chunk-K5V3S3K3.js";import"./chunk-HCCGI45Q.js";import"./chunk-Q6D44QVW.js";import"./chunk-C3EWQ5V5.js";import"./chunk-3UBXEUOT.js";import{a as oe}from"./chunk-6WV5YJL7.js";import{c as se}from"./chunk-3AMG6HG6.js";import"./chunk-I6ETUG5Q.js";import"./chunk-4MZSW4Z6.js";import"./chunk-BERIM72F.js";import"./chunk-YOBNM4T6.js";import"./chunk-MEBZWNWT.js";import"./chunk-XZ52TEBV.js";import"./chunk-WAPQB6I3.js";import"./chunk-L3GHXHDP.js";import{a as S,b as M}from"./chunk-N6PITG7Q.js";import"./chunk-XC4LDHG5.js";import"./chunk-S3ASAZCA.js";import"./chunk-ZUUCQTSR.js";import"./chunk-GKUBZAEG.js";import"./chunk-UW734WOQ.js";import"./chunk-BIZV3H6H.js";import"./chunk-UCYGH5UZ.js";import{l as q,m as I}from"./chunk-ATV5GTE5.js";import"./chunk-X7WNJQZZ.js";import"./chunk-PQPFAB53.js";import"./chunk-QPPQKNYU.js";import"./chunk-MJXFSFCY.js";import"./chunk-6N46AY7Z.js";import"./chunk-TCQTMUK4.js";import{a as te}from"./chunk-AY3YVZUY.js";import"./chunk-7DCEI345.js";import"./chunk-ZG3FCPXY.js";import"./chunk-RIUAG34V.js";import"./chunk-G5SIQY64.js";import"./chunk-WW7S4V24.js";import"./chunk-UGAMS6PU.js";import"./chunk-EHDNZUTT.js";import"./chunk-ECBUS54L.js";import"./chunk-NH7OOX2I.js";import"./chunk-B72PB7U4.js";import"./chunk-644SLL4Y.js";import"./chunk-A54VD7GL.js";import"./chunk-K55ZDM2S.js";import"./chunk-UHYNS4LH.js";import"./chunk-Z3USGHSR.js";import"./chunk-SLEIRDN7.js";import"./chunk-W3OGU5I2.js";import"./chunk-OO4IIGVK.js";import"./chunk-KQHYII76.js";import"./chunk-6I6DPRXI.js";import"./chunk-RNN6GAXL.js";import"./chunk-4IVMQ5PX.js";import"./chunk-CQUOQXLP.js";import"./chunk-VMYCUJRH.js";import"./chunk-PTVRFY4B.js";import"./chunk-3ZOLHUAU.js";import"./chunk-I6ZCG7XQ.js";import"./chunk-URULUATZ.js";import"./chunk-WOTA3FFP.js";import"./chunk-BNUQT6PD.js";import"./chunk-5DAF2FXI.js";import"./chunk-2WNCPIJC.js";import"./chunk-GDB2EJGA.js";import"./chunk-RDGFIF46.js";import"./chunk-C2ONI6UP.js";import"./chunk-H6LJ2DCJ.js";import"./chunk-IMNO5TXZ.js";import"./chunk-LCDA6FHZ.js";import"./chunk-RZPELDHM.js";import"./chunk-S3J33BKD.js";import"./chunk-NPIYHDQ7.js";import"./chunk-BL63T6AU.js";import"./chunk-AOTWUAUY.js";import"./chunk-VI4TDFI5.js";import"./chunk-GXSLPADW.js";import"./chunk-2HN33SWB.js";import"./chunk-523X5JOP.js";import"./chunk-BXR2KKYP.js";import"./chunk-7ISKCG7U.js";import"./chunk-OFGHVREP.js";import"./chunk-U3ETEC6R.js";import"./chunk-YJ3RZNO6.js";import{a as Z}from"./chunk-26R336GJ.js";import"./chunk-OC7V2CEX.js";import"./chunk-VTCODMOL.js";import"./chunk-B7GIKKEW.js";import"./chunk-R7P6RQXJ.js";import"./chunk-4I7LQWUX.js";import"./chunk-JLNQ6WQT.js";import{a as ee}from"./chunk-GB5RQL32.js";import"./chunk-4OZVVJHM.js";import"./chunk-IZRBPB5G.js";import"./chunk-X7XJWAFC.js";import"./chunk-ILCAH2F6.js";import"./chunk-CYCLIMTY.js";import"./chunk-GPQLPPA5.js";import"./chunk-OXRGERMH.js";import"./chunk-HVNUIUKO.js";import"./chunk-Y5M2SONX.js";import"./chunk-Q6ZVH4MK.js";import"./chunk-OL43UY3L.js";import"./chunk-H2QMNAXT.js";import"./chunk-GKUDWGVQ.js";import"./chunk-NZ7WSL6F.js";import"./chunk-RRDM7P6F.js";import{b as X}from"./chunk-LCTRO7CL.js";import"./chunk-LW2464MZ.js";import"./chunk-WJDHM47L.js";import"./chunk-LWJTIQQT.js";import{b as J}from"./chunk-IHBD2IWR.js";import"./chunk-NH3JQE75.js";import{a as K}from"./chunk-XXOIKNT6.js";import"./chunk-DBLGLVAQ.js";import"./chunk-HVNRUZWJ.js";import"./chunk-AYOI2Y26.js";import"./chunk-3IK5VXZ3.js";import"./chunk-MBVOWLUI.js";import"./chunk-EN6CTWVM.js";import"./chunk-IRJNWXGT.js";import"./chunk-O4AQRVFI.js";import"./chunk-NDPAZKBG.js";import"./chunk-7AZ5UVCG.js";import"./chunk-6GGK7PRJ.js";import{a as E}from"./chunk-EPTSNNZF.js";import"./chunk-FW33MEBA.js";import"./chunk-RM6CXOHZ.js";import"./chunk-AOA5JMXK.js";import"./chunk-TWW3KW7Z.js";import"./chunk-7KH77MT4.js";import"./chunk-I6LCIPDY.js";import{b as W}from"./chunk-Y6H3NTW7.js";import"./chunk-4RLJMQW4.js";import"./chunk-J6ZRC6RI.js";import"./chunk-EBGO44EK.js";import"./chunk-THY6AAMN.js";import"./chunk-7W6RATG7.js";import"./chunk-45SNVLPM.js";import{a as B,b as k,f as H,i as C,j as _,r as Y}from"./chunk-BDF7KEUQ.js";import"./chunk-HWN5REN7.js";import"./chunk-B4JAL745.js";import"./chunk-XTES2GPX.js";import{u as Q}from"./chunk-2HUIJUS4.js";import{a as R,i as x}from"./chunk-MBJHSEMD.js";import"./chunk-MXOOOTCV.js";import"./chunk-7D4IYTAJ.js";import"./chunk-TSNWBMBA.js";import"./chunk-GLWPOGYF.js";import"./chunk-YFBPRKIN.js";import"./chunk-P2YRCTWM.js";import"./chunk-OFZ6SV37.js";import"./chunk-5MNDZ6BX.js";import"./chunk-YSOJWUIW.js";import"./chunk-Q5WFUDPQ.js";import"./chunk-DPZGANVI.js";import"./chunk-T7BKG6V3.js";import"./chunk-R6VC74T7.js";import"./chunk-6WKJD7BM.js";import"./chunk-3CR7P5WT.js";import"./chunk-YRTBL7EE.js";import"./chunk-3FPO2LOS.js";import"./chunk-QNZSBADV.js";import{a as L}from"./chunk-PYQRTZNZ.js";import"./chunk-S4PLWG55.js";import"./chunk-DZAY272R.js";import"./chunk-GYH7NDHH.js";import"./chunk-S3UQHW42.js";import"./chunk-VQHENXDQ.js";import"./chunk-VWF5VUO3.js";import"./chunk-HRP5LYWJ.js";import"./chunk-BIVFGNT6.js";import"./chunk-7PEPFLZH.js";import"./chunk-BRVOQZDM.js";import"./chunk-3M7VXIQH.js";import"./chunk-TBYT66N3.js";import"./chunk-5PTS4JDF.js";import"./chunk-MUI46NAG.js";import"./chunk-N27U3N2T.js";import"./chunk-4R5NBZMW.js";import"./chunk-NDYVXEZ5.js";import"./chunk-CMMPCPP5.js";import"./chunk-4DLSYLKE.js";import"./chunk-VPXBKZQM.js";import"./chunk-ZTKK3KB7.js";import"./chunk-GZXWFBZI.js";import"./chunk-B7IARA3F.js";import"./chunk-IZVEJCCI.js";import"./chunk-TEY6TKJV.js";import"./chunk-4M6XQSBA.js";import"./chunk-2JF6YUJG.js";import{Q as h}from"./chunk-GGZQ5GCM.js";import{U as P}from"./chunk-TFUPB3ZG.js";import"./chunk-ANPNMGFG.js";import{a as c}from"./chunk-BMVJCP2M.js";import"./chunk-GMC3I5VG.js";import{b as V}from"./chunk-WGF2T2BG.js";import"./chunk-YZP43POT.js";import"./chunk-VEDIBGHD.js";import"./chunk-3IBUFXWY.js";import"./chunk-BP73DJTS.js";import"./chunk-JEGVIFEP.js";var T=class extends M{constructor(o,s,r){super(o,s,new S(de,()=>import("./chunk-P4KKUNEF.js")),r)}initializePipeline(){return I({colorWrite:q})}};var N=class extends M{constructor(o,s,r){super(o,s,new S(fe,()=>import("./chunk-XTT6FVBR.js")),r)}initializePipeline(){return I({colorWrite:q,depthTest:{func:C.LEQUAL}})}};var m=class extends se{constructor(t){super(t),this.consumes={required:["final-color"]},this.produces="final-color",this.focusAreaGeometries=new Array,this._vaos=Array(),this._count=new Array,this._origins=new Array,this._colorParameters=new he,this._maskParameters=new ue,t.techniques.precompile(N),t.techniques.precompile(T)}initialize(){this.setExtrudedVolume()}destroy(){this._vaos.forEach(t=>t.dispose()),this._vaos=[],this._count=[],this._origins=[]}render(t){let o=this.techniques.acquire(N),s=this.techniques.acquire(T),r=this.bindParameters,a=t.find(({name:p})=>p==="final-color"),n=a?.getTexture(),d=r.camera,l=d.fullViewport[2],i=d.fullViewport[3],u=this.fboCache.acquire(l,i,"focusArea",oe.RGBA),A=this.fboCache.acquire(l,i,this.produces);if(!o.compiled||!s.compiled||!this._vaos||this.effect===y.NONE)return this.requestRender(),o.release(),s.release(),A.release(),u.release(),a;let e=this.renderingContext;u.attachDepth(a.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),e.bindFramebuffer(u.fbo),e.clear(B.COLOR|B.STENCIL),e.setViewport(0,0,l,i),e.gl.clearStencil(0),e.gl.clear(e.gl.STENCIL_BUFFER_BIT),e.setClearStencil(0);for(let p=0;p<this._vaos.length;p++){let f=this._vaos[p],b=this._count[p];f&&(this._maskParameters.origin=this._origins[p],e.bindTechnique(o,r,this._maskParameters),e.setFaceCullingEnabled(!1),e.setStencilTestEnabled(!0),e.setStencilWriteMask(255),e.setStencilFunction(C.ALWAYS,0,255),e.setStencilOpSeparate(H.FRONT,_.KEEP,_.INCR_WRAP,_.KEEP),e.setStencilOpSeparate(H.BACK,_.KEEP,_.DECR_WRAP,_.KEEP),e.setDepthWriteEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.bindVAO(f),e.drawArrays(k.TRIANGLES,0,b),e.setFaceCullingEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilFunction(C.NOTEQUAL,0,255),e.setStencilWriteMask(0),e.setColorMask(!0,!0,!0,!0),e.drawArrays(k.TRIANGLES,0,b))}return o.release(),e.gl.clear(e.gl.STENCIL_BUFFER_BIT),e.bindFramebuffer(A.fbo),this._colorParameters.color=n,this._colorParameters.focusArea=u.getTexture(),this._colorParameters.effect=this.effect,e.bindTechnique(s,r,this._colorParameters),e.screen.draw(),u.release(),s.release(),A.attachDepth(a.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),A}setExtrudedVolume(){let t=this.focusAreaGeometries;this._vaos=[],this._count=[],this._origins=[];for(let o=0;o<t.length;o++){let s=t[o],r=new Array,a=s.indicesBottom;this._origins.push(s.origin);for(let i=0;i<a.length;i++)r.push(s.positions[3*(a[i]-1)]),r.push(s.positions[3*(a[i]-1)+1]),r.push(s.positions[3*(a[i]-1)+2]);let n=s.indicesExtruded;for(let i=0;i<n.length;i++)r.push(s.positions[3*n[i]]),r.push(s.positions[3*n[i]+1]),r.push(s.positions[3*n[i]+2]);let d=new Float32Array(r),l=new re(this.renderingContext,te,new Map([["geometry",me]]),new Map([["geometry",Z.createVertex(this.renderingContext,Y.STATIC_DRAW,d)]]));this._vaos?.push(l),this._count.push(a.length+n.length)}}};c([h()],m.prototype,"consumes",void 0),c([h()],m.prototype,"produces",void 0),c([h({constructOnly:!0})],m.prototype,"techniques",void 0),c([h()],m.prototype,"focusAreaGeometries",void 0),c([h()],m.prototype,"effect",void 0),m=c([P("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaRenderNode")],m);var D=class{constructor(o,s,r,a,n){this.positions=o,this.indicesBottom=s,this.indicesExtruded=r,this.height=a,this.origin=n}},y;(function(t){t[t.NONE=0]="NONE",t[t.BRIGHT=1]="BRIGHT",t[t.DARK=2]="DARK"})(y||(y={}));var O={none:y.NONE,bright:y.BRIGHT,dark:y.DARK};var g=0,we=1e4,v=class extends ne(ae){constructor(){super(...arguments),this.type="focusArea-3d",this._elevationContext=new ce,this._geometries=new Array}initialize(){this.addHandles([R(()=>this.layer.geometries,(t,o)=>{o=t,this._extrudePolygons(o),this._setFocusAreaRenderNode()},x),R(()=>this.layer.tmpEffect,(t,o)=>{o=t,this._renderNode&&o&&(this._renderNode.effect=O[o])},x),R(()=>this.layer.visible,(t,o)=>{t?this._renderNode??=new m({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:O[this.layer.tmpEffect??"none"]}):this._renderNode=V(this._renderNode)},x)])}destroy(){this._renderNode=V(this._renderNode),this._geometries=[]}_extrudePolygons(t){this._geometries=[];let o=we-g;for(let s of t){let r=K(),a=L(),n=this.view.renderCoordsHelper.viewingMode===ee.Global;n||this.view.renderCoordsHelper.worldUpAtPosition(null,a);let d=ie(s);if(d==null)return;J(s.spatialReference,[d.x,d.y,0],r,this.view.renderCoordsHelper.spatialReference);let l=Q(Ee,[r[12]-g*a[0],r[13]-g*a[1],r[14]-g*a[2]]),i=K();i[12]=-r[12],i[13]=-r[13],i[14]=-r[14];let u=le(s,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:A,mapPositions:e,position:p}=u;for(let f of A){let b=f.count,G=$(f.mapPositions,f.holeIndices,3);if(G.length===0)continue;let U=G.length,w=6*b,j=W(w+U),z=W(U),F=E(3*w),_e=E(3*w),ge=E(3*w),Ae=E(w);pe(p,e,G,f,F,ge,_e,Ae,j,z,o,a,n),X(F,F,i);let ye=new D(F,z,j,o,[r[12]+g*l[0],r[13]+g*l[1],r[14]+g*l[2]]);this._geometries.push(ye)}}}_setFocusAreaRenderNode(){this._renderNode?(this._renderNode.focusAreaGeometries=this._geometries,this._renderNode.setExtrudedVolume()):this._renderNode=new m({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:O[this.layer.tmpEffect??"none"]})}};c([h()],v.prototype,"type",void 0),c([h()],v.prototype,"layer",void 0),v=c([P("esri.views.3d.layers.FocusAreaLayerView3D")],v);var Ee=L(),yt=v;export{yt as default};
