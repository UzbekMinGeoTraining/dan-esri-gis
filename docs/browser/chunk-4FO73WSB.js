import{j as D}from"./chunk-Q5GL3CSI.js";import{g as R,h as Z,i as w}from"./chunk-4DR6EKLV.js";import{a as U}from"./chunk-2SZOQMAQ.js";import{a as F}from"./chunk-OT635BJR.js";import{a as C}from"./chunk-SDHCGQUI.js";import{a as T}from"./chunk-6N46AY7Z.js";import{a as G}from"./chunk-2WNCPIJC.js";import{a as P}from"./chunk-7X2HMUNN.js";import{b as M}from"./chunk-IHBD2IWR.js";import{a as A}from"./chunk-XXOIKNT6.js";import{v as _}from"./chunk-EPTSNNZF.js";import{p as B}from"./chunk-AOA5JMXK.js";import{a as v}from"./chunk-7W6RATG7.js";import{c as x}from"./chunk-2HUIJUS4.js";import{a as E}from"./chunk-5MNDZ6BX.js";import{f as N,g as V}from"./chunk-R6VC74T7.js";import{f as z}from"./chunk-YRTBL7EE.js";import{a as h}from"./chunk-PYQRTZNZ.js";function le(t,n,o,m,i){let s=t.stageObject,l=s.geometries,p=0;for(let c of l){if(!D(c))continue;let{update:e,averageGeometrySampledElevation:a}=k(c,n,o,m,i);p+=a,e&&s.geometryVertexAttributeUpdated(c,v.POSITION)}return p/l.length}function ce(t,n,o,m,i,s){let l=t.stageObject,p=n.centerPointInElevationSR,c=0;l.usesVerticalDistanceToGround?(m(p,d),Z(l,d.verticalDistanceToGround),c=d.sampledElevation):(m(p,d),n.mode!=="absolute-height"&&(c=d.sampledElevation));let e=E(J,s??l.transformation),a=x(H,e[12],e[13],e[14]);T.TESTS_DISABLE_OPTIMIZATIONS?(f[0]=p.x,f[1]=p.y,f[2]=d.z,M(p.spatialReference,f,e,i.spatialReference)&&(s?E(s,e):l.transformation=e)):i.setAltitudeOfTransformation(d.z,e);let u=j/i.unitInMeters;return(Math.abs(e[12]-a[0])>=u||Math.abs(e[13]-a[1])>=u||Math.abs(e[14]-a[2])>=u)&&(s?E(s,e):l.transformation=e),c}var J=A();function me(t,n,o,m,i){let s=t.graphics3DSymbolLayer.lodRenderer;if(s==null)return 0;let l=n.centerPointInElevationSR;m(l,d);let p=n.mode!=="absolute-height"?d.sampledElevation:0,c=s.instanceData,e=t.instanceIndex,a=K;c.getGlobalTransform(e,a);let u=x(H,a[12],a[13],a[14]);T.TESTS_DISABLE_OPTIMIZATIONS?(f[0]=l.x,f[1]=l.y,f[2]=d.z,M(l.spatialReference,f,a,i.spatialReference)&&c.setGlobalTransform(e,a)):i.setAltitudeOfTransformation(d.z,a);let g=j/i.unitInMeters;return(T.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(a[12]-u[0])>=g||Math.abs(a[13]-u[1])>=g||Math.abs(a[14]-u[2])>=g)&&c.setGlobalTransform(e,a),p}function pe(t,n,o,m,i){let s=t.stageObject,l=s.geometries;if(l.length===0)return 0;let p=0,c=null,e=0,a=!1;for(let u of l){if(!D(u))continue;let g=u.attributes.get(v.POSITION);if(g!==c){let{update:r,averageGeometrySampledElevation:S}=k(u,n,o,m,i);e=S,c=g,a=r}a&&s.geometryVertexAttributeUpdated(u,v.POSITION),p+=e}return p/l.length}var j=.01,f=h(),I=h(),O=h(),K=A(),H=h(),d=new w;function k(t,n,o,m,i){let s=!1,l=t.transformation,p=n.requiresSampledElevationInfo;I[0]=l[12],I[1]=l[13],I[2]=l[14],t.invalidateBoundingInfo();let c=t.getMutableAttribute(v.POSITION),e=c.data,a=c.size,u=e.length/a,g=new U(t.mapPositions,o),r=0,S=0;for(let L=0;L<u;L++){if(O[0]=e[r],O[1]=e[r+1],O[2]=e[r+2],m(g,d),p&&(S+=d.sampledElevation),T.TESTS_DISABLE_OPTIMIZATIONS)e[r]=g.array[g.offset],e[r+1]=g.array[g.offset+1],e[r+2]=d.z,B(e,o,r,e,i.spatialReference,r,1),e[r]-=I[0],e[r+1]-=I[1],e[r+2]-=I[2],s=!0;else{f[0]=e[r]+I[0],f[1]=e[r+1]+I[1],f[2]=e[r+2]+I[2],i.setAltitude(f,d.z),e[r]=f[0]-I[0],e[r+1]=f[1]-I[1],e[r+2]=f[2]-I[2];let y=j/i.unitInMeters;(Math.abs(O[0]-e[r])>=y||Math.abs(O[1]-e[r+1])>=y||Math.abs(O[2]-e[r+2])>=y)&&(s=!0)}r+=a,g.offset+=3}return S/=u,{update:s,averageGeometrySampledElevation:S}}var q=class{constructor(n,o=null){this.labelText=o,this.elevationOffset=n??0}};function Te(t,n,o,m,i){if(W(t,n))return null;o.localOrigin=Q(t,n);let s=new F({geometries:[o],castShadow:!1,layerUid:t.layer.uid,graphicUid:i,usesVerticalDistanceToGround:!0});return{object:s,sampledElevation:R(s,n,t.elevationProvider,t.renderCoordsHelper,m)}}function Ee(t,n,o,m){return W(n,o)?null:R(t,o,n.elevationProvider,n.renderCoordsHelper,m)}function W(t,n){let o=t.clippingExtent;return!!o&&(P(n,b,t.elevationProvider.spatialReference),!_(o,b))}function Pe(t,n,o){let m=t.elevationContext,i=o.spatialReference;P(n,b,i),m.centerPointInElevationSR=G(b[0],b[1],n.hasZ?b[2]:0,i??null)}function ye(t){switch(t.type){case"point":return t;case"polygon":case"extent":return C(t);case"polyline":{let n=t.paths[0];if(!n||n.length===0)return null;let o=V(n,N(n)/2);return G(o[0],o[1],o[2],t.spatialReference)}case"mesh":return t.extent.center}return null}function Q(t,n){return P(n,b,t.renderCoordsHelper.spatialReference),t.localOriginFactory.getOrigin(b)}var b=h();var Me=1.2,Ge=z,Re=4;export{le as a,ce as b,me as c,pe as d,q as e,Te as f,Ee as g,Pe as h,ye as i,Q as j,Me as k,Ge as l,Re as m};
