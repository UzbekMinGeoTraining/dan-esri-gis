import{a as Z}from"./chunk-NP35J4DQ.js";import{b as X}from"./chunk-6DXGZQQN.js";import{a as W,b as L}from"./chunk-TCQTMUK4.js";import{b as Q,d as B}from"./chunk-XXOIKNT6.js";import{a as J,d as K}from"./chunk-Y6H3NTW7.js";import{a as y}from"./chunk-EBGO44EK.js";import{a as T}from"./chunk-7W6RATG7.js";import{H as k,c as A,d as b,n as x,q as V,x as j,y as q}from"./chunk-2HUIJUS4.js";import{a as v,b as Y,c as R}from"./chunk-PYQRTZNZ.js";import{a as F}from"./chunk-VEDIBGHD.js";import{G as H,L as D,O as U}from"./chunk-BP73DJTS.js";import{a as E,b as z}from"./chunk-JEGVIFEP.js";function $(h){if(h.length<U)return Array.from(h);if(D(h))return Float64Array.from(h);if(!("BYTES_PER_ELEMENT"in h))return Array.from(h);switch(h.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(h);case 2:return H(h)?Uint16Array.from(h):Int16Array.from(h);case 4:return Float32Array.from(h);default:return Float64Array.from(h)}}var N=class h{constructor(t,i,n){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.position=n,this._children=void 0,y(t.length>=1),y(n.size===3||n.size===4);let{data:r,size:a,indices:o}=n;y(o.length%this._numIndexPerPrimitive==0),y(o.length>=t.length*this._numIndexPerPrimitive);let u=t.length,s=a*o[this._numIndexPerPrimitive*t[0]];M.clear(),M.push(s);let c=R(r[s],r[s+1],r[s+2]),e=Y(c);for(let g=0;g<u;++g){let f=this._numIndexPerPrimitive*t[g];for(let _=0;_<this._numIndexPerPrimitive;++_){s=a*o[f+_],M.push(s);let d=r[s];c[0]=Math.min(d,c[0]),e[0]=Math.max(d,e[0]),d=r[s+1],c[1]=Math.min(d,c[1]),e[1]=Math.max(d,e[1]),d=r[s+2],c[2]=Math.min(d,c[2]),e[2]=Math.max(d,e[2])}}this.bbMin=c,this.bbMax=e;let l=j(v(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(e[0]-c[0],e[1]-c[1]),e[2]-c[2]);let I=this.radius*this.radius;for(let g=0;g<M.length;++g){s=M.at(g);let f=r[s]-l[0],_=r[s+1]-l[1],d=r[s+2]-l[2],O=f*f+_*_+d*d;if(O<=I)continue;let w=Math.sqrt(O),G=.5*(w-this.radius);this.radius=this.radius+G,I=this.radius*this.radius;let C=G/w;l[0]+=f*C,l[1]+=_*C,l[2]+=d*C}this.center=l,M.clear()}getChildren(){if(this._children||V(this.bbMin,this.bbMax)<=1)return this._children;let t=j(v(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,n=new Uint8Array(i),r=new Array(8);for(let e=0;e<8;++e)r[e]=0;let{data:a,size:o,indices:u}=this.position;for(let e=0;e<i;++e){let l=0,I=this._numIndexPerPrimitive*this.primitiveIndices[e],g=o*u[I],f=a[g],_=a[g+1],d=a[g+2];for(let O=1;O<this._numIndexPerPrimitive;++O){g=o*u[I+O];let w=a[g],G=a[g+1],C=a[g+2];w<f&&(f=w),G<_&&(_=G),C<d&&(d=C)}f<t[0]&&(l|=1),_<t[1]&&(l|=2),d<t[2]&&(l|=4),n[e]=l,++r[l]}let s=0;for(let e=0;e<8;++e)r[e]>0&&++s;if(s<2)return;let c=new Array(8);for(let e=0;e<8;++e)c[e]=r[e]>0?new Uint32Array(r[e]):void 0;for(let e=0;e<8;++e)r[e]=0;for(let e=0;e<i;++e){let l=n[e];c[l][r[l]++]=this.primitiveIndices[e]}this._children=new Array;for(let e=0;e<8;++e)c[e]!==void 0&&this._children.push(new h(c[e],this._numIndexPerPrimitive,this.position));return this._children}static prune(){M.prune()}},M=new F({deallocator:null});function tt(h,t){if(!h)return!1;let{size:i,data:n,indices:r}=h;A(t,0,0,0),A(p,0,0,0);let a=0,o=0;for(let u=0;u<r.length-2;u+=3){let s=r[u]*i,c=r[u+1]*i,e=r[u+2]*i;A(m,n[s],n[s+1],n[s+2]),A(P,n[c],n[c+1],n[c+2]),A(S,n[e],n[e+1],n[e+2]);let l=X(m,P,S);l?(b(m,m,P),b(m,m,S),x(m,m,1/3*l),b(t,t,m),a+=l):(b(p,p,m),b(p,p,P),b(p,p,S),o+=3)}return(o!==0||a!==0)&&(a!==0?(x(t,t,1/a),!0):o!==0&&(x(t,p,1/o),!0))}function it(h,t){if(!h)return!1;let{size:i,data:n,indices:r}=h;A(t,0,0,0);let a=-1,o=0;for(let u=0;u<r.length;u++){let s=r[u]*i;a!==s&&(t[0]+=n[s],t[1]+=n[s+1],t[2]+=n[s+2],o++),a=s}return o>1&&x(t,t,1/o),o>0}function et(h,t,i){if(!h)return!1;A(i,0,0,0),A(p,0,0,0);let n=0,r=0,{size:a,data:o,indices:u}=h,s=u.length-1,c=s+(t?2:0);for(let e=0;e<c;e+=2){let l=e<s?e+1:0,I=u[e<s?e:s]*a,g=u[l]*a;m[0]=o[I],m[1]=o[I+1],m[2]=o[I+2],P[0]=o[g],P[1]=o[g+1],P[2]=o[g+2],x(m,b(m,m,P),.5);let f=k(m,P);f>0?(b(i,i,x(m,m,f)),n+=f):n===0&&(b(p,p,m),r++)}return n!==0?(x(i,i,1/n),!0):r!==0&&(x(i,p,1/r),!0)}var m=v(),P=v(),S=v(),p=v();var nt=class h extends W{constructor(t,i,n=null,r=L.Mesh,a=null,o=-1){super(),this.material=t,this.mapPositions=n,this.type=r,this.objectAndLayerIdColor=a,this.edgeIndicesLength=o,this.highlights=new Set,this._highlightGroupCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(let[u,s]of i)this._attributes.set(u,z(E({},s),{indices:J(s.indices)})),u===T.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(u).indices.length:this.edgeIndicesLength)}instantiate(t={}){let i=new h(t.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((n,r)=>{n.exclusive=!1,i._attributes.set(r,n)}),i._boundingInfo=this._boundingInfo,i.transformation=t.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(t){let i=this._attributes.get(t);return i&&!i.exclusive&&(i=z(E({},i),{exclusive:!0,data:$(i.data)}),this._attributes.set(t,i)),i}setAttributeData(t,i){let n=this._attributes.get(t);n&&this._attributes.set(t,z(E({},n),{exclusive:!0,data:i}))}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===L.Mesh?this._computeAttachmentOriginTriangles(t):this.type===L.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(this._transformation!=null&&q(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){let i=this.attributes.get(T.POSITION);return tt(i,t)}_computeAttachmentOriginLines(t){let i=this.attributes.get(T.POSITION);return et(i,st(this.material.parameters,i),t)}_computeAttachmentOriginPoints(t){let i=this.attributes.get(T.POSITION);return it(i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){let t=this.attributes.get(T.POSITION);if(!t||t.indices.length===0)return null;let i=this.type===L.Mesh?3:1;y(t.indices.length%i==0,"Indexing error: "+t.indices.length+" not divisible by "+i);let n=K(t.indices.length/i);return new N(n,i,t)}get transformation(){return this._transformation??B}set transformation(t){this._transformation=t&&t!==B?Q(t):null}get highlightGroups(){return this._highlightGroupCounts}get hasHighlights(){return this._highlightGroupCounts.size>0}foreachHighlightGroup(t){this._highlightGroupCounts.forEach((i,n)=>t(n))}allocateIdAndHighlight(t){let i=new Z(t);return this.addHighlight(i)}addHighlight(t){this.highlights.add(t);let{highlightGroupName:i}=t,n=(this._highlightGroupCounts.get(i)??0)+1;return this._highlightGroupCounts.set(i,n),t}removeHighlight(t){if(this.highlights.delete(t)){let{highlightGroupName:i}=t,n=this._highlightGroupCounts.get(i)??0;n<=1?this._highlightGroupCounts.delete(i):this._highlightGroupCounts.set(i,n-1)}}};function st(h,t){return!(!("isClosed"in h)||!h.isClosed)&&t.indices.length>2}export{N as a,$ as b,nt as c};
