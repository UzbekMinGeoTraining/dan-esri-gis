import{a as z}from"./chunk-OH475TQV.js";import{c as h,e as q,f as O,g as A,h as x,s as G,t as j,w as V}from"./chunk-PM4ZR7W6.js";import{a as m}from"./chunk-PJX4LNSV.js";import{a as f,e as d,g as F}from"./chunk-Q5WFUDPQ.js";import{m as C,n as N,t as w,x as b}from"./chunk-N27U3N2T.js";import{B as P}from"./chunk-4DLSYLKE.js";import{t as S}from"./chunk-3IBUFXWY.js";import{g as R}from"./chunk-JEGVIFEP.js";var Z=new m,Y=new m,M=new m,v={esriGeometryPoint:h,esriGeometryPolyline:O,esriGeometryPolygon:A,esriGeometryMultipoint:q};function se(e,t,n,i=e.hasZ,s=e.hasM){if(t==null)return null;let r=e.hasZ&&i,o=e.hasM&&s;if(n){let l=G(M,t,e.hasZ,e.hasM,"esriGeometryPoint",n,i,s);return h(l,r,o)}return h(t,r,o)}function y(e,t,n,i,s,r,o=t,l=n){let u=t&&o,a=n&&l,p=i!=null?"coords"in i?i:i.geometry:null;if(p==null)return null;if(s){let c=j(Y,p,t,n,e,s,o,l);return r&&(c=G(M,c,u,a,e,r)),v[e]?.(c,u,a)??null}if(r){let c=G(M,p,t,n,e,r,o,l);return v[e]?.(c,u,a)??null}return V(Z,p,t,n,o,l),v[e]?.(Z,u,a)??null}function le(e){return e&&J in e?JSON.parse(JSON.stringify(e,B)):e}var J="_geVersion",B=(e,t)=>e!==J?t:void 0;function Q(e){return e==="mesh"?w:b(e)}function U(e,t){return e?t?4:3:t?3:2}function W(e,t,n,i){return k(e,t,n,i.coords[0],i.coords[1])}function _(e,t,n,i,s,r){let o=U(s,r),{coords:l,lengths:u}=i;if(!u)return!1;for(let a=0,p=0;a<u.length;a++,p+=o)if(!k(e,t,n,l[p],l[p+1]))return!1;return!0}function k(e,t,n,i,s){if(!e)return!1;let r=U(t,n),{coords:o,lengths:l}=e,u=!1,a=0;for(let p of l)u=H(u,o,r,a,p,i,s),a+=p*r;return u}function H(e,t,n,i,s,r,o){let l=e,u=i;for(let a=i,p=i+s*n;a<p;a+=n){u=a+n,u===p&&(u=i);let c=t[a],g=t[a+1],D=t[u],I=t[u+1];(g<o&&I>=o||I<o&&g>=o)&&c+(o-g)/(I-g)*(D-c)<r&&(l=!l)}return l}var E="unsupported-query",K={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},T={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function L(e){return e!=null&&T.spatialRelationship[e]===!0}function X(e){return e!=null&&T.queryGeometry[F(e)]===!0}function $(e){return e!=null&&T.layerGeometry[e]===!0}function ee(){return import("./chunk-JV4XXL5J.js")}function Ne(e,t,n,i,s){if(d(t)&&n==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains")){let r=x(new m,t,!1,!1);return Promise.resolve(o=>W(r,!1,!1,o))}if(d(t)&&n==="esriGeometryMultipoint"){let r=x(new m,t,!1,!1);if(e==="esriSpatialRelContains")return Promise.resolve(o=>_(r,!1,!1,o,i,s))}if(f(t)&&n==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains"))return Promise.resolve(r=>C(t,y(n,i,s,r)));if(f(t)&&n==="esriGeometryMultipoint"&&e==="esriSpatialRelContains")return Promise.resolve(r=>N(t,y(n,i,s,r)));if(f(t)&&e==="esriSpatialRelIntersects"){let r=Q(n);return Promise.resolve(o=>r(t,y(n,i,s,o)))}return ee().then(r=>{let o=r[K[e]].bind(null,t.spatialReference,t);return l=>o(y(n,i,s,l))})}function we(e,t,n){return R(this,null,function*(){let{spatialRel:i,geometry:s}=e;if(s){if(!L(i))throw new S(E,"Unsupported query spatial relationship",{query:e});if(P(s.spatialReference)&&P(n)){if(!X(s))throw new S(E,"Unsupported query geometry type",{query:e});if(!$(t))throw new S(E,"Unsupported layer geometry type",{query:e});if(e.outSR)return z(e.geometry?.spatialReference,e.outSR)}}})}function be(e){if(f(e))return!0;if(d(e)){for(let t of e.rings)if(t.length!==5||t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1;return!0}return!1}function Oe(e,t){return R(this,null,function*(){if(!e)return null;let n=t.featureAdapter,{startTimeField:i,endTimeField:s}=e,r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(i&&s)yield t.forEach(l=>{let u=n.getAttribute(l,i),a=n.getAttribute(l,s);u==null||isNaN(u)||(r=Math.min(r,u)),a==null||isNaN(a)||(o=Math.max(o,a))});else{let l=i||s;yield t.forEach(u=>{let a=n.getAttribute(u,l);a==null||isNaN(a)||(r=Math.min(r,a),o=Math.max(o,a))})}return{start:r,end:o}})}function Ae(e,t,n){if(!t||!e)return null;let{startTimeField:i,endTimeField:s}=e;if(!i&&!s)return null;let{start:r,end:o}=t;if(r===null&&o===null)return null;if(r===void 0&&o===void 0)return ne();let l=n.getAttributeAsTimestamp?.bind(n)??n.getAttribute.bind(n);return i&&s?te(l,i,s,r,o):re(l,i||s,r,o)}function te(e,t,n,i,s){return i!=null&&s!=null?r=>{let o=e(r,t),l=e(r,n);return(o==null||o<=s)&&(l==null||l>=i)}:i!=null?r=>{let o=e(r,n);return o==null||o>=i}:s!=null?r=>{let o=e(r,t);return o==null||o<=s}:void 0}function re(e,t,n,i){return n!=null&&i!=null&&n===i?s=>e(s,t)===n:n!=null&&i!=null?s=>{let r=e(s,t);return r!=null&&r>=n&&r<=i}:n!=null?s=>{let r=e(s,t);return r!=null&&r>=n}:i!=null?s=>{let r=e(s,t);return r!=null&&r<=i}:void 0}function ne(){return()=>!1}export{se as a,y as b,le as c,Ne as d,we as e,be as f,Oe as g,Ae as h};
