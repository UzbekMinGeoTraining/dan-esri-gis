import{A as F,J as Y,R as Z,S as P,b as W,f as x,h as z,i as Q,j as H,k as G,m as J,n as V,q as I,r as A,s as L,v as X,x as p,z as _}from"./chunk-4M6XQSBA.js";import{k as N,n as E,q as K,t as B}from"./chunk-GMC3I5VG.js";import{b as $,k as g,t as C}from"./chunk-3IBUFXWY.js";import{a as y}from"./chunk-BP73DJTS.js";import{a as w,g as h}from"./chunk-JEGVIFEP.js";var fe="20241122",he="f6f7099a0e79cf518abdcf87c5aa8b6f24ecdcd8";Symbol.dispose??=Symbol("Symbol.dispose"),Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");var ye="4.31",d,ge=ye;ge="4.31.6";function Re(e){d=e}function je(e){let r=d?.findCredential(e);return r?.token?Z(e,"token",r.token):e}y("host-webworker")||globalThis.$arcgis||Object.defineProperty(globalThis,"$arcgis",{configurable:!1,enumerable:!0,writable:!1,value:{}}),y("host-webworker");var we=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function be(e){let r=p(e,!0);return!!r&&r.endsWith(".arcgis.com")&&!we.has(r)&&!e.endsWith("/sharing/rest/generateToken")}function ee(e,r){return!(!r&&!g.apiKey||!be(e))}function te(e,r,t=!1,o){return new Promise((s,a)=>{if(E(o))return void a(re());let l=()=>{n(),a(new Error(`Unable to load ${r}`))},i=()=>{let m=e;n(),s(m)},u=()=>{if(!e)return;let m=e;n(),m.src="",a(re())},n=()=>{y("esri-image-decode")||(e.removeEventListener("error",l),e.removeEventListener("load",i)),l=null,i=null,e=null,o?.removeEventListener("abort",u),u=null,t&&URL.revokeObjectURL(r)};o?.addEventListener("abort",u),y("esri-image-decode")?e.decode().then(i,l):(e.addEventListener("error",l),e.addEventListener("load",i))})}function re(){try{return new DOMException("Aborted","AbortError")}catch{let e=new Error;return e.name="AbortError",e}}var se="Timeout exceeded";function oe(){return new Error(se)}function Be(e){return typeof e=="object"&&!!e&&"message"in e&&e.message===se}function ae(e){g.request.crossOriginNoCorsDomains||(g.request.crossOriginNoCorsDomains={});let r=g.request.crossOriginNoCorsDomains;for(let t of e)t=t.toLowerCase(),/^https?:\/\//.test(t)?r[p(t)??""]=0:(r[p("http://"+t)??""]=0,r[p("https://"+t)??""]=0)}function ne(e){let r=g.request.crossOriginNoCorsDomains;if(r){let t=p(e);if(t)return t=t.toLowerCase(),!A(t,x())&&r[t]<Date.now()-36e5}return!1}function ie(e){return h(this,null,function*(){let r=z(e);e=r.path,r.query?.f==="json"&&(e+="?f=json");try{yield fetch(e,{mode:"no-cors",credentials:"include"})}catch{}let t=g.request.crossOriginNoCorsDomains,o=p(e);t&&o&&(t[o.toLowerCase()]=Date.now())})}function b(e,r){return h(this,null,function*(){e instanceof URL&&(e=e.toString()),r?.query instanceof URLSearchParams&&(r.query=Q(r.query.toString().replaceAll("+"," ")));let t=F(e),o=_(e);o||t||(e=X(e));let s={url:e,requestOptions:w({},r)},a=c=>({data:c,getAllHeaders:S,getHeader:S,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),l=I(e,f.internalInterceptors);if(l){let c=yield ce(l,s);if(c!=null)return a(c)}let i=I(e);if(i){let c=yield ce(i,s);if(c!=null)return a(c);i.after||i.error||(i=null)}if(e=s.url,(r=s.requestOptions).responseType==="image"&&(y("host-webworker")||y("host-node")))throw q("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(r.method==="head"){if(r.body)throw q("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(t||o)throw q("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(yield ve(),D)return D.execute(e,r);let u=new AbortController,n=K(r,()=>u.abort()),m={controller:u,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:i,params:s,redoRequest:!1,useIdentity:f.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},O=yield xe(m).finally(()=>n?.remove());return i?.after?.(O),O})}var D,f=g.request,me="FormData"in globalThis,qe=new Set([499,498,403,401]),Te=new Set(["COM_0056","COM_0057","SB_0008"]),Se=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],S=()=>null,U=Symbol();function Oe(e){let r=p(e);r&&!b._corsServers.includes(r)&&b._corsServers.push(r)}function le(e){let r=p(e);return!r||r.endsWith(".arcgis.com")||b._corsServers.includes(r)||L(r)}function q(e,r,t,o){let s="Error",a={url:t.url,requestOptions:t.requestOptions,getAllHeaders:S,getHeader:S,ssl:!1};if(r instanceof C)return r.details?(r.details=$(r.details),r.details.url=t.url,r.details.requestOptions=t.requestOptions):r.details=a,r;if(r){let l=o&&(()=>Array.from(o.headers)),i=o&&(m=>o.headers.get(m)),u=o?.status,n=r.message;n&&(s=n),l&&i&&(a.getAllHeaders=l,a.getHeader=i),a.httpStatus=(r.httpCode!=null?r.httpCode:r.code)||u||0,a.subCode=r.subcode,a.messageCode=r.messageCode,typeof r.details=="string"?a.messages=[r.details]:a.messages=r.details,a.raw=U in r?r[U]:r}return B(r)?N():new C(e,s,a)}function ve(){return h(this,null,function*(){y("host-webworker")&&!D&&(D=yield import("./chunk-WLKOOJQR.js"))})}function M(){return h(this,null,function*(){d||(yield import("./chunk-TRDZQL5A.js"))})}function ke(e){return h(this,null,function*(){let r=e.params.url,t=e.params.requestOptions,o=e.controller.signal,s=t.body,a=null,l=null;if(me&&"HTMLFormElement"in globalThis&&(s instanceof FormData?a=s:s instanceof HTMLFormElement&&(a=new FormData(s))),typeof s=="string"&&(l=s),e.fetchOptions={cache:t.cacheBust?"no-cache":"default",credentials:"same-origin",headers:t.headers||{},method:t.method==="head"?"HEAD":"GET",mode:"cors",priority:f.priority,redirect:"follow",signal:o},(a||l)&&(e.fetchOptions.body=a||l),t.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(r)||t.query?.token||a?.get("token")),!e.hasToken&&ee(r)&&(t.query||(t.query={}),t.query.token=g.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!pe(r)&&!E(o)){let i;t.authMode==="immediate"?(yield M(),i=yield d.getCredential(r,{signal:o}),e.credential=i):t.authMode==="no-prompt"?(yield M(),i=yield d.getCredential(r,{prompt:!1,signal:o}).catch(()=>{}),e.credential=i):d&&(i=d.findCredential(r)),i&&(e.credentialToken=i.token,e.useSSL=!!i.ssl)}})}function pe(e){return Se.some(r=>r.test(e))}function Ce(e){return h(this,null,function*(){let r=e.params.url,t=e.params.requestOptions,o=e.fetchOptions??{},s=_(r)||F(r),a=t.responseType||"json",l=s?0:t.timeout!=null?t.timeout:f.timeout,i=!1;if(!s){e.useSSL&&(r=Y(r));let c=w({},t.query);e.credentialToken&&(c.token=e.credentialToken);let T=H(c);y("esri-url-encodes-apostrophe")&&(T=T.replaceAll("'","%27"));let R=r.length+1+T.length,j;i=t.method==="delete"||t.method==="post"||t.method==="put"||!!t.body||R>f.maxUrlLength;let v=t.useProxy||!!V(r);if(v){let k=G(r);j=k.path,!i&&j.length+1+R>f.maxUrlLength&&(i=!0),k.query&&(c=w(w({},k.query),c))}if(o.method==="HEAD"&&(i||v)){if(i)throw R>f.maxUrlLength?q("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):q("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(v)throw q("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}i?(o.method=t.method==="delete"?"DELETE":t.method==="put"?"PUT":"POST",t.body?r=P(r,c):(o.body=H(c),o.headers||(o.headers={}),o.headers["Content-Type"]="application/x-www-form-urlencoded")):r=P(r,c),v&&(e.useProxy=!0,r=`${j}?${r}`),c.token&&me&&o.body instanceof FormData&&!W(r)&&o.body.set("token",c.token),t.hasOwnProperty("withCredentials")?e.withCredentials=t.withCredentials:A(r,x())||(L(r)||d&&d.findServerInfo(r)?.webTierAuth)&&(e.withCredentials=!0),e.withCredentials&&(o.credentials="include",ne(r)&&(yield ie(i?P(r,c):r)))}let u,n,m=0,O=!1;l>0&&(m=setTimeout(()=>{O=!0,e.controller.abort()},l));try{if(t.responseType==="native-request-init")n=o,n.url=r,t.signal?n.signal=t.signal:delete n.signal;else if(t.responseType!=="image"||o.cache!=="default"||o.method!=="GET"||i||Ee(t.headers)||!s&&!e.useProxy&&f.proxyUrl&&!le(r)){if(b._beforeFetch&&(yield b._beforeFetch(r,o)),u=yield fetch(r,o),b._afterFetch&&(yield b._afterFetch(u)),e.useProxy||Oe(r),t.responseType==="native")n=u;else if(o.method!=="HEAD")if(u.ok){switch(a){case"array-buffer":n=yield u.arrayBuffer();break;case"blob":case"image":n=yield u.blob();break;default:n=yield u.text()}if(m&&(clearTimeout(m),m=0),a==="json"||a==="xml"||a==="document")if(n)switch(a){case"json":n=JSON.parse(n);break;case"xml":n=ue(n,"application/xml");break;case"document":n=ue(n,"text/html")}else n=null;if(n){if(a==="array-buffer"||a==="blob"){let c=u.headers.get("Content-Type");if(c&&/application\/json|text\/plain/i.test(c)&&n[a==="blob"?"size":"byteLength"]<=750)try{let T=yield new Response(n).json();T.error&&(n=T)}catch{}}a==="image"&&n instanceof Blob&&(n=yield de(URL.createObjectURL(n),e,!0))}}else{n=yield u.text();try{n=JSON.parse(n)}catch{}}}else n=yield de(r,e)}catch(c){if(c.name==="AbortError")throw O?oe():N("Request canceled");if(!(!u&&c instanceof TypeError&&f.proxyUrl)||t.body||t.method==="delete"||t.method==="head"||t.method==="post"||t.method==="put"||e.useProxy||le(r))throw c;e.redoRequest=!0,J({proxyUrl:f.proxyUrl,urlPrefix:p(r)??""})}finally{m&&clearTimeout(m)}return[u,n]})}function ce(e,r){return h(this,null,function*(){if(e.responseData!=null)return e.responseData;if(e.headers&&(r.requestOptions.headers=w(w({},r.requestOptions.headers),e.headers)),e.query&&(r.requestOptions.query=w(w({},r.requestOptions.query),e.query)),e.before){let t,o;try{o=yield e.before(r)}catch(s){t=q("request:interceptor",s,r)}if((o instanceof Error||o instanceof C)&&(t=q("request:interceptor",o,r)),t)throw e.error&&e.error(t),t;return o}})}function Ee(e){if(e){for(let r of Object.getOwnPropertyNames(e))if(e[r])return!0}return!1}function ue(e,r){let t;try{t=new DOMParser().parseFromString(e,r)}catch{}if(!t||t.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return t}function xe(e){return h(this,null,function*(){let r,t;yield ke(e);try{do[r,t]=yield Ce(e);while(!(yield Ae(e,r,t)))}catch(a){let l=q("request:server",a,e.params,r);throw l.details.ssl=e.useSSL,e.interceptor?.error&&e.interceptor.error(l),l}let o=e.params.url;if(t&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(o)){if(!e.hasToken&&!e.credentialToken&&t.user?.username&&!L(o)){let a=p(o,!0);a&&f.trustedServers.push(a)}Array.isArray(t.authorizedCrossOriginNoCorsDomains)&&ae(t.authorizedCrossOriginNoCorsDomains)}let s=e.credential;if(s&&d){let l=d.findServerInfo(s.server)?.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");let i=d.findCredential(l,s.userId);i&&d._getIdenticalSvcIdx(l,i)===-1&&i.resources.unshift(l)}}return{data:t,getAllHeaders:r?()=>Array.from(r.headers):S,getHeader:r?a=>r.headers.get(a):S,httpStatus:r?.status??200,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}})}function Ae(e,r,t){return h(this,null,function*(){if(e.redoRequest)return e.redoRequest=!1,!1;let o=e.params.requestOptions;if(!r||o.responseType==="native"||o.responseType==="native-request-init")return!0;let s,a;if(t&&(t.error&&typeof t.error=="object"?s=t.error:t.status==="error"&&Array.isArray(t.messages)&&(s=w({},t),s[U]=t,s.details=t.messages)),!s&&!r.ok)throw s=new Error(`Unable to load ${r.url} status: ${r.status}`),s[U]=t,s;let l,i=null;s&&(a=Number(s.code),i=s.hasOwnProperty("subcode")?Number(s.subcode):null,l=s.messageCode,l=l?.toUpperCase());let u=o.authMode;if(a===403&&(i===4||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(u!=="no-prompt"||a===498)&&a!==void 0&&qe.has(a)&&!pe(e.params.url)&&(a!==403||(!l||!Te.has(l))&&(i==null||i===2&&e.credentialToken))){yield M();try{let n=yield d.getCredential(e.params.url,{error:q("request:server",s,e.params),prompt:u!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=n,e.credentialToken=n.token,e.useSSL=e.useSSL||n.ssl,!1}catch(n){if(u==="no-prompt")return e.credential=void 0,e.credentialToken=void 0,!1;s=n}}if(s)throw s;return!0})}function de(e,r,t=!1){let o=r.controller.signal,s=new Image;return r.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=f.priority,s.src=e,te(s,e,t,o)}b._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],b._beforeFetch=void 0,b._afterFetch=void 0;export{fe as a,he as b,ye as c,d,ge as e,Re as f,je as g,ee as h,te as i,Be as j,b as k};
