import{l as M}from"./chunk-FG5U4A7J.js";import"./chunk-VJX4SEWU.js";import{d as I,e as N}from"./chunk-ZEZQI55V.js";import"./chunk-YRCMQA7S.js";import"./chunk-M2LOI65L.js";import"./chunk-OD6TX477.js";import"./chunk-GB5RQL32.js";import"./chunk-X7XJWAFC.js";import"./chunk-FOAEOOK3.js";import"./chunk-CYCLIMTY.js";import"./chunk-Q6ZVH4MK.js";import{a as L}from"./chunk-7X2HMUNN.js";import"./chunk-NH3JQE75.js";import"./chunk-XXOIKNT6.js";import"./chunk-DBLGLVAQ.js";import{a as E}from"./chunk-AYOI2Y26.js";import"./chunk-EN6CTWVM.js";import"./chunk-IRJNWXGT.js";import{h as D,q as A,t as T}from"./chunk-FW33MEBA.js";import"./chunk-RM6CXOHZ.js";import"./chunk-AOA5JMXK.js";import"./chunk-TWW3KW7Z.js";import"./chunk-HWN5REN7.js";import"./chunk-XTES2GPX.js";import{p as z}from"./chunk-2HUIJUS4.js";import"./chunk-VDNXTMSC.js";import{a as w,c as x,g as V,h as C,i as j}from"./chunk-MBJHSEMD.js";import"./chunk-YFBPRKIN.js";import"./chunk-OFZ6SV37.js";import"./chunk-YSOJWUIW.js";import"./chunk-Q5WFUDPQ.js";import{o as R}from"./chunk-T7BKG6V3.js";import"./chunk-R6VC74T7.js";import"./chunk-6WKJD7BM.js";import"./chunk-3CR7P5WT.js";import"./chunk-YRTBL7EE.js";import"./chunk-3FPO2LOS.js";import"./chunk-QNZSBADV.js";import{a as S}from"./chunk-PYQRTZNZ.js";import"./chunk-VQHENXDQ.js";import{a as v}from"./chunk-VWF5VUO3.js";import"./chunk-HRP5LYWJ.js";import"./chunk-BIVFGNT6.js";import"./chunk-BRVOQZDM.js";import"./chunk-3M7VXIQH.js";import"./chunk-TBYT66N3.js";import"./chunk-5PTS4JDF.js";import{l as G}from"./chunk-N27U3N2T.js";import"./chunk-4R5NBZMW.js";import"./chunk-NDYVXEZ5.js";import"./chunk-CMMPCPP5.js";import"./chunk-4DLSYLKE.js";import"./chunk-VPXBKZQM.js";import"./chunk-GZXWFBZI.js";import"./chunk-B7IARA3F.js";import"./chunk-IZVEJCCI.js";import"./chunk-TEY6TKJV.js";import"./chunk-4M6XQSBA.js";import"./chunk-2JF6YUJG.js";import{Q as i,S as y}from"./chunk-GGZQ5GCM.js";import{U as h}from"./chunk-TFUPB3ZG.js";import"./chunk-ANPNMGFG.js";import{a as o}from"./chunk-BMVJCP2M.js";import{f as u}from"./chunk-GMC3I5VG.js";import"./chunk-WGF2T2BG.js";import"./chunk-YZP43POT.js";import"./chunk-VEDIBGHD.js";import"./chunk-3IBUFXWY.js";import{u as P}from"./chunk-BP73DJTS.js";import{a as O,g as _}from"./chunk-JEGVIFEP.js";var d=class extends y{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(e){super(e),this._updatingHandles=new E}initialize(){this.addHandles([u(this._updatingHandles),this._updatingHandles.add(()=>{let e=this.element.georeference;return e?.type==="control-points"?e.controlPoints:null},e=>this._elementControlPointsChanged(e),C)])}_elementControlPointsChanged(e){if(this._updatedElementControlPoints===e)return;let t=e?.map(({mapPoint:n})=>n).filter(P),r=this.view.spatialReference;this._updatingHandles.addPromise(this._whenProjected(t,r,n=>{if(!n)return void this._replaceOperations(null);let{_operations:s}=this,c=new R({rings:[n.map(({x:l,y:f})=>[l,f])],spatialReference:r});s?.trySetGeometry(c)?this.onModifiedExternally():this._replaceOperations(M.fromGeometry(c,this.view.state.viewingMode))}))}_operationsGeometryChanged(){let{element:{georeference:e},_operations:t}=this;if(!t||!e||e.type!=="control-points"||!e.controlPoints)return;let r=t.data.geometry,n=e.controlPoints.map(({mapPoint:l})=>l).filter(P);if(r.rings[0]?.length!==n.length)return void this._updateElementControlPoints(null);let s=r.rings[0].map(([l,f])=>new G({x:l,y:f,spatialReference:r.spatialReference})),c=n.map(({spatialReference:l})=>l);this._updatingHandles.addPromise(this._whenProjected(s,c,l=>this._updateElementControlPoints(l)))}_updateElementControlPoints(e){let{georeference:t}=this.element;if(!t||!e||t.type!=="control-points"||t.controlPoints?.length!==e?.length)return;e||(t.controlPoints=null);let r=t.controlPoints;if(r?.length===e.length)for(let n=0;n<r.length;n++)r[n].mapPoint=e[n]}_whenProjected(e,t,r){return _(this,null,function*(){if(!e)return void r(e);let{_operations:n,element:{georeference:s}}=this,c=e.map(({spatialReference:g})=>g),l=Array.isArray(t)?t:new Array(c.length).fill(t);yield T(Array.from(c).map((g,b)=>({source:g,dest:l[b]})));let f=e.map((g,b)=>D(g,l[b]));n===this._operations&&s===this.element.georeference&&r(f)})}_replaceOperations(e){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e,e&&this.addHandles(e.data.on("change",()=>this._operationsGeometryChanged()),e)}};o([i({constructOnly:!0})],d.prototype,"view",void 0),o([i({constructOnly:!0})],d.prototype,"layer",void 0),o([i({constructOnly:!0})],d.prototype,"element",void 0),o([i({constructOnly:!0})],d.prototype,"onModifiedExternally",void 0),o([i()],d.prototype,"_operations",void 0),o([i()],d.prototype,"operations",null),o([i()],d.prototype,"updating",null),d=o([h("esri.views.3d.interactive.editingTools.media.MediaElementControllerControlPoints")],d);var m=class extends y{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(e){super(e),this._updatingHandles=new E}initialize(){this.addHandles([u(this._updatingHandles),this._updatingHandles.add(()=>this.element.georeference?.coords,e=>this._elementCoordinatesChanged(e),C)])}_elementCoordinatesChanged(e){this._updatedElementCoordinates!==e&&this._updatingHandles.addPromise(this._whenProjected(e,this.view.spatialReference,t=>{if(!t)return void this._replaceOperations(null);let{_operations:r}=this;r?.trySetGeometry(t)?this.onModifiedExternally():this._replaceOperations(M.fromGeometry(t,this.view.state.viewingMode))}))}_operationsGeometryChanged(){let{element:{georeference:e},_operations:t}=this;if(!t||!e)return;let r=t.data.geometry;if(!e.coords)return void this._updateElementCoordinates(r);let n=e.coords.spatialReference;this._updatingHandles.addPromise(this._whenProjected(r,n,s=>this._updateElementCoordinates(s)))}_updateElementCoordinates(e){let{georeference:t}=this.element;t&&(t.coords=e,this._updatedElementCoordinates=t.coords)}_whenProjected(e,t,r){return _(this,null,function*(){if(!e)return void r(e);let{_operations:n,element:{georeference:s}}=this,c=yield A(e,t);n===this._operations&&s===this.element.georeference&&r(c)})}_replaceOperations(e){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e,e&&this.addHandles(e.data.on("change",()=>this._operationsGeometryChanged()),e),this.onModifiedExternally()}};o([i({constructOnly:!0})],m.prototype,"view",void 0),o([i({constructOnly:!0})],m.prototype,"layer",void 0),o([i({constructOnly:!0})],m.prototype,"element",void 0),o([i({constructOnly:!0})],m.prototype,"onModifiedExternally",void 0),o([i()],m.prototype,"_operations",void 0),o([i()],m.prototype,"operations",null),o([i()],m.prototype,"updating",null),m=o([h("esri.views.3d.interactive.editingTools.media.MediaElementControllerShape")],m);function U(e,t,r){return H(e.allLayerViews.find(n=>n.layer===t),r)}function H(e,t){if(!e||e.type!=="media-3d"||e.suspended)return!1;let r=e.layer.source;return!!r&&(r instanceof I||r instanceof N?r===t:"hasElement"in r&&r.hasElement(t))}var a=class extends y{grabbableForEvent(){return!0}constructor(e){super(e),this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.grabbing=!1,this.dragging=!1,this.hovering=!0,this.selected=!1,this.cursor=null,this.consumesClicks=!0,this.events=new v.EventEmitter,this.addHandles(w(()=>this.selected,t=>this.events.emit("select-changed",{action:t?"select":"deselect"}),V))}destroy(){this._set("view",null)}intersectionDistance(e){let{view:t,layer:r,element:n}=this;if(!U(t,r,n))return null;let s=t.toMap(e,{include:{layer:r,element:n}});return s&&L(s,k,t.renderSpatialReference)?z(k,t.state.camera.eye):null}onElevationChange(){}onViewChange(){}};o([i({constructOnly:!0,nonNullable:!0})],a.prototype,"element",void 0),o([i({constructOnly:!0,nonNullable:!0})],a.prototype,"layer",void 0),o([i({constructOnly:!0,nonNullable:!0})],a.prototype,"view",void 0),o([i()],a.prototype,"interactive",void 0),o([i()],a.prototype,"selectable",void 0),o([i()],a.prototype,"grabbable",void 0),o([i()],a.prototype,"grabbing",void 0),o([i()],a.prototype,"dragging",void 0),o([i()],a.prototype,"hovering",void 0),o([i()],a.prototype,"selected",void 0),o([i()],a.prototype,"cursor",void 0),a=o([h("esri.views.3d.interactive.editingTools.media.MediaElementManipulator3D")],a);var k=S();var F=Symbol(),p=class extends v.EventedAccessor{get operations(){return this._controller?.operations}get elevationInfo(){return{mode:"on-the-ground",offset:0}}get _layerView(){let e=this.view.allLayerViews.find(t=>t.layer===this.layer);return e?.type==="media-3d"?e:null}get visible(){return H(this._layerView,this.element)}get isDraped(){return!0}get origin(){return null}get updating(){return!!this._controller?.updating}get _controllerClass(){return this.tool==="transform"||this.element.georeference?.type!=="control-points"?m:d}constructor(e){super(e),this.tool="transform"}initialize(){this.addHandles([w(()=>this._controllerClass,e=>this._updateController(e),j),x(()=>this._layerView,"element-render-changed",({element:e})=>{this.element===e&&this.emit("committed")})])}toMap(e){let{layer:t,element:r}=this;return this.view.toMap(e,{include:{layer:t,element:r}})}createManipulator(e){let{view:t,layer:r,element:n}=this;return new a(O({view:t,layer:r,element:n},e))}_updateController(e){if(this._controller&&this._controller instanceof e)return;this.removeHandles(F);let{view:t,layer:r,element:n}=this,s=()=>{this.emit("modified-externally")};this._controller=new e({view:t,layer:r,element:n,onModifiedExternally:s}),s(),this.addHandles(u(this._controller),F)}};o([i({constructOnly:!0})],p.prototype,"view",void 0),o([i({constructOnly:!0})],p.prototype,"layer",void 0),o([i({constructOnly:!0})],p.prototype,"element",void 0),o([i()],p.prototype,"tool",void 0),o([i()],p.prototype,"_controller",void 0),o([i()],p.prototype,"elevationInfo",null),o([i()],p.prototype,"_layerView",null),o([i()],p.prototype,"visible",null),o([i()],p.prototype,"updating",null),o([i()],p.prototype,"_controllerClass",null),p=o([h("esri.views.3d.interactive.editingTools.ManipulatedObject3DMediaElement")],p);export{p as ManipulatedObject3DMediaElement};
