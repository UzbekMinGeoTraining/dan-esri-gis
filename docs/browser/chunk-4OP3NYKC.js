import{a as I}from"./chunk-NPHNUKYC.js";import{b as F}from"./chunk-E3DN7XQP.js";import{c as b,n as c}from"./chunk-GT4Y5PVV.js";import{a as T}from"./chunk-HVNUIUKO.js";import{Q as n}from"./chunk-GGZQ5GCM.js";import{U as R}from"./chunk-TFUPB3ZG.js";import{a as r}from"./chunk-BMVJCP2M.js";import{t as w}from"./chunk-3IBUFXWY.js";import{g as v}from"./chunk-JEGVIFEP.js";var J=j=>{let e=class extends j{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return I(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?b(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(s){try{return!this.layer.loaded||!!c(this.layer.serviceRasterInfo,s)}catch{return!1}}fetchPopupFeaturesAtLocation(s,f){return v(this,null,function*(){let{layer:t}=this;if(!s)throw new w("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:t});let{popupEnabled:P}=t,V=F(t,f);if(!P||V==null)return[];let y=[],{value:l,magdirValue:d,processedValue:_}=yield t.identify(s,{timeExtent:this.timeExtent,signal:f?.signal}),u="";if(l?.length){u=t.type==="imagery-tile"&&t.hasStandardTime()&&l[0]!=null?l.map(p=>t.getStandardTimeValue(p)).join(", "):l.join(", ");let a={ObjectId:0},m="Raster.ServicePixelValue";a[m]=t.type==="imagery-tile"&&t.raster.datasetFormat==="Function"?_?.join(", "):u,a[m+".Raw"]=u;let h=t.raster?.rasterInfo??t.serviceRasterInfo,g=h?.attributeTable;if(g!=null){let{fields:p,features:L}=g,E=p.find(({name:i})=>i.toLowerCase()==="value"),S=a[m],o=E?L.find(i=>String(i.attributes[E.name])===S):null;if(o)for(let i in o.attributes)o.attributes.hasOwnProperty(i)&&(a[this._rasterFieldPrefix+i]=o.attributes[i])}let x=h?.dataType;x!=="vector-magdir"&&x!=="vector-uv"||(a["Raster.Magnitude"]=d?.[0],a["Raster.Direction"]=d?.[1]);let D=new T({geometry:this.fullExtent?.clone(),attributes:a,layer:t,sourceLayer:t});y.push(D)}return y})}_getFullExtent(){return c(this.layer.serviceRasterInfo,this.view.spatialReference)}};return r([n()],e.prototype,"fullExtent",null),r([n()],e.prototype,"layer",void 0),r([n({readOnly:!0})],e.prototype,"timeExtent",null),r([n()],e.prototype,"tileInfo",void 0),r([n({readOnly:!0})],e.prototype,"hasTilingEffects",null),r([n()],e.prototype,"datumTransformation",null),e=r([R("esri.views.layers.ImageryTileLayerView")],e),e};export{J as a};
