import{c as Vt,d as Wt,e as kt,g as Gt}from"./chunk-WCQK6XOZ.js";import{b as Ft}from"./chunk-RCCESRES.js";import{a as Be}from"./chunk-MM6IP4FS.js";import{a as Ot,b as At}from"./chunk-WIJFCRLT.js";import{a as xt,b as Bt}from"./chunk-NP35J4DQ.js";import{a as N}from"./chunk-S2HMCZNZ.js";import{b as Rt,c as yt,e as It,g as Pt,h as Lt}from"./chunk-ONDKJR4V.js";import{a as Ct,b as we,c as Me,d as Nt,g as jt,h as xe,i as Dt,j as Ut}from"./chunk-QB4KDO4M.js";import{a as Et,b as vt}from"./chunk-N6PITG7Q.js";import{d as Mt}from"./chunk-UW734WOQ.js";import{g as De,l as be,m as oe}from"./chunk-ATV5GTE5.js";import{h as wt}from"./chunk-PQPFAB53.js";import{i as St,j as Z}from"./chunk-MJXFSFCY.js";import{a as ge,b as ne}from"./chunk-TCQTMUK4.js";import{a as Ue}from"./chunk-G5SIQY64.js";import{a as ft}from"./chunk-VMYCUJRH.js";import{o as ae}from"./chunk-PTVRFY4B.js";import{a as Ne,e as _e,f as dt,k as pt}from"./chunk-3ZOLHUAU.js";import{a as Te}from"./chunk-RDGFIF46.js";import{a as B,e as _t,f as Tt,g as gt,l as je,m as bt}from"./chunk-NPIYHDQ7.js";import{b as ut}from"./chunk-7ISKCG7U.js";import{a as Ce}from"./chunk-YJ3RZNO6.js";import{f as mt}from"./chunk-4OZVVJHM.js";import{A as re,Q as D,j as ct,u as se}from"./chunk-X7XJWAFC.js";import{a as fe,d as ht}from"./chunk-XXOIKNT6.js";import{b as nt}from"./chunk-J6ZRC6RI.js";import{a as at,g as ot}from"./chunk-EBGO44EK.js";import{a as o,b as lt}from"./chunk-7W6RATG7.js";import{b as Le,x as ie}from"./chunk-BDF7KEUQ.js";import{a as tt}from"./chunk-XTES2GPX.js";import{D as rt,a as it,b as x,c as L,d as K,e as pe,n as ue,p as te,v as Pe,x as st,y as C}from"./chunk-2HUIJUS4.js";import{h as z}from"./chunk-YFBPRKIN.js";import{G as $e,a as ye,g as Ie}from"./chunk-5MNDZ6BX.js";import{g as et}from"./chunk-YRTBL7EE.js";import{a as _,c as Re}from"./chunk-PYQRTZNZ.js";import{a as Ke}from"./chunk-VWF5VUO3.js";import{b as de}from"./chunk-5PTS4JDF.js";import{h as qe}from"./chunk-GGZQ5GCM.js";import{b as Qe}from"./chunk-WGF2T2BG.js";import{a as Se}from"./chunk-VEDIBGHD.js";import{r as Ye}from"./chunk-3IBUFXWY.js";var Ht=class extends ge{get geometries(){return this._geometries}get transformation(){return this._transformation??ht}set transformation(e){this._transformation=ye(this._transformation??fe(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?ye(this._shaderTransformation??fe(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=ne.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new Oe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){at(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){let t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t,i=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:i}),lt(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(let t of this._geometries)t.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){let e=new Bt;for(let t of this._geometries)t.occludees=Ot(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(let t of this._geometries)t.occludees=At(t.occludees,e);this._emit("occlusionChanged",this)}highlight(e){let t=new xt(e);for(let i of this._geometries)i.addHighlight(t);return this._emit("highlightChanged",this),t}removeHighlight(e){for(let t of this._geometries)t.removeHighlight(e);this._emit("highlightChanged",this)}removeStateID(e){e.channel===mt.Highlight?this.removeHighlight(e):this.removeOcclude(e)}getCombinedStaticTransformation(e,t){return Ie(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e,t=fe()){return Ie(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new Ae,this._validateBoundingVolume(this._bvWorldSpace,le.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new Ae,this._validateBoundingVolume(this._bvObjectSpace,le.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){let i=t===le.ObjectSpace;for(let n of this._geometries){let s=n.boundingInfo;s&&ti(s,e,i?n.transformation:this.getCombinedShaderTransformation(n))}st(e.bounds,e.min,e.max,.5);for(let n of this._geometries){let s=n.boundingInfo;if(s==null)continue;let d=i?n.transformation:this.getCombinedShaderTransformation(n),c=ct(d);C(Jt,s.center,d);let r=te(Jt,e.bounds),l=s.radius*c;e.bounds[3]=Math.max(e.bounds[3],r+l)}}_invalidateBoundingVolume(){let e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){}},Oe=class{constructor(){this.min=Re(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Re(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Ae=class extends Oe{constructor(){super(...arguments),this.bounds=ut()}};function ti(a,e,t){let i=a.bbMin,n=a.bbMax;if($e(t)){let s=L(ii,t[12],t[13],t[14]);K(P,i,s),K(U,n,s);for(let d=0;d<3;++d)e.min[d]=Math.min(e.min[d],P[d]),e.max[d]=Math.max(e.max[d],U[d])}else if(C(P,i,t),rt(i,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],P[s]),e.max[s]=Math.max(e.max[s],P[s]);else{C(U,n,t);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],P[s],U[s]),e.max[s]=Math.max(e.max[s],P[s],U[s]);for(let s=0;s<3;++s){x(P,i),x(U,n),P[s]=n[s],U[s]=i[s],C(P,P,t),C(U,U,t);for(let d=0;d<3;++d)e.min[d]=Math.min(e.min[d],P[d],U[d]),e.max[d]=Math.max(e.max[d],P[d],U[d])}}}var ii=_(),P=_(),U=_(),Jt=_(),le;(function(a){a[a.WorldSpace=0]="WorldSpace",a[a.ObjectSpace=1]="ObjectSpace"})(le||(le={}));var zt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var Zt=class extends ge{constructor(e,t,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=ne.Layer,this.events=new Ke,this.visible=!0,this.sliceable=!1,this._objectsAdded=new Se,this._handles=new qe,this._objects=new Se,this._pickable=!0,this.visible=t?.visible??!0,this._pickable=t?.pickable??!0,this.updatePolicy=t?.updatePolicy??Be.ASYNC,this._disableOctree=t?.disableOctree??!1,e.add(this);for(let n of zt)this._handles.add(this.events.on(n,s=>e.handleEvent(n,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}get objects(){return this._objects}set pickable(e){this._pickable=e}get pickable(){return this._pickable&&this.visible}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(let t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){let t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),t.length!==0){for(let i of t)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),this._octree!=null){for(let i=0;i<t.length;)this._objectsAdded.removeUnordered(t[i])?(t[i]=t[t.length-1],t.length-=1):++i;this._octree.remove(t)}}}sync(){this.updatePolicy!==Be.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new ft(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Qe(this._octree),this._objectsAdded.clear()}};function wi(a){return a!=null&&a.type===ne.Layer}var Ee=class extends vt{constructor(e,t,i){super(e,t,new Et(Gt,()=>import("./chunk-CL2HORAQ.js")),i,Fe),this.primitiveType=t.wireframe?Le.LINES:Le.TRIANGLE_STRIP}_makePipelineState(e,t){let{oitPass:i,output:n,hasOccludees:s,hasPolygonOffset:d}=e,c=i===Ue.NONE,r=i===Ue.FrontFace;return oe({blending:e.output===B.Color?Rt(i):null,depthTest:{func:Pt(i)},depthWrite:yt(e),drawBuffers:n===B.Depth?{buffers:[ie.NONE]}:Lt(i,n),colorWrite:be,stencilWrite:s?Me:null,stencilTest:s?t?xe:jt:null,polygonOffset:c||r?d?Xt:null:It})}initializePipeline(e){if(e.occluder){let t=e.hasPolygonOffset?Xt:null;this._occluderPipelineTransparent=oe({blending:De,polygonOffset:t,depthTest:we,depthWrite:null,colorWrite:be,stencilWrite:null,stencilTest:Ut,drawBuffers:e.output===B.Depth?{buffers:[ie.NONE]}:null}),this._occluderPipelineOpaque=oe({blending:De,polygonOffset:t,depthTest:we,depthWrite:null,colorWrite:be,stencilWrite:Nt,stencilTest:Dt,drawBuffers:e.output===B.Depth?{buffers:[ie.NONE]}:null}),this._occluderPipelineMaskWrite=oe({blending:null,polygonOffset:t,depthTest:Ct,depthWrite:null,colorWrite:null,stencilWrite:Me,stencilTest:xe,drawBuffers:e.output===B.Depth?{buffers:[ie.NONE]}:null})}return this._occludeePipeline=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,t){if(e)return this._occludeePipeline;switch(t){case N.TRANSPARENT_OCCLUDER_MATERIAL:return this._occluderPipelineTransparent??super.getPipeline();case N.OCCLUDER_MATERIAL:return this._occluderPipelineOpaque??super.getPipeline();default:return this._occluderPipelineMaskWrite??super.getPipeline()}}},Xt={factor:0,units:-4},Fe=new Map([[o.POSITION,0],[o.PREVPOSITION,1],[o.NEXTPOSITION,2],[o.SUBDIVISIONFACTOR,3],[o.UV0,4],[o.COLOR,5],[o.COLORFEATUREATTRIBUTE,5],[o.SIZE,6],[o.SIZEFEATUREATTRIBUTE,6],[o.OPACITYFEATUREATTRIBUTE,7],[o.OBJECTANDLAYERIDCOLOR,8]]);var y;(function(a){a[a.LEFT_JOIN_START=-2]="LEFT_JOIN_START",a[a.LEFT_JOIN_END=-1]="LEFT_JOIN_END",a[a.LEFT_CAP_START=-4]="LEFT_CAP_START",a[a.LEFT_CAP_END=-5]="LEFT_CAP_END",a[a.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",a[a.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",a[a.RIGHT_CAP_START=4]="RIGHT_CAP_START",a[a.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(y||(y={}));var Yt=class extends St{constructor(e){super(e,ze),this._configuration=new Wt,this.vertexAttributeLocations=Fe,this.produces=new Map([[N.OPAQUE_MATERIAL,t=>_t(t)||gt(t)&&this.parameters.renderOccluded===Z.OccludeAndTransparentStencil],[N.OPAQUE_MATERIAL_WITHOUT_NORMALS,t=>bt(t)],[N.OCCLUDER_MATERIAL,t=>je(t)&&this.parameters.renderOccluded===Z.OccludeAndTransparentStencil],[N.TRANSPARENT_OCCLUDER_MATERIAL,t=>je(t)&&this.parameters.renderOccluded===Z.OccludeAndTransparentStencil],[N.TRANSPARENT_MATERIAL,t=>t===B.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==Z.OccludeAndTransparentStencil],[N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,t=>t===B.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==Z.OccludeAndTransparentStencil],[N.DRAPED_MATERIAL,t=>Tt(t)]])}getConfiguration(e,t){this._configuration.output=e,this._configuration.oitPass=t.oitPass,this._configuration.draped=t.slot===N.DRAPED_MATERIAL;let i=this.parameters.stipplePattern!=null&&e!==B.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&si(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.hasOccludees=t.hasOccludees,this._configuration.occluder=this.parameters.renderOccluded===Z.OccludeAndTransparentStencil,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.wireframe=this.parameters.wireframe,this._configuration}get visible(){return this.parameters.color[3]>=Ce||this.parameters.stipplePattern!=null&&(this.parameters.stippleOffColor?.[3]??0)>Ce}intersectDraped({attributes:e,screenToWorldRatio:t},i,n,s,d,c){if(!n.options.selectionMode)return;let r=e.get(o.SIZE),l=this.parameters.width;if(this.parameters.vvSize){let S=e.get(o.SIZEFEATUREATTRIBUTE).data[0];l*=de(this.parameters.vvSize.offset[0]+S*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else r&&(l*=r.data[0]);let m=s[0],O=s[1],T=(l/2+4)*t,w=Number.MAX_VALUE,H=0,b=e.get(o.POSITION).data,k=Xe(this.parameters,e)?b.length-2:b.length-5;for(let S=0;S<k;S+=3){let u=b[S],j=b[S+1],p=(S+3)%b.length,I=m-u,R=O-j,h=b[p]-u,G=b[p+1]-j,g=de((h*I+G*R)/(h*h+G*G),0,1),Q=h*g-I,A=G*g-R,J=Q*Q+A*A;J<w&&(w=J,H=S/3)}w<T*T&&d(c.dist,c.normal,H,!1)}intersect(e,t,i,n,s,d){if(!i.options.selectionMode||!e.visible)return;if(!ot(t))return void Ye.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");let c=e.attributes,r=c.get(o.POSITION).data,l=this.parameters.width;if(this.parameters.vvSize){let u=c.get(o.SIZEFEATUREATTRIBUTE).data[0];l*=de(this.parameters.vvSize.offset[0]+u*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else c.has(o.SIZE)&&(l*=c.get(o.SIZE).data[0]);let m=i.camera,O=ri;tt(O,i.point);let T=l*m.pixelRatio/2+4*m.pixelRatio;L(he[0],O[0]-T,O[1]+T,0),L(he[1],O[0]+T,O[1]+T,0),L(he[2],O[0]+T,O[1]-T,0),L(he[3],O[0]-T,O[1]-T,0);for(let u=0;u<4;u++)if(!m.unprojectFromRenderScreen(he[u],W[u]))return;re(m.eye,W[0],W[1],We),re(m.eye,W[1],W[2],ke),re(m.eye,W[2],W[3],Ge),re(m.eye,W[3],W[0],He);let w=Number.MAX_VALUE,H=0,b=Xe(this.parameters,c)?r.length-2:r.length-5;for(let u=0;u<b;u+=3){E[0]=r[u]+t[12],E[1]=r[u+1]+t[13],E[2]=r[u+2]+t[14];let j=(u+3)%r.length;if(v[0]=r[j]+t[12],v[1]=r[j+1]+t[13],v[2]=r[j+2]+t[14],D(We,E)<0&&D(We,v)<0||D(ke,E)<0&&D(ke,v)<0||D(Ge,E)<0&&D(Ge,v)<0||D(He,E)<0&&D(He,v)<0)continue;if(m.projectToRenderScreen(E,Y),m.projectToRenderScreen(v,q),Y[2]<0&&q[2]>0){pe(F,E,v);let I=m.frustum,R=-D(I[ae.NEAR],E)/Pe(F,I[ae.NEAR]);ue(F,F,R),K(E,E,F),m.projectToRenderScreen(E,Y)}else if(Y[2]>0&&q[2]<0){pe(F,v,E);let I=m.frustum,R=-D(I[ae.NEAR],v)/Pe(F,I[ae.NEAR]);ue(F,F,R),K(v,v,F),m.projectToRenderScreen(v,q)}else if(Y[2]<0&&q[2]<0)continue;Y[2]=0,q[2]=0;let p=dt(_e(Y,q,Kt),O);p<w&&(w=p,x(qt,E),x(Qt,v),H=u/3)}let k=i.rayBegin,S=i.rayEnd;if(w<T*T){let u=Number.MAX_VALUE;if(pt(_e(qt,Qt,Kt),_e(k,S,ai),X)){pe(X,X,k);let j=it(X);ue(X,X,1/j),u=j/te(k,S)}d(u,X,H,!1)}}get _layout(){let e=nt().vec3f(o.POSITION).vec3f(o.PREVPOSITION).vec3f(o.NEXTPOSITION).f32(o.SUBDIVISIONFACTOR).vec2f(o.UV0);return this.parameters.vvSize?e.f32(o.SIZEFEATUREATTRIBUTE):e.f32(o.SIZE),this.parameters.vvColor?e.f32(o.COLORFEATUREATTRIBUTE):e.vec4f(o.COLOR),this.parameters.vvOpacity&&e.f32(o.OPACITYFEATUREATTRIBUTE),Te()&&e.vec4u8(o.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new Ze(this._layout,this.parameters)}createGLMaterial(e){return new Je(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},Je=class extends Mt{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}beginSlot(e){let t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.acquireTechnique(Ee,e)}},ze=class extends wt{constructor(){super(...arguments),this.width=0,this.color=et,this.join="miter",this.cap=Vt.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.wireframe=!1}get transparent(){return this.color[3]<1||this.stipplePattern!=null&&(this.stippleOffColor?.[3]??0)<1}},Ze=class{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;let i=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=kt+i}}_isClosed(e){return Xe(this._parameters,e)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){let i=e.get(o.POSITION).indices.length/2+1,n=this._isClosed(e),s=n?2:2*2;return s+=((n?i:i-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,t,i,n,s,d){let c=oi,r=ni,l=li,m=i.get(o.POSITION),O=m.indices,T=m.data.length/3,w=i.get(o.DISTANCETOSTART)?.data;O&&O.length!==2*(T-1)&&console.warn("RibbonLineMaterial does not support indices");let H=i.get(o.SIZEFEATUREATTRIBUTE)?.data[0]??i.get(o.SIZE)?.data[0]??1,b=[1,1,1,1],k=0,S=this.vertexBufferLayout.fields.has(o.COLORFEATUREATTRIBUTE);S?k=i.get(o.COLORFEATUREATTRIBUTE).data[0]:i.has(o.COLOR)&&(b=i.get(o.COLOR).data);let u=this.vertexBufferLayout.fields.has(o.OPACITYFEATUREATTRIBUTE),j=u?i.get(o.OPACITYFEATUREATTRIBUTE).data[0]:0,p=new Float32Array(s.buffer),I=Te()?new Uint8Array(s.buffer):null,R=this.vertexBufferLayout.stride/4,h=d*R,G=h,g=0,Q=w?(f,M,V)=>g=w[V]:(f,M,V)=>g+=te(f,M),A=(f,M,V,ee,ce,$t,ei)=>{if(p[h++]=M[0],p[h++]=M[1],p[h++]=M[2],p[h++]=f[0],p[h++]=f[1],p[h++]=f[2],p[h++]=V[0],p[h++]=V[1],p[h++]=V[2],p[h++]=ee,p[h++]=ei,p[h++]=ce,p[h++]=H,S)p[h++]=k;else{let me=Math.min(4*$t,b.length-4);p[h++]=b[me],p[h++]=b[me+1],p[h++]=b[me+2],p[h++]=b[me+3]}u&&(p[h++]=j),Te()&&(n&&(I[4*h]=n[0],I[4*h+1]=n[1],I[4*h+2]=n[2],I[4*h+3]=n[3]),h++)};h+=R,L(r,m.data[0],m.data[1],m.data[2]),e&&C(r,r,e);let J=this._isClosed(i);if(J){let f=m.data.length-3;L(c,m.data[f],m.data[f+1],m.data[f+2]),e&&C(c,c,e)}else L(l,m.data[3],m.data[4],m.data[5]),e&&C(l,l,e),A(r,r,l,1,y.LEFT_CAP_START,0,0),A(r,r,l,1,y.RIGHT_CAP_START,0,0),x(c,r),x(r,l);let ve=J?0:1,$=J?T:T-1;for(let f=ve;f<$;f++){let M=(f+1)%T*3;L(l,m.data[M],m.data[M+1],m.data[M+2]),e&&C(l,l,e),Q(c,r,f),A(c,r,l,0,y.LEFT_JOIN_END,f,g),A(c,r,l,0,y.RIGHT_JOIN_END,f,g);let V=this.numJoinSubdivisions;for(let ee=0;ee<V;++ee){let ce=(ee+1)/(V+1);A(c,r,l,ce,y.LEFT_JOIN_END,f,g),A(c,r,l,ce,y.RIGHT_JOIN_END,f,g)}A(c,r,l,1,y.LEFT_JOIN_START,f,g),A(c,r,l,1,y.RIGHT_JOIN_START,f,g),x(c,r),x(r,l)}J?(L(l,m.data[3],m.data[4],m.data[5]),e&&C(l,l,e),g=Q(c,r,$),A(c,r,l,0,y.LEFT_JOIN_END,ve,g),A(c,r,l,0,y.RIGHT_JOIN_END,ve,g)):(g=Q(c,r,$),A(c,r,r,0,y.LEFT_CAP_END,$,g),A(c,r,r,0,y.RIGHT_CAP_END,$,g)),Ve(p,G+R,p,G,R),h=Ve(p,h-R,p,h,R),this._parameters.wireframe&&this._addWireframeVertices(s,G,h,R)}_addWireframeVertices(e,t,i,n){let s=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),d=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,i-t),c=0,r=l=>c=Ve(d,l,s,c,n);for(let l=0;l<d.length-1;l+=2*n)r(l),r(l+2*n),r(l+1*n),r(l+2*n),r(l+1*n),r(l+3*n)}};function Ve(a,e,t,i,n){for(let s=0;s<n;s++)t[i++]=a[e++];return i}function Xe(a,e){return a.isClosed?e.get(o.POSITION).indices.length>2:!1}function si(a){return a.anchor===Ft.Tip&&a.hideOnShortSegments&&a.placement==="begin-end"&&a.worldSpace}var E=_(),v=_(),F=_(),X=_(),ri=_(),Y=z(),q=z(),qt=_(),Qt=_(),Kt=Ne(),ai=Ne(),oi=_(),ni=_(),li=_(),he=[z(),z(),z(),z()],W=[_(),_(),_(),_()],We=se(),ke=se(),Ge=se(),He=se();export{Ht as a,Zt as b,wi as c,Yt as d};
