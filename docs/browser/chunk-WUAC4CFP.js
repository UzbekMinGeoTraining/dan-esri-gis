import{b as Ce}from"./chunk-TCQTMUK4.js";import{C as ve,D as xe,d as Ie}from"./chunk-EPTSNNZF.js";import{a as L}from"./chunk-EBGO44EK.js";import{a as C}from"./chunk-7W6RATG7.js";import{D as qe,a as ze,b as Le,c as me,d as Be,p as Me}from"./chunk-B4JAL745.js";import{G as ee,b as fe,c as _,u as ye,w as ge}from"./chunk-2HUIJUS4.js";import{F as he,G as be}from"./chunk-5MNDZ6BX.js";import{a as H}from"./chunk-PYQRTZNZ.js";function dt(r,n,o,t=1){let{data:f,indices:e}=r,i=n.typedBuffer,s=n.typedBufferStride,c=e.length;if(o*=s,t===1)for(let l=0;l<c;++l)i[o]=f[e[l]],o+=s;else for(let l=0;l<c;++l){let a=f[e[l]];for(let u=0;u<t;u++)i[o]=a,o+=s}}function De(r,n,o){let{data:t,indices:f}=r,e=n.typedBuffer,i=n.typedBufferStride,s=f.length;o*=i;for(let c=0;c<s;++c){let l=2*f[c];e[o]=t[l],e[o+1]=t[l+1],o+=i}}function ke(r,n,o,t){let{data:f,indices:e}=r,i=n.typedBuffer,s=n.typedBufferStride,c=e.length;if(o*=s,t==null||t===1)for(let l=0;l<c;++l){let a=3*e[l];i[o]=f[a],i[o+1]=f[a+1],i[o+2]=f[a+2],o+=s}else for(let l=0;l<c;++l){let a=3*e[l];for(let u=0;u<t;++u)i[o]=f[a],i[o+1]=f[a+1],i[o+2]=f[a+2],o+=s}}function Ue(r,n,o,t=1){let{data:f,indices:e}=r,i=n.typedBuffer,s=n.typedBufferStride,c=e.length;if(o*=s,t===1)for(let l=0;l<c;++l){let a=4*e[l];i[o]=f[a],i[o+1]=f[a+1],i[o+2]=f[a+2],i[o+3]=f[a+3],o+=s}else for(let l=0;l<c;++l){let a=4*e[l];for(let u=0;u<t;++u)i[o]=f[a],i[o+1]=f[a+1],i[o+2]=f[a+2],i[o+3]=f[a+3],o+=s}}function pt(r,n,o){let t=r.typedBuffer,f=r.typedBufferStride;n*=f;for(let e=0;e<o;++e)t[n]=0,t[n+1]=0,t[n+2]=0,t[n+3]=0,n+=f}function Ge(r,n,o,t,f=1){if(!n)return void ke(r,o,t,f);let{data:e,indices:i}=r,s=o.typedBuffer,c=o.typedBufferStride,l=i.length,a=n[0],u=n[1],w=n[2],q=n[4],E=n[5],v=n[6],B=n[8],x=n[9],N=n[10],A=n[12],S=n[13],V=n[14];t*=c;let O=0,h=0,p=0,m=be(n)?y=>{O=e[y]+A,h=e[y+1]+S,p=e[y+2]+V}:y=>{let d=e[y],g=e[y+1],b=e[y+2];O=a*d+q*g+B*b+A,h=u*d+E*g+x*b+S,p=w*d+v*g+N*b+V};if(f===1)for(let y=0;y<l;++y)m(3*i[y]),s[t]=O,s[t+1]=h,s[t+2]=p,t+=c;else for(let y=0;y<l;++y){m(3*i[y]);for(let d=0;d<f;++d)s[t]=O,s[t+1]=h,s[t+2]=p,t+=c}}function We(r,n,o,t,f=1){if(!n)return void ke(r,o,t,f);let{data:e,indices:i}=r,s=n,c=o.typedBuffer,l=o.typedBufferStride,a=i.length,u=s[0],w=s[1],q=s[2],E=s[4],v=s[5],B=s[6],x=s[8],N=s[9],A=s[10],S=!he(s),V=1e-6,O=1-V;t*=l;let h=0,p=0,m=0,y=be(s)?d=>{h=e[d],p=e[d+1],m=e[d+2]}:d=>{let g=e[d],b=e[d+1],M=e[d+2];h=u*g+E*b+x*M,p=w*g+v*b+N*M,m=q*g+B*b+A*M};if(f===1)if(S)for(let d=0;d<a;++d){y(3*i[d]);let g=h*h+p*p+m*m;if(g<O&&g>V){let b=1/Math.sqrt(g);c[t]=h*b,c[t+1]=p*b,c[t+2]=m*b}else c[t]=h,c[t+1]=p,c[t+2]=m;t+=l}else for(let d=0;d<a;++d)y(3*i[d]),c[t]=h,c[t+1]=p,c[t+2]=m,t+=l;else for(let d=0;d<a;++d){if(y(3*i[d]),S){let g=h*h+p*p+m*m;if(g<O&&g>V){let b=1/Math.sqrt(g);h*=b,p*=b,m*=b}}for(let g=0;g<f;++g)c[t]=h,c[t+1]=p,c[t+2]=m,t+=l}}function He(r,n,o,t,f=1){if(!n)return void Ue(r,o,t,f);let{data:e,indices:i}=r,s=n,c=o.typedBuffer,l=o.typedBufferStride,a=i.length,u=s[0],w=s[1],q=s[2],E=s[4],v=s[5],B=s[6],x=s[8],N=s[9],A=s[10],S=!he(s),V=1e-6,O=1-V;if(t*=l,f===1)for(let h=0;h<a;++h){let p=4*i[h],m=e[p],y=e[p+1],d=e[p+2],g=e[p+3],b=u*m+E*y+x*d,M=w*m+v*y+N*d,R=q*m+B*y+A*d;if(S){let T=b*b+M*M+R*R;if(T<O&&T>V){let F=1/Math.sqrt(T);b*=F,M*=F,R*=F}}c[t]=b,c[t+1]=M,c[t+2]=R,c[t+3]=g,t+=l}else for(let h=0;h<a;++h){let p=4*i[h],m=e[p],y=e[p+1],d=e[p+2],g=e[p+3],b=u*m+E*y+x*d,M=w*m+v*y+N*d,R=q*m+B*y+A*d;if(S){let T=b*b+M*M+R*R;if(T<O&&T>V){let F=1/Math.sqrt(T);b*=F,M*=F,R*=F}}for(let T=0;T<f;++T)c[t]=b,c[t+1]=M,c[t+2]=R,c[t+3]=g,t+=l}}function Je(r,n,o,t,f=1){let{data:e,indices:i}=r,s=o.typedBuffer,c=o.typedBufferStride,l=i.length;if(t*=c,n!==e.length||n!==4)if(f!==1)if(n!==4)for(let a=0;a<l;++a){let u=3*i[a];for(let w=0;w<f;++w)s[t]=e[u],s[t+1]=e[u+1],s[t+2]=e[u+2],s[t+3]=255,t+=c}else for(let a=0;a<l;++a){let u=4*i[a];for(let w=0;w<f;++w)s[t]=e[u],s[t+1]=e[u+1],s[t+2]=e[u+2],s[t+3]=e[u+3],t+=c}else{if(n===4){for(let a=0;a<l;++a){let u=4*i[a];s[t]=e[u],s[t+1]=e[u+1],s[t+2]=e[u+2],s[t+3]=e[u+3],t+=c}return}for(let a=0;a<l;++a){let u=3*i[a];s[t]=e[u],s[t+1]=e[u+1],s[t+2]=e[u+2],s[t+3]=255,t+=c}}else{s[t]=e[0],s[t+1]=e[1],s[t+2]=e[2],s[t+3]=e[3];let a=new Uint32Array(o.typedBuffer.buffer,o.start),u=c/4,w=a[t/=4];t+=u;let q=l*f;for(let E=1;E<q;++E)a[t]=w,t+=u}}function Ke(r,n,o){let{data:t,indices:f}=r,e=n.typedBuffer,i=n.typedBufferStride,s=f.length,c=t[0];o*=i;for(let l=0;l<s;++l)e[o]=c,o+=i}function Xe(r,n,o,t,f=1){let e=n.typedBuffer,i=n.typedBufferStride;if(t*=i,f===1)for(let s=0;s<o;++s)e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],t+=i;else for(let s=0;s<o;++s)for(let c=0;c<f;++c)e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],t+=i}function ht(r,n,o,t,f,e,i){for(let s of o.fields.keys()){let c=r.get(s),l=c?.indices;if(c&&l)Ye(s,c,t,f,e,i);else if(s===C.OBJECTANDLAYERIDCOLOR&&n!=null){let a=r.get(C.POSITION)?.indices;if(a){let u=a.length;Xe(n,e.getField(s,Me),u,i)}}}}function Ye(r,n,o,t,f,e){switch(r){case C.POSITION:{L(n.size===3);let i=f.getField(r,me);L(!!i,`No buffer view for ${r}`),i&&Ge(n,o,i,e);break}case C.NORMAL:{L(n.size===3);let i=f.getField(r,me);L(!!i,`No buffer view for ${r}`),i&&We(n,t,i,e);break}case C.NORMALCOMPRESSED:{L(n.size===2);let i=f.getField(r,qe);L(!!i,`No buffer view for ${r}`),i&&De(n,i,e);break}case C.UV0:{L(n.size===2);let i=f.getField(r,Le);L(!!i,`No buffer view for ${r}`),i&&De(n,i,e);break}case C.COLOR:case C.SYMBOLCOLOR:{let i=f.getField(r,Me);L(!!i,`No buffer view for ${r}`),L(n.size===3||n.size===4),!i||n.size!==3&&n.size!==4||Je(n,n.size,i,e);break}case C.COLORFEATUREATTRIBUTE:{let i=f.getField(r,ze);L(!!i,`No buffer view for ${r}`),L(n.size===1),i&&n.size===1&&Ke(n,i,e);break}case C.TANGENT:{L(n.size===4);let i=f.getField(r,Be);L(!!i,`No buffer view for ${r}`),i&&He(n,o,i,e);break}case C.PROFILERIGHT:case C.PROFILEUP:case C.PROFILEVERTEXANDNORMAL:case C.FEATUREVALUE:{L(n.size===4);let i=f.getField(r,Be);L(!!i,`No buffer view for ${r}`),i&&Ue(n,i,e)}}}var we=class{constructor(n=!1,o=!0){this.isVerticalRay=n,this.normalRequired=o}},ce=Ie();function Ot(r,n,o,t,f,e){if(!r.visible)return;let i=ee(je,t,o),s=(l,a,u)=>{e(l,u,a,!1)},c=new we(!1,n.options.normalRequired);if(r.boundingInfo){L(r.type===Ce.Mesh);let l=n.tolerance;Pe(r.boundingInfo,o,i,l,f,c,s)}else{let l=r.attributes.get(C.POSITION),a=l.indices;$e(o,i,0,a.length/3,a,l.data,l.stride,f,c,s)}}var Qe=H();function Pe(r,n,o,t,f,e,i){if(r==null)return;let s=it(o,Qe);if(ve(ce,r.bbMin),xe(ce,r.bbMax),f?.applyToAabb(ce),rt(ce,n,s,t)){let{primitiveIndices:c,position:l}=r,a=c?c.length:l.indices.length/3;if(a>ot){let u=r.getChildren();if(u!==void 0){for(let w of u)Pe(w,n,o,t,f,e,i);return}}Ze(n,o,0,a,l.indices,l.data,l.stride,c,f,e,i)}}var re=H();function Rt(r,n,o,t,f,e,i,s,c){let{data:l,stride:a}=e;$e(r,ee(je,n,r),o,t,f,l,a,i,s,c)}function Tt(r,n,o,t,f,e,i,s,c,l=null,a=0){let u=r[0],w=r[1],q=r[2],E=n[0],v=n[1],B=n[2];for(let x=o;x<t;++x){let N=a+(l?l[x]:x),A=3*N,S=i*f[A],V=e[S],O=e[S+1],h=e[S+2],p=i*f[A+1],m=e[p],y=e[p+1],d=e[p+2],g=i*f[A+2],b=m-V,M=y-O,R=d-h,T=e[g]-V,F=e[g+1]-O,D=e[g+2]-h,$=v*D-F*B,j=B*T-D*E,G=E*F-T*v,I=b*$+M*j+R*G;if(Math.abs(I)<=Re)continue;let U=u-V,P=w-O,W=q-h,z=U*$+P*j+W*G;if(I>0){if(z<0||z>I)continue}else if(z>0||z<I)continue;let J=P*R-M*W,K=W*b-R*U,X=U*M-b*P,k=E*J+v*K+B*X;if(I>0){if(k<0||z+k>I)continue}else if(k>0||z+k<I)continue;let Y=(T*J+F*K+D*X)/I;Y>=0&&c(Y,N,s?Oe(b,M,R,T,F,D,re):null)}}function Vt(r,n,o,t,f,e,i,s,c,l,a,u=null,w=0){let q=r[0],E=r[1],v=r[2],B=n[0],x=n[1],N=n[2];for(let A=o;A<t;++A){let S=w+(u?u[A]:A),V=3*S,O=i*f[V],h=e[O],p=e[O+1],m=e[O+2],y=i*f[V+1],d=e[y],g=e[y+1],b=e[y+2],M=i*f[V+2],R=e[M],T=e[M+1],F=e[M+2],D=m-c,$=s/Math.sqrt(h*h+p*p+D*D),j=h+h*$,G=p+p*$,I=m+D*$,U=b-c,P=s/Math.sqrt(d*d+g*g+U*U),W=d+d*P,z=g+g*P,J=b+U*P,K=F-c,X=s/Math.sqrt(R*R+T*T+K*K),k=W-j,Y=z-G,te=J-I,ne=R+R*X-j,Q=T+T*X-G,ie=F+K*X-I,Te=x*ie-Q*N,Ve=N*ne-ie*B,Ne=B*Q-ne*x,Z=k*Te+Y*Ve+te*Ne;if(Math.abs(Z)<=Re)continue;let ue=q-j,de=E-G,pe=v-I,se=ue*Te+de*Ve+pe*Ne;if(Z>0){if(se<0||se>Z)continue}else if(se>0||se<Z)continue;let Ae=de*te-Y*pe,Se=pe*k-te*ue,Fe=ue*Y-k*de,oe=B*Ae+x*Se+N*Fe;if(Z>0){if(oe<0||se+oe>Z)continue}else if(oe>0||se+oe<Z)continue;let Ee=(ne*Ae+Q*Se+ie*Fe)/Z;Ee>=0&&a(Ee,S,l?Oe(k,Y,te,ne,Q,ie,re):null)}}function Ze(r,n,o,t,f,e,i,s,c,l,a){let u=r[0],w=r[1],q=r[2],E=n[0],v=n[1],B=n[2],{normalRequired:x}=l;for(let N=o;N<t;++N){let A=s[N],S=3*A,V=i*f[S],O=e[V],h=e[V+1],p=e[V+2],m=i*f[S+1],y=e[m],d=e[m+1],g=e[m+2],b=i*f[S+2],M=e[b],R=e[b+1],T=e[b+2];c!=null&&([O,h,p]=c.applyToVertex(O,h,p,N),[y,d,g]=c.applyToVertex(y,d,g,N),[M,R,T]=c.applyToVertex(M,R,T,N));let F=y-O,D=d-h,$=g-p,j=M-O,G=R-h,I=T-p,U=v*I-G*B,P=B*j-I*E,W=E*G-j*v,z=F*U+D*P+$*W;if(Math.abs(z)<=Re)continue;let J=u-O,K=w-h,X=q-p,k=J*U+K*P+X*W;if(z>0){if(k<0||k>z)continue}else if(k>0||k<z)continue;let Y=K*$-D*X,te=X*F-$*J,ne=J*D-F*K,Q=E*Y+v*te+B*ne;if(z>0){if(Q<0||k+Q>z)continue}else if(Q>0||k+Q<z)continue;let ie=(j*Y+G*te+I*ne)/z;ie>=0&&a(ie,A,x?Oe(F,D,$,j,G,I,re):null)}}function $e(r,n,o,t,f,e,i,s,c,l){let a=n,u=ft,w=Math.abs(a[0]),q=Math.abs(a[1]),E=Math.abs(a[2]),v=w>=q?w>=E?0:2:q>=E?1:2,B=v,x=a[B]<0?2:1,N=(v+x)%3,A=(v+(3-x))%3,S=a[N]/a[B],V=a[A]/a[B],O=1/a[B],h=_e,p=et,m=tt,{normalRequired:y}=c;for(let d=o;d<t;++d){let g=3*d,b=i*f[g];_(u[0],e[b+0],e[b+1],e[b+2]);let M=i*f[g+1];_(u[1],e[M+0],e[M+1],e[M+2]);let R=i*f[g+2];_(u[2],e[R+0],e[R+1],e[R+2]),s&&(fe(u[0],s.applyToVertex(u[0][0],u[0][1],u[0][2],d)),fe(u[1],s.applyToVertex(u[1][0],u[1][1],u[1][2],d)),fe(u[2],s.applyToVertex(u[2][0],u[2][1],u[2][2],d))),ee(h,u[0],r),ee(p,u[1],r),ee(m,u[2],r);let T=h[N]-S*h[B],F=h[A]-V*h[B],D=p[N]-S*p[B],$=p[A]-V*p[B],j=m[N]-S*m[B],G=m[A]-V*m[B],I=j*$-G*D,U=T*G-F*j,P=D*F-$*T;if((I<0||U<0||P<0)&&(I>0||U>0||P>0))continue;let W=I+U+P;if(W===0)continue;let z=I*(O*h[B])+U*(O*p[B])+P*(O*m[B]);if(z*Math.sign(W)<0)continue;let J=z/W;J>=0&&l(J,d,y?nt(u):null)}}var _e=H(),et=H(),tt=H();function Oe(r,n,o,t,f,e,i){return _(ae,r,n,o),_(le,t,f,e),ge(i,ae,le),ye(i,i),i}function nt(r){return ee(ae,r[1],r[0]),ee(le,r[2],r[0]),ge(re,ae,le),ye(re,re),re}var ae=H(),le=H();function Nt(r,n,o){return _(o,1/(n[0]-r[0]),1/(n[1]-r[1]),1/(n[2]-r[2]))}function it(r,n){return _(n,1/r[0],1/r[1],1/r[2])}function rt(r,n,o,t){return st(r,n,o,t,1/0)}function st(r,n,o,t,f){let e=(r[0]-t-n[0])*o[0],i=(r[3]+t-n[0])*o[0],s=Math.min(e,i),c=Math.max(e,i),l=(r[1]-t-n[1])*o[1],a=(r[4]+t-n[1])*o[1];if(c=Math.min(c,Math.max(l,a)),c<0||(s=Math.max(s,Math.min(l,a)),s>c))return!1;let u=(r[2]-t-n[2])*o[2],w=(r[5]+t-n[2])*o[2];return c=Math.min(c,Math.max(u,w)),!(c<0)&&(s=Math.max(s,Math.min(u,w)),!(s>c)&&s<f)}var ot=1e3,Re=1e-7,je=H(),ft=[H(),H(),H()];export{we as a,Ot as b,Rt as c,Tt as d,Vt as e,Nt as f,rt as g,st as h,dt as i,Ue as j,pt as k,Ge as l,We as m,Je as n,Xe as o,ht as p,Ye as q};
