import{a as bt,b as M}from"./chunk-WQZ44UVD.js";import{b as Lt}from"./chunk-W4JZTUC6.js";import{a as k,b as Ce,c as ae,d as Ee}from"./chunk-FKFEJQO6.js";import{a as ft}from"./chunk-OJD5KW32.js";import"./chunk-3RWCMF3V.js";import"./chunk-5THZMT4W.js";import{a as _t}from"./chunk-WBMJOZIQ.js";import{b as vt,c as F,d as yt,e as wt}from"./chunk-PDFLS2XB.js";import{a as oe}from"./chunk-CHPLM643.js";import{a as re}from"./chunk-XBGBP7GJ.js";import"./chunk-3TKN2TWC.js";import"./chunk-RZ2HUHIL.js";import"./chunk-QGKQ2OTS.js";import"./chunk-7DG45AVS.js";import{b as ie,c as Ae,d as dt,e as Pe,f as ut,o as ht}from"./chunk-ADMU4VMS.js";import{c as se,e as mt}from"./chunk-4AMJ3NIP.js";import"./chunk-OZ5LGYCJ.js";import"./chunk-ZPQQQXRA.js";import"./chunk-Y7PYQEF4.js";import"./chunk-IQPUKORJ.js";import"./chunk-YRE2G4RX.js";import{d as pt,j as gt}from"./chunk-GVYD7GZA.js";import"./chunk-LZJYAKDL.js";import"./chunk-4YNUZOQW.js";import"./chunk-4EBEFT6T.js";import"./chunk-W4FJ4A5Q.js";import"./chunk-X7CRJ427.js";import"./chunk-2SZOQMAQ.js";import"./chunk-OT635BJR.js";import"./chunk-EDY6B353.js";import"./chunk-KS6SWJU3.js";import"./chunk-JHBR5RZV.js";import"./chunk-6J446DPN.js";import"./chunk-E3LKQDEM.js";import"./chunk-GWDYH5GG.js";import"./chunk-XCZY4IUQ.js";import"./chunk-DZBIKPHA.js";import"./chunk-F4QTXEUP.js";import"./chunk-C6VBL32Q.js";import"./chunk-OXOFK4XQ.js";import"./chunk-3DR4YGRI.js";import"./chunk-WCQK6XOZ.js";import"./chunk-RCCESRES.js";import"./chunk-FTNMSGGI.js";import"./chunk-4DJFVMMN.js";import"./chunk-MXVB4FQA.js";import"./chunk-DQVRRO4N.js";import"./chunk-MM6IP4FS.js";import"./chunk-DYNH5H2C.js";import"./chunk-QCDIRHTH.js";import"./chunk-2F2E6NNR.js";import"./chunk-23WSQWHC.js";import{e as te}from"./chunk-E24SCC45.js";import"./chunk-H7LSTWKZ.js";import"./chunk-3KFX3FFC.js";import"./chunk-XI5TLVWU.js";import"./chunk-T6V6CYCJ.js";import"./chunk-VSPQNL6A.js";import"./chunk-XNAAMINV.js";import"./chunk-NPF6KTZO.js";import"./chunk-WNU76WNW.js";import"./chunk-H4XRNT5U.js";import"./chunk-WIJFCRLT.js";import"./chunk-6ISQQD7M.js";import"./chunk-VHVYC3RW.js";import{n as ct}from"./chunk-ZBOVC36T.js";import"./chunk-BUWHOOA3.js";import"./chunk-SDC4SION.js";import"./chunk-N3AGC3JB.js";import"./chunk-IGNHVSQC.js";import"./chunk-B3W5V2XP.js";import"./chunk-NP35J4DQ.js";import"./chunk-JBGML6IF.js";import{a as be}from"./chunk-S2HMCZNZ.js";import"./chunk-WUAC4CFP.js";import{b as at}from"./chunk-ONDKJR4V.js";import"./chunk-QB4KDO4M.js";import{a as lt}from"./chunk-NNNTRPDR.js";import"./chunk-KDLA3TQ2.js";import"./chunk-RPMDOAYZ.js";import{b as Le}from"./chunk-J7UK2QPE.js";import"./chunk-6DXGZQQN.js";import"./chunk-3PK63SMD.js";import"./chunk-2DN2BYDF.js";import"./chunk-MEA3RU4I.js";import"./chunk-Q6D44QVW.js";import"./chunk-3UBXEUOT.js";import"./chunk-6WV5YJL7.js";import"./chunk-3AMG6HG6.js";import"./chunk-I6ETUG5Q.js";import"./chunk-MEBZWNWT.js";import"./chunk-XZ52TEBV.js";import"./chunk-WAPQB6I3.js";import"./chunk-L3GHXHDP.js";import{a as $e,b as st}from"./chunk-N6PITG7Q.js";import"./chunk-XC4LDHG5.js";import"./chunk-S3ASAZCA.js";import"./chunk-ZUUCQTSR.js";import"./chunk-GKUBZAEG.js";import{d as nt}from"./chunk-UW734WOQ.js";import"./chunk-BIZV3H6H.js";import"./chunk-UCYGH5UZ.js";import{k as et,l as tt,m as it}from"./chunk-ATV5GTE5.js";import"./chunk-X7WNJQZZ.js";import"./chunk-PQPFAB53.js";import"./chunk-QPPQKNYU.js";import{i as rt,j as T,k as ot}from"./chunk-MJXFSFCY.js";import"./chunk-6N46AY7Z.js";import"./chunk-TCQTMUK4.js";import"./chunk-AY3YVZUY.js";import"./chunk-7DCEI345.js";import"./chunk-ZG3FCPXY.js";import"./chunk-RIUAG34V.js";import"./chunk-G5SIQY64.js";import"./chunk-WW7S4V24.js";import"./chunk-UGAMS6PU.js";import"./chunk-EHDNZUTT.js";import"./chunk-NH7OOX2I.js";import"./chunk-B72PB7U4.js";import"./chunk-644SLL4Y.js";import"./chunk-A54VD7GL.js";import"./chunk-K55ZDM2S.js";import"./chunk-Z3USGHSR.js";import"./chunk-OO4IIGVK.js";import"./chunk-KQHYII76.js";import"./chunk-6I6DPRXI.js";import"./chunk-RNN6GAXL.js";import"./chunk-4IVMQ5PX.js";import"./chunk-CQUOQXLP.js";import"./chunk-VMYCUJRH.js";import"./chunk-PTVRFY4B.js";import"./chunk-3ZOLHUAU.js";import"./chunk-M2F4B74F.js";import"./chunk-2WNCPIJC.js";import"./chunk-GDB2EJGA.js";import"./chunk-RDGFIF46.js";import"./chunk-C2ONI6UP.js";import"./chunk-H6LJ2DCJ.js";import"./chunk-LCDA6FHZ.js";import"./chunk-RZPELDHM.js";import"./chunk-S3J33BKD.js";import{a as we}from"./chunk-NPIYHDQ7.js";import"./chunk-BL63T6AU.js";import"./chunk-AOTWUAUY.js";import"./chunk-VI4TDFI5.js";import"./chunk-GXSLPADW.js";import"./chunk-2HN33SWB.js";import"./chunk-523X5JOP.js";import"./chunk-BXR2KKYP.js";import"./chunk-7ISKCG7U.js";import"./chunk-OFGHVREP.js";import{a as ee}from"./chunk-YJ3RZNO6.js";import{g as Ye,h as _e,j as ve,l as fe,m as ye,o as Ze}from"./chunk-M4PATAW3.js";import"./chunk-26R336GJ.js";import"./chunk-OC7V2CEX.js";import"./chunk-VTCODMOL.js";import"./chunk-B7GIKKEW.js";import"./chunk-R7P6RQXJ.js";import"./chunk-4I7LQWUX.js";import"./chunk-JLNQ6WQT.js";import"./chunk-GB5RQL32.js";import"./chunk-4OZVVJHM.js";import"./chunk-IZRBPB5G.js";import{f as q}from"./chunk-X7XJWAFC.js";import"./chunk-ILCAH2F6.js";import"./chunk-CYCLIMTY.js";import"./chunk-Q6ZVH4MK.js";import"./chunk-RRDM7P6F.js";import"./chunk-7X2HMUNN.js";import"./chunk-LWJTIQQT.js";import"./chunk-IHBD2IWR.js";import"./chunk-NH3JQE75.js";import{a as Xe}from"./chunk-XXOIKNT6.js";import"./chunk-DBLGLVAQ.js";import"./chunk-55A6ZSIC.js";import"./chunk-HVNRUZWJ.js";import"./chunk-3IK5VXZ3.js";import"./chunk-EN6CTWVM.js";import"./chunk-IRJNWXGT.js";import"./chunk-O4AQRVFI.js";import"./chunk-NDPAZKBG.js";import"./chunk-7AZ5UVCG.js";import"./chunk-6GGK7PRJ.js";import"./chunk-EPTSNNZF.js";import"./chunk-FW33MEBA.js";import"./chunk-RM6CXOHZ.js";import"./chunk-AOA5JMXK.js";import"./chunk-TWW3KW7Z.js";import"./chunk-I6LCIPDY.js";import"./chunk-Y6H3NTW7.js";import"./chunk-4RLJMQW4.js";import{b as Qe}from"./chunk-J6ZRC6RI.js";import"./chunk-EBGO44EK.js";import"./chunk-THY6AAMN.js";import{a as A}from"./chunk-7W6RATG7.js";import"./chunk-45SNVLPM.js";import{b as Je,i as Ke}from"./chunk-BDF7KEUQ.js";import"./chunk-HWN5REN7.js";import"./chunk-B4JAL745.js";import{o as ge}from"./chunk-XTES2GPX.js";import{G as Fe,J as We,b as ke,c as K,d as Be,e as X,n as Ue,p as qe,u as Y,w as Z,y as $}from"./chunk-2HUIJUS4.js";import"./chunk-L62KOIOF.js";import"./chunk-5TKTI2G2.js";import{a as L,h as Re,i as S}from"./chunk-MBJHSEMD.js";import{g as Q,h as he}from"./chunk-YFBPRKIN.js";import"./chunk-P2YRCTWM.js";import"./chunk-OFZ6SV37.js";import"./chunk-5MNDZ6BX.js";import"./chunk-YSOJWUIW.js";import"./chunk-Q5WFUDPQ.js";import"./chunk-DPZGANVI.js";import"./chunk-T7BKG6V3.js";import"./chunk-R6VC74T7.js";import"./chunk-6WKJD7BM.js";import"./chunk-3CR7P5WT.js";import{a as pe,c as J}from"./chunk-YRTBL7EE.js";import{a as me}from"./chunk-3FPO2LOS.js";import"./chunk-QNZSBADV.js";import{a as y}from"./chunk-PYQRTZNZ.js";import"./chunk-S4PLWG55.js";import{b as Ge}from"./chunk-DZAY272R.js";import"./chunk-GYH7NDHH.js";import"./chunk-S3UQHW42.js";import"./chunk-VQHENXDQ.js";import"./chunk-VWF5VUO3.js";import"./chunk-HRP5LYWJ.js";import"./chunk-BIVFGNT6.js";import"./chunk-7PEPFLZH.js";import"./chunk-BRVOQZDM.js";import"./chunk-TBYT66N3.js";import{e as Ie,h as Ne}from"./chunk-5PTS4JDF.js";import"./chunk-MUI46NAG.js";import"./chunk-N27U3N2T.js";import"./chunk-4R5NBZMW.js";import"./chunk-NDYVXEZ5.js";import"./chunk-CMMPCPP5.js";import{P as je,X as He}from"./chunk-4DLSYLKE.js";import"./chunk-VPXBKZQM.js";import{c as xe}from"./chunk-ZTKK3KB7.js";import"./chunk-GZXWFBZI.js";import"./chunk-B7IARA3F.js";import"./chunk-IZVEJCCI.js";import"./chunk-TEY6TKJV.js";import"./chunk-4M6XQSBA.js";import"./chunk-2JF6YUJG.js";import{Q as n,S as N,h as Te}from"./chunk-GGZQ5GCM.js";import{U as I}from"./chunk-TFUPB3ZG.js";import"./chunk-ANPNMGFG.js";import{a as o}from"./chunk-BMVJCP2M.js";import"./chunk-GMC3I5VG.js";import{b as w}from"./chunk-WGF2T2BG.js";import"./chunk-YZP43POT.js";import"./chunk-VEDIBGHD.js";import{r as De}from"./chunk-3IBUFXWY.js";import"./chunk-BP73DJTS.js";import{a as C,b as E,g as ze}from"./chunk-JEGVIFEP.js";var D=class extends N{constructor(t){super(t)}initialize(){this.addHandles([L(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:t,startPoint:e})=>{t.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(e)},S),L(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:t,endPoint:e})=>{t.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(e)},S),L(()=>({result:this._computedResult,viewData:this.viewData}),({result:t,viewData:e})=>{e.result=t},S)])}_applyProjectionAndElevationAlignment(t){if(t==null)return t;let{spatialReference:e,elevationProvider:i}=this.view;return yt(t,e,i)??(wt(this.analysis,t.spatialReference,De.getLogger(this)),null)}get _computedResult(){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,measurementMode:i}=this.viewData;if(t==null||e==null)return null;let s=ht(t,e),r=mt(t,e);if(s==null)return null;let l,u;switch(i){case M.Auto:u=r!=null?"geodesic":"euclidean",l=r??s.horizontal;break;case M.Geodesic:if(r==null)return null;u="geodesic",l=r;break;case M.Euclidean:u="euclidean",l=s.horizontal}return{mode:u,directDistance:s.direct,horizontalDistance:l,verticalDistance:s.vertical,distance:i===M.Euclidean||s.horizontal.value<=se?s.direct:r??s.horizontal}}};o([n()],D.prototype,"view",void 0),o([n()],D.prototype,"analysis",void 0),o([n()],D.prototype,"viewData",void 0),o([n()],D.prototype,"_computedResult",null),D=o([I("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],D);var f,O;(function(t){t[t.None=0]="None",t[t.Direct=1]="Direct",t[t.Triangle=2]="Triangle",t[t.ProjectedGeodesic=3]="ProjectedGeodesic"})(f||(f={})),function(t){t[t.Auto=0]="Auto",t[t.AboveSegment=1]="AboveSegment",t[t.BelowSegment=2]="BelowSegment"}(O||(O={}));var ne=class extends st{constructor(e,i,s){super(e,i,new $e(Lt,()=>import("./chunk-35XDLA3U.js")),s,Me),this.primitiveType=Je.TRIANGLE_STRIP}initializePipeline(e){return it({blending:e.transparent?at(e.oitPass):null,polygonOffset:e.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:Ke.LESS},depthWrite:et,colorWrite:tt})}},Me=new Map([[A.POSITION,0],[A.NORMAL,1],[A.UV0,2],[A.LENGTH,3]]);var B=class extends lt{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1}};o([Le()],B.prototype,"polygonOffsetEnabled",void 0),o([Le()],B.prototype,"transparent",void 0);var le=class extends rt{constructor(e){super(e,Se),this._configuration=new B,this.vertexAttributeLocations=Me,this.produces=new Map([[be.OPAQUE_MATERIAL,i=>!this._transparent&&i===we.Color],[be.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,i=>this._transparent&&i===we.Color]])}getConfiguration(e,i){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this._transparent,this._configuration.oitPass=i.oitPass,this._configuration}get visible(){let{outlineColor:e,stripeEvenColor:i,stripeOddColor:s}=this.parameters;return e[3]>=ee||i[3]>=ee||s[3]>=ee}intersect(){}createGLMaterial(e){return new Oe(e)}createBufferWriter(){return new Ve}get _transparent(){let{parameters:e}=this;return e.outlineColor[3]<1||e.stripeEvenColor[3]<1||e.stripeOddColor[3]<1}},Oe=class extends nt{beginSlot(e){return this.acquireTechnique(ne,e)}},Se=class extends ot{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=J(1,.5,0,1),this.stripeEvenColor=J(1,1,1,1),this.stripeOddColor=J(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}},Ct=Qe().vec3f(A.POSITION).vec3f(A.NORMAL).vec2f(A.UV0).f32(A.LENGTH),Et=y(),Mt=y(),Ot=y(),St=y(),Vt=y(),Ve=class{constructor(){this.vertexBufferLayout=Ct}elementCount(e){return 2*(e.get(A.POSITION).indices.length/2+1)}write(e,i,s,r,l,u){let{data:d,indices:c}=s.get(A.POSITION),m=s.get(A.NORMAL).data,a=d.length/3;c&&c.length!==2*(a-1)&&console.warn("MeasurementArrowMaterial does not support indices");let h=Et,p=Mt,v=Ot,P=St,x=Vt,G=l.position,R=l.normal,V=l.uv0,j=0;for(let b=0;b<a;++b){let U=3*b;if(K(h,d[U],d[U+1],d[U+2]),b<a-1){let H=3*(b+1);K(p,d[H],d[H+1],d[H+2]),K(x,m[H],m[H+1],m[H+2]),Y(x,x),X(v,p,h),Y(v,v),Z(P,x,v),Y(P,P)}let ue=qe(h,p);e&&i&&($(h,h,e),$(p,p,e),$(P,P,i));let z=u+2*b,W=z+1;G.setVec(z,h),G.setVec(W,h),R.setVec(z,P),R.setVec(W,P),V.set(z,0,j),V.set(z,1,-1),V.set(W,0,j),V.set(W,1,1),b<a-1&&(j+=ue)}let de=l.length;for(let b=0;b<2*a;++b)de.set(u+b,j)}};var ce=class extends vt{constructor(e){super(e),this._arrowWidth=16,this._arrowSubdivisions=128,this._origin=y(),this._originTransform=Xe(),this._arrowCenter=y(),this._renderOccluded=T.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._color=pe(),this._contrastColor=pe(),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial?.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){let i=this._stripesEnabled?this._contrastColor:this._color;this._arrowMaterial.setParameters({stripeEvenColor:i})}}get color(){return this._color}set color(e){ye(e,this._color)||(me(this._color,e),this._updateArrowColor())}get contrastColor(){return this._contrastColor}set contrastColor(e){ye(e,this._color)||(me(this._contrastColor,e),this._updateArrowColor())}createExternalResources(){let e=this._color,i=this._contrastColor,s=this._stripesEnabled?i:e;this._arrowMaterial=new le({outlineColor:e,stripeEvenColor:s,stripeOddColor:e,renderOccluded:this.renderOccluded,polygonOffset:!0,isDecoration:this.isDecoration}),this._handles=new Te,this._handles.add(L(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles=w(this._handles)}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if(this._geometry?.startRenderSpace==null||this._geometry.endRenderSpace==null)return;let i=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);i.transformation=this._originTransform,e.addGeometry(i),this._viewChanged()}_createArrowGeometry(e,i,s,r){let l=this.view,u=l.renderCoordsHelper,d=[],c=[],m=(a,h)=>{let p=q.get();X(p,a,s),d.push(p),c.push(h)};if(r.type==="euclidean"){r.eval(.5,this._arrowCenter);let a=q.get();if(u.worldUpAtPosition(this._arrowCenter,a),zt(e,i,a)){let{heading:h,tilt:p}=l.camera,{direction:v}=gt(l,e,h,p,Dt);ke(a,v)}m(e,a),m(i,a)}else{r.eval(.5,this._arrowCenter);let a=this._arrowSubdivisions+1&-2;for(let h=0;h<a;++h){let p=h/(a-1),v=q.get(),P=q.get();r.eval(p,v),u.worldUpAtPosition(v,P),m(v,P)}}return ct(this._arrowMaterial,d,c)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&this._geometry!=null){let e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._arrowWidth*e})}}_updateArrowColor(){if(!this.attached)return;let e=this._color,i=this._contrastColor,s=this._stripesEnabled?i:e,r=e,l=e;this._arrowMaterial.setParameters({stripeEvenColor:s,outlineColor:r,stripeOddColor:l})}};function zt(t,e,i){let s=Fe(At,e,t),r=Z(At,s,i);return We(r)===0}var At=y(),Dt=pt();var _=class extends N{get _parameters(){let t=this.view.effectiveTheme,{accentColor:e,textColor:i}=t,s=fe(e),r=Ze(e,.75),l=fe(_e(e)),u=_e(i,Ye.Low);return{accentColor:s,contrastColor:l,translucentAccentColor:r,triangleLineWidth:3,geodesicProjectionLineWidth:2,guideLineWidth:2,guideStippleLengthPixels:3,directLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12,textColor:i,textBackgroundColor:ve(u,.6),textCalloutColor:ve(u,.5)}}get visible(){return this.analysisView.visible}get viewMode(){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e}=this.analysisView;if(t==null||e==null||t.equals(e))return f.None;let i=this.analysisView.result;if(i==null)return f.Direct;if(this.actualVisualizedMeasurement==="geodesic")return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?f.ProjectedGeodesic:f.Direct;let{verticalDistance:s,horizontalDistance:r}=i,l=s.value,u=r.value;return Math.min(l/u,u/l)<this.triangleCollapseRatioThreshold?f.Direct:f.Triangle}get actualVisualizedMeasurement(){let{measurementMode:t,result:e}=this.analysisView;switch(t){case M.Auto:return e!=null&&e.horizontalDistance.value>se?"geodesic":"euclidean";case M.Euclidean:return"euclidean";case M.Geodesic:return"geodesic"}}get allowVisualElementsOrientationChange(){return this._triangleOrientationOverride==null}set allowVisualElementsOrientationChange(t){this._triangleOrientationOverride==null!==t&&(this._triangleOrientationOverride==null?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){return this.actualVisualizedMeasurement==="geodesic"?{direct:null,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}constructor(t){super(t),this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=y(),this._endPosition=y(),this._cornerPosition=y(),this._startPositionAtSeaLevel=y(),this._endPositionAtSeaLevel=y(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=O.Auto,this.triangleCollapseRatioThreshold=.03}initialize(){let t=this._parameters,e={attached:!0,view:this.view,isDecoration:!0},{guideLineWidth:i,guideStippleLengthPixels:s,triangleLineWidth:r,geodesicProjectionLineWidth:l,directLabelFontSize:u,verticalLabelFontSize:d,horizontalLabelFontSize:c}=t;this._segmentVisualElement=new ce(E(C({},e),{geometry:null,renderOccluded:T.OccludeAndTransparent})),this._triangleVisualElement=new F(E(C({},e),{width:r,renderOccluded:T.OccludeAndTransparent})),this._rightAngleQuad=new ft(E(C({},e),{renderOccluded:T.OccludeAndTransparent}));let m=E(C({},e),{polygonOffset:!0,renderOccluded:T.OccludeAndTransparent});this._projectedGeodesicLine=new F(E(C({},m),{width:l,stipplePattern:re(s)})),this._geodesicStartHint=new F(E(C({},m),{width:i,stipplePattern:re(s)})),this._geodesicEndHint=new F(E(C({},m),{width:i,stipplePattern:re(s)})),this._segmentLabel=new ae(E(C({},e),{fontSize:u})),this._verticalLabel=new ae(E(C({},e),{fontSize:d})),this._horizontalLabel=new ae(E(C({},e),{fontSize:c})),this.addHandles([L(()=>{let{elevationAlignedStartPoint:a,elevationAlignedEndPoint:h}=this.analysisView,p=this.view;return{view:p,camera:p.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:a,elevationAlignedEndPoint:h,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},a=>this._updateGeometryAndViewMode(a),S),L(()=>({visible:this.visible,viewMode:this.viewMode}),a=>this._updateVisualElementVisibility(a),S),L(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),a=>this._updateLabelText(a),S),L(()=>({visible:this.visible,viewMode:this.viewMode}),a=>this._updateLabelVisibility(a),S),L(()=>this._measurementArrowStripeLength,a=>this._updateSegmentStripeLength(a),S),xe(()=>ze(this,null,function*(){return this._updateMessageBundle()})),L(()=>this._parameters,({textBackgroundColor:a,textCalloutColor:h,textColor:p,translucentAccentColor:v,accentColor:P,contrastColor:x})=>{let{_segmentLabel:G,_verticalLabel:R,_horizontalLabel:V,_triangleVisualElement:j,_rightAngleQuad:de,_projectedGeodesicLine:b,_geodesicStartHint:U,_geodesicEndHint:ue,_segmentVisualElement:z}=this;G.backgroundColor=a,G.calloutColor=h,G.textColor=p,R.backgroundColor=a,R.calloutColor=h,R.textColor=p,V.backgroundColor=a,V.calloutColor=h,V.textColor=p,j.color=v,de.color=v,b.color=v,U.color=v,ue.color=v,z.color=P,z.contrastColor=x},Re)]),this._updateMessageBundle()}destroy(){this._segmentVisualElement=w(this._segmentVisualElement),this._triangleVisualElement=w(this._triangleVisualElement),this._rightAngleQuad=w(this._rightAngleQuad),this._projectedGeodesicLine=w(this._projectedGeodesicLine),this._geodesicStartHint=w(this._geodesicStartHint),this._geodesicEndHint=w(this._geodesicEndHint),this._segmentLabel=w(this._segmentLabel),this._verticalLabel=w(this._verticalLabel),this._horizontalLabel=w(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:t,viewMode:e}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,t)switch(e){case f.None:break;case f.Direct:this._segmentVisualElement.visible=!0;break;case f.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case f.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:t,camera:e,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,orientation:l,visualizedMeasurement:u,stripeLength:d}){let c=t.renderCoordsHelper;if(c==null||s==null||r==null||s.equals(r))return;let m=this._startPosition,a=this._endPosition;c.toRenderCoords(s,m),c.toRenderCoords(r,a);let h=l===O.AboveSegment?1:-1,p=h*(c.getAltitude(a)-c.getAltitude(m));p<0&&(m=this._endPosition,a=this._startPosition);let v=u==="geodesic"?new Ce(this._startPosition,this._endPosition,c.spatialReference):new k(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=v,this._updateSegmentStripeLength(d),i){case f.Direct:this._updateSegment(v,l);break;case f.Triangle:this._updateSegmentAndTriangle({view:t,camera:e,segment:v,orientation:l,startPosition:m,endPosition:a,deltaSign:h,altitudeDelta:p});break;case f.ProjectedGeodesic:this._updateSegmentAndProjection({view:t,orientation:l,startPosition:m,endPosition:a})}}_updateSegment(t,e){this._segmentLabel.anchor=e===O.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:t,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:t},camera:e,segment:i,orientation:s,startPosition:r,endPosition:l,deltaSign:u,altitudeDelta:d}){let c=this._cornerPosition;t.worldUpAtPosition(r,c),Ue(c,c,u*Math.abs(d)),Be(c,c,r),this._triangleVisualElement.geometry=[[[r[0],r[1],r[2]],[c[0],c[1],c[2]],[l[0],l[1],l[2]]]],this._rightAngleQuad.geometry={previous:r,center:c,next:l};let m=new k(r,c),a=new k(c,l),h=Tt(r,l,c,s,e);this._segmentLabel.anchor=h.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:m,sampleLocation:"center"},this._verticalLabel.anchor=h.vertical,this._horizontalLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._horizontalLabel.anchor=h.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:t},orientation:e,startPosition:i,endPosition:s}){t.setAltitude(this._startPositionAtSeaLevel,0,i),t.setAltitude(this._endPositionAtSeaLevel,0,s);let r=new Ce(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(r),this._geodesicStartHint.setGeometryFromSegment(new k(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new k(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:r,sampleLocation:"center"},this._segmentLabel.anchor=e===O.AboveSegment?"top":"bottom"}_updateLabelText({text:t,visualizedMeasurement:e}){t!=null?(this._segmentLabel.text=e==="euclidean"?t.directDistance:t.horizontalDistance,this._horizontalLabel.text=t.horizontalDistance,this._verticalLabel.text=t.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:t,viewMode:e}){let i=this._segmentLabel,s=this._horizontalLabel,r=this._verticalLabel;if(i.visible=!1,s.visible=!1,r.visible=!1,t)switch(e){case f.Direct:i.visible=!0;break;case f.Triangle:i.visible=!0,s.visible=!0,r.visible=!0;break;case f.ProjectedGeodesic:i.visible=!0;case f.None:}}get _labelsText(){if(this.destroyed)return null;let t=this.messages,e=this.analysisView.result;if(e==null||t==null)return null;let{directDistance:i,horizontalDistance:s,verticalDistance:r}=e,l=this.analysisView.unit,u=d=>C({directDistance:"",horizontalDistance:"",verticalDistance:""},d);switch(l){case"metric":return u({directDistance:i&&Ae(t,i),horizontalDistance:s&&Ae(t,s),verticalDistance:r&&dt(t,r)});case"imperial":return u({directDistance:i&&Pe(t,i),horizontalDistance:s&&Pe(t,s),verticalDistance:r&&ut(t,r)});default:return u({directDistance:i&&ie(t,i,l),horizontalDistance:s&&ie(t,s,l),verticalDistance:r&&ie(t,r,l)})}}_updateSegmentStripeLength(t){let e=this._segmentVisualElement;t!=null?(e.stripeLength=t,e.stripesEnabled=!0):e.stripesEnabled=!1}get _actualVisualElementsOrientation(){if(this._triangleOrientationOverride!=null)return this._triangleOrientationOverride;let t=this.visualElementOrientation;return t===O.Auto?this.view.state.camera.aboveGround?O.AboveSegment:O.BelowSegment:t}_requiresGeodesicGuideAt(t){let e=this.view;if(!e?.state)return!1;let i=e.state.camera,s=e.renderCoordsHelper;if(!s)return!1;let r=i.computeScreenPixelSizeAt(t);return s.getAltitude(t)/r>=10}get _measurementArrowStripeLength(){let{result:t,unit:e}=this.analysisView;if(t==null)return null;let i=null,s=t.directDistance;switch(e){case"metric":i=s&&te(s,"meters");break;case"imperial":i=s&&te(s,He(s.value,s.unit));break;default:i=s&&te(s,e)}return i==null?null:Ie(i.value/30)*je(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,Ge("esri/core/t9n/Units").then(t=>{this.messages=t}).finally(()=>{this.loadingMessages=!1})}get testData(){}};function Tt(t,e,i,s,r){let l=xt,u=Gt;r.projectToRenderScreen(i,l),r.projectToRenderScreen(e,u);let d={segment:"bottom",horizontal:"top",vertical:l[0]<u[0]?"left":"right"};{let c=Rt,m=jt;if(oe(t,i,r,c),oe(t,e,r,m),ge(c,m)>=Pt){let a=Math.sign(c[1])===Math.sign(m[1]);d.segment=a?Ee(d.vertical):d.vertical}else{let a=Ht;oe(i,e,r,a),ge(a,m)>=Pt&&(d.segment=Math.sign(a[0])===Math.sign(m[0])?Ee(d.horizontal):d.horizontal)}}if(s===O.BelowSegment){let c=m=>m==="top"?"bottom":"top";d.segment=c(d.segment),d.horizontal=c(d.horizontal),d.vertical=c(d.vertical)}return d}o([n()],_.prototype,"_parameters",null),o([n()],_.prototype,"_triangleOrientationOverride",void 0),o([n()],_.prototype,"messages",void 0),o([n()],_.prototype,"view",void 0),o([n()],_.prototype,"analysis",void 0),o([n()],_.prototype,"analysisView",void 0),o([n()],_.prototype,"loadingMessages",void 0),o([n()],_.prototype,"visible",null),o([n()],_.prototype,"viewMode",null),o([n()],_.prototype,"actualVisualizedMeasurement",null),o([n()],_.prototype,"visualElementOrientation",void 0),o([n()],_.prototype,"triangleCollapseRatioThreshold",void 0),o([n()],_.prototype,"allowVisualElementsOrientationChange",null),o([n()],_.prototype,"labels",null),o([n()],_.prototype,"_labelsText",null),o([n()],_.prototype,"_actualVisualElementsOrientation",null),o([n()],_.prototype,"_measurementArrowStripeLength",null),_=o([I("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],_);var Pt=Math.cos(Ne(12)),xt=he(),Gt=he(),Rt=Q(),jt=Q(),Ht=Q();var g=class extends _t(N){constructor(t){super(t),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=M.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){let t=this.view,e=this.analysis;this._analysisVisualization=new _({view:t,analysis:e,analysisView:this}),this._analysisController=new D({view:t,analysis:e,viewData:this})}destroy(){this._analysisController=w(this._analysisController),this._analysisVisualization=w(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(t){this._analysisVisualization.visualElementOrientation=t}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(t){this._analysisVisualization.allowVisualElementsOrientationChange=t}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(t){this._analysisVisualization.triangleCollapseRatioThreshold=t}get directLabelText(){return this._analysisVisualization.labels.direct?.text??""}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal?.text??""}get verticalLabelText(){return this._analysisVisualization.labels.vertical?.text??""}get unit(){return this.analysis.unit??this._defaultUnit}get testData(){}};o([n()],g.prototype,"updating",null),o([n({readOnly:!0})],g.prototype,"type",void 0),o([n({constructOnly:!0,nonNullable:!0})],g.prototype,"analysis",void 0),o([n()],g.prototype,"result",void 0),o([n()],g.prototype,"measurementMode",void 0),o([n()],g.prototype,"elevationAlignedStartPoint",void 0),o([n()],g.prototype,"elevationAlignedEndPoint",void 0),o([n({readOnly:!0})],g.prototype,"viewMode",null),o([n({readOnly:!0})],g.prototype,"actualVisualizedMeasurement",null),o([n()],g.prototype,"visualElementOrientation",null),o([n()],g.prototype,"allowVisualElementsOrientationChange",null),o([n()],g.prototype,"triangleCollapseRatioThreshold",null),o([n({readOnly:!0})],g.prototype,"directLabelText",null),o([n({readOnly:!0})],g.prototype,"horizontalLabelText",null),o([n({readOnly:!0})],g.prototype,"verticalLabelText",null),o([n()],g.prototype,"_analysisVisualization",void 0),o([n()],g.prototype,"_analysisController",void 0),o([n()],g.prototype,"unit",null),o([n(bt)],g.prototype,"_defaultUnit",void 0),g=o([I("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],g);var js=g;export{js as default};
