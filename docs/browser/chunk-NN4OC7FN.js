import{c as x,g as F}from"./chunk-CA2IXN6Q.js";import{a as y,w as D,y as L}from"./chunk-7D4IYTAJ.js";import{a as v}from"./chunk-TSNWBMBA.js";import{b as E}from"./chunk-GLWPOGYF.js";import{b as h}from"./chunk-S4PLWG55.js";import{b as w,c as b}from"./chunk-GYH7NDHH.js";import{r as g,t as f}from"./chunk-3IBUFXWY.js";import{g as d}from"./chunk-JEGVIFEP.js";var m=()=>g.getLogger("esri.layers.support.labelFormatUtils"),p={type:"simple",evaluate:()=>null},T={getAttribute:(r,t)=>r.field(t)};function U(r,t,c){return d(this,null,function*(){if(!r||!r.symbol||!t)return p;let i=r.where,s=x(r),a;if(s.type==="arcade"){let e=yield E(s.expression,c,t);if(e==null)return p;a={type:"arcade",evaluate(l,n){try{let o="attributes"in l?e.repurposeFeature(l):l;o.contextTimeZone=n??null;let u=e.evaluate({$view:{timeZone:n},$feature:o},e.services);if(u!=null)return u.toString()}catch(o){m().error(new f("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:o,feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>F(s.expression)==null}}else a={type:"simple",evaluate:e=>s.expression.replaceAll(/{[^}]*}/g,l=>{let n=l.slice(1,-1),o=t.get(n);if(!o)return l;let u=null;return"attributes"in e?e&&e.attributes&&(u=e.attributes[o.name]):u=e.field(o.name),u==null?"":N(u,o)})};if(i){let e;try{e=yield v(i,t)}catch(n){return m().error(new f("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:n})),p}let l=a.evaluate;a.evaluate=(n,o)=>{let u="attributes"in n?void 0:T;try{if(e.testFeature(n,u))return l(n,o)}catch(A){m().error(new f("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:n,error:A}))}return null}}return a})}function N(r,t){if(r==null)return"";let c=t.domain;if(c){if(c.type==="codedValue"||c.type==="coded-value"){let s=r;for(let a of c.codedValues)if(a.code===s)return a.name}else if(c.type==="range"){let{max:s,min:a}=y(t),e=+r;if(a!=null&&s!=null&&a<=e&&e<=s)return c.name}}let i=r;return L(t)?i=b(i,w("short-date")):D(t)&&(i=h(+i)),i||""}export{U as a,N as b};
