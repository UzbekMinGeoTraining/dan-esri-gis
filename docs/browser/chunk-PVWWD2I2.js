import{a as Oe}from"./chunk-PX7LT6IQ.js";import{a as x,b as g,c as Te,e as ve}from"./chunk-ZQL3TKF7.js";import{a as xe}from"./chunk-ZRDZCHT6.js";import{a as q,b as y}from"./chunk-W4FJ4A5Q.js";import{b as he,e as me,g as ce,h as de}from"./chunk-ONDKJR4V.js";import{c as fe,f as ge,g as Me}from"./chunk-QB4KDO4M.js";import{b as L}from"./chunk-XBFBZZXW.js";import{c as ye,f as M}from"./chunk-XZ52TEBV.js";import{a as ae,b as pe}from"./chunk-N6PITG7Q.js";import{a as R}from"./chunk-GKUBZAEG.js";import{j as ie,k as ne,l as le,m as ue}from"./chunk-ATV5GTE5.js";import{a as D}from"./chunk-G5SIQY64.js";import{a as V}from"./chunk-BNUQT6PD.js";import{a as F}from"./chunk-IMNO5TXZ.js";import{b as j}from"./chunk-LCDA6FHZ.js";import{a as d,h as oe}from"./chunk-NPIYHDQ7.js";import{a as se}from"./chunk-BXR2KKYP.js";import{a as ee}from"./chunk-YJ3RZNO6.js";import{a as te,e as re,g as _}from"./chunk-4OZVVJHM.js";import{d as Q,e as Y}from"./chunk-NH3JQE75.js";import{b as $}from"./chunk-DBLGLVAQ.js";import{a as f}from"./chunk-7W6RATG7.js";import{x as K}from"./chunk-BDF7KEUQ.js";import{D as J,L as k}from"./chunk-2HUIJUS4.js";import{c as Z,d as X}from"./chunk-YRTBL7EE.js";import{o as W}from"./chunk-3FPO2LOS.js";import{d as U,i as G}from"./chunk-PYQRTZNZ.js";import{a}from"./chunk-BMVJCP2M.js";import{g as H}from"./chunk-JEGVIFEP.js";var A,I=null,v=new Map;function Se(t){return H(this,null,function*(){I==null&&(A==null&&(A=import("./chunk-XWNY6VXI.js")),I=yield A);let r=t.view,o=v.get(r);o||(o=new I.default({view:r}),v.set(r,o));let s=!!r._stage.renderView.renderingContext.capabilities.compressedTextureS3TC;return yield o.initializeWasm(s),o.add3DTilesLayerView(t)})}function De(t){return v.get(t)}function Ne(t){let r=t.view,o=v.get(r);o&&o.remove3DTilesLayerView(t)<1&&(v.delete(r),v.size===0&&(A=null,I=null))}var B=class extends pe{constructor(r,o,s){super(r,o,new ae(ve,()=>import("./chunk-UTRXE2HZ.js")),s,be)}initializePipeline(r){let{integratedMeshMode:o,output:s,blendingEnabled:n,cullFace:e,hasOccludees:l,hasPolygonOffset:m,oitPass:c}=r,P=o!==g.None,S=c===D.NONE,T=c===D.FrontFace;return ue({blending:oe(s)&&n?he(c):null,culling:ie(e),depthTest:{func:ce(c)},depthWrite:S||T?ne:null,drawBuffers:s===d.Depth?{buffers:[K.NONE]}:de(c,s),colorWrite:le,stencilWrite:P||l?fe:null,stencilTest:P?ge(re.IntegratedMeshMaskExcluded):l?Me:null,polygonOffset:S||T?m?{factor:2,units:2}:null:me})}},be=new Map([[f.POSITION,0],[f.NORMAL,1],[f.NORMALCOMPRESSED,1],[f.COLOR,2],[f.UV0,3],[f.UVREGION,4],[f.COMPONENTINDEX,5]]);var E=class extends se{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(let r of this._parameterBlocks)this[r]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(let r of this._parameterBlocks)if(this[r].dirty)return!0;return!1}},O=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function i(t={}){return(r,o)=>{let s=r._parameterCount??0;if(r._parameterCount=s+1,t.vectorOps){let n=t.vectorOps;Object.defineProperty(r,o,{get(){return this[s]},set(e){let l=this[s];if(l==null)this[s]=[...e];else{if(n.equals(l,e))return;n.copy(l,e)}this._setDirty()}})}else Object.defineProperty(r,o,{get(){return this[s]},set(n){this[s]!==n&&(t.dispose&&this[s]&&this[s].dispose(),this[s]=n,this._setDirty())}})}}function z(){return(t,r)=>{let o=t._parameterCount??0;t._parameterCount=o+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(o),Object.defineProperty(t,r,{get(){return this[o]},set(s){this[o]!==s&&(this[o]=s,this._setDirty())}})}}var u=class extends E{constructor(r,o){super(),this.toMapSpace=o,this.baseColor=X(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=ye,this.emissiveFactor=U(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new C,this.componentParameters=new w,this.textureAlphaCutoff=ee,this.alphaDiscardMode=_.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=xe.Earth,this.hasOccludees=!1;let s=new Oe(r.position),n=$(r.rotationScale);Y(n,n),Q(n,n),this.transformNormalGlobalFromModel=n,this.transformWorldFromModelTL=s.low,this.transformWorldFromModelTH=s.high,this.transformWorldFromModelRS=r.rotationScale}dispose(){this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture?.glTexture}get textureMetallicRoughness(){return this.metallicRoughnessTexture?.glTexture}get textureEmissive(){return this.emissionTexture?.glTexture}get hasEmissions(){return this.emissionTexture!=null||!J(this.emissiveFactor,G)}get textureOcclusion(){return this.occlusionTexture?.glTexture}get textureNormal(){return this.normalTexture?.glTexture}acquireTechnique(r,o,s,n){let e=new Te(r.context.spherical,r.context.doublePrecisionRequiresObfuscation);e.hasVertexColors=n.colors,e.hasNormals=n.hasNormals,e.textureCoordinateType=n.textureCoordinates,e.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,e.hasOcclusionTexture=this.occlusionTexture!=null,e.hasNormalTexture=this.normalTexture!=null,e.oitPass=o.identifier===y.Material&&s.oitPass!=null?s.oitPass:D.NONE,e.terrainDepthTest=o.identifier===y.Material&&s.terrainDepthTest,e.cullAboveTerrain=o.identifier===y.Material&&s.cullAboveTerrain,e.ellipsoidMode=this.ellipsoidMode,e.componentData=this.componentParameters.type,e.cullFace=this.commonMaterialParameters.cullFace,e.doubleSidedMode=this.commonMaterialParameters.doubleSided?L.View:L.None,e.hasColorTexture=this.baseColorTexture!=null;let l=this._computeWhichMaterialPass();if(e.blendingEnabled=l===p.Transparent||l===p.OpaqueAndTransparent,e.alphaDiscardMode=this.alphaDiscardMode,e.integratedMeshMode=this.isIntegratedMesh?Pe(s)?we(s)?g.ColorOverlayWithWater:g.ColorOverlay:g.NoOverlay:g.None,e.hasPolygonOffset=this.polygonOffsetEnabled,e.pbrMode=e.integratedMeshMode===g.ColorOverlayWithWater?M.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?n.shadeNormals&&this.isIntegratedMesh?M.Disabled:M.Schematic:M.Normal:M.Disabled,e.emissionSource=this.emissionTexture!=null?R.Texture:e.pbrMode===M.Normal?R.Value:R.None,e.shadeNormals=n.shadeNormals,e.normalType=e.hasNormals?j.Compressed:j.ScreenDerivative,e.hasSlicePlane=s.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,o.identifier===y.ShadowMap)e.output=d.Shadow,e.vertexDiscardMode=x.None;else if(o.identifier===y.ViewshedShadowMap)e.output=d.ViewshedShadow,e.vertexDiscardMode=x.None;else if(o.identifier===y.Highlight)e.output=d.Highlight,e.vertexDiscardMode=x.None;else{switch(l===p.OpaqueAndTransparent?e.vertexDiscardMode=o.transparent?x.Opaque:x.Transparent:e.vertexDiscardMode=x.None,e.output=o.output,e.receiveAmbientOcclusion=!1,e.receiveShadows=!1,o.output){case d.Color:case d.ColorEmission:e.receiveAmbientOcclusion=n.applySSAO&&s.ssao!=null,e.hasOccludees=s.hasOccludees,e.receiveShadows=s.shadowMap.ready,e.screenSpaceReflections=s.ssr.lastFrameColor!=null,e.cloudReflections=s.clouds.data!=null;break;case d.ObjectAndLayerIdColor:e.objectAndLayerIdColor=!0}e.snowCover=this.hasSnowCover(s)}let m=r.acquire(B,e);return this._setClean(),m}hasSnowCover(r){return r.weather!=null&&r.weatherVisible&&r.weather.type==="snowy"&&r.weather.snowCover==="enabled"}submit(r,o,s){if(this.objectOpacity===0)return;let{components:n,renderable:e}=s,{geometry:l}=e,m=e.meta.cameraDepthSquared,{geometryRanges:c,highlightRanges:P,defaultShadowMapRanges:S}=n;switch(this._computeWhichMaterialPass()){case p.Opaque:r.materialOpaque.submitDraw(this,l,c,m);break;case p.Transparent:r.materialTransparent.submitDraw(this,l,c,m);break;case p.OpaqueAndTransparent:r.materialOpaque.submitDraw(this,l,c,m),r.materialTransparent.submitDraw(this,l,c,m);break;case p.IntegratedMesh:r.materialIntegratedMesh.submitDraw(this,l,c,m),Ce(o)&&r.highlightIntegratedMesh.submitDraw(this,l,c,m)}let T=this.componentParameters.castShadows!==h.None;if(T&&r.shadowMap.submitDraw(this,l,c,m),P!=null)for(let N of P)r.highlight.submitDraw(this,l,N[1],m,N[0]),T&&r.highlightShadowMap.submitDraw(this,l,N[1],m,N[0]);o.viewshedEnabled&&r.viewshedShadowMap.submitDraw(this,l,c,m),T&&S!=null&&r.defaultShadowMap.submitDraw(this,l,S,m)}_computeWhichMaterialPass(){return this.isIntegratedMesh?p.IntegratedMesh:this.objectOpacity<1?p.Transparent:this.componentParameters.opaqueOverride===h.All?p.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===_.Blend||this.alphaDiscardMode===_.MaskBlend?p.Transparent:this.componentParameters.transparent===h.None?p.Opaque:this.componentParameters.transparent===h.All?p.Transparent:p.OpaqueAndTransparent}},p,h;a([i({vectorOps:W})],u.prototype,"baseColor",void 0),a([i()],u.prototype,"usePBR",void 0),a([i()],u.prototype,"hasParametersFromSource",void 0),a([i({vectorOps:k})],u.prototype,"mrrFactors",void 0),a([i({vectorOps:k})],u.prototype,"emissiveFactor",void 0),a([i({dispose:!0})],u.prototype,"baseColorTexture",void 0),a([i({dispose:!0})],u.prototype,"metallicRoughnessTexture",void 0),a([i({dispose:!0})],u.prototype,"emissionTexture",void 0),a([i({dispose:!0})],u.prototype,"occlusionTexture",void 0),a([i({dispose:!0})],u.prototype,"normalTexture",void 0),a([i()],u.prototype,"objectOpacity",void 0),a([z()],u.prototype,"commonMaterialParameters",void 0),a([z()],u.prototype,"componentParameters",void 0),a([i()],u.prototype,"textureAlphaCutoff",void 0),a([i()],u.prototype,"alphaDiscardMode",void 0),a([i()],u.prototype,"isIntegratedMesh",void 0),a([i()],u.prototype,"polygonOffsetEnabled",void 0),a([i()],u.prototype,"ellipsoidMode",void 0),a([i()],u.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(p||(p={}));var C=class extends O{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=te.Back,this.hasSlicePlane=!0}};a([i()],C.prototype,"doubleSided",void 0),a([i()],C.prototype,"cullFace",void 0),a([i()],C.prototype,"hasSlicePlane",void 0);var w=class extends O{constructor(){super(...arguments),this.externalColor=Z(1,1,1,1),this.externalColorMixMode=F.Multiply,this.castShadows=h.All}get transparent(){return this.externalColor[3]<1?h.All:h.None}get opaqueOverride(){return this.externalColorMixMode===F.Replace&&this.externalColor[3]===1?h.All:h.None}get visible(){return this.externalColor[3]>0?h.All:h.None}get type(){return V.Uniform}};a([i({vectorOps:W})],w.prototype,"externalColor",void 0),a([i()],w.prototype,"externalColorMixMode",void 0),a([i()],w.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(h||(h={}));var b=class extends O{constructor(){super(...arguments),this.texture=null,this.transparent=h.None,this.opaqueOverride=h.None,this.castShadows=h.None}get type(){return V.Varying}};function Ce(t){return t.overlay?.getTexture(q.Highlight)!=null}function we(t){return t.overlay?.getTexture(q.WaterNormal)!=null}function Pe(t){return t.overlay?.getTexture(q.ColorNoRasterImage)!=null}a([i()],b.prototype,"texture",void 0),a([i()],b.prototype,"transparent",void 0),a([i()],b.prototype,"opaqueOverride",void 0),a([i()],b.prototype,"castShadows",void 0);export{Se as a,De as b,Ne as c,be as d,u as e,h as f,w as g,b as h};
