import{b as fe}from"./chunk-B7O6UVTJ.js";import{c as B}from"./chunk-WCQK6XOZ.js";import{a as f,b as Te,c as de}from"./chunk-RCCESRES.js";import{a as c}from"./chunk-S2HMCZNZ.js";import{b as ie,c as ae,g as se,h as ne}from"./chunk-ONDKJR4V.js";import{a as oe,b as w,c as W,d as le,g as ce,h as b,i as pe,j as he}from"./chunk-QB4KDO4M.js";import{a as ee,b as te}from"./chunk-N6PITG7Q.js";import{e as me}from"./chunk-UW734WOQ.js";import{g as k,l as I,m as A}from"./chunk-ATV5GTE5.js";import{h as ue}from"./chunk-PQPFAB53.js";import{i as re,j as _}from"./chunk-MJXFSFCY.js";import{a as u,g as v,j as U,m as $}from"./chunk-NPIYHDQ7.js";import{a as X}from"./chunk-YJ3RZNO6.js";import{b as J}from"./chunk-J6ZRC6RI.js";import{a as r}from"./chunk-7W6RATG7.js";import{x as K}from"./chunk-BDF7KEUQ.js";import{E as j,c as D,y as N}from"./chunk-2HUIJUS4.js";import{a as M}from"./chunk-PYQRTZNZ.js";var L=class extends te{constructor(t,e,n){super(t,e,new ee(fe,()=>import("./chunk-UT3JX7O7.js")),n,x)}_makePipelineState(t,e){let{output:n,oitPass:E,space:C,hasOccludees:P}=t;return A({blending:n===u.Color?ie(E):null,depthTest:C===f.Draped?null:{func:se(E)},depthWrite:ae(t),drawBuffers:n===u.Depth?{buffers:[K.NONE]}:ne(E,n),colorWrite:I,stencilWrite:P?W:null,stencilTest:P?e?b:ce:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(t){return t.occluder?(this._occluderPipelineTransparent=A({blending:k,depthTest:w,depthWrite:null,colorWrite:I,stencilWrite:null,stencilTest:he}),this._occluderPipelineOpaque=A({blending:k,depthTest:w,depthWrite:null,colorWrite:I,stencilWrite:le,stencilTest:pe}),this._occluderPipelineMaskWrite=A({blending:null,depthTest:oe,depthWrite:null,colorWrite:null,stencilWrite:W,stencilTest:b})):this._occluderPipelineTransparent=this._occluderPipelineOpaque=this._occluderPipelineMaskWrite=null,this._occludeePipelineState=this._makePipelineState(t,!0),this._makePipelineState(t,!1)}getPipeline(t,e){return t?this._occludeePipelineState:e===c.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent??super.getPipeline():e===c.OCCLUDER_MATERIAL?this._occluderPipelineOpaque??super.getPipeline():this._occluderPipelineMaskWrite??super.getPipeline()}},x=new Map([[r.POSITION,0],[r.PREVPOSITION,1],[r.UV0,2],[r.NORMAL,3],[r.COLOR,4],[r.COLORFEATUREATTRIBUTE,4],[r.SIZE,5],[r.SIZEFEATUREATTRIBUTE,5],[r.OPACITYFEATUREATTRIBUTE,6]]);var Ae=class extends re{constructor(t){super(t,F),this._configuration=new de,this.vertexAttributeLocations=x,this.produces=new Map([[c.OPAQUE_MATERIAL,e=>e===u.Highlight||v(e)&&this.parameters.renderOccluded===_.OccludeAndTransparentStencil],[c.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>$(e)],[c.OCCLUDER_MATERIAL,e=>U(e)&&this.parameters.renderOccluded===_.OccludeAndTransparentStencil],[c.TRANSPARENT_OCCLUDER_MATERIAL,e=>U(e)&&this.parameters.renderOccluded===_.OccludeAndTransparentStencil],[c.TRANSPARENT_MATERIAL,e=>v(e)&&this.parameters.writeDepth],[c.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>v(e)&&!this.parameters.writeDepth],[c.DRAPED_MATERIAL,e=>e===u.Color||e===u.Highlight]]),this._layout=this.createLayout()}getConfiguration(t,e){return this._configuration.output=t,this._configuration.space=e.slot===c.DRAPED_MATERIAL?f.Draped:this.parameters.worldSpace?f.World:f.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==B.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=e.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===_.OccludeAndTransparentStencil,this._configuration.oitPass=e.oitPass,this._configuration.terrainDepthTest=e.terrainDepthTest,this._configuration.cullAboveTerrain=e.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color[3]>=X}intersect(){}createLayout(){let t=J().vec3f(r.POSITION).vec3f(r.PREVPOSITION).vec2f(r.UV0);return this.parameters.worldSpace&&t.vec3f(r.NORMAL),this.parameters.vvSize?t.f32(r.SIZEFEATUREATTRIBUTE):t.f32(r.SIZE),this.parameters.vvColor?t.f32(r.COLORFEATUREATTRIBUTE):t.vec4f(r.COLOR),this.parameters.vvOpacity&&t.f32(r.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new q(this._layout,this.parameters)}createGLMaterial(t){return new y(t)}},y=class extends me{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}beginSlot(t){let e=this._material.parameters.markerPrimitive;return e!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(e,this._markerPrimitive)}),this._markerPrimitive=e),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(L,t)}},F=class extends ue{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=B.BUTT,this.anchor=Te.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.markerTexture=null}},q=class{constructor(t,e){this.vertexBufferLayout=t,this._parameters=e}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(t,e,n,E,C,P){let h=n.get(r.POSITION).data,G=h.length/3,S=[1,0,0],V=n.get(r.NORMAL);this._parameters.worldSpace&&V!=null&&(S=V.data);let Z=1,H=0;this._parameters.vvSize?H=n.get(r.SIZEFEATUREATTRIBUTE).data[0]:n.has(r.SIZE)&&(Z=n.get(r.SIZE).data[0]);let m=[1,1,1,1],z=0;this._parameters.vvColor?z=n.get(r.COLORFEATUREATTRIBUTE).data[0]:n.has(r.COLOR)&&(m=n.get(r.COLOR).data);let Y=0;this._parameters.vvOpacity&&(Y=n.get(r.OPACITYFEATUREATTRIBUTE).data[0]);let i=new Float32Array(C.buffer),a=P*(this.vertexBufferLayout.stride/4),T=(s,d,o,l)=>{if(i[a++]=s[0],i[a++]=s[1],i[a++]=s[2],i[a++]=d[0],i[a++]=d[1],i[a++]=d[2],i[a++]=o[0],i[a++]=o[1],this._parameters.worldSpace&&(i[a++]=S[0],i[a++]=S[1],i[a++]=S[2]),this._parameters.vvSize?i[a++]=H:i[a++]=Z,this._parameters.vvColor)i[a++]=z;else{let p=Math.min(4*l,m.length-4);i[a++]=m[p],i[a++]=m[p+1],i[a++]=m[p+2],i[a++]=m[p+3]}this._parameters.vvOpacity&&(i[a++]=Y)},R;(function(s){s[s.ASCENDING=1]="ASCENDING",s[s.DESCENDING=-1]="DESCENDING"})(R||(R={}));let Q=(s,d)=>{let o=D(_e,h[3*s],h[3*s+1],h[3*s+2]),l=Oe,p=s+d;do D(l,h[3*p],h[3*p+1],h[3*p+2]),p+=d;while(j(o,l)&&p>=0&&p<G);t&&(N(o,o,t),N(l,l,t)),T(o,l,[-1,-1],s),T(o,l,[1,-1],s),T(o,l,[1,1],s),T(o,l,[-1,-1],s),T(o,l,[1,1],s),T(o,l,[-1,1],s)},g=this._parameters.placement;g!=="begin"&&g!=="begin-end"||Q(0,R.ASCENDING),g!=="end"&&g!=="begin-end"||Q(G-1,R.DESCENDING)}},_e=M(),Oe=M();export{Ae as a};
